(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function lE(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ff={exports:{}},Xo={},Bf={exports:{}},Ve={};var Fy;function CL(){if(Fy)return Ve;Fy=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),i=Symbol.for("react.provider"),o=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),h=Symbol.iterator;function p(D){return D===null||typeof D!="object"?null:(D=h&&D[h]||D["@@iterator"],typeof D=="function"?D:null)}var x={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,E={};function v(D,$,ie){this.props=D,this.context=$,this.refs=E,this.updater=ie||x}v.prototype.isReactComponent={},v.prototype.setState=function(D,$){if(typeof D!="object"&&typeof D!="function"&&D!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,D,$,"setState")},v.prototype.forceUpdate=function(D){this.updater.enqueueForceUpdate(this,D,"forceUpdate")};function b(){}b.prototype=v.prototype;function A(D,$,ie){this.props=D,this.context=$,this.refs=E,this.updater=ie||x}var L=A.prototype=new b;L.constructor=A,g(L,v.prototype),L.isPureReactComponent=!0;var I=Array.isArray,_=Object.prototype.hasOwnProperty,F={current:null},C={key:!0,ref:!0,__self:!0,__source:!0};function P(D,$,ie){var ce,ue={},fe=null,Ee=null;if($!=null)for(ce in $.ref!==void 0&&(Ee=$.ref),$.key!==void 0&&(fe=""+$.key),$)_.call($,ce)&&!C.hasOwnProperty(ce)&&(ue[ce]=$[ce]);var ye=arguments.length-2;if(ye===1)ue.children=ie;else if(1<ye){for(var Le=Array(ye),_e=0;_e<ye;_e++)Le[_e]=arguments[_e+2];ue.children=Le}if(D&&D.defaultProps)for(ce in ye=D.defaultProps,ye)ue[ce]===void 0&&(ue[ce]=ye[ce]);return{$$typeof:n,type:D,key:fe,ref:Ee,props:ue,_owner:F.current}}function O(D,$){return{$$typeof:n,type:D.type,key:$,ref:D.ref,props:D.props,_owner:D._owner}}function M(D){return typeof D=="object"&&D!==null&&D.$$typeof===n}function H(D){var $={"=":"=0",":":"=2"};return"$"+D.replace(/[=:]/g,function(ie){return $[ie]})}var Z=/\/+/g;function se(D,$){return typeof D=="object"&&D!==null&&D.key!=null?H(""+D.key):$.toString(36)}function U(D,$,ie,ce,ue){var fe=typeof D;(fe==="undefined"||fe==="boolean")&&(D=null);var Ee=!1;if(D===null)Ee=!0;else switch(fe){case"string":case"number":Ee=!0;break;case"object":switch(D.$$typeof){case n:case e:Ee=!0}}if(Ee)return Ee=D,ue=ue(Ee),D=ce===""?"."+se(Ee,0):ce,I(ue)?(ie="",D!=null&&(ie=D.replace(Z,"$&/")+"/"),U(ue,$,ie,"",function(_e){return _e})):ue!=null&&(M(ue)&&(ue=O(ue,ie+(!ue.key||Ee&&Ee.key===ue.key?"":(""+ue.key).replace(Z,"$&/")+"/")+D)),$.push(ue)),1;if(Ee=0,ce=ce===""?".":ce+":",I(D))for(var ye=0;ye<D.length;ye++){fe=D[ye];var Le=ce+se(fe,ye);Ee+=U(fe,$,ie,Le,ue)}else if(Le=p(D),typeof Le=="function")for(D=Le.call(D),ye=0;!(fe=D.next()).done;)fe=fe.value,Le=ce+se(fe,ye++),Ee+=U(fe,$,ie,Le,ue);else if(fe==="object")throw $=String(D),Error("Objects are not valid as a React child (found: "+($==="[object Object]"?"object with keys {"+Object.keys(D).join(", ")+"}":$)+"). If you meant to render a collection of children, use an array instead.");return Ee}function ne(D,$,ie){if(D==null)return D;var ce=[],ue=0;return U(D,ce,"","",function(fe){return $.call(ie,fe,ue++)}),ce}function q(D){if(D._status===-1){var $=D._result;$=$(),$.then(function(ie){(D._status===0||D._status===-1)&&(D._status=1,D._result=ie)},function(ie){(D._status===0||D._status===-1)&&(D._status=2,D._result=ie)}),D._status===-1&&(D._status=0,D._result=$)}if(D._status===1)return D._result.default;throw D._result}var te={current:null},G={transition:null},Q={ReactCurrentDispatcher:te,ReactCurrentBatchConfig:G,ReactCurrentOwner:F};function ee(){throw Error("act(...) is not supported in production builds of React.")}return Ve.Children={map:ne,forEach:function(D,$,ie){ne(D,function(){$.apply(this,arguments)},ie)},count:function(D){var $=0;return ne(D,function(){$++}),$},toArray:function(D){return ne(D,function($){return $})||[]},only:function(D){if(!M(D))throw Error("React.Children.only expected to receive a single React element child.");return D}},Ve.Component=v,Ve.Fragment=t,Ve.Profiler=s,Ve.PureComponent=A,Ve.StrictMode=r,Ve.Suspense=u,Ve.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Q,Ve.act=ee,Ve.cloneElement=function(D,$,ie){if(D==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+D+".");var ce=g({},D.props),ue=D.key,fe=D.ref,Ee=D._owner;if($!=null){if($.ref!==void 0&&(fe=$.ref,Ee=F.current),$.key!==void 0&&(ue=""+$.key),D.type&&D.type.defaultProps)var ye=D.type.defaultProps;for(Le in $)_.call($,Le)&&!C.hasOwnProperty(Le)&&(ce[Le]=$[Le]===void 0&&ye!==void 0?ye[Le]:$[Le])}var Le=arguments.length-2;if(Le===1)ce.children=ie;else if(1<Le){ye=Array(Le);for(var _e=0;_e<Le;_e++)ye[_e]=arguments[_e+2];ce.children=ye}return{$$typeof:n,type:D.type,key:ue,ref:fe,props:ce,_owner:Ee}},Ve.createContext=function(D){return D={$$typeof:o,_currentValue:D,_currentValue2:D,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},D.Provider={$$typeof:i,_context:D},D.Consumer=D},Ve.createElement=P,Ve.createFactory=function(D){var $=P.bind(null,D);return $.type=D,$},Ve.createRef=function(){return{current:null}},Ve.forwardRef=function(D){return{$$typeof:l,render:D}},Ve.isValidElement=M,Ve.lazy=function(D){return{$$typeof:f,_payload:{_status:-1,_result:D},_init:q}},Ve.memo=function(D,$){return{$$typeof:d,type:D,compare:$===void 0?null:$}},Ve.startTransition=function(D){var $=G.transition;G.transition={};try{D()}finally{G.transition=$}},Ve.unstable_act=ee,Ve.useCallback=function(D,$){return te.current.useCallback(D,$)},Ve.useContext=function(D){return te.current.useContext(D)},Ve.useDebugValue=function(){},Ve.useDeferredValue=function(D){return te.current.useDeferredValue(D)},Ve.useEffect=function(D,$){return te.current.useEffect(D,$)},Ve.useId=function(){return te.current.useId()},Ve.useImperativeHandle=function(D,$,ie){return te.current.useImperativeHandle(D,$,ie)},Ve.useInsertionEffect=function(D,$){return te.current.useInsertionEffect(D,$)},Ve.useLayoutEffect=function(D,$){return te.current.useLayoutEffect(D,$)},Ve.useMemo=function(D,$){return te.current.useMemo(D,$)},Ve.useReducer=function(D,$,ie){return te.current.useReducer(D,$,ie)},Ve.useRef=function(D){return te.current.useRef(D)},Ve.useState=function(D){return te.current.useState(D)},Ve.useSyncExternalStore=function(D,$,ie){return te.current.useSyncExternalStore(D,$,ie)},Ve.useTransition=function(){return te.current.useTransition()},Ve.version="18.3.1",Ve}var By;function Na(){return By||(By=1,Bf.exports=CL()),Bf.exports}var Uy;function _L(){if(Uy)return Xo;Uy=1;var n=Na(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,s=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function o(l,u,d){var f,h={},p=null,x=null;d!==void 0&&(p=""+d),u.key!==void 0&&(p=""+u.key),u.ref!==void 0&&(x=u.ref);for(f in u)r.call(u,f)&&!i.hasOwnProperty(f)&&(h[f]=u[f]);if(l&&l.defaultProps)for(f in u=l.defaultProps,u)h[f]===void 0&&(h[f]=u[f]);return{$$typeof:e,type:l,key:p,ref:x,props:h,_owner:s.current}}return Xo.Fragment=t,Xo.jsx=o,Xo.jsxs=o,Xo}var $y;function PL(){return $y||($y=1,Ff.exports=_L()),Ff.exports}var S=PL(),N=Na();const Rn=lE(N);var oc={},Uf={exports:{}},ln={},$f={exports:{}},jf={};var jy;function DL(){return jy||(jy=1,(function(n){function e(G,Q){var ee=G.length;G.push(Q);e:for(;0<ee;){var D=ee-1>>>1,$=G[D];if(0<s($,Q))G[D]=Q,G[ee]=$,ee=D;else break e}}function t(G){return G.length===0?null:G[0]}function r(G){if(G.length===0)return null;var Q=G[0],ee=G.pop();if(ee!==Q){G[0]=ee;e:for(var D=0,$=G.length,ie=$>>>1;D<ie;){var ce=2*(D+1)-1,ue=G[ce],fe=ce+1,Ee=G[fe];if(0>s(ue,ee))fe<$&&0>s(Ee,ue)?(G[D]=Ee,G[fe]=ee,D=fe):(G[D]=ue,G[ce]=ee,D=ce);else if(fe<$&&0>s(Ee,ee))G[D]=Ee,G[fe]=ee,D=fe;else break e}}return Q}function s(G,Q){var ee=G.sortIndex-Q.sortIndex;return ee!==0?ee:G.id-Q.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,l=o.now();n.unstable_now=function(){return o.now()-l}}var u=[],d=[],f=1,h=null,p=3,x=!1,g=!1,E=!1,v=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function L(G){for(var Q=t(d);Q!==null;){if(Q.callback===null)r(d);else if(Q.startTime<=G)r(d),Q.sortIndex=Q.expirationTime,e(u,Q);else break;Q=t(d)}}function I(G){if(E=!1,L(G),!g)if(t(u)!==null)g=!0,q(_);else{var Q=t(d);Q!==null&&te(I,Q.startTime-G)}}function _(G,Q){g=!1,E&&(E=!1,b(P),P=-1),x=!0;var ee=p;try{for(L(Q),h=t(u);h!==null&&(!(h.expirationTime>Q)||G&&!H());){var D=h.callback;if(typeof D=="function"){h.callback=null,p=h.priorityLevel;var $=D(h.expirationTime<=Q);Q=n.unstable_now(),typeof $=="function"?h.callback=$:h===t(u)&&r(u),L(Q)}else r(u);h=t(u)}if(h!==null)var ie=!0;else{var ce=t(d);ce!==null&&te(I,ce.startTime-Q),ie=!1}return ie}finally{h=null,p=ee,x=!1}}var F=!1,C=null,P=-1,O=5,M=-1;function H(){return!(n.unstable_now()-M<O)}function Z(){if(C!==null){var G=n.unstable_now();M=G;var Q=!0;try{Q=C(!0,G)}finally{Q?se():(F=!1,C=null)}}else F=!1}var se;if(typeof A=="function")se=function(){A(Z)};else if(typeof MessageChannel<"u"){var U=new MessageChannel,ne=U.port2;U.port1.onmessage=Z,se=function(){ne.postMessage(null)}}else se=function(){v(Z,0)};function q(G){C=G,F||(F=!0,se())}function te(G,Q){P=v(function(){G(n.unstable_now())},Q)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(G){G.callback=null},n.unstable_continueExecution=function(){g||x||(g=!0,q(_))},n.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<G?Math.floor(1e3/G):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_getFirstCallbackNode=function(){return t(u)},n.unstable_next=function(G){switch(p){case 1:case 2:case 3:var Q=3;break;default:Q=p}var ee=p;p=Q;try{return G()}finally{p=ee}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(G,Q){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var ee=p;p=G;try{return Q()}finally{p=ee}},n.unstable_scheduleCallback=function(G,Q,ee){var D=n.unstable_now();switch(typeof ee=="object"&&ee!==null?(ee=ee.delay,ee=typeof ee=="number"&&0<ee?D+ee:D):ee=D,G){case 1:var $=-1;break;case 2:$=250;break;case 5:$=1073741823;break;case 4:$=1e4;break;default:$=5e3}return $=ee+$,G={id:f++,callback:Q,priorityLevel:G,startTime:ee,expirationTime:$,sortIndex:-1},ee>D?(G.sortIndex=ee,e(d,G),t(u)===null&&G===t(d)&&(E?(b(P),P=-1):E=!0,te(I,ee-D))):(G.sortIndex=$,e(u,G),g||x||(g=!0,q(_))),G},n.unstable_shouldYield=H,n.unstable_wrapCallback=function(G){var Q=p;return function(){var ee=p;p=Q;try{return G.apply(this,arguments)}finally{p=ee}}}})(jf)),jf}var Vy;function NL(){return Vy||(Vy=1,$f.exports=DL()),$f.exports}var Gy;function OL(){if(Gy)return ln;Gy=1;var n=Na(),e=NL();function t(a){for(var c="https://reactjs.org/docs/error-decoder.html?invariant="+a,m=1;m<arguments.length;m++)c+="&args[]="+encodeURIComponent(arguments[m]);return"Minified React error #"+a+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,s={};function i(a,c){o(a,c),o(a+"Capture",c)}function o(a,c){for(s[a]=c,a=0;a<c.length;a++)r.add(c[a])}var l=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),u=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},h={};function p(a){return u.call(h,a)?!0:u.call(f,a)?!1:d.test(a)?h[a]=!0:(f[a]=!0,!1)}function x(a,c,m,y){if(m!==null&&m.type===0)return!1;switch(typeof c){case"function":case"symbol":return!0;case"boolean":return y?!1:m!==null?!m.acceptsBooleans:(a=a.toLowerCase().slice(0,5),a!=="data-"&&a!=="aria-");default:return!1}}function g(a,c,m,y){if(c===null||typeof c>"u"||x(a,c,m,y))return!0;if(y)return!1;if(m!==null)switch(m.type){case 3:return!c;case 4:return c===!1;case 5:return isNaN(c);case 6:return isNaN(c)||1>c}return!1}function E(a,c,m,y,T,w,k){this.acceptsBooleans=c===2||c===3||c===4,this.attributeName=y,this.attributeNamespace=T,this.mustUseProperty=m,this.propertyName=a,this.type=c,this.sanitizeURL=w,this.removeEmptyString=k}var v={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){v[a]=new E(a,0,!1,a,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var c=a[0];v[c]=new E(c,1,!1,a[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(a){v[a]=new E(a,2,!1,a.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){v[a]=new E(a,2,!1,a,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){v[a]=new E(a,3,!1,a.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(a){v[a]=new E(a,3,!0,a,null,!1,!1)}),["capture","download"].forEach(function(a){v[a]=new E(a,4,!1,a,null,!1,!1)}),["cols","rows","size","span"].forEach(function(a){v[a]=new E(a,6,!1,a,null,!1,!1)}),["rowSpan","start"].forEach(function(a){v[a]=new E(a,5,!1,a.toLowerCase(),null,!1,!1)});var b=/[\-:]([a-z])/g;function A(a){return a[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var c=a.replace(b,A);v[c]=new E(c,1,!1,a,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var c=a.replace(b,A);v[c]=new E(c,1,!1,a,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(a){var c=a.replace(b,A);v[c]=new E(c,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(a){v[a]=new E(a,1,!1,a.toLowerCase(),null,!1,!1)}),v.xlinkHref=new E("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(a){v[a]=new E(a,1,!1,a.toLowerCase(),null,!0,!0)});function L(a,c,m,y){var T=v.hasOwnProperty(c)?v[c]:null;(T!==null?T.type!==0:y||!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(g(c,m,T,y)&&(m=null),y||T===null?p(c)&&(m===null?a.removeAttribute(c):a.setAttribute(c,""+m)):T.mustUseProperty?a[T.propertyName]=m===null?T.type===3?!1:"":m:(c=T.attributeName,y=T.attributeNamespace,m===null?a.removeAttribute(c):(T=T.type,m=T===3||T===4&&m===!0?"":""+m,y?a.setAttributeNS(y,c,m):a.setAttribute(c,m))))}var I=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,_=Symbol.for("react.element"),F=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),P=Symbol.for("react.strict_mode"),O=Symbol.for("react.profiler"),M=Symbol.for("react.provider"),H=Symbol.for("react.context"),Z=Symbol.for("react.forward_ref"),se=Symbol.for("react.suspense"),U=Symbol.for("react.suspense_list"),ne=Symbol.for("react.memo"),q=Symbol.for("react.lazy"),te=Symbol.for("react.offscreen"),G=Symbol.iterator;function Q(a){return a===null||typeof a!="object"?null:(a=G&&a[G]||a["@@iterator"],typeof a=="function"?a:null)}var ee=Object.assign,D;function $(a){if(D===void 0)try{throw Error()}catch(m){var c=m.stack.trim().match(/\n( *(at )?)/);D=c&&c[1]||""}return`
`+D+a}var ie=!1;function ce(a,c){if(!a||ie)return"";ie=!0;var m=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(c)if(c=function(){throw Error()},Object.defineProperty(c.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(c,[])}catch(X){var y=X}Reflect.construct(a,[],c)}else{try{c.call()}catch(X){y=X}a.call(c.prototype)}else{try{throw Error()}catch(X){y=X}a()}}catch(X){if(X&&y&&typeof X.stack=="string"){for(var T=X.stack.split(`
`),w=y.stack.split(`
`),k=T.length-1,B=w.length-1;1<=k&&0<=B&&T[k]!==w[B];)B--;for(;1<=k&&0<=B;k--,B--)if(T[k]!==w[B]){if(k!==1||B!==1)do if(k--,B--,0>B||T[k]!==w[B]){var j=`
`+T[k].replace(" at new "," at ");return a.displayName&&j.includes("<anonymous>")&&(j=j.replace("<anonymous>",a.displayName)),j}while(1<=k&&0<=B);break}}}finally{ie=!1,Error.prepareStackTrace=m}return(a=a?a.displayName||a.name:"")?$(a):""}function ue(a){switch(a.tag){case 5:return $(a.type);case 16:return $("Lazy");case 13:return $("Suspense");case 19:return $("SuspenseList");case 0:case 2:case 15:return a=ce(a.type,!1),a;case 11:return a=ce(a.type.render,!1),a;case 1:return a=ce(a.type,!0),a;default:return""}}function fe(a){if(a==null)return null;if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case C:return"Fragment";case F:return"Portal";case O:return"Profiler";case P:return"StrictMode";case se:return"Suspense";case U:return"SuspenseList"}if(typeof a=="object")switch(a.$$typeof){case H:return(a.displayName||"Context")+".Consumer";case M:return(a._context.displayName||"Context")+".Provider";case Z:var c=a.render;return a=a.displayName,a||(a=c.displayName||c.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case ne:return c=a.displayName||null,c!==null?c:fe(a.type)||"Memo";case q:c=a._payload,a=a._init;try{return fe(a(c))}catch{}}return null}function Ee(a){var c=a.type;switch(a.tag){case 24:return"Cache";case 9:return(c.displayName||"Context")+".Consumer";case 10:return(c._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return a=c.render,a=a.displayName||a.name||"",c.displayName||(a!==""?"ForwardRef("+a+")":"ForwardRef");case 7:return"Fragment";case 5:return c;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return fe(c);case 8:return c===P?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof c=="function")return c.displayName||c.name||null;if(typeof c=="string")return c}return null}function ye(a){switch(typeof a){case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function Le(a){var c=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function _e(a){var c=Le(a)?"checked":"value",m=Object.getOwnPropertyDescriptor(a.constructor.prototype,c),y=""+a[c];if(!a.hasOwnProperty(c)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var T=m.get,w=m.set;return Object.defineProperty(a,c,{configurable:!0,get:function(){return T.call(this)},set:function(k){y=""+k,w.call(this,k)}}),Object.defineProperty(a,c,{enumerable:m.enumerable}),{getValue:function(){return y},setValue:function(k){y=""+k},stopTracking:function(){a._valueTracker=null,delete a[c]}}}}function Pe(a){a._valueTracker||(a._valueTracker=_e(a))}function Te(a){if(!a)return!1;var c=a._valueTracker;if(!c)return!0;var m=c.getValue(),y="";return a&&(y=Le(a)?a.checked?"true":"false":a.value),a=y,a!==m?(c.setValue(a),!0):!1}function ve(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}function Re(a,c){var m=c.checked;return ee({},c,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:m??a._wrapperState.initialChecked})}function $e(a,c){var m=c.defaultValue==null?"":c.defaultValue,y=c.checked!=null?c.checked:c.defaultChecked;m=ye(c.value!=null?c.value:m),a._wrapperState={initialChecked:y,initialValue:m,controlled:c.type==="checkbox"||c.type==="radio"?c.checked!=null:c.value!=null}}function me(a,c){c=c.checked,c!=null&&L(a,"checked",c,!1)}function Me(a,c){me(a,c);var m=ye(c.value),y=c.type;if(m!=null)y==="number"?(m===0&&a.value===""||a.value!=m)&&(a.value=""+m):a.value!==""+m&&(a.value=""+m);else if(y==="submit"||y==="reset"){a.removeAttribute("value");return}c.hasOwnProperty("value")?je(a,c.type,m):c.hasOwnProperty("defaultValue")&&je(a,c.type,ye(c.defaultValue)),c.checked==null&&c.defaultChecked!=null&&(a.defaultChecked=!!c.defaultChecked)}function qe(a,c,m){if(c.hasOwnProperty("value")||c.hasOwnProperty("defaultValue")){var y=c.type;if(!(y!=="submit"&&y!=="reset"||c.value!==void 0&&c.value!==null))return;c=""+a._wrapperState.initialValue,m||c===a.value||(a.value=c),a.defaultValue=c}m=a.name,m!==""&&(a.name=""),a.defaultChecked=!!a._wrapperState.initialChecked,m!==""&&(a.name=m)}function je(a,c,m){(c!=="number"||ve(a.ownerDocument)!==a)&&(m==null?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+m&&(a.defaultValue=""+m))}var Be=Array.isArray;function Xe(a,c,m,y){if(a=a.options,c){c={};for(var T=0;T<m.length;T++)c["$"+m[T]]=!0;for(m=0;m<a.length;m++)T=c.hasOwnProperty("$"+a[m].value),a[m].selected!==T&&(a[m].selected=T),T&&y&&(a[m].defaultSelected=!0)}else{for(m=""+ye(m),c=null,T=0;T<a.length;T++){if(a[T].value===m){a[T].selected=!0,y&&(a[T].defaultSelected=!0);return}c!==null||a[T].disabled||(c=a[T])}c!==null&&(c.selected=!0)}}function _t(a,c){if(c.dangerouslySetInnerHTML!=null)throw Error(t(91));return ee({},c,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}function _n(a,c){var m=c.value;if(m==null){if(m=c.children,c=c.defaultValue,m!=null){if(c!=null)throw Error(t(92));if(Be(m)){if(1<m.length)throw Error(t(93));m=m[0]}c=m}c==null&&(c=""),m=c}a._wrapperState={initialValue:ye(m)}}function pn(a,c){var m=ye(c.value),y=ye(c.defaultValue);m!=null&&(m=""+m,m!==a.value&&(a.value=m),c.defaultValue==null&&a.defaultValue!==m&&(a.defaultValue=m)),y!=null&&(a.defaultValue=""+y)}function vt(a){var c=a.textContent;c===a._wrapperState.initialValue&&c!==""&&c!==null&&(a.value=c)}function wt(a){switch(a){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function gn(a,c){return a==null||a==="http://www.w3.org/1999/xhtml"?wt(c):a==="http://www.w3.org/2000/svg"&&c==="foreignObject"?"http://www.w3.org/1999/xhtml":a}var sr,yn=(function(a){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(c,m,y,T){MSApp.execUnsafeLocalFunction(function(){return a(c,m,y,T)})}:a})(function(a,c){if(a.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in a)a.innerHTML=c;else{for(sr=sr||document.createElement("div"),sr.innerHTML="<svg>"+c.valueOf().toString()+"</svg>",c=sr.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;c.firstChild;)a.appendChild(c.firstChild)}});function Xt(a,c){if(c){var m=a.firstChild;if(m&&m===a.lastChild&&m.nodeType===3){m.nodeValue=c;return}}a.textContent=c}var Qt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},io=["Webkit","ms","Moz","O"];Object.keys(Qt).forEach(function(a){io.forEach(function(c){c=c+a.charAt(0).toUpperCase()+a.substring(1),Qt[c]=Qt[a]})});function Cs(a,c,m){return c==null||typeof c=="boolean"||c===""?"":m||typeof c!="number"||c===0||Qt.hasOwnProperty(a)&&Qt[a]?(""+c).trim():c+"px"}function Xa(a,c){a=a.style;for(var m in c)if(c.hasOwnProperty(m)){var y=m.indexOf("--")===0,T=Cs(m,c[m],y);m==="float"&&(m="cssFloat"),y?a.setProperty(m,T):a[m]=T}}var Ju=ee({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function oo(a,c){if(c){if(Ju[a]&&(c.children!=null||c.dangerouslySetInnerHTML!=null))throw Error(t(137,a));if(c.dangerouslySetInnerHTML!=null){if(c.children!=null)throw Error(t(60));if(typeof c.dangerouslySetInnerHTML!="object"||!("__html"in c.dangerouslySetInnerHTML))throw Error(t(61))}if(c.style!=null&&typeof c.style!="object")throw Error(t(62))}}function ao(a,c){if(a.indexOf("-")===-1)return typeof c.is=="string";switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var lo=null;function di(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var co=null,Ar=null,Lr=null;function uo(a){if(a=Oo(a)){if(typeof co!="function")throw Error(t(280));var c=a.stateNode;c&&(c=El(c),co(a.stateNode,a.type,c))}}function Qa(a){Ar?Lr?Lr.push(a):Lr=[a]:Ar=a}function fo(){if(Ar){var a=Ar,c=Lr;if(Lr=Ar=null,uo(a),c)for(a=0;a<c.length;a++)uo(c[a])}}function ho(a,c){return a(c)}function Ja(){}var Zu=!1;function ig(a,c,m){if(Zu)return a(c,m);Zu=!0;try{return ho(a,c,m)}finally{Zu=!1,(Ar!==null||Lr!==null)&&(Ja(),fo())}}function mo(a,c){var m=a.stateNode;if(m===null)return null;var y=El(m);if(y===null)return null;m=y[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(y=!y.disabled)||(a=a.type,y=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!y;break e;default:a=!1}if(a)return null;if(m&&typeof m!="function")throw Error(t(231,c,typeof m));return m}var ed=!1;if(l)try{var po={};Object.defineProperty(po,"passive",{get:function(){ed=!0}}),window.addEventListener("test",po,po),window.removeEventListener("test",po,po)}catch{ed=!1}function Mw(a,c,m,y,T,w,k,B,j){var X=Array.prototype.slice.call(arguments,3);try{c.apply(m,X)}catch(ae){this.onError(ae)}}var go=!1,Za=null,el=!1,td=null,Fw={onError:function(a){go=!0,Za=a}};function Bw(a,c,m,y,T,w,k,B,j){go=!1,Za=null,Mw.apply(Fw,arguments)}function Uw(a,c,m,y,T,w,k,B,j){if(Bw.apply(this,arguments),go){if(go){var X=Za;go=!1,Za=null}else throw Error(t(198));el||(el=!0,td=X)}}function _s(a){var c=a,m=a;if(a.alternate)for(;c.return;)c=c.return;else{a=c;do c=a,(c.flags&4098)!==0&&(m=c.return),a=c.return;while(a)}return c.tag===3?m:null}function og(a){if(a.tag===13){var c=a.memoizedState;if(c===null&&(a=a.alternate,a!==null&&(c=a.memoizedState)),c!==null)return c.dehydrated}return null}function ag(a){if(_s(a)!==a)throw Error(t(188))}function $w(a){var c=a.alternate;if(!c){if(c=_s(a),c===null)throw Error(t(188));return c!==a?null:a}for(var m=a,y=c;;){var T=m.return;if(T===null)break;var w=T.alternate;if(w===null){if(y=T.return,y!==null){m=y;continue}break}if(T.child===w.child){for(w=T.child;w;){if(w===m)return ag(T),a;if(w===y)return ag(T),c;w=w.sibling}throw Error(t(188))}if(m.return!==y.return)m=T,y=w;else{for(var k=!1,B=T.child;B;){if(B===m){k=!0,m=T,y=w;break}if(B===y){k=!0,y=T,m=w;break}B=B.sibling}if(!k){for(B=w.child;B;){if(B===m){k=!0,m=w,y=T;break}if(B===y){k=!0,y=w,m=T;break}B=B.sibling}if(!k)throw Error(t(189))}}if(m.alternate!==y)throw Error(t(190))}if(m.tag!==3)throw Error(t(188));return m.stateNode.current===m?a:c}function lg(a){return a=$w(a),a!==null?cg(a):null}function cg(a){if(a.tag===5||a.tag===6)return a;for(a=a.child;a!==null;){var c=cg(a);if(c!==null)return c;a=a.sibling}return null}var ug=e.unstable_scheduleCallback,dg=e.unstable_cancelCallback,jw=e.unstable_shouldYield,Vw=e.unstable_requestPaint,St=e.unstable_now,Gw=e.unstable_getCurrentPriorityLevel,nd=e.unstable_ImmediatePriority,fg=e.unstable_UserBlockingPriority,tl=e.unstable_NormalPriority,Hw=e.unstable_LowPriority,hg=e.unstable_IdlePriority,nl=null,ir=null;function Kw(a){if(ir&&typeof ir.onCommitFiberRoot=="function")try{ir.onCommitFiberRoot(nl,a,void 0,(a.current.flags&128)===128)}catch{}}var Gn=Math.clz32?Math.clz32:Yw,zw=Math.log,Ww=Math.LN2;function Yw(a){return a>>>=0,a===0?32:31-(zw(a)/Ww|0)|0}var rl=64,sl=4194304;function yo(a){switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return a&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return a}}function il(a,c){var m=a.pendingLanes;if(m===0)return 0;var y=0,T=a.suspendedLanes,w=a.pingedLanes,k=m&268435455;if(k!==0){var B=k&~T;B!==0?y=yo(B):(w&=k,w!==0&&(y=yo(w)))}else k=m&~T,k!==0?y=yo(k):w!==0&&(y=yo(w));if(y===0)return 0;if(c!==0&&c!==y&&(c&T)===0&&(T=y&-y,w=c&-c,T>=w||T===16&&(w&4194240)!==0))return c;if((y&4)!==0&&(y|=m&16),c=a.entangledLanes,c!==0)for(a=a.entanglements,c&=y;0<c;)m=31-Gn(c),T=1<<m,y|=a[m],c&=~T;return y}function qw(a,c){switch(a){case 1:case 2:case 4:return c+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Xw(a,c){for(var m=a.suspendedLanes,y=a.pingedLanes,T=a.expirationTimes,w=a.pendingLanes;0<w;){var k=31-Gn(w),B=1<<k,j=T[k];j===-1?((B&m)===0||(B&y)!==0)&&(T[k]=qw(B,c)):j<=c&&(a.expiredLanes|=B),w&=~B}}function rd(a){return a=a.pendingLanes&-1073741825,a!==0?a:a&1073741824?1073741824:0}function mg(){var a=rl;return rl<<=1,(rl&4194240)===0&&(rl=64),a}function sd(a){for(var c=[],m=0;31>m;m++)c.push(a);return c}function xo(a,c,m){a.pendingLanes|=c,c!==536870912&&(a.suspendedLanes=0,a.pingedLanes=0),a=a.eventTimes,c=31-Gn(c),a[c]=m}function Qw(a,c){var m=a.pendingLanes&~c;a.pendingLanes=c,a.suspendedLanes=0,a.pingedLanes=0,a.expiredLanes&=c,a.mutableReadLanes&=c,a.entangledLanes&=c,c=a.entanglements;var y=a.eventTimes;for(a=a.expirationTimes;0<m;){var T=31-Gn(m),w=1<<T;c[T]=0,y[T]=-1,a[T]=-1,m&=~w}}function id(a,c){var m=a.entangledLanes|=c;for(a=a.entanglements;m;){var y=31-Gn(m),T=1<<y;T&c|a[y]&c&&(a[y]|=c),m&=~T}}var Qe=0;function pg(a){return a&=-a,1<a?4<a?(a&268435455)!==0?16:536870912:4:1}var gg,od,yg,xg,vg,ad=!1,ol=[],qr=null,Xr=null,Qr=null,vo=new Map,So=new Map,Jr=[],Jw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sg(a,c){switch(a){case"focusin":case"focusout":qr=null;break;case"dragenter":case"dragleave":Xr=null;break;case"mouseover":case"mouseout":Qr=null;break;case"pointerover":case"pointerout":vo.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":So.delete(c.pointerId)}}function Eo(a,c,m,y,T,w){return a===null||a.nativeEvent!==w?(a={blockedOn:c,domEventName:m,eventSystemFlags:y,nativeEvent:w,targetContainers:[T]},c!==null&&(c=Oo(c),c!==null&&od(c)),a):(a.eventSystemFlags|=y,c=a.targetContainers,T!==null&&c.indexOf(T)===-1&&c.push(T),a)}function Zw(a,c,m,y,T){switch(c){case"focusin":return qr=Eo(qr,a,c,m,y,T),!0;case"dragenter":return Xr=Eo(Xr,a,c,m,y,T),!0;case"mouseover":return Qr=Eo(Qr,a,c,m,y,T),!0;case"pointerover":var w=T.pointerId;return vo.set(w,Eo(vo.get(w)||null,a,c,m,y,T)),!0;case"gotpointercapture":return w=T.pointerId,So.set(w,Eo(So.get(w)||null,a,c,m,y,T)),!0}return!1}function Eg(a){var c=Ps(a.target);if(c!==null){var m=_s(c);if(m!==null){if(c=m.tag,c===13){if(c=og(m),c!==null){a.blockedOn=c,vg(a.priority,function(){yg(m)});return}}else if(c===3&&m.stateNode.current.memoizedState.isDehydrated){a.blockedOn=m.tag===3?m.stateNode.containerInfo:null;return}}}a.blockedOn=null}function al(a){if(a.blockedOn!==null)return!1;for(var c=a.targetContainers;0<c.length;){var m=cd(a.domEventName,a.eventSystemFlags,c[0],a.nativeEvent);if(m===null){m=a.nativeEvent;var y=new m.constructor(m.type,m);lo=y,m.target.dispatchEvent(y),lo=null}else return c=Oo(m),c!==null&&od(c),a.blockedOn=m,!1;c.shift()}return!0}function Tg(a,c,m){al(a)&&m.delete(c)}function eA(){ad=!1,qr!==null&&al(qr)&&(qr=null),Xr!==null&&al(Xr)&&(Xr=null),Qr!==null&&al(Qr)&&(Qr=null),vo.forEach(Tg),So.forEach(Tg)}function To(a,c){a.blockedOn===c&&(a.blockedOn=null,ad||(ad=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,eA)))}function bo(a){function c(T){return To(T,a)}if(0<ol.length){To(ol[0],a);for(var m=1;m<ol.length;m++){var y=ol[m];y.blockedOn===a&&(y.blockedOn=null)}}for(qr!==null&&To(qr,a),Xr!==null&&To(Xr,a),Qr!==null&&To(Qr,a),vo.forEach(c),So.forEach(c),m=0;m<Jr.length;m++)y=Jr[m],y.blockedOn===a&&(y.blockedOn=null);for(;0<Jr.length&&(m=Jr[0],m.blockedOn===null);)Eg(m),m.blockedOn===null&&Jr.shift()}var fi=I.ReactCurrentBatchConfig,ll=!0;function tA(a,c,m,y){var T=Qe,w=fi.transition;fi.transition=null;try{Qe=1,ld(a,c,m,y)}finally{Qe=T,fi.transition=w}}function nA(a,c,m,y){var T=Qe,w=fi.transition;fi.transition=null;try{Qe=4,ld(a,c,m,y)}finally{Qe=T,fi.transition=w}}function ld(a,c,m,y){if(ll){var T=cd(a,c,m,y);if(T===null)Ld(a,c,y,cl,m),Sg(a,y);else if(Zw(T,a,c,m,y))y.stopPropagation();else if(Sg(a,y),c&4&&-1<Jw.indexOf(a)){for(;T!==null;){var w=Oo(T);if(w!==null&&gg(w),w=cd(a,c,m,y),w===null&&Ld(a,c,y,cl,m),w===T)break;T=w}T!==null&&y.stopPropagation()}else Ld(a,c,y,null,m)}}var cl=null;function cd(a,c,m,y){if(cl=null,a=di(y),a=Ps(a),a!==null)if(c=_s(a),c===null)a=null;else if(m=c.tag,m===13){if(a=og(c),a!==null)return a;a=null}else if(m===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;a=null}else c!==a&&(a=null);return cl=a,null}function bg(a){switch(a){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Gw()){case nd:return 1;case fg:return 4;case tl:case Hw:return 16;case hg:return 536870912;default:return 16}default:return 16}}var Zr=null,ud=null,ul=null;function wg(){if(ul)return ul;var a,c=ud,m=c.length,y,T="value"in Zr?Zr.value:Zr.textContent,w=T.length;for(a=0;a<m&&c[a]===T[a];a++);var k=m-a;for(y=1;y<=k&&c[m-y]===T[w-y];y++);return ul=T.slice(a,1<y?1-y:void 0)}function dl(a){var c=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&c===13&&(a=13)):a=c,a===10&&(a=13),32<=a||a===13?a:0}function fl(){return!0}function Ag(){return!1}function xn(a){function c(m,y,T,w,k){this._reactName=m,this._targetInst=T,this.type=y,this.nativeEvent=w,this.target=k,this.currentTarget=null;for(var B in a)a.hasOwnProperty(B)&&(m=a[B],this[B]=m?m(w):w[B]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?fl:Ag,this.isPropagationStopped=Ag,this}return ee(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var m=this.nativeEvent;m&&(m.preventDefault?m.preventDefault():typeof m.returnValue!="unknown"&&(m.returnValue=!1),this.isDefaultPrevented=fl)},stopPropagation:function(){var m=this.nativeEvent;m&&(m.stopPropagation?m.stopPropagation():typeof m.cancelBubble!="unknown"&&(m.cancelBubble=!0),this.isPropagationStopped=fl)},persist:function(){},isPersistent:fl}),c}var hi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},dd=xn(hi),wo=ee({},hi,{view:0,detail:0}),rA=xn(wo),fd,hd,Ao,hl=ee({},wo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:pd,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Ao&&(Ao&&a.type==="mousemove"?(fd=a.screenX-Ao.screenX,hd=a.screenY-Ao.screenY):hd=fd=0,Ao=a),fd)},movementY:function(a){return"movementY"in a?a.movementY:hd}}),Lg=xn(hl),sA=ee({},hl,{dataTransfer:0}),iA=xn(sA),oA=ee({},wo,{relatedTarget:0}),md=xn(oA),aA=ee({},hi,{animationName:0,elapsedTime:0,pseudoElement:0}),lA=xn(aA),cA=ee({},hi,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),uA=xn(cA),dA=ee({},hi,{data:0}),Rg=xn(dA),fA={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hA={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},mA={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function pA(a){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(a):(a=mA[a])?!!c[a]:!1}function pd(){return pA}var gA=ee({},wo,{key:function(a){if(a.key){var c=fA[a.key]||a.key;if(c!=="Unidentified")return c}return a.type==="keypress"?(a=dl(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?hA[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:pd,charCode:function(a){return a.type==="keypress"?dl(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?dl(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),yA=xn(gA),xA=ee({},hl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ig=xn(xA),vA=ee({},wo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:pd}),SA=xn(vA),EA=ee({},hi,{propertyName:0,elapsedTime:0,pseudoElement:0}),TA=xn(EA),bA=ee({},hl,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),wA=xn(bA),AA=[9,13,27,32],gd=l&&"CompositionEvent"in window,Lo=null;l&&"documentMode"in document&&(Lo=document.documentMode);var LA=l&&"TextEvent"in window&&!Lo,kg=l&&(!gd||Lo&&8<Lo&&11>=Lo),Cg=" ",_g=!1;function Pg(a,c){switch(a){case"keyup":return AA.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Dg(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var mi=!1;function RA(a,c){switch(a){case"compositionend":return Dg(c);case"keypress":return c.which!==32?null:(_g=!0,Cg);case"textInput":return a=c.data,a===Cg&&_g?null:a;default:return null}}function IA(a,c){if(mi)return a==="compositionend"||!gd&&Pg(a,c)?(a=wg(),ul=ud=Zr=null,mi=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return kg&&c.locale!=="ko"?null:c.data;default:return null}}var kA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ng(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c==="input"?!!kA[a.type]:c==="textarea"}function Og(a,c,m,y){Qa(y),c=xl(c,"onChange"),0<c.length&&(m=new dd("onChange","change",null,m,y),a.push({event:m,listeners:c}))}var Ro=null,Io=null;function CA(a){Zg(a,0)}function ml(a){var c=vi(a);if(Te(c))return a}function _A(a,c){if(a==="change")return c}var Mg=!1;if(l){var yd;if(l){var xd="oninput"in document;if(!xd){var Fg=document.createElement("div");Fg.setAttribute("oninput","return;"),xd=typeof Fg.oninput=="function"}yd=xd}else yd=!1;Mg=yd&&(!document.documentMode||9<document.documentMode)}function Bg(){Ro&&(Ro.detachEvent("onpropertychange",Ug),Io=Ro=null)}function Ug(a){if(a.propertyName==="value"&&ml(Io)){var c=[];Og(c,Io,a,di(a)),ig(CA,c)}}function PA(a,c,m){a==="focusin"?(Bg(),Ro=c,Io=m,Ro.attachEvent("onpropertychange",Ug)):a==="focusout"&&Bg()}function DA(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return ml(Io)}function NA(a,c){if(a==="click")return ml(c)}function OA(a,c){if(a==="input"||a==="change")return ml(c)}function MA(a,c){return a===c&&(a!==0||1/a===1/c)||a!==a&&c!==c}var Hn=typeof Object.is=="function"?Object.is:MA;function ko(a,c){if(Hn(a,c))return!0;if(typeof a!="object"||a===null||typeof c!="object"||c===null)return!1;var m=Object.keys(a),y=Object.keys(c);if(m.length!==y.length)return!1;for(y=0;y<m.length;y++){var T=m[y];if(!u.call(c,T)||!Hn(a[T],c[T]))return!1}return!0}function $g(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function jg(a,c){var m=$g(a);a=0;for(var y;m;){if(m.nodeType===3){if(y=a+m.textContent.length,a<=c&&y>=c)return{node:m,offset:c-a};a=y}e:{for(;m;){if(m.nextSibling){m=m.nextSibling;break e}m=m.parentNode}m=void 0}m=$g(m)}}function Vg(a,c){return a&&c?a===c?!0:a&&a.nodeType===3?!1:c&&c.nodeType===3?Vg(a,c.parentNode):"contains"in a?a.contains(c):a.compareDocumentPosition?!!(a.compareDocumentPosition(c)&16):!1:!1}function Gg(){for(var a=window,c=ve();c instanceof a.HTMLIFrameElement;){try{var m=typeof c.contentWindow.location.href=="string"}catch{m=!1}if(m)a=c.contentWindow;else break;c=ve(a.document)}return c}function vd(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c&&(c==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||c==="textarea"||a.contentEditable==="true")}function FA(a){var c=Gg(),m=a.focusedElem,y=a.selectionRange;if(c!==m&&m&&m.ownerDocument&&Vg(m.ownerDocument.documentElement,m)){if(y!==null&&vd(m)){if(c=y.start,a=y.end,a===void 0&&(a=c),"selectionStart"in m)m.selectionStart=c,m.selectionEnd=Math.min(a,m.value.length);else if(a=(c=m.ownerDocument||document)&&c.defaultView||window,a.getSelection){a=a.getSelection();var T=m.textContent.length,w=Math.min(y.start,T);y=y.end===void 0?w:Math.min(y.end,T),!a.extend&&w>y&&(T=y,y=w,w=T),T=jg(m,w);var k=jg(m,y);T&&k&&(a.rangeCount!==1||a.anchorNode!==T.node||a.anchorOffset!==T.offset||a.focusNode!==k.node||a.focusOffset!==k.offset)&&(c=c.createRange(),c.setStart(T.node,T.offset),a.removeAllRanges(),w>y?(a.addRange(c),a.extend(k.node,k.offset)):(c.setEnd(k.node,k.offset),a.addRange(c)))}}for(c=[],a=m;a=a.parentNode;)a.nodeType===1&&c.push({element:a,left:a.scrollLeft,top:a.scrollTop});for(typeof m.focus=="function"&&m.focus(),m=0;m<c.length;m++)a=c[m],a.element.scrollLeft=a.left,a.element.scrollTop=a.top}}var BA=l&&"documentMode"in document&&11>=document.documentMode,pi=null,Sd=null,Co=null,Ed=!1;function Hg(a,c,m){var y=m.window===m?m.document:m.nodeType===9?m:m.ownerDocument;Ed||pi==null||pi!==ve(y)||(y=pi,"selectionStart"in y&&vd(y)?y={start:y.selectionStart,end:y.selectionEnd}:(y=(y.ownerDocument&&y.ownerDocument.defaultView||window).getSelection(),y={anchorNode:y.anchorNode,anchorOffset:y.anchorOffset,focusNode:y.focusNode,focusOffset:y.focusOffset}),Co&&ko(Co,y)||(Co=y,y=xl(Sd,"onSelect"),0<y.length&&(c=new dd("onSelect","select",null,c,m),a.push({event:c,listeners:y}),c.target=pi)))}function pl(a,c){var m={};return m[a.toLowerCase()]=c.toLowerCase(),m["Webkit"+a]="webkit"+c,m["Moz"+a]="moz"+c,m}var gi={animationend:pl("Animation","AnimationEnd"),animationiteration:pl("Animation","AnimationIteration"),animationstart:pl("Animation","AnimationStart"),transitionend:pl("Transition","TransitionEnd")},Td={},Kg={};l&&(Kg=document.createElement("div").style,"AnimationEvent"in window||(delete gi.animationend.animation,delete gi.animationiteration.animation,delete gi.animationstart.animation),"TransitionEvent"in window||delete gi.transitionend.transition);function gl(a){if(Td[a])return Td[a];if(!gi[a])return a;var c=gi[a],m;for(m in c)if(c.hasOwnProperty(m)&&m in Kg)return Td[a]=c[m];return a}var zg=gl("animationend"),Wg=gl("animationiteration"),Yg=gl("animationstart"),qg=gl("transitionend"),Xg=new Map,Qg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function es(a,c){Xg.set(a,c),i(c,[a])}for(var bd=0;bd<Qg.length;bd++){var wd=Qg[bd],UA=wd.toLowerCase(),$A=wd[0].toUpperCase()+wd.slice(1);es(UA,"on"+$A)}es(zg,"onAnimationEnd"),es(Wg,"onAnimationIteration"),es(Yg,"onAnimationStart"),es("dblclick","onDoubleClick"),es("focusin","onFocus"),es("focusout","onBlur"),es(qg,"onTransitionEnd"),o("onMouseEnter",["mouseout","mouseover"]),o("onMouseLeave",["mouseout","mouseover"]),o("onPointerEnter",["pointerout","pointerover"]),o("onPointerLeave",["pointerout","pointerover"]),i("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),i("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),i("onBeforeInput",["compositionend","keypress","textInput","paste"]),i("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var _o="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),jA=new Set("cancel close invalid load scroll toggle".split(" ").concat(_o));function Jg(a,c,m){var y=a.type||"unknown-event";a.currentTarget=m,Uw(y,c,void 0,a),a.currentTarget=null}function Zg(a,c){c=(c&4)!==0;for(var m=0;m<a.length;m++){var y=a[m],T=y.event;y=y.listeners;e:{var w=void 0;if(c)for(var k=y.length-1;0<=k;k--){var B=y[k],j=B.instance,X=B.currentTarget;if(B=B.listener,j!==w&&T.isPropagationStopped())break e;Jg(T,B,X),w=j}else for(k=0;k<y.length;k++){if(B=y[k],j=B.instance,X=B.currentTarget,B=B.listener,j!==w&&T.isPropagationStopped())break e;Jg(T,B,X),w=j}}}if(el)throw a=td,el=!1,td=null,a}function at(a,c){var m=c[Pd];m===void 0&&(m=c[Pd]=new Set);var y=a+"__bubble";m.has(y)||(e0(c,a,2,!1),m.add(y))}function Ad(a,c,m){var y=0;c&&(y|=4),e0(m,a,y,c)}var yl="_reactListening"+Math.random().toString(36).slice(2);function Po(a){if(!a[yl]){a[yl]=!0,r.forEach(function(m){m!=="selectionchange"&&(jA.has(m)||Ad(m,!1,a),Ad(m,!0,a))});var c=a.nodeType===9?a:a.ownerDocument;c===null||c[yl]||(c[yl]=!0,Ad("selectionchange",!1,c))}}function e0(a,c,m,y){switch(bg(c)){case 1:var T=tA;break;case 4:T=nA;break;default:T=ld}m=T.bind(null,c,m,a),T=void 0,!ed||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(T=!0),y?T!==void 0?a.addEventListener(c,m,{capture:!0,passive:T}):a.addEventListener(c,m,!0):T!==void 0?a.addEventListener(c,m,{passive:T}):a.addEventListener(c,m,!1)}function Ld(a,c,m,y,T){var w=y;if((c&1)===0&&(c&2)===0&&y!==null)e:for(;;){if(y===null)return;var k=y.tag;if(k===3||k===4){var B=y.stateNode.containerInfo;if(B===T||B.nodeType===8&&B.parentNode===T)break;if(k===4)for(k=y.return;k!==null;){var j=k.tag;if((j===3||j===4)&&(j=k.stateNode.containerInfo,j===T||j.nodeType===8&&j.parentNode===T))return;k=k.return}for(;B!==null;){if(k=Ps(B),k===null)return;if(j=k.tag,j===5||j===6){y=w=k;continue e}B=B.parentNode}}y=y.return}ig(function(){var X=w,ae=di(m),le=[];e:{var oe=Xg.get(a);if(oe!==void 0){var pe=dd,Se=a;switch(a){case"keypress":if(dl(m)===0)break e;case"keydown":case"keyup":pe=yA;break;case"focusin":Se="focus",pe=md;break;case"focusout":Se="blur",pe=md;break;case"beforeblur":case"afterblur":pe=md;break;case"click":if(m.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":pe=Lg;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":pe=iA;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":pe=SA;break;case zg:case Wg:case Yg:pe=lA;break;case qg:pe=TA;break;case"scroll":pe=rA;break;case"wheel":pe=wA;break;case"copy":case"cut":case"paste":pe=uA;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":pe=Ig}var be=(c&4)!==0,Et=!be&&a==="scroll",W=be?oe!==null?oe+"Capture":null:oe;be=[];for(var V=X,Y;V!==null;){Y=V;var de=Y.stateNode;if(Y.tag===5&&de!==null&&(Y=de,W!==null&&(de=mo(V,W),de!=null&&be.push(Do(V,de,Y)))),Et)break;V=V.return}0<be.length&&(oe=new pe(oe,Se,null,m,ae),le.push({event:oe,listeners:be}))}}if((c&7)===0){e:{if(oe=a==="mouseover"||a==="pointerover",pe=a==="mouseout"||a==="pointerout",oe&&m!==lo&&(Se=m.relatedTarget||m.fromElement)&&(Ps(Se)||Se[Rr]))break e;if((pe||oe)&&(oe=ae.window===ae?ae:(oe=ae.ownerDocument)?oe.defaultView||oe.parentWindow:window,pe?(Se=m.relatedTarget||m.toElement,pe=X,Se=Se?Ps(Se):null,Se!==null&&(Et=_s(Se),Se!==Et||Se.tag!==5&&Se.tag!==6)&&(Se=null)):(pe=null,Se=X),pe!==Se)){if(be=Lg,de="onMouseLeave",W="onMouseEnter",V="mouse",(a==="pointerout"||a==="pointerover")&&(be=Ig,de="onPointerLeave",W="onPointerEnter",V="pointer"),Et=pe==null?oe:vi(pe),Y=Se==null?oe:vi(Se),oe=new be(de,V+"leave",pe,m,ae),oe.target=Et,oe.relatedTarget=Y,de=null,Ps(ae)===X&&(be=new be(W,V+"enter",Se,m,ae),be.target=Y,be.relatedTarget=Et,de=be),Et=de,pe&&Se)t:{for(be=pe,W=Se,V=0,Y=be;Y;Y=yi(Y))V++;for(Y=0,de=W;de;de=yi(de))Y++;for(;0<V-Y;)be=yi(be),V--;for(;0<Y-V;)W=yi(W),Y--;for(;V--;){if(be===W||W!==null&&be===W.alternate)break t;be=yi(be),W=yi(W)}be=null}else be=null;pe!==null&&t0(le,oe,pe,be,!1),Se!==null&&Et!==null&&t0(le,Et,Se,be,!0)}}e:{if(oe=X?vi(X):window,pe=oe.nodeName&&oe.nodeName.toLowerCase(),pe==="select"||pe==="input"&&oe.type==="file")var Ae=_A;else if(Ng(oe))if(Mg)Ae=OA;else{Ae=DA;var Ie=PA}else(pe=oe.nodeName)&&pe.toLowerCase()==="input"&&(oe.type==="checkbox"||oe.type==="radio")&&(Ae=NA);if(Ae&&(Ae=Ae(a,X))){Og(le,Ae,m,ae);break e}Ie&&Ie(a,oe,X),a==="focusout"&&(Ie=oe._wrapperState)&&Ie.controlled&&oe.type==="number"&&je(oe,"number",oe.value)}switch(Ie=X?vi(X):window,a){case"focusin":(Ng(Ie)||Ie.contentEditable==="true")&&(pi=Ie,Sd=X,Co=null);break;case"focusout":Co=Sd=pi=null;break;case"mousedown":Ed=!0;break;case"contextmenu":case"mouseup":case"dragend":Ed=!1,Hg(le,m,ae);break;case"selectionchange":if(BA)break;case"keydown":case"keyup":Hg(le,m,ae)}var ke;if(gd)e:{switch(a){case"compositionstart":var De="onCompositionStart";break e;case"compositionend":De="onCompositionEnd";break e;case"compositionupdate":De="onCompositionUpdate";break e}De=void 0}else mi?Pg(a,m)&&(De="onCompositionEnd"):a==="keydown"&&m.keyCode===229&&(De="onCompositionStart");De&&(kg&&m.locale!=="ko"&&(mi||De!=="onCompositionStart"?De==="onCompositionEnd"&&mi&&(ke=wg()):(Zr=ae,ud="value"in Zr?Zr.value:Zr.textContent,mi=!0)),Ie=xl(X,De),0<Ie.length&&(De=new Rg(De,a,null,m,ae),le.push({event:De,listeners:Ie}),ke?De.data=ke:(ke=Dg(m),ke!==null&&(De.data=ke)))),(ke=LA?RA(a,m):IA(a,m))&&(X=xl(X,"onBeforeInput"),0<X.length&&(ae=new Rg("onBeforeInput","beforeinput",null,m,ae),le.push({event:ae,listeners:X}),ae.data=ke))}Zg(le,c)})}function Do(a,c,m){return{instance:a,listener:c,currentTarget:m}}function xl(a,c){for(var m=c+"Capture",y=[];a!==null;){var T=a,w=T.stateNode;T.tag===5&&w!==null&&(T=w,w=mo(a,m),w!=null&&y.unshift(Do(a,w,T)),w=mo(a,c),w!=null&&y.push(Do(a,w,T))),a=a.return}return y}function yi(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5);return a||null}function t0(a,c,m,y,T){for(var w=c._reactName,k=[];m!==null&&m!==y;){var B=m,j=B.alternate,X=B.stateNode;if(j!==null&&j===y)break;B.tag===5&&X!==null&&(B=X,T?(j=mo(m,w),j!=null&&k.unshift(Do(m,j,B))):T||(j=mo(m,w),j!=null&&k.push(Do(m,j,B)))),m=m.return}k.length!==0&&a.push({event:c,listeners:k})}var VA=/\r\n?/g,GA=/\u0000|\uFFFD/g;function n0(a){return(typeof a=="string"?a:""+a).replace(VA,`
`).replace(GA,"")}function vl(a,c,m){if(c=n0(c),n0(a)!==c&&m)throw Error(t(425))}function Sl(){}var Rd=null,Id=null;function kd(a,c){return a==="textarea"||a==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var Cd=typeof setTimeout=="function"?setTimeout:void 0,HA=typeof clearTimeout=="function"?clearTimeout:void 0,r0=typeof Promise=="function"?Promise:void 0,KA=typeof queueMicrotask=="function"?queueMicrotask:typeof r0<"u"?function(a){return r0.resolve(null).then(a).catch(zA)}:Cd;function zA(a){setTimeout(function(){throw a})}function _d(a,c){var m=c,y=0;do{var T=m.nextSibling;if(a.removeChild(m),T&&T.nodeType===8)if(m=T.data,m==="/$"){if(y===0){a.removeChild(T),bo(c);return}y--}else m!=="$"&&m!=="$?"&&m!=="$!"||y++;m=T}while(m);bo(c)}function ts(a){for(;a!=null;a=a.nextSibling){var c=a.nodeType;if(c===1||c===3)break;if(c===8){if(c=a.data,c==="$"||c==="$!"||c==="$?")break;if(c==="/$")return null}}return a}function s0(a){a=a.previousSibling;for(var c=0;a;){if(a.nodeType===8){var m=a.data;if(m==="$"||m==="$!"||m==="$?"){if(c===0)return a;c--}else m==="/$"&&c++}a=a.previousSibling}return null}var xi=Math.random().toString(36).slice(2),or="__reactFiber$"+xi,No="__reactProps$"+xi,Rr="__reactContainer$"+xi,Pd="__reactEvents$"+xi,WA="__reactListeners$"+xi,YA="__reactHandles$"+xi;function Ps(a){var c=a[or];if(c)return c;for(var m=a.parentNode;m;){if(c=m[Rr]||m[or]){if(m=c.alternate,c.child!==null||m!==null&&m.child!==null)for(a=s0(a);a!==null;){if(m=a[or])return m;a=s0(a)}return c}a=m,m=a.parentNode}return null}function Oo(a){return a=a[or]||a[Rr],!a||a.tag!==5&&a.tag!==6&&a.tag!==13&&a.tag!==3?null:a}function vi(a){if(a.tag===5||a.tag===6)return a.stateNode;throw Error(t(33))}function El(a){return a[No]||null}var Dd=[],Si=-1;function ns(a){return{current:a}}function lt(a){0>Si||(a.current=Dd[Si],Dd[Si]=null,Si--)}function it(a,c){Si++,Dd[Si]=a.current,a.current=c}var rs={},Vt=ns(rs),nn=ns(!1),Ds=rs;function Ei(a,c){var m=a.type.contextTypes;if(!m)return rs;var y=a.stateNode;if(y&&y.__reactInternalMemoizedUnmaskedChildContext===c)return y.__reactInternalMemoizedMaskedChildContext;var T={},w;for(w in m)T[w]=c[w];return y&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=c,a.__reactInternalMemoizedMaskedChildContext=T),T}function rn(a){return a=a.childContextTypes,a!=null}function Tl(){lt(nn),lt(Vt)}function i0(a,c,m){if(Vt.current!==rs)throw Error(t(168));it(Vt,c),it(nn,m)}function o0(a,c,m){var y=a.stateNode;if(c=c.childContextTypes,typeof y.getChildContext!="function")return m;y=y.getChildContext();for(var T in y)if(!(T in c))throw Error(t(108,Ee(a)||"Unknown",T));return ee({},m,y)}function bl(a){return a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||rs,Ds=Vt.current,it(Vt,a),it(nn,nn.current),!0}function a0(a,c,m){var y=a.stateNode;if(!y)throw Error(t(169));m?(a=o0(a,c,Ds),y.__reactInternalMemoizedMergedChildContext=a,lt(nn),lt(Vt),it(Vt,a)):lt(nn),it(nn,m)}var Ir=null,wl=!1,Nd=!1;function l0(a){Ir===null?Ir=[a]:Ir.push(a)}function qA(a){wl=!0,l0(a)}function ss(){if(!Nd&&Ir!==null){Nd=!0;var a=0,c=Qe;try{var m=Ir;for(Qe=1;a<m.length;a++){var y=m[a];do y=y(!0);while(y!==null)}Ir=null,wl=!1}catch(T){throw Ir!==null&&(Ir=Ir.slice(a+1)),ug(nd,ss),T}finally{Qe=c,Nd=!1}}return null}var Ti=[],bi=0,Al=null,Ll=0,Pn=[],Dn=0,Ns=null,kr=1,Cr="";function Os(a,c){Ti[bi++]=Ll,Ti[bi++]=Al,Al=a,Ll=c}function c0(a,c,m){Pn[Dn++]=kr,Pn[Dn++]=Cr,Pn[Dn++]=Ns,Ns=a;var y=kr;a=Cr;var T=32-Gn(y)-1;y&=~(1<<T),m+=1;var w=32-Gn(c)+T;if(30<w){var k=T-T%5;w=(y&(1<<k)-1).toString(32),y>>=k,T-=k,kr=1<<32-Gn(c)+T|m<<T|y,Cr=w+a}else kr=1<<w|m<<T|y,Cr=a}function Od(a){a.return!==null&&(Os(a,1),c0(a,1,0))}function Md(a){for(;a===Al;)Al=Ti[--bi],Ti[bi]=null,Ll=Ti[--bi],Ti[bi]=null;for(;a===Ns;)Ns=Pn[--Dn],Pn[Dn]=null,Cr=Pn[--Dn],Pn[Dn]=null,kr=Pn[--Dn],Pn[Dn]=null}var vn=null,Sn=null,ct=!1,Kn=null;function u0(a,c){var m=Fn(5,null,null,0);m.elementType="DELETED",m.stateNode=c,m.return=a,c=a.deletions,c===null?(a.deletions=[m],a.flags|=16):c.push(m)}function d0(a,c){switch(a.tag){case 5:var m=a.type;return c=c.nodeType!==1||m.toLowerCase()!==c.nodeName.toLowerCase()?null:c,c!==null?(a.stateNode=c,vn=a,Sn=ts(c.firstChild),!0):!1;case 6:return c=a.pendingProps===""||c.nodeType!==3?null:c,c!==null?(a.stateNode=c,vn=a,Sn=null,!0):!1;case 13:return c=c.nodeType!==8?null:c,c!==null?(m=Ns!==null?{id:kr,overflow:Cr}:null,a.memoizedState={dehydrated:c,treeContext:m,retryLane:1073741824},m=Fn(18,null,null,0),m.stateNode=c,m.return=a,a.child=m,vn=a,Sn=null,!0):!1;default:return!1}}function Fd(a){return(a.mode&1)!==0&&(a.flags&128)===0}function Bd(a){if(ct){var c=Sn;if(c){var m=c;if(!d0(a,c)){if(Fd(a))throw Error(t(418));c=ts(m.nextSibling);var y=vn;c&&d0(a,c)?u0(y,m):(a.flags=a.flags&-4097|2,ct=!1,vn=a)}}else{if(Fd(a))throw Error(t(418));a.flags=a.flags&-4097|2,ct=!1,vn=a}}}function f0(a){for(a=a.return;a!==null&&a.tag!==5&&a.tag!==3&&a.tag!==13;)a=a.return;vn=a}function Rl(a){if(a!==vn)return!1;if(!ct)return f0(a),ct=!0,!1;var c;if((c=a.tag!==3)&&!(c=a.tag!==5)&&(c=a.type,c=c!=="head"&&c!=="body"&&!kd(a.type,a.memoizedProps)),c&&(c=Sn)){if(Fd(a))throw h0(),Error(t(418));for(;c;)u0(a,c),c=ts(c.nextSibling)}if(f0(a),a.tag===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(t(317));e:{for(a=a.nextSibling,c=0;a;){if(a.nodeType===8){var m=a.data;if(m==="/$"){if(c===0){Sn=ts(a.nextSibling);break e}c--}else m!=="$"&&m!=="$!"&&m!=="$?"||c++}a=a.nextSibling}Sn=null}}else Sn=vn?ts(a.stateNode.nextSibling):null;return!0}function h0(){for(var a=Sn;a;)a=ts(a.nextSibling)}function wi(){Sn=vn=null,ct=!1}function Ud(a){Kn===null?Kn=[a]:Kn.push(a)}var XA=I.ReactCurrentBatchConfig;function Mo(a,c,m){if(a=m.ref,a!==null&&typeof a!="function"&&typeof a!="object"){if(m._owner){if(m=m._owner,m){if(m.tag!==1)throw Error(t(309));var y=m.stateNode}if(!y)throw Error(t(147,a));var T=y,w=""+a;return c!==null&&c.ref!==null&&typeof c.ref=="function"&&c.ref._stringRef===w?c.ref:(c=function(k){var B=T.refs;k===null?delete B[w]:B[w]=k},c._stringRef=w,c)}if(typeof a!="string")throw Error(t(284));if(!m._owner)throw Error(t(290,a))}return a}function Il(a,c){throw a=Object.prototype.toString.call(c),Error(t(31,a==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":a))}function m0(a){var c=a._init;return c(a._payload)}function p0(a){function c(W,V){if(a){var Y=W.deletions;Y===null?(W.deletions=[V],W.flags|=16):Y.push(V)}}function m(W,V){if(!a)return null;for(;V!==null;)c(W,V),V=V.sibling;return null}function y(W,V){for(W=new Map;V!==null;)V.key!==null?W.set(V.key,V):W.set(V.index,V),V=V.sibling;return W}function T(W,V){return W=fs(W,V),W.index=0,W.sibling=null,W}function w(W,V,Y){return W.index=Y,a?(Y=W.alternate,Y!==null?(Y=Y.index,Y<V?(W.flags|=2,V):Y):(W.flags|=2,V)):(W.flags|=1048576,V)}function k(W){return a&&W.alternate===null&&(W.flags|=2),W}function B(W,V,Y,de){return V===null||V.tag!==6?(V=_f(Y,W.mode,de),V.return=W,V):(V=T(V,Y),V.return=W,V)}function j(W,V,Y,de){var Ae=Y.type;return Ae===C?ae(W,V,Y.props.children,de,Y.key):V!==null&&(V.elementType===Ae||typeof Ae=="object"&&Ae!==null&&Ae.$$typeof===q&&m0(Ae)===V.type)?(de=T(V,Y.props),de.ref=Mo(W,V,Y),de.return=W,de):(de=Jl(Y.type,Y.key,Y.props,null,W.mode,de),de.ref=Mo(W,V,Y),de.return=W,de)}function X(W,V,Y,de){return V===null||V.tag!==4||V.stateNode.containerInfo!==Y.containerInfo||V.stateNode.implementation!==Y.implementation?(V=Pf(Y,W.mode,de),V.return=W,V):(V=T(V,Y.children||[]),V.return=W,V)}function ae(W,V,Y,de,Ae){return V===null||V.tag!==7?(V=Gs(Y,W.mode,de,Ae),V.return=W,V):(V=T(V,Y),V.return=W,V)}function le(W,V,Y){if(typeof V=="string"&&V!==""||typeof V=="number")return V=_f(""+V,W.mode,Y),V.return=W,V;if(typeof V=="object"&&V!==null){switch(V.$$typeof){case _:return Y=Jl(V.type,V.key,V.props,null,W.mode,Y),Y.ref=Mo(W,null,V),Y.return=W,Y;case F:return V=Pf(V,W.mode,Y),V.return=W,V;case q:var de=V._init;return le(W,de(V._payload),Y)}if(Be(V)||Q(V))return V=Gs(V,W.mode,Y,null),V.return=W,V;Il(W,V)}return null}function oe(W,V,Y,de){var Ae=V!==null?V.key:null;if(typeof Y=="string"&&Y!==""||typeof Y=="number")return Ae!==null?null:B(W,V,""+Y,de);if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case _:return Y.key===Ae?j(W,V,Y,de):null;case F:return Y.key===Ae?X(W,V,Y,de):null;case q:return Ae=Y._init,oe(W,V,Ae(Y._payload),de)}if(Be(Y)||Q(Y))return Ae!==null?null:ae(W,V,Y,de,null);Il(W,Y)}return null}function pe(W,V,Y,de,Ae){if(typeof de=="string"&&de!==""||typeof de=="number")return W=W.get(Y)||null,B(V,W,""+de,Ae);if(typeof de=="object"&&de!==null){switch(de.$$typeof){case _:return W=W.get(de.key===null?Y:de.key)||null,j(V,W,de,Ae);case F:return W=W.get(de.key===null?Y:de.key)||null,X(V,W,de,Ae);case q:var Ie=de._init;return pe(W,V,Y,Ie(de._payload),Ae)}if(Be(de)||Q(de))return W=W.get(Y)||null,ae(V,W,de,Ae,null);Il(V,de)}return null}function Se(W,V,Y,de){for(var Ae=null,Ie=null,ke=V,De=V=0,Nt=null;ke!==null&&De<Y.length;De++){ke.index>De?(Nt=ke,ke=null):Nt=ke.sibling;var Ye=oe(W,ke,Y[De],de);if(Ye===null){ke===null&&(ke=Nt);break}a&&ke&&Ye.alternate===null&&c(W,ke),V=w(Ye,V,De),Ie===null?Ae=Ye:Ie.sibling=Ye,Ie=Ye,ke=Nt}if(De===Y.length)return m(W,ke),ct&&Os(W,De),Ae;if(ke===null){for(;De<Y.length;De++)ke=le(W,Y[De],de),ke!==null&&(V=w(ke,V,De),Ie===null?Ae=ke:Ie.sibling=ke,Ie=ke);return ct&&Os(W,De),Ae}for(ke=y(W,ke);De<Y.length;De++)Nt=pe(ke,W,De,Y[De],de),Nt!==null&&(a&&Nt.alternate!==null&&ke.delete(Nt.key===null?De:Nt.key),V=w(Nt,V,De),Ie===null?Ae=Nt:Ie.sibling=Nt,Ie=Nt);return a&&ke.forEach(function(hs){return c(W,hs)}),ct&&Os(W,De),Ae}function be(W,V,Y,de){var Ae=Q(Y);if(typeof Ae!="function")throw Error(t(150));if(Y=Ae.call(Y),Y==null)throw Error(t(151));for(var Ie=Ae=null,ke=V,De=V=0,Nt=null,Ye=Y.next();ke!==null&&!Ye.done;De++,Ye=Y.next()){ke.index>De?(Nt=ke,ke=null):Nt=ke.sibling;var hs=oe(W,ke,Ye.value,de);if(hs===null){ke===null&&(ke=Nt);break}a&&ke&&hs.alternate===null&&c(W,ke),V=w(hs,V,De),Ie===null?Ae=hs:Ie.sibling=hs,Ie=hs,ke=Nt}if(Ye.done)return m(W,ke),ct&&Os(W,De),Ae;if(ke===null){for(;!Ye.done;De++,Ye=Y.next())Ye=le(W,Ye.value,de),Ye!==null&&(V=w(Ye,V,De),Ie===null?Ae=Ye:Ie.sibling=Ye,Ie=Ye);return ct&&Os(W,De),Ae}for(ke=y(W,ke);!Ye.done;De++,Ye=Y.next())Ye=pe(ke,W,De,Ye.value,de),Ye!==null&&(a&&Ye.alternate!==null&&ke.delete(Ye.key===null?De:Ye.key),V=w(Ye,V,De),Ie===null?Ae=Ye:Ie.sibling=Ye,Ie=Ye);return a&&ke.forEach(function(kL){return c(W,kL)}),ct&&Os(W,De),Ae}function Et(W,V,Y,de){if(typeof Y=="object"&&Y!==null&&Y.type===C&&Y.key===null&&(Y=Y.props.children),typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case _:e:{for(var Ae=Y.key,Ie=V;Ie!==null;){if(Ie.key===Ae){if(Ae=Y.type,Ae===C){if(Ie.tag===7){m(W,Ie.sibling),V=T(Ie,Y.props.children),V.return=W,W=V;break e}}else if(Ie.elementType===Ae||typeof Ae=="object"&&Ae!==null&&Ae.$$typeof===q&&m0(Ae)===Ie.type){m(W,Ie.sibling),V=T(Ie,Y.props),V.ref=Mo(W,Ie,Y),V.return=W,W=V;break e}m(W,Ie);break}else c(W,Ie);Ie=Ie.sibling}Y.type===C?(V=Gs(Y.props.children,W.mode,de,Y.key),V.return=W,W=V):(de=Jl(Y.type,Y.key,Y.props,null,W.mode,de),de.ref=Mo(W,V,Y),de.return=W,W=de)}return k(W);case F:e:{for(Ie=Y.key;V!==null;){if(V.key===Ie)if(V.tag===4&&V.stateNode.containerInfo===Y.containerInfo&&V.stateNode.implementation===Y.implementation){m(W,V.sibling),V=T(V,Y.children||[]),V.return=W,W=V;break e}else{m(W,V);break}else c(W,V);V=V.sibling}V=Pf(Y,W.mode,de),V.return=W,W=V}return k(W);case q:return Ie=Y._init,Et(W,V,Ie(Y._payload),de)}if(Be(Y))return Se(W,V,Y,de);if(Q(Y))return be(W,V,Y,de);Il(W,Y)}return typeof Y=="string"&&Y!==""||typeof Y=="number"?(Y=""+Y,V!==null&&V.tag===6?(m(W,V.sibling),V=T(V,Y),V.return=W,W=V):(m(W,V),V=_f(Y,W.mode,de),V.return=W,W=V),k(W)):m(W,V)}return Et}var Ai=p0(!0),g0=p0(!1),kl=ns(null),Cl=null,Li=null,$d=null;function jd(){$d=Li=Cl=null}function Vd(a){var c=kl.current;lt(kl),a._currentValue=c}function Gd(a,c,m){for(;a!==null;){var y=a.alternate;if((a.childLanes&c)!==c?(a.childLanes|=c,y!==null&&(y.childLanes|=c)):y!==null&&(y.childLanes&c)!==c&&(y.childLanes|=c),a===m)break;a=a.return}}function Ri(a,c){Cl=a,$d=Li=null,a=a.dependencies,a!==null&&a.firstContext!==null&&((a.lanes&c)!==0&&(sn=!0),a.firstContext=null)}function Nn(a){var c=a._currentValue;if($d!==a)if(a={context:a,memoizedValue:c,next:null},Li===null){if(Cl===null)throw Error(t(308));Li=a,Cl.dependencies={lanes:0,firstContext:a}}else Li=Li.next=a;return c}var Ms=null;function Hd(a){Ms===null?Ms=[a]:Ms.push(a)}function y0(a,c,m,y){var T=c.interleaved;return T===null?(m.next=m,Hd(c)):(m.next=T.next,T.next=m),c.interleaved=m,_r(a,y)}function _r(a,c){a.lanes|=c;var m=a.alternate;for(m!==null&&(m.lanes|=c),m=a,a=a.return;a!==null;)a.childLanes|=c,m=a.alternate,m!==null&&(m.childLanes|=c),m=a,a=a.return;return m.tag===3?m.stateNode:null}var is=!1;function Kd(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function x0(a,c){a=a.updateQueue,c.updateQueue===a&&(c.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,effects:a.effects})}function Pr(a,c){return{eventTime:a,lane:c,tag:0,payload:null,callback:null,next:null}}function os(a,c,m){var y=a.updateQueue;if(y===null)return null;if(y=y.shared,(Ke&2)!==0){var T=y.pending;return T===null?c.next=c:(c.next=T.next,T.next=c),y.pending=c,_r(a,m)}return T=y.interleaved,T===null?(c.next=c,Hd(y)):(c.next=T.next,T.next=c),y.interleaved=c,_r(a,m)}function _l(a,c,m){if(c=c.updateQueue,c!==null&&(c=c.shared,(m&4194240)!==0)){var y=c.lanes;y&=a.pendingLanes,m|=y,c.lanes=m,id(a,m)}}function v0(a,c){var m=a.updateQueue,y=a.alternate;if(y!==null&&(y=y.updateQueue,m===y)){var T=null,w=null;if(m=m.firstBaseUpdate,m!==null){do{var k={eventTime:m.eventTime,lane:m.lane,tag:m.tag,payload:m.payload,callback:m.callback,next:null};w===null?T=w=k:w=w.next=k,m=m.next}while(m!==null);w===null?T=w=c:w=w.next=c}else T=w=c;m={baseState:y.baseState,firstBaseUpdate:T,lastBaseUpdate:w,shared:y.shared,effects:y.effects},a.updateQueue=m;return}a=m.lastBaseUpdate,a===null?m.firstBaseUpdate=c:a.next=c,m.lastBaseUpdate=c}function Pl(a,c,m,y){var T=a.updateQueue;is=!1;var w=T.firstBaseUpdate,k=T.lastBaseUpdate,B=T.shared.pending;if(B!==null){T.shared.pending=null;var j=B,X=j.next;j.next=null,k===null?w=X:k.next=X,k=j;var ae=a.alternate;ae!==null&&(ae=ae.updateQueue,B=ae.lastBaseUpdate,B!==k&&(B===null?ae.firstBaseUpdate=X:B.next=X,ae.lastBaseUpdate=j))}if(w!==null){var le=T.baseState;k=0,ae=X=j=null,B=w;do{var oe=B.lane,pe=B.eventTime;if((y&oe)===oe){ae!==null&&(ae=ae.next={eventTime:pe,lane:0,tag:B.tag,payload:B.payload,callback:B.callback,next:null});e:{var Se=a,be=B;switch(oe=c,pe=m,be.tag){case 1:if(Se=be.payload,typeof Se=="function"){le=Se.call(pe,le,oe);break e}le=Se;break e;case 3:Se.flags=Se.flags&-65537|128;case 0:if(Se=be.payload,oe=typeof Se=="function"?Se.call(pe,le,oe):Se,oe==null)break e;le=ee({},le,oe);break e;case 2:is=!0}}B.callback!==null&&B.lane!==0&&(a.flags|=64,oe=T.effects,oe===null?T.effects=[B]:oe.push(B))}else pe={eventTime:pe,lane:oe,tag:B.tag,payload:B.payload,callback:B.callback,next:null},ae===null?(X=ae=pe,j=le):ae=ae.next=pe,k|=oe;if(B=B.next,B===null){if(B=T.shared.pending,B===null)break;oe=B,B=oe.next,oe.next=null,T.lastBaseUpdate=oe,T.shared.pending=null}}while(!0);if(ae===null&&(j=le),T.baseState=j,T.firstBaseUpdate=X,T.lastBaseUpdate=ae,c=T.shared.interleaved,c!==null){T=c;do k|=T.lane,T=T.next;while(T!==c)}else w===null&&(T.shared.lanes=0);Us|=k,a.lanes=k,a.memoizedState=le}}function S0(a,c,m){if(a=c.effects,c.effects=null,a!==null)for(c=0;c<a.length;c++){var y=a[c],T=y.callback;if(T!==null){if(y.callback=null,y=m,typeof T!="function")throw Error(t(191,T));T.call(y)}}}var Fo={},ar=ns(Fo),Bo=ns(Fo),Uo=ns(Fo);function Fs(a){if(a===Fo)throw Error(t(174));return a}function zd(a,c){switch(it(Uo,c),it(Bo,a),it(ar,Fo),a=c.nodeType,a){case 9:case 11:c=(c=c.documentElement)?c.namespaceURI:gn(null,"");break;default:a=a===8?c.parentNode:c,c=a.namespaceURI||null,a=a.tagName,c=gn(c,a)}lt(ar),it(ar,c)}function Ii(){lt(ar),lt(Bo),lt(Uo)}function E0(a){Fs(Uo.current);var c=Fs(ar.current),m=gn(c,a.type);c!==m&&(it(Bo,a),it(ar,m))}function Wd(a){Bo.current===a&&(lt(ar),lt(Bo))}var ut=ns(0);function Dl(a){for(var c=a;c!==null;){if(c.tag===13){var m=c.memoizedState;if(m!==null&&(m=m.dehydrated,m===null||m.data==="$?"||m.data==="$!"))return c}else if(c.tag===19&&c.memoizedProps.revealOrder!==void 0){if((c.flags&128)!==0)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}var Yd=[];function qd(){for(var a=0;a<Yd.length;a++)Yd[a]._workInProgressVersionPrimary=null;Yd.length=0}var Nl=I.ReactCurrentDispatcher,Xd=I.ReactCurrentBatchConfig,Bs=0,dt=null,Rt=null,Pt=null,Ol=!1,$o=!1,jo=0,QA=0;function Gt(){throw Error(t(321))}function Qd(a,c){if(c===null)return!1;for(var m=0;m<c.length&&m<a.length;m++)if(!Hn(a[m],c[m]))return!1;return!0}function Jd(a,c,m,y,T,w){if(Bs=w,dt=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,Nl.current=a===null||a.memoizedState===null?tL:nL,a=m(y,T),$o){w=0;do{if($o=!1,jo=0,25<=w)throw Error(t(301));w+=1,Pt=Rt=null,c.updateQueue=null,Nl.current=rL,a=m(y,T)}while($o)}if(Nl.current=Bl,c=Rt!==null&&Rt.next!==null,Bs=0,Pt=Rt=dt=null,Ol=!1,c)throw Error(t(300));return a}function Zd(){var a=jo!==0;return jo=0,a}function lr(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Pt===null?dt.memoizedState=Pt=a:Pt=Pt.next=a,Pt}function On(){if(Rt===null){var a=dt.alternate;a=a!==null?a.memoizedState:null}else a=Rt.next;var c=Pt===null?dt.memoizedState:Pt.next;if(c!==null)Pt=c,Rt=a;else{if(a===null)throw Error(t(310));Rt=a,a={memoizedState:Rt.memoizedState,baseState:Rt.baseState,baseQueue:Rt.baseQueue,queue:Rt.queue,next:null},Pt===null?dt.memoizedState=Pt=a:Pt=Pt.next=a}return Pt}function Vo(a,c){return typeof c=="function"?c(a):c}function ef(a){var c=On(),m=c.queue;if(m===null)throw Error(t(311));m.lastRenderedReducer=a;var y=Rt,T=y.baseQueue,w=m.pending;if(w!==null){if(T!==null){var k=T.next;T.next=w.next,w.next=k}y.baseQueue=T=w,m.pending=null}if(T!==null){w=T.next,y=y.baseState;var B=k=null,j=null,X=w;do{var ae=X.lane;if((Bs&ae)===ae)j!==null&&(j=j.next={lane:0,action:X.action,hasEagerState:X.hasEagerState,eagerState:X.eagerState,next:null}),y=X.hasEagerState?X.eagerState:a(y,X.action);else{var le={lane:ae,action:X.action,hasEagerState:X.hasEagerState,eagerState:X.eagerState,next:null};j===null?(B=j=le,k=y):j=j.next=le,dt.lanes|=ae,Us|=ae}X=X.next}while(X!==null&&X!==w);j===null?k=y:j.next=B,Hn(y,c.memoizedState)||(sn=!0),c.memoizedState=y,c.baseState=k,c.baseQueue=j,m.lastRenderedState=y}if(a=m.interleaved,a!==null){T=a;do w=T.lane,dt.lanes|=w,Us|=w,T=T.next;while(T!==a)}else T===null&&(m.lanes=0);return[c.memoizedState,m.dispatch]}function tf(a){var c=On(),m=c.queue;if(m===null)throw Error(t(311));m.lastRenderedReducer=a;var y=m.dispatch,T=m.pending,w=c.memoizedState;if(T!==null){m.pending=null;var k=T=T.next;do w=a(w,k.action),k=k.next;while(k!==T);Hn(w,c.memoizedState)||(sn=!0),c.memoizedState=w,c.baseQueue===null&&(c.baseState=w),m.lastRenderedState=w}return[w,y]}function T0(){}function b0(a,c){var m=dt,y=On(),T=c(),w=!Hn(y.memoizedState,T);if(w&&(y.memoizedState=T,sn=!0),y=y.queue,nf(L0.bind(null,m,y,a),[a]),y.getSnapshot!==c||w||Pt!==null&&Pt.memoizedState.tag&1){if(m.flags|=2048,Go(9,A0.bind(null,m,y,T,c),void 0,null),Dt===null)throw Error(t(349));(Bs&30)!==0||w0(m,c,T)}return T}function w0(a,c,m){a.flags|=16384,a={getSnapshot:c,value:m},c=dt.updateQueue,c===null?(c={lastEffect:null,stores:null},dt.updateQueue=c,c.stores=[a]):(m=c.stores,m===null?c.stores=[a]:m.push(a))}function A0(a,c,m,y){c.value=m,c.getSnapshot=y,R0(c)&&I0(a)}function L0(a,c,m){return m(function(){R0(c)&&I0(a)})}function R0(a){var c=a.getSnapshot;a=a.value;try{var m=c();return!Hn(a,m)}catch{return!0}}function I0(a){var c=_r(a,1);c!==null&&qn(c,a,1,-1)}function k0(a){var c=lr();return typeof a=="function"&&(a=a()),c.memoizedState=c.baseState=a,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vo,lastRenderedState:a},c.queue=a,a=a.dispatch=eL.bind(null,dt,a),[c.memoizedState,a]}function Go(a,c,m,y){return a={tag:a,create:c,destroy:m,deps:y,next:null},c=dt.updateQueue,c===null?(c={lastEffect:null,stores:null},dt.updateQueue=c,c.lastEffect=a.next=a):(m=c.lastEffect,m===null?c.lastEffect=a.next=a:(y=m.next,m.next=a,a.next=y,c.lastEffect=a)),a}function C0(){return On().memoizedState}function Ml(a,c,m,y){var T=lr();dt.flags|=a,T.memoizedState=Go(1|c,m,void 0,y===void 0?null:y)}function Fl(a,c,m,y){var T=On();y=y===void 0?null:y;var w=void 0;if(Rt!==null){var k=Rt.memoizedState;if(w=k.destroy,y!==null&&Qd(y,k.deps)){T.memoizedState=Go(c,m,w,y);return}}dt.flags|=a,T.memoizedState=Go(1|c,m,w,y)}function _0(a,c){return Ml(8390656,8,a,c)}function nf(a,c){return Fl(2048,8,a,c)}function P0(a,c){return Fl(4,2,a,c)}function D0(a,c){return Fl(4,4,a,c)}function N0(a,c){if(typeof c=="function")return a=a(),c(a),function(){c(null)};if(c!=null)return a=a(),c.current=a,function(){c.current=null}}function O0(a,c,m){return m=m!=null?m.concat([a]):null,Fl(4,4,N0.bind(null,c,a),m)}function rf(){}function M0(a,c){var m=On();c=c===void 0?null:c;var y=m.memoizedState;return y!==null&&c!==null&&Qd(c,y[1])?y[0]:(m.memoizedState=[a,c],a)}function F0(a,c){var m=On();c=c===void 0?null:c;var y=m.memoizedState;return y!==null&&c!==null&&Qd(c,y[1])?y[0]:(a=a(),m.memoizedState=[a,c],a)}function B0(a,c,m){return(Bs&21)===0?(a.baseState&&(a.baseState=!1,sn=!0),a.memoizedState=m):(Hn(m,c)||(m=mg(),dt.lanes|=m,Us|=m,a.baseState=!0),c)}function JA(a,c){var m=Qe;Qe=m!==0&&4>m?m:4,a(!0);var y=Xd.transition;Xd.transition={};try{a(!1),c()}finally{Qe=m,Xd.transition=y}}function U0(){return On().memoizedState}function ZA(a,c,m){var y=us(a);if(m={lane:y,action:m,hasEagerState:!1,eagerState:null,next:null},$0(a))j0(c,m);else if(m=y0(a,c,m,y),m!==null){var T=Zt();qn(m,a,y,T),V0(m,c,y)}}function eL(a,c,m){var y=us(a),T={lane:y,action:m,hasEagerState:!1,eagerState:null,next:null};if($0(a))j0(c,T);else{var w=a.alternate;if(a.lanes===0&&(w===null||w.lanes===0)&&(w=c.lastRenderedReducer,w!==null))try{var k=c.lastRenderedState,B=w(k,m);if(T.hasEagerState=!0,T.eagerState=B,Hn(B,k)){var j=c.interleaved;j===null?(T.next=T,Hd(c)):(T.next=j.next,j.next=T),c.interleaved=T;return}}catch{}finally{}m=y0(a,c,T,y),m!==null&&(T=Zt(),qn(m,a,y,T),V0(m,c,y))}}function $0(a){var c=a.alternate;return a===dt||c!==null&&c===dt}function j0(a,c){$o=Ol=!0;var m=a.pending;m===null?c.next=c:(c.next=m.next,m.next=c),a.pending=c}function V0(a,c,m){if((m&4194240)!==0){var y=c.lanes;y&=a.pendingLanes,m|=y,c.lanes=m,id(a,m)}}var Bl={readContext:Nn,useCallback:Gt,useContext:Gt,useEffect:Gt,useImperativeHandle:Gt,useInsertionEffect:Gt,useLayoutEffect:Gt,useMemo:Gt,useReducer:Gt,useRef:Gt,useState:Gt,useDebugValue:Gt,useDeferredValue:Gt,useTransition:Gt,useMutableSource:Gt,useSyncExternalStore:Gt,useId:Gt,unstable_isNewReconciler:!1},tL={readContext:Nn,useCallback:function(a,c){return lr().memoizedState=[a,c===void 0?null:c],a},useContext:Nn,useEffect:_0,useImperativeHandle:function(a,c,m){return m=m!=null?m.concat([a]):null,Ml(4194308,4,N0.bind(null,c,a),m)},useLayoutEffect:function(a,c){return Ml(4194308,4,a,c)},useInsertionEffect:function(a,c){return Ml(4,2,a,c)},useMemo:function(a,c){var m=lr();return c=c===void 0?null:c,a=a(),m.memoizedState=[a,c],a},useReducer:function(a,c,m){var y=lr();return c=m!==void 0?m(c):c,y.memoizedState=y.baseState=c,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:c},y.queue=a,a=a.dispatch=ZA.bind(null,dt,a),[y.memoizedState,a]},useRef:function(a){var c=lr();return a={current:a},c.memoizedState=a},useState:k0,useDebugValue:rf,useDeferredValue:function(a){return lr().memoizedState=a},useTransition:function(){var a=k0(!1),c=a[0];return a=JA.bind(null,a[1]),lr().memoizedState=a,[c,a]},useMutableSource:function(){},useSyncExternalStore:function(a,c,m){var y=dt,T=lr();if(ct){if(m===void 0)throw Error(t(407));m=m()}else{if(m=c(),Dt===null)throw Error(t(349));(Bs&30)!==0||w0(y,c,m)}T.memoizedState=m;var w={value:m,getSnapshot:c};return T.queue=w,_0(L0.bind(null,y,w,a),[a]),y.flags|=2048,Go(9,A0.bind(null,y,w,m,c),void 0,null),m},useId:function(){var a=lr(),c=Dt.identifierPrefix;if(ct){var m=Cr,y=kr;m=(y&~(1<<32-Gn(y)-1)).toString(32)+m,c=":"+c+"R"+m,m=jo++,0<m&&(c+="H"+m.toString(32)),c+=":"}else m=QA++,c=":"+c+"r"+m.toString(32)+":";return a.memoizedState=c},unstable_isNewReconciler:!1},nL={readContext:Nn,useCallback:M0,useContext:Nn,useEffect:nf,useImperativeHandle:O0,useInsertionEffect:P0,useLayoutEffect:D0,useMemo:F0,useReducer:ef,useRef:C0,useState:function(){return ef(Vo)},useDebugValue:rf,useDeferredValue:function(a){var c=On();return B0(c,Rt.memoizedState,a)},useTransition:function(){var a=ef(Vo)[0],c=On().memoizedState;return[a,c]},useMutableSource:T0,useSyncExternalStore:b0,useId:U0,unstable_isNewReconciler:!1},rL={readContext:Nn,useCallback:M0,useContext:Nn,useEffect:nf,useImperativeHandle:O0,useInsertionEffect:P0,useLayoutEffect:D0,useMemo:F0,useReducer:tf,useRef:C0,useState:function(){return tf(Vo)},useDebugValue:rf,useDeferredValue:function(a){var c=On();return Rt===null?c.memoizedState=a:B0(c,Rt.memoizedState,a)},useTransition:function(){var a=tf(Vo)[0],c=On().memoizedState;return[a,c]},useMutableSource:T0,useSyncExternalStore:b0,useId:U0,unstable_isNewReconciler:!1};function zn(a,c){if(a&&a.defaultProps){c=ee({},c),a=a.defaultProps;for(var m in a)c[m]===void 0&&(c[m]=a[m]);return c}return c}function sf(a,c,m,y){c=a.memoizedState,m=m(y,c),m=m==null?c:ee({},c,m),a.memoizedState=m,a.lanes===0&&(a.updateQueue.baseState=m)}var Ul={isMounted:function(a){return(a=a._reactInternals)?_s(a)===a:!1},enqueueSetState:function(a,c,m){a=a._reactInternals;var y=Zt(),T=us(a),w=Pr(y,T);w.payload=c,m!=null&&(w.callback=m),c=os(a,w,T),c!==null&&(qn(c,a,T,y),_l(c,a,T))},enqueueReplaceState:function(a,c,m){a=a._reactInternals;var y=Zt(),T=us(a),w=Pr(y,T);w.tag=1,w.payload=c,m!=null&&(w.callback=m),c=os(a,w,T),c!==null&&(qn(c,a,T,y),_l(c,a,T))},enqueueForceUpdate:function(a,c){a=a._reactInternals;var m=Zt(),y=us(a),T=Pr(m,y);T.tag=2,c!=null&&(T.callback=c),c=os(a,T,y),c!==null&&(qn(c,a,y,m),_l(c,a,y))}};function G0(a,c,m,y,T,w,k){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(y,w,k):c.prototype&&c.prototype.isPureReactComponent?!ko(m,y)||!ko(T,w):!0}function H0(a,c,m){var y=!1,T=rs,w=c.contextType;return typeof w=="object"&&w!==null?w=Nn(w):(T=rn(c)?Ds:Vt.current,y=c.contextTypes,w=(y=y!=null)?Ei(a,T):rs),c=new c(m,w),a.memoizedState=c.state!==null&&c.state!==void 0?c.state:null,c.updater=Ul,a.stateNode=c,c._reactInternals=a,y&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=T,a.__reactInternalMemoizedMaskedChildContext=w),c}function K0(a,c,m,y){a=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(m,y),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(m,y),c.state!==a&&Ul.enqueueReplaceState(c,c.state,null)}function of(a,c,m,y){var T=a.stateNode;T.props=m,T.state=a.memoizedState,T.refs={},Kd(a);var w=c.contextType;typeof w=="object"&&w!==null?T.context=Nn(w):(w=rn(c)?Ds:Vt.current,T.context=Ei(a,w)),T.state=a.memoizedState,w=c.getDerivedStateFromProps,typeof w=="function"&&(sf(a,c,w,m),T.state=a.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof T.getSnapshotBeforeUpdate=="function"||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(c=T.state,typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount(),c!==T.state&&Ul.enqueueReplaceState(T,T.state,null),Pl(a,m,T,y),T.state=a.memoizedState),typeof T.componentDidMount=="function"&&(a.flags|=4194308)}function ki(a,c){try{var m="",y=c;do m+=ue(y),y=y.return;while(y);var T=m}catch(w){T=`
Error generating stack: `+w.message+`
`+w.stack}return{value:a,source:c,stack:T,digest:null}}function af(a,c,m){return{value:a,source:null,stack:m??null,digest:c??null}}function lf(a,c){try{console.error(c.value)}catch(m){setTimeout(function(){throw m})}}var sL=typeof WeakMap=="function"?WeakMap:Map;function z0(a,c,m){m=Pr(-1,m),m.tag=3,m.payload={element:null};var y=c.value;return m.callback=function(){zl||(zl=!0,bf=y),lf(a,c)},m}function W0(a,c,m){m=Pr(-1,m),m.tag=3;var y=a.type.getDerivedStateFromError;if(typeof y=="function"){var T=c.value;m.payload=function(){return y(T)},m.callback=function(){lf(a,c)}}var w=a.stateNode;return w!==null&&typeof w.componentDidCatch=="function"&&(m.callback=function(){lf(a,c),typeof y!="function"&&(ls===null?ls=new Set([this]):ls.add(this));var k=c.stack;this.componentDidCatch(c.value,{componentStack:k!==null?k:""})}),m}function Y0(a,c,m){var y=a.pingCache;if(y===null){y=a.pingCache=new sL;var T=new Set;y.set(c,T)}else T=y.get(c),T===void 0&&(T=new Set,y.set(c,T));T.has(m)||(T.add(m),a=xL.bind(null,a,c,m),c.then(a,a))}function q0(a){do{var c;if((c=a.tag===13)&&(c=a.memoizedState,c=c!==null?c.dehydrated!==null:!0),c)return a;a=a.return}while(a!==null);return null}function X0(a,c,m,y,T){return(a.mode&1)===0?(a===c?a.flags|=65536:(a.flags|=128,m.flags|=131072,m.flags&=-52805,m.tag===1&&(m.alternate===null?m.tag=17:(c=Pr(-1,1),c.tag=2,os(m,c,1))),m.lanes|=1),a):(a.flags|=65536,a.lanes=T,a)}var iL=I.ReactCurrentOwner,sn=!1;function Jt(a,c,m,y){c.child=a===null?g0(c,null,m,y):Ai(c,a.child,m,y)}function Q0(a,c,m,y,T){m=m.render;var w=c.ref;return Ri(c,T),y=Jd(a,c,m,y,w,T),m=Zd(),a!==null&&!sn?(c.updateQueue=a.updateQueue,c.flags&=-2053,a.lanes&=~T,Dr(a,c,T)):(ct&&m&&Od(c),c.flags|=1,Jt(a,c,y,T),c.child)}function J0(a,c,m,y,T){if(a===null){var w=m.type;return typeof w=="function"&&!Cf(w)&&w.defaultProps===void 0&&m.compare===null&&m.defaultProps===void 0?(c.tag=15,c.type=w,Z0(a,c,w,y,T)):(a=Jl(m.type,null,y,c,c.mode,T),a.ref=c.ref,a.return=c,c.child=a)}if(w=a.child,(a.lanes&T)===0){var k=w.memoizedProps;if(m=m.compare,m=m!==null?m:ko,m(k,y)&&a.ref===c.ref)return Dr(a,c,T)}return c.flags|=1,a=fs(w,y),a.ref=c.ref,a.return=c,c.child=a}function Z0(a,c,m,y,T){if(a!==null){var w=a.memoizedProps;if(ko(w,y)&&a.ref===c.ref)if(sn=!1,c.pendingProps=y=w,(a.lanes&T)!==0)(a.flags&131072)!==0&&(sn=!0);else return c.lanes=a.lanes,Dr(a,c,T)}return cf(a,c,m,y,T)}function ey(a,c,m){var y=c.pendingProps,T=y.children,w=a!==null?a.memoizedState:null;if(y.mode==="hidden")if((c.mode&1)===0)c.memoizedState={baseLanes:0,cachePool:null,transitions:null},it(_i,En),En|=m;else{if((m&1073741824)===0)return a=w!==null?w.baseLanes|m:m,c.lanes=c.childLanes=1073741824,c.memoizedState={baseLanes:a,cachePool:null,transitions:null},c.updateQueue=null,it(_i,En),En|=a,null;c.memoizedState={baseLanes:0,cachePool:null,transitions:null},y=w!==null?w.baseLanes:m,it(_i,En),En|=y}else w!==null?(y=w.baseLanes|m,c.memoizedState=null):y=m,it(_i,En),En|=y;return Jt(a,c,T,m),c.child}function ty(a,c){var m=c.ref;(a===null&&m!==null||a!==null&&a.ref!==m)&&(c.flags|=512,c.flags|=2097152)}function cf(a,c,m,y,T){var w=rn(m)?Ds:Vt.current;return w=Ei(c,w),Ri(c,T),m=Jd(a,c,m,y,w,T),y=Zd(),a!==null&&!sn?(c.updateQueue=a.updateQueue,c.flags&=-2053,a.lanes&=~T,Dr(a,c,T)):(ct&&y&&Od(c),c.flags|=1,Jt(a,c,m,T),c.child)}function ny(a,c,m,y,T){if(rn(m)){var w=!0;bl(c)}else w=!1;if(Ri(c,T),c.stateNode===null)jl(a,c),H0(c,m,y),of(c,m,y,T),y=!0;else if(a===null){var k=c.stateNode,B=c.memoizedProps;k.props=B;var j=k.context,X=m.contextType;typeof X=="object"&&X!==null?X=Nn(X):(X=rn(m)?Ds:Vt.current,X=Ei(c,X));var ae=m.getDerivedStateFromProps,le=typeof ae=="function"||typeof k.getSnapshotBeforeUpdate=="function";le||typeof k.UNSAFE_componentWillReceiveProps!="function"&&typeof k.componentWillReceiveProps!="function"||(B!==y||j!==X)&&K0(c,k,y,X),is=!1;var oe=c.memoizedState;k.state=oe,Pl(c,y,k,T),j=c.memoizedState,B!==y||oe!==j||nn.current||is?(typeof ae=="function"&&(sf(c,m,ae,y),j=c.memoizedState),(B=is||G0(c,m,B,y,oe,j,X))?(le||typeof k.UNSAFE_componentWillMount!="function"&&typeof k.componentWillMount!="function"||(typeof k.componentWillMount=="function"&&k.componentWillMount(),typeof k.UNSAFE_componentWillMount=="function"&&k.UNSAFE_componentWillMount()),typeof k.componentDidMount=="function"&&(c.flags|=4194308)):(typeof k.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=y,c.memoizedState=j),k.props=y,k.state=j,k.context=X,y=B):(typeof k.componentDidMount=="function"&&(c.flags|=4194308),y=!1)}else{k=c.stateNode,x0(a,c),B=c.memoizedProps,X=c.type===c.elementType?B:zn(c.type,B),k.props=X,le=c.pendingProps,oe=k.context,j=m.contextType,typeof j=="object"&&j!==null?j=Nn(j):(j=rn(m)?Ds:Vt.current,j=Ei(c,j));var pe=m.getDerivedStateFromProps;(ae=typeof pe=="function"||typeof k.getSnapshotBeforeUpdate=="function")||typeof k.UNSAFE_componentWillReceiveProps!="function"&&typeof k.componentWillReceiveProps!="function"||(B!==le||oe!==j)&&K0(c,k,y,j),is=!1,oe=c.memoizedState,k.state=oe,Pl(c,y,k,T);var Se=c.memoizedState;B!==le||oe!==Se||nn.current||is?(typeof pe=="function"&&(sf(c,m,pe,y),Se=c.memoizedState),(X=is||G0(c,m,X,y,oe,Se,j)||!1)?(ae||typeof k.UNSAFE_componentWillUpdate!="function"&&typeof k.componentWillUpdate!="function"||(typeof k.componentWillUpdate=="function"&&k.componentWillUpdate(y,Se,j),typeof k.UNSAFE_componentWillUpdate=="function"&&k.UNSAFE_componentWillUpdate(y,Se,j)),typeof k.componentDidUpdate=="function"&&(c.flags|=4),typeof k.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof k.componentDidUpdate!="function"||B===a.memoizedProps&&oe===a.memoizedState||(c.flags|=4),typeof k.getSnapshotBeforeUpdate!="function"||B===a.memoizedProps&&oe===a.memoizedState||(c.flags|=1024),c.memoizedProps=y,c.memoizedState=Se),k.props=y,k.state=Se,k.context=j,y=X):(typeof k.componentDidUpdate!="function"||B===a.memoizedProps&&oe===a.memoizedState||(c.flags|=4),typeof k.getSnapshotBeforeUpdate!="function"||B===a.memoizedProps&&oe===a.memoizedState||(c.flags|=1024),y=!1)}return uf(a,c,m,y,w,T)}function uf(a,c,m,y,T,w){ty(a,c);var k=(c.flags&128)!==0;if(!y&&!k)return T&&a0(c,m,!1),Dr(a,c,w);y=c.stateNode,iL.current=c;var B=k&&typeof m.getDerivedStateFromError!="function"?null:y.render();return c.flags|=1,a!==null&&k?(c.child=Ai(c,a.child,null,w),c.child=Ai(c,null,B,w)):Jt(a,c,B,w),c.memoizedState=y.state,T&&a0(c,m,!0),c.child}function ry(a){var c=a.stateNode;c.pendingContext?i0(a,c.pendingContext,c.pendingContext!==c.context):c.context&&i0(a,c.context,!1),zd(a,c.containerInfo)}function sy(a,c,m,y,T){return wi(),Ud(T),c.flags|=256,Jt(a,c,m,y),c.child}var df={dehydrated:null,treeContext:null,retryLane:0};function ff(a){return{baseLanes:a,cachePool:null,transitions:null}}function iy(a,c,m){var y=c.pendingProps,T=ut.current,w=!1,k=(c.flags&128)!==0,B;if((B=k)||(B=a!==null&&a.memoizedState===null?!1:(T&2)!==0),B?(w=!0,c.flags&=-129):(a===null||a.memoizedState!==null)&&(T|=1),it(ut,T&1),a===null)return Bd(c),a=c.memoizedState,a!==null&&(a=a.dehydrated,a!==null)?((c.mode&1)===0?c.lanes=1:a.data==="$!"?c.lanes=8:c.lanes=1073741824,null):(k=y.children,a=y.fallback,w?(y=c.mode,w=c.child,k={mode:"hidden",children:k},(y&1)===0&&w!==null?(w.childLanes=0,w.pendingProps=k):w=Zl(k,y,0,null),a=Gs(a,y,m,null),w.return=c,a.return=c,w.sibling=a,c.child=w,c.child.memoizedState=ff(m),c.memoizedState=df,a):hf(c,k));if(T=a.memoizedState,T!==null&&(B=T.dehydrated,B!==null))return oL(a,c,k,y,B,T,m);if(w){w=y.fallback,k=c.mode,T=a.child,B=T.sibling;var j={mode:"hidden",children:y.children};return(k&1)===0&&c.child!==T?(y=c.child,y.childLanes=0,y.pendingProps=j,c.deletions=null):(y=fs(T,j),y.subtreeFlags=T.subtreeFlags&14680064),B!==null?w=fs(B,w):(w=Gs(w,k,m,null),w.flags|=2),w.return=c,y.return=c,y.sibling=w,c.child=y,y=w,w=c.child,k=a.child.memoizedState,k=k===null?ff(m):{baseLanes:k.baseLanes|m,cachePool:null,transitions:k.transitions},w.memoizedState=k,w.childLanes=a.childLanes&~m,c.memoizedState=df,y}return w=a.child,a=w.sibling,y=fs(w,{mode:"visible",children:y.children}),(c.mode&1)===0&&(y.lanes=m),y.return=c,y.sibling=null,a!==null&&(m=c.deletions,m===null?(c.deletions=[a],c.flags|=16):m.push(a)),c.child=y,c.memoizedState=null,y}function hf(a,c){return c=Zl({mode:"visible",children:c},a.mode,0,null),c.return=a,a.child=c}function $l(a,c,m,y){return y!==null&&Ud(y),Ai(c,a.child,null,m),a=hf(c,c.pendingProps.children),a.flags|=2,c.memoizedState=null,a}function oL(a,c,m,y,T,w,k){if(m)return c.flags&256?(c.flags&=-257,y=af(Error(t(422))),$l(a,c,k,y)):c.memoizedState!==null?(c.child=a.child,c.flags|=128,null):(w=y.fallback,T=c.mode,y=Zl({mode:"visible",children:y.children},T,0,null),w=Gs(w,T,k,null),w.flags|=2,y.return=c,w.return=c,y.sibling=w,c.child=y,(c.mode&1)!==0&&Ai(c,a.child,null,k),c.child.memoizedState=ff(k),c.memoizedState=df,w);if((c.mode&1)===0)return $l(a,c,k,null);if(T.data==="$!"){if(y=T.nextSibling&&T.nextSibling.dataset,y)var B=y.dgst;return y=B,w=Error(t(419)),y=af(w,y,void 0),$l(a,c,k,y)}if(B=(k&a.childLanes)!==0,sn||B){if(y=Dt,y!==null){switch(k&-k){case 4:T=2;break;case 16:T=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:T=32;break;case 536870912:T=268435456;break;default:T=0}T=(T&(y.suspendedLanes|k))!==0?0:T,T!==0&&T!==w.retryLane&&(w.retryLane=T,_r(a,T),qn(y,a,T,-1))}return kf(),y=af(Error(t(421))),$l(a,c,k,y)}return T.data==="$?"?(c.flags|=128,c.child=a.child,c=vL.bind(null,a),T._reactRetry=c,null):(a=w.treeContext,Sn=ts(T.nextSibling),vn=c,ct=!0,Kn=null,a!==null&&(Pn[Dn++]=kr,Pn[Dn++]=Cr,Pn[Dn++]=Ns,kr=a.id,Cr=a.overflow,Ns=c),c=hf(c,y.children),c.flags|=4096,c)}function oy(a,c,m){a.lanes|=c;var y=a.alternate;y!==null&&(y.lanes|=c),Gd(a.return,c,m)}function mf(a,c,m,y,T){var w=a.memoizedState;w===null?a.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:y,tail:m,tailMode:T}:(w.isBackwards=c,w.rendering=null,w.renderingStartTime=0,w.last=y,w.tail=m,w.tailMode=T)}function ay(a,c,m){var y=c.pendingProps,T=y.revealOrder,w=y.tail;if(Jt(a,c,y.children,m),y=ut.current,(y&2)!==0)y=y&1|2,c.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=c.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&oy(a,m,c);else if(a.tag===19)oy(a,m,c);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===c)break e;for(;a.sibling===null;){if(a.return===null||a.return===c)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}y&=1}if(it(ut,y),(c.mode&1)===0)c.memoizedState=null;else switch(T){case"forwards":for(m=c.child,T=null;m!==null;)a=m.alternate,a!==null&&Dl(a)===null&&(T=m),m=m.sibling;m=T,m===null?(T=c.child,c.child=null):(T=m.sibling,m.sibling=null),mf(c,!1,T,m,w);break;case"backwards":for(m=null,T=c.child,c.child=null;T!==null;){if(a=T.alternate,a!==null&&Dl(a)===null){c.child=T;break}a=T.sibling,T.sibling=m,m=T,T=a}mf(c,!0,m,null,w);break;case"together":mf(c,!1,null,null,void 0);break;default:c.memoizedState=null}return c.child}function jl(a,c){(c.mode&1)===0&&a!==null&&(a.alternate=null,c.alternate=null,c.flags|=2)}function Dr(a,c,m){if(a!==null&&(c.dependencies=a.dependencies),Us|=c.lanes,(m&c.childLanes)===0)return null;if(a!==null&&c.child!==a.child)throw Error(t(153));if(c.child!==null){for(a=c.child,m=fs(a,a.pendingProps),c.child=m,m.return=c;a.sibling!==null;)a=a.sibling,m=m.sibling=fs(a,a.pendingProps),m.return=c;m.sibling=null}return c.child}function aL(a,c,m){switch(c.tag){case 3:ry(c),wi();break;case 5:E0(c);break;case 1:rn(c.type)&&bl(c);break;case 4:zd(c,c.stateNode.containerInfo);break;case 10:var y=c.type._context,T=c.memoizedProps.value;it(kl,y._currentValue),y._currentValue=T;break;case 13:if(y=c.memoizedState,y!==null)return y.dehydrated!==null?(it(ut,ut.current&1),c.flags|=128,null):(m&c.child.childLanes)!==0?iy(a,c,m):(it(ut,ut.current&1),a=Dr(a,c,m),a!==null?a.sibling:null);it(ut,ut.current&1);break;case 19:if(y=(m&c.childLanes)!==0,(a.flags&128)!==0){if(y)return ay(a,c,m);c.flags|=128}if(T=c.memoizedState,T!==null&&(T.rendering=null,T.tail=null,T.lastEffect=null),it(ut,ut.current),y)break;return null;case 22:case 23:return c.lanes=0,ey(a,c,m)}return Dr(a,c,m)}var ly,pf,cy,uy;ly=function(a,c){for(var m=c.child;m!==null;){if(m.tag===5||m.tag===6)a.appendChild(m.stateNode);else if(m.tag!==4&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===c)break;for(;m.sibling===null;){if(m.return===null||m.return===c)return;m=m.return}m.sibling.return=m.return,m=m.sibling}},pf=function(){},cy=function(a,c,m,y){var T=a.memoizedProps;if(T!==y){a=c.stateNode,Fs(ar.current);var w=null;switch(m){case"input":T=Re(a,T),y=Re(a,y),w=[];break;case"select":T=ee({},T,{value:void 0}),y=ee({},y,{value:void 0}),w=[];break;case"textarea":T=_t(a,T),y=_t(a,y),w=[];break;default:typeof T.onClick!="function"&&typeof y.onClick=="function"&&(a.onclick=Sl)}oo(m,y);var k;m=null;for(X in T)if(!y.hasOwnProperty(X)&&T.hasOwnProperty(X)&&T[X]!=null)if(X==="style"){var B=T[X];for(k in B)B.hasOwnProperty(k)&&(m||(m={}),m[k]="")}else X!=="dangerouslySetInnerHTML"&&X!=="children"&&X!=="suppressContentEditableWarning"&&X!=="suppressHydrationWarning"&&X!=="autoFocus"&&(s.hasOwnProperty(X)?w||(w=[]):(w=w||[]).push(X,null));for(X in y){var j=y[X];if(B=T?.[X],y.hasOwnProperty(X)&&j!==B&&(j!=null||B!=null))if(X==="style")if(B){for(k in B)!B.hasOwnProperty(k)||j&&j.hasOwnProperty(k)||(m||(m={}),m[k]="");for(k in j)j.hasOwnProperty(k)&&B[k]!==j[k]&&(m||(m={}),m[k]=j[k])}else m||(w||(w=[]),w.push(X,m)),m=j;else X==="dangerouslySetInnerHTML"?(j=j?j.__html:void 0,B=B?B.__html:void 0,j!=null&&B!==j&&(w=w||[]).push(X,j)):X==="children"?typeof j!="string"&&typeof j!="number"||(w=w||[]).push(X,""+j):X!=="suppressContentEditableWarning"&&X!=="suppressHydrationWarning"&&(s.hasOwnProperty(X)?(j!=null&&X==="onScroll"&&at("scroll",a),w||B===j||(w=[])):(w=w||[]).push(X,j))}m&&(w=w||[]).push("style",m);var X=w;(c.updateQueue=X)&&(c.flags|=4)}},uy=function(a,c,m,y){m!==y&&(c.flags|=4)};function Ho(a,c){if(!ct)switch(a.tailMode){case"hidden":c=a.tail;for(var m=null;c!==null;)c.alternate!==null&&(m=c),c=c.sibling;m===null?a.tail=null:m.sibling=null;break;case"collapsed":m=a.tail;for(var y=null;m!==null;)m.alternate!==null&&(y=m),m=m.sibling;y===null?c||a.tail===null?a.tail=null:a.tail.sibling=null:y.sibling=null}}function Ht(a){var c=a.alternate!==null&&a.alternate.child===a.child,m=0,y=0;if(c)for(var T=a.child;T!==null;)m|=T.lanes|T.childLanes,y|=T.subtreeFlags&14680064,y|=T.flags&14680064,T.return=a,T=T.sibling;else for(T=a.child;T!==null;)m|=T.lanes|T.childLanes,y|=T.subtreeFlags,y|=T.flags,T.return=a,T=T.sibling;return a.subtreeFlags|=y,a.childLanes=m,c}function lL(a,c,m){var y=c.pendingProps;switch(Md(c),c.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ht(c),null;case 1:return rn(c.type)&&Tl(),Ht(c),null;case 3:return y=c.stateNode,Ii(),lt(nn),lt(Vt),qd(),y.pendingContext&&(y.context=y.pendingContext,y.pendingContext=null),(a===null||a.child===null)&&(Rl(c)?c.flags|=4:a===null||a.memoizedState.isDehydrated&&(c.flags&256)===0||(c.flags|=1024,Kn!==null&&(Lf(Kn),Kn=null))),pf(a,c),Ht(c),null;case 5:Wd(c);var T=Fs(Uo.current);if(m=c.type,a!==null&&c.stateNode!=null)cy(a,c,m,y,T),a.ref!==c.ref&&(c.flags|=512,c.flags|=2097152);else{if(!y){if(c.stateNode===null)throw Error(t(166));return Ht(c),null}if(a=Fs(ar.current),Rl(c)){y=c.stateNode,m=c.type;var w=c.memoizedProps;switch(y[or]=c,y[No]=w,a=(c.mode&1)!==0,m){case"dialog":at("cancel",y),at("close",y);break;case"iframe":case"object":case"embed":at("load",y);break;case"video":case"audio":for(T=0;T<_o.length;T++)at(_o[T],y);break;case"source":at("error",y);break;case"img":case"image":case"link":at("error",y),at("load",y);break;case"details":at("toggle",y);break;case"input":$e(y,w),at("invalid",y);break;case"select":y._wrapperState={wasMultiple:!!w.multiple},at("invalid",y);break;case"textarea":_n(y,w),at("invalid",y)}oo(m,w),T=null;for(var k in w)if(w.hasOwnProperty(k)){var B=w[k];k==="children"?typeof B=="string"?y.textContent!==B&&(w.suppressHydrationWarning!==!0&&vl(y.textContent,B,a),T=["children",B]):typeof B=="number"&&y.textContent!==""+B&&(w.suppressHydrationWarning!==!0&&vl(y.textContent,B,a),T=["children",""+B]):s.hasOwnProperty(k)&&B!=null&&k==="onScroll"&&at("scroll",y)}switch(m){case"input":Pe(y),qe(y,w,!0);break;case"textarea":Pe(y),vt(y);break;case"select":case"option":break;default:typeof w.onClick=="function"&&(y.onclick=Sl)}y=T,c.updateQueue=y,y!==null&&(c.flags|=4)}else{k=T.nodeType===9?T:T.ownerDocument,a==="http://www.w3.org/1999/xhtml"&&(a=wt(m)),a==="http://www.w3.org/1999/xhtml"?m==="script"?(a=k.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild)):typeof y.is=="string"?a=k.createElement(m,{is:y.is}):(a=k.createElement(m),m==="select"&&(k=a,y.multiple?k.multiple=!0:y.size&&(k.size=y.size))):a=k.createElementNS(a,m),a[or]=c,a[No]=y,ly(a,c,!1,!1),c.stateNode=a;e:{switch(k=ao(m,y),m){case"dialog":at("cancel",a),at("close",a),T=y;break;case"iframe":case"object":case"embed":at("load",a),T=y;break;case"video":case"audio":for(T=0;T<_o.length;T++)at(_o[T],a);T=y;break;case"source":at("error",a),T=y;break;case"img":case"image":case"link":at("error",a),at("load",a),T=y;break;case"details":at("toggle",a),T=y;break;case"input":$e(a,y),T=Re(a,y),at("invalid",a);break;case"option":T=y;break;case"select":a._wrapperState={wasMultiple:!!y.multiple},T=ee({},y,{value:void 0}),at("invalid",a);break;case"textarea":_n(a,y),T=_t(a,y),at("invalid",a);break;default:T=y}oo(m,T),B=T;for(w in B)if(B.hasOwnProperty(w)){var j=B[w];w==="style"?Xa(a,j):w==="dangerouslySetInnerHTML"?(j=j?j.__html:void 0,j!=null&&yn(a,j)):w==="children"?typeof j=="string"?(m!=="textarea"||j!=="")&&Xt(a,j):typeof j=="number"&&Xt(a,""+j):w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&w!=="autoFocus"&&(s.hasOwnProperty(w)?j!=null&&w==="onScroll"&&at("scroll",a):j!=null&&L(a,w,j,k))}switch(m){case"input":Pe(a),qe(a,y,!1);break;case"textarea":Pe(a),vt(a);break;case"option":y.value!=null&&a.setAttribute("value",""+ye(y.value));break;case"select":a.multiple=!!y.multiple,w=y.value,w!=null?Xe(a,!!y.multiple,w,!1):y.defaultValue!=null&&Xe(a,!!y.multiple,y.defaultValue,!0);break;default:typeof T.onClick=="function"&&(a.onclick=Sl)}switch(m){case"button":case"input":case"select":case"textarea":y=!!y.autoFocus;break e;case"img":y=!0;break e;default:y=!1}}y&&(c.flags|=4)}c.ref!==null&&(c.flags|=512,c.flags|=2097152)}return Ht(c),null;case 6:if(a&&c.stateNode!=null)uy(a,c,a.memoizedProps,y);else{if(typeof y!="string"&&c.stateNode===null)throw Error(t(166));if(m=Fs(Uo.current),Fs(ar.current),Rl(c)){if(y=c.stateNode,m=c.memoizedProps,y[or]=c,(w=y.nodeValue!==m)&&(a=vn,a!==null))switch(a.tag){case 3:vl(y.nodeValue,m,(a.mode&1)!==0);break;case 5:a.memoizedProps.suppressHydrationWarning!==!0&&vl(y.nodeValue,m,(a.mode&1)!==0)}w&&(c.flags|=4)}else y=(m.nodeType===9?m:m.ownerDocument).createTextNode(y),y[or]=c,c.stateNode=y}return Ht(c),null;case 13:if(lt(ut),y=c.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(ct&&Sn!==null&&(c.mode&1)!==0&&(c.flags&128)===0)h0(),wi(),c.flags|=98560,w=!1;else if(w=Rl(c),y!==null&&y.dehydrated!==null){if(a===null){if(!w)throw Error(t(318));if(w=c.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(t(317));w[or]=c}else wi(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;Ht(c),w=!1}else Kn!==null&&(Lf(Kn),Kn=null),w=!0;if(!w)return c.flags&65536?c:null}return(c.flags&128)!==0?(c.lanes=m,c):(y=y!==null,y!==(a!==null&&a.memoizedState!==null)&&y&&(c.child.flags|=8192,(c.mode&1)!==0&&(a===null||(ut.current&1)!==0?It===0&&(It=3):kf())),c.updateQueue!==null&&(c.flags|=4),Ht(c),null);case 4:return Ii(),pf(a,c),a===null&&Po(c.stateNode.containerInfo),Ht(c),null;case 10:return Vd(c.type._context),Ht(c),null;case 17:return rn(c.type)&&Tl(),Ht(c),null;case 19:if(lt(ut),w=c.memoizedState,w===null)return Ht(c),null;if(y=(c.flags&128)!==0,k=w.rendering,k===null)if(y)Ho(w,!1);else{if(It!==0||a!==null&&(a.flags&128)!==0)for(a=c.child;a!==null;){if(k=Dl(a),k!==null){for(c.flags|=128,Ho(w,!1),y=k.updateQueue,y!==null&&(c.updateQueue=y,c.flags|=4),c.subtreeFlags=0,y=m,m=c.child;m!==null;)w=m,a=y,w.flags&=14680066,k=w.alternate,k===null?(w.childLanes=0,w.lanes=a,w.child=null,w.subtreeFlags=0,w.memoizedProps=null,w.memoizedState=null,w.updateQueue=null,w.dependencies=null,w.stateNode=null):(w.childLanes=k.childLanes,w.lanes=k.lanes,w.child=k.child,w.subtreeFlags=0,w.deletions=null,w.memoizedProps=k.memoizedProps,w.memoizedState=k.memoizedState,w.updateQueue=k.updateQueue,w.type=k.type,a=k.dependencies,w.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),m=m.sibling;return it(ut,ut.current&1|2),c.child}a=a.sibling}w.tail!==null&&St()>Pi&&(c.flags|=128,y=!0,Ho(w,!1),c.lanes=4194304)}else{if(!y)if(a=Dl(k),a!==null){if(c.flags|=128,y=!0,m=a.updateQueue,m!==null&&(c.updateQueue=m,c.flags|=4),Ho(w,!0),w.tail===null&&w.tailMode==="hidden"&&!k.alternate&&!ct)return Ht(c),null}else 2*St()-w.renderingStartTime>Pi&&m!==1073741824&&(c.flags|=128,y=!0,Ho(w,!1),c.lanes=4194304);w.isBackwards?(k.sibling=c.child,c.child=k):(m=w.last,m!==null?m.sibling=k:c.child=k,w.last=k)}return w.tail!==null?(c=w.tail,w.rendering=c,w.tail=c.sibling,w.renderingStartTime=St(),c.sibling=null,m=ut.current,it(ut,y?m&1|2:m&1),c):(Ht(c),null);case 22:case 23:return If(),y=c.memoizedState!==null,a!==null&&a.memoizedState!==null!==y&&(c.flags|=8192),y&&(c.mode&1)!==0?(En&1073741824)!==0&&(Ht(c),c.subtreeFlags&6&&(c.flags|=8192)):Ht(c),null;case 24:return null;case 25:return null}throw Error(t(156,c.tag))}function cL(a,c){switch(Md(c),c.tag){case 1:return rn(c.type)&&Tl(),a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 3:return Ii(),lt(nn),lt(Vt),qd(),a=c.flags,(a&65536)!==0&&(a&128)===0?(c.flags=a&-65537|128,c):null;case 5:return Wd(c),null;case 13:if(lt(ut),a=c.memoizedState,a!==null&&a.dehydrated!==null){if(c.alternate===null)throw Error(t(340));wi()}return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 19:return lt(ut),null;case 4:return Ii(),null;case 10:return Vd(c.type._context),null;case 22:case 23:return If(),null;case 24:return null;default:return null}}var Vl=!1,Kt=!1,uL=typeof WeakSet=="function"?WeakSet:Set,xe=null;function Ci(a,c){var m=a.ref;if(m!==null)if(typeof m=="function")try{m(null)}catch(y){yt(a,c,y)}else m.current=null}function gf(a,c,m){try{m()}catch(y){yt(a,c,y)}}var dy=!1;function dL(a,c){if(Rd=ll,a=Gg(),vd(a)){if("selectionStart"in a)var m={start:a.selectionStart,end:a.selectionEnd};else e:{m=(m=a.ownerDocument)&&m.defaultView||window;var y=m.getSelection&&m.getSelection();if(y&&y.rangeCount!==0){m=y.anchorNode;var T=y.anchorOffset,w=y.focusNode;y=y.focusOffset;try{m.nodeType,w.nodeType}catch{m=null;break e}var k=0,B=-1,j=-1,X=0,ae=0,le=a,oe=null;t:for(;;){for(var pe;le!==m||T!==0&&le.nodeType!==3||(B=k+T),le!==w||y!==0&&le.nodeType!==3||(j=k+y),le.nodeType===3&&(k+=le.nodeValue.length),(pe=le.firstChild)!==null;)oe=le,le=pe;for(;;){if(le===a)break t;if(oe===m&&++X===T&&(B=k),oe===w&&++ae===y&&(j=k),(pe=le.nextSibling)!==null)break;le=oe,oe=le.parentNode}le=pe}m=B===-1||j===-1?null:{start:B,end:j}}else m=null}m=m||{start:0,end:0}}else m=null;for(Id={focusedElem:a,selectionRange:m},ll=!1,xe=c;xe!==null;)if(c=xe,a=c.child,(c.subtreeFlags&1028)!==0&&a!==null)a.return=c,xe=a;else for(;xe!==null;){c=xe;try{var Se=c.alternate;if((c.flags&1024)!==0)switch(c.tag){case 0:case 11:case 15:break;case 1:if(Se!==null){var be=Se.memoizedProps,Et=Se.memoizedState,W=c.stateNode,V=W.getSnapshotBeforeUpdate(c.elementType===c.type?be:zn(c.type,be),Et);W.__reactInternalSnapshotBeforeUpdate=V}break;case 3:var Y=c.stateNode.containerInfo;Y.nodeType===1?Y.textContent="":Y.nodeType===9&&Y.documentElement&&Y.removeChild(Y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(de){yt(c,c.return,de)}if(a=c.sibling,a!==null){a.return=c.return,xe=a;break}xe=c.return}return Se=dy,dy=!1,Se}function Ko(a,c,m){var y=c.updateQueue;if(y=y!==null?y.lastEffect:null,y!==null){var T=y=y.next;do{if((T.tag&a)===a){var w=T.destroy;T.destroy=void 0,w!==void 0&&gf(c,m,w)}T=T.next}while(T!==y)}}function Gl(a,c){if(c=c.updateQueue,c=c!==null?c.lastEffect:null,c!==null){var m=c=c.next;do{if((m.tag&a)===a){var y=m.create;m.destroy=y()}m=m.next}while(m!==c)}}function yf(a){var c=a.ref;if(c!==null){var m=a.stateNode;switch(a.tag){case 5:a=m;break;default:a=m}typeof c=="function"?c(a):c.current=a}}function fy(a){var c=a.alternate;c!==null&&(a.alternate=null,fy(c)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(c=a.stateNode,c!==null&&(delete c[or],delete c[No],delete c[Pd],delete c[WA],delete c[YA])),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}function hy(a){return a.tag===5||a.tag===3||a.tag===4}function my(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||hy(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function xf(a,c,m){var y=a.tag;if(y===5||y===6)a=a.stateNode,c?m.nodeType===8?m.parentNode.insertBefore(a,c):m.insertBefore(a,c):(m.nodeType===8?(c=m.parentNode,c.insertBefore(a,m)):(c=m,c.appendChild(a)),m=m._reactRootContainer,m!=null||c.onclick!==null||(c.onclick=Sl));else if(y!==4&&(a=a.child,a!==null))for(xf(a,c,m),a=a.sibling;a!==null;)xf(a,c,m),a=a.sibling}function vf(a,c,m){var y=a.tag;if(y===5||y===6)a=a.stateNode,c?m.insertBefore(a,c):m.appendChild(a);else if(y!==4&&(a=a.child,a!==null))for(vf(a,c,m),a=a.sibling;a!==null;)vf(a,c,m),a=a.sibling}var Mt=null,Wn=!1;function as(a,c,m){for(m=m.child;m!==null;)py(a,c,m),m=m.sibling}function py(a,c,m){if(ir&&typeof ir.onCommitFiberUnmount=="function")try{ir.onCommitFiberUnmount(nl,m)}catch{}switch(m.tag){case 5:Kt||Ci(m,c);case 6:var y=Mt,T=Wn;Mt=null,as(a,c,m),Mt=y,Wn=T,Mt!==null&&(Wn?(a=Mt,m=m.stateNode,a.nodeType===8?a.parentNode.removeChild(m):a.removeChild(m)):Mt.removeChild(m.stateNode));break;case 18:Mt!==null&&(Wn?(a=Mt,m=m.stateNode,a.nodeType===8?_d(a.parentNode,m):a.nodeType===1&&_d(a,m),bo(a)):_d(Mt,m.stateNode));break;case 4:y=Mt,T=Wn,Mt=m.stateNode.containerInfo,Wn=!0,as(a,c,m),Mt=y,Wn=T;break;case 0:case 11:case 14:case 15:if(!Kt&&(y=m.updateQueue,y!==null&&(y=y.lastEffect,y!==null))){T=y=y.next;do{var w=T,k=w.destroy;w=w.tag,k!==void 0&&((w&2)!==0||(w&4)!==0)&&gf(m,c,k),T=T.next}while(T!==y)}as(a,c,m);break;case 1:if(!Kt&&(Ci(m,c),y=m.stateNode,typeof y.componentWillUnmount=="function"))try{y.props=m.memoizedProps,y.state=m.memoizedState,y.componentWillUnmount()}catch(B){yt(m,c,B)}as(a,c,m);break;case 21:as(a,c,m);break;case 22:m.mode&1?(Kt=(y=Kt)||m.memoizedState!==null,as(a,c,m),Kt=y):as(a,c,m);break;default:as(a,c,m)}}function gy(a){var c=a.updateQueue;if(c!==null){a.updateQueue=null;var m=a.stateNode;m===null&&(m=a.stateNode=new uL),c.forEach(function(y){var T=SL.bind(null,a,y);m.has(y)||(m.add(y),y.then(T,T))})}}function Yn(a,c){var m=c.deletions;if(m!==null)for(var y=0;y<m.length;y++){var T=m[y];try{var w=a,k=c,B=k;e:for(;B!==null;){switch(B.tag){case 5:Mt=B.stateNode,Wn=!1;break e;case 3:Mt=B.stateNode.containerInfo,Wn=!0;break e;case 4:Mt=B.stateNode.containerInfo,Wn=!0;break e}B=B.return}if(Mt===null)throw Error(t(160));py(w,k,T),Mt=null,Wn=!1;var j=T.alternate;j!==null&&(j.return=null),T.return=null}catch(X){yt(T,c,X)}}if(c.subtreeFlags&12854)for(c=c.child;c!==null;)yy(c,a),c=c.sibling}function yy(a,c){var m=a.alternate,y=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:if(Yn(c,a),cr(a),y&4){try{Ko(3,a,a.return),Gl(3,a)}catch(be){yt(a,a.return,be)}try{Ko(5,a,a.return)}catch(be){yt(a,a.return,be)}}break;case 1:Yn(c,a),cr(a),y&512&&m!==null&&Ci(m,m.return);break;case 5:if(Yn(c,a),cr(a),y&512&&m!==null&&Ci(m,m.return),a.flags&32){var T=a.stateNode;try{Xt(T,"")}catch(be){yt(a,a.return,be)}}if(y&4&&(T=a.stateNode,T!=null)){var w=a.memoizedProps,k=m!==null?m.memoizedProps:w,B=a.type,j=a.updateQueue;if(a.updateQueue=null,j!==null)try{B==="input"&&w.type==="radio"&&w.name!=null&&me(T,w),ao(B,k);var X=ao(B,w);for(k=0;k<j.length;k+=2){var ae=j[k],le=j[k+1];ae==="style"?Xa(T,le):ae==="dangerouslySetInnerHTML"?yn(T,le):ae==="children"?Xt(T,le):L(T,ae,le,X)}switch(B){case"input":Me(T,w);break;case"textarea":pn(T,w);break;case"select":var oe=T._wrapperState.wasMultiple;T._wrapperState.wasMultiple=!!w.multiple;var pe=w.value;pe!=null?Xe(T,!!w.multiple,pe,!1):oe!==!!w.multiple&&(w.defaultValue!=null?Xe(T,!!w.multiple,w.defaultValue,!0):Xe(T,!!w.multiple,w.multiple?[]:"",!1))}T[No]=w}catch(be){yt(a,a.return,be)}}break;case 6:if(Yn(c,a),cr(a),y&4){if(a.stateNode===null)throw Error(t(162));T=a.stateNode,w=a.memoizedProps;try{T.nodeValue=w}catch(be){yt(a,a.return,be)}}break;case 3:if(Yn(c,a),cr(a),y&4&&m!==null&&m.memoizedState.isDehydrated)try{bo(c.containerInfo)}catch(be){yt(a,a.return,be)}break;case 4:Yn(c,a),cr(a);break;case 13:Yn(c,a),cr(a),T=a.child,T.flags&8192&&(w=T.memoizedState!==null,T.stateNode.isHidden=w,!w||T.alternate!==null&&T.alternate.memoizedState!==null||(Tf=St())),y&4&&gy(a);break;case 22:if(ae=m!==null&&m.memoizedState!==null,a.mode&1?(Kt=(X=Kt)||ae,Yn(c,a),Kt=X):Yn(c,a),cr(a),y&8192){if(X=a.memoizedState!==null,(a.stateNode.isHidden=X)&&!ae&&(a.mode&1)!==0)for(xe=a,ae=a.child;ae!==null;){for(le=xe=ae;xe!==null;){switch(oe=xe,pe=oe.child,oe.tag){case 0:case 11:case 14:case 15:Ko(4,oe,oe.return);break;case 1:Ci(oe,oe.return);var Se=oe.stateNode;if(typeof Se.componentWillUnmount=="function"){y=oe,m=oe.return;try{c=y,Se.props=c.memoizedProps,Se.state=c.memoizedState,Se.componentWillUnmount()}catch(be){yt(y,m,be)}}break;case 5:Ci(oe,oe.return);break;case 22:if(oe.memoizedState!==null){Sy(le);continue}}pe!==null?(pe.return=oe,xe=pe):Sy(le)}ae=ae.sibling}e:for(ae=null,le=a;;){if(le.tag===5){if(ae===null){ae=le;try{T=le.stateNode,X?(w=T.style,typeof w.setProperty=="function"?w.setProperty("display","none","important"):w.display="none"):(B=le.stateNode,j=le.memoizedProps.style,k=j!=null&&j.hasOwnProperty("display")?j.display:null,B.style.display=Cs("display",k))}catch(be){yt(a,a.return,be)}}}else if(le.tag===6){if(ae===null)try{le.stateNode.nodeValue=X?"":le.memoizedProps}catch(be){yt(a,a.return,be)}}else if((le.tag!==22&&le.tag!==23||le.memoizedState===null||le===a)&&le.child!==null){le.child.return=le,le=le.child;continue}if(le===a)break e;for(;le.sibling===null;){if(le.return===null||le.return===a)break e;ae===le&&(ae=null),le=le.return}ae===le&&(ae=null),le.sibling.return=le.return,le=le.sibling}}break;case 19:Yn(c,a),cr(a),y&4&&gy(a);break;case 21:break;default:Yn(c,a),cr(a)}}function cr(a){var c=a.flags;if(c&2){try{e:{for(var m=a.return;m!==null;){if(hy(m)){var y=m;break e}m=m.return}throw Error(t(160))}switch(y.tag){case 5:var T=y.stateNode;y.flags&32&&(Xt(T,""),y.flags&=-33);var w=my(a);vf(a,w,T);break;case 3:case 4:var k=y.stateNode.containerInfo,B=my(a);xf(a,B,k);break;default:throw Error(t(161))}}catch(j){yt(a,a.return,j)}a.flags&=-3}c&4096&&(a.flags&=-4097)}function fL(a,c,m){xe=a,xy(a)}function xy(a,c,m){for(var y=(a.mode&1)!==0;xe!==null;){var T=xe,w=T.child;if(T.tag===22&&y){var k=T.memoizedState!==null||Vl;if(!k){var B=T.alternate,j=B!==null&&B.memoizedState!==null||Kt;B=Vl;var X=Kt;if(Vl=k,(Kt=j)&&!X)for(xe=T;xe!==null;)k=xe,j=k.child,k.tag===22&&k.memoizedState!==null?Ey(T):j!==null?(j.return=k,xe=j):Ey(T);for(;w!==null;)xe=w,xy(w),w=w.sibling;xe=T,Vl=B,Kt=X}vy(a)}else(T.subtreeFlags&8772)!==0&&w!==null?(w.return=T,xe=w):vy(a)}}function vy(a){for(;xe!==null;){var c=xe;if((c.flags&8772)!==0){var m=c.alternate;try{if((c.flags&8772)!==0)switch(c.tag){case 0:case 11:case 15:Kt||Gl(5,c);break;case 1:var y=c.stateNode;if(c.flags&4&&!Kt)if(m===null)y.componentDidMount();else{var T=c.elementType===c.type?m.memoizedProps:zn(c.type,m.memoizedProps);y.componentDidUpdate(T,m.memoizedState,y.__reactInternalSnapshotBeforeUpdate)}var w=c.updateQueue;w!==null&&S0(c,w,y);break;case 3:var k=c.updateQueue;if(k!==null){if(m=null,c.child!==null)switch(c.child.tag){case 5:m=c.child.stateNode;break;case 1:m=c.child.stateNode}S0(c,k,m)}break;case 5:var B=c.stateNode;if(m===null&&c.flags&4){m=B;var j=c.memoizedProps;switch(c.type){case"button":case"input":case"select":case"textarea":j.autoFocus&&m.focus();break;case"img":j.src&&(m.src=j.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(c.memoizedState===null){var X=c.alternate;if(X!==null){var ae=X.memoizedState;if(ae!==null){var le=ae.dehydrated;le!==null&&bo(le)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}Kt||c.flags&512&&yf(c)}catch(oe){yt(c,c.return,oe)}}if(c===a){xe=null;break}if(m=c.sibling,m!==null){m.return=c.return,xe=m;break}xe=c.return}}function Sy(a){for(;xe!==null;){var c=xe;if(c===a){xe=null;break}var m=c.sibling;if(m!==null){m.return=c.return,xe=m;break}xe=c.return}}function Ey(a){for(;xe!==null;){var c=xe;try{switch(c.tag){case 0:case 11:case 15:var m=c.return;try{Gl(4,c)}catch(j){yt(c,m,j)}break;case 1:var y=c.stateNode;if(typeof y.componentDidMount=="function"){var T=c.return;try{y.componentDidMount()}catch(j){yt(c,T,j)}}var w=c.return;try{yf(c)}catch(j){yt(c,w,j)}break;case 5:var k=c.return;try{yf(c)}catch(j){yt(c,k,j)}}}catch(j){yt(c,c.return,j)}if(c===a){xe=null;break}var B=c.sibling;if(B!==null){B.return=c.return,xe=B;break}xe=c.return}}var hL=Math.ceil,Hl=I.ReactCurrentDispatcher,Sf=I.ReactCurrentOwner,Mn=I.ReactCurrentBatchConfig,Ke=0,Dt=null,At=null,Ft=0,En=0,_i=ns(0),It=0,zo=null,Us=0,Kl=0,Ef=0,Wo=null,on=null,Tf=0,Pi=1/0,Nr=null,zl=!1,bf=null,ls=null,Wl=!1,cs=null,Yl=0,Yo=0,wf=null,ql=-1,Xl=0;function Zt(){return(Ke&6)!==0?St():ql!==-1?ql:ql=St()}function us(a){return(a.mode&1)===0?1:(Ke&2)!==0&&Ft!==0?Ft&-Ft:XA.transition!==null?(Xl===0&&(Xl=mg()),Xl):(a=Qe,a!==0||(a=window.event,a=a===void 0?16:bg(a.type)),a)}function qn(a,c,m,y){if(50<Yo)throw Yo=0,wf=null,Error(t(185));xo(a,m,y),((Ke&2)===0||a!==Dt)&&(a===Dt&&((Ke&2)===0&&(Kl|=m),It===4&&ds(a,Ft)),an(a,y),m===1&&Ke===0&&(c.mode&1)===0&&(Pi=St()+500,wl&&ss()))}function an(a,c){var m=a.callbackNode;Xw(a,c);var y=il(a,a===Dt?Ft:0);if(y===0)m!==null&&dg(m),a.callbackNode=null,a.callbackPriority=0;else if(c=y&-y,a.callbackPriority!==c){if(m!=null&&dg(m),c===1)a.tag===0?qA(by.bind(null,a)):l0(by.bind(null,a)),KA(function(){(Ke&6)===0&&ss()}),m=null;else{switch(pg(y)){case 1:m=nd;break;case 4:m=fg;break;case 16:m=tl;break;case 536870912:m=hg;break;default:m=tl}m=_y(m,Ty.bind(null,a))}a.callbackPriority=c,a.callbackNode=m}}function Ty(a,c){if(ql=-1,Xl=0,(Ke&6)!==0)throw Error(t(327));var m=a.callbackNode;if(Di()&&a.callbackNode!==m)return null;var y=il(a,a===Dt?Ft:0);if(y===0)return null;if((y&30)!==0||(y&a.expiredLanes)!==0||c)c=Ql(a,y);else{c=y;var T=Ke;Ke|=2;var w=Ay();(Dt!==a||Ft!==c)&&(Nr=null,Pi=St()+500,js(a,c));do try{gL();break}catch(B){wy(a,B)}while(!0);jd(),Hl.current=w,Ke=T,At!==null?c=0:(Dt=null,Ft=0,c=It)}if(c!==0){if(c===2&&(T=rd(a),T!==0&&(y=T,c=Af(a,T))),c===1)throw m=zo,js(a,0),ds(a,y),an(a,St()),m;if(c===6)ds(a,y);else{if(T=a.current.alternate,(y&30)===0&&!mL(T)&&(c=Ql(a,y),c===2&&(w=rd(a),w!==0&&(y=w,c=Af(a,w))),c===1))throw m=zo,js(a,0),ds(a,y),an(a,St()),m;switch(a.finishedWork=T,a.finishedLanes=y,c){case 0:case 1:throw Error(t(345));case 2:Vs(a,on,Nr);break;case 3:if(ds(a,y),(y&130023424)===y&&(c=Tf+500-St(),10<c)){if(il(a,0)!==0)break;if(T=a.suspendedLanes,(T&y)!==y){Zt(),a.pingedLanes|=a.suspendedLanes&T;break}a.timeoutHandle=Cd(Vs.bind(null,a,on,Nr),c);break}Vs(a,on,Nr);break;case 4:if(ds(a,y),(y&4194240)===y)break;for(c=a.eventTimes,T=-1;0<y;){var k=31-Gn(y);w=1<<k,k=c[k],k>T&&(T=k),y&=~w}if(y=T,y=St()-y,y=(120>y?120:480>y?480:1080>y?1080:1920>y?1920:3e3>y?3e3:4320>y?4320:1960*hL(y/1960))-y,10<y){a.timeoutHandle=Cd(Vs.bind(null,a,on,Nr),y);break}Vs(a,on,Nr);break;case 5:Vs(a,on,Nr);break;default:throw Error(t(329))}}}return an(a,St()),a.callbackNode===m?Ty.bind(null,a):null}function Af(a,c){var m=Wo;return a.current.memoizedState.isDehydrated&&(js(a,c).flags|=256),a=Ql(a,c),a!==2&&(c=on,on=m,c!==null&&Lf(c)),a}function Lf(a){on===null?on=a:on.push.apply(on,a)}function mL(a){for(var c=a;;){if(c.flags&16384){var m=c.updateQueue;if(m!==null&&(m=m.stores,m!==null))for(var y=0;y<m.length;y++){var T=m[y],w=T.getSnapshot;T=T.value;try{if(!Hn(w(),T))return!1}catch{return!1}}}if(m=c.child,c.subtreeFlags&16384&&m!==null)m.return=c,c=m;else{if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function ds(a,c){for(c&=~Ef,c&=~Kl,a.suspendedLanes|=c,a.pingedLanes&=~c,a=a.expirationTimes;0<c;){var m=31-Gn(c),y=1<<m;a[m]=-1,c&=~y}}function by(a){if((Ke&6)!==0)throw Error(t(327));Di();var c=il(a,0);if((c&1)===0)return an(a,St()),null;var m=Ql(a,c);if(a.tag!==0&&m===2){var y=rd(a);y!==0&&(c=y,m=Af(a,y))}if(m===1)throw m=zo,js(a,0),ds(a,c),an(a,St()),m;if(m===6)throw Error(t(345));return a.finishedWork=a.current.alternate,a.finishedLanes=c,Vs(a,on,Nr),an(a,St()),null}function Rf(a,c){var m=Ke;Ke|=1;try{return a(c)}finally{Ke=m,Ke===0&&(Pi=St()+500,wl&&ss())}}function $s(a){cs!==null&&cs.tag===0&&(Ke&6)===0&&Di();var c=Ke;Ke|=1;var m=Mn.transition,y=Qe;try{if(Mn.transition=null,Qe=1,a)return a()}finally{Qe=y,Mn.transition=m,Ke=c,(Ke&6)===0&&ss()}}function If(){En=_i.current,lt(_i)}function js(a,c){a.finishedWork=null,a.finishedLanes=0;var m=a.timeoutHandle;if(m!==-1&&(a.timeoutHandle=-1,HA(m)),At!==null)for(m=At.return;m!==null;){var y=m;switch(Md(y),y.tag){case 1:y=y.type.childContextTypes,y!=null&&Tl();break;case 3:Ii(),lt(nn),lt(Vt),qd();break;case 5:Wd(y);break;case 4:Ii();break;case 13:lt(ut);break;case 19:lt(ut);break;case 10:Vd(y.type._context);break;case 22:case 23:If()}m=m.return}if(Dt=a,At=a=fs(a.current,null),Ft=En=c,It=0,zo=null,Ef=Kl=Us=0,on=Wo=null,Ms!==null){for(c=0;c<Ms.length;c++)if(m=Ms[c],y=m.interleaved,y!==null){m.interleaved=null;var T=y.next,w=m.pending;if(w!==null){var k=w.next;w.next=T,y.next=k}m.pending=y}Ms=null}return a}function wy(a,c){do{var m=At;try{if(jd(),Nl.current=Bl,Ol){for(var y=dt.memoizedState;y!==null;){var T=y.queue;T!==null&&(T.pending=null),y=y.next}Ol=!1}if(Bs=0,Pt=Rt=dt=null,$o=!1,jo=0,Sf.current=null,m===null||m.return===null){It=1,zo=c,At=null;break}e:{var w=a,k=m.return,B=m,j=c;if(c=Ft,B.flags|=32768,j!==null&&typeof j=="object"&&typeof j.then=="function"){var X=j,ae=B,le=ae.tag;if((ae.mode&1)===0&&(le===0||le===11||le===15)){var oe=ae.alternate;oe?(ae.updateQueue=oe.updateQueue,ae.memoizedState=oe.memoizedState,ae.lanes=oe.lanes):(ae.updateQueue=null,ae.memoizedState=null)}var pe=q0(k);if(pe!==null){pe.flags&=-257,X0(pe,k,B,w,c),pe.mode&1&&Y0(w,X,c),c=pe,j=X;var Se=c.updateQueue;if(Se===null){var be=new Set;be.add(j),c.updateQueue=be}else Se.add(j);break e}else{if((c&1)===0){Y0(w,X,c),kf();break e}j=Error(t(426))}}else if(ct&&B.mode&1){var Et=q0(k);if(Et!==null){(Et.flags&65536)===0&&(Et.flags|=256),X0(Et,k,B,w,c),Ud(ki(j,B));break e}}w=j=ki(j,B),It!==4&&(It=2),Wo===null?Wo=[w]:Wo.push(w),w=k;do{switch(w.tag){case 3:w.flags|=65536,c&=-c,w.lanes|=c;var W=z0(w,j,c);v0(w,W);break e;case 1:B=j;var V=w.type,Y=w.stateNode;if((w.flags&128)===0&&(typeof V.getDerivedStateFromError=="function"||Y!==null&&typeof Y.componentDidCatch=="function"&&(ls===null||!ls.has(Y)))){w.flags|=65536,c&=-c,w.lanes|=c;var de=W0(w,B,c);v0(w,de);break e}}w=w.return}while(w!==null)}Ry(m)}catch(Ae){c=Ae,At===m&&m!==null&&(At=m=m.return);continue}break}while(!0)}function Ay(){var a=Hl.current;return Hl.current=Bl,a===null?Bl:a}function kf(){(It===0||It===3||It===2)&&(It=4),Dt===null||(Us&268435455)===0&&(Kl&268435455)===0||ds(Dt,Ft)}function Ql(a,c){var m=Ke;Ke|=2;var y=Ay();(Dt!==a||Ft!==c)&&(Nr=null,js(a,c));do try{pL();break}catch(T){wy(a,T)}while(!0);if(jd(),Ke=m,Hl.current=y,At!==null)throw Error(t(261));return Dt=null,Ft=0,It}function pL(){for(;At!==null;)Ly(At)}function gL(){for(;At!==null&&!jw();)Ly(At)}function Ly(a){var c=Cy(a.alternate,a,En);a.memoizedProps=a.pendingProps,c===null?Ry(a):At=c,Sf.current=null}function Ry(a){var c=a;do{var m=c.alternate;if(a=c.return,(c.flags&32768)===0){if(m=lL(m,c,En),m!==null){At=m;return}}else{if(m=cL(m,c),m!==null){m.flags&=32767,At=m;return}if(a!==null)a.flags|=32768,a.subtreeFlags=0,a.deletions=null;else{It=6,At=null;return}}if(c=c.sibling,c!==null){At=c;return}At=c=a}while(c!==null);It===0&&(It=5)}function Vs(a,c,m){var y=Qe,T=Mn.transition;try{Mn.transition=null,Qe=1,yL(a,c,m,y)}finally{Mn.transition=T,Qe=y}return null}function yL(a,c,m,y){do Di();while(cs!==null);if((Ke&6)!==0)throw Error(t(327));m=a.finishedWork;var T=a.finishedLanes;if(m===null)return null;if(a.finishedWork=null,a.finishedLanes=0,m===a.current)throw Error(t(177));a.callbackNode=null,a.callbackPriority=0;var w=m.lanes|m.childLanes;if(Qw(a,w),a===Dt&&(At=Dt=null,Ft=0),(m.subtreeFlags&2064)===0&&(m.flags&2064)===0||Wl||(Wl=!0,_y(tl,function(){return Di(),null})),w=(m.flags&15990)!==0,(m.subtreeFlags&15990)!==0||w){w=Mn.transition,Mn.transition=null;var k=Qe;Qe=1;var B=Ke;Ke|=4,Sf.current=null,dL(a,m),yy(m,a),FA(Id),ll=!!Rd,Id=Rd=null,a.current=m,fL(m),Vw(),Ke=B,Qe=k,Mn.transition=w}else a.current=m;if(Wl&&(Wl=!1,cs=a,Yl=T),w=a.pendingLanes,w===0&&(ls=null),Kw(m.stateNode),an(a,St()),c!==null)for(y=a.onRecoverableError,m=0;m<c.length;m++)T=c[m],y(T.value,{componentStack:T.stack,digest:T.digest});if(zl)throw zl=!1,a=bf,bf=null,a;return(Yl&1)!==0&&a.tag!==0&&Di(),w=a.pendingLanes,(w&1)!==0?a===wf?Yo++:(Yo=0,wf=a):Yo=0,ss(),null}function Di(){if(cs!==null){var a=pg(Yl),c=Mn.transition,m=Qe;try{if(Mn.transition=null,Qe=16>a?16:a,cs===null)var y=!1;else{if(a=cs,cs=null,Yl=0,(Ke&6)!==0)throw Error(t(331));var T=Ke;for(Ke|=4,xe=a.current;xe!==null;){var w=xe,k=w.child;if((xe.flags&16)!==0){var B=w.deletions;if(B!==null){for(var j=0;j<B.length;j++){var X=B[j];for(xe=X;xe!==null;){var ae=xe;switch(ae.tag){case 0:case 11:case 15:Ko(8,ae,w)}var le=ae.child;if(le!==null)le.return=ae,xe=le;else for(;xe!==null;){ae=xe;var oe=ae.sibling,pe=ae.return;if(fy(ae),ae===X){xe=null;break}if(oe!==null){oe.return=pe,xe=oe;break}xe=pe}}}var Se=w.alternate;if(Se!==null){var be=Se.child;if(be!==null){Se.child=null;do{var Et=be.sibling;be.sibling=null,be=Et}while(be!==null)}}xe=w}}if((w.subtreeFlags&2064)!==0&&k!==null)k.return=w,xe=k;else e:for(;xe!==null;){if(w=xe,(w.flags&2048)!==0)switch(w.tag){case 0:case 11:case 15:Ko(9,w,w.return)}var W=w.sibling;if(W!==null){W.return=w.return,xe=W;break e}xe=w.return}}var V=a.current;for(xe=V;xe!==null;){k=xe;var Y=k.child;if((k.subtreeFlags&2064)!==0&&Y!==null)Y.return=k,xe=Y;else e:for(k=V;xe!==null;){if(B=xe,(B.flags&2048)!==0)try{switch(B.tag){case 0:case 11:case 15:Gl(9,B)}}catch(Ae){yt(B,B.return,Ae)}if(B===k){xe=null;break e}var de=B.sibling;if(de!==null){de.return=B.return,xe=de;break e}xe=B.return}}if(Ke=T,ss(),ir&&typeof ir.onPostCommitFiberRoot=="function")try{ir.onPostCommitFiberRoot(nl,a)}catch{}y=!0}return y}finally{Qe=m,Mn.transition=c}}return!1}function Iy(a,c,m){c=ki(m,c),c=z0(a,c,1),a=os(a,c,1),c=Zt(),a!==null&&(xo(a,1,c),an(a,c))}function yt(a,c,m){if(a.tag===3)Iy(a,a,m);else for(;c!==null;){if(c.tag===3){Iy(c,a,m);break}else if(c.tag===1){var y=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof y.componentDidCatch=="function"&&(ls===null||!ls.has(y))){a=ki(m,a),a=W0(c,a,1),c=os(c,a,1),a=Zt(),c!==null&&(xo(c,1,a),an(c,a));break}}c=c.return}}function xL(a,c,m){var y=a.pingCache;y!==null&&y.delete(c),c=Zt(),a.pingedLanes|=a.suspendedLanes&m,Dt===a&&(Ft&m)===m&&(It===4||It===3&&(Ft&130023424)===Ft&&500>St()-Tf?js(a,0):Ef|=m),an(a,c)}function ky(a,c){c===0&&((a.mode&1)===0?c=1:(c=sl,sl<<=1,(sl&130023424)===0&&(sl=4194304)));var m=Zt();a=_r(a,c),a!==null&&(xo(a,c,m),an(a,m))}function vL(a){var c=a.memoizedState,m=0;c!==null&&(m=c.retryLane),ky(a,m)}function SL(a,c){var m=0;switch(a.tag){case 13:var y=a.stateNode,T=a.memoizedState;T!==null&&(m=T.retryLane);break;case 19:y=a.stateNode;break;default:throw Error(t(314))}y!==null&&y.delete(c),ky(a,m)}var Cy;Cy=function(a,c,m){if(a!==null)if(a.memoizedProps!==c.pendingProps||nn.current)sn=!0;else{if((a.lanes&m)===0&&(c.flags&128)===0)return sn=!1,aL(a,c,m);sn=(a.flags&131072)!==0}else sn=!1,ct&&(c.flags&1048576)!==0&&c0(c,Ll,c.index);switch(c.lanes=0,c.tag){case 2:var y=c.type;jl(a,c),a=c.pendingProps;var T=Ei(c,Vt.current);Ri(c,m),T=Jd(null,c,y,a,T,m);var w=Zd();return c.flags|=1,typeof T=="object"&&T!==null&&typeof T.render=="function"&&T.$$typeof===void 0?(c.tag=1,c.memoizedState=null,c.updateQueue=null,rn(y)?(w=!0,bl(c)):w=!1,c.memoizedState=T.state!==null&&T.state!==void 0?T.state:null,Kd(c),T.updater=Ul,c.stateNode=T,T._reactInternals=c,of(c,y,a,m),c=uf(null,c,y,!0,w,m)):(c.tag=0,ct&&w&&Od(c),Jt(null,c,T,m),c=c.child),c;case 16:y=c.elementType;e:{switch(jl(a,c),a=c.pendingProps,T=y._init,y=T(y._payload),c.type=y,T=c.tag=TL(y),a=zn(y,a),T){case 0:c=cf(null,c,y,a,m);break e;case 1:c=ny(null,c,y,a,m);break e;case 11:c=Q0(null,c,y,a,m);break e;case 14:c=J0(null,c,y,zn(y.type,a),m);break e}throw Error(t(306,y,""))}return c;case 0:return y=c.type,T=c.pendingProps,T=c.elementType===y?T:zn(y,T),cf(a,c,y,T,m);case 1:return y=c.type,T=c.pendingProps,T=c.elementType===y?T:zn(y,T),ny(a,c,y,T,m);case 3:e:{if(ry(c),a===null)throw Error(t(387));y=c.pendingProps,w=c.memoizedState,T=w.element,x0(a,c),Pl(c,y,null,m);var k=c.memoizedState;if(y=k.element,w.isDehydrated)if(w={element:y,isDehydrated:!1,cache:k.cache,pendingSuspenseBoundaries:k.pendingSuspenseBoundaries,transitions:k.transitions},c.updateQueue.baseState=w,c.memoizedState=w,c.flags&256){T=ki(Error(t(423)),c),c=sy(a,c,y,m,T);break e}else if(y!==T){T=ki(Error(t(424)),c),c=sy(a,c,y,m,T);break e}else for(Sn=ts(c.stateNode.containerInfo.firstChild),vn=c,ct=!0,Kn=null,m=g0(c,null,y,m),c.child=m;m;)m.flags=m.flags&-3|4096,m=m.sibling;else{if(wi(),y===T){c=Dr(a,c,m);break e}Jt(a,c,y,m)}c=c.child}return c;case 5:return E0(c),a===null&&Bd(c),y=c.type,T=c.pendingProps,w=a!==null?a.memoizedProps:null,k=T.children,kd(y,T)?k=null:w!==null&&kd(y,w)&&(c.flags|=32),ty(a,c),Jt(a,c,k,m),c.child;case 6:return a===null&&Bd(c),null;case 13:return iy(a,c,m);case 4:return zd(c,c.stateNode.containerInfo),y=c.pendingProps,a===null?c.child=Ai(c,null,y,m):Jt(a,c,y,m),c.child;case 11:return y=c.type,T=c.pendingProps,T=c.elementType===y?T:zn(y,T),Q0(a,c,y,T,m);case 7:return Jt(a,c,c.pendingProps,m),c.child;case 8:return Jt(a,c,c.pendingProps.children,m),c.child;case 12:return Jt(a,c,c.pendingProps.children,m),c.child;case 10:e:{if(y=c.type._context,T=c.pendingProps,w=c.memoizedProps,k=T.value,it(kl,y._currentValue),y._currentValue=k,w!==null)if(Hn(w.value,k)){if(w.children===T.children&&!nn.current){c=Dr(a,c,m);break e}}else for(w=c.child,w!==null&&(w.return=c);w!==null;){var B=w.dependencies;if(B!==null){k=w.child;for(var j=B.firstContext;j!==null;){if(j.context===y){if(w.tag===1){j=Pr(-1,m&-m),j.tag=2;var X=w.updateQueue;if(X!==null){X=X.shared;var ae=X.pending;ae===null?j.next=j:(j.next=ae.next,ae.next=j),X.pending=j}}w.lanes|=m,j=w.alternate,j!==null&&(j.lanes|=m),Gd(w.return,m,c),B.lanes|=m;break}j=j.next}}else if(w.tag===10)k=w.type===c.type?null:w.child;else if(w.tag===18){if(k=w.return,k===null)throw Error(t(341));k.lanes|=m,B=k.alternate,B!==null&&(B.lanes|=m),Gd(k,m,c),k=w.sibling}else k=w.child;if(k!==null)k.return=w;else for(k=w;k!==null;){if(k===c){k=null;break}if(w=k.sibling,w!==null){w.return=k.return,k=w;break}k=k.return}w=k}Jt(a,c,T.children,m),c=c.child}return c;case 9:return T=c.type,y=c.pendingProps.children,Ri(c,m),T=Nn(T),y=y(T),c.flags|=1,Jt(a,c,y,m),c.child;case 14:return y=c.type,T=zn(y,c.pendingProps),T=zn(y.type,T),J0(a,c,y,T,m);case 15:return Z0(a,c,c.type,c.pendingProps,m);case 17:return y=c.type,T=c.pendingProps,T=c.elementType===y?T:zn(y,T),jl(a,c),c.tag=1,rn(y)?(a=!0,bl(c)):a=!1,Ri(c,m),H0(c,y,T),of(c,y,T,m),uf(null,c,y,!0,a,m);case 19:return ay(a,c,m);case 22:return ey(a,c,m)}throw Error(t(156,c.tag))};function _y(a,c){return ug(a,c)}function EL(a,c,m,y){this.tag=a,this.key=m,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=y,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Fn(a,c,m,y){return new EL(a,c,m,y)}function Cf(a){return a=a.prototype,!(!a||!a.isReactComponent)}function TL(a){if(typeof a=="function")return Cf(a)?1:0;if(a!=null){if(a=a.$$typeof,a===Z)return 11;if(a===ne)return 14}return 2}function fs(a,c){var m=a.alternate;return m===null?(m=Fn(a.tag,c,a.key,a.mode),m.elementType=a.elementType,m.type=a.type,m.stateNode=a.stateNode,m.alternate=a,a.alternate=m):(m.pendingProps=c,m.type=a.type,m.flags=0,m.subtreeFlags=0,m.deletions=null),m.flags=a.flags&14680064,m.childLanes=a.childLanes,m.lanes=a.lanes,m.child=a.child,m.memoizedProps=a.memoizedProps,m.memoizedState=a.memoizedState,m.updateQueue=a.updateQueue,c=a.dependencies,m.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},m.sibling=a.sibling,m.index=a.index,m.ref=a.ref,m}function Jl(a,c,m,y,T,w){var k=2;if(y=a,typeof a=="function")Cf(a)&&(k=1);else if(typeof a=="string")k=5;else e:switch(a){case C:return Gs(m.children,T,w,c);case P:k=8,T|=8;break;case O:return a=Fn(12,m,c,T|2),a.elementType=O,a.lanes=w,a;case se:return a=Fn(13,m,c,T),a.elementType=se,a.lanes=w,a;case U:return a=Fn(19,m,c,T),a.elementType=U,a.lanes=w,a;case te:return Zl(m,T,w,c);default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case M:k=10;break e;case H:k=9;break e;case Z:k=11;break e;case ne:k=14;break e;case q:k=16,y=null;break e}throw Error(t(130,a==null?a:typeof a,""))}return c=Fn(k,m,c,T),c.elementType=a,c.type=y,c.lanes=w,c}function Gs(a,c,m,y){return a=Fn(7,a,y,c),a.lanes=m,a}function Zl(a,c,m,y){return a=Fn(22,a,y,c),a.elementType=te,a.lanes=m,a.stateNode={isHidden:!1},a}function _f(a,c,m){return a=Fn(6,a,null,c),a.lanes=m,a}function Pf(a,c,m){return c=Fn(4,a.children!==null?a.children:[],a.key,c),c.lanes=m,c.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},c}function bL(a,c,m,y,T){this.tag=c,this.containerInfo=a,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=sd(0),this.expirationTimes=sd(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=sd(0),this.identifierPrefix=y,this.onRecoverableError=T,this.mutableSourceEagerHydrationData=null}function Df(a,c,m,y,T,w,k,B,j){return a=new bL(a,c,m,B,j),c===1?(c=1,w===!0&&(c|=8)):c=0,w=Fn(3,null,null,c),a.current=w,w.stateNode=a,w.memoizedState={element:y,isDehydrated:m,cache:null,transitions:null,pendingSuspenseBoundaries:null},Kd(w),a}function wL(a,c,m){var y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:F,key:y==null?null:""+y,children:a,containerInfo:c,implementation:m}}function Py(a){if(!a)return rs;a=a._reactInternals;e:{if(_s(a)!==a||a.tag!==1)throw Error(t(170));var c=a;do{switch(c.tag){case 3:c=c.stateNode.context;break e;case 1:if(rn(c.type)){c=c.stateNode.__reactInternalMemoizedMergedChildContext;break e}}c=c.return}while(c!==null);throw Error(t(171))}if(a.tag===1){var m=a.type;if(rn(m))return o0(a,m,c)}return c}function Dy(a,c,m,y,T,w,k,B,j){return a=Df(m,y,!0,a,T,w,k,B,j),a.context=Py(null),m=a.current,y=Zt(),T=us(m),w=Pr(y,T),w.callback=c??null,os(m,w,T),a.current.lanes=T,xo(a,T,y),an(a,y),a}function ec(a,c,m,y){var T=c.current,w=Zt(),k=us(T);return m=Py(m),c.context===null?c.context=m:c.pendingContext=m,c=Pr(w,k),c.payload={element:a},y=y===void 0?null:y,y!==null&&(c.callback=y),a=os(T,c,k),a!==null&&(qn(a,T,k,w),_l(a,T,k)),k}function tc(a){if(a=a.current,!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function Ny(a,c){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var m=a.retryLane;a.retryLane=m!==0&&m<c?m:c}}function Nf(a,c){Ny(a,c),(a=a.alternate)&&Ny(a,c)}function AL(){return null}var Oy=typeof reportError=="function"?reportError:function(a){console.error(a)};function Of(a){this._internalRoot=a}nc.prototype.render=Of.prototype.render=function(a){var c=this._internalRoot;if(c===null)throw Error(t(409));ec(a,c,null,null)},nc.prototype.unmount=Of.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var c=a.containerInfo;$s(function(){ec(null,a,null,null)}),c[Rr]=null}};function nc(a){this._internalRoot=a}nc.prototype.unstable_scheduleHydration=function(a){if(a){var c=xg();a={blockedOn:null,target:a,priority:c};for(var m=0;m<Jr.length&&c!==0&&c<Jr[m].priority;m++);Jr.splice(m,0,a),m===0&&Eg(a)}};function Mf(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function rc(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11&&(a.nodeType!==8||a.nodeValue!==" react-mount-point-unstable "))}function My(){}function LL(a,c,m,y,T){if(T){if(typeof y=="function"){var w=y;y=function(){var X=tc(k);w.call(X)}}var k=Dy(c,y,a,0,null,!1,!1,"",My);return a._reactRootContainer=k,a[Rr]=k.current,Po(a.nodeType===8?a.parentNode:a),$s(),k}for(;T=a.lastChild;)a.removeChild(T);if(typeof y=="function"){var B=y;y=function(){var X=tc(j);B.call(X)}}var j=Df(a,0,!1,null,null,!1,!1,"",My);return a._reactRootContainer=j,a[Rr]=j.current,Po(a.nodeType===8?a.parentNode:a),$s(function(){ec(c,j,m,y)}),j}function sc(a,c,m,y,T){var w=m._reactRootContainer;if(w){var k=w;if(typeof T=="function"){var B=T;T=function(){var j=tc(k);B.call(j)}}ec(c,k,a,T)}else k=LL(m,c,a,T,y);return tc(k)}gg=function(a){switch(a.tag){case 3:var c=a.stateNode;if(c.current.memoizedState.isDehydrated){var m=yo(c.pendingLanes);m!==0&&(id(c,m|1),an(c,St()),(Ke&6)===0&&(Pi=St()+500,ss()))}break;case 13:$s(function(){var y=_r(a,1);if(y!==null){var T=Zt();qn(y,a,1,T)}}),Nf(a,1)}},od=function(a){if(a.tag===13){var c=_r(a,134217728);if(c!==null){var m=Zt();qn(c,a,134217728,m)}Nf(a,134217728)}},yg=function(a){if(a.tag===13){var c=us(a),m=_r(a,c);if(m!==null){var y=Zt();qn(m,a,c,y)}Nf(a,c)}},xg=function(){return Qe},vg=function(a,c){var m=Qe;try{return Qe=a,c()}finally{Qe=m}},co=function(a,c,m){switch(c){case"input":if(Me(a,m),c=m.name,m.type==="radio"&&c!=null){for(m=a;m.parentNode;)m=m.parentNode;for(m=m.querySelectorAll("input[name="+JSON.stringify(""+c)+'][type="radio"]'),c=0;c<m.length;c++){var y=m[c];if(y!==a&&y.form===a.form){var T=El(y);if(!T)throw Error(t(90));Te(y),Me(y,T)}}}break;case"textarea":pn(a,m);break;case"select":c=m.value,c!=null&&Xe(a,!!m.multiple,c,!1)}},ho=Rf,Ja=$s;var RL={usingClientEntryPoint:!1,Events:[Oo,vi,El,Qa,fo,Rf]},qo={findFiberByHostInstance:Ps,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},IL={bundleType:qo.bundleType,version:qo.version,rendererPackageName:qo.rendererPackageName,rendererConfig:qo.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:I.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){return a=lg(a),a===null?null:a.stateNode},findFiberByHostInstance:qo.findFiberByHostInstance||AL,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ic=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ic.isDisabled&&ic.supportsFiber)try{nl=ic.inject(IL),ir=ic}catch{}}return ln.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=RL,ln.createPortal=function(a,c){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Mf(c))throw Error(t(200));return wL(a,c,null,m)},ln.createRoot=function(a,c){if(!Mf(a))throw Error(t(299));var m=!1,y="",T=Oy;return c!=null&&(c.unstable_strictMode===!0&&(m=!0),c.identifierPrefix!==void 0&&(y=c.identifierPrefix),c.onRecoverableError!==void 0&&(T=c.onRecoverableError)),c=Df(a,1,!1,null,null,m,!1,y,T),a[Rr]=c.current,Po(a.nodeType===8?a.parentNode:a),new Of(c)},ln.findDOMNode=function(a){if(a==null)return null;if(a.nodeType===1)return a;var c=a._reactInternals;if(c===void 0)throw typeof a.render=="function"?Error(t(188)):(a=Object.keys(a).join(","),Error(t(268,a)));return a=lg(c),a=a===null?null:a.stateNode,a},ln.flushSync=function(a){return $s(a)},ln.hydrate=function(a,c,m){if(!rc(c))throw Error(t(200));return sc(null,a,c,!0,m)},ln.hydrateRoot=function(a,c,m){if(!Mf(a))throw Error(t(405));var y=m!=null&&m.hydratedSources||null,T=!1,w="",k=Oy;if(m!=null&&(m.unstable_strictMode===!0&&(T=!0),m.identifierPrefix!==void 0&&(w=m.identifierPrefix),m.onRecoverableError!==void 0&&(k=m.onRecoverableError)),c=Dy(c,null,a,1,m??null,T,!1,w,k),a[Rr]=c.current,Po(a),y)for(a=0;a<y.length;a++)m=y[a],T=m._getVersion,T=T(m._source),c.mutableSourceEagerHydrationData==null?c.mutableSourceEagerHydrationData=[m,T]:c.mutableSourceEagerHydrationData.push(m,T);return new nc(c)},ln.render=function(a,c,m){if(!rc(c))throw Error(t(200));return sc(null,a,c,!1,m)},ln.unmountComponentAtNode=function(a){if(!rc(a))throw Error(t(40));return a._reactRootContainer?($s(function(){sc(null,null,a,!1,function(){a._reactRootContainer=null,a[Rr]=null})}),!0):!1},ln.unstable_batchedUpdates=Rf,ln.unstable_renderSubtreeIntoContainer=function(a,c,m,y){if(!rc(m))throw Error(t(200));if(a==null||a._reactInternals===void 0)throw Error(t(38));return sc(a,c,m,!1,y)},ln.version="18.3.1-next-f1338f8080-20240426",ln}var Hy;function cE(){if(Hy)return Uf.exports;Hy=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Uf.exports=OL(),Uf.exports}var Ky;function ML(){if(Ky)return oc;Ky=1;var n=cE();return oc.createRoot=n.createRoot,oc.hydrateRoot=n.hydrateRoot,oc}var FL=ML(),Vf={exports:{}},Gf={};var zy;function BL(){if(zy)return Gf;zy=1;var n=Na();function e(u,d){return u===d&&(u!==0||1/u===1/d)||u!==u&&d!==d}var t=typeof Object.is=="function"?Object.is:e,r=n.useSyncExternalStore,s=n.useRef,i=n.useEffect,o=n.useMemo,l=n.useDebugValue;return Gf.useSyncExternalStoreWithSelector=function(u,d,f,h,p){var x=s(null);if(x.current===null){var g={hasValue:!1,value:null};x.current=g}else g=x.current;x=o(function(){function v(_){if(!b){if(b=!0,A=_,_=h(_),p!==void 0&&g.hasValue){var F=g.value;if(p(F,_))return L=F}return L=_}if(F=L,t(A,_))return F;var C=h(_);return p!==void 0&&p(F,C)?(A=_,F):(A=_,L=C)}var b=!1,A,L,I=f===void 0?null:f;return[function(){return v(d())},I===null?void 0:function(){return v(I())}]},[d,f,h,p]);var E=r(u,x[0],x[1]);return i(function(){g.hasValue=!0,g.value=E},[E]),l(E),E},Gf}var Wy;function UL(){return Wy||(Wy=1,Vf.exports=BL()),Vf.exports}UL();function $L(n){n()}function jL(){let n=null,e=null;return{clear(){n=null,e=null},notify(){$L(()=>{let t=n;for(;t;)t.callback(),t=t.next})},get(){const t=[];let r=n;for(;r;)t.push(r),r=r.next;return t},subscribe(t){let r=!0;const s=e={callback:t,next:null,prev:e};return s.prev?s.prev.next=s:n=s,function(){!r||n===null||(r=!1,s.next?s.next.prev=s.prev:e=s.prev,s.prev?s.prev.next=s.next:n=s.next)}}}}var Yy={notify(){},get:()=>[]};function VL(n,e){let t,r=Yy,s=0,i=!1;function o(E){f();const v=r.subscribe(E);let b=!1;return()=>{b||(b=!0,v(),h())}}function l(){r.notify()}function u(){g.onStateChange&&g.onStateChange()}function d(){return i}function f(){s++,t||(t=n.subscribe(u),r=jL())}function h(){s--,t&&s===0&&(t(),t=void 0,r.clear(),r=Yy)}function p(){i||(i=!0,f())}function x(){i&&(i=!1,h())}const g={addNestedSub:o,notifyNestedSubs:l,handleChangeWrapper:u,isSubscribed:d,trySubscribe:p,tryUnsubscribe:x,getListeners:()=>r};return g}var GL=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",HL=GL(),KL=()=>typeof navigator<"u"&&navigator.product==="ReactNative",zL=KL(),WL=()=>HL||zL?N.useLayoutEffect:N.useEffect,YL=WL(),qL=Symbol.for("react-redux-context"),XL=typeof globalThis<"u"?globalThis:{};function QL(){if(!N.createContext)return{};const n=XL[qL]??=new Map;let e=n.get(N.createContext);return e||(e=N.createContext(null),n.set(N.createContext,e)),e}var JL=QL();function ZL(n){const{children:e,context:t,serverState:r,store:s}=n,i=N.useMemo(()=>{const u=VL(s);return{store:s,subscription:u,getServerState:r?()=>r:void 0}},[s,r]),o=N.useMemo(()=>s.getState(),[s]);YL(()=>{const{subscription:u}=i;return u.onStateChange=u.notifyNestedSubs,u.trySubscribe(),o!==s.getState()&&u.notifyNestedSubs(),()=>{u.tryUnsubscribe(),u.onStateChange=void 0}},[i,o]);const l=t||JL;return N.createElement(l.Provider,{value:i},e)}var eR=ZL;var qy="popstate";function tR(n={}){function e(r,s){let{pathname:i,search:o,hash:l}=r.location;return Gh("",{pathname:i,search:o,hash:l},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function t(r,s){return typeof s=="string"?s:ga(s)}return rR(e,t,null,n)}function gt(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function Sr(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function nR(){return Math.random().toString(36).substring(2,10)}function Xy(n,e){return{usr:n.state,key:n.key,idx:e}}function Gh(n,e,t=null,r){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?to(e):e,state:t,key:e&&e.key||r||nR()}}function ga({pathname:n="/",search:e="",hash:t=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(n+=t.charAt(0)==="#"?t:"#"+t),n}function to(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substring(t),n=n.substring(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substring(r),n=n.substring(0,r)),n&&(e.pathname=n)}return e}function rR(n,e,t,r={}){let{window:s=document.defaultView,v5Compat:i=!1}=r,o=s.history,l="POP",u=null,d=f();d==null&&(d=0,o.replaceState({...o.state,idx:d},""));function f(){return(o.state||{idx:null}).idx}function h(){l="POP";let v=f(),b=v==null?null:v-d;d=v,u&&u({action:l,location:E.location,delta:b})}function p(v,b){l="PUSH";let A=Gh(E.location,v,b);d=f()+1;let L=Xy(A,d),I=E.createHref(A);try{o.pushState(L,"",I)}catch(_){if(_ instanceof DOMException&&_.name==="DataCloneError")throw _;s.location.assign(I)}i&&u&&u({action:l,location:E.location,delta:1})}function x(v,b){l="REPLACE";let A=Gh(E.location,v,b);d=f();let L=Xy(A,d),I=E.createHref(A);o.replaceState(L,"",I),i&&u&&u({action:l,location:E.location,delta:0})}function g(v){return sR(v)}let E={get action(){return l},get location(){return n(s,o)},listen(v){if(u)throw new Error("A history only accepts one active listener");return s.addEventListener(qy,h),u=v,()=>{s.removeEventListener(qy,h),u=null}},createHref(v){return e(s,v)},createURL:g,encodeLocation(v){let b=g(v);return{pathname:b.pathname,search:b.search,hash:b.hash}},push:p,replace:x,go(v){return o.go(v)}};return E}function sR(n,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),gt(t,"No window.location.(origin|href) available to create URL");let r=typeof n=="string"?n:ga(n);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=t+r),new URL(r,t)}function uE(n,e,t="/"){return iR(n,e,t,!1)}function iR(n,e,t,r){let s=typeof e=="string"?to(e):e,i=zr(s.pathname||"/",t);if(i==null)return null;let o=dE(n);oR(o);let l=null;for(let u=0;l==null&&u<o.length;++u){let d=yR(i);l=pR(o[u],d,r)}return l}function dE(n,e=[],t=[],r="",s=!1){let i=(o,l,u=s,d)=>{let f={relativePath:d===void 0?o.path||"":d,caseSensitive:o.caseSensitive===!0,childrenIndex:l,route:o};if(f.relativePath.startsWith("/")){if(!f.relativePath.startsWith(r)&&u)return;gt(f.relativePath.startsWith(r),`Absolute route path "${f.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),f.relativePath=f.relativePath.slice(r.length)}let h=Vr([r,f.relativePath]),p=t.concat(f);o.children&&o.children.length>0&&(gt(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${h}".`),dE(o.children,e,p,h,u)),!(o.path==null&&!o.index)&&e.push({path:h,score:hR(h,o.index),routesMeta:p})};return n.forEach((o,l)=>{if(o.path===""||!o.path?.includes("?"))i(o,l);else for(let u of fE(o.path))i(o,l,!0,u)}),e}function fE(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,s=t.endsWith("?"),i=t.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let o=fE(r.join("/")),l=[];return l.push(...o.map(u=>u===""?i:[i,u].join("/"))),s&&l.push(...o),l.map(u=>n.startsWith("/")&&u===""?"/":u)}function oR(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:mR(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}var aR=/^:[\w-]+$/,lR=3,cR=2,uR=1,dR=10,fR=-2,Qy=n=>n==="*";function hR(n,e){let t=n.split("/"),r=t.length;return t.some(Qy)&&(r+=fR),e&&(r+=cR),t.filter(s=>!Qy(s)).reduce((s,i)=>s+(aR.test(i)?lR:i===""?uR:dR),r)}function mR(n,e){return n.length===e.length&&n.slice(0,-1).every((r,s)=>r===e[s])?n[n.length-1]-e[e.length-1]:0}function pR(n,e,t=!1){let{routesMeta:r}=n,s={},i="/",o=[];for(let l=0;l<r.length;++l){let u=r[l],d=l===r.length-1,f=i==="/"?e:e.slice(i.length)||"/",h=qc({path:u.relativePath,caseSensitive:u.caseSensitive,end:d},f),p=u.route;if(!h&&d&&t&&!r[r.length-1].route.index&&(h=qc({path:u.relativePath,caseSensitive:u.caseSensitive,end:!1},f)),!h)return null;Object.assign(s,h.params),o.push({params:s,pathname:Vr([i,h.pathname]),pathnameBase:ER(Vr([i,h.pathnameBase])),route:p}),h.pathnameBase!=="/"&&(i=Vr([i,h.pathnameBase]))}return o}function qc(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=gR(n.path,n.caseSensitive,n.end),s=e.match(t);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),l=s.slice(1);return{params:r.reduce((d,{paramName:f,isOptional:h},p)=>{if(f==="*"){let g=l[p]||"";o=i.slice(0,i.length-g.length).replace(/(.)\/+$/,"$1")}const x=l[p];return h&&!x?d[f]=void 0:d[f]=(x||"").replace(/%2F/g,"/"),d},{}),pathname:i,pathnameBase:o,pattern:n}}function gR(n,e=!1,t=!0){Sr(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let r=[],s="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,u)=>(r.push({paramName:l,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(r.push({paramName:"*"}),s+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?s+="\\/*$":n!==""&&n!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function yR(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Sr(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function zr(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}function xR(n,e="/"){let{pathname:t,search:r="",hash:s=""}=typeof n=="string"?to(n):n;return{pathname:t?t.startsWith("/")?t:vR(t,e):e,search:TR(r),hash:bR(s)}}function vR(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(s=>{s===".."?t.length>1&&t.pop():s!=="."&&t.push(s)}),t.length>1?t.join("/"):"/"}function Hf(n,e,t,r){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function SR(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function hE(n){let e=SR(n);return e.map((t,r)=>r===e.length-1?t.pathname:t.pathnameBase)}function mE(n,e,t,r=!1){let s;typeof n=="string"?s=to(n):(s={...n},gt(!s.pathname||!s.pathname.includes("?"),Hf("?","pathname","search",s)),gt(!s.pathname||!s.pathname.includes("#"),Hf("#","pathname","hash",s)),gt(!s.search||!s.search.includes("#"),Hf("#","search","hash",s)));let i=n===""||s.pathname==="",o=i?"/":s.pathname,l;if(o==null)l=t;else{let h=e.length-1;if(!r&&o.startsWith("..")){let p=o.split("/");for(;p[0]==="..";)p.shift(),h-=1;s.pathname=p.join("/")}l=h>=0?e[h]:"/"}let u=xR(s,l),d=o&&o!=="/"&&o.endsWith("/"),f=(i||o===".")&&t.endsWith("/");return!u.pathname.endsWith("/")&&(d||f)&&(u.pathname+="/"),u}var Vr=n=>n.join("/").replace(/\/\/+/g,"/"),ER=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),TR=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,bR=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function wR(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}var pE=["POST","PUT","PATCH","DELETE"];new Set(pE);var AR=["GET",...pE];new Set(AR);var no=N.createContext(null);no.displayName="DataRouter";var Lu=N.createContext(null);Lu.displayName="DataRouterState";N.createContext(!1);var gE=N.createContext({isTransitioning:!1});gE.displayName="ViewTransition";var LR=N.createContext(new Map);LR.displayName="Fetchers";var RR=N.createContext(null);RR.displayName="Await";var br=N.createContext(null);br.displayName="Navigation";var Oa=N.createContext(null);Oa.displayName="Location";var wr=N.createContext({outlet:null,matches:[],isDataRoute:!1});wr.displayName="Route";var Ym=N.createContext(null);Ym.displayName="RouteError";function IR(n,{relative:e}={}){gt(Ma(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:r}=N.useContext(br),{hash:s,pathname:i,search:o}=Fa(n,{relative:e}),l=i;return t!=="/"&&(l=i==="/"?t:Vr([t,i])),r.createHref({pathname:l,search:o,hash:s})}function Ma(){return N.useContext(Oa)!=null}function jn(){return gt(Ma(),"useLocation() may be used only in the context of a <Router> component."),N.useContext(Oa).location}var yE="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function xE(n){N.useContext(br).static||N.useLayoutEffect(n)}function qt(){let{isDataRoute:n}=N.useContext(wr);return n?VR():kR()}function kR(){gt(Ma(),"useNavigate() may be used only in the context of a <Router> component.");let n=N.useContext(no),{basename:e,navigator:t}=N.useContext(br),{matches:r}=N.useContext(wr),{pathname:s}=jn(),i=JSON.stringify(hE(r)),o=N.useRef(!1);return xE(()=>{o.current=!0}),N.useCallback((u,d={})=>{if(Sr(o.current,yE),!o.current)return;if(typeof u=="number"){t.go(u);return}let f=mE(u,JSON.parse(i),s,d.relative==="path");n==null&&e!=="/"&&(f.pathname=f.pathname==="/"?e:Vr([e,f.pathname])),(d.replace?t.replace:t.push)(f,d.state,d)},[e,t,i,s,n])}N.createContext(null);function CR(){let{matches:n}=N.useContext(wr),e=n[n.length-1];return e?e.params:{}}function Fa(n,{relative:e}={}){let{matches:t}=N.useContext(wr),{pathname:r}=jn(),s=JSON.stringify(hE(t));return N.useMemo(()=>mE(n,JSON.parse(s),r,e==="path"),[n,s,r,e])}function _R(n,e){return vE(n,e)}function vE(n,e,t,r,s){gt(Ma(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i}=N.useContext(br),{matches:o}=N.useContext(wr),l=o[o.length-1],u=l?l.params:{},d=l?l.pathname:"/",f=l?l.pathnameBase:"/",h=l&&l.route;{let A=h&&h.path||"";SE(d,!h||A.endsWith("*")||A.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${d}" (under <Route path="${A}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${A}"> to <Route path="${A==="/"?"*":`${A}/*`}">.`)}let p=jn(),x;if(e){let A=typeof e=="string"?to(e):e;gt(f==="/"||A.pathname?.startsWith(f),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${f}" but pathname "${A.pathname}" was given in the \`location\` prop.`),x=A}else x=p;let g=x.pathname||"/",E=g;if(f!=="/"){let A=f.replace(/^\//,"").split("/");E="/"+g.replace(/^\//,"").split("/").slice(A.length).join("/")}let v=uE(n,{pathname:E});Sr(h||v!=null,`No routes matched location "${x.pathname}${x.search}${x.hash}" `),Sr(v==null||v[v.length-1].route.element!==void 0||v[v.length-1].route.Component!==void 0||v[v.length-1].route.lazy!==void 0,`Matched leaf route at location "${x.pathname}${x.search}${x.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let b=MR(v&&v.map(A=>Object.assign({},A,{params:Object.assign({},u,A.params),pathname:Vr([f,i.encodeLocation?i.encodeLocation(A.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:A.pathname]),pathnameBase:A.pathnameBase==="/"?f:Vr([f,i.encodeLocation?i.encodeLocation(A.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:A.pathnameBase])})),o,t,r,s);return e&&b?N.createElement(Oa.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...x},navigationType:"POP"}},b):b}function PR(){let n=jR(),e=wR(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,r="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:r},i={padding:"2px 4px",backgroundColor:r},o=null;return console.error("Error handled by React Router default ErrorBoundary:",n),o=N.createElement(N.Fragment,null,N.createElement("p",null," Hey developer "),N.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",N.createElement("code",{style:i},"ErrorBoundary")," or"," ",N.createElement("code",{style:i},"errorElement")," prop on your route.")),N.createElement(N.Fragment,null,N.createElement("h2",null,"Unexpected Application Error!"),N.createElement("h3",{style:{fontStyle:"italic"}},e),t?N.createElement("pre",{style:s},t):null,o)}var DR=N.createElement(PR,null),NR=class extends N.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){this.props.unstable_onError?this.props.unstable_onError(n,e):console.error("React Router caught the following error during render",n)}render(){return this.state.error!==void 0?N.createElement(wr.Provider,{value:this.props.routeContext},N.createElement(Ym.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function OR({routeContext:n,match:e,children:t}){let r=N.useContext(no);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),N.createElement(wr.Provider,{value:n},t)}function MR(n,e=[],t=null,r=null,s=null){if(n==null){if(!t)return null;if(t.errors)n=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let i=n,o=t?.errors;if(o!=null){let d=i.findIndex(f=>f.route.id&&o?.[f.route.id]!==void 0);gt(d>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),i=i.slice(0,Math.min(i.length,d+1))}let l=!1,u=-1;if(t)for(let d=0;d<i.length;d++){let f=i[d];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(u=d),f.route.id){let{loaderData:h,errors:p}=t,x=f.route.loader&&!h.hasOwnProperty(f.route.id)&&(!p||p[f.route.id]===void 0);if(f.route.lazy||x){l=!0,u>=0?i=i.slice(0,u+1):i=[i[0]];break}}}return i.reduceRight((d,f,h)=>{let p,x=!1,g=null,E=null;t&&(p=o&&f.route.id?o[f.route.id]:void 0,g=f.route.errorElement||DR,l&&(u<0&&h===0?(SE("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),x=!0,E=null):u===h&&(x=!0,E=f.route.hydrateFallbackElement||null)));let v=e.concat(i.slice(0,h+1)),b=()=>{let A;return p?A=g:x?A=E:f.route.Component?A=N.createElement(f.route.Component,null):f.route.element?A=f.route.element:A=d,N.createElement(OR,{match:f,routeContext:{outlet:d,matches:v,isDataRoute:t!=null},children:A})};return t&&(f.route.ErrorBoundary||f.route.errorElement||h===0)?N.createElement(NR,{location:t.location,revalidation:t.revalidation,component:g,error:p,children:b(),routeContext:{outlet:null,matches:v,isDataRoute:!0},unstable_onError:r}):b()},null)}function qm(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function FR(n){let e=N.useContext(no);return gt(e,qm(n)),e}function BR(n){let e=N.useContext(Lu);return gt(e,qm(n)),e}function UR(n){let e=N.useContext(wr);return gt(e,qm(n)),e}function Xm(n){let e=UR(n),t=e.matches[e.matches.length-1];return gt(t.route.id,`${n} can only be used on routes that contain a unique "id"`),t.route.id}function $R(){return Xm("useRouteId")}function jR(){let n=N.useContext(Ym),e=BR("useRouteError"),t=Xm("useRouteError");return n!==void 0?n:e.errors?.[t]}function VR(){let{router:n}=FR("useNavigate"),e=Xm("useNavigate"),t=N.useRef(!1);return xE(()=>{t.current=!0}),N.useCallback(async(s,i={})=>{Sr(t.current,yE),t.current&&(typeof s=="number"?n.navigate(s):await n.navigate(s,{fromRouteId:e,...i}))},[n,e])}var Jy={};function SE(n,e,t){!e&&!Jy[n]&&(Jy[n]=!0,Sr(!1,t))}N.memo(GR);function GR({routes:n,future:e,state:t,unstable_onError:r}){return vE(n,void 0,t,r,e)}function Qn(n){gt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function HR({basename:n="/",children:e=null,location:t,navigationType:r="POP",navigator:s,static:i=!1}){gt(!Ma(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=n.replace(/^\/*/,"/"),l=N.useMemo(()=>({basename:o,navigator:s,static:i,future:{}}),[o,s,i]);typeof t=="string"&&(t=to(t));let{pathname:u="/",search:d="",hash:f="",state:h=null,key:p="default"}=t,x=N.useMemo(()=>{let g=zr(u,o);return g==null?null:{location:{pathname:g,search:d,hash:f,state:h,key:p},navigationType:r}},[o,u,d,f,h,p,r]);return Sr(x!=null,`<Router basename="${o}"> is not able to match the URL "${u}${d}${f}" because it does not start with the basename, so the <Router> won't render anything.`),x==null?null:N.createElement(br.Provider,{value:l},N.createElement(Oa.Provider,{children:e,value:x}))}function Zy({children:n,location:e}){return _R(Hh(n),e)}function Hh(n,e=[]){let t=[];return N.Children.forEach(n,(r,s)=>{if(!N.isValidElement(r))return;let i=[...e,s];if(r.type===N.Fragment){t.push.apply(t,Hh(r.props.children,i));return}gt(r.type===Qn,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),gt(!r.props.index||!r.props.children,"An index route cannot have child routes.");let o={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=Hh(r.props.children,i)),t.push(o)}),t}var Dc="get",Nc="application/x-www-form-urlencoded";function Ru(n){return n!=null&&typeof n.tagName=="string"}function KR(n){return Ru(n)&&n.tagName.toLowerCase()==="button"}function zR(n){return Ru(n)&&n.tagName.toLowerCase()==="form"}function WR(n){return Ru(n)&&n.tagName.toLowerCase()==="input"}function YR(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function qR(n,e){return n.button===0&&(!e||e==="_self")&&!YR(n)}var ac=null;function XR(){if(ac===null)try{new FormData(document.createElement("form"),0),ac=!1}catch{ac=!0}return ac}var QR=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Kf(n){return n!=null&&!QR.has(n)?(Sr(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Nc}"`),null):n}function JR(n,e){let t,r,s,i,o;if(zR(n)){let l=n.getAttribute("action");r=l?zr(l,e):null,t=n.getAttribute("method")||Dc,s=Kf(n.getAttribute("enctype"))||Nc,i=new FormData(n)}else if(KR(n)||WR(n)&&(n.type==="submit"||n.type==="image")){let l=n.form;if(l==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let u=n.getAttribute("formaction")||l.getAttribute("action");if(r=u?zr(u,e):null,t=n.getAttribute("formmethod")||l.getAttribute("method")||Dc,s=Kf(n.getAttribute("formenctype"))||Kf(l.getAttribute("enctype"))||Nc,i=new FormData(l,n),!XR()){let{name:d,type:f,value:h}=n;if(f==="image"){let p=d?`${d}.`:"";i.append(`${p}x`,"0"),i.append(`${p}y`,"0")}else d&&i.append(d,h)}}else{if(Ru(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=Dc,r=null,s=Nc,o=n}return i&&s==="text/plain"&&(o=i,i=void 0),{action:r,method:t.toLowerCase(),encType:s,formData:i,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Qm(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function ZR(n,e,t){let r=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return r.pathname==="/"?r.pathname=`_root.${t}`:e&&zr(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${t}`,r}async function eI(n,e){if(n.id in e)return e[n.id];try{let t=await import(n.module);return e[n.id]=t,t}catch(t){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function tI(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function nI(n,e,t){let r=await Promise.all(n.map(async s=>{let i=e.routes[s.route.id];if(i){let o=await eI(i,t);return o.links?o.links():[]}return[]}));return oI(r.flat(1).filter(tI).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function ex(n,e,t,r,s,i){let o=(u,d)=>t[d]?u.route.id!==t[d].route.id:!0,l=(u,d)=>t[d].pathname!==u.pathname||t[d].route.path?.endsWith("*")&&t[d].params["*"]!==u.params["*"];return i==="assets"?e.filter((u,d)=>o(u,d)||l(u,d)):i==="data"?e.filter((u,d)=>{let f=r.routes[u.route.id];if(!f||!f.hasLoader)return!1;if(o(u,d)||l(u,d))return!0;if(u.route.shouldRevalidate){let h=u.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:u.params,defaultShouldRevalidate:!0});if(typeof h=="boolean")return h}return!0}):[]}function rI(n,e,{includeHydrateFallback:t}={}){return sI(n.map(r=>{let s=e.routes[r.route.id];if(!s)return[];let i=[s.module];return s.clientActionModule&&(i=i.concat(s.clientActionModule)),s.clientLoaderModule&&(i=i.concat(s.clientLoaderModule)),t&&s.hydrateFallbackModule&&(i=i.concat(s.hydrateFallbackModule)),s.imports&&(i=i.concat(s.imports)),i}).flat(1))}function sI(n){return[...new Set(n)]}function iI(n){let e={},t=Object.keys(n).sort();for(let r of t)e[r]=n[r];return e}function oI(n,e){let t=new Set;return new Set(e),n.reduce((r,s)=>{let i=JSON.stringify(iI(s));return t.has(i)||(t.add(i),r.push({key:i,link:s})),r},[])}function EE(){let n=N.useContext(no);return Qm(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function aI(){let n=N.useContext(Lu);return Qm(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var Jm=N.createContext(void 0);Jm.displayName="FrameworkContext";function TE(){let n=N.useContext(Jm);return Qm(n,"You must render this element inside a <HydratedRouter> element"),n}function lI(n,e){let t=N.useContext(Jm),[r,s]=N.useState(!1),[i,o]=N.useState(!1),{onFocus:l,onBlur:u,onMouseEnter:d,onMouseLeave:f,onTouchStart:h}=e,p=N.useRef(null);N.useEffect(()=>{if(n==="render"&&o(!0),n==="viewport"){let E=b=>{b.forEach(A=>{o(A.isIntersecting)})},v=new IntersectionObserver(E,{threshold:.5});return p.current&&v.observe(p.current),()=>{v.disconnect()}}},[n]),N.useEffect(()=>{if(r){let E=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(E)}}},[r]);let x=()=>{s(!0)},g=()=>{s(!1),o(!1)};return t?n!=="intent"?[i,p,{}]:[i,p,{onFocus:Qo(l,x),onBlur:Qo(u,g),onMouseEnter:Qo(d,x),onMouseLeave:Qo(f,g),onTouchStart:Qo(h,x)}]:[!1,p,{}]}function Qo(n,e){return t=>{n&&n(t),t.defaultPrevented||e(t)}}function cI({page:n,...e}){let{router:t}=EE(),r=N.useMemo(()=>uE(t.routes,n,t.basename),[t.routes,n,t.basename]);return r?N.createElement(dI,{page:n,matches:r,...e}):null}function uI(n){let{manifest:e,routeModules:t}=TE(),[r,s]=N.useState([]);return N.useEffect(()=>{let i=!1;return nI(n,e,t).then(o=>{i||s(o)}),()=>{i=!0}},[n,e,t]),r}function dI({page:n,matches:e,...t}){let r=jn(),{manifest:s,routeModules:i}=TE(),{basename:o}=EE(),{loaderData:l,matches:u}=aI(),d=N.useMemo(()=>ex(n,e,u,s,r,"data"),[n,e,u,s,r]),f=N.useMemo(()=>ex(n,e,u,s,r,"assets"),[n,e,u,s,r]),h=N.useMemo(()=>{if(n===r.pathname+r.search+r.hash)return[];let g=new Set,E=!1;if(e.forEach(b=>{let A=s.routes[b.route.id];!A||!A.hasLoader||(!d.some(L=>L.route.id===b.route.id)&&b.route.id in l&&i[b.route.id]?.shouldRevalidate||A.hasClientLoader?E=!0:g.add(b.route.id))}),g.size===0)return[];let v=ZR(n,o,"data");return E&&g.size>0&&v.searchParams.set("_routes",e.filter(b=>g.has(b.route.id)).map(b=>b.route.id).join(",")),[v.pathname+v.search]},[o,l,r,s,d,e,n,i]),p=N.useMemo(()=>rI(f,s),[f,s]),x=uI(f);return N.createElement(N.Fragment,null,h.map(g=>N.createElement("link",{key:g,rel:"prefetch",as:"fetch",href:g,...t})),p.map(g=>N.createElement("link",{key:g,rel:"modulepreload",href:g,...t})),x.map(({key:g,link:E})=>N.createElement("link",{key:g,nonce:t.nonce,...E})))}function fI(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var bE=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{bE&&(window.__reactRouterVersion="7.9.4")}catch{}function hI({basename:n,children:e,window:t}){let r=N.useRef();r.current==null&&(r.current=tR({window:t,v5Compat:!0}));let s=r.current,[i,o]=N.useState({action:s.action,location:s.location}),l=N.useCallback(u=>{N.startTransition(()=>o(u))},[o]);return N.useLayoutEffect(()=>s.listen(l),[s,l]),N.createElement(HR,{basename:n,children:e,location:i.location,navigationType:i.action,navigator:s})}var wE=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ei=N.forwardRef(function({onClick:e,discover:t="render",prefetch:r="none",relative:s,reloadDocument:i,replace:o,state:l,target:u,to:d,preventScrollReset:f,viewTransition:h,...p},x){let{basename:g}=N.useContext(br),E=typeof d=="string"&&wE.test(d),v,b=!1;if(typeof d=="string"&&E&&(v=d,bE))try{let O=new URL(window.location.href),M=d.startsWith("//")?new URL(O.protocol+d):new URL(d),H=zr(M.pathname,g);M.origin===O.origin&&H!=null?d=H+M.search+M.hash:b=!0}catch{Sr(!1,`<Link to="${d}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let A=IR(d,{relative:s}),[L,I,_]=lI(r,p),F=yI(d,{replace:o,state:l,target:u,preventScrollReset:f,relative:s,viewTransition:h});function C(O){e&&e(O),O.defaultPrevented||F(O)}let P=N.createElement("a",{...p,..._,href:v||A,onClick:b||i?e:C,ref:fI(x,I),target:u,"data-discover":!E&&t==="render"?"true":void 0});return L&&!E?N.createElement(N.Fragment,null,P,N.createElement(cI,{page:A})):P});ei.displayName="Link";var mI=N.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:r="",end:s=!1,style:i,to:o,viewTransition:l,children:u,...d},f){let h=Fa(o,{relative:d.relative}),p=jn(),x=N.useContext(Lu),{navigator:g,basename:E}=N.useContext(br),v=x!=null&&TI(h)&&l===!0,b=g.encodeLocation?g.encodeLocation(h).pathname:h.pathname,A=p.pathname,L=x&&x.navigation&&x.navigation.location?x.navigation.location.pathname:null;t||(A=A.toLowerCase(),L=L?L.toLowerCase():null,b=b.toLowerCase()),L&&E&&(L=zr(L,E)||L);const I=b!=="/"&&b.endsWith("/")?b.length-1:b.length;let _=A===b||!s&&A.startsWith(b)&&A.charAt(I)==="/",F=L!=null&&(L===b||!s&&L.startsWith(b)&&L.charAt(b.length)==="/"),C={isActive:_,isPending:F,isTransitioning:v},P=_?e:void 0,O;typeof r=="function"?O=r(C):O=[r,_?"active":null,F?"pending":null,v?"transitioning":null].filter(Boolean).join(" ");let M=typeof i=="function"?i(C):i;return N.createElement(ei,{...d,"aria-current":P,className:O,ref:f,style:M,to:o,viewTransition:l},typeof u=="function"?u(C):u)});mI.displayName="NavLink";var pI=N.forwardRef(({discover:n="render",fetcherKey:e,navigate:t,reloadDocument:r,replace:s,state:i,method:o=Dc,action:l,onSubmit:u,relative:d,preventScrollReset:f,viewTransition:h,...p},x)=>{let g=SI(),E=EI(l,{relative:d}),v=o.toLowerCase()==="get"?"get":"post",b=typeof l=="string"&&wE.test(l),A=L=>{if(u&&u(L),L.defaultPrevented)return;L.preventDefault();let I=L.nativeEvent.submitter,_=I?.getAttribute("formmethod")||o;g(I||L.currentTarget,{fetcherKey:e,method:_,navigate:t,replace:s,state:i,relative:d,preventScrollReset:f,viewTransition:h})};return N.createElement("form",{ref:x,method:v,action:E,onSubmit:r?u:A,...p,"data-discover":!b&&n==="render"?"true":void 0})});pI.displayName="Form";function gI(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function AE(n){let e=N.useContext(no);return gt(e,gI(n)),e}function yI(n,{target:e,replace:t,state:r,preventScrollReset:s,relative:i,viewTransition:o}={}){let l=qt(),u=jn(),d=Fa(n,{relative:i});return N.useCallback(f=>{if(qR(f,e)){f.preventDefault();let h=t!==void 0?t:ga(u)===ga(d);l(n,{replace:h,state:r,preventScrollReset:s,relative:i,viewTransition:o})}},[u,l,d,t,r,e,n,s,i,o])}var xI=0,vI=()=>`__${String(++xI)}__`;function SI(){let{router:n}=AE("useSubmit"),{basename:e}=N.useContext(br),t=$R();return N.useCallback(async(r,s={})=>{let{action:i,method:o,encType:l,formData:u,body:d}=JR(r,e);if(s.navigate===!1){let f=s.fetcherKey||vI();await n.fetch(f,t,s.action||i,{preventScrollReset:s.preventScrollReset,formData:u,body:d,formMethod:s.method||o,formEncType:s.encType||l,flushSync:s.flushSync})}else await n.navigate(s.action||i,{preventScrollReset:s.preventScrollReset,formData:u,body:d,formMethod:s.method||o,formEncType:s.encType||l,replace:s.replace,state:s.state,fromRouteId:t,flushSync:s.flushSync,viewTransition:s.viewTransition})},[n,e,t])}function EI(n,{relative:e}={}){let{basename:t}=N.useContext(br),r=N.useContext(wr);gt(r,"useFormAction must be used inside a RouteContext");let[s]=r.matches.slice(-1),i={...Fa(n||".",{relative:e})},o=jn();if(n==null){i.search=o.search;let l=new URLSearchParams(i.search),u=l.getAll("index");if(u.some(f=>f==="")){l.delete("index"),u.filter(h=>h).forEach(h=>l.append("index",h));let f=l.toString();i.search=f?`?${f}`:""}}return(!n||n===".")&&s.route.index&&(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(i.pathname=i.pathname==="/"?t:Vr([t,i.pathname])),ga(i)}function TI(n,{relative:e}={}){let t=N.useContext(gE);gt(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=AE("useViewTransitionState"),s=Fa(n,{relative:e});if(!t.isTransitioning)return!1;let i=zr(t.currentLocation.pathname,r)||t.currentLocation.pathname,o=zr(t.nextLocation.pathname,r)||t.nextLocation.pathname;return qc(s.pathname,o)!=null||qc(s.pathname,i)!=null}var bI=cE();const wI=lE(bI),LE=N.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"}),Iu=N.createContext({}),ku=N.createContext(null),Cu=typeof document<"u",Zm=Cu?N.useLayoutEffect:N.useEffect,RE=N.createContext({strict:!1}),ep=n=>n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),AI="framerAppearId",IE="data-"+ep(AI);function LI(n,e,t,r){const{visualElement:s}=N.useContext(Iu),i=N.useContext(RE),o=N.useContext(ku),l=N.useContext(LE).reducedMotion,u=N.useRef();r=r||i.renderer,!u.current&&r&&(u.current=r(n,{visualState:e,parent:s,props:t,presenceContext:o,blockInitialAnimation:o?o.initial===!1:!1,reducedMotionConfig:l}));const d=u.current;N.useInsertionEffect(()=>{d&&d.update(t,o)});const f=N.useRef(!!(t[IE]&&!window.HandoffComplete));return Zm(()=>{d&&(d.render(),f.current&&d.animationState&&d.animationState.animateChanges())}),N.useEffect(()=>{d&&(d.updateFeatures(),!f.current&&d.animationState&&d.animationState.animateChanges(),f.current&&(f.current=!1,window.HandoffComplete=!0))}),d}function $i(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function RI(n,e,t){return N.useCallback(r=>{r&&n.mount&&n.mount(r),e&&(r?e.mount(r):e.unmount()),t&&(typeof t=="function"?t(r):$i(t)&&(t.current=r))},[e])}function ya(n){return typeof n=="string"||Array.isArray(n)}function _u(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}const tp=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],np=["initial",...tp];function Pu(n){return _u(n.animate)||np.some(e=>ya(n[e]))}function kE(n){return!!(Pu(n)||n.variants)}function II(n,e){if(Pu(n)){const{initial:t,animate:r}=n;return{initial:t===!1||ya(t)?t:void 0,animate:ya(r)?r:void 0}}return n.inherit!==!1?e:{}}function kI(n){const{initial:e,animate:t}=II(n,N.useContext(Iu));return N.useMemo(()=>({initial:e,animate:t}),[tx(e),tx(t)])}function tx(n){return Array.isArray(n)?n.join(" "):n}const nx={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},xa={};for(const n in nx)xa[n]={isEnabled:e=>nx[n].some(t=>!!e[t])};function CI(n){for(const e in n)xa[e]={...xa[e],...n[e]}}const rp=N.createContext({}),CE=N.createContext({}),_I=Symbol.for("motionComponentSymbol");function PI({preloadedFeatures:n,createVisualElement:e,useRender:t,useVisualState:r,Component:s}){n&&CI(n);function i(l,u){let d;const f={...N.useContext(LE),...l,layoutId:DI(l)},{isStatic:h}=f,p=kI(l),x=r(l,h);if(!h&&Cu){p.visualElement=LI(s,x,f,e);const g=N.useContext(CE),E=N.useContext(RE).strict;p.visualElement&&(d=p.visualElement.loadFeatures(f,E,n,g))}return N.createElement(Iu.Provider,{value:p},d&&p.visualElement?N.createElement(d,{visualElement:p.visualElement,...f}):null,t(s,l,RI(x,p.visualElement,u),x,h,p.visualElement))}const o=N.forwardRef(i);return o[_I]=s,o}function DI({layoutId:n}){const e=N.useContext(rp).id;return e&&n!==void 0?e+"-"+n:n}function NI(n){function e(r,s={}){return PI(n(r,s))}if(typeof Proxy>"u")return e;const t=new Map;return new Proxy(e,{get:(r,s)=>(t.has(s)||t.set(s,e(s)),t.get(s))})}const OI=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function sp(n){return typeof n!="string"||n.includes("-")?!1:!!(OI.indexOf(n)>-1||/[A-Z]/.test(n))}const Xc={};function MI(n){Object.assign(Xc,n)}const Ba=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],ci=new Set(Ba);function _E(n,{layout:e,layoutId:t}){return ci.has(n)||n.startsWith("origin")||(e||t!==void 0)&&(!!Xc[n]||n==="opacity")}const mn=n=>!!(n&&n.getVelocity),FI={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},BI=Ba.length;function UI(n,{enableHardwareAcceleration:e=!0,allowTransformNone:t=!0},r,s){let i="";for(let o=0;o<BI;o++){const l=Ba[o];if(n[l]!==void 0){const u=FI[l]||l;i+=`${u}(${n[l]}) `}}return e&&!n.z&&(i+="translateZ(0)"),i=i.trim(),s?i=s(n,r?"":i):t&&r&&(i="none"),i}const PE=n=>e=>typeof e=="string"&&e.startsWith(n),DE=PE("--"),Kh=PE("var(--"),$I=/var\s*\(\s*--[\w-]+(\s*,\s*(?:(?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)+)?\s*\)/g,jI=(n,e)=>e&&typeof n=="number"?e.transform(n):n,ws=(n,e,t)=>Math.min(Math.max(t,n),e),ui={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},aa={...ui,transform:n=>ws(0,1,n)},lc={...ui,default:1},la=n=>Math.round(n*1e5)/1e5,Du=/(-)?([\d]*\.?[\d])+/g,NE=/(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))/gi,VI=/^(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))$/i;function Ua(n){return typeof n=="string"}const $a=n=>({test:e=>Ua(e)&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),gs=$a("deg"),vr=$a("%"),Ce=$a("px"),GI=$a("vh"),HI=$a("vw"),rx={...vr,parse:n=>vr.parse(n)/100,transform:n=>vr.transform(n*100)},sx={...ui,transform:Math.round},OE={borderWidth:Ce,borderTopWidth:Ce,borderRightWidth:Ce,borderBottomWidth:Ce,borderLeftWidth:Ce,borderRadius:Ce,radius:Ce,borderTopLeftRadius:Ce,borderTopRightRadius:Ce,borderBottomRightRadius:Ce,borderBottomLeftRadius:Ce,width:Ce,maxWidth:Ce,height:Ce,maxHeight:Ce,size:Ce,top:Ce,right:Ce,bottom:Ce,left:Ce,padding:Ce,paddingTop:Ce,paddingRight:Ce,paddingBottom:Ce,paddingLeft:Ce,margin:Ce,marginTop:Ce,marginRight:Ce,marginBottom:Ce,marginLeft:Ce,rotate:gs,rotateX:gs,rotateY:gs,rotateZ:gs,scale:lc,scaleX:lc,scaleY:lc,scaleZ:lc,skew:gs,skewX:gs,skewY:gs,distance:Ce,translateX:Ce,translateY:Ce,translateZ:Ce,x:Ce,y:Ce,z:Ce,perspective:Ce,transformPerspective:Ce,opacity:aa,originX:rx,originY:rx,originZ:Ce,zIndex:sx,fillOpacity:aa,strokeOpacity:aa,numOctaves:sx};function ip(n,e,t,r){const{style:s,vars:i,transform:o,transformOrigin:l}=n;let u=!1,d=!1,f=!0;for(const h in e){const p=e[h];if(DE(h)){i[h]=p;continue}const x=OE[h],g=jI(p,x);if(ci.has(h)){if(u=!0,o[h]=g,!f)continue;p!==(x.default||0)&&(f=!1)}else h.startsWith("origin")?(d=!0,l[h]=g):s[h]=g}if(e.transform||(u||r?s.transform=UI(n.transform,t,f,r):s.transform&&(s.transform="none")),d){const{originX:h="50%",originY:p="50%",originZ:x=0}=l;s.transformOrigin=`${h} ${p} ${x}`}}const op=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function ME(n,e,t){for(const r in e)!mn(e[r])&&!_E(r,t)&&(n[r]=e[r])}function KI({transformTemplate:n},e,t){return N.useMemo(()=>{const r=op();return ip(r,e,{enableHardwareAcceleration:!t},n),Object.assign({},r.vars,r.style)},[e])}function zI(n,e,t){const r=n.style||{},s={};return ME(s,r,n),Object.assign(s,KI(n,e,t)),n.transformValues?n.transformValues(s):s}function WI(n,e,t){const r={},s=zI(n,e,t);return n.drag&&n.dragListener!==!1&&(r.draggable=!1,s.userSelect=s.WebkitUserSelect=s.WebkitTouchCallout="none",s.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(r.tabIndex=0),r.style=s,r}const YI=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","transformValues","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Qc(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||YI.has(n)}let FE=n=>!Qc(n);function qI(n){n&&(FE=e=>e.startsWith("on")?!Qc(e):n(e))}try{qI(require("@emotion/is-prop-valid").default)}catch{}function XI(n,e,t){const r={};for(const s in n)s==="values"&&typeof n.values=="object"||(FE(s)||t===!0&&Qc(s)||!e&&!Qc(s)||n.draggable&&s.startsWith("onDrag"))&&(r[s]=n[s]);return r}function ix(n,e,t){return typeof n=="string"?n:Ce.transform(e+t*n)}function QI(n,e,t){const r=ix(e,n.x,n.width),s=ix(t,n.y,n.height);return`${r} ${s}`}const JI={offset:"stroke-dashoffset",array:"stroke-dasharray"},ZI={offset:"strokeDashoffset",array:"strokeDasharray"};function ek(n,e,t=1,r=0,s=!0){n.pathLength=1;const i=s?JI:ZI;n[i.offset]=Ce.transform(-r);const o=Ce.transform(e),l=Ce.transform(t);n[i.array]=`${o} ${l}`}function ap(n,{attrX:e,attrY:t,attrScale:r,originX:s,originY:i,pathLength:o,pathSpacing:l=1,pathOffset:u=0,...d},f,h,p){if(ip(n,d,f,p),h){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:x,style:g,dimensions:E}=n;x.transform&&(E&&(g.transform=x.transform),delete x.transform),E&&(s!==void 0||i!==void 0||g.transform)&&(g.transformOrigin=QI(E,s!==void 0?s:.5,i!==void 0?i:.5)),e!==void 0&&(x.x=e),t!==void 0&&(x.y=t),r!==void 0&&(x.scale=r),o!==void 0&&ek(x,o,l,u,!1)}const BE=()=>({...op(),attrs:{}}),lp=n=>typeof n=="string"&&n.toLowerCase()==="svg";function tk(n,e,t,r){const s=N.useMemo(()=>{const i=BE();return ap(i,e,{enableHardwareAcceleration:!1},lp(r),n.transformTemplate),{...i.attrs,style:{...i.style}}},[e]);if(n.style){const i={};ME(i,n.style,n),s.style={...i,...s.style}}return s}function nk(n=!1){return(t,r,s,{latestValues:i},o)=>{const u=(sp(t)?tk:WI)(r,i,o,t),f={...XI(r,typeof t=="string",n),...u,ref:s},{children:h}=r,p=N.useMemo(()=>mn(h)?h.get():h,[h]);return N.createElement(t,{...f,children:p})}}function UE(n,{style:e,vars:t},r,s){Object.assign(n.style,e,s&&s.getProjectionStyles(r));for(const i in t)n.style.setProperty(i,t[i])}const $E=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function jE(n,e,t,r){UE(n,e,void 0,r);for(const s in e.attrs)n.setAttribute($E.has(s)?s:ep(s),e.attrs[s])}function cp(n,e){const{style:t}=n,r={};for(const s in t)(mn(t[s])||e.style&&mn(e.style[s])||_E(s,n))&&(r[s]=t[s]);return r}function VE(n,e){const t=cp(n,e);for(const r in n)if(mn(n[r])||mn(e[r])){const s=Ba.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;t[s]=n[r]}return t}function up(n,e,t,r={},s={}){return typeof e=="function"&&(e=e(t!==void 0?t:n.custom,r,s)),typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"&&(e=e(t!==void 0?t:n.custom,r,s)),e}function GE(n){const e=N.useRef(null);return e.current===null&&(e.current=n()),e.current}const Jc=n=>Array.isArray(n),rk=n=>!!(n&&typeof n=="object"&&n.mix&&n.toValue),sk=n=>Jc(n)?n[n.length-1]||0:n;function Oc(n){const e=mn(n)?n.get():n;return rk(e)?e.toValue():e}function ik({scrapeMotionValuesFromProps:n,createRenderState:e,onMount:t},r,s,i){const o={latestValues:ok(r,s,i,n),renderState:e()};return t&&(o.mount=l=>t(r,l,o)),o}const HE=n=>(e,t)=>{const r=N.useContext(Iu),s=N.useContext(ku),i=()=>ik(n,e,r,s);return t?i():GE(i)};function ok(n,e,t,r){const s={},i=r(n,{});for(const p in i)s[p]=Oc(i[p]);let{initial:o,animate:l}=n;const u=Pu(n),d=kE(n);e&&d&&!u&&n.inherit!==!1&&(o===void 0&&(o=e.initial),l===void 0&&(l=e.animate));let f=t?t.initial===!1:!1;f=f||o===!1;const h=f?l:o;return h&&typeof h!="boolean"&&!_u(h)&&(Array.isArray(h)?h:[h]).forEach(x=>{const g=up(n,x);if(!g)return;const{transitionEnd:E,transition:v,...b}=g;for(const A in b){let L=b[A];if(Array.isArray(L)){const I=f?L.length-1:0;L=L[I]}L!==null&&(s[A]=L)}for(const A in E)s[A]=E[A]}),s}const bt=n=>n;class ox{constructor(){this.order=[],this.scheduled=new Set}add(e){if(!this.scheduled.has(e))return this.scheduled.add(e),this.order.push(e),!0}remove(e){const t=this.order.indexOf(e);t!==-1&&(this.order.splice(t,1),this.scheduled.delete(e))}clear(){this.order.length=0,this.scheduled.clear()}}function ak(n){let e=new ox,t=new ox,r=0,s=!1,i=!1;const o=new WeakSet,l={schedule:(u,d=!1,f=!1)=>{const h=f&&s,p=h?e:t;return d&&o.add(u),p.add(u)&&h&&s&&(r=e.order.length),u},cancel:u=>{t.remove(u),o.delete(u)},process:u=>{if(s){i=!0;return}if(s=!0,[e,t]=[t,e],t.clear(),r=e.order.length,r)for(let d=0;d<r;d++){const f=e.order[d];f(u),o.has(f)&&(l.schedule(f),n())}s=!1,i&&(i=!1,l.process(u))}};return l}const cc=["prepare","read","update","preRender","render","postRender"],lk=40;function ck(n,e){let t=!1,r=!0;const s={delta:0,timestamp:0,isProcessing:!1},i=cc.reduce((h,p)=>(h[p]=ak(()=>t=!0),h),{}),o=h=>i[h].process(s),l=()=>{const h=performance.now();t=!1,s.delta=r?1e3/60:Math.max(Math.min(h-s.timestamp,lk),1),s.timestamp=h,s.isProcessing=!0,cc.forEach(o),s.isProcessing=!1,t&&e&&(r=!1,n(l))},u=()=>{t=!0,r=!0,s.isProcessing||n(l)};return{schedule:cc.reduce((h,p)=>{const x=i[p];return h[p]=(g,E=!1,v=!1)=>(t||u(),x.schedule(g,E,v)),h},{}),cancel:h=>cc.forEach(p=>i[p].cancel(h)),state:s,steps:i}}const{schedule:ot,cancel:Wr,state:zt,steps:zf}=ck(typeof requestAnimationFrame<"u"?requestAnimationFrame:bt,!0),uk={useVisualState:HE({scrapeMotionValuesFromProps:VE,createRenderState:BE,onMount:(n,e,{renderState:t,latestValues:r})=>{ot.read(()=>{try{t.dimensions=typeof e.getBBox=="function"?e.getBBox():e.getBoundingClientRect()}catch{t.dimensions={x:0,y:0,width:0,height:0}}}),ot.render(()=>{ap(t,r,{enableHardwareAcceleration:!1},lp(e.tagName),n.transformTemplate),jE(e,t)})}})},dk={useVisualState:HE({scrapeMotionValuesFromProps:cp,createRenderState:op})};function fk(n,{forwardMotionProps:e=!1},t,r){return{...sp(n)?uk:dk,preloadedFeatures:t,useRender:nk(e),createVisualElement:r,Component:n}}function jr(n,e,t,r={passive:!0}){return n.addEventListener(e,t,r),()=>n.removeEventListener(e,t)}const KE=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1;function Nu(n,e="page"){return{point:{x:n[e+"X"],y:n[e+"Y"]}}}const hk=n=>e=>KE(e)&&n(e,Nu(e));function Gr(n,e,t,r){return jr(n,e,hk(t),r)}const mk=(n,e)=>t=>e(n(t)),Es=(...n)=>n.reduce(mk);function zE(n){let e=null;return()=>{const t=()=>{e=null};return e===null?(e=n,t):!1}}const ax=zE("dragHorizontal"),lx=zE("dragVertical");function WE(n){let e=!1;if(n==="y")e=lx();else if(n==="x")e=ax();else{const t=ax(),r=lx();t&&r?e=()=>{t(),r()}:(t&&t(),r&&r())}return e}function YE(){const n=WE(!0);return n?(n(),!1):!0}class ks{constructor(e){this.isMounted=!1,this.node=e}update(){}}function cx(n,e){const t="pointer"+(e?"enter":"leave"),r="onHover"+(e?"Start":"End"),s=(i,o)=>{if(i.pointerType==="touch"||YE())return;const l=n.getProps();n.animationState&&l.whileHover&&n.animationState.setActive("whileHover",e),l[r]&&ot.update(()=>l[r](i,o))};return Gr(n.current,t,s,{passive:!n.getProps()[r]})}class pk extends ks{mount(){this.unmount=Es(cx(this.node,!0),cx(this.node,!1))}unmount(){}}class gk extends ks{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Es(jr(this.node.current,"focus",()=>this.onFocus()),jr(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const qE=(n,e)=>e?n===e?!0:qE(n,e.parentElement):!1;function Wf(n,e){if(!e)return;const t=new PointerEvent("pointer"+n);e(t,Nu(t))}class yk extends ks{constructor(){super(...arguments),this.removeStartListeners=bt,this.removeEndListeners=bt,this.removeAccessibleListeners=bt,this.startPointerPress=(e,t)=>{if(this.isPressing)return;this.removeEndListeners();const r=this.node.getProps(),i=Gr(window,"pointerup",(l,u)=>{if(!this.checkPressEnd())return;const{onTap:d,onTapCancel:f,globalTapTarget:h}=this.node.getProps();ot.update(()=>{!h&&!qE(this.node.current,l.target)?f&&f(l,u):d&&d(l,u)})},{passive:!(r.onTap||r.onPointerUp)}),o=Gr(window,"pointercancel",(l,u)=>this.cancelPress(l,u),{passive:!(r.onTapCancel||r.onPointerCancel)});this.removeEndListeners=Es(i,o),this.startPress(e,t)},this.startAccessiblePress=()=>{const e=i=>{if(i.key!=="Enter"||this.isPressing)return;const o=l=>{l.key!=="Enter"||!this.checkPressEnd()||Wf("up",(u,d)=>{const{onTap:f}=this.node.getProps();f&&ot.update(()=>f(u,d))})};this.removeEndListeners(),this.removeEndListeners=jr(this.node.current,"keyup",o),Wf("down",(l,u)=>{this.startPress(l,u)})},t=jr(this.node.current,"keydown",e),r=()=>{this.isPressing&&Wf("cancel",(i,o)=>this.cancelPress(i,o))},s=jr(this.node.current,"blur",r);this.removeAccessibleListeners=Es(t,s)}}startPress(e,t){this.isPressing=!0;const{onTapStart:r,whileTap:s}=this.node.getProps();s&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),r&&ot.update(()=>r(e,t))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!YE()}cancelPress(e,t){if(!this.checkPressEnd())return;const{onTapCancel:r}=this.node.getProps();r&&ot.update(()=>r(e,t))}mount(){const e=this.node.getProps(),t=Gr(e.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(e.onTapStart||e.onPointerStart)}),r=jr(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=Es(t,r)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const zh=new WeakMap,Yf=new WeakMap,xk=n=>{const e=zh.get(n.target);e&&e(n)},vk=n=>{n.forEach(xk)};function Sk({root:n,...e}){const t=n||document;Yf.has(t)||Yf.set(t,{});const r=Yf.get(t),s=JSON.stringify(e);return r[s]||(r[s]=new IntersectionObserver(vk,{root:n,...e})),r[s]}function Ek(n,e,t){const r=Sk(e);return zh.set(n,t),r.observe(n),()=>{zh.delete(n),r.unobserve(n)}}const Tk={some:0,all:1};class bk extends ks{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:r,amount:s="some",once:i}=e,o={root:t?t.current:void 0,rootMargin:r,threshold:typeof s=="number"?s:Tk[s]},l=u=>{const{isIntersecting:d}=u;if(this.isInView===d||(this.isInView=d,i&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:f,onViewportLeave:h}=this.node.getProps(),p=d?f:h;p&&p(u)};return Ek(this.node.current,o,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(wk(e,t))&&this.startObserver()}unmount(){}}function wk({viewport:n={}},{viewport:e={}}={}){return t=>n[t]!==e[t]}const Ak={inView:{Feature:bk},tap:{Feature:yk},focus:{Feature:gk},hover:{Feature:pk}};function XE(n,e){if(!Array.isArray(e))return!1;const t=e.length;if(t!==n.length)return!1;for(let r=0;r<t;r++)if(e[r]!==n[r])return!1;return!0}function Lk(n){const e={};return n.values.forEach((t,r)=>e[r]=t.get()),e}function Rk(n){const e={};return n.values.forEach((t,r)=>e[r]=t.getVelocity()),e}function Ou(n,e,t){const r=n.getProps();return up(r,e,t!==void 0?t:r.custom,Lk(n),Rk(n))}let dp=bt;const ti=n=>n*1e3,Hr=n=>n/1e3,Ik={current:!1},QE=n=>Array.isArray(n)&&typeof n[0]=="number";function JE(n){return!!(!n||typeof n=="string"&&ZE[n]||QE(n)||Array.isArray(n)&&n.every(JE))}const ra=([n,e,t,r])=>`cubic-bezier(${n}, ${e}, ${t}, ${r})`,ZE={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:ra([0,.65,.55,1]),circOut:ra([.55,0,1,.45]),backIn:ra([.31,.01,.66,-.59]),backOut:ra([.33,1.53,.69,.99])};function eT(n){if(n)return QE(n)?ra(n):Array.isArray(n)?n.map(eT):ZE[n]}function kk(n,e,t,{delay:r=0,duration:s,repeat:i=0,repeatType:o="loop",ease:l,times:u}={}){const d={[e]:t};u&&(d.offset=u);const f=eT(l);return Array.isArray(f)&&(d.easing=f),n.animate(d,{delay:r,duration:s,easing:Array.isArray(f)?"linear":f,fill:"both",iterations:i+1,direction:o==="reverse"?"alternate":"normal"})}function Ck(n,{repeat:e,repeatType:t="loop"}){const r=e&&t!=="loop"&&e%2===1?0:n.length-1;return n[r]}const tT=(n,e,t)=>(((1-3*t+3*e)*n+(3*t-6*e))*n+3*e)*n,_k=1e-7,Pk=12;function Dk(n,e,t,r,s){let i,o,l=0;do o=e+(t-e)/2,i=tT(o,r,s)-n,i>0?t=o:e=o;while(Math.abs(i)>_k&&++l<Pk);return o}function ja(n,e,t,r){if(n===e&&t===r)return bt;const s=i=>Dk(i,0,1,n,t);return i=>i===0||i===1?i:tT(s(i),e,r)}const Nk=ja(.42,0,1,1),Ok=ja(0,0,.58,1),nT=ja(.42,0,.58,1),Mk=n=>Array.isArray(n)&&typeof n[0]!="number",rT=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,sT=n=>e=>1-n(1-e),fp=n=>1-Math.sin(Math.acos(n)),iT=sT(fp),Fk=rT(fp),oT=ja(.33,1.53,.69,.99),hp=sT(oT),Bk=rT(hp),Uk=n=>(n*=2)<1?.5*hp(n):.5*(2-Math.pow(2,-10*(n-1))),$k={linear:bt,easeIn:Nk,easeInOut:nT,easeOut:Ok,circIn:fp,circInOut:Fk,circOut:iT,backIn:hp,backInOut:Bk,backOut:oT,anticipate:Uk},ux=n=>{if(Array.isArray(n)){dp(n.length===4);const[e,t,r,s]=n;return ja(e,t,r,s)}else if(typeof n=="string")return $k[n];return n},mp=(n,e)=>t=>!!(Ua(t)&&VI.test(t)&&t.startsWith(n)||e&&Object.prototype.hasOwnProperty.call(t,e)),aT=(n,e,t)=>r=>{if(!Ua(r))return r;const[s,i,o,l]=r.match(Du);return{[n]:parseFloat(s),[e]:parseFloat(i),[t]:parseFloat(o),alpha:l!==void 0?parseFloat(l):1}},jk=n=>ws(0,255,n),qf={...ui,transform:n=>Math.round(jk(n))},Js={test:mp("rgb","red"),parse:aT("red","green","blue"),transform:({red:n,green:e,blue:t,alpha:r=1})=>"rgba("+qf.transform(n)+", "+qf.transform(e)+", "+qf.transform(t)+", "+la(aa.transform(r))+")"};function Vk(n){let e="",t="",r="",s="";return n.length>5?(e=n.substring(1,3),t=n.substring(3,5),r=n.substring(5,7),s=n.substring(7,9)):(e=n.substring(1,2),t=n.substring(2,3),r=n.substring(3,4),s=n.substring(4,5),e+=e,t+=t,r+=r,s+=s),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(r,16),alpha:s?parseInt(s,16)/255:1}}const Wh={test:mp("#"),parse:Vk,transform:Js.transform},ji={test:mp("hsl","hue"),parse:aT("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:t,alpha:r=1})=>"hsla("+Math.round(n)+", "+vr.transform(la(e))+", "+vr.transform(la(t))+", "+la(aa.transform(r))+")"},en={test:n=>Js.test(n)||Wh.test(n)||ji.test(n),parse:n=>Js.test(n)?Js.parse(n):ji.test(n)?ji.parse(n):Wh.parse(n),transform:n=>Ua(n)?n:n.hasOwnProperty("red")?Js.transform(n):ji.transform(n)},mt=(n,e,t)=>-t*n+t*e+n;function Xf(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*(2/3-t)*6:n}function Gk({hue:n,saturation:e,lightness:t,alpha:r}){n/=360,e/=100,t/=100;let s=0,i=0,o=0;if(!e)s=i=o=t;else{const l=t<.5?t*(1+e):t+e-t*e,u=2*t-l;s=Xf(u,l,n+1/3),i=Xf(u,l,n),o=Xf(u,l,n-1/3)}return{red:Math.round(s*255),green:Math.round(i*255),blue:Math.round(o*255),alpha:r}}const Qf=(n,e,t)=>{const r=n*n;return Math.sqrt(Math.max(0,t*(e*e-r)+r))},Hk=[Wh,Js,ji],Kk=n=>Hk.find(e=>e.test(n));function dx(n){const e=Kk(n);let t=e.parse(n);return e===ji&&(t=Gk(t)),t}const lT=(n,e)=>{const t=dx(n),r=dx(e),s={...t};return i=>(s.red=Qf(t.red,r.red,i),s.green=Qf(t.green,r.green,i),s.blue=Qf(t.blue,r.blue,i),s.alpha=mt(t.alpha,r.alpha,i),Js.transform(s))};function zk(n){var e,t;return isNaN(n)&&Ua(n)&&(((e=n.match(Du))===null||e===void 0?void 0:e.length)||0)+(((t=n.match(NE))===null||t===void 0?void 0:t.length)||0)>0}const cT={regex:$I,countKey:"Vars",token:"${v}",parse:bt},uT={regex:NE,countKey:"Colors",token:"${c}",parse:en.parse},dT={regex:Du,countKey:"Numbers",token:"${n}",parse:ui.parse};function Jf(n,{regex:e,countKey:t,token:r,parse:s}){const i=n.tokenised.match(e);i&&(n["num"+t]=i.length,n.tokenised=n.tokenised.replace(e,r),n.values.push(...i.map(s)))}function Zc(n){const e=n.toString(),t={value:e,tokenised:e,values:[],numVars:0,numColors:0,numNumbers:0};return t.value.includes("var(--")&&Jf(t,cT),Jf(t,uT),Jf(t,dT),t}function fT(n){return Zc(n).values}function hT(n){const{values:e,numColors:t,numVars:r,tokenised:s}=Zc(n),i=e.length;return o=>{let l=s;for(let u=0;u<i;u++)u<r?l=l.replace(cT.token,o[u]):u<r+t?l=l.replace(uT.token,en.transform(o[u])):l=l.replace(dT.token,la(o[u]));return l}}const Wk=n=>typeof n=="number"?0:n;function Yk(n){const e=fT(n);return hT(n)(e.map(Wk))}const As={test:zk,parse:fT,createTransformer:hT,getAnimatableNone:Yk},mT=(n,e)=>t=>`${t>0?e:n}`;function pT(n,e){return typeof n=="number"?t=>mt(n,e,t):en.test(n)?lT(n,e):n.startsWith("var(")?mT(n,e):yT(n,e)}const gT=(n,e)=>{const t=[...n],r=t.length,s=n.map((i,o)=>pT(i,e[o]));return i=>{for(let o=0;o<r;o++)t[o]=s[o](i);return t}},qk=(n,e)=>{const t={...n,...e},r={};for(const s in t)n[s]!==void 0&&e[s]!==void 0&&(r[s]=pT(n[s],e[s]));return s=>{for(const i in r)t[i]=r[i](s);return t}},yT=(n,e)=>{const t=As.createTransformer(e),r=Zc(n),s=Zc(e);return r.numVars===s.numVars&&r.numColors===s.numColors&&r.numNumbers>=s.numNumbers?Es(gT(r.values,s.values),t):mT(n,e)},va=(n,e,t)=>{const r=e-n;return r===0?1:(t-n)/r},fx=(n,e)=>t=>mt(n,e,t);function Xk(n){return typeof n=="number"?fx:typeof n=="string"?en.test(n)?lT:yT:Array.isArray(n)?gT:typeof n=="object"?qk:fx}function Qk(n,e,t){const r=[],s=t||Xk(n[0]),i=n.length-1;for(let o=0;o<i;o++){let l=s(n[o],n[o+1]);if(e){const u=Array.isArray(e)?e[o]||bt:e;l=Es(u,l)}r.push(l)}return r}function xT(n,e,{clamp:t=!0,ease:r,mixer:s}={}){const i=n.length;if(dp(i===e.length),i===1)return()=>e[0];n[0]>n[i-1]&&(n=[...n].reverse(),e=[...e].reverse());const o=Qk(e,r,s),l=o.length,u=d=>{let f=0;if(l>1)for(;f<n.length-2&&!(d<n[f+1]);f++);const h=va(n[f],n[f+1],d);return o[f](h)};return t?d=>u(ws(n[0],n[i-1],d)):u}function Jk(n,e){const t=n[n.length-1];for(let r=1;r<=e;r++){const s=va(0,e,r);n.push(mt(t,1,s))}}function Zk(n){const e=[0];return Jk(e,n.length-1),e}function eC(n,e){return n.map(t=>t*e)}function tC(n,e){return n.map(()=>e||nT).splice(0,n.length-1)}function eu({duration:n=300,keyframes:e,times:t,ease:r="easeInOut"}){const s=Mk(r)?r.map(ux):ux(r),i={done:!1,value:e[0]},o=eC(t&&t.length===e.length?t:Zk(e),n),l=xT(o,e,{ease:Array.isArray(s)?s:tC(e,s)});return{calculatedDuration:n,next:u=>(i.value=l(u),i.done=u>=n,i)}}function vT(n,e){return e?n*(1e3/e):0}const nC=5;function ST(n,e,t){const r=Math.max(e-nC,0);return vT(t-n(r),e-r)}const Zf=.001,rC=.01,sC=10,iC=.05,oC=1;function aC({duration:n=800,bounce:e=.25,velocity:t=0,mass:r=1}){let s,i,o=1-e;o=ws(iC,oC,o),n=ws(rC,sC,Hr(n)),o<1?(s=d=>{const f=d*o,h=f*n,p=f-t,x=Yh(d,o),g=Math.exp(-h);return Zf-p/x*g},i=d=>{const h=d*o*n,p=h*t+t,x=Math.pow(o,2)*Math.pow(d,2)*n,g=Math.exp(-h),E=Yh(Math.pow(d,2),o);return(-s(d)+Zf>0?-1:1)*((p-x)*g)/E}):(s=d=>{const f=Math.exp(-d*n),h=(d-t)*n+1;return-Zf+f*h},i=d=>{const f=Math.exp(-d*n),h=(t-d)*(n*n);return f*h});const l=5/n,u=cC(s,i,l);if(n=ti(n),isNaN(u))return{stiffness:100,damping:10,duration:n};{const d=Math.pow(u,2)*r;return{stiffness:d,damping:o*2*Math.sqrt(r*d),duration:n}}}const lC=12;function cC(n,e,t){let r=t;for(let s=1;s<lC;s++)r=r-n(r)/e(r);return r}function Yh(n,e){return n*Math.sqrt(1-e*e)}const uC=["duration","bounce"],dC=["stiffness","damping","mass"];function hx(n,e){return e.some(t=>n[t]!==void 0)}function fC(n){let e={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...n};if(!hx(n,dC)&&hx(n,uC)){const t=aC(n);e={...e,...t,mass:1},e.isResolvedFromDuration=!0}return e}function ET({keyframes:n,restDelta:e,restSpeed:t,...r}){const s=n[0],i=n[n.length-1],o={done:!1,value:s},{stiffness:l,damping:u,mass:d,duration:f,velocity:h,isResolvedFromDuration:p}=fC({...r,velocity:-Hr(r.velocity||0)}),x=h||0,g=u/(2*Math.sqrt(l*d)),E=i-s,v=Hr(Math.sqrt(l/d)),b=Math.abs(E)<5;t||(t=b?.01:2),e||(e=b?.005:.5);let A;if(g<1){const L=Yh(v,g);A=I=>{const _=Math.exp(-g*v*I);return i-_*((x+g*v*E)/L*Math.sin(L*I)+E*Math.cos(L*I))}}else if(g===1)A=L=>i-Math.exp(-v*L)*(E+(x+v*E)*L);else{const L=v*Math.sqrt(g*g-1);A=I=>{const _=Math.exp(-g*v*I),F=Math.min(L*I,300);return i-_*((x+g*v*E)*Math.sinh(F)+L*E*Math.cosh(F))/L}}return{calculatedDuration:p&&f||null,next:L=>{const I=A(L);if(p)o.done=L>=f;else{let _=x;L!==0&&(g<1?_=ST(A,L,I):_=0);const F=Math.abs(_)<=t,C=Math.abs(i-I)<=e;o.done=F&&C}return o.value=o.done?i:I,o}}}function mx({keyframes:n,velocity:e=0,power:t=.8,timeConstant:r=325,bounceDamping:s=10,bounceStiffness:i=500,modifyTarget:o,min:l,max:u,restDelta:d=.5,restSpeed:f}){const h=n[0],p={done:!1,value:h},x=P=>l!==void 0&&P<l||u!==void 0&&P>u,g=P=>l===void 0?u:u===void 0||Math.abs(l-P)<Math.abs(u-P)?l:u;let E=t*e;const v=h+E,b=o===void 0?v:o(v);b!==v&&(E=b-h);const A=P=>-E*Math.exp(-P/r),L=P=>b+A(P),I=P=>{const O=A(P),M=L(P);p.done=Math.abs(O)<=d,p.value=p.done?b:M};let _,F;const C=P=>{x(p.value)&&(_=P,F=ET({keyframes:[p.value,g(p.value)],velocity:ST(L,P,p.value),damping:s,stiffness:i,restDelta:d,restSpeed:f}))};return C(0),{calculatedDuration:null,next:P=>{let O=!1;return!F&&_===void 0&&(O=!0,I(P),C(P)),_!==void 0&&P>_?F.next(P-_):(!O&&I(P),p)}}}const hC=n=>{const e=({timestamp:t})=>n(t);return{start:()=>ot.update(e,!0),stop:()=>Wr(e),now:()=>zt.isProcessing?zt.timestamp:performance.now()}},px=2e4;function gx(n){let e=0;const t=50;let r=n.next(e);for(;!r.done&&e<px;)e+=t,r=n.next(e);return e>=px?1/0:e}const mC={decay:mx,inertia:mx,tween:eu,keyframes:eu,spring:ET};function tu({autoplay:n=!0,delay:e=0,driver:t=hC,keyframes:r,type:s="keyframes",repeat:i=0,repeatDelay:o=0,repeatType:l="loop",onPlay:u,onStop:d,onComplete:f,onUpdate:h,...p}){let x=1,g=!1,E,v;const b=()=>{v=new Promise(D=>{E=D})};b();let A;const L=mC[s]||eu;let I;L!==eu&&typeof r[0]!="number"&&(I=xT([0,100],r,{clamp:!1}),r=[0,100]);const _=L({...p,keyframes:r});let F;l==="mirror"&&(F=L({...p,keyframes:[...r].reverse(),velocity:-(p.velocity||0)}));let C="idle",P=null,O=null,M=null;_.calculatedDuration===null&&i&&(_.calculatedDuration=gx(_));const{calculatedDuration:H}=_;let Z=1/0,se=1/0;H!==null&&(Z=H+o,se=Z*(i+1)-o);let U=0;const ne=D=>{if(O===null)return;x>0&&(O=Math.min(O,D)),x<0&&(O=Math.min(D-se/x,O)),P!==null?U=P:U=Math.round(D-O)*x;const $=U-e*(x>=0?1:-1),ie=x>=0?$<0:$>se;U=Math.max($,0),C==="finished"&&P===null&&(U=se);let ce=U,ue=_;if(i){const Le=Math.min(U,se)/Z;let _e=Math.floor(Le),Pe=Le%1;!Pe&&Le>=1&&(Pe=1),Pe===1&&_e--,_e=Math.min(_e,i+1),!!(_e%2)&&(l==="reverse"?(Pe=1-Pe,o&&(Pe-=o/Z)):l==="mirror"&&(ue=F)),ce=ws(0,1,Pe)*Z}const fe=ie?{done:!1,value:r[0]}:ue.next(ce);I&&(fe.value=I(fe.value));let{done:Ee}=fe;!ie&&H!==null&&(Ee=x>=0?U>=se:U<=0);const ye=P===null&&(C==="finished"||C==="running"&&Ee);return h&&h(fe.value),ye&&G(),fe},q=()=>{A&&A.stop(),A=void 0},te=()=>{C="idle",q(),E(),b(),O=M=null},G=()=>{C="finished",f&&f(),q(),E()},Q=()=>{if(g)return;A||(A=t(ne));const D=A.now();u&&u(),P!==null?O=D-P:(!O||C==="finished")&&(O=D),C==="finished"&&b(),M=O,P=null,C="running",A.start()};n&&Q();const ee={then(D,$){return v.then(D,$)},get time(){return Hr(U)},set time(D){D=ti(D),U=D,P!==null||!A||x===0?P=D:O=A.now()-D/x},get duration(){const D=_.calculatedDuration===null?gx(_):_.calculatedDuration;return Hr(D)},get speed(){return x},set speed(D){D===x||!A||(x=D,ee.time=Hr(U))},get state(){return C},play:Q,pause:()=>{C="paused",P=U},stop:()=>{g=!0,C!=="idle"&&(C="idle",d&&d(),te())},cancel:()=>{M!==null&&ne(M),te()},complete:()=>{C="finished"},sample:D=>(O=0,ne(D))};return ee}function pC(n){let e;return()=>(e===void 0&&(e=n()),e)}const gC=pC(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),yC=new Set(["opacity","clipPath","filter","transform","backgroundColor"]),uc=10,xC=2e4,vC=(n,e)=>e.type==="spring"||n==="backgroundColor"||!JE(e.ease);function SC(n,e,{onUpdate:t,onComplete:r,...s}){if(!(gC()&&yC.has(e)&&!s.repeatDelay&&s.repeatType!=="mirror"&&s.damping!==0&&s.type!=="inertia"))return!1;let o=!1,l,u,d=!1;const f=()=>{u=new Promise(L=>{l=L})};f();let{keyframes:h,duration:p=300,ease:x,times:g}=s;if(vC(e,s)){const L=tu({...s,repeat:0,delay:0});let I={done:!1,value:h[0]};const _=[];let F=0;for(;!I.done&&F<xC;)I=L.sample(F),_.push(I.value),F+=uc;g=void 0,h=_,p=F-uc,x="linear"}const E=kk(n.owner.current,e,h,{...s,duration:p,ease:x,times:g}),v=()=>{d=!1,E.cancel()},b=()=>{d=!0,ot.update(v),l(),f()};return E.onfinish=()=>{d||(n.set(Ck(h,s)),r&&r(),b())},{then(L,I){return u.then(L,I)},attachTimeline(L){return E.timeline=L,E.onfinish=null,bt},get time(){return Hr(E.currentTime||0)},set time(L){E.currentTime=ti(L)},get speed(){return E.playbackRate},set speed(L){E.playbackRate=L},get duration(){return Hr(p)},play:()=>{o||(E.play(),Wr(v))},pause:()=>E.pause(),stop:()=>{if(o=!0,E.playState==="idle")return;const{currentTime:L}=E;if(L){const I=tu({...s,autoplay:!1});n.setWithVelocity(I.sample(L-uc).value,I.sample(L).value,uc)}b()},complete:()=>{d||E.finish()},cancel:b}}function EC({keyframes:n,delay:e,onUpdate:t,onComplete:r}){const s=()=>(t&&t(n[n.length-1]),r&&r(),{time:0,speed:1,duration:0,play:bt,pause:bt,stop:bt,then:i=>(i(),Promise.resolve()),cancel:bt,complete:bt});return e?tu({keyframes:[0,1],duration:0,delay:e,onComplete:s}):s()}const TC={type:"spring",stiffness:500,damping:25,restSpeed:10},bC=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),wC={type:"keyframes",duration:.8},AC={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},LC=(n,{keyframes:e})=>e.length>2?wC:ci.has(n)?n.startsWith("scale")?bC(e[1]):TC:AC,qh=(n,e)=>n==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(As.test(e)||e==="0")&&!e.startsWith("url(")),RC=new Set(["brightness","contrast","saturate","opacity"]);function IC(n){const[e,t]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[r]=t.match(Du)||[];if(!r)return n;const s=t.replace(r,"");let i=RC.has(e)?1:0;return r!==t&&(i*=100),e+"("+i+s+")"}const kC=/([a-z-]*)\(.*?\)/g,Xh={...As,getAnimatableNone:n=>{const e=n.match(kC);return e?e.map(IC).join(" "):n}},CC={...OE,color:en,backgroundColor:en,outlineColor:en,fill:en,stroke:en,borderColor:en,borderTopColor:en,borderRightColor:en,borderBottomColor:en,borderLeftColor:en,filter:Xh,WebkitFilter:Xh},pp=n=>CC[n];function TT(n,e){let t=pp(n);return t!==Xh&&(t=As),t.getAnimatableNone?t.getAnimatableNone(e):void 0}const bT=n=>/^0[^.\s]+$/.test(n);function _C(n){if(typeof n=="number")return n===0;if(n!==null)return n==="none"||n==="0"||bT(n)}function PC(n,e,t,r){const s=qh(e,t);let i;Array.isArray(t)?i=[...t]:i=[null,t];const o=r.from!==void 0?r.from:n.get();let l;const u=[];for(let d=0;d<i.length;d++)i[d]===null&&(i[d]=d===0?o:i[d-1]),_C(i[d])&&u.push(d),typeof i[d]=="string"&&i[d]!=="none"&&i[d]!=="0"&&(l=i[d]);if(s&&u.length&&l)for(let d=0;d<u.length;d++){const f=u[d];i[f]=TT(e,l)}return i}function DC({when:n,delay:e,delayChildren:t,staggerChildren:r,staggerDirection:s,repeat:i,repeatType:o,repeatDelay:l,from:u,elapsed:d,...f}){return!!Object.keys(f).length}function gp(n,e){return n[e]||n.default||n}const NC={skipAnimations:!1},yp=(n,e,t,r={})=>s=>{const i=gp(r,n)||{},o=i.delay||r.delay||0;let{elapsed:l=0}=r;l=l-ti(o);const u=PC(e,n,t,i),d=u[0],f=u[u.length-1],h=qh(n,d),p=qh(n,f);let x={keyframes:u,velocity:e.getVelocity(),ease:"easeOut",...i,delay:-l,onUpdate:g=>{e.set(g),i.onUpdate&&i.onUpdate(g)},onComplete:()=>{s(),i.onComplete&&i.onComplete()}};if(DC(i)||(x={...x,...LC(n,x)}),x.duration&&(x.duration=ti(x.duration)),x.repeatDelay&&(x.repeatDelay=ti(x.repeatDelay)),!h||!p||Ik.current||i.type===!1||NC.skipAnimations)return EC(x);if(!r.isHandoff&&e.owner&&e.owner.current instanceof HTMLElement&&!e.owner.getProps().onUpdate){const g=SC(e,n,x);if(g)return g}return tu(x)};function nu(n){return!!(mn(n)&&n.add)}const wT=n=>/^\-?\d*\.?\d+$/.test(n);function xp(n,e){n.indexOf(e)===-1&&n.push(e)}function vp(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}class Sp{constructor(){this.subscriptions=[]}add(e){return xp(this.subscriptions,e),()=>vp(this.subscriptions,e)}notify(e,t,r){const s=this.subscriptions.length;if(s)if(s===1)this.subscriptions[0](e,t,r);else for(let i=0;i<s;i++){const o=this.subscriptions[i];o&&o(e,t,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const OC=n=>!isNaN(parseFloat(n));class MC{constructor(e,t={}){this.version="10.18.0",this.timeDelta=0,this.lastUpdated=0,this.canTrackVelocity=!1,this.events={},this.updateAndNotify=(r,s=!0)=>{this.prev=this.current,this.current=r;const{delta:i,timestamp:o}=zt;this.lastUpdated!==o&&(this.timeDelta=i,this.lastUpdated=o,ot.postRender(this.scheduleVelocityCheck)),this.prev!==this.current&&this.events.change&&this.events.change.notify(this.current),this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()),s&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.scheduleVelocityCheck=()=>ot.postRender(this.velocityCheck),this.velocityCheck=({timestamp:r})=>{r!==this.lastUpdated&&(this.prev=this.current,this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()))},this.hasAnimated=!1,this.prev=this.current=e,this.canTrackVelocity=OC(this.current),this.owner=t.owner}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new Sp);const r=this.events[e].add(t);return e==="change"?()=>{r(),ot.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e,t=!0){!t||!this.passiveEffect?this.updateAndNotify(e,t):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,t,r){this.set(t),this.prev=e,this.timeDelta=r}jump(e){this.updateAndNotify(e),this.prev=e,this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){return this.canTrackVelocity?vT(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function qi(n,e){return new MC(n,e)}const AT=n=>e=>e.test(n),FC={test:n=>n==="auto",parse:n=>n},LT=[ui,Ce,vr,gs,HI,GI,FC],Jo=n=>LT.find(AT(n)),BC=[...LT,en,As],UC=n=>BC.find(AT(n));function $C(n,e,t){n.hasValue(e)?n.getValue(e).set(t):n.addValue(e,qi(t))}function jC(n,e){const t=Ou(n,e);let{transitionEnd:r={},transition:s={},...i}=t?n.makeTargetAnimatable(t,!1):{};i={...i,...r};for(const o in i){const l=sk(i[o]);$C(n,o,l)}}function VC(n,e,t){var r,s;const i=Object.keys(e).filter(l=>!n.hasValue(l)),o=i.length;if(o)for(let l=0;l<o;l++){const u=i[l],d=e[u];let f=null;Array.isArray(d)&&(f=d[0]),f===null&&(f=(s=(r=t[u])!==null&&r!==void 0?r:n.readValue(u))!==null&&s!==void 0?s:e[u]),f!=null&&(typeof f=="string"&&(wT(f)||bT(f))?f=parseFloat(f):!UC(f)&&As.test(d)&&(f=TT(u,d)),n.addValue(u,qi(f,{owner:n})),t[u]===void 0&&(t[u]=f),f!==null&&n.setBaseTarget(u,f))}}function GC(n,e){return e?(e[n]||e.default||e).from:void 0}function HC(n,e,t){const r={};for(const s in n){const i=GC(s,e);if(i!==void 0)r[s]=i;else{const o=t.getValue(s);o&&(r[s]=o.get())}}return r}function KC({protectedKeys:n,needsAnimating:e},t){const r=n.hasOwnProperty(t)&&e[t]!==!0;return e[t]=!1,r}function zC(n,e){const t=n.get();if(Array.isArray(e)){for(let r=0;r<e.length;r++)if(e[r]!==t)return!0}else return t!==e}function RT(n,e,{delay:t=0,transitionOverride:r,type:s}={}){let{transition:i=n.getDefaultTransition(),transitionEnd:o,...l}=n.makeTargetAnimatable(e);const u=n.getValue("willChange");r&&(i=r);const d=[],f=s&&n.animationState&&n.animationState.getState()[s];for(const h in l){const p=n.getValue(h),x=l[h];if(!p||x===void 0||f&&KC(f,h))continue;const g={delay:t,elapsed:0,...gp(i||{},h)};if(window.HandoffAppearAnimations){const b=n.getProps()[IE];if(b){const A=window.HandoffAppearAnimations(b,h,p,ot);A!==null&&(g.elapsed=A,g.isHandoff=!0)}}let E=!g.isHandoff&&!zC(p,x);if(g.type==="spring"&&(p.getVelocity()||g.velocity)&&(E=!1),p.animation&&(E=!1),E)continue;p.start(yp(h,p,x,n.shouldReduceMotion&&ci.has(h)?{type:!1}:g));const v=p.animation;nu(u)&&(u.add(h),v.then(()=>u.remove(h))),d.push(v)}return o&&Promise.all(d).then(()=>{o&&jC(n,o)}),d}function Qh(n,e,t={}){const r=Ou(n,e,t.custom);let{transition:s=n.getDefaultTransition()||{}}=r||{};t.transitionOverride&&(s=t.transitionOverride);const i=r?()=>Promise.all(RT(n,r,t)):()=>Promise.resolve(),o=n.variantChildren&&n.variantChildren.size?(u=0)=>{const{delayChildren:d=0,staggerChildren:f,staggerDirection:h}=s;return WC(n,e,d+u,f,h,t)}:()=>Promise.resolve(),{when:l}=s;if(l){const[u,d]=l==="beforeChildren"?[i,o]:[o,i];return u().then(()=>d())}else return Promise.all([i(),o(t.delay)])}function WC(n,e,t=0,r=0,s=1,i){const o=[],l=(n.variantChildren.size-1)*r,u=s===1?(d=0)=>d*r:(d=0)=>l-d*r;return Array.from(n.variantChildren).sort(YC).forEach((d,f)=>{d.notify("AnimationStart",e),o.push(Qh(d,e,{...i,delay:t+u(f)}).then(()=>d.notify("AnimationComplete",e)))}),Promise.all(o)}function YC(n,e){return n.sortNodePosition(e)}function qC(n,e,t={}){n.notify("AnimationStart",e);let r;if(Array.isArray(e)){const s=e.map(i=>Qh(n,i,t));r=Promise.all(s)}else if(typeof e=="string")r=Qh(n,e,t);else{const s=typeof e=="function"?Ou(n,e,t.custom):e;r=Promise.all(RT(n,s,t))}return r.then(()=>n.notify("AnimationComplete",e))}const XC=[...tp].reverse(),QC=tp.length;function JC(n){return e=>Promise.all(e.map(({animation:t,options:r})=>qC(n,t,r)))}function ZC(n){let e=JC(n);const t=t_();let r=!0;const s=(u,d)=>{const f=Ou(n,d);if(f){const{transition:h,transitionEnd:p,...x}=f;u={...u,...x,...p}}return u};function i(u){e=u(n)}function o(u,d){const f=n.getProps(),h=n.getVariantContext(!0)||{},p=[],x=new Set;let g={},E=1/0;for(let b=0;b<QC;b++){const A=XC[b],L=t[A],I=f[A]!==void 0?f[A]:h[A],_=ya(I),F=A===d?L.isActive:null;F===!1&&(E=b);let C=I===h[A]&&I!==f[A]&&_;if(C&&r&&n.manuallyAnimateOnMount&&(C=!1),L.protectedKeys={...g},!L.isActive&&F===null||!I&&!L.prevProp||_u(I)||typeof I=="boolean")continue;let O=e_(L.prevProp,I)||A===d&&L.isActive&&!C&&_||b>E&&_,M=!1;const H=Array.isArray(I)?I:[I];let Z=H.reduce(s,{});F===!1&&(Z={});const{prevResolvedValues:se={}}=L,U={...se,...Z},ne=q=>{O=!0,x.has(q)&&(M=!0,x.delete(q)),L.needsAnimating[q]=!0};for(const q in U){const te=Z[q],G=se[q];if(g.hasOwnProperty(q))continue;let Q=!1;Jc(te)&&Jc(G)?Q=!XE(te,G):Q=te!==G,Q?te!==void 0?ne(q):x.add(q):te!==void 0&&x.has(q)?ne(q):L.protectedKeys[q]=!0}L.prevProp=I,L.prevResolvedValues=Z,L.isActive&&(g={...g,...Z}),r&&n.blockInitialAnimation&&(O=!1),O&&(!C||M)&&p.push(...H.map(q=>({animation:q,options:{type:A,...u}})))}if(x.size){const b={};x.forEach(A=>{const L=n.getBaseTarget(A);L!==void 0&&(b[A]=L)}),p.push({animation:b})}let v=!!p.length;return r&&(f.initial===!1||f.initial===f.animate)&&!n.manuallyAnimateOnMount&&(v=!1),r=!1,v?e(p):Promise.resolve()}function l(u,d,f){var h;if(t[u].isActive===d)return Promise.resolve();(h=n.variantChildren)===null||h===void 0||h.forEach(x=>{var g;return(g=x.animationState)===null||g===void 0?void 0:g.setActive(u,d)}),t[u].isActive=d;const p=o(f,u);for(const x in t)t[x].protectedKeys={};return p}return{animateChanges:o,setActive:l,setAnimateFunction:i,getState:()=>t}}function e_(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!XE(e,n):!1}function Hs(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function t_(){return{animate:Hs(!0),whileInView:Hs(),whileHover:Hs(),whileTap:Hs(),whileDrag:Hs(),whileFocus:Hs(),exit:Hs()}}class n_ extends ks{constructor(e){super(e),e.animationState||(e.animationState=ZC(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();this.unmount(),_u(e)&&(this.unmount=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){}}let r_=0;class s_ extends ks{constructor(){super(...arguments),this.id=r_++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t,custom:r}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===s)return;const i=this.node.animationState.setActive("exit",!e,{custom:r??this.node.getProps().custom});t&&!e&&i.then(()=>t(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const i_={animation:{Feature:n_},exit:{Feature:s_}},yx=(n,e)=>Math.abs(n-e);function o_(n,e){const t=yx(n.x,e.x),r=yx(n.y,e.y);return Math.sqrt(t**2+r**2)}class IT{constructor(e,t,{transformPagePoint:r,contextWindow:s,dragSnapToOrigin:i=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const h=th(this.lastMoveEventInfo,this.history),p=this.startEvent!==null,x=o_(h.offset,{x:0,y:0})>=3;if(!p&&!x)return;const{point:g}=h,{timestamp:E}=zt;this.history.push({...g,timestamp:E});const{onStart:v,onMove:b}=this.handlers;p||(v&&v(this.lastMoveEvent,h),this.startEvent=this.lastMoveEvent),b&&b(this.lastMoveEvent,h)},this.handlePointerMove=(h,p)=>{this.lastMoveEvent=h,this.lastMoveEventInfo=eh(p,this.transformPagePoint),ot.update(this.updatePoint,!0)},this.handlePointerUp=(h,p)=>{this.end();const{onEnd:x,onSessionEnd:g,resumeAnimation:E}=this.handlers;if(this.dragSnapToOrigin&&E&&E(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const v=th(h.type==="pointercancel"?this.lastMoveEventInfo:eh(p,this.transformPagePoint),this.history);this.startEvent&&x&&x(h,v),g&&g(h,v)},!KE(e))return;this.dragSnapToOrigin=i,this.handlers=t,this.transformPagePoint=r,this.contextWindow=s||window;const o=Nu(e),l=eh(o,this.transformPagePoint),{point:u}=l,{timestamp:d}=zt;this.history=[{...u,timestamp:d}];const{onSessionStart:f}=t;f&&f(e,th(l,this.history)),this.removeListeners=Es(Gr(this.contextWindow,"pointermove",this.handlePointerMove),Gr(this.contextWindow,"pointerup",this.handlePointerUp),Gr(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Wr(this.updatePoint)}}function eh(n,e){return e?{point:e(n.point)}:n}function xx(n,e){return{x:n.x-e.x,y:n.y-e.y}}function th({point:n},e){return{point:n,delta:xx(n,kT(e)),offset:xx(n,a_(e)),velocity:l_(e,.1)}}function a_(n){return n[0]}function kT(n){return n[n.length-1]}function l_(n,e){if(n.length<2)return{x:0,y:0};let t=n.length-1,r=null;const s=kT(n);for(;t>=0&&(r=n[t],!(s.timestamp-r.timestamp>ti(e)));)t--;if(!r)return{x:0,y:0};const i=Hr(s.timestamp-r.timestamp);if(i===0)return{x:0,y:0};const o={x:(s.x-r.x)/i,y:(s.y-r.y)/i};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function kn(n){return n.max-n.min}function Jh(n,e=0,t=.01){return Math.abs(n-e)<=t}function vx(n,e,t,r=.5){n.origin=r,n.originPoint=mt(e.min,e.max,n.origin),n.scale=kn(t)/kn(e),(Jh(n.scale,1,1e-4)||isNaN(n.scale))&&(n.scale=1),n.translate=mt(t.min,t.max,n.origin)-n.originPoint,(Jh(n.translate)||isNaN(n.translate))&&(n.translate=0)}function ca(n,e,t,r){vx(n.x,e.x,t.x,r?r.originX:void 0),vx(n.y,e.y,t.y,r?r.originY:void 0)}function Sx(n,e,t){n.min=t.min+e.min,n.max=n.min+kn(e)}function c_(n,e,t){Sx(n.x,e.x,t.x),Sx(n.y,e.y,t.y)}function Ex(n,e,t){n.min=e.min-t.min,n.max=n.min+kn(e)}function ua(n,e,t){Ex(n.x,e.x,t.x),Ex(n.y,e.y,t.y)}function u_(n,{min:e,max:t},r){return e!==void 0&&n<e?n=r?mt(e,n,r.min):Math.max(n,e):t!==void 0&&n>t&&(n=r?mt(t,n,r.max):Math.min(n,t)),n}function Tx(n,e,t){return{min:e!==void 0?n.min+e:void 0,max:t!==void 0?n.max+t-(n.max-n.min):void 0}}function d_(n,{top:e,left:t,bottom:r,right:s}){return{x:Tx(n.x,t,s),y:Tx(n.y,e,r)}}function bx(n,e){let t=e.min-n.min,r=e.max-n.max;return e.max-e.min<n.max-n.min&&([t,r]=[r,t]),{min:t,max:r}}function f_(n,e){return{x:bx(n.x,e.x),y:bx(n.y,e.y)}}function h_(n,e){let t=.5;const r=kn(n),s=kn(e);return s>r?t=va(e.min,e.max-r,n.min):r>s&&(t=va(n.min,n.max-s,e.min)),ws(0,1,t)}function m_(n,e){const t={};return e.min!==void 0&&(t.min=e.min-n.min),e.max!==void 0&&(t.max=e.max-n.min),t}const Zh=.35;function p_(n=Zh){return n===!1?n=0:n===!0&&(n=Zh),{x:wx(n,"left","right"),y:wx(n,"top","bottom")}}function wx(n,e,t){return{min:Ax(n,e),max:Ax(n,t)}}function Ax(n,e){return typeof n=="number"?n:n[e]||0}const Lx=()=>({translate:0,scale:1,origin:0,originPoint:0}),Vi=()=>({x:Lx(),y:Lx()}),Rx=()=>({min:0,max:0}),Lt=()=>({x:Rx(),y:Rx()});function Un(n){return[n("x"),n("y")]}function CT({top:n,left:e,right:t,bottom:r}){return{x:{min:e,max:t},y:{min:n,max:r}}}function g_({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function y_(n,e){if(!e)return n;const t=e({x:n.left,y:n.top}),r=e({x:n.right,y:n.bottom});return{top:t.y,left:t.x,bottom:r.y,right:r.x}}function nh(n){return n===void 0||n===1}function em({scale:n,scaleX:e,scaleY:t}){return!nh(n)||!nh(e)||!nh(t)}function Ws(n){return em(n)||_T(n)||n.z||n.rotate||n.rotateX||n.rotateY}function _T(n){return Ix(n.x)||Ix(n.y)}function Ix(n){return n&&n!=="0%"}function ru(n,e,t){const r=n-t,s=e*r;return t+s}function kx(n,e,t,r,s){return s!==void 0&&(n=ru(n,s,r)),ru(n,t,r)+e}function tm(n,e=0,t=1,r,s){n.min=kx(n.min,e,t,r,s),n.max=kx(n.max,e,t,r,s)}function PT(n,{x:e,y:t}){tm(n.x,e.translate,e.scale,e.originPoint),tm(n.y,t.translate,t.scale,t.originPoint)}function x_(n,e,t,r=!1){const s=t.length;if(!s)return;e.x=e.y=1;let i,o;for(let l=0;l<s;l++){i=t[l],o=i.projectionDelta;const u=i.instance;u&&u.style&&u.style.display==="contents"||(r&&i.options.layoutScroll&&i.scroll&&i!==i.root&&Gi(n,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),o&&(e.x*=o.x.scale,e.y*=o.y.scale,PT(n,o)),r&&Ws(i.latestValues)&&Gi(n,i.latestValues))}e.x=Cx(e.x),e.y=Cx(e.y)}function Cx(n){return Number.isInteger(n)||n>1.0000000000001||n<.999999999999?n:1}function ys(n,e){n.min=n.min+e,n.max=n.max+e}function _x(n,e,[t,r,s]){const i=e[s]!==void 0?e[s]:.5,o=mt(n.min,n.max,i);tm(n,e[t],e[r],o,e.scale)}const v_=["x","scaleX","originX"],S_=["y","scaleY","originY"];function Gi(n,e){_x(n.x,e,v_),_x(n.y,e,S_)}function DT(n,e){return CT(y_(n.getBoundingClientRect(),e))}function E_(n,e,t){const r=DT(n,t),{scroll:s}=e;return s&&(ys(r.x,s.offset.x),ys(r.y,s.offset.y)),r}const NT=({current:n})=>n?n.ownerDocument.defaultView:null,T_=new WeakMap;class b_{constructor(e){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Lt(),this.visualElement=e}start(e,{snapToCursor:t=!1}={}){const{presenceContext:r}=this.visualElement;if(r&&r.isPresent===!1)return;const s=f=>{const{dragSnapToOrigin:h}=this.getProps();h?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(Nu(f,"page").point)},i=(f,h)=>{const{drag:p,dragPropagation:x,onDragStart:g}=this.getProps();if(p&&!x&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=WE(p),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Un(v=>{let b=this.getAxisMotionValue(v).get()||0;if(vr.test(b)){const{projection:A}=this.visualElement;if(A&&A.layout){const L=A.layout.layoutBox[v];L&&(b=kn(L)*(parseFloat(b)/100))}}this.originPoint[v]=b}),g&&ot.update(()=>g(f,h),!1,!0);const{animationState:E}=this.visualElement;E&&E.setActive("whileDrag",!0)},o=(f,h)=>{const{dragPropagation:p,dragDirectionLock:x,onDirectionLock:g,onDrag:E}=this.getProps();if(!p&&!this.openGlobalLock)return;const{offset:v}=h;if(x&&this.currentDirection===null){this.currentDirection=w_(v),this.currentDirection!==null&&g&&g(this.currentDirection);return}this.updateAxis("x",h.point,v),this.updateAxis("y",h.point,v),this.visualElement.render(),E&&E(f,h)},l=(f,h)=>this.stop(f,h),u=()=>Un(f=>{var h;return this.getAnimationState(f)==="paused"&&((h=this.getAxisMotionValue(f).animation)===null||h===void 0?void 0:h.play())}),{dragSnapToOrigin:d}=this.getProps();this.panSession=new IT(e,{onSessionStart:s,onStart:i,onMove:o,onSessionEnd:l,resumeAnimation:u},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:d,contextWindow:NT(this.visualElement)})}stop(e,t){const r=this.isDragging;if(this.cancel(),!r)return;const{velocity:s}=t;this.startAnimation(s);const{onDragEnd:i}=this.getProps();i&&ot.update(()=>i(e,t))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:r}=this.getProps();!r&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,r){const{drag:s}=this.getProps();if(!r||!dc(e,s,this.currentDirection))return;const i=this.getAxisMotionValue(e);let o=this.originPoint[e]+r[e];this.constraints&&this.constraints[e]&&(o=u_(o,this.constraints[e],this.elastic[e])),i.set(o)}resolveConstraints(){var e;const{dragConstraints:t,dragElastic:r}=this.getProps(),s=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,i=this.constraints;t&&$i(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&s?this.constraints=d_(s.layoutBox,t):this.constraints=!1,this.elastic=p_(r),i!==this.constraints&&s&&this.constraints&&!this.hasMutatedConstraints&&Un(o=>{this.getAxisMotionValue(o)&&(this.constraints[o]=m_(s.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!$i(e))return!1;const r=e.current,{projection:s}=this.visualElement;if(!s||!s.layout)return!1;const i=E_(r,s.root,this.visualElement.getTransformPagePoint());let o=f_(s.layout.layoutBox,i);if(t){const l=t(g_(o));this.hasMutatedConstraints=!!l,l&&(o=CT(l))}return o}startAnimation(e){const{drag:t,dragMomentum:r,dragElastic:s,dragTransition:i,dragSnapToOrigin:o,onDragTransitionEnd:l}=this.getProps(),u=this.constraints||{},d=Un(f=>{if(!dc(f,t,this.currentDirection))return;let h=u&&u[f]||{};o&&(h={min:0,max:0});const p=s?200:1e6,x=s?40:1e7,g={type:"inertia",velocity:r?e[f]:0,bounceStiffness:p,bounceDamping:x,timeConstant:750,restDelta:1,restSpeed:10,...i,...h};return this.startAxisValueAnimation(f,g)});return Promise.all(d).then(l)}startAxisValueAnimation(e,t){const r=this.getAxisMotionValue(e);return r.start(yp(e,r,0,t))}stopAnimation(){Un(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Un(e=>{var t;return(t=this.getAxisMotionValue(e).animation)===null||t===void 0?void 0:t.pause()})}getAnimationState(e){var t;return(t=this.getAxisMotionValue(e).animation)===null||t===void 0?void 0:t.state}getAxisMotionValue(e){const t="_drag"+e.toUpperCase(),r=this.visualElement.getProps(),s=r[t];return s||this.visualElement.getValue(e,(r.initial?r.initial[e]:void 0)||0)}snapToCursor(e){Un(t=>{const{drag:r}=this.getProps();if(!dc(t,r,this.currentDirection))return;const{projection:s}=this.visualElement,i=this.getAxisMotionValue(t);if(s&&s.layout){const{min:o,max:l}=s.layout.layoutBox[t];i.set(e[t]-mt(o,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:r}=this.visualElement;if(!$i(t)||!r||!this.constraints)return;this.stopAnimation();const s={x:0,y:0};Un(o=>{const l=this.getAxisMotionValue(o);if(l){const u=l.get();s[o]=h_({min:u,max:u},this.constraints[o])}});const{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),Un(o=>{if(!dc(o,e,null))return;const l=this.getAxisMotionValue(o),{min:u,max:d}=this.constraints[o];l.set(mt(u,d,s[o]))})}addListeners(){if(!this.visualElement.current)return;T_.set(this.visualElement,this);const e=this.visualElement.current,t=Gr(e,"pointerdown",u=>{const{drag:d,dragListener:f=!0}=this.getProps();d&&f&&this.start(u)}),r=()=>{const{dragConstraints:u}=this.getProps();$i(u)&&(this.constraints=this.resolveRefConstraints())},{projection:s}=this.visualElement,i=s.addEventListener("measure",r);s&&!s.layout&&(s.root&&s.root.updateScroll(),s.updateLayout()),r();const o=jr(window,"resize",()=>this.scalePositionWithinConstraints()),l=s.addEventListener("didUpdate",(({delta:u,hasLayoutChanged:d})=>{this.isDragging&&d&&(Un(f=>{const h=this.getAxisMotionValue(f);h&&(this.originPoint[f]+=u[f].translate,h.set(h.get()+u[f].translate))}),this.visualElement.render())}));return()=>{o(),t(),i(),l&&l()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:r=!1,dragPropagation:s=!1,dragConstraints:i=!1,dragElastic:o=Zh,dragMomentum:l=!0}=e;return{...e,drag:t,dragDirectionLock:r,dragPropagation:s,dragConstraints:i,dragElastic:o,dragMomentum:l}}}function dc(n,e,t){return(e===!0||e===n)&&(t===null||t===n)}function w_(n,e=10){let t=null;return Math.abs(n.y)>e?t="y":Math.abs(n.x)>e&&(t="x"),t}class A_ extends ks{constructor(e){super(e),this.removeGroupControls=bt,this.removeListeners=bt,this.controls=new b_(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||bt}unmount(){this.removeGroupControls(),this.removeListeners()}}const Px=n=>(e,t)=>{n&&ot.update(()=>n(e,t))};class L_ extends ks{constructor(){super(...arguments),this.removePointerDownListener=bt}onPointerDown(e){this.session=new IT(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:NT(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:r,onPanEnd:s}=this.node.getProps();return{onSessionStart:Px(e),onStart:Px(t),onMove:r,onEnd:(i,o)=>{delete this.session,s&&ot.update(()=>s(i,o))}}}mount(){this.removePointerDownListener=Gr(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}function R_(){const n=N.useContext(ku);if(n===null)return[!0,null];const{isPresent:e,onExitComplete:t,register:r}=n,s=N.useId();return N.useEffect(()=>r(s),[]),!e&&t?[!1,()=>t&&t(s)]:[!0]}const Mc={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function Dx(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const Zo={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if(Ce.test(n))n=parseFloat(n);else return n;const t=Dx(n,e.target.x),r=Dx(n,e.target.y);return`${t}% ${r}%`}},I_={correct:(n,{treeScale:e,projectionDelta:t})=>{const r=n,s=As.parse(n);if(s.length>5)return r;const i=As.createTransformer(n),o=typeof s[0]!="number"?1:0,l=t.x.scale*e.x,u=t.y.scale*e.y;s[0+o]/=l,s[1+o]/=u;const d=mt(l,u,.5);return typeof s[2+o]=="number"&&(s[2+o]/=d),typeof s[3+o]=="number"&&(s[3+o]/=d),i(s)}};class k_ extends Rn.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:r,layoutId:s}=this.props,{projection:i}=e;MI(C_),i&&(t.group&&t.group.add(i),r&&r.register&&s&&r.register(i),i.root.didUpdate(),i.addEventListener("animationComplete",()=>{this.safeToRemove()}),i.setOptions({...i.options,onExitComplete:()=>this.safeToRemove()})),Mc.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:r,drag:s,isPresent:i}=this.props,o=r.projection;return o&&(o.isPresent=i,s||e.layoutDependency!==t||t===void 0?o.willUpdate():this.safeToRemove(),e.isPresent!==i&&(i?o.promote():o.relegate()||ot.postRender(()=>{const l=o.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),queueMicrotask(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:r}=this.props,{projection:s}=e;s&&(s.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(s),r&&r.deregister&&r.deregister(s))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function OT(n){const[e,t]=R_(),r=N.useContext(rp);return Rn.createElement(k_,{...n,layoutGroup:r,switchLayoutGroup:N.useContext(CE),isPresent:e,safeToRemove:t})}const C_={borderRadius:{...Zo,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Zo,borderTopRightRadius:Zo,borderBottomLeftRadius:Zo,borderBottomRightRadius:Zo,boxShadow:I_},MT=["TopLeft","TopRight","BottomLeft","BottomRight"],__=MT.length,Nx=n=>typeof n=="string"?parseFloat(n):n,Ox=n=>typeof n=="number"||Ce.test(n);function P_(n,e,t,r,s,i){s?(n.opacity=mt(0,t.opacity!==void 0?t.opacity:1,D_(r)),n.opacityExit=mt(e.opacity!==void 0?e.opacity:1,0,N_(r))):i&&(n.opacity=mt(e.opacity!==void 0?e.opacity:1,t.opacity!==void 0?t.opacity:1,r));for(let o=0;o<__;o++){const l=`border${MT[o]}Radius`;let u=Mx(e,l),d=Mx(t,l);if(u===void 0&&d===void 0)continue;u||(u=0),d||(d=0),u===0||d===0||Ox(u)===Ox(d)?(n[l]=Math.max(mt(Nx(u),Nx(d),r),0),(vr.test(d)||vr.test(u))&&(n[l]+="%")):n[l]=d}(e.rotate||t.rotate)&&(n.rotate=mt(e.rotate||0,t.rotate||0,r))}function Mx(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const D_=FT(0,.5,iT),N_=FT(.5,.95,bt);function FT(n,e,t){return r=>r<n?0:r>e?1:t(va(n,e,r))}function Fx(n,e){n.min=e.min,n.max=e.max}function Bn(n,e){Fx(n.x,e.x),Fx(n.y,e.y)}function Bx(n,e,t,r,s){return n-=e,n=ru(n,1/t,r),s!==void 0&&(n=ru(n,1/s,r)),n}function O_(n,e=0,t=1,r=.5,s,i=n,o=n){if(vr.test(e)&&(e=parseFloat(e),e=mt(o.min,o.max,e/100)-o.min),typeof e!="number")return;let l=mt(i.min,i.max,r);n===i&&(l-=e),n.min=Bx(n.min,e,t,l,s),n.max=Bx(n.max,e,t,l,s)}function Ux(n,e,[t,r,s],i,o){O_(n,e[t],e[r],e[s],e.scale,i,o)}const M_=["x","scaleX","originX"],F_=["y","scaleY","originY"];function $x(n,e,t,r){Ux(n.x,e,M_,t?t.x:void 0,r?r.x:void 0),Ux(n.y,e,F_,t?t.y:void 0,r?r.y:void 0)}function jx(n){return n.translate===0&&n.scale===1}function BT(n){return jx(n.x)&&jx(n.y)}function B_(n,e){return n.x.min===e.x.min&&n.x.max===e.x.max&&n.y.min===e.y.min&&n.y.max===e.y.max}function UT(n,e){return Math.round(n.x.min)===Math.round(e.x.min)&&Math.round(n.x.max)===Math.round(e.x.max)&&Math.round(n.y.min)===Math.round(e.y.min)&&Math.round(n.y.max)===Math.round(e.y.max)}function Vx(n){return kn(n.x)/kn(n.y)}class U_{constructor(){this.members=[]}add(e){xp(this.members,e),e.scheduleRender()}remove(e){if(vp(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const t=this.members[this.members.length-1];t&&this.promote(t)}}relegate(e){const t=this.members.findIndex(s=>e===s);if(t===0)return!1;let r;for(let s=t;s>=0;s--){const i=this.members[s];if(i.isPresent!==!1){r=i;break}}return r?(this.promote(r),!0):!1}promote(e,t){const r=this.lead;if(e!==r&&(this.prevLead=r,this.lead=e,e.show(),r)){r.instance&&r.scheduleRender(),e.scheduleRender(),e.resumeFrom=r,t&&(e.resumeFrom.preserveOpacity=!0),r.snapshot&&(e.snapshot=r.snapshot,e.snapshot.latestValues=r.animationValues||r.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:s}=e.options;s===!1&&r.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:r}=e;t.onExitComplete&&t.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function Gx(n,e,t){let r="";const s=n.x.translate/e.x,i=n.y.translate/e.y;if((s||i)&&(r=`translate3d(${s}px, ${i}px, 0) `),(e.x!==1||e.y!==1)&&(r+=`scale(${1/e.x}, ${1/e.y}) `),t){const{rotate:u,rotateX:d,rotateY:f}=t;u&&(r+=`rotate(${u}deg) `),d&&(r+=`rotateX(${d}deg) `),f&&(r+=`rotateY(${f}deg) `)}const o=n.x.scale*e.x,l=n.y.scale*e.y;return(o!==1||l!==1)&&(r+=`scale(${o}, ${l})`),r||"none"}const $_=(n,e)=>n.depth-e.depth;class j_{constructor(){this.children=[],this.isDirty=!1}add(e){xp(this.children,e),this.isDirty=!0}remove(e){vp(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort($_),this.isDirty=!1,this.children.forEach(e)}}function V_(n,e){const t=performance.now(),r=({timestamp:s})=>{const i=s-t;i>=e&&(Wr(r),n(i-e))};return ot.read(r,!0),()=>Wr(r)}function G_(n){window.MotionDebug&&window.MotionDebug.record(n)}function H_(n){return n instanceof SVGElement&&n.tagName!=="svg"}function K_(n,e,t){const r=mn(n)?n:qi(n);return r.start(yp("",r,e,t)),r.animation}const Hx=["","X","Y","Z"],z_={visibility:"hidden"},Kx=1e3;let W_=0;const Ys={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function $T({attachResizeListener:n,defaultParent:e,measureScroll:t,checkIsScrollRoot:r,resetTransform:s}){return class{constructor(o={},l=e?.()){this.id=W_++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Ys.totalNodes=Ys.resolvedTargetDeltas=Ys.recalculatedProjection=0,this.nodes.forEach(X_),this.nodes.forEach(tP),this.nodes.forEach(nP),this.nodes.forEach(Q_),G_(Ys)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let u=0;u<this.path.length;u++)this.path[u].shouldResetTransform=!0;this.root===this&&(this.nodes=new j_)}addEventListener(o,l){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new Sp),this.eventHandlers.get(o).add(l)}notifyListeners(o,...l){const u=this.eventHandlers.get(o);u&&u.notify(...l)}hasListeners(o){return this.eventHandlers.has(o)}mount(o,l=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=H_(o),this.instance=o;const{layoutId:u,layout:d,visualElement:f}=this.options;if(f&&!f.current&&f.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),l&&(d||u)&&(this.isLayoutDirty=!0),n){let h;const p=()=>this.root.updateBlockedByResize=!1;n(o,()=>{this.root.updateBlockedByResize=!0,h&&h(),h=V_(p,250),Mc.hasAnimatedSinceResize&&(Mc.hasAnimatedSinceResize=!1,this.nodes.forEach(Wx))})}u&&this.root.registerSharedNode(u,this),this.options.animate!==!1&&f&&(u||d)&&this.addEventListener("didUpdate",({delta:h,hasLayoutChanged:p,hasRelativeTargetChanged:x,layout:g})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const E=this.options.transition||f.getDefaultTransition()||aP,{onLayoutAnimationStart:v,onLayoutAnimationComplete:b}=f.getProps(),A=!this.targetLayout||!UT(this.targetLayout,g)||x,L=!p&&x;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||L||p&&(A||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(h,L);const I={...gp(E,"layout"),onPlay:v,onComplete:b};(f.shouldReduceMotion||this.options.layoutRoot)&&(I.delay=0,I.type=!1),this.startAnimation(I)}else p||Wx(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=g})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Wr(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(rP),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let f=0;f<this.path.length;f++){const h=this.path[f];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:l,layout:u}=this.options;if(l===void 0&&!u)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(zx);return}this.isUpdating||this.nodes.forEach(Z_),this.isUpdating=!1,this.nodes.forEach(eP),this.nodes.forEach(Y_),this.nodes.forEach(q_),this.clearAllSnapshots();const l=performance.now();zt.delta=ws(0,1e3/60,l-zt.timestamp),zt.timestamp=l,zt.isProcessing=!0,zf.update.process(zt),zf.preRender.process(zt),zf.render.process(zt),zt.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,queueMicrotask(()=>this.update()))}clearAllSnapshots(){this.nodes.forEach(J_),this.sharedNodes.forEach(sP)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,ot.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){ot.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let u=0;u<this.path.length;u++)this.path[u].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Lt(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let l=!!(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(l=!1),l&&(this.scroll={animationId:this.root.animationId,phase:o,isRoot:r(this.instance),offset:t(this.instance)})}resetTransform(){if(!s)return;const o=this.isLayoutDirty||this.shouldResetTransform,l=this.projectionDelta&&!BT(this.projectionDelta),u=this.getTransformTemplate(),d=u?u(this.latestValues,""):void 0,f=d!==this.prevTransformTemplateValue;o&&(l||Ws(this.latestValues)||f)&&(s(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const l=this.measurePageBox();let u=this.removeElementScroll(l);return o&&(u=this.removeTransform(u)),lP(u),{animationId:this.root.animationId,measuredBox:l,layoutBox:u,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:o}=this.options;if(!o)return Lt();const l=o.measureViewportBox(),{scroll:u}=this.root;return u&&(ys(l.x,u.offset.x),ys(l.y,u.offset.y)),l}removeElementScroll(o){const l=Lt();Bn(l,o);for(let u=0;u<this.path.length;u++){const d=this.path[u],{scroll:f,options:h}=d;if(d!==this.root&&f&&h.layoutScroll){if(f.isRoot){Bn(l,o);const{scroll:p}=this.root;p&&(ys(l.x,-p.offset.x),ys(l.y,-p.offset.y))}ys(l.x,f.offset.x),ys(l.y,f.offset.y)}}return l}applyTransform(o,l=!1){const u=Lt();Bn(u,o);for(let d=0;d<this.path.length;d++){const f=this.path[d];!l&&f.options.layoutScroll&&f.scroll&&f!==f.root&&Gi(u,{x:-f.scroll.offset.x,y:-f.scroll.offset.y}),Ws(f.latestValues)&&Gi(u,f.latestValues)}return Ws(this.latestValues)&&Gi(u,this.latestValues),u}removeTransform(o){const l=Lt();Bn(l,o);for(let u=0;u<this.path.length;u++){const d=this.path[u];if(!d.instance||!Ws(d.latestValues))continue;em(d.latestValues)&&d.updateSnapshot();const f=Lt(),h=d.measurePageBox();Bn(f,h),$x(l,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,f)}return Ws(this.latestValues)&&$x(l,this.latestValues),l}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==zt.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){var l;const u=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=u.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=u.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=u.isSharedProjectionDirty);const d=!!this.resumingFrom||this!==u;if(!(o||d&&this.isSharedProjectionDirty||this.isProjectionDirty||!((l=this.parent)===null||l===void 0)&&l.isProjectionDirty||this.attemptToResolveRelativeTarget))return;const{layout:h,layoutId:p}=this.options;if(!(!this.layout||!(h||p))){if(this.resolvedRelativeTargetAt=zt.timestamp,!this.targetDelta&&!this.relativeTarget){const x=this.getClosestProjectingParent();x&&x.layout&&this.animationProgress!==1?(this.relativeParent=x,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Lt(),this.relativeTargetOrigin=Lt(),ua(this.relativeTargetOrigin,this.layout.layoutBox,x.layout.layoutBox),Bn(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Lt(),this.targetWithTransforms=Lt()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),c_(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Bn(this.target,this.layout.layoutBox),PT(this.target,this.targetDelta)):Bn(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const x=this.getClosestProjectingParent();x&&!!x.resumingFrom==!!this.resumingFrom&&!x.options.layoutScroll&&x.target&&this.animationProgress!==1?(this.relativeParent=x,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Lt(),this.relativeTargetOrigin=Lt(),ua(this.relativeTargetOrigin,this.target,x.target),Bn(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Ys.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||em(this.parent.latestValues)||_T(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var o;const l=this.getLead(),u=!!this.resumingFrom||this!==l;let d=!0;if((this.isProjectionDirty||!((o=this.parent)===null||o===void 0)&&o.isProjectionDirty)&&(d=!1),u&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(d=!1),this.resolvedRelativeTargetAt===zt.timestamp&&(d=!1),d)return;const{layout:f,layoutId:h}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(f||h))return;Bn(this.layoutCorrected,this.layout.layoutBox);const p=this.treeScale.x,x=this.treeScale.y;x_(this.layoutCorrected,this.treeScale,this.path,u),l.layout&&!l.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(l.target=l.layout.layoutBox);const{target:g}=l;if(!g){this.projectionTransform&&(this.projectionDelta=Vi(),this.projectionTransform="none",this.scheduleRender());return}this.projectionDelta||(this.projectionDelta=Vi(),this.projectionDeltaWithTransform=Vi());const E=this.projectionTransform;ca(this.projectionDelta,this.layoutCorrected,g,this.latestValues),this.projectionTransform=Gx(this.projectionDelta,this.treeScale),(this.projectionTransform!==E||this.treeScale.x!==p||this.treeScale.y!==x)&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",g)),Ys.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){if(this.options.scheduleRender&&this.options.scheduleRender(),o){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(o,l=!1){const u=this.snapshot,d=u?u.latestValues:{},f={...this.latestValues},h=Vi();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const p=Lt(),x=u?u.source:void 0,g=this.layout?this.layout.source:void 0,E=x!==g,v=this.getStack(),b=!v||v.members.length<=1,A=!!(E&&!b&&this.options.crossfade===!0&&!this.path.some(oP));this.animationProgress=0;let L;this.mixTargetDelta=I=>{const _=I/1e3;Yx(h.x,o.x,_),Yx(h.y,o.y,_),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(ua(p,this.layout.layoutBox,this.relativeParent.layout.layoutBox),iP(this.relativeTarget,this.relativeTargetOrigin,p,_),L&&B_(this.relativeTarget,L)&&(this.isProjectionDirty=!1),L||(L=Lt()),Bn(L,this.relativeTarget)),E&&(this.animationValues=f,P_(f,d,this.latestValues,_,A,b)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=_},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Wr(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=ot.update(()=>{Mc.hasAnimatedSinceResize=!0,this.currentAnimation=K_(0,Kx,{...o,onUpdate:l=>{this.mixTargetDelta(l),o.onUpdate&&o.onUpdate(l)},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Kx),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:l,target:u,layout:d,latestValues:f}=o;if(!(!l||!u||!d)){if(this!==o&&this.layout&&d&&jT(this.options.animationType,this.layout.layoutBox,d.layoutBox)){u=this.target||Lt();const h=kn(this.layout.layoutBox.x);u.x.min=o.target.x.min,u.x.max=u.x.min+h;const p=kn(this.layout.layoutBox.y);u.y.min=o.target.y.min,u.y.max=u.y.min+p}Bn(l,u),Gi(l,f),ca(this.projectionDeltaWithTransform,this.layoutCorrected,l,f)}}registerSharedNode(o,l){this.sharedNodes.has(o)||this.sharedNodes.set(o,new U_),this.sharedNodes.get(o).add(l);const d=l.options.initialPromotionConfig;l.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(l):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){var o;const{layoutId:l}=this.options;return l?((o=this.getStack())===null||o===void 0?void 0:o.lead)||this:this}getPrevLead(){var o;const{layoutId:l}=this.options;return l?(o=this.getStack())===null||o===void 0?void 0:o.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:l,preserveFollowOpacity:u}={}){const d=this.getStack();d&&d.promote(this,u),o&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetRotation(){const{visualElement:o}=this.options;if(!o)return;let l=!1;const{latestValues:u}=o;if((u.rotate||u.rotateX||u.rotateY||u.rotateZ)&&(l=!0),!l)return;const d={};for(let f=0;f<Hx.length;f++){const h="rotate"+Hx[f];u[h]&&(d[h]=u[h],o.setStaticValue(h,0))}o.render();for(const f in d)o.setStaticValue(f,d[f]);o.scheduleRender()}getProjectionStyles(o){var l,u;if(!this.instance||this.isSVG)return;if(!this.isVisible)return z_;const d={visibility:""},f=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,d.opacity="",d.pointerEvents=Oc(o?.pointerEvents)||"",d.transform=f?f(this.latestValues,""):"none",d;const h=this.getLead();if(!this.projectionDelta||!this.layout||!h.target){const E={};return this.options.layoutId&&(E.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,E.pointerEvents=Oc(o?.pointerEvents)||""),this.hasProjected&&!Ws(this.latestValues)&&(E.transform=f?f({},""):"none",this.hasProjected=!1),E}const p=h.animationValues||h.latestValues;this.applyTransformsToTarget(),d.transform=Gx(this.projectionDeltaWithTransform,this.treeScale,p),f&&(d.transform=f(p,d.transform));const{x,y:g}=this.projectionDelta;d.transformOrigin=`${x.origin*100}% ${g.origin*100}% 0`,h.animationValues?d.opacity=h===this?(u=(l=p.opacity)!==null&&l!==void 0?l:this.latestValues.opacity)!==null&&u!==void 0?u:1:this.preserveOpacity?this.latestValues.opacity:p.opacityExit:d.opacity=h===this?p.opacity!==void 0?p.opacity:"":p.opacityExit!==void 0?p.opacityExit:0;for(const E in Xc){if(p[E]===void 0)continue;const{correct:v,applyTo:b}=Xc[E],A=d.transform==="none"?p[E]:v(p[E],h);if(b){const L=b.length;for(let I=0;I<L;I++)d[b[I]]=A}else d[E]=A}return this.options.layoutId&&(d.pointerEvents=h===this?Oc(o?.pointerEvents)||"":"none"),d}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>{var l;return(l=o.currentAnimation)===null||l===void 0?void 0:l.stop()}),this.root.nodes.forEach(zx),this.root.sharedNodes.clear()}}}function Y_(n){n.updateLayout()}function q_(n){var e;const t=((e=n.resumeFrom)===null||e===void 0?void 0:e.snapshot)||n.snapshot;if(n.isLead()&&n.layout&&t&&n.hasListeners("didUpdate")){const{layoutBox:r,measuredBox:s}=n.layout,{animationType:i}=n.options,o=t.source!==n.layout.source;i==="size"?Un(h=>{const p=o?t.measuredBox[h]:t.layoutBox[h],x=kn(p);p.min=r[h].min,p.max=p.min+x}):jT(i,t.layoutBox,r)&&Un(h=>{const p=o?t.measuredBox[h]:t.layoutBox[h],x=kn(r[h]);p.max=p.min+x,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[h].max=n.relativeTarget[h].min+x)});const l=Vi();ca(l,r,t.layoutBox);const u=Vi();o?ca(u,n.applyTransform(s,!0),t.measuredBox):ca(u,r,t.layoutBox);const d=!BT(l);let f=!1;if(!n.resumeFrom){const h=n.getClosestProjectingParent();if(h&&!h.resumeFrom){const{snapshot:p,layout:x}=h;if(p&&x){const g=Lt();ua(g,t.layoutBox,p.layoutBox);const E=Lt();ua(E,r,x.layoutBox),UT(g,E)||(f=!0),h.options.layoutRoot&&(n.relativeTarget=E,n.relativeTargetOrigin=g,n.relativeParent=h)}}}n.notifyListeners("didUpdate",{layout:r,snapshot:t,delta:u,layoutDelta:l,hasLayoutChanged:d,hasRelativeTargetChanged:f})}else if(n.isLead()){const{onExitComplete:r}=n.options;r&&r()}n.options.transition=void 0}function X_(n){Ys.totalNodes++,n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function Q_(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function J_(n){n.clearSnapshot()}function zx(n){n.clearMeasurements()}function Z_(n){n.isLayoutDirty=!1}function eP(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function Wx(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function tP(n){n.resolveTargetDelta()}function nP(n){n.calcProjection()}function rP(n){n.resetRotation()}function sP(n){n.removeLeadSnapshot()}function Yx(n,e,t){n.translate=mt(e.translate,0,t),n.scale=mt(e.scale,1,t),n.origin=e.origin,n.originPoint=e.originPoint}function qx(n,e,t,r){n.min=mt(e.min,t.min,r),n.max=mt(e.max,t.max,r)}function iP(n,e,t,r){qx(n.x,e.x,t.x,r),qx(n.y,e.y,t.y,r)}function oP(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const aP={duration:.45,ease:[.4,0,.1,1]},Xx=n=>typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes(n),Qx=Xx("applewebkit/")&&!Xx("chrome/")?Math.round:bt;function Jx(n){n.min=Qx(n.min),n.max=Qx(n.max)}function lP(n){Jx(n.x),Jx(n.y)}function jT(n,e,t){return n==="position"||n==="preserve-aspect"&&!Jh(Vx(e),Vx(t),.2)}const cP=$T({attachResizeListener:(n,e)=>jr(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),rh={current:void 0},VT=$T({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!rh.current){const n=new cP({});n.mount(window),n.setOptions({layoutScroll:!0}),rh.current=n}return rh.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),uP={pan:{Feature:L_},drag:{Feature:A_,ProjectionNode:VT,MeasureLayout:OT}},dP=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/;function fP(n){const e=dP.exec(n);if(!e)return[,];const[,t,r]=e;return[t,r]}function nm(n,e,t=1){const[r,s]=fP(n);if(!r)return;const i=window.getComputedStyle(e).getPropertyValue(r);if(i){const o=i.trim();return wT(o)?parseFloat(o):o}else return Kh(s)?nm(s,e,t+1):s}function hP(n,{...e},t){const r=n.current;if(!(r instanceof Element))return{target:e,transitionEnd:t};t&&(t={...t}),n.values.forEach(s=>{const i=s.get();if(!Kh(i))return;const o=nm(i,r);o&&s.set(o)});for(const s in e){const i=e[s];if(!Kh(i))continue;const o=nm(i,r);o&&(e[s]=o,t||(t={}),t[s]===void 0&&(t[s]=i))}return{target:e,transitionEnd:t}}const mP=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),GT=n=>mP.has(n),pP=n=>Object.keys(n).some(GT),Zx=n=>n===ui||n===Ce,ev=(n,e)=>parseFloat(n.split(", ")[e]),tv=(n,e)=>(t,{transform:r})=>{if(r==="none"||!r)return 0;const s=r.match(/^matrix3d\((.+)\)$/);if(s)return ev(s[1],e);{const i=r.match(/^matrix\((.+)\)$/);return i?ev(i[1],n):0}},gP=new Set(["x","y","z"]),yP=Ba.filter(n=>!gP.has(n));function xP(n){const e=[];return yP.forEach(t=>{const r=n.getValue(t);r!==void 0&&(e.push([t,r.get()]),r.set(t.startsWith("scale")?1:0))}),e.length&&n.render(),e}const Xi={width:({x:n},{paddingLeft:e="0",paddingRight:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),height:({y:n},{paddingTop:e="0",paddingBottom:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:tv(4,13),y:tv(5,14)};Xi.translateX=Xi.x;Xi.translateY=Xi.y;const vP=(n,e,t)=>{const r=e.measureViewportBox(),s=e.current,i=getComputedStyle(s),{display:o}=i,l={};o==="none"&&e.setStaticValue("display",n.display||"block"),t.forEach(d=>{l[d]=Xi[d](r,i)}),e.render();const u=e.measureViewportBox();return t.forEach(d=>{const f=e.getValue(d);f&&f.jump(l[d]),n[d]=Xi[d](u,i)}),n},SP=(n,e,t={},r={})=>{e={...e},r={...r};const s=Object.keys(e).filter(GT);let i=[],o=!1;const l=[];if(s.forEach(u=>{const d=n.getValue(u);if(!n.hasValue(u))return;let f=t[u],h=Jo(f);const p=e[u];let x;if(Jc(p)){const g=p.length,E=p[0]===null?1:0;f=p[E],h=Jo(f);for(let v=E;v<g&&p[v]!==null;v++)x?dp(Jo(p[v])===x):x=Jo(p[v])}else x=Jo(p);if(h!==x)if(Zx(h)&&Zx(x)){const g=d.get();typeof g=="string"&&d.set(parseFloat(g)),typeof p=="string"?e[u]=parseFloat(p):Array.isArray(p)&&x===Ce&&(e[u]=p.map(parseFloat))}else h?.transform&&x?.transform&&(f===0||p===0)?f===0?d.set(x.transform(f)):e[u]=h.transform(p):(o||(i=xP(n),o=!0),l.push(u),r[u]=r[u]!==void 0?r[u]:e[u],d.jump(p))}),l.length){const u=l.indexOf("height")>=0?window.pageYOffset:null,d=vP(e,n,l);return i.length&&i.forEach(([f,h])=>{n.getValue(f).set(h)}),n.render(),Cu&&u!==null&&window.scrollTo({top:u}),{target:d,transitionEnd:r}}else return{target:e,transitionEnd:r}};function EP(n,e,t,r){return pP(e)?SP(n,e,t,r):{target:e,transitionEnd:r}}const TP=(n,e,t,r)=>{const s=hP(n,e,r);return e=s.target,r=s.transitionEnd,EP(n,e,t,r)},rm={current:null},HT={current:!1};function bP(){if(HT.current=!0,!!Cu)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>rm.current=n.matches;n.addListener(e),e()}else rm.current=!1}function wP(n,e,t){const{willChange:r}=e;for(const s in e){const i=e[s],o=t[s];if(mn(i))n.addValue(s,i),nu(r)&&r.add(s);else if(mn(o))n.addValue(s,qi(i,{owner:n})),nu(r)&&r.remove(s);else if(o!==i)if(n.hasValue(s)){const l=n.getValue(s);!l.hasAnimated&&l.set(i)}else{const l=n.getStaticValue(s);n.addValue(s,qi(l!==void 0?l:i,{owner:n}))}}for(const s in t)e[s]===void 0&&n.removeValue(s);return e}const nv=new WeakMap,KT=Object.keys(xa),AP=KT.length,rv=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],LP=np.length;class RP{constructor({parent:e,props:t,presenceContext:r,reducedMotionConfig:s,visualState:i},o={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>ot.render(this.render,!1,!0);const{latestValues:l,renderState:u}=i;this.latestValues=l,this.baseTarget={...l},this.initialValues=t.initial?{...l}:{},this.renderState=u,this.parent=e,this.props=t,this.presenceContext=r,this.depth=e?e.depth+1:0,this.reducedMotionConfig=s,this.options=o,this.isControllingVariants=Pu(t),this.isVariantNode=kE(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:d,...f}=this.scrapeMotionValuesFromProps(t,{});for(const h in f){const p=f[h];l[h]!==void 0&&mn(p)&&(p.set(l[h],!1),nu(d)&&d.add(h))}}scrapeMotionValuesFromProps(e,t){return{}}mount(e){this.current=e,nv.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((t,r)=>this.bindToMotionValue(r,t)),HT.current||bP(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:rm.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){nv.delete(this.current),this.projection&&this.projection.unmount(),Wr(this.notifyUpdate),Wr(this.render),this.valueSubscriptions.forEach(e=>e()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features)this.features[e].unmount();this.current=null}bindToMotionValue(e,t){const r=ci.has(e),s=t.on("change",o=>{this.latestValues[e]=o,this.props.onUpdate&&ot.update(this.notifyUpdate,!1,!0),r&&this.projection&&(this.projection.isTransformDirty=!0)}),i=t.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(e,()=>{s(),i()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}loadFeatures({children:e,...t},r,s,i){let o,l;for(let u=0;u<AP;u++){const d=KT[u],{isEnabled:f,Feature:h,ProjectionNode:p,MeasureLayout:x}=xa[d];p&&(o=p),f(t)&&(!this.features[d]&&h&&(this.features[d]=new h(this)),x&&(l=x))}if((this.type==="html"||this.type==="svg")&&!this.projection&&o){this.projection=new o(this.latestValues,this.parent&&this.parent.projection);const{layoutId:u,layout:d,drag:f,dragConstraints:h,layoutScroll:p,layoutRoot:x}=t;this.projection.setOptions({layoutId:u,layout:d,alwaysMeasureLayout:!!f||h&&$i(h),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:typeof d=="string"?d:"both",initialPromotionConfig:i,layoutScroll:p,layoutRoot:x})}return l}updateFeatures(){for(const e in this.features){const t=this.features[e];t.isMounted?t.update():(t.mount(),t.isMounted=!0)}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Lt()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}makeTargetAnimatable(e,t=!0){return this.makeTargetAnimatableFromInstance(e,this.props,t)}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let r=0;r<rv.length;r++){const s=rv[r];this.propEventSubscriptions[s]&&(this.propEventSubscriptions[s](),delete this.propEventSubscriptions[s]);const i=e["on"+s];i&&(this.propEventSubscriptions[s]=this.on(s,i))}this.prevMotionValues=wP(this,this.scrapeMotionValuesFromProps(e,this.prevProps),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(e=!1){if(e)return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const r=this.parent?this.parent.getVariantContext()||{}:{};return this.props.initial!==void 0&&(r.initial=this.props.initial),r}const t={};for(let r=0;r<LP;r++){const s=np[r],i=this.props[s];(ya(i)||i===!1)&&(t[s]=i)}return t}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){t!==this.values.get(e)&&(this.removeValue(e),this.bindToMotionValue(e,t)),this.values.set(e,t),this.latestValues[e]=t.get()}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let r=this.values.get(e);return r===void 0&&t!==void 0&&(r=qi(t,{owner:this}),this.addValue(e,r)),r}readValue(e){var t;return this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(t=this.getBaseTargetFromProps(this.props,e))!==null&&t!==void 0?t:this.readValueFromInstance(this.current,e,this.options)}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){var t;const{initial:r}=this.props,s=typeof r=="string"||typeof r=="object"?(t=up(this.props,r))===null||t===void 0?void 0:t[e]:void 0;if(r&&s!==void 0)return s;const i=this.getBaseTargetFromProps(this.props,e);return i!==void 0&&!mn(i)?i:this.initialValues[e]!==void 0&&s===void 0?void 0:this.baseTarget[e]}on(e,t){return this.events[e]||(this.events[e]=new Sp),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}}class zT extends RP{sortInstanceNodePosition(e,t){return e.compareDocumentPosition(t)&2?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:r}){delete t[e],delete r[e]}makeTargetAnimatableFromInstance({transition:e,transitionEnd:t,...r},{transformValues:s},i){let o=HC(r,e||{},this);if(s&&(t&&(t=s(t)),r&&(r=s(r)),o&&(o=s(o))),i){VC(this,r,o);const l=TP(this,r,o,t);t=l.transitionEnd,r=l.target}return{transition:e,transitionEnd:t,...r}}}function IP(n){return window.getComputedStyle(n)}class kP extends zT{constructor(){super(...arguments),this.type="html"}readValueFromInstance(e,t){if(ci.has(t)){const r=pp(t);return r&&r.default||0}else{const r=IP(e),s=(DE(t)?r.getPropertyValue(t):r[t])||0;return typeof s=="string"?s.trim():s}}measureInstanceViewportBox(e,{transformPagePoint:t}){return DT(e,t)}build(e,t,r,s){ip(e,t,r,s.transformTemplate)}scrapeMotionValuesFromProps(e,t){return cp(e,t)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;mn(e)&&(this.childSubscription=e.on("change",t=>{this.current&&(this.current.textContent=`${t}`)}))}renderInstance(e,t,r,s){UE(e,t,r,s)}}class CP extends zT{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(ci.has(t)){const r=pp(t);return r&&r.default||0}return t=$E.has(t)?t:ep(t),e.getAttribute(t)}measureInstanceViewportBox(){return Lt()}scrapeMotionValuesFromProps(e,t){return VE(e,t)}build(e,t,r,s){ap(e,t,r,this.isSVGTag,s.transformTemplate)}renderInstance(e,t,r,s){jE(e,t,r,s)}mount(e){this.isSVGTag=lp(e.tagName),super.mount(e)}}const _P=(n,e)=>sp(n)?new CP(e,{enableHardwareAcceleration:!1}):new kP(e,{enableHardwareAcceleration:!0}),PP={layout:{ProjectionNode:VT,MeasureLayout:OT}},DP={...i_,...Ak,...uP,...PP},nt=NI((n,e)=>fk(n,e,DP,_P));function WT(){const n=N.useRef(!1);return Zm(()=>(n.current=!0,()=>{n.current=!1}),[]),n}function NP(){const n=WT(),[e,t]=N.useState(0),r=N.useCallback(()=>{n.current&&t(e+1)},[e]);return[N.useCallback(()=>ot.postRender(r),[r]),e]}class OP extends N.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const r=this.props.sizeRef.current;r.height=t.offsetHeight||0,r.width=t.offsetWidth||0,r.top=t.offsetTop,r.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function MP({children:n,isPresent:e}){const t=N.useId(),r=N.useRef(null),s=N.useRef({width:0,height:0,top:0,left:0});return N.useInsertionEffect(()=>{const{width:i,height:o,top:l,left:u}=s.current;if(e||!r.current||!i||!o)return;r.current.dataset.motionPopId=t;const d=document.createElement("style");return document.head.appendChild(d),d.sheet&&d.sheet.insertRule(`
          [data-motion-pop-id="${t}"] {
            position: absolute !important;
            width: ${i}px !important;
            height: ${o}px !important;
            top: ${l}px !important;
            left: ${u}px !important;
          }
        `),()=>{document.head.removeChild(d)}},[e]),N.createElement(OP,{isPresent:e,childRef:r,sizeRef:s},N.cloneElement(n,{ref:r}))}const sh=({children:n,initial:e,isPresent:t,onExitComplete:r,custom:s,presenceAffectsLayout:i,mode:o})=>{const l=GE(FP),u=N.useId(),d=N.useMemo(()=>({id:u,initial:e,isPresent:t,custom:s,onExitComplete:f=>{l.set(f,!0);for(const h of l.values())if(!h)return;r&&r()},register:f=>(l.set(f,!1),()=>l.delete(f))}),i?void 0:[t]);return N.useMemo(()=>{l.forEach((f,h)=>l.set(h,!1))},[t]),N.useEffect(()=>{!t&&!l.size&&r&&r()},[t]),o==="popLayout"&&(n=N.createElement(MP,{isPresent:t},n)),N.createElement(ku.Provider,{value:d},n)};function FP(){return new Map}function BP(n){return N.useEffect(()=>()=>n(),[])}const qs=n=>n.key||"";function UP(n,e){n.forEach(t=>{const r=qs(t);e.set(r,t)})}function $P(n){const e=[];return N.Children.forEach(n,t=>{N.isValidElement(t)&&e.push(t)}),e}const Sa=({children:n,custom:e,initial:t=!0,onExitComplete:r,exitBeforeEnter:s,presenceAffectsLayout:i=!0,mode:o="sync"})=>{const l=N.useContext(rp).forceRender||NP()[0],u=WT(),d=$P(n);let f=d;const h=N.useRef(new Map).current,p=N.useRef(f),x=N.useRef(new Map).current,g=N.useRef(!0);if(Zm(()=>{g.current=!1,UP(d,x),p.current=f}),BP(()=>{g.current=!0,x.clear(),h.clear()}),g.current)return N.createElement(N.Fragment,null,f.map(A=>N.createElement(sh,{key:qs(A),isPresent:!0,initial:t?void 0:!1,presenceAffectsLayout:i,mode:o},A)));f=[...f];const E=p.current.map(qs),v=d.map(qs),b=E.length;for(let A=0;A<b;A++){const L=E[A];v.indexOf(L)===-1&&!h.has(L)&&h.set(L,void 0)}return o==="wait"&&h.size&&(f=[]),h.forEach((A,L)=>{if(v.indexOf(L)!==-1)return;const I=x.get(L);if(!I)return;const _=E.indexOf(L);let F=A;if(!F){const C=()=>{h.delete(L);const P=Array.from(x.keys()).filter(O=>!v.includes(O));if(P.forEach(O=>x.delete(O)),p.current=d.filter(O=>{const M=qs(O);return M===L||P.includes(M)}),!h.size){if(u.current===!1)return;l(),r&&r()}};F=N.createElement(sh,{key:qs(I),isPresent:!1,onExitComplete:C,custom:e,presenceAffectsLayout:i,mode:o},I),h.set(L,F)}f.splice(_,0,F)}),f=f.map(A=>{const L=A.key;return h.has(L)?A:N.createElement(sh,{key:qs(A),isPresent:!0,presenceAffectsLayout:i,mode:o},A)}),N.createElement(N.Fragment,null,h.size?f:f.map(A=>N.cloneElement(A)))};var YT={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},sv=Rn.createContext&&Rn.createContext(YT),Ts=function(){return Ts=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=e[s])}return n},Ts.apply(this,arguments)},jP=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};function qT(n){return n&&n.map(function(e,t){return Rn.createElement(e.tag,Ts({key:t},e.attr),qT(e.child))})}function He(n){return function(e){return Rn.createElement(VP,Ts({attr:Ts({},n.attr)},e),qT(n.child))}}function VP(n){var e=function(t){var r=n.attr,s=n.size,i=n.title,o=jP(n,["attr","size","title"]),l=s||t.size||"1em",u;return t.className&&(u=t.className),n.className&&(u=(u?u+" ":"")+n.className),Rn.createElement("svg",Ts({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,o,{className:u,style:Ts(Ts({color:n.color||t.color},t.style),n.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),i&&Rn.createElement("title",null,i),n.children)};return sv!==void 0?Rn.createElement(sv.Consumer,null,function(t){return e(t)}):e(YT)}function GP(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"16",x2:"12.01",y2:"16"}}]})(n)}function su(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"5",y1:"12",x2:"19",y2:"12"}},{tag:"polyline",attr:{points:"12 5 19 12 12 19"}}]})(n)}function HP(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"8",r:"7"}},{tag:"polyline",attr:{points:"8.21 13.89 7 23 12 20 17 23 15.79 13.88"}}]})(n)}function XT(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}},{tag:"path",attr:{d:"M13.73 21a2 2 0 0 1-3.46 0"}}]})(n)}function KP(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"line",attr:{x1:"16",y1:"2",x2:"16",y2:"6"}},{tag:"line",attr:{x1:"8",y1:"2",x2:"8",y2:"6"}},{tag:"line",attr:{x1:"3",y1:"10",x2:"21",y2:"10"}}]})(n)}function sm(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"20 6 9 17 4 12"}}]})(n)}function iu(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"6 9 12 15 18 9"}}]})(n)}function zP(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"15 18 9 12 15 6"}}]})(n)}function WP(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"9 18 15 12 9 6"}}]})(n)}function Ep(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"polyline",attr:{points:"12 6 12 12 16 14"}}]})(n)}function QT(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}},{tag:"polyline",attr:{points:"7 10 12 15 17 10"}},{tag:"line",attr:{x1:"12",y1:"15",x2:"12",y2:"3"}}]})(n)}function im(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"}},{tag:"line",attr:{x1:"1",y1:"1",x2:"23",y2:"23"}}]})(n)}function om(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}},{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}}]})(n)}function Va(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"2",y:"2",width:"20",height:"20",rx:"2.18",ry:"2.18"}},{tag:"line",attr:{x1:"7",y1:"2",x2:"7",y2:"22"}},{tag:"line",attr:{x1:"17",y1:"2",x2:"17",y2:"22"}},{tag:"line",attr:{x1:"2",y1:"12",x2:"22",y2:"12"}},{tag:"line",attr:{x1:"2",y1:"7",x2:"7",y2:"7"}},{tag:"line",attr:{x1:"2",y1:"17",x2:"7",y2:"17"}},{tag:"line",attr:{x1:"17",y1:"17",x2:"22",y2:"17"}},{tag:"line",attr:{x1:"17",y1:"7",x2:"22",y2:"7"}}]})(n)}function JT(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"}}]})(n)}function ZT(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}},{tag:"polyline",attr:{points:"9 22 9 12 15 12 15 22"}}]})(n)}function YP(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"12",y1:"16",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12.01",y2:"8"}}]})(n)}function e1(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}},{tag:"polyline",attr:{points:"16 17 21 12 16 7"}},{tag:"line",attr:{x1:"21",y1:"12",x2:"9",y2:"12"}}]})(n)}function t1(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"}},{tag:"polyline",attr:{points:"22,6 12,13 2,6"}}]})(n)}function qP(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"}}]})(n)}function XP(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"3",y1:"12",x2:"21",y2:"12"}},{tag:"line",attr:{x1:"3",y1:"6",x2:"21",y2:"6"}},{tag:"line",attr:{x1:"3",y1:"18",x2:"21",y2:"18"}}]})(n)}function nr(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"5 3 19 12 5 21 5 3"}}]})(n)}function n1(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"12",y1:"5",x2:"12",y2:"19"}},{tag:"line",attr:{x1:"5",y1:"12",x2:"19",y2:"12"}}]})(n)}function ou(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"2"}},{tag:"path",attr:{d:"M16.24 7.76a6 6 0 0 1 0 8.49m-8.48-.01a6 6 0 0 1 0-8.49m11.31-2.82a10 10 0 0 1 0 14.14m-14.14 0a10 10 0 0 1 0-14.14"}}]})(n)}function au(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"11",cy:"11",r:"8"}},{tag:"line",attr:{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}}]})(n)}function QP(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"22",y1:"2",x2:"11",y2:"13"}},{tag:"polygon",attr:{points:"22 2 15 22 11 13 2 9 22 2"}}]})(n)}function r1(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}}]})(n)}function JP(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"18",cy:"5",r:"3"}},{tag:"circle",attr:{cx:"6",cy:"12",r:"3"}},{tag:"circle",attr:{cx:"18",cy:"19",r:"3"}},{tag:"line",attr:{x1:"8.59",y1:"13.51",x2:"15.42",y2:"17.49"}},{tag:"line",attr:{x1:"15.41",y1:"6.51",x2:"8.59",y2:"10.49"}}]})(n)}function Mu(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"}}]})(n)}function ZP(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"}}]})(n)}function eD(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"}}]})(n)}function Tp(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"23 6 13.5 15.5 8.5 10.5 1 18"}},{tag:"polyline",attr:{points:"17 6 23 6 23 12"}}]})(n)}function Fu(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"2",y:"7",width:"20",height:"15",rx:"2",ry:"2"}},{tag:"polyline",attr:{points:"17 2 12 7 7 2"}}]})(n)}function s1(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"12",cy:"7",r:"4"}}]})(n)}function An(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"18",y1:"6",x2:"6",y2:"18"}},{tag:"line",attr:{x1:"6",y1:"6",x2:"18",y2:"18"}}]})(n)}function tD(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"}}]})(n)}function i1(n,e){return function(){return n.apply(e,arguments)}}const{toString:nD}=Object.prototype,{getPrototypeOf:bp}=Object,{iterator:Bu,toStringTag:o1}=Symbol,Uu=(n=>e=>{const t=nD.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),rr=n=>(n=n.toLowerCase(),e=>Uu(e)===n),$u=n=>e=>typeof e===n,{isArray:ro}=Array,Qi=$u("undefined");function Ga(n){return n!==null&&!Qi(n)&&n.constructor!==null&&!Qi(n.constructor)&&fn(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const a1=rr("ArrayBuffer");function rD(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&a1(n.buffer),e}const sD=$u("string"),fn=$u("function"),l1=$u("number"),Ha=n=>n!==null&&typeof n=="object",iD=n=>n===!0||n===!1,Fc=n=>{if(Uu(n)!=="object")return!1;const e=bp(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(o1 in n)&&!(Bu in n)},oD=n=>{if(!Ha(n)||Ga(n))return!1;try{return Object.keys(n).length===0&&Object.getPrototypeOf(n)===Object.prototype}catch{return!1}},aD=rr("Date"),lD=rr("File"),cD=rr("Blob"),uD=rr("FileList"),dD=n=>Ha(n)&&fn(n.pipe),fD=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||fn(n.append)&&((e=Uu(n))==="formdata"||e==="object"&&fn(n.toString)&&n.toString()==="[object FormData]"))},hD=rr("URLSearchParams"),[mD,pD,gD,yD]=["ReadableStream","Request","Response","Headers"].map(rr),xD=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Ka(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let r,s;if(typeof n!="object"&&(n=[n]),ro(n))for(r=0,s=n.length;r<s;r++)e.call(null,n[r],r,n);else{if(Ga(n))return;const i=t?Object.getOwnPropertyNames(n):Object.keys(n),o=i.length;let l;for(r=0;r<o;r++)l=i[r],e.call(null,n[l],l,n)}}function c1(n,e){if(Ga(n))return null;e=e.toLowerCase();const t=Object.keys(n);let r=t.length,s;for(;r-- >0;)if(s=t[r],e===s.toLowerCase())return s;return null}const Zs=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,u1=n=>!Qi(n)&&n!==Zs;function am(){const{caseless:n,skipUndefined:e}=u1(this)&&this||{},t={},r=(s,i)=>{const o=n&&c1(t,i)||i;Fc(t[o])&&Fc(s)?t[o]=am(t[o],s):Fc(s)?t[o]=am({},s):ro(s)?t[o]=s.slice():(!e||!Qi(s))&&(t[o]=s)};for(let s=0,i=arguments.length;s<i;s++)arguments[s]&&Ka(arguments[s],r);return t}const vD=(n,e,t,{allOwnKeys:r}={})=>(Ka(e,(s,i)=>{t&&fn(s)?n[i]=i1(s,t):n[i]=s},{allOwnKeys:r}),n),SD=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),ED=(n,e,t,r)=>{n.prototype=Object.create(e.prototype,r),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},TD=(n,e,t,r)=>{let s,i,o;const l={};if(e=e||{},n==null)return e;do{for(s=Object.getOwnPropertyNames(n),i=s.length;i-- >0;)o=s[i],(!r||r(o,n,e))&&!l[o]&&(e[o]=n[o],l[o]=!0);n=t!==!1&&bp(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},bD=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const r=n.indexOf(e,t);return r!==-1&&r===t},wD=n=>{if(!n)return null;if(ro(n))return n;let e=n.length;if(!l1(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},AD=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&bp(Uint8Array)),LD=(n,e)=>{const r=(n&&n[Bu]).call(n);let s;for(;(s=r.next())&&!s.done;){const i=s.value;e.call(n,i[0],i[1])}},RD=(n,e)=>{let t;const r=[];for(;(t=n.exec(e))!==null;)r.push(t);return r},ID=rr("HTMLFormElement"),kD=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,s){return r.toUpperCase()+s}),iv=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),CD=rr("RegExp"),d1=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),r={};Ka(t,(s,i)=>{let o;(o=e(s,i,n))!==!1&&(r[i]=o||s)}),Object.defineProperties(n,r)},_D=n=>{d1(n,(e,t)=>{if(fn(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const r=n[t];if(fn(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},PD=(n,e)=>{const t={},r=s=>{s.forEach(i=>{t[i]=!0})};return ro(n)?r(n):r(String(n).split(e)),t},DD=()=>{},ND=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e;function OD(n){return!!(n&&fn(n.append)&&n[o1]==="FormData"&&n[Bu])}const MD=n=>{const e=new Array(10),t=(r,s)=>{if(Ha(r)){if(e.indexOf(r)>=0)return;if(Ga(r))return r;if(!("toJSON"in r)){e[s]=r;const i=ro(r)?[]:{};return Ka(r,(o,l)=>{const u=t(o,s+1);!Qi(u)&&(i[l]=u)}),e[s]=void 0,i}}return r};return t(n,0)},FD=rr("AsyncFunction"),BD=n=>n&&(Ha(n)||fn(n))&&fn(n.then)&&fn(n.catch),f1=((n,e)=>n?setImmediate:e?((t,r)=>(Zs.addEventListener("message",({source:s,data:i})=>{s===Zs&&i===t&&r.length&&r.shift()()},!1),s=>{r.push(s),Zs.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",fn(Zs.postMessage)),UD=typeof queueMicrotask<"u"?queueMicrotask.bind(Zs):typeof process<"u"&&process.nextTick||f1,$D=n=>n!=null&&fn(n[Bu]),J={isArray:ro,isArrayBuffer:a1,isBuffer:Ga,isFormData:fD,isArrayBufferView:rD,isString:sD,isNumber:l1,isBoolean:iD,isObject:Ha,isPlainObject:Fc,isEmptyObject:oD,isReadableStream:mD,isRequest:pD,isResponse:gD,isHeaders:yD,isUndefined:Qi,isDate:aD,isFile:lD,isBlob:cD,isRegExp:CD,isFunction:fn,isStream:dD,isURLSearchParams:hD,isTypedArray:AD,isFileList:uD,forEach:Ka,merge:am,extend:vD,trim:xD,stripBOM:SD,inherits:ED,toFlatObject:TD,kindOf:Uu,kindOfTest:rr,endsWith:bD,toArray:wD,forEachEntry:LD,matchAll:RD,isHTMLForm:ID,hasOwnProperty:iv,hasOwnProp:iv,reduceDescriptors:d1,freezeMethods:_D,toObjectSet:PD,toCamelCase:kD,noop:DD,toFiniteNumber:ND,findKey:c1,global:Zs,isContextDefined:u1,isSpecCompliantForm:OD,toJSONObject:MD,isAsyncFn:FD,isThenable:BD,setImmediate:f1,asap:UD,isIterable:$D};function Fe(n,e,t,r,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),s&&(this.response=s,this.status=s.status?s.status:null)}J.inherits(Fe,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:J.toJSONObject(this.config),code:this.code,status:this.status}}});const h1=Fe.prototype,m1={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{m1[n]={value:n}});Object.defineProperties(Fe,m1);Object.defineProperty(h1,"isAxiosError",{value:!0});Fe.from=(n,e,t,r,s,i)=>{const o=Object.create(h1);J.toFlatObject(n,o,function(f){return f!==Error.prototype},d=>d!=="isAxiosError");const l=n&&n.message?n.message:"Error",u=e==null&&n?n.code:e;return Fe.call(o,l,u,t,r,s),n&&o.cause==null&&Object.defineProperty(o,"cause",{value:n,configurable:!0}),o.name=n&&n.name||"Error",i&&Object.assign(o,i),o};const jD=null;function lm(n){return J.isPlainObject(n)||J.isArray(n)}function p1(n){return J.endsWith(n,"[]")?n.slice(0,-2):n}function ov(n,e,t){return n?n.concat(e).map(function(s,i){return s=p1(s),!t&&i?"["+s+"]":s}).join(t?".":""):e}function VD(n){return J.isArray(n)&&!n.some(lm)}const GD=J.toFlatObject(J,{},null,function(e){return/^is[A-Z]/.test(e)});function ju(n,e,t){if(!J.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=J.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(E,v){return!J.isUndefined(v[E])});const r=t.metaTokens,s=t.visitor||f,i=t.dots,o=t.indexes,u=(t.Blob||typeof Blob<"u"&&Blob)&&J.isSpecCompliantForm(e);if(!J.isFunction(s))throw new TypeError("visitor must be a function");function d(g){if(g===null)return"";if(J.isDate(g))return g.toISOString();if(J.isBoolean(g))return g.toString();if(!u&&J.isBlob(g))throw new Fe("Blob is not supported. Use a Buffer instead.");return J.isArrayBuffer(g)||J.isTypedArray(g)?u&&typeof Blob=="function"?new Blob([g]):Buffer.from(g):g}function f(g,E,v){let b=g;if(g&&!v&&typeof g=="object"){if(J.endsWith(E,"{}"))E=r?E:E.slice(0,-2),g=JSON.stringify(g);else if(J.isArray(g)&&VD(g)||(J.isFileList(g)||J.endsWith(E,"[]"))&&(b=J.toArray(g)))return E=p1(E),b.forEach(function(L,I){!(J.isUndefined(L)||L===null)&&e.append(o===!0?ov([E],I,i):o===null?E:E+"[]",d(L))}),!1}return lm(g)?!0:(e.append(ov(v,E,i),d(g)),!1)}const h=[],p=Object.assign(GD,{defaultVisitor:f,convertValue:d,isVisitable:lm});function x(g,E){if(!J.isUndefined(g)){if(h.indexOf(g)!==-1)throw Error("Circular reference detected in "+E.join("."));h.push(g),J.forEach(g,function(b,A){(!(J.isUndefined(b)||b===null)&&s.call(e,b,J.isString(A)?A.trim():A,E,p))===!0&&x(b,E?E.concat(A):[A])}),h.pop()}}if(!J.isObject(n))throw new TypeError("data must be an object");return x(n),e}function av(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function wp(n,e){this._pairs=[],n&&ju(n,this,e)}const g1=wp.prototype;g1.append=function(e,t){this._pairs.push([e,t])};g1.toString=function(e){const t=e?function(r){return e.call(this,r,av)}:av;return this._pairs.map(function(s){return t(s[0])+"="+t(s[1])},"").join("&")};function HD(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function y1(n,e,t){if(!e)return n;const r=t&&t.encode||HD;J.isFunction(t)&&(t={serialize:t});const s=t&&t.serialize;let i;if(s?i=s(e,t):i=J.isURLSearchParams(e)?e.toString():new wp(e,t).toString(r),i){const o=n.indexOf("#");o!==-1&&(n=n.slice(0,o)),n+=(n.indexOf("?")===-1?"?":"&")+i}return n}class lv{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){J.forEach(this.handlers,function(r){r!==null&&e(r)})}}const x1={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},KD=typeof URLSearchParams<"u"?URLSearchParams:wp,zD=typeof FormData<"u"?FormData:null,WD=typeof Blob<"u"?Blob:null,YD={isBrowser:!0,classes:{URLSearchParams:KD,FormData:zD,Blob:WD},protocols:["http","https","file","blob","url","data"]},Ap=typeof window<"u"&&typeof document<"u",cm=typeof navigator=="object"&&navigator||void 0,qD=Ap&&(!cm||["ReactNative","NativeScript","NS"].indexOf(cm.product)<0),XD=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",QD=Ap&&window.location.href||"http://localhost",JD=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ap,hasStandardBrowserEnv:qD,hasStandardBrowserWebWorkerEnv:XD,navigator:cm,origin:QD},Symbol.toStringTag,{value:"Module"})),Yt={...JD,...YD};function ZD(n,e){return ju(n,new Yt.classes.URLSearchParams,{visitor:function(t,r,s,i){return Yt.isNode&&J.isBuffer(t)?(this.append(r,t.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)},...e})}function eN(n){return J.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function tN(n){const e={},t=Object.keys(n);let r;const s=t.length;let i;for(r=0;r<s;r++)i=t[r],e[i]=n[i];return e}function v1(n){function e(t,r,s,i){let o=t[i++];if(o==="__proto__")return!0;const l=Number.isFinite(+o),u=i>=t.length;return o=!o&&J.isArray(s)?s.length:o,u?(J.hasOwnProp(s,o)?s[o]=[s[o],r]:s[o]=r,!l):((!s[o]||!J.isObject(s[o]))&&(s[o]=[]),e(t,r,s[o],i)&&J.isArray(s[o])&&(s[o]=tN(s[o])),!l)}if(J.isFormData(n)&&J.isFunction(n.entries)){const t={};return J.forEachEntry(n,(r,s)=>{e(eN(r),s,t,0)}),t}return null}function nN(n,e,t){if(J.isString(n))try{return(e||JSON.parse)(n),J.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(n)}const za={transitional:x1,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",s=r.indexOf("application/json")>-1,i=J.isObject(e);if(i&&J.isHTMLForm(e)&&(e=new FormData(e)),J.isFormData(e))return s?JSON.stringify(v1(e)):e;if(J.isArrayBuffer(e)||J.isBuffer(e)||J.isStream(e)||J.isFile(e)||J.isBlob(e)||J.isReadableStream(e))return e;if(J.isArrayBufferView(e))return e.buffer;if(J.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let l;if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return ZD(e,this.formSerializer).toString();if((l=J.isFileList(e))||r.indexOf("multipart/form-data")>-1){const u=this.env&&this.env.FormData;return ju(l?{"files[]":e}:e,u&&new u,this.formSerializer)}}return i||s?(t.setContentType("application/json",!1),nN(e)):e}],transformResponse:[function(e){const t=this.transitional||za.transitional,r=t&&t.forcedJSONParsing,s=this.responseType==="json";if(J.isResponse(e)||J.isReadableStream(e))return e;if(e&&J.isString(e)&&(r&&!this.responseType||s)){const o=!(t&&t.silentJSONParsing)&&s;try{return JSON.parse(e,this.parseReviver)}catch(l){if(o)throw l.name==="SyntaxError"?Fe.from(l,Fe.ERR_BAD_RESPONSE,this,null,this.response):l}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Yt.classes.FormData,Blob:Yt.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};J.forEach(["delete","get","head","post","put","patch"],n=>{za.headers[n]={}});const rN=J.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),sN=n=>{const e={};let t,r,s;return n&&n.split(`
`).forEach(function(o){s=o.indexOf(":"),t=o.substring(0,s).trim().toLowerCase(),r=o.substring(s+1).trim(),!(!t||e[t]&&rN[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e},cv=Symbol("internals");function ea(n){return n&&String(n).trim().toLowerCase()}function Bc(n){return n===!1||n==null?n:J.isArray(n)?n.map(Bc):String(n)}function iN(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=t.exec(n);)e[r[1]]=r[2];return e}const oN=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function ih(n,e,t,r,s){if(J.isFunction(r))return r.call(this,e,t);if(s&&(e=t),!!J.isString(e)){if(J.isString(r))return e.indexOf(r)!==-1;if(J.isRegExp(r))return r.test(e)}}function aN(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function lN(n,e){const t=J.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(n,r+t,{value:function(s,i,o){return this[r].call(this,e,s,i,o)},configurable:!0})})}let hn=class{constructor(e){e&&this.set(e)}set(e,t,r){const s=this;function i(l,u,d){const f=ea(u);if(!f)throw new Error("header name must be a non-empty string");const h=J.findKey(s,f);(!h||s[h]===void 0||d===!0||d===void 0&&s[h]!==!1)&&(s[h||u]=Bc(l))}const o=(l,u)=>J.forEach(l,(d,f)=>i(d,f,u));if(J.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(J.isString(e)&&(e=e.trim())&&!oN(e))o(sN(e),t);else if(J.isObject(e)&&J.isIterable(e)){let l={},u,d;for(const f of e){if(!J.isArray(f))throw TypeError("Object iterator must return a key-value pair");l[d=f[0]]=(u=l[d])?J.isArray(u)?[...u,f[1]]:[u,f[1]]:f[1]}o(l,t)}else e!=null&&i(t,e,r);return this}get(e,t){if(e=ea(e),e){const r=J.findKey(this,e);if(r){const s=this[r];if(!t)return s;if(t===!0)return iN(s);if(J.isFunction(t))return t.call(this,s,r);if(J.isRegExp(t))return t.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=ea(e),e){const r=J.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||ih(this,this[r],r,t)))}return!1}delete(e,t){const r=this;let s=!1;function i(o){if(o=ea(o),o){const l=J.findKey(r,o);l&&(!t||ih(r,r[l],l,t))&&(delete r[l],s=!0)}}return J.isArray(e)?e.forEach(i):i(e),s}clear(e){const t=Object.keys(this);let r=t.length,s=!1;for(;r--;){const i=t[r];(!e||ih(this,this[i],i,e,!0))&&(delete this[i],s=!0)}return s}normalize(e){const t=this,r={};return J.forEach(this,(s,i)=>{const o=J.findKey(r,i);if(o){t[o]=Bc(s),delete t[i];return}const l=e?aN(i):String(i).trim();l!==i&&delete t[i],t[l]=Bc(s),r[l]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return J.forEach(this,(r,s)=>{r!=null&&r!==!1&&(t[s]=e&&J.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(s=>r.set(s)),r}static accessor(e){const r=(this[cv]=this[cv]={accessors:{}}).accessors,s=this.prototype;function i(o){const l=ea(o);r[l]||(lN(s,o),r[l]=!0)}return J.isArray(e)?e.forEach(i):i(e),this}};hn.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);J.reduceDescriptors(hn.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(r){this[t]=r}}});J.freezeMethods(hn);function oh(n,e){const t=this||za,r=e||t,s=hn.from(r.headers);let i=r.data;return J.forEach(n,function(l){i=l.call(t,i,s.normalize(),e?e.status:void 0)}),s.normalize(),i}function S1(n){return!!(n&&n.__CANCEL__)}function so(n,e,t){Fe.call(this,n??"canceled",Fe.ERR_CANCELED,e,t),this.name="CanceledError"}J.inherits(so,Fe,{__CANCEL__:!0});function E1(n,e,t){const r=t.config.validateStatus;!t.status||!r||r(t.status)?n(t):e(new Fe("Request failed with status code "+t.status,[Fe.ERR_BAD_REQUEST,Fe.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function cN(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function uN(n,e){n=n||10;const t=new Array(n),r=new Array(n);let s=0,i=0,o;return e=e!==void 0?e:1e3,function(u){const d=Date.now(),f=r[i];o||(o=d),t[s]=u,r[s]=d;let h=i,p=0;for(;h!==s;)p+=t[h++],h=h%n;if(s=(s+1)%n,s===i&&(i=(i+1)%n),d-o<e)return;const x=f&&d-f;return x?Math.round(p*1e3/x):void 0}}function dN(n,e){let t=0,r=1e3/e,s,i;const o=(d,f=Date.now())=>{t=f,s=null,i&&(clearTimeout(i),i=null),n(...d)};return[(...d)=>{const f=Date.now(),h=f-t;h>=r?o(d,f):(s=d,i||(i=setTimeout(()=>{i=null,o(s)},r-h)))},()=>s&&o(s)]}const lu=(n,e,t=3)=>{let r=0;const s=uN(50,250);return dN(i=>{const o=i.loaded,l=i.lengthComputable?i.total:void 0,u=o-r,d=s(u),f=o<=l;r=o;const h={loaded:o,total:l,progress:l?o/l:void 0,bytes:u,rate:d||void 0,estimated:d&&l&&f?(l-o)/d:void 0,event:i,lengthComputable:l!=null,[e?"download":"upload"]:!0};n(h)},t)},uv=(n,e)=>{const t=n!=null;return[r=>e[0]({lengthComputable:t,total:n,loaded:r}),e[1]]},dv=n=>(...e)=>J.asap(()=>n(...e)),fN=Yt.hasStandardBrowserEnv?((n,e)=>t=>(t=new URL(t,Yt.origin),n.protocol===t.protocol&&n.host===t.host&&(e||n.port===t.port)))(new URL(Yt.origin),Yt.navigator&&/(msie|trident)/i.test(Yt.navigator.userAgent)):()=>!0,hN=Yt.hasStandardBrowserEnv?{write(n,e,t,r,s,i){const o=[n+"="+encodeURIComponent(e)];J.isNumber(t)&&o.push("expires="+new Date(t).toGMTString()),J.isString(r)&&o.push("path="+r),J.isString(s)&&o.push("domain="+s),i===!0&&o.push("secure"),document.cookie=o.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function mN(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function pN(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function T1(n,e,t){let r=!mN(e);return n&&(r||t==!1)?pN(n,e):e}const fv=n=>n instanceof hn?{...n}:n;function si(n,e){e=e||{};const t={};function r(d,f,h,p){return J.isPlainObject(d)&&J.isPlainObject(f)?J.merge.call({caseless:p},d,f):J.isPlainObject(f)?J.merge({},f):J.isArray(f)?f.slice():f}function s(d,f,h,p){if(J.isUndefined(f)){if(!J.isUndefined(d))return r(void 0,d,h,p)}else return r(d,f,h,p)}function i(d,f){if(!J.isUndefined(f))return r(void 0,f)}function o(d,f){if(J.isUndefined(f)){if(!J.isUndefined(d))return r(void 0,d)}else return r(void 0,f)}function l(d,f,h){if(h in e)return r(d,f);if(h in n)return r(void 0,d)}const u={url:i,method:i,data:i,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:l,headers:(d,f,h)=>s(fv(d),fv(f),h,!0)};return J.forEach(Object.keys({...n,...e}),function(f){const h=u[f]||s,p=h(n[f],e[f],f);J.isUndefined(p)&&h!==l||(t[f]=p)}),t}const b1=n=>{const e=si({},n);let{data:t,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:i,headers:o,auth:l}=e;if(e.headers=o=hn.from(o),e.url=y1(T1(e.baseURL,e.url,e.allowAbsoluteUrls),n.params,n.paramsSerializer),l&&o.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),J.isFormData(t)){if(Yt.hasStandardBrowserEnv||Yt.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(J.isFunction(t.getHeaders)){const u=t.getHeaders(),d=["content-type","content-length"];Object.entries(u).forEach(([f,h])=>{d.includes(f.toLowerCase())&&o.set(f,h)})}}if(Yt.hasStandardBrowserEnv&&(r&&J.isFunction(r)&&(r=r(e)),r||r!==!1&&fN(e.url))){const u=s&&i&&hN.read(i);u&&o.set(s,u)}return e},gN=typeof XMLHttpRequest<"u",yN=gN&&function(n){return new Promise(function(t,r){const s=b1(n);let i=s.data;const o=hn.from(s.headers).normalize();let{responseType:l,onUploadProgress:u,onDownloadProgress:d}=s,f,h,p,x,g;function E(){x&&x(),g&&g(),s.cancelToken&&s.cancelToken.unsubscribe(f),s.signal&&s.signal.removeEventListener("abort",f)}let v=new XMLHttpRequest;v.open(s.method.toUpperCase(),s.url,!0),v.timeout=s.timeout;function b(){if(!v)return;const L=hn.from("getAllResponseHeaders"in v&&v.getAllResponseHeaders()),_={data:!l||l==="text"||l==="json"?v.responseText:v.response,status:v.status,statusText:v.statusText,headers:L,config:n,request:v};E1(function(C){t(C),E()},function(C){r(C),E()},_),v=null}"onloadend"in v?v.onloadend=b:v.onreadystatechange=function(){!v||v.readyState!==4||v.status===0&&!(v.responseURL&&v.responseURL.indexOf("file:")===0)||setTimeout(b)},v.onabort=function(){v&&(r(new Fe("Request aborted",Fe.ECONNABORTED,n,v)),v=null)},v.onerror=function(I){const _=I&&I.message?I.message:"Network Error",F=new Fe(_,Fe.ERR_NETWORK,n,v);F.event=I||null,r(F),v=null},v.ontimeout=function(){let I=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const _=s.transitional||x1;s.timeoutErrorMessage&&(I=s.timeoutErrorMessage),r(new Fe(I,_.clarifyTimeoutError?Fe.ETIMEDOUT:Fe.ECONNABORTED,n,v)),v=null},i===void 0&&o.setContentType(null),"setRequestHeader"in v&&J.forEach(o.toJSON(),function(I,_){v.setRequestHeader(_,I)}),J.isUndefined(s.withCredentials)||(v.withCredentials=!!s.withCredentials),l&&l!=="json"&&(v.responseType=s.responseType),d&&([p,g]=lu(d,!0),v.addEventListener("progress",p)),u&&v.upload&&([h,x]=lu(u),v.upload.addEventListener("progress",h),v.upload.addEventListener("loadend",x)),(s.cancelToken||s.signal)&&(f=L=>{v&&(r(!L||L.type?new so(null,n,v):L),v.abort(),v=null)},s.cancelToken&&s.cancelToken.subscribe(f),s.signal&&(s.signal.aborted?f():s.signal.addEventListener("abort",f)));const A=cN(s.url);if(A&&Yt.protocols.indexOf(A)===-1){r(new Fe("Unsupported protocol "+A+":",Fe.ERR_BAD_REQUEST,n));return}v.send(i||null)})},xN=(n,e)=>{const{length:t}=n=n?n.filter(Boolean):[];if(e||t){let r=new AbortController,s;const i=function(d){if(!s){s=!0,l();const f=d instanceof Error?d:this.reason;r.abort(f instanceof Fe?f:new so(f instanceof Error?f.message:f))}};let o=e&&setTimeout(()=>{o=null,i(new Fe(`timeout ${e} of ms exceeded`,Fe.ETIMEDOUT))},e);const l=()=>{n&&(o&&clearTimeout(o),o=null,n.forEach(d=>{d.unsubscribe?d.unsubscribe(i):d.removeEventListener("abort",i)}),n=null)};n.forEach(d=>d.addEventListener("abort",i));const{signal:u}=r;return u.unsubscribe=()=>J.asap(l),u}},vN=function*(n,e){let t=n.byteLength;if(t<e){yield n;return}let r=0,s;for(;r<t;)s=r+e,yield n.slice(r,s),r=s},SN=async function*(n,e){for await(const t of EN(n))yield*vN(t,e)},EN=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:t,value:r}=await e.read();if(t)break;yield r}}finally{await e.cancel()}},hv=(n,e,t,r)=>{const s=SN(n,e);let i=0,o,l=u=>{o||(o=!0,r&&r(u))};return new ReadableStream({async pull(u){try{const{done:d,value:f}=await s.next();if(d){l(),u.close();return}let h=f.byteLength;if(t){let p=i+=h;t(p)}u.enqueue(new Uint8Array(f))}catch(d){throw l(d),d}},cancel(u){return l(u),s.return()}},{highWaterMark:2})},mv=64*1024,{isFunction:fc}=J,TN=(({Request:n,Response:e})=>({Request:n,Response:e}))(J.global),{ReadableStream:pv,TextEncoder:gv}=J.global,yv=(n,...e)=>{try{return!!n(...e)}catch{return!1}},bN=n=>{n=J.merge.call({skipUndefined:!0},TN,n);const{fetch:e,Request:t,Response:r}=n,s=e?fc(e):typeof fetch=="function",i=fc(t),o=fc(r);if(!s)return!1;const l=s&&fc(pv),u=s&&(typeof gv=="function"?(g=>E=>g.encode(E))(new gv):async g=>new Uint8Array(await new t(g).arrayBuffer())),d=i&&l&&yv(()=>{let g=!1;const E=new t(Yt.origin,{body:new pv,method:"POST",get duplex(){return g=!0,"half"}}).headers.has("Content-Type");return g&&!E}),f=o&&l&&yv(()=>J.isReadableStream(new r("").body)),h={stream:f&&(g=>g.body)};s&&["text","arrayBuffer","blob","formData","stream"].forEach(g=>{!h[g]&&(h[g]=(E,v)=>{let b=E&&E[g];if(b)return b.call(E);throw new Fe(`Response type '${g}' is not supported`,Fe.ERR_NOT_SUPPORT,v)})});const p=async g=>{if(g==null)return 0;if(J.isBlob(g))return g.size;if(J.isSpecCompliantForm(g))return(await new t(Yt.origin,{method:"POST",body:g}).arrayBuffer()).byteLength;if(J.isArrayBufferView(g)||J.isArrayBuffer(g))return g.byteLength;if(J.isURLSearchParams(g)&&(g=g+""),J.isString(g))return(await u(g)).byteLength},x=async(g,E)=>{const v=J.toFiniteNumber(g.getContentLength());return v??p(E)};return async g=>{let{url:E,method:v,data:b,signal:A,cancelToken:L,timeout:I,onDownloadProgress:_,onUploadProgress:F,responseType:C,headers:P,withCredentials:O="same-origin",fetchOptions:M}=b1(g),H=e||fetch;C=C?(C+"").toLowerCase():"text";let Z=xN([A,L&&L.toAbortSignal()],I),se=null;const U=Z&&Z.unsubscribe&&(()=>{Z.unsubscribe()});let ne;try{if(F&&d&&v!=="get"&&v!=="head"&&(ne=await x(P,b))!==0){let D=new t(E,{method:"POST",body:b,duplex:"half"}),$;if(J.isFormData(b)&&($=D.headers.get("content-type"))&&P.setContentType($),D.body){const[ie,ce]=uv(ne,lu(dv(F)));b=hv(D.body,mv,ie,ce)}}J.isString(O)||(O=O?"include":"omit");const q=i&&"credentials"in t.prototype,te={...M,signal:Z,method:v.toUpperCase(),headers:P.normalize().toJSON(),body:b,duplex:"half",credentials:q?O:void 0};se=i&&new t(E,te);let G=await(i?H(se,M):H(E,te));const Q=f&&(C==="stream"||C==="response");if(f&&(_||Q&&U)){const D={};["status","statusText","headers"].forEach(ue=>{D[ue]=G[ue]});const $=J.toFiniteNumber(G.headers.get("content-length")),[ie,ce]=_&&uv($,lu(dv(_),!0))||[];G=new r(hv(G.body,mv,ie,()=>{ce&&ce(),U&&U()}),D)}C=C||"text";let ee=await h[J.findKey(h,C)||"text"](G,g);return!Q&&U&&U(),await new Promise((D,$)=>{E1(D,$,{data:ee,headers:hn.from(G.headers),status:G.status,statusText:G.statusText,config:g,request:se})})}catch(q){throw U&&U(),q&&q.name==="TypeError"&&/Load failed|fetch/i.test(q.message)?Object.assign(new Fe("Network Error",Fe.ERR_NETWORK,g,se),{cause:q.cause||q}):Fe.from(q,q&&q.code,g,se)}}},wN=new Map,w1=n=>{let e=n?n.env:{};const{fetch:t,Request:r,Response:s}=e,i=[r,s,t];let o=i.length,l=o,u,d,f=wN;for(;l--;)u=i[l],d=f.get(u),d===void 0&&f.set(u,d=l?new Map:bN(e)),f=d;return d};w1();const um={http:jD,xhr:yN,fetch:{get:w1}};J.forEach(um,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const xv=n=>`- ${n}`,AN=n=>J.isFunction(n)||n===null||n===!1,A1={getAdapter:(n,e)=>{n=J.isArray(n)?n:[n];const{length:t}=n;let r,s;const i={};for(let o=0;o<t;o++){r=n[o];let l;if(s=r,!AN(r)&&(s=um[(l=String(r)).toLowerCase()],s===void 0))throw new Fe(`Unknown adapter '${l}'`);if(s&&(J.isFunction(s)||(s=s.get(e))))break;i[l||"#"+o]=s}if(!s){const o=Object.entries(i).map(([u,d])=>`adapter ${u} `+(d===!1?"is not supported by the environment":"is not available in the build"));let l=t?o.length>1?`since :
`+o.map(xv).join(`
`):" "+xv(o[0]):"as no adapter specified";throw new Fe("There is no suitable adapter to dispatch the request "+l,"ERR_NOT_SUPPORT")}return s},adapters:um};function ah(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new so(null,n)}function vv(n){return ah(n),n.headers=hn.from(n.headers),n.data=oh.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),A1.getAdapter(n.adapter||za.adapter,n)(n).then(function(r){return ah(n),r.data=oh.call(n,n.transformResponse,r),r.headers=hn.from(r.headers),r},function(r){return S1(r)||(ah(n),r&&r.response&&(r.response.data=oh.call(n,n.transformResponse,r.response),r.response.headers=hn.from(r.response.headers))),Promise.reject(r)})}const L1="1.12.2",Vu={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{Vu[n]=function(r){return typeof r===n||"a"+(e<1?"n ":" ")+n}});const Sv={};Vu.transitional=function(e,t,r){function s(i,o){return"[Axios v"+L1+"] Transitional option '"+i+"'"+o+(r?". "+r:"")}return(i,o,l)=>{if(e===!1)throw new Fe(s(o," has been removed"+(t?" in "+t:"")),Fe.ERR_DEPRECATED);return t&&!Sv[o]&&(Sv[o]=!0,console.warn(s(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(i,o,l):!0}};Vu.spelling=function(e){return(t,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};function LN(n,e,t){if(typeof n!="object")throw new Fe("options must be an object",Fe.ERR_BAD_OPTION_VALUE);const r=Object.keys(n);let s=r.length;for(;s-- >0;){const i=r[s],o=e[i];if(o){const l=n[i],u=l===void 0||o(l,i,n);if(u!==!0)throw new Fe("option "+i+" must be "+u,Fe.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Fe("Unknown option "+i,Fe.ERR_BAD_OPTION)}}const Uc={assertOptions:LN,validators:Vu},ur=Uc.validators;let ni=class{constructor(e){this.defaults=e||{},this.interceptors={request:new lv,response:new lv}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const i=s.stack?s.stack.replace(/^.+\n/,""):"";try{r.stack?i&&!String(r.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+i):r.stack=i}catch{}}throw r}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=si(this.defaults,t);const{transitional:r,paramsSerializer:s,headers:i}=t;r!==void 0&&Uc.assertOptions(r,{silentJSONParsing:ur.transitional(ur.boolean),forcedJSONParsing:ur.transitional(ur.boolean),clarifyTimeoutError:ur.transitional(ur.boolean)},!1),s!=null&&(J.isFunction(s)?t.paramsSerializer={serialize:s}:Uc.assertOptions(s,{encode:ur.function,serialize:ur.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),Uc.assertOptions(t,{baseUrl:ur.spelling("baseURL"),withXsrfToken:ur.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=i&&J.merge(i.common,i[t.method]);i&&J.forEach(["delete","get","head","post","put","patch","common"],g=>{delete i[g]}),t.headers=hn.concat(o,i);const l=[];let u=!0;this.interceptors.request.forEach(function(E){typeof E.runWhen=="function"&&E.runWhen(t)===!1||(u=u&&E.synchronous,l.unshift(E.fulfilled,E.rejected))});const d=[];this.interceptors.response.forEach(function(E){d.push(E.fulfilled,E.rejected)});let f,h=0,p;if(!u){const g=[vv.bind(this),void 0];for(g.unshift(...l),g.push(...d),p=g.length,f=Promise.resolve(t);h<p;)f=f.then(g[h++],g[h++]);return f}p=l.length;let x=t;for(;h<p;){const g=l[h++],E=l[h++];try{x=g(x)}catch(v){E.call(this,v);break}}try{f=vv.call(this,x)}catch(g){return Promise.reject(g)}for(h=0,p=d.length;h<p;)f=f.then(d[h++],d[h++]);return f}getUri(e){e=si(this.defaults,e);const t=T1(e.baseURL,e.url,e.allowAbsoluteUrls);return y1(t,e.params,e.paramsSerializer)}};J.forEach(["delete","get","head","options"],function(e){ni.prototype[e]=function(t,r){return this.request(si(r||{},{method:e,url:t,data:(r||{}).data}))}});J.forEach(["post","put","patch"],function(e){function t(r){return function(i,o,l){return this.request(si(l||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:i,data:o}))}}ni.prototype[e]=t(),ni.prototype[e+"Form"]=t(!0)});let RN=class R1{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(i){t=i});const r=this;this.promise.then(s=>{if(!r._listeners)return;let i=r._listeners.length;for(;i-- >0;)r._listeners[i](s);r._listeners=null}),this.promise.then=s=>{let i;const o=new Promise(l=>{r.subscribe(l),i=l}).then(s);return o.cancel=function(){r.unsubscribe(i)},o},e(function(i,o,l){r.reason||(r.reason=new so(i,o,l),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=r=>{e.abort(r)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new R1(function(s){e=s}),cancel:e}}};function IN(n){return function(t){return n.apply(null,t)}}function kN(n){return J.isObject(n)&&n.isAxiosError===!0}const dm={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(dm).forEach(([n,e])=>{dm[e]=n});function I1(n){const e=new ni(n),t=i1(ni.prototype.request,e);return J.extend(t,ni.prototype,e,{allOwnKeys:!0}),J.extend(t,e,null,{allOwnKeys:!0}),t.create=function(s){return I1(si(n,s))},t}const We=I1(za);We.Axios=ni;We.CanceledError=so;We.CancelToken=RN;We.isCancel=S1;We.VERSION=L1;We.toFormData=ju;We.AxiosError=Fe;We.Cancel=We.CanceledError;We.all=function(e){return Promise.all(e)};We.spread=IN;We.isAxiosError=kN;We.mergeConfig=si;We.AxiosHeaders=hn;We.formToJSON=n=>v1(J.isHTMLForm(n)?new FormData(n):n);We.getAdapter=A1.getAdapter;We.HttpStatusCode=dm;We.default=We;const{Axios:Tj,AxiosError:bj,CanceledError:wj,isCancel:Aj,CancelToken:Lj,VERSION:Rj,all:Ij,Cancel:kj,isAxiosError:Cj,spread:_j,toFormData:Pj,AxiosHeaders:Dj,HttpStatusCode:Nj,formToJSON:Oj,getAdapter:Mj,mergeConfig:Fj}=We,et={TMDB_API_KEY:"3ccf3bbfa9b25213ac74c50f96d238d0",TMDB_READ_TOKEN:"eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIzY2NmM2JiZmE5YjI1MjEzYWM3NGM1MGY5NmQyMzhkMCIsIm5iZiI6MTczMjk3NDAwMy4wNjIsInN1YiI6IjY3NGIxNWIzMDExNzg1MWNkMDFjMjQ4OCIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ._aQY-s2iBoSka9Sc7Iry4EpXgPjBWm__HSIvnrxNtZ4",TMDB_BASE_URL:"https://api.themoviedb.org/3",TMDB_IMAGE_BASE_URL:"https://image.tmdb.org/t/p"},er=nt.div,Ev=nt.button,$c={name:"Orko Biswas",email:"orkobiswas.mail@gmail.com",avatarInitial:"O",plan:"Developer"},k1=[{id:1,title:"New Episode Available",message:"Succession S4E10 is now streaming",time:"2m ago",type:"new",read:!1},{id:2,title:"Download Complete",message:"Oppenheimer (2023) is ready to watch",time:"1h ago",type:"download",read:!1},{id:3,title:"Watchlist Update",message:"Dune: Part Two is now available",time:"3h ago",type:"update",read:!0},{id:4,title:"Top Pick For You",message:"Based on your interest in Sci-Fi",time:"1d ago",type:"recommend",read:!0}],fm=["Inception","The Bear","Stranger Things"],CN=()=>{const[n,e]=N.useState(0);return N.useEffect(()=>{const t=()=>e(window.pageYOffset);return window.addEventListener("scroll",t),t(),()=>window.removeEventListener("scroll",t)},[]),n},C1=(n,e)=>{const[t,r]=N.useState(n);return N.useEffect(()=>{const s=setTimeout(()=>r(n),e);return()=>clearTimeout(s)},[n,e]),t},_N=()=>{const n=qt(),e=jn(),t=()=>{e.pathname==="/"?window.location.reload():(n("/"),window.scrollTo({top:0,behavior:"smooth"}))};return S.jsx("div",{onClick:t,className:"flex items-center cursor-pointer select-none touch-target",children:S.jsx("div",{className:"relative",children:S.jsx("span",{className:"text-[18px] sm:text-[24px] md:text-[28px] font-black tracking-[-0.05em] leading-none",style:{fontFamily:"system-ui, -apple-system, sans-serif",fontStretch:"condensed",letterSpacing:"-0.02em"},children:S.jsx("span",{className:"text-[#E50914]",children:"SanviTV"})})})})},PN=()=>{const n=qt(),e=jn(),t=[{label:"Home",path:"/"},{label:"Movies",path:"/movies"},{label:"Series",path:"/series"},{label:"New & Popular",path:"/new-popular"},{label:"Live TV",path:"/live-tv",live:!0}];return S.jsx("nav",{className:"hidden md:flex items-center gap-1 lg:gap-2",children:t.map(r=>{const s=e.pathname===r.path;return S.jsxs("button",{onClick:()=>n(r.path),className:`relative px-2 lg:px-4 py-2 text-xs lg:text-sm font-medium rounded-lg transition-colors duration-300 ${s?"text-white":"text-neutral-400 hover:text-white"}`,children:[S.jsxs("span",{className:"flex items-center gap-1.5",children:[r.label,r.live&&S.jsxs("span",{className:"relative flex h-2 w-2",children:[S.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-500 opacity-75"}),S.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-red-600"})]})]}),s&&S.jsx(er,{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-red-600",layoutId:"underline",transition:{type:"spring",stiffness:300,damping:30}})]},r.label)})})},DN=()=>{const n=qt(),[e,t]=N.useState(""),[r,s]=N.useState(!1),[i,o]=N.useState([]),[l,u]=N.useState(!1),[d,f]=N.useState(()=>{const E=localStorage.getItem("searchHistory");return E?JSON.parse(E):fm}),h=C1(e,500);N.useEffect(()=>{if(!h||h.trim().length<2){o([]),u(!1);return}(async()=>{u(!0);try{const b=(await We.get(`${et.TMDB_BASE_URL}/search/multi?api_key=${et.TMDB_API_KEY}&query=${encodeURIComponent(h)}&page=1`)).data.results.filter(A=>A.media_type==="movie"||A.media_type==="tv").slice(0,6);o(b)}catch(v){console.error("Search error:",v),o([])}finally{u(!1)}})()},[h]);const p=E=>{const v=E.title||E.name||"",b=[v,...d.filter(A=>A!==v)].slice(0,5);f(b),localStorage.setItem("searchHistory",JSON.stringify(b)),n(`/${E.media_type}/${E.id}`),t(""),s(!1)},x=E=>{t(E)},g=()=>{f([]),localStorage.removeItem("searchHistory")};return S.jsxs("div",{className:"relative hidden md:block",children:[S.jsxs(er,{className:"relative flex items-center",animate:{width:r?260:180},transition:{type:"spring",stiffness:400,damping:30},children:[S.jsx(au,{className:"absolute left-3 text-neutral-500 pointer-events-none",size:16}),S.jsx("input",{type:"text",placeholder:"Search...",value:e,onChange:E=>t(E.target.value),onFocus:()=>s(!0),onBlur:()=>setTimeout(()=>s(!1),200),className:"w-full h-9 pl-10 pr-3 bg-neutral-800/50 text-white text-sm placeholder-neutral-500 border border-transparent rounded-full transition-colors duration-300 focus:outline-none focus:border-neutral-600 focus:bg-neutral-800"})]}),S.jsx(Sa,{children:r&&(e.length>0||fm.length>0)&&S.jsx(er,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"absolute top-full left-0 mt-2 w-full max-w-[350px] bg-neutral-900/80 backdrop-blur-xl border border-neutral-700 rounded-xl shadow-2xl overflow-hidden",children:l?S.jsx("div",{className:"flex items-center justify-center p-6",children:S.jsx("div",{className:"w-6 h-6 border-2 border-red-600 border-t-transparent rounded-full animate-spin"})}):i.length>0?i.map(E=>S.jsxs("div",{onClick:()=>p(E),className:"flex items-center gap-3 p-3 hover:bg-neutral-800 cursor-pointer transition-colors",children:[E.poster_path?S.jsx("img",{src:`https://image.tmdb.org/t/p/w92${E.poster_path}`,alt:E.title||E.name,className:"w-10 h-14 object-cover rounded"}):S.jsx("div",{className:"w-10 h-14 bg-neutral-700 rounded flex items-center justify-center",children:E.media_type==="tv"?S.jsx(Fu,{className:"text-neutral-500"}):S.jsx(Va,{className:"text-neutral-500"})}),S.jsxs("div",{className:"flex-1",children:[S.jsx("p",{className:"font-semibold text-white text-sm line-clamp-1",children:E.title||E.name}),S.jsxs("p",{className:"text-xs text-neutral-400",children:[E.media_type==="tv"?"TV Series":"Movie",E.release_date&&`  ${E.release_date.split("-")[0]}`]})]})]},E.id)):e.length>1?S.jsxs("p",{className:"text-center text-sm text-neutral-400 p-4",children:['No results for "',e,'"']}):S.jsxs("div",{className:"p-2",children:[S.jsxs("div",{className:"flex items-center justify-between px-3 py-2",children:[S.jsx("h4",{className:"text-xs font-semibold text-neutral-500 uppercase",children:"Recent Searches"}),d.length>0&&S.jsx("button",{onClick:g,className:"text-xs text-neutral-500 hover:text-red-500 transition-colors",children:"Clear"})]}),d.length>0?d.map((E,v)=>S.jsxs("div",{onClick:()=>x(E),className:"flex items-center gap-3 p-3 hover:bg-neutral-800 rounded-md cursor-pointer text-sm text-neutral-200",children:[S.jsx(Ep,{className:"text-neutral-500"}),S.jsx("span",{children:E})]},v)):S.jsx("p",{className:"text-center text-xs text-neutral-500 p-4",children:"No recent searches"})]})})})]})},_1=({children:n,onClose:e})=>{const t=N.useRef(null);return N.useEffect(()=>{const r=s=>{t.current&&!t.current.contains(s.target)&&e()};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[e]),S.jsx(er,{ref:t,initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{type:"spring",damping:25,stiffness:400},className:"absolute top-full right-0 mt-3 w-[calc(100vw-2rem)] max-w-[360px] sm:max-w-[400px] rounded-2xl overflow-hidden shadow-2xl z-[110]",style:{background:"rgba(10, 10, 10, 0.75)",backdropFilter:"blur(40px) saturate(180%)",WebkitBackdropFilter:"blur(40px) saturate(180%)",border:"1px solid rgba(255, 255, 255, 0.1)",boxShadow:"0 25px 70px rgba(0, 0, 0, 0.7), 0 10px 30px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.1)"},children:n})},NN=({onClose:n})=>{const[e,t]=N.useState(k1),r=i=>{t(o=>o.map(l=>l.id===i?{...l,read:!0}:l))},s=e.filter(i=>!i.read).length;return S.jsxs(_1,{onClose:n,children:[S.jsx("div",{className:"p-4 flex items-center justify-between border-b border-neutral-800/30",children:S.jsxs("div",{className:"flex items-center gap-2",children:[S.jsx("h3",{className:"font-semibold text-white text-base",children:"Notifications"}),s>0&&S.jsx("span",{className:"px-2 py-0.5 bg-red-600 rounded-full text-[10px] font-bold text-white",children:s})]})}),S.jsx("div",{className:"max-h-[400px] overflow-y-auto scrollbar-thin scrollbar-thumb-red-900/30 scrollbar-track-transparent p-2",children:e.length>0?e.map((i,o)=>S.jsx(er,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:o*.05,type:"spring",stiffness:300,damping:20},className:"group relative mb-2 last:mb-0",children:S.jsxs(nt.div,{className:"p-3 rounded-lg cursor-pointer overflow-hidden relative",onClick:()=>r(i.id),whileHover:{scale:1.02},whileTap:{scale:.98},style:{background:"rgba(255, 255, 255, 0.03)",border:i.read?"1px solid rgba(255, 255, 255, 0.06)":"1px solid rgba(239, 68, 68, 0.3)"},children:[!i.read&&S.jsx(nt.div,{className:"absolute left-0 top-0 bottom-0 w-1 bg-gradient-to-b from-red-500 to-red-600",initial:{scaleY:0},animate:{scaleY:1},transition:{delay:o*.05+.2}}),S.jsx("div",{className:"flex items-start gap-3 relative z-10",children:S.jsxs("div",{className:"flex-1 min-w-0",children:[S.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[S.jsx("h4",{className:"font-medium text-white text-sm line-clamp-1 flex-1",children:i.title}),!i.read&&S.jsx("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full shadow-[0_0_8px_rgba(239,68,68,0.8)]"})]}),S.jsx("p",{className:"text-neutral-400 text-xs mb-1.5 line-clamp-1",children:i.message}),S.jsx("span",{className:"text-[10px] text-neutral-600",children:i.time})]})})]})},i.id)):S.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[S.jsx("div",{className:"w-14 h-14 rounded-full bg-neutral-900/50 flex items-center justify-center mb-3",children:S.jsx(XT,{className:"text-neutral-600",size:24})}),S.jsx("p",{className:"text-neutral-500 text-sm",children:"No notifications"})]})})]})},ON=({onClose:n,user:e})=>{const t=qt(),r=[{icon:s1,label:"My Profile",path:"/profile"},{icon:JT,label:"Watchlist",path:"/watchlist"},{icon:QT,label:"Downloads",path:"/downloads"},{icon:r1,label:"Settings",path:"/settings"}],s=o=>{t(o),n()},i=()=>{console.log("Signing out..."),n()};return S.jsxs(_1,{onClose:n,children:[S.jsxs("div",{className:"p-5 border-b border-neutral-800/30",children:[S.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[S.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden ring-2 ring-red-500/30 shadow-lg",children:S.jsx("img",{src:"/orko.jpeg",alt:e.name,className:"w-full h-full object-cover"})}),S.jsxs("div",{className:"flex-1 min-w-0",children:[S.jsx("h3",{className:"font-semibold text-white text-base line-clamp-1",children:e.name}),S.jsx("p",{className:"text-neutral-500 text-xs line-clamp-1",children:e.email})]})]}),S.jsxs(nt.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.1},className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full",style:{background:"linear-gradient(135deg, rgba(234, 179, 8, 0.15), rgba(202, 138, 4, 0.1))",border:"1px solid rgba(234, 179, 8, 0.3)",boxShadow:"0 0 20px rgba(234, 179, 8, 0.2)"},children:[S.jsx(HP,{className:"text-yellow-500",size:14}),S.jsx("span",{className:"text-yellow-500 text-xs font-bold uppercase tracking-wide",children:"Owner Rank"})]})]}),S.jsx("div",{className:"p-3 space-y-1",children:r.map((o,l)=>S.jsxs(Ev,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:l*.05,type:"spring",stiffness:300,damping:20},whileHover:{x:4},whileTap:{scale:.98},onClick:()=>s(o.path),className:"w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-left group transition-all",style:{background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 255, 255, 0.06)"},children:[S.jsx("div",{className:"w-8 h-8 rounded-lg bg-red-600/10 flex items-center justify-center group-hover:bg-red-600/20 transition-colors",children:S.jsx(o.icon,{className:"text-red-400 group-hover:text-red-300 transition-colors",size:16})}),S.jsx("span",{className:"text-neutral-300 text-sm font-medium group-hover:text-white transition-colors flex-1",children:o.label}),S.jsx(nt.div,{initial:{opacity:0,x:-5},whileHover:{opacity:1,x:0},className:"text-neutral-600",children:S.jsx(nr,{size:12,className:"rotate-180"})})]},o.label))}),S.jsx("div",{className:"p-3 border-t border-white/5",children:S.jsxs(Ev,{whileHover:{x:4},whileTap:{scale:.98},onClick:i,className:"w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-left group transition-all",style:{background:"rgba(239, 68, 68, 0.08)",border:"1px solid rgba(239, 68, 68, 0.2)"},children:[S.jsx("div",{className:"w-8 h-8 rounded-lg bg-red-600/20 flex items-center justify-center group-hover:bg-red-600/30 transition-colors",children:S.jsx(e1,{className:"text-red-400 group-hover:text-red-300 transition-colors",size:16})}),S.jsx("span",{className:"text-red-400 text-sm font-medium group-hover:text-red-300 transition-colors flex-1",children:"Sign Out"})]})})]})},MN=({isOpen:n,onClose:e})=>{const t=qt(),r=jn(),s=[{icon:ZT,label:"Home",path:"/"},{icon:Va,label:"Movies",path:"/movies"},{icon:Fu,label:"Series",path:"/series"},{icon:Tp,label:"New & Popular",path:"/new-popular"},{icon:ou,label:"Live TV",path:"/live-tv",live:!0},{icon:JT,label:"My Watchlist",path:"/watchlist"},{icon:QT,label:"Downloads",path:"/downloads"},{icon:r1,label:"Settings",path:"/settings"}],i=o=>{t(o),e()};return S.jsx(Sa,{children:n&&S.jsxs(S.Fragment,{children:[S.jsx(er,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:e,className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 md:hidden"}),S.jsxs(er,{initial:{x:"-100%"},animate:{x:0},exit:{x:"-100%"},transition:{type:"spring",damping:25,stiffness:200},className:"fixed left-0 top-0 bottom-0 w-[85vw] max-w-[320px] bg-neutral-900 z-50 md:hidden overflow-y-auto hide-scrollbar-mobile",children:[S.jsxs("div",{className:"p-4 border-b border-neutral-800 flex items-center justify-between sticky top-0 bg-neutral-900 z-10",children:[S.jsxs("div",{className:"flex items-center gap-3",children:[S.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden ring-2 ring-red-500/30",children:S.jsx("img",{src:"/orko.jpeg",alt:$c.name,className:"w-full h-full object-cover"})}),S.jsxs("div",{children:[S.jsx("h3",{className:"font-bold text-white text-sm line-clamp-1",children:$c.name}),S.jsx("p",{className:"text-neutral-400 text-xs",children:$c.plan})]})]}),S.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-neutral-800 transition-colors touch-target",children:S.jsx(An,{className:"text-white",size:22})})]}),S.jsx("div",{className:"p-2 mt-2",children:s.map((o,l)=>{const u=r.pathname===o.path;return S.jsx(er,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:l*.05},children:S.jsxs("button",{onClick:()=>i(o.path),className:`w-full flex items-center gap-4 p-4 rounded-lg transition-colors touch-target ${u?"bg-red-600 text-white":"text-neutral-300 hover:bg-neutral-800"}`,children:[S.jsx(o.icon,{size:22}),S.jsx("span",{className:"font-medium text-base flex-1 text-left",children:o.label}),o.live&&S.jsxs("span",{className:"relative flex h-2.5 w-2.5",children:[S.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-500 opacity-75"}),S.jsx("span",{className:"relative inline-flex rounded-full h-2.5 w-2.5 bg-red-600"})]})]})},o.path)})}),S.jsx("div",{className:"p-4 mt-auto border-t border-neutral-800",children:S.jsxs("button",{className:"w-full flex items-center gap-4 p-4 rounded-lg text-red-500 hover:bg-neutral-800 transition-colors touch-target",children:[S.jsx(e1,{size:22}),S.jsx("span",{className:"font-medium text-base",children:"Sign Out"})]})})]})]})})},FN=({isOpen:n,onClose:e})=>{const t=qt(),[r,s]=N.useState(""),[i,o]=N.useState([]),[l,u]=N.useState(!1),[d,f]=N.useState(()=>{const v=localStorage.getItem("searchHistory");return v?JSON.parse(v):fm}),h=C1(r,500),p=N.useRef(null);N.useEffect(()=>{n&&p.current&&setTimeout(()=>p.current?.focus(),100)},[n]),N.useEffect(()=>{if(!h||h.trim().length<2){o([]),u(!1);return}(async()=>{u(!0);try{const A=(await We.get(`${et.TMDB_BASE_URL}/search/multi?api_key=${et.TMDB_API_KEY}&query=${encodeURIComponent(h)}&page=1`)).data.results.filter(L=>L.media_type==="movie"||L.media_type==="tv").slice(0,10);o(A)}catch(b){console.error("Search error:",b),o([])}finally{u(!1)}})()},[h]);const x=v=>{const b=v.title||v.name||"",A=[b,...d.filter(L=>L!==b)].slice(0,5);f(A),localStorage.setItem("searchHistory",JSON.stringify(A)),t(`/${v.media_type}/${v.id}`),s(""),e()},g=v=>{s(v)},E=()=>{f([]),localStorage.removeItem("searchHistory")};return S.jsx(Sa,{children:n&&S.jsxs(er,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-neutral-900 z-50 md:hidden flex flex-col",children:[S.jsxs("div",{className:"flex items-center gap-3 p-4 border-b border-neutral-800",children:[S.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-neutral-800 transition-colors touch-target",children:S.jsx(An,{className:"text-white",size:22})}),S.jsxs("div",{className:"flex-1 relative",children:[S.jsx(au,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-neutral-500",size:18}),S.jsx("input",{ref:p,type:"text",placeholder:"Search movies & series...",value:r,onChange:v=>s(v.target.value),className:"w-full h-12 pl-12 pr-4 bg-neutral-800 text-white text-base placeholder-neutral-500 rounded-full focus:outline-none focus:ring-2 focus:ring-red-600 touch-target"})]})]}),S.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar-mobile",children:l?S.jsx("div",{className:"flex items-center justify-center p-12",children:S.jsx("div",{className:"w-8 h-8 border-2 border-red-600 border-t-transparent rounded-full animate-spin"})}):i.length>0?S.jsx("div",{className:"p-2",children:i.map(v=>S.jsxs("div",{onClick:()=>x(v),className:"flex items-center gap-4 p-4 hover:bg-neutral-800 rounded-lg cursor-pointer transition-colors touch-target",children:[v.poster_path?S.jsx("img",{src:`https://image.tmdb.org/t/p/w92${v.poster_path}`,alt:v.title||v.name,className:"w-12 h-16 object-cover rounded"}):S.jsx("div",{className:"w-12 h-16 bg-neutral-700 rounded flex items-center justify-center",children:v.media_type==="tv"?S.jsx(Fu,{className:"text-neutral-500",size:20}):S.jsx(Va,{className:"text-neutral-500",size:20})}),S.jsxs("div",{className:"flex-1",children:[S.jsx("p",{className:"font-semibold text-white text-base line-clamp-1",children:v.title||v.name}),S.jsxs("p",{className:"text-sm text-neutral-400",children:[v.media_type==="tv"?"TV Series":"Movie",v.release_date&&`  ${v.release_date.split("-")[0]}`]})]})]},v.id))}):r.length>1?S.jsxs("div",{className:"text-center p-12",children:[S.jsx(au,{className:"mx-auto text-neutral-600 mb-3",size:40}),S.jsxs("p",{className:"text-neutral-400",children:['No results for "',r,'"']})]}):S.jsxs("div",{className:"p-4",children:[S.jsxs("div",{className:"flex items-center justify-between mb-4",children:[S.jsx("h4",{className:"text-sm font-semibold text-neutral-400 uppercase",children:"Recent Searches"}),d.length>0&&S.jsx("button",{onClick:E,className:"text-sm text-neutral-500 hover:text-red-500 transition-colors touch-target",children:"Clear"})]}),d.length>0?S.jsx("div",{className:"space-y-2",children:d.map((v,b)=>S.jsxs("div",{onClick:()=>g(v),className:"flex items-center gap-4 p-4 hover:bg-neutral-800 rounded-lg cursor-pointer text-base text-neutral-200 touch-target",children:[S.jsx(Ep,{className:"text-neutral-500",size:20}),S.jsx("span",{children:v})]},b))}):S.jsx("p",{className:"text-center text-neutral-500 p-8",children:"No recent searches"})]})})]})})};function BN(){const n=CN(),[e,t]=N.useState(null),[r,s]=N.useState(!1),[i,o]=N.useState(!1),l=n>10,u=N.useCallback(()=>{t(null),s(!1),o(!1)},[]),d=k1.filter(f=>!f.read).length;return S.jsxs(S.Fragment,{children:[S.jsx(MN,{isOpen:r,onClose:()=>s(!1)}),S.jsx(FN,{isOpen:i,onClose:()=>o(!1)}),S.jsx(er,{className:"fixed top-0 left-0 right-0 z-[100] transition-all duration-300 rounded-b-[32px] overflow-visible",animate:{background:l?"rgba(0, 0, 0, 0.7)":"rgba(0, 0, 0, 0.3)",backdropFilter:"blur(40px) saturate(180%)",WebkitBackdropFilter:"blur(40px) saturate(180%)"},style:{boxShadow:l?"0 8px 32px rgba(0, 0, 0, 0.3)":"none",border:l?"2px solid rgba(255, 255, 255, 0.12)":"2px solid rgba(255, 255, 255, 0.08)",borderTop:"none"},children:S.jsxs("div",{className:"flex items-center justify-between px-4 sm:px-4 md:px-6 h-16 sm:h-18 md:h-20 max-w-7xl mx-auto",children:[S.jsxs("div",{className:"flex items-center gap-3 sm:gap-8",children:[S.jsx("button",{onClick:()=>s(!0),className:"hidden md:hidden p-3 rounded-full text-neutral-300 hover:text-white hover:bg-neutral-700/50 transition-colors touch-target active:scale-95",children:S.jsx(XP,{size:24})}),S.jsx(_N,{}),S.jsx(PN,{})]}),S.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 md:gap-4",children:[S.jsx(DN,{}),S.jsx("button",{onClick:()=>o(!0),className:"md:hidden p-3 rounded-full text-neutral-300 hover:text-white hover:bg-neutral-700/50 transition-colors touch-target active:scale-95",children:S.jsx(au,{size:22})}),S.jsxs("div",{className:"relative",children:[S.jsxs(nt.button,{onClick:()=>t(f=>f==="notifications"?null:"notifications"),className:"relative p-2.5 sm:p-2.5 rounded-full text-neutral-300 transition-all touch-target active:scale-90",animate:{backgroundColor:e==="notifications"?"rgba(239, 68, 68, 0.2)":"rgba(255, 255, 255, 0)",color:e==="notifications"?"#ef4444":"#d4d4d8",scale:e==="notifications"?.95:1},whileHover:{scale:1.05,backgroundColor:e==="notifications"?"rgba(239, 68, 68, 0.25)":"rgba(115, 115, 115, 0.3)"},whileTap:{scale:.9},transition:{duration:.2},children:[d>0&&S.jsx(er,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:500,damping:15},className:"absolute -top-0.5 -right-0.5 min-w-[20px] h-5 px-1 bg-gradient-to-br from-red-500 to-red-600 rounded-full flex items-center justify-center text-[10px] font-bold text-white border-2 border-neutral-900 shadow-lg",children:d}),S.jsx(nt.div,{animate:{rotate:e==="notifications"?[0,-10,10,-10,0]:0},transition:{duration:.5},children:S.jsx(XT,{size:22})})]}),S.jsx(Sa,{children:e==="notifications"&&S.jsx(NN,{onClose:u})})]}),S.jsxs("div",{className:"relative",children:[S.jsx(nt.button,{onClick:()=>t(f=>f==="profile"?null:"profile"),className:"relative w-10 h-10 sm:w-10 sm:h-10 rounded-full overflow-hidden touch-target shadow-lg transition-all ring-2 active:scale-90",animate:{scale:e==="profile"?.95:1},style:{boxShadow:e==="profile"?"0 0 0 4px rgba(239, 68, 68, 0.3), 0 8px 24px rgba(239, 68, 68, 0.4)":"0 0 0 2px rgba(239, 68, 68, 0.2), 0 4px 12px rgba(0, 0, 0, 0.3)"},whileHover:{scale:e==="profile"?.95:1.05},whileTap:{scale:.9},transition:{duration:.2},children:S.jsx("img",{src:"/orko.jpeg",alt:"Profile",className:"w-full h-full object-cover"})}),S.jsx(Sa,{children:e==="profile"&&S.jsx(ON,{onClose:u,user:$c})})]})]})]})})]})}const UN=()=>{const n=qt(),e=jn(),t=[{icon:ZT,label:"Home",path:"/"},{icon:Va,label:"Movies",path:"/movies"},{icon:Fu,label:"Series",path:"/series"},{icon:Tp,label:"Popular",path:"/new-popular"},{icon:ou,label:"Live TV",path:"/live-tv"}];return S.jsx(nt.nav,{initial:{y:100},animate:{y:0},className:"md:hidden fixed bottom-0 left-0 right-0 z-50 pb-safe",style:{background:"rgba(10, 10, 10, 0.95)",backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)",borderTop:"1px solid rgba(255, 255, 255, 0.1)",boxShadow:"0 -10px 40px rgba(0, 0, 0, 0.5)"},children:S.jsx("div",{className:"flex items-center justify-around px-2 py-2 safe-area-inset-bottom",children:t.map(r=>{const s=e.pathname===r.path,i=r.icon;return S.jsxs(nt.button,{onClick:()=>n(r.path),className:"relative flex flex-col items-center justify-center px-3 py-2 rounded-xl transition-all touch-target min-w-[60px]",whileTap:{scale:.9},style:{background:s?"rgba(239, 68, 68, 0.15)":"transparent"},children:[S.jsx(nt.div,{animate:{scale:s?1.1:1,color:s?"#ef4444":"#a3a3a3"},transition:{duration:.2},children:S.jsx(i,{size:22,strokeWidth:s?2.5:2})}),S.jsx(nt.span,{className:"text-[10px] font-medium mt-1",animate:{color:s?"#ef4444":"#737373",fontWeight:s?600:500},transition:{duration:.2},children:r.label})]},r.path)})})})};function $N(n){return Object.prototype.toString.call(n)==="[object Object]"}function Tv(n){return $N(n)||Array.isArray(n)}function jN(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function Lp(n,e){const t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;const s=JSON.stringify(Object.keys(n.breakpoints||{})),i=JSON.stringify(Object.keys(e.breakpoints||{}));return s!==i?!1:t.every(o=>{const l=n[o],u=e[o];return typeof l=="function"?`${l}`==`${u}`:!Tv(l)||!Tv(u)?l===u:Lp(l,u)})}function bv(n){return n.concat().sort((e,t)=>e.name>t.name?1:-1).map(e=>e.options)}function VN(n,e){if(n.length!==e.length)return!1;const t=bv(n),r=bv(e);return t.every((s,i)=>{const o=r[i];return Lp(s,o)})}function Rp(n){return typeof n=="number"}function hm(n){return typeof n=="string"}function Gu(n){return typeof n=="boolean"}function wv(n){return Object.prototype.toString.call(n)==="[object Object]"}function pt(n){return Math.abs(n)}function Ip(n){return Math.sign(n)}function da(n,e){return pt(n-e)}function GN(n,e){if(n===0||e===0||pt(n)<=pt(e))return 0;const t=da(pt(n),pt(e));return pt(t/n)}function HN(n){return Math.round(n*100)/100}function Ea(n){return Ta(n).map(Number)}function tr(n){return n[Wa(n)]}function Wa(n){return Math.max(0,n.length-1)}function kp(n,e){return e===Wa(n)}function Av(n,e=0){return Array.from(Array(n),(t,r)=>e+r)}function Ta(n){return Object.keys(n)}function P1(n,e){return[n,e].reduce((t,r)=>(Ta(r).forEach(s=>{const i=t[s],o=r[s],l=wv(i)&&wv(o);t[s]=l?P1(i,o):o}),t),{})}function mm(n,e){return typeof e.MouseEvent<"u"&&n instanceof e.MouseEvent}function KN(n,e){const t={start:r,center:s,end:i};function r(){return 0}function s(u){return i(u)/2}function i(u){return e-u}function o(u,d){return hm(n)?t[n](u):n(e,u,d)}return{measure:o}}function ba(){let n=[];function e(s,i,o,l={passive:!0}){let u;if("addEventListener"in s)s.addEventListener(i,o,l),u=()=>s.removeEventListener(i,o,l);else{const d=s;d.addListener(o),u=()=>d.removeListener(o)}return n.push(u),r}function t(){n=n.filter(s=>s())}const r={add:e,clear:t};return r}function zN(n,e,t,r){const s=ba(),i=1e3/60;let o=null,l=0,u=0;function d(){s.add(n,"visibilitychange",()=>{n.hidden&&g()})}function f(){x(),s.clear()}function h(v){if(!u)return;o||(o=v,t(),t());const b=v-o;for(o=v,l+=b;l>=i;)t(),l-=i;const A=l/i;r(A),u&&(u=e.requestAnimationFrame(h))}function p(){u||(u=e.requestAnimationFrame(h))}function x(){e.cancelAnimationFrame(u),o=null,l=0,u=0}function g(){o=null,l=0}return{init:d,destroy:f,start:p,stop:x,update:t,render:r}}function WN(n,e){const t=e==="rtl",r=n==="y",s=r?"y":"x",i=r?"x":"y",o=!r&&t?-1:1,l=f(),u=h();function d(g){const{height:E,width:v}=g;return r?E:v}function f(){return r?"top":t?"right":"left"}function h(){return r?"bottom":t?"left":"right"}function p(g){return g*o}return{scroll:s,cross:i,startEdge:l,endEdge:u,measureSize:d,direction:p}}function ii(n=0,e=0){const t=pt(n-e);function r(d){return d<n}function s(d){return d>e}function i(d){return r(d)||s(d)}function o(d){return i(d)?r(d)?n:e:d}function l(d){return t?d-t*Math.ceil((d-e)/t):d}return{length:t,max:e,min:n,constrain:o,reachedAny:i,reachedMax:s,reachedMin:r,removeOffset:l}}function D1(n,e,t){const{constrain:r}=ii(0,n),s=n+1;let i=o(e);function o(p){return t?pt((s+p)%s):r(p)}function l(){return i}function u(p){return i=o(p),h}function d(p){return f().set(l()+p)}function f(){return D1(n,l(),t)}const h={get:l,set:u,add:d,clone:f};return h}function YN(n,e,t,r,s,i,o,l,u,d,f,h,p,x,g,E,v,b,A){const{cross:L,direction:I}=n,_=["INPUT","SELECT","TEXTAREA"],F={passive:!1},C=ba(),P=ba(),O=ii(50,225).constrain(x.measure(20)),M={mouse:300,touch:400},H={mouse:500,touch:600},Z=g?43:25;let se=!1,U=0,ne=0,q=!1,te=!1,G=!1,Q=!1;function ee(Te){if(!A)return;function ve($e){(Gu(A)||A(Te,$e))&&fe($e)}const Re=e;C.add(Re,"dragstart",$e=>$e.preventDefault(),F).add(Re,"touchmove",()=>{},F).add(Re,"touchend",()=>{}).add(Re,"touchstart",ve).add(Re,"mousedown",ve).add(Re,"touchcancel",ye).add(Re,"contextmenu",ye).add(Re,"click",Le,!0)}function D(){C.clear(),P.clear()}function $(){const Te=Q?t:e;P.add(Te,"touchmove",Ee,F).add(Te,"touchend",ye).add(Te,"mousemove",Ee,F).add(Te,"mouseup",ye)}function ie(Te){const ve=Te.nodeName||"";return _.includes(ve)}function ce(){return(g?H:M)[Q?"mouse":"touch"]}function ue(Te,ve){const Re=h.add(Ip(Te)*-1),$e=f.byDistance(Te,!g).distance;return g||pt(Te)<O?$e:v&&ve?$e*.5:f.byIndex(Re.get(),0).distance}function fe(Te){const ve=mm(Te,r);Q=ve,G=g&&ve&&!Te.buttons&&se,se=da(s.get(),o.get())>=2,!(ve&&Te.button!==0)&&(ie(Te.target)||(q=!0,i.pointerDown(Te),d.useFriction(0).useDuration(0),s.set(o),$(),U=i.readPoint(Te),ne=i.readPoint(Te,L),p.emit("pointerDown")))}function Ee(Te){if(!mm(Te,r)&&Te.touches.length>=2)return ye(Te);const Re=i.readPoint(Te),$e=i.readPoint(Te,L),me=da(Re,U),Me=da($e,ne);if(!te&&!Q&&(!Te.cancelable||(te=me>Me,!te)))return ye(Te);const qe=i.pointerMove(Te);me>E&&(G=!0),d.useFriction(.3).useDuration(.75),l.start(),s.add(I(qe)),Te.preventDefault()}function ye(Te){const Re=f.byDistance(0,!1).index!==h.get(),$e=i.pointerUp(Te)*ce(),me=ue(I($e),Re),Me=GN($e,me),qe=Z-10*Me,je=b+Me/50;te=!1,q=!1,P.clear(),d.useDuration(qe).useFriction(je),u.distance(me,!g),Q=!1,p.emit("pointerUp")}function Le(Te){G&&(Te.stopPropagation(),Te.preventDefault(),G=!1)}function _e(){return q}return{init:ee,destroy:D,pointerDown:_e}}function qN(n,e){let r,s;function i(h){return h.timeStamp}function o(h,p){const g=`client${(p||n.scroll)==="x"?"X":"Y"}`;return(mm(h,e)?h:h.touches[0])[g]}function l(h){return r=h,s=h,o(h)}function u(h){const p=o(h)-o(s),x=i(h)-i(r)>170;return s=h,x&&(r=h),p}function d(h){if(!r||!s)return 0;const p=o(s)-o(r),x=i(h)-i(r),g=i(h)-i(s)>170,E=p/x;return x&&!g&&pt(E)>.1?E:0}return{pointerDown:l,pointerMove:u,pointerUp:d,readPoint:o}}function XN(){function n(t){const{offsetTop:r,offsetLeft:s,offsetWidth:i,offsetHeight:o}=t;return{top:r,right:s+i,bottom:r+o,left:s,width:i,height:o}}return{measure:n}}function QN(n){function e(r){return n*(r/100)}return{measure:e}}function JN(n,e,t,r,s,i,o){const l=[n].concat(r);let u,d,f=[],h=!1;function p(v){return s.measureSize(o.measure(v))}function x(v){if(!i)return;d=p(n),f=r.map(p);function b(A){for(const L of A){if(h)return;const I=L.target===n,_=r.indexOf(L.target),F=I?d:f[_],C=p(I?n:r[_]);if(pt(C-F)>=.5){v.reInit(),e.emit("resize");break}}}u=new ResizeObserver(A=>{(Gu(i)||i(v,A))&&b(A)}),t.requestAnimationFrame(()=>{l.forEach(A=>u.observe(A))})}function g(){h=!0,u&&u.disconnect()}return{init:x,destroy:g}}function ZN(n,e,t,r,s,i){let o=0,l=0,u=s,d=i,f=n.get(),h=0;function p(){const F=r.get()-n.get(),C=!u;let P=0;return C?(o=0,t.set(r),n.set(r),P=F):(t.set(n),o+=F/u,o*=d,f+=o,n.add(o),P=f-h),l=Ip(P),h=f,_}function x(){const F=r.get()-e.get();return pt(F)<.001}function g(){return u}function E(){return l}function v(){return o}function b(){return L(s)}function A(){return I(i)}function L(F){return u=F,_}function I(F){return d=F,_}const _={direction:E,duration:g,velocity:v,seek:p,settled:x,useBaseFriction:A,useBaseDuration:b,useFriction:I,useDuration:L};return _}function e2(n,e,t,r,s){const i=s.measure(10),o=s.measure(50),l=ii(.1,.99);let u=!1;function d(){return!(u||!n.reachedAny(t.get())||!n.reachedAny(e.get()))}function f(x){if(!d())return;const g=n.reachedMin(e.get())?"min":"max",E=pt(n[g]-e.get()),v=t.get()-e.get(),b=l.constrain(E/o);t.subtract(v*b),!x&&pt(v)<i&&(t.set(n.constrain(t.get())),r.useDuration(25).useBaseFriction())}function h(x){u=!x}return{shouldConstrain:d,constrain:f,toggleActive:h}}function t2(n,e,t,r,s){const i=ii(-e+n,0),o=h(),l=f(),u=p();function d(g,E){return da(g,E)<=1}function f(){const g=o[0],E=tr(o),v=o.lastIndexOf(g),b=o.indexOf(E)+1;return ii(v,b)}function h(){return t.map((g,E)=>{const{min:v,max:b}=i,A=i.constrain(g),L=!E,I=kp(t,E);return L?b:I||d(v,A)?v:d(b,A)?b:A}).map(g=>parseFloat(g.toFixed(3)))}function p(){if(e<=n+s)return[i.max];if(r==="keepSnaps")return o;const{min:g,max:E}=l;return o.slice(g,E)}return{snapsContained:u,scrollContainLimit:l}}function n2(n,e,t){const r=e[0],s=t?r-n:tr(e);return{limit:ii(s,r)}}function r2(n,e,t,r){const i=e.min+.1,o=e.max+.1,{reachedMin:l,reachedMax:u}=ii(i,o);function d(p){return p===1?u(t.get()):p===-1?l(t.get()):!1}function f(p){if(!d(p))return;const x=n*(p*-1);r.forEach(g=>g.add(x))}return{loop:f}}function s2(n){const{max:e,length:t}=n;function r(i){const o=i-e;return t?o/-t:0}return{get:r}}function i2(n,e,t,r,s){const{startEdge:i,endEdge:o}=n,{groupSlides:l}=s,u=h().map(e.measure),d=p(),f=x();function h(){return l(r).map(E=>tr(E)[o]-E[0][i]).map(pt)}function p(){return r.map(E=>t[i]-E[i]).map(E=>-pt(E))}function x(){return l(d).map(E=>E[0]).map((E,v)=>E+u[v])}return{snaps:d,snapsAligned:f}}function o2(n,e,t,r,s,i){const{groupSlides:o}=s,{min:l,max:u}=r,d=f();function f(){const p=o(i),x=!n||e==="keepSnaps";return t.length===1?[i]:x?p:p.slice(l,u).map((g,E,v)=>{const b=!E,A=kp(v,E);if(b){const L=tr(v[0])+1;return Av(L)}if(A){const L=Wa(i)-tr(v)[0]+1;return Av(L,tr(v)[0])}return g})}return{slideRegistry:d}}function a2(n,e,t,r,s){const{reachedAny:i,removeOffset:o,constrain:l}=r;function u(g){return g.concat().sort((E,v)=>pt(E)-pt(v))[0]}function d(g){const E=n?o(g):l(g),v=e.map((A,L)=>({diff:f(A-E,0),index:L})).sort((A,L)=>pt(A.diff)-pt(L.diff)),{index:b}=v[0];return{index:b,distance:E}}function f(g,E){const v=[g,g+t,g-t];if(!n)return g;if(!E)return u(v);const b=v.filter(A=>Ip(A)===E);return b.length?u(b):tr(v)-t}function h(g,E){const v=e[g]-s.get(),b=f(v,E);return{index:g,distance:b}}function p(g,E){const v=s.get()+g,{index:b,distance:A}=d(v),L=!n&&i(v);if(!E||L)return{index:b,distance:g};const I=e[b]-A,_=g+f(I,0);return{index:b,distance:_}}return{byDistance:p,byIndex:h,shortcut:f}}function l2(n,e,t,r,s,i,o){function l(h){const p=h.distance,x=h.index!==e.get();i.add(p),p&&(r.duration()?n.start():(n.update(),n.render(1),n.update())),x&&(t.set(e.get()),e.set(h.index),o.emit("select"))}function u(h,p){const x=s.byDistance(h,p);l(x)}function d(h,p){const x=e.clone().set(h),g=s.byIndex(x.get(),p);l(g)}return{distance:u,index:d}}function c2(n,e,t,r,s,i,o,l){const u={passive:!0,capture:!0};let d=0;function f(x){if(!l)return;function g(E){if(new Date().getTime()-d>10)return;o.emit("slideFocusStart"),n.scrollLeft=0;const A=t.findIndex(L=>L.includes(E));Rp(A)&&(s.useDuration(0),r.index(A,0),o.emit("slideFocus"))}i.add(document,"keydown",h,!1),e.forEach((E,v)=>{i.add(E,"focus",b=>{(Gu(l)||l(x,b))&&g(v)},u)})}function h(x){x.code==="Tab"&&(d=new Date().getTime())}return{init:f}}function sa(n){let e=n;function t(){return e}function r(u){e=o(u)}function s(u){e+=o(u)}function i(u){e-=o(u)}function o(u){return Rp(u)?u:u.get()}return{get:t,set:r,add:s,subtract:i}}function N1(n,e){const t=n.scroll==="x"?o:l,r=e.style;let s=null,i=!1;function o(p){return`translate3d(${p}px,0px,0px)`}function l(p){return`translate3d(0px,${p}px,0px)`}function u(p){if(i)return;const x=HN(n.direction(p));x!==s&&(r.transform=t(x),s=x)}function d(p){i=!p}function f(){i||(r.transform="",e.getAttribute("style")||e.removeAttribute("style"))}return{clear:f,to:u,toggleActive:d}}function u2(n,e,t,r,s,i,o,l,u){const f=Ea(s),h=Ea(s).reverse(),p=b().concat(A());function x(C,P){return C.reduce((O,M)=>O-s[M],P)}function g(C,P){return C.reduce((O,M)=>x(O,P)>0?O.concat([M]):O,[])}function E(C){return i.map((P,O)=>({start:P-r[O]+.5+C,end:P+e-.5+C}))}function v(C,P,O){const M=E(P);return C.map(H=>{const Z=O?0:-t,se=O?t:0,U=O?"end":"start",ne=M[H][U];return{index:H,loopPoint:ne,slideLocation:sa(-1),translate:N1(n,u[H]),target:()=>l.get()>ne?Z:se}})}function b(){const C=o[0],P=g(h,C);return v(P,t,!1)}function A(){const C=e-o[0]-1,P=g(f,C);return v(P,-t,!0)}function L(){return p.every(({index:C})=>{const P=f.filter(O=>O!==C);return x(P,e)<=.1})}function I(){p.forEach(C=>{const{target:P,translate:O,slideLocation:M}=C,H=P();H!==M.get()&&(O.to(H),M.set(H))})}function _(){p.forEach(C=>C.translate.clear())}return{canLoop:L,clear:_,loop:I,loopPoints:p}}function d2(n,e,t){let r,s=!1;function i(u){if(!t)return;function d(f){for(const h of f)if(h.type==="childList"){u.reInit(),e.emit("slidesChanged");break}}r=new MutationObserver(f=>{s||(Gu(t)||t(u,f))&&d(f)}),r.observe(n,{childList:!0})}function o(){r&&r.disconnect(),s=!0}return{init:i,destroy:o}}function f2(n,e,t,r){const s={};let i=null,o=null,l,u=!1;function d(){l=new IntersectionObserver(g=>{u||(g.forEach(E=>{const v=e.indexOf(E.target);s[v]=E}),i=null,o=null,t.emit("slidesInView"))},{root:n.parentElement,threshold:r}),e.forEach(g=>l.observe(g))}function f(){l&&l.disconnect(),u=!0}function h(g){return Ta(s).reduce((E,v)=>{const b=parseInt(v),{isIntersecting:A}=s[b];return(g&&A||!g&&!A)&&E.push(b),E},[])}function p(g=!0){if(g&&i)return i;if(!g&&o)return o;const E=h(g);return g&&(i=E),g||(o=E),E}return{init:d,destroy:f,get:p}}function h2(n,e,t,r,s,i){const{measureSize:o,startEdge:l,endEdge:u}=n,d=t[0]&&s,f=g(),h=E(),p=t.map(o),x=v();function g(){if(!d)return 0;const A=t[0];return pt(e[l]-A[l])}function E(){if(!d)return 0;const A=i.getComputedStyle(tr(r));return parseFloat(A.getPropertyValue(`margin-${u}`))}function v(){return t.map((A,L,I)=>{const _=!L,F=kp(I,L);return _?p[L]+f:F?p[L]+h:I[L+1][l]-A[l]}).map(pt)}return{slideSizes:p,slideSizesWithGaps:x,startGap:f,endGap:h}}function m2(n,e,t,r,s,i,o,l,u){const{startEdge:d,endEdge:f,direction:h}=n,p=Rp(t);function x(b,A){return Ea(b).filter(L=>L%A===0).map(L=>b.slice(L,L+A))}function g(b){return b.length?Ea(b).reduce((A,L,I)=>{const _=tr(A)||0,F=_===0,C=L===Wa(b),P=s[d]-i[_][d],O=s[d]-i[L][f],M=!r&&F?h(o):0,H=!r&&C?h(l):0,Z=pt(O-H-(P+M));return I&&Z>e+u&&A.push(L),C&&A.push(b.length),A},[]).map((A,L,I)=>{const _=Math.max(I[L-1]||0);return b.slice(_,A)}):[]}function E(b){return p?x(b,t):g(b)}return{groupSlides:E}}function p2(n,e,t,r,s,i,o){const{align:l,axis:u,direction:d,startIndex:f,loop:h,duration:p,dragFree:x,dragThreshold:g,inViewThreshold:E,slidesToScroll:v,skipSnaps:b,containScroll:A,watchResize:L,watchSlides:I,watchDrag:_,watchFocus:F}=i,C=2,P=XN(),O=P.measure(e),M=t.map(P.measure),H=WN(u,d),Z=H.measureSize(O),se=QN(Z),U=KN(l,Z),ne=!h&&!!A,q=h||!!A,{slideSizes:te,slideSizesWithGaps:G,startGap:Q,endGap:ee}=h2(H,O,M,t,q,s),D=m2(H,Z,v,h,O,M,Q,ee,C),{snaps:$,snapsAligned:ie}=i2(H,U,O,M,D),ce=-tr($)+tr(G),{snapsContained:ue,scrollContainLimit:fe}=t2(Z,ce,ie,A,C),Ee=ne?ue:ie,{limit:ye}=n2(ce,Ee,h),Le=D1(Wa(Ee),f,h),_e=Le.clone(),Pe=Ea(t),Te=({dragHandler:Xt,scrollBody:Qt,scrollBounds:io,options:{loop:Cs}})=>{Cs||io.constrain(Xt.pointerDown()),Qt.seek()},ve=({scrollBody:Xt,translate:Qt,location:io,offsetLocation:Cs,previousLocation:Xa,scrollLooper:Ju,slideLooper:oo,dragHandler:ao,animation:lo,eventHandler:di,scrollBounds:co,options:{loop:Ar}},Lr)=>{const uo=Xt.settled(),Qa=!co.shouldConstrain(),fo=Ar?uo:uo&&Qa,ho=fo&&!ao.pointerDown();ho&&lo.stop();const Ja=io.get()*Lr+Xa.get()*(1-Lr);Cs.set(Ja),Ar&&(Ju.loop(Xt.direction()),oo.loop()),Qt.to(Cs.get()),ho&&di.emit("settle"),fo||di.emit("scroll")},Re=zN(r,s,()=>Te(yn),Xt=>ve(yn,Xt)),$e=.68,me=Ee[Le.get()],Me=sa(me),qe=sa(me),je=sa(me),Be=sa(me),Xe=ZN(Me,je,qe,Be,p,$e),_t=a2(h,Ee,ce,ye,Be),_n=l2(Re,Le,_e,Xe,_t,Be,o),pn=s2(ye),vt=ba(),wt=f2(e,t,o,E),{slideRegistry:gn}=o2(ne,A,Ee,fe,D,Pe),sr=c2(n,t,gn,_n,Xe,vt,o,F),yn={ownerDocument:r,ownerWindow:s,eventHandler:o,containerRect:O,slideRects:M,animation:Re,axis:H,dragHandler:YN(H,n,r,s,Be,qN(H,s),Me,Re,_n,Xe,_t,Le,o,se,x,g,b,$e,_),eventStore:vt,percentOfView:se,index:Le,indexPrevious:_e,limit:ye,location:Me,offsetLocation:je,previousLocation:qe,options:i,resizeHandler:JN(e,o,s,t,H,L,P),scrollBody:Xe,scrollBounds:e2(ye,je,Be,Xe,se),scrollLooper:r2(ce,ye,je,[Me,je,qe,Be]),scrollProgress:pn,scrollSnapList:Ee.map(pn.get),scrollSnaps:Ee,scrollTarget:_t,scrollTo:_n,slideLooper:u2(H,Z,ce,te,G,$,Ee,je,t),slideFocus:sr,slidesHandler:d2(e,o,I),slidesInView:wt,slideIndexes:Pe,slideRegistry:gn,slidesToScroll:D,target:Be,translate:N1(H,e)};return yn}function g2(){let n={},e;function t(d){e=d}function r(d){return n[d]||[]}function s(d){return r(d).forEach(f=>f(e,d)),u}function i(d,f){return n[d]=r(d).concat([f]),u}function o(d,f){return n[d]=r(d).filter(h=>h!==f),u}function l(){n={}}const u={init:t,emit:s,off:o,on:i,clear:l};return u}const y2={align:"center",axis:"x",container:null,slides:null,containScroll:"trimSnaps",direction:"ltr",slidesToScroll:1,inViewThreshold:0,breakpoints:{},dragFree:!1,dragThreshold:10,loop:!1,skipSnaps:!1,duration:25,startIndex:0,active:!0,watchDrag:!0,watchResize:!0,watchSlides:!0,watchFocus:!0};function x2(n){function e(i,o){return P1(i,o||{})}function t(i){const o=i.breakpoints||{},l=Ta(o).filter(u=>n.matchMedia(u).matches).map(u=>o[u]).reduce((u,d)=>e(u,d),{});return e(i,l)}function r(i){return i.map(o=>Ta(o.breakpoints||{})).reduce((o,l)=>o.concat(l),[]).map(n.matchMedia)}return{mergeOptions:e,optionsAtMedia:t,optionsMediaQueries:r}}function v2(n){let e=[];function t(i,o){return e=o.filter(({options:l})=>n.optionsAtMedia(l).active!==!1),e.forEach(l=>l.init(i,n)),o.reduce((l,u)=>Object.assign(l,{[u.name]:u}),{})}function r(){e=e.filter(i=>i.destroy())}return{init:t,destroy:r}}function cu(n,e,t){const r=n.ownerDocument,s=r.defaultView,i=x2(s),o=v2(i),l=ba(),u=g2(),{mergeOptions:d,optionsAtMedia:f,optionsMediaQueries:h}=i,{on:p,off:x,emit:g}=u,E=H;let v=!1,b,A=d(y2,cu.globalOptions),L=d(A),I=[],_,F,C;function P(){const{container:Pe,slides:Te}=L;F=(hm(Pe)?n.querySelector(Pe):Pe)||n.children[0];const Re=hm(Te)?F.querySelectorAll(Te):Te;C=[].slice.call(Re||F.children)}function O(Pe){const Te=p2(n,F,C,r,s,Pe,u);if(Pe.loop&&!Te.slideLooper.canLoop()){const ve=Object.assign({},Pe,{loop:!1});return O(ve)}return Te}function M(Pe,Te){v||(A=d(A,Pe),L=f(A),I=Te||I,P(),b=O(L),h([A,...I.map(({options:ve})=>ve)]).forEach(ve=>l.add(ve,"change",H)),L.active&&(b.translate.to(b.location.get()),b.animation.init(),b.slidesInView.init(),b.slideFocus.init(_e),b.eventHandler.init(_e),b.resizeHandler.init(_e),b.slidesHandler.init(_e),b.options.loop&&b.slideLooper.loop(),F.offsetParent&&C.length&&b.dragHandler.init(_e),_=o.init(_e,I)))}function H(Pe,Te){const ve=D();Z(),M(d({startIndex:ve},Pe),Te),u.emit("reInit")}function Z(){b.dragHandler.destroy(),b.eventStore.clear(),b.translate.clear(),b.slideLooper.clear(),b.resizeHandler.destroy(),b.slidesHandler.destroy(),b.slidesInView.destroy(),b.animation.destroy(),o.destroy(),l.clear()}function se(){v||(v=!0,l.clear(),Z(),u.emit("destroy"),u.clear())}function U(Pe,Te,ve){!L.active||v||(b.scrollBody.useBaseFriction().useDuration(Te===!0?0:L.duration),b.scrollTo.index(Pe,ve||0))}function ne(Pe){const Te=b.index.add(1).get();U(Te,Pe,-1)}function q(Pe){const Te=b.index.add(-1).get();U(Te,Pe,1)}function te(){return b.index.add(1).get()!==D()}function G(){return b.index.add(-1).get()!==D()}function Q(){return b.scrollSnapList}function ee(){return b.scrollProgress.get(b.offsetLocation.get())}function D(){return b.index.get()}function $(){return b.indexPrevious.get()}function ie(){return b.slidesInView.get()}function ce(){return b.slidesInView.get(!1)}function ue(){return _}function fe(){return b}function Ee(){return n}function ye(){return F}function Le(){return C}const _e={canScrollNext:te,canScrollPrev:G,containerNode:ye,internalEngine:fe,destroy:se,off:x,on:p,emit:g,plugins:ue,previousScrollSnap:$,reInit:E,rootNode:Ee,scrollNext:ne,scrollPrev:q,scrollProgress:ee,scrollSnapList:Q,scrollTo:U,selectedScrollSnap:D,slideNodes:Le,slidesInView:ie,slidesNotInView:ce};return M(e,t),setTimeout(()=>u.emit("init"),0),_e}cu.globalOptions=void 0;function Hu(n={},e=[]){const t=N.useRef(n),r=N.useRef(e),[s,i]=N.useState(),[o,l]=N.useState(),u=N.useCallback(()=>{s&&s.reInit(t.current,r.current)},[s]);return N.useEffect(()=>{Lp(t.current,n)||(t.current=n,u())},[n,u]),N.useEffect(()=>{VN(r.current,e)||(r.current=e,u())},[e,u]),N.useEffect(()=>{if(jN()&&o){cu.globalOptions=Hu.globalOptions;const d=cu(o,t.current,r.current);return i(d),()=>d.destroy()}else i(void 0)},[o,i]),[l,s]}Hu.globalOptions=void 0;const S2={active:!0,breakpoints:{},delay:4e3,jump:!1,playOnInit:!0,stopOnFocusIn:!0,stopOnInteraction:!0,stopOnMouseEnter:!1,stopOnLastSnap:!1,rootNode:null};function E2(n,e){const t=n.scrollSnapList();return typeof e=="number"?t.map(()=>e):e(t,n)}function T2(n,e){const t=n.rootNode();return e&&e(t)||t}function Ku(n={}){let e,t,r,s,i=null,o=0,l=!1,u=!1,d=!1,f=!1;function h(U,ne){t=U;const{mergeOptions:q,optionsAtMedia:te}=ne,G=q(S2,Ku.globalOptions),Q=q(G,n);if(e=te(Q),t.scrollSnapList().length<=1)return;f=e.jump,r=!1,s=E2(t,e.delay);const{eventStore:ee,ownerDocument:D}=t.internalEngine(),$=!!t.internalEngine().options.watchDrag,ie=T2(t,e.rootNode);ee.add(D,"visibilitychange",b),$&&t.on("pointerDown",L),$&&!e.stopOnInteraction&&t.on("pointerUp",I),e.stopOnMouseEnter&&ee.add(ie,"mouseenter",_),e.stopOnMouseEnter&&!e.stopOnInteraction&&ee.add(ie,"mouseleave",F),e.stopOnFocusIn&&t.on("slideFocusStart",v),e.stopOnFocusIn&&!e.stopOnInteraction&&ee.add(t.containerNode(),"focusout",E),e.playOnInit&&E()}function p(){t.off("pointerDown",L).off("pointerUp",I).off("slideFocusStart",v),v(),r=!0,l=!1}function x(){const{ownerWindow:U}=t.internalEngine();U.clearTimeout(o),o=U.setTimeout(H,s[t.selectedScrollSnap()]),i=new Date().getTime(),t.emit("autoplay:timerset")}function g(){const{ownerWindow:U}=t.internalEngine();U.clearTimeout(o),o=0,i=null,t.emit("autoplay:timerstopped")}function E(){if(!r){if(A()){d=!0;return}l||t.emit("autoplay:play"),x(),l=!0}}function v(){r||(l&&t.emit("autoplay:stop"),g(),l=!1)}function b(){if(A())return d=l,v();d&&E()}function A(){const{ownerDocument:U}=t.internalEngine();return U.visibilityState==="hidden"}function L(){u||v()}function I(){u||E()}function _(){u=!0,v()}function F(){u=!1,E()}function C(U){typeof U<"u"&&(f=U),E()}function P(){l&&v()}function O(){l&&E()}function M(){return l}function H(){const{index:U}=t.internalEngine(),ne=U.clone().add(1).get(),q=t.scrollSnapList().length-1,te=e.stopOnLastSnap&&ne===q;if(t.canScrollNext()?t.scrollNext(f):t.scrollTo(0,f),t.emit("autoplay:select"),te)return v();E()}function Z(){if(!i)return null;const U=s[t.selectedScrollSnap()],ne=new Date().getTime()-i;return U-ne}return{name:"autoplay",options:n,init:h,destroy:p,play:C,stop:P,reset:O,isPlaying:M,timeUntilNext:Z}}Ku.globalOptions=void 0;var lh={exports:{}},ch={};var Lv;function b2(){if(Lv)return ch;Lv=1;var n=Na();function e(h,p){return h===p&&(h!==0||1/h===1/p)||h!==h&&p!==p}var t=typeof Object.is=="function"?Object.is:e,r=n.useState,s=n.useEffect,i=n.useLayoutEffect,o=n.useDebugValue;function l(h,p){var x=p(),g=r({inst:{value:x,getSnapshot:p}}),E=g[0].inst,v=g[1];return i(function(){E.value=x,E.getSnapshot=p,u(E)&&v({inst:E})},[h,x,p]),s(function(){return u(E)&&v({inst:E}),h(function(){u(E)&&v({inst:E})})},[h]),o(x),x}function u(h){var p=h.getSnapshot;h=h.value;try{var x=p();return!t(h,x)}catch{return!0}}function d(h,p){return p()}var f=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?d:l;return ch.useSyncExternalStore=n.useSyncExternalStore!==void 0?n.useSyncExternalStore:f,ch}var Rv;function w2(){return Rv||(Rv=1,lh.exports=b2()),lh.exports}var A2=w2();const O1=0,M1=1,F1=2,Iv=3;var kv=Object.prototype.hasOwnProperty;function pm(n,e){var t,r;if(n===e)return!0;if(n&&e&&(t=n.constructor)===e.constructor){if(t===Date)return n.getTime()===e.getTime();if(t===RegExp)return n.toString()===e.toString();if(t===Array){if((r=n.length)===e.length)for(;r--&&pm(n[r],e[r]););return r===-1}if(!t||typeof n=="object"){r=0;for(t in n)if(kv.call(n,t)&&++r&&!kv.call(e,t)||!(t in e)||!pm(n[t],e[t]))return!1;return Object.keys(e).length===r}}return n!==n&&e!==e}const Ur=new WeakMap,Ss=()=>{},Wt=Ss(),gm=Object,ze=n=>n===Wt,gr=n=>typeof n=="function",Ls=(n,e)=>({...n,...e}),B1=n=>gr(n.then),uh={},hc={},Cp="undefined",Ya=typeof window!=Cp,ym=typeof document!=Cp,L2=Ya&&"Deno"in window,R2=()=>Ya&&typeof window.requestAnimationFrame!=Cp,U1=(n,e)=>{const t=Ur.get(n);return[()=>!ze(e)&&n.get(e)||uh,r=>{if(!ze(e)){const s=n.get(e);e in hc||(hc[e]=s),t[5](e,Ls(s,r),s||uh)}},t[6],()=>!ze(e)&&e in hc?hc[e]:!ze(e)&&n.get(e)||uh]};let xm=!0;const I2=()=>xm,[vm,Sm]=Ya&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[Ss,Ss],k2=()=>{const n=ym&&document.visibilityState;return ze(n)||n!=="hidden"},C2=n=>(ym&&document.addEventListener("visibilitychange",n),vm("focus",n),()=>{ym&&document.removeEventListener("visibilitychange",n),Sm("focus",n)}),_2=n=>{const e=()=>{xm=!0,n()},t=()=>{xm=!1};return vm("online",e),vm("offline",t),()=>{Sm("online",e),Sm("offline",t)}},P2={isOnline:I2,isVisible:k2},D2={initFocus:C2,initReconnect:_2},Cv=!Rn.useId,wa=!Ya||L2,N2=n=>R2()?window.requestAnimationFrame(n):setTimeout(n,1),dh=wa?N.useEffect:N.useLayoutEffect,fh=typeof navigator<"u"&&navigator.connection,_v=!wa&&fh&&(["slow-2g","2g"].includes(fh.effectiveType)||fh.saveData),mc=new WeakMap,O2=n=>gm.prototype.toString.call(n),hh=(n,e)=>n===`[object ${e}]`;let M2=0;const Em=n=>{const e=typeof n,t=O2(n),r=hh(t,"Date"),s=hh(t,"RegExp"),i=hh(t,"Object");let o,l;if(gm(n)===n&&!r&&!s){if(o=mc.get(n),o)return o;if(o=++M2+"~",mc.set(n,o),Array.isArray(n)){for(o="@",l=0;l<n.length;l++)o+=Em(n[l])+",";mc.set(n,o)}if(i){o="#";const u=gm.keys(n).sort();for(;!ze(l=u.pop());)ze(n[l])||(o+=l+":"+Em(n[l])+",");mc.set(n,o)}}else o=r?n.toJSON():e=="symbol"?n.toString():e=="string"?JSON.stringify(n):""+n;return o},_p=n=>{if(gr(n))try{n=n()}catch{n=""}const e=n;return n=typeof n=="string"?n:(Array.isArray(n)?n.length:n)?Em(n):"",[n,e]};let F2=0;const Tm=()=>++F2;async function $1(...n){const[e,t,r,s]=n,i=Ls({populateCache:!0,throwOnError:!0},typeof s=="boolean"?{revalidate:s}:s||{});let o=i.populateCache;const l=i.rollbackOnError;let u=i.optimisticData;const d=p=>typeof l=="function"?l(p):l!==!1,f=i.throwOnError;if(gr(t)){const p=t,x=[],g=e.keys();for(const E of g)!/^\$(inf|sub)\$/.test(E)&&p(e.get(E)._k)&&x.push(E);return Promise.all(x.map(h))}return h(t);async function h(p){const[x]=_p(p);if(!x)return;const[g,E]=U1(e,x),[v,b,A,L]=Ur.get(e),I=()=>{const U=v[x];return(gr(i.revalidate)?i.revalidate(g().data,p):i.revalidate!==!1)&&(delete A[x],delete L[x],U&&U[0])?U[0](F1).then(()=>g().data):g().data};if(n.length<3)return I();let _=r,F,C=!1;const P=Tm();b[x]=[P,0];const O=!ze(u),M=g(),H=M.data,Z=M._c,se=ze(Z)?H:Z;if(O&&(u=gr(u)?u(se,H):u,E({data:u,_c:se})),gr(_))try{_=_(se)}catch(U){F=U,C=!0}if(_&&B1(_))if(_=await _.catch(U=>{F=U,C=!0}),P!==b[x][0]){if(C)throw F;return _}else C&&O&&d(F)&&(o=!0,E({data:se,_c:Wt}));if(o&&!C)if(gr(o)){const U=o(_,se);E({data:U,error:Wt,_c:Wt})}else E({data:_,error:Wt,_c:Wt});if(b[x][1]=Tm(),Promise.resolve(I()).then(()=>{E({_c:Wt})}),C){if(f)throw F;return}return _}}const Pv=(n,e)=>{for(const t in n)n[t][0]&&n[t][0](e)},B2=(n,e)=>{if(!Ur.has(n)){const t=Ls(D2,e),r=Object.create(null),s=$1.bind(Wt,n);let i=Ss;const o=Object.create(null),l=(f,h)=>{const p=o[f]||[];return o[f]=p,p.push(h),()=>p.splice(p.indexOf(h),1)},u=(f,h,p)=>{n.set(f,h);const x=o[f];if(x)for(const g of x)g(h,p)},d=()=>{if(!Ur.has(n)&&(Ur.set(n,[r,Object.create(null),Object.create(null),Object.create(null),s,u,l]),!wa)){const f=t.initFocus(setTimeout.bind(Wt,Pv.bind(Wt,r,O1))),h=t.initReconnect(setTimeout.bind(Wt,Pv.bind(Wt,r,M1)));i=()=>{f&&f(),h&&h(),Ur.delete(n)}}};return d(),[n,s,d,i]}return[n,Ur.get(n)[4]]},U2=(n,e,t,r,s)=>{const i=t.errorRetryCount,o=s.retryCount,l=~~((Math.random()+.5)*(1<<(o<8?o:8)))*t.errorRetryInterval;!ze(i)&&o>i||setTimeout(r,l,s)},$2=pm,[j1,j2]=B2(new Map),V2=Ls({onLoadingSlow:Ss,onSuccess:Ss,onError:Ss,onErrorRetry:U2,onDiscarded:Ss,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:_v?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:_v?5e3:3e3,compare:$2,isPaused:()=>!1,cache:j1,mutate:j2,fallback:{}},P2),G2=(n,e)=>{const t=Ls(n,e);if(e){const{use:r,fallback:s}=n,{use:i,fallback:o}=e;r&&i&&(t.use=r.concat(i)),s&&o&&(t.fallback=Ls(s,o))}return t},H2=N.createContext({}),K2="$inf$",V1=Ya&&window.__SWR_DEVTOOLS_USE__,z2=V1?window.__SWR_DEVTOOLS_USE__:[],W2=()=>{V1&&(window.__SWR_DEVTOOLS_REACT__=Rn)},Y2=n=>gr(n[1])?[n[0],n[1],n[2]||{}]:[n[0],null,(n[1]===null?n[2]:n[1])||{}],q2=()=>{const n=N.useContext(H2);return N.useMemo(()=>Ls(V2,n),[n])},X2=n=>(e,t,r)=>n(e,t&&((...i)=>{const[o]=_p(e),[,,,l]=Ur.get(j1);if(o.startsWith(K2))return t(...i);const u=l[o];return ze(u)?t(...i):(delete l[o],u)}),r),Q2=z2.concat(X2),J2=n=>function(...t){const r=q2(),[s,i,o]=Y2(t),l=G2(r,o);let u=n;const{use:d}=l,f=(d||[]).concat(Q2);for(let h=f.length;h--;)u=f[h](u);return u(s,i||l.fetcher||null,l)},Z2=(n,e,t)=>{const r=e[n]||(e[n]=[]);return r.push(t),()=>{const s=r.indexOf(t);s>=0&&(r[s]=r[r.length-1],r.pop())}};W2();const mh=Rn.use||(n=>{switch(n.status){case"pending":throw n;case"fulfilled":return n.value;case"rejected":throw n.reason;default:throw n.status="pending",n.then(e=>{n.status="fulfilled",n.value=e},e=>{n.status="rejected",n.reason=e}),n}}),ph={dedupe:!0},Dv=Promise.resolve(Wt),eO=(n,e,t)=>{const{cache:r,compare:s,suspense:i,fallbackData:o,revalidateOnMount:l,revalidateIfStale:u,refreshInterval:d,refreshWhenHidden:f,refreshWhenOffline:h,keepPreviousData:p}=t,[x,g,E,v]=Ur.get(r),[b,A]=_p(n),L=N.useRef(!1),I=N.useRef(!1),_=N.useRef(b),F=N.useRef(e),C=N.useRef(t),P=()=>C.current,O=()=>P().isVisible()&&P().isOnline(),[M,H,Z,se]=U1(r,b),U=N.useRef({}).current,ne=ze(o)?ze(t.fallback)?Wt:t.fallback[b]:o,q=(ve,Re)=>{for(const $e in U){const me=$e;if(me==="data"){if(!s(ve[me],Re[me])&&(!ze(ve[me])||!s(ue,Re[me])))return!1}else if(Re[me]!==ve[me])return!1}return!0},te=N.useMemo(()=>{const ve=!b||!e?!1:ze(l)?P().isPaused()||i?!1:u!==!1:l,Re=Be=>{const Xe=Ls(Be);return delete Xe._k,ve?{isValidating:!0,isLoading:!0,...Xe}:Xe},$e=M(),me=se(),Me=Re($e),qe=$e===me?Me:Re(me);let je=Me;return[()=>{const Be=Re(M());return q(Be,je)?(je.data=Be.data,je.isLoading=Be.isLoading,je.isValidating=Be.isValidating,je.error=Be.error,je):(je=Be,Be)},()=>qe]},[r,b]),G=A2.useSyncExternalStore(N.useCallback(ve=>Z(b,(Re,$e)=>{q($e,Re)||ve()}),[r,b]),te[0],te[1]),Q=!L.current,ee=x[b]&&x[b].length>0,D=G.data,$=ze(D)?ne&&B1(ne)?mh(ne):ne:D,ie=G.error,ce=N.useRef($),ue=p?ze(D)?ze(ce.current)?$:ce.current:D:$,fe=ee&&!ze(ie)?!1:Q&&!ze(l)?l:P().isPaused()?!1:i?ze($)?!1:u:ze($)||u,Ee=!!(b&&e&&Q&&fe),ye=ze(G.isValidating)?Ee:G.isValidating,Le=ze(G.isLoading)?Ee:G.isLoading,_e=N.useCallback(async ve=>{const Re=F.current;if(!b||!Re||I.current||P().isPaused())return!1;let $e,me,Me=!0;const qe=ve||{},je=!E[b]||!qe.dedupe,Be=()=>Cv?!I.current&&b===_.current&&L.current:b===_.current,Xe={isValidating:!1,isLoading:!1},_t=()=>{H(Xe)},_n=()=>{const vt=E[b];vt&&vt[1]===me&&delete E[b]},pn={isValidating:!0};ze(M().data)&&(pn.isLoading=!0);try{if(je&&(H(pn),t.loadingTimeout&&ze(M().data)&&setTimeout(()=>{Me&&Be()&&P().onLoadingSlow(b,t)},t.loadingTimeout),E[b]=[Re(A),Tm()]),[$e,me]=E[b],$e=await $e,je&&setTimeout(_n,t.dedupingInterval),!E[b]||E[b][1]!==me)return je&&Be()&&P().onDiscarded(b),!1;Xe.error=Wt;const vt=g[b];if(!ze(vt)&&(me<=vt[0]||me<=vt[1]||vt[1]===0))return _t(),je&&Be()&&P().onDiscarded(b),!1;const wt=M().data;Xe.data=s(wt,$e)?wt:$e,je&&Be()&&P().onSuccess($e,b,t)}catch(vt){_n();const wt=P(),{shouldRetryOnError:gn}=wt;wt.isPaused()||(Xe.error=vt,je&&Be()&&(wt.onError(vt,b,wt),(gn===!0||gr(gn)&&gn(vt))&&(!P().revalidateOnFocus||!P().revalidateOnReconnect||O())&&wt.onErrorRetry(vt,b,wt,sr=>{const yn=x[b];yn&&yn[0]&&yn[0](Iv,sr)},{retryCount:(qe.retryCount||0)+1,dedupe:!0})))}return Me=!1,_t(),!0},[b,r]),Pe=N.useCallback((...ve)=>$1(r,_.current,...ve),[]);if(dh(()=>{F.current=e,C.current=t,ze(D)||(ce.current=D)}),dh(()=>{if(!b)return;const ve=_e.bind(Wt,ph);let Re=0;P().revalidateOnFocus&&(Re=Date.now()+P().focusThrottleInterval);const me=Z2(b,x,(Me,qe={})=>{if(Me==O1){const je=Date.now();P().revalidateOnFocus&&je>Re&&O()&&(Re=je+P().focusThrottleInterval,ve())}else if(Me==M1)P().revalidateOnReconnect&&O()&&ve();else{if(Me==F1)return _e();if(Me==Iv)return _e(qe)}});return I.current=!1,_.current=b,L.current=!0,H({_k:A}),fe&&(E[b]||(ze($)||wa?ve():N2(ve))),()=>{I.current=!0,me()}},[b]),dh(()=>{let ve;function Re(){const me=gr(d)?d(M().data):d;me&&ve!==-1&&(ve=setTimeout($e,me))}function $e(){!M().error&&(f||P().isVisible())&&(h||P().isOnline())?_e(ph).then(Re):Re()}return Re(),()=>{ve&&(clearTimeout(ve),ve=-1)}},[d,f,h,b]),N.useDebugValue(ue),i){const ve=b&&ze($);if(!Cv&&wa&&ve)throw new Error("Fallback data is required when using Suspense in SSR.");ve&&(F.current=e,C.current=t,I.current=!1);const Re=v[b],$e=!ze(Re)&&ve?Pe(Re):Dv;if(mh($e),!ze(ie)&&ve)throw ie;const me=ve?_e(ph):Dv;!ze(ue)&&ve&&(me.status="fulfilled",me.value=!0),mh(me)}return{mutate:Pe,get data(){return U.data=!0,ue},get error(){return U.error=!0,ie},get isValidating(){return U.isValidating=!0,ye},get isLoading(){return U.isLoading=!0,Le}}},$r=J2(eO),tO=n=>We.get(n).then(e=>e.data),G1=N.memo(({movie:n,onReady:e})=>{const t=qt(),[r,s]=N.useState(null),[i,o]=N.useState(!1),l=n.title||n.name||"Untitled",u=(n.release_date||n.first_air_date||"").split("-")[0],d=n.backdrop_path?`https://image.tmdb.org/t/p/original${n.backdrop_path}`:"https://via.placeholder.com/1920x1080/000000/666666?text=No+Image",f=n.poster_path?`https://image.tmdb.org/t/p/original${n.poster_path}`:d;N.useEffect(()=>{(async()=>{try{const x=n.media_type||"movie",v=(await We.get(`${et.TMDB_BASE_URL}/${x}/${n.id}/videos?api_key=${et.TMDB_API_KEY}`)).data.results.find(b=>b.type==="Trailer"&&b.site==="YouTube");v?s(v.key):e&&!i&&(o(!0),e())}catch(x){console.error("Failed to fetch trailer:",x),e&&!i&&(o(!0),e())}})()},[n.id,n.media_type,e,i]);const h=()=>{e&&!i&&(o(!0),e())};return S.jsxs("div",{className:"relative h-[75vh] sm:h-[70vh] md:h-[80vh] lg:h-[85vh] w-full overflow-hidden",children:[S.jsxs("div",{className:"absolute inset-0 scale-105",children:[S.jsx("img",{src:f,alt:l,className:"sm:hidden w-full h-full object-cover object-top",onLoad:h}),S.jsx("div",{className:"hidden sm:block w-full h-full",children:r?S.jsx("iframe",{src:`https://www.youtube.com/embed/${r}?autoplay=1&mute=1&loop=1&playlist=${r}&controls=0&showinfo=0&rel=0&modestbranding=1&playsinline=1&enablejsapi=1`,title:`${l} Trailer`,className:"w-full h-full object-cover pointer-events-none",style:{width:"100%",height:"100%",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%) scale(1.5)",border:"none"},allow:"autoplay; encrypted-media",allowFullScreen:!0,onLoad:h}):S.jsx("img",{src:d,alt:l,className:"w-full h-full object-cover",onLoad:h})})]}),S.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-black/60 to-transparent"}),S.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-2/3 bg-gradient-to-t from-black via-black/40 to-transparent"}),S.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-black/60 to-transparent md:from-black/80"}),S.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1/4 bg-gradient-to-t from-red-950/30 via-transparent to-transparent mix-blend-multiply"}),S.jsx("div",{className:"absolute inset-0 flex flex-col justify-end pb-safe",children:S.jsx("div",{className:"px-4 sm:px-6 md:px-8 lg:px-12 xl:px-16 pb-24 sm:pb-20 md:pb-24",children:S.jsxs("div",{className:"max-w-4xl space-y-3 sm:space-y-4",children:[n.vote_average>0&&S.jsxs("div",{className:"inline-flex items-center gap-2 px-3.5 py-1.5 bg-gradient-to-r from-yellow-500/20 to-yellow-600/20 backdrop-blur-xl rounded-full border border-yellow-500/40 shadow-lg",children:[S.jsx(Mu,{className:"w-4 h-4 text-yellow-400 fill-yellow-400"}),S.jsx("span",{className:"text-white font-bold text-sm",children:n.vote_average.toFixed(1)}),u&&S.jsxs("span",{className:"text-white/60 text-xs font-medium",children:[" ",u]})]}),S.jsx("h1",{className:"text-3xl sm:text-4xl md:text-5xl lg:text-6xl xl:text-7xl font-black text-white line-clamp-2 leading-[1.1] tracking-tight",style:{textShadow:"0 4px 12px rgba(0, 0, 0, 0.9), 0 2px 6px rgba(0, 0, 0, 0.8)"},children:l}),n.overview&&S.jsx("p",{className:"text-sm sm:text-base md:text-lg text-gray-100 line-clamp-2 sm:line-clamp-3 max-w-2xl leading-relaxed font-medium",style:{textShadow:"0 2px 6px rgba(0, 0, 0, 0.9)"},children:n.overview}),S.jsxs("div",{className:"flex flex-row gap-3 pt-2 sm:pt-4",children:[S.jsxs("button",{onClick:()=>t(`/${n.media_type||"movie"}/${n.id}`),className:"flex-1 sm:flex-none sm:min-w-[140px] px-5 sm:px-8 py-3.5 sm:py-3 bg-red-600 hover:bg-red-700 text-white text-base font-bold rounded-xl transition-all flex items-center justify-center gap-2.5 shadow-2xl shadow-red-600/40 active:scale-[0.98] border border-red-500/20",children:[S.jsx(nr,{className:"w-5 h-5 fill-current"}),S.jsx("span",{children:"Play"})]}),S.jsxs("button",{onClick:()=>t(`/${n.media_type||"movie"}/${n.id}`),className:"flex-1 sm:flex-none sm:min-w-[140px] px-5 sm:px-8 py-3.5 sm:py-3 bg-white/15 backdrop-blur-xl hover:bg-white/25 text-white text-base font-bold rounded-xl transition-all flex items-center justify-center gap-2.5 border border-white/30 shadow-xl active:scale-[0.98]",children:[S.jsx(YP,{className:"w-5 h-5"}),S.jsx("span",{children:"Info"})]})]})]})})})]})});G1.displayName="MovieSlide";const nO=()=>{const{data:n,error:e,isLoading:t}=$r(`${et.TMDB_BASE_URL}/trending/all/day?api_key=${et.TMDB_API_KEY}`,tO,{revalidateOnFocus:!1}),r=N.useMemo(()=>n?.results?.slice(0,7)||[],[n]),[s,i]=Hu({loop:!0},[Ku({delay:5e3,stopOnInteraction:!1})]),[o,l]=N.useState(0),[u,d]=N.useState(!1),f=N.useCallback(()=>{i&&l(i.selectedScrollSnap())},[i]);return N.useEffect(()=>{i&&(i.on("select",f),f())},[i,f]),t?S.jsx("div",{className:"h-[65vh] sm:h-[70vh] md:h-[80vh] lg:h-[85vh] bg-black"}):e||!r.length?S.jsx("div",{className:"h-[65vh] sm:h-[70vh] md:h-[80vh] lg:h-[85vh] bg-black flex items-center justify-center",children:S.jsx("p",{className:"text-white text-base sm:text-lg md:text-xl",children:"Unable to load content"})}):S.jsxs("div",{className:`relative transition-opacity duration-1000 ${u?"opacity-100":"opacity-0"}`,children:[S.jsx("div",{className:"overflow-hidden",ref:s,children:S.jsx("div",{className:"flex",children:r.map((h,p)=>S.jsx("div",{className:"flex-[0_0_100%] min-w-0",children:S.jsx(G1,{movie:h,onReady:p===0?()=>d(!0):void 0})},h.id))})}),S.jsxs("div",{className:"absolute bottom-6 sm:bottom-8 left-0 right-0 pb-safe z-20",children:[S.jsx("div",{className:"sm:hidden flex justify-center items-center gap-1",children:r.map((h,p)=>S.jsx("button",{onClick:()=>i?.scrollTo(p),className:`transition-all duration-300 ${p===o?"w-4 h-0.5 bg-red-600 rounded-full":"w-0.5 h-0.5 bg-white/30 hover:bg-white/50 rounded-full"}`,"aria-label":`Go to slide ${p+1}`},p))}),S.jsx("div",{className:"hidden sm:flex justify-center items-center gap-2",children:r.map((h,p)=>S.jsx("button",{onClick:()=>i?.scrollTo(p),className:`transition-all duration-300 rounded-full ${p===o?"w-8 h-1.5 bg-red-600 shadow-lg shadow-red-600/50":"w-1.5 h-1.5 bg-white/40 hover:bg-white/70 active:scale-90"}`,"aria-label":`Go to slide ${p+1}`},p))})]})]})},rO=n=>We.get(n).then(e=>e.data),sO={28:"Action",12:"Adventure",16:"Animation",35:"Comedy",80:"Crime",99:"Documentary",18:"Drama",10751:"Family",14:"Fantasy",36:"History",27:"Horror",10402:"Music",9648:"Mystery",10749:"Romance",878:"Sci-Fi",10770:"TV Movie",53:"Thriller",10752:"War",37:"Western"},H1=N.memo(({movie:n,index:e,onPlay:t})=>{const[r,s]=N.useState(!1),[i,o]=N.useState({x:0,y:0}),l=f=>{const h=f.currentTarget.getBoundingClientRect(),p=((f.clientX-h.left)/h.width-.5)*40,x=((f.clientY-h.top)/h.height-.5)*40;o({x:p,y:x})},u=r?i.y/40*-10:0,d=r?i.x/40*10:0;return S.jsxs(nt.div,{className:"group cursor-pointer touch-target relative",onMouseEnter:()=>s(!0),onMouseLeave:()=>{s(!1),o({x:0,y:0})},onMouseMove:l,onClick:t,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1,rotateX:u,rotateY:d},transition:{delay:e*.03,duration:.3,rotateX:{duration:.2,ease:"easeOut"},rotateY:{duration:.2,ease:"easeOut"}},whileHover:{scale:1.03},whileTap:{scale:.98},style:{transformStyle:"preserve-3d",perspective:1e3},children:[S.jsx("div",{className:"relative overflow-hidden rounded-xl bg-neutral-900/90 border border-neutral-800/60 shadow-xl transition-all duration-500",children:S.jsxs("div",{style:{aspectRatio:"27/40"},className:"relative overflow-hidden",children:[S.jsx(nt.img,{src:n.poster_path?`https://image.tmdb.org/t/p/w500${n.poster_path}`:"https://via.placeholder.com/270x400/1a1a1a/ef4444?text=No+Image",alt:n.title||n.name,className:"w-full h-full object-cover",loading:"lazy",animate:{scale:r?1.08:1},transition:{duration:.6,ease:[.34,1.56,.64,1]}}),S.jsx(nt.div,{className:"absolute inset-0 pointer-events-none",initial:{opacity:0},animate:{opacity:r?1:0,background:r?"radial-gradient(circle at center, rgba(239, 68, 68, 0.25) 0%, transparent 70%)":"transparent"},transition:{duration:.5,ease:[.22,1,.36,1]}}),S.jsx(nt.div,{className:"absolute inset-0 bg-black",initial:{opacity:0},animate:{opacity:r?.5:0},transition:{duration:.5,ease:[.22,1,.36,1]}}),S.jsx(nt.div,{className:"absolute inset-0 flex items-center justify-center",initial:{opacity:0,scale:0},animate:{opacity:r?1:0,scale:r?1:0,x:i.x*.6,y:i.y*.6},transition:{opacity:{duration:.5,ease:[.34,1.56,.64,1]},scale:{duration:.5,ease:[.34,1.56,.64,1]},x:{duration:.2,ease:[.22,1,.36,1]},y:{duration:.2,ease:[.22,1,.36,1]}},children:S.jsxs(nt.button,{className:"relative w-16 h-16 rounded-full flex items-center justify-center overflow-hidden",onClick:f=>{f.stopPropagation(),t()},whileHover:{scale:1.12},whileTap:{scale:.92},transition:{type:"spring",stiffness:400,damping:25},style:{background:"linear-gradient(135deg, rgba(239, 68, 68, 0.95), rgba(220, 38, 38, 0.9))",backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)",border:"2px solid rgba(255, 255, 255, 0.5)",boxShadow:"0 8px 32px rgba(239, 68, 68, 0.5), 0 0 40px rgba(239, 68, 68, 0.3), inset 0 2px 8px rgba(255, 255, 255, 0.4)"},children:[S.jsx(nt.div,{className:"absolute inset-0",style:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.3) 0%, transparent 100%)"},animate:{background:["linear-gradient(135deg, rgba(255, 255, 255, 0.3) 0%, transparent 100%)","linear-gradient(225deg, rgba(255, 255, 255, 0.3) 0%, transparent 100%)","linear-gradient(135deg, rgba(255, 255, 255, 0.3) 0%, transparent 100%)"]},transition:{duration:4,repeat:1/0,ease:[.22,1,.36,1]}}),S.jsx(nr,{size:26,className:"text-white relative z-10 ml-1",strokeWidth:0,fill:"white"})]})}),S.jsxs(nt.div,{className:"absolute top-2 right-2 px-2.5 py-1 rounded-lg flex items-center gap-1",style:{background:"rgba(0, 0, 0, 0.6)",backdropFilter:"blur(15px) saturate(150%)",WebkitBackdropFilter:"blur(15px) saturate(150%)",border:"1px solid rgba(255, 255, 255, 0.15)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)"},whileHover:{scale:1.05},transition:{type:"spring",stiffness:400,damping:25},children:[S.jsx(Mu,{size:11,className:"text-yellow-400",fill:"#facc15"}),S.jsx("span",{className:"text-white text-xs font-semibold",children:n.vote_average.toFixed(1)})]}),n.genre_ids&&n.genre_ids.length>0&&S.jsx(nt.div,{className:"absolute bottom-2 left-2 px-2.5 py-1 rounded-md",style:{background:"rgba(0, 0, 0, 0.75)",backdropFilter:"blur(15px) saturate(150%)",WebkitBackdropFilter:"blur(15px) saturate(150%)",border:"1px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)"},initial:{opacity:0,y:8,scale:.95},animate:{opacity:r?1:0,y:r?0:8,scale:r?1:.95},transition:{duration:.4,ease:[.34,1.56,.64,1]},children:S.jsx("span",{className:"text-white text-[10px] font-medium tracking-wide",children:n.genre_ids.slice(0,2).map(f=>sO[f]).filter(Boolean).join("  ")})}),S.jsx(nt.button,{className:"absolute top-2 left-2 w-7 h-7 rounded-lg flex items-center justify-center",style:{background:"rgba(255, 255, 255, 0.12)",backdropFilter:"blur(15px) saturate(150%)",WebkitBackdropFilter:"blur(15px) saturate(150%)",border:"1px solid rgba(255, 255, 255, 0.25)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)"},initial:{opacity:0,scale:.85},animate:{opacity:r?1:0,scale:r?1:.85},transition:{duration:.4,ease:[.34,1.56,.64,1]},onClick:f=>{f.stopPropagation()},whileHover:{scale:1.15},whileTap:{scale:.9},children:S.jsx(n1,{size:14,className:"text-white",strokeWidth:2.5})})]})}),S.jsxs("div",{className:"mt-3 px-1",children:[S.jsx(nt.h3,{className:"font-semibold text-white text-sm sm:text-sm mb-1 truncate",animate:{color:r?"#ef4444":"#ffffff"},transition:{duration:.4,ease:[.22,1,.36,1]},children:n.title||n.name}),S.jsx("p",{className:"text-gray-500 text-xs sm:text-xs",children:(n.release_date||n.first_air_date||"").slice(0,4)})]})]})});H1.displayName="MovieCard";const iO=({title:n,endpoint:e})=>{const t=qt(),{data:r,error:s,isLoading:i}=$r(e?`${et.TMDB_BASE_URL}${e}?api_key=${et.TMDB_API_KEY}`:null,rO,{revalidateOnFocus:!1,revalidateOnReconnect:!1,dedupingInterval:6e4});if(s)return null;if(i)return S.jsx("section",{className:"mb-8 sm:mb-12 md:mb-16",children:S.jsxs("div",{className:"container mx-auto mobile-padding sm:px-6",children:[S.jsx("div",{className:"h-6 sm:h-8 bg-gradient-to-r from-red-800/30 to-red-900/30 rounded-lg w-48 sm:w-64 mb-4 sm:mb-6 animate-pulse"}),S.jsx("div",{className:"mobile-card-grid tablet-grid-3 desktop-grid-6 gap-3 sm:gap-4 md:gap-6",children:Array.from({length:6}).map((d,f)=>S.jsx("div",{className:"aspect-[27/40] bg-gradient-to-br from-gray-800/50 to-gray-900/50 rounded-lg sm:rounded-xl animate-pulse"},f))})]})});const l=(r?.results||[]).filter(d=>{const f=d.media_type==="tv"||!d.media_type&&!d.title?"tv":"movie",h=!!(d.poster_path||d.backdrop_path);return(f==="movie"||f==="tv")&&h}),u=d=>{const f=d.media_type==="tv"||!d.media_type&&!d.title?"tv":"movie";t(`/${f}/${d.id}`)};return S.jsx("section",{className:"mb-16",children:S.jsxs("div",{className:"container mx-auto mobile-padding sm:px-6",children:[S.jsx("div",{className:"mb-8",children:S.jsxs("h2",{className:"text-3xl font-black text-white mb-3 relative",children:[n,S.jsx("div",{className:"absolute -bottom-1 left-0 h-1 bg-gradient-to-r from-red-500 to-red-600 w-24 rounded-full"})]})}),S.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6",children:l.slice(0,18).map((d,f)=>S.jsx(H1,{movie:d,index:f,onPlay:()=>u(d)},`${d.id}-${f}`))})]})})},oO=N.memo(iO),aO={home:[{key:"trending-all",title:"Trending Now",endpoint:"/trending/all/week"},{key:"in-theaters",title:"In Theaters",endpoint:"/movie/now_playing"},{key:"popular-movies",title:"Popular Movies",endpoint:"/movie/popular"},{key:"popular-tv",title:"Popular TV Shows",endpoint:"/tv/popular"},{key:"top-rated-movies",title:"Top Rated Movies",endpoint:"/movie/top_rated"},{key:"family-night",title:"Family Picks",endpoint:"/discover/movie?with_genres=10751"},{key:"sci-fi",title:"Science Fiction",endpoint:"/discover/movie?with_genres=878"}],movies:[{key:"trending-movies",title:"Trending Movies",endpoint:"/trending/movie/week"},{key:"movies-now-playing",title:"Now Playing",endpoint:"/movie/now_playing"},{key:"movies-popular",title:"Popular Movies",endpoint:"/movie/popular"},{key:"movies-top-rated",title:"Top Rated Movies",endpoint:"/movie/top_rated"},{key:"movies-upcoming",title:"Upcoming Releases",endpoint:"/movie/upcoming"},{key:"movies-action",title:"Action and Adventure",endpoint:"/discover/movie?with_genres=28,12"},{key:"movies-comedy",title:"Comedy Hits",endpoint:"/discover/movie?with_genres=35"},{key:"movies-horror",title:"Horror Highlights",endpoint:"/discover/movie?with_genres=27"},{key:"movies-animation",title:"Animated Favorites",endpoint:"/discover/movie?with_genres=16"}],series:[{key:"trending-tv",title:"Trending TV",endpoint:"/trending/tv/week"},{key:"tv-popular",title:"Popular TV Shows",endpoint:"/tv/popular"},{key:"tv-top-rated",title:"Top Rated TV",endpoint:"/tv/top_rated"},{key:"tv-on-air",title:"Currently Airing",endpoint:"/tv/on_the_air"},{key:"tv-airing-today",title:"Airing Today",endpoint:"/tv/airing_today"},{key:"tv-drama",title:"Drama and Suspense",endpoint:"/discover/tv?with_genres=18,9648,80"},{key:"tv-documentary",title:"Documentary Series",endpoint:"/discover/tv?with_genres=99"},{key:"tv-animation",title:"Animated Series",endpoint:"/discover/tv?with_genres=16"}],new:[{key:"trending-today",title:"Trending Today",endpoint:"/trending/all/day"},{key:"trending-week",title:"Trending This Week",endpoint:"/trending/all/week"},{key:"upcoming-movies",title:"Coming Soon",endpoint:"/movie/upcoming"},{key:"now-playing-new",title:"Now Playing In Theaters",endpoint:"/movie/now_playing"},{key:"tv-on-the-air",title:"New Episodes",endpoint:"/tv/on_the_air"},{key:"tv-airing-today-new",title:"Fresh On TV Today",endpoint:"/tv/airing_today"}]},lO={home:"all",movies:"movie",series:"tv",new:"all"},cO=n=>{const e=new URLSearchParams(n).get("section");return e==="movies"||e==="series"||e==="new"?e:"home"};function uO(){const n=jn(),e=N.useMemo(()=>cO(n.search),[n.search]),t=N.useMemo(()=>aO[e],[e]),r=lO[e];return N.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[e]),S.jsx("div",{className:"relative min-h-screen bg-black text-white",children:S.jsxs("main",{className:"relative z-10",children:[S.jsx(nO,{variant:r}),S.jsx("div",{className:"py-12 space-y-16",children:t.map(s=>S.jsx(oO,{title:s.title,endpoint:s.endpoint},s.key))})]})})}const dO=({videoUrl:n,title:e,onClose:t,poster:r,autoPlay:s=!0,movieId:i,isTV:o,season:l,episode:u,movieData:d})=>{const[f,h]=N.useState(""),[p,x]=N.useState(!0),g=N.useRef(null),E=N.useRef(null);N.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow="unset"}),[]),N.useEffect(()=>{i?h(o&&l&&u?`https://player.videasy.net/tv/${i}/${l}/${u}`:`https://player.videasy.net/movie/${i}`):n&&h(n)},[n,i,o,l,u]);const v=()=>{x(!0),g.current&&clearTimeout(g.current),g.current=setTimeout(()=>{x(!1)},3e3)},b=()=>{x(!1)},A=L=>{L.target===L.currentTarget&&t?.()};return S.jsxs(nt.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black z-[200] flex flex-col",onClick:A,children:[S.jsx("div",{className:"sm:hidden absolute top-0 left-0 right-0 z-[210] safe-area-inset",children:S.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-b from-black/95 to-transparent",children:[S.jsxs("button",{onClick:t,className:"flex items-center gap-2 px-4 py-2 bg-white/10 backdrop-blur-xl hover:bg-white/20 active:bg-white/15 rounded-full transition-all active:scale-95 border border-white/20",children:[S.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:S.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M15 19l-7-7 7-7"})}),S.jsx("span",{className:"text-white font-semibold text-sm",children:"Back"})]}),S.jsx("h2",{className:"text-white text-sm font-bold line-clamp-1 max-w-[60%]",children:e})]})}),S.jsxs(nt.div,{initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.98},transition:{duration:.3,ease:"easeOut"},className:"w-full h-full sm:max-w-7xl sm:mx-auto sm:my-4 sm:max-h-[95vh] overflow-y-auto custom-scrollbar flex flex-col",children:[S.jsx("div",{ref:E,className:"relative bg-black flex-shrink-0 group w-full",style:{height:window.innerWidth<640?"45vh":"clamp(350px, 65vh, 75vh)",borderRadius:window.innerWidth<640?"0":"12px",padding:window.innerWidth<640?"0":"3px",background:window.innerWidth<640?"#000":"linear-gradient(135deg, #dc2626, #000000, #dc2626)",overflow:"hidden",marginTop:window.innerWidth<640?"56px":"0"},onMouseMove:v,onMouseLeave:b,onTouchStart:v,children:S.jsxs("div",{className:"w-full h-full bg-black rounded-[6px] sm:rounded-[9px] overflow-hidden relative",children:[S.jsx("div",{className:`hidden sm:block absolute top-0 left-0 right-0 z-50 transition-all duration-300 ${p?"opacity-100 translate-y-0":"opacity-0 -translate-y-full pointer-events-none"}`,children:S.jsx("div",{className:"bg-gradient-to-b from-black/90 via-black/60 to-transparent p-4 md:p-6",children:S.jsxs("div",{className:"flex items-center justify-between",children:[S.jsx("h2",{className:"text-white text-base md:text-lg lg:text-xl font-bold drop-shadow-lg line-clamp-1 flex-1",children:e}),S.jsx("button",{onClick:t,className:"ml-4 p-2 bg-white/10 hover:bg-white/20 rounded-full transition-all",children:S.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:S.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})}),f&&S.jsx("iframe",{src:f,className:"w-full h-full border-0",allowFullScreen:!0,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen",title:e})]})}),d&&S.jsx("div",{className:"flex-1 overflow-y-auto px-4 sm:px-0 pb-safe",children:S.jsxs("div",{className:"mt-4 sm:mt-4 grid grid-cols-1 lg:grid-cols-2 gap-4",children:[S.jsxs("div",{className:"bg-neutral-900/80 backdrop-blur-sm rounded-xl p-4 sm:p-5 border border-white/5",children:[S.jsx("h3",{className:"text-base sm:text-lg font-bold text-white mb-3 line-clamp-2",children:e}),S.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-3 text-xs sm:text-sm",children:[d.vote_average&&S.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 bg-green-500/20 text-green-400 font-semibold rounded-full",children:[S.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:S.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})}),Math.round(d.vote_average*10),"%"]}),(d.release_date||d.first_air_date)&&S.jsx("span",{className:"px-2.5 py-1 bg-white/10 text-white font-medium rounded-full",children:(d.release_date||d.first_air_date)?.slice(0,4)}),d.runtime&&S.jsxs("span",{className:"px-2.5 py-1 bg-white/10 text-gray-300 font-medium rounded-full",children:[Math.floor(d.runtime/60),"h ",d.runtime%60,"m"]}),S.jsx("span",{className:"px-2.5 py-1 bg-red-500/20 text-red-400 font-semibold rounded-full",children:"HD"})]}),d.tagline&&S.jsxs("p",{className:"text-gray-400 italic text-sm mb-3 line-clamp-2",children:['"',d.tagline,'"']}),d.overview&&S.jsx("p",{className:"text-gray-300 text-sm leading-relaxed line-clamp-4 sm:line-clamp-5",children:d.overview})]}),S.jsxs("div",{className:"bg-neutral-900/80 backdrop-blur-sm rounded-xl p-4 sm:p-5 border border-white/5",children:[S.jsx("h4",{className:"text-base font-bold text-white mb-3",children:"Details"}),S.jsxs("div",{className:"grid grid-cols-1 gap-2.5 text-sm",children:[d.genres&&d.genres.length>0&&S.jsxs("div",{children:[S.jsx("span",{className:"text-gray-400 text-xs font-medium mb-1.5 block",children:"Genres"}),S.jsx("div",{className:"flex flex-wrap gap-2",children:d.genres.map(L=>S.jsx("span",{className:"px-3 py-1 bg-white/10 text-white rounded-full text-xs font-medium",children:L.name},L.id))})]}),d.vote_average&&S.jsxs("div",{className:"flex items-center gap-2 py-1",children:[S.jsx("span",{className:"text-gray-400 text-xs font-medium min-w-[70px]",children:"Rating"}),S.jsxs("div",{className:"flex items-center gap-2",children:[S.jsxs("span",{className:"text-yellow-400 font-bold text-base",children:[" ",d.vote_average.toFixed(1)]}),d.vote_count&&S.jsxs("span",{className:"text-gray-400 text-xs",children:["(",(d.vote_count/1e3).toFixed(1),"K votes)"]})]})]}),d.status&&S.jsxs("div",{className:"flex items-center gap-2 py-1",children:[S.jsx("span",{className:"text-gray-400 text-xs font-medium min-w-[70px]",children:"Status"}),S.jsx("span",{className:"text-white text-sm font-medium",children:d.status})]}),d.spoken_languages&&d.spoken_languages.length>0&&S.jsxs("div",{className:"flex items-center gap-2 py-1",children:[S.jsx("span",{className:"text-gray-400 text-xs font-medium min-w-[70px]",children:"Languages"}),S.jsx("span",{className:"text-white text-sm",children:d.spoken_languages.slice(0,3).map(L=>L.name).join(", ")})]}),d.production_companies&&d.production_companies.length>0&&S.jsxs("div",{className:"flex items-center gap-2 py-1",children:[S.jsx("span",{className:"text-gray-400 text-xs font-medium min-w-[70px]",children:"Studio"}),S.jsx("span",{className:"text-white text-sm line-clamp-1",children:d.production_companies[0].name})]}),d.budget&&d.budget>0||d.revenue&&d.revenue>0?S.jsxs("div",{className:"flex items-center gap-4 py-1",children:[d.budget&&d.budget>0&&S.jsxs("div",{className:"flex items-center gap-2",children:[S.jsx("span",{className:"text-gray-400 text-xs font-medium",children:"Budget"}),S.jsxs("span",{className:"text-white text-sm font-medium",children:["$",(d.budget/1e6).toFixed(0),"M"]})]}),d.revenue&&d.revenue>0&&S.jsxs("div",{className:"flex items-center gap-2",children:[S.jsx("span",{className:"text-gray-400 text-xs font-medium",children:"Revenue"}),S.jsxs("span",{className:"text-green-400 text-sm font-medium",children:["$",(d.revenue/1e6).toFixed(0),"M"]})]})]}):null]})]})]})})]})]})},Nv=()=>{const{id:n}=CR(),e=qt(),[t,r]=N.useState(null),[s,i]=N.useState(!0),[o,l]=N.useState([{id:"1",user:"Alex Johnson",avatar:"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=40&h=40&fit=crop&crop=face",text:"Amazing movie! The cinematography and storyline were absolutely incredible. Highly recommend watching this masterpiece.",rating:5,timestamp:"2 hours ago",likes:24,dislikes:1},{id:"2",user:"Sarah Kim",avatar:"https://images.unsplash.com/photo-1494790108755-2616b612b1c8?w=40&h=40&fit=crop&crop=face",text:"Great acting and visual effects. The plot kept me engaged throughout. Worth every minute of the runtime.",rating:4,timestamp:"5 hours ago",likes:18,dislikes:2},{id:"3",user:"Mike Chen",avatar:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=40&h=40&fit=crop&crop=face",text:"Solid film with excellent character development. The soundtrack complements the scenes perfectly.",rating:4,timestamp:"1 day ago",likes:12,dislikes:0}]),[u,d]=N.useState(""),[f,h]=N.useState(0),[p,x]=N.useState(!1),[g,E]=N.useState(null),[v,b]=N.useState(1),[A,L]=N.useState(1),[I,_]=N.useState(1),[F,C]=N.useState([]),[P,O]=N.useState([]),M=location.pathname.includes("/tv/"),[H,Z]=Hu({loop:!0,align:"start"},[Ku({delay:3e3,stopOnInteraction:!1})]);N.useEffect(()=>{let U=document.getElementById("player-root");return U||(U=document.createElement("div"),U.id="player-root",document.body.appendChild(U)),E(U),()=>{}},[]),N.useEffect(()=>{const U=async()=>{try{const te=M?"tv":"movie",G=`${et.TMDB_BASE_URL}/${te}/${n}?api_key=${et.TMDB_API_KEY}`;console.log(" Fetching movie details from TMDB:",G);const Q=await We.get(G);if(console.log(" TMDB Response:",Q.data),console.log(" Movie title from TMDB:",Q.data.title||Q.data.name),r(Q.data),M&&Q.data.seasons){const $=Q.data.seasons.filter(ie=>ie.season_number>0);if(_($.length),$.length>0){const ie=$.map(ce=>ce.episode_count);C(ie),b(1),L(1)}}const ee=`${et.TMDB_BASE_URL}/${te}/${n}/similar?api_key=${et.TMDB_API_KEY}`,D=await We.get(ee);O(D.data.results.slice(0,12))}catch(te){console.error(" Error fetching movie from TMDB:",te),console.error(" Error details:",{status:te.response?.status,message:te.response?.data,url:te.config?.url})}finally{i(!1)}};n&&(console.log(" MovieDetails: Loading movie ID:",n),U());const ne=window.open;window.open=function(...te){return console.log("Redirect attempt blocked via window.open:",te),null};const q=te=>{const G=te.target;G.tagName==="A"&&G.getAttribute("target")==="_blank"&&(te.preventDefault(),te.stopPropagation(),console.log("External link click blocked"))};return document.addEventListener("click",q,!0),()=>{window.open=ne,document.removeEventListener("click",q,!0)}},[n,M]);const se=()=>{if(!u.trim()||f===0)return;const U={id:Date.now().toString(),user:"You",avatar:"https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=40&h=40&fit=crop&crop=face",text:u,rating:f,timestamp:"Just now",likes:0,dislikes:0};l([U,...o]),d(""),h(0)};return s?S.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center",children:S.jsx(nt.span,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:S.jsx("span",{className:"w-12 h-12 border-4 border-red-500 border-t-transparent rounded-full inline-block"})})}):t?S.jsxs("div",{className:"min-h-screen bg-black",children:[p&&t&&g&&wI.createPortal(S.jsx(dO,{videoUrl:"",title:t.title||t.name||"Video",poster:t.poster_path?`https://image.tmdb.org/t/p/w500${t.poster_path}`:void 0,movieId:n,isTV:M,season:v,episode:A,movieData:{overview:t.overview,vote_average:t.vote_average,vote_count:t.vote_count,release_date:t.release_date,first_air_date:t.first_air_date,runtime:t.runtime,genres:t.genres,spoken_languages:t.spoken_languages,production_companies:t.production_companies,tagline:t.tagline,status:t.status,budget:t.budget,revenue:t.revenue},onClose:()=>{console.log("VideoPlayer onClose called"),x(!1)}}),g),S.jsx("div",{className:"relative",children:S.jsxs("div",{className:"h-[70vh] sm:h-[80vh] md:h-[90vh] lg:h-screen bg-cover bg-center bg-no-repeat relative",style:{backgroundImage:`url(https://image.tmdb.org/t/p/original${t.backdrop_path})`},children:[S.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-black/70 to-transparent"}),S.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-black via-transparent to-black/50"}),S.jsx("div",{className:"absolute inset-0 flex items-center",children:S.jsxs("div",{className:"container mx-auto px-4 sm:px-6 flex items-center gap-6 sm:gap-8 md:gap-12",children:[S.jsx("div",{className:"hidden lg:block flex-shrink-0",children:S.jsx("img",{src:`https://image.tmdb.org/t/p/w500${t.poster_path}`,alt:t.title||t.name,className:"w-60 lg:w-72 xl:w-80 h-auto rounded-xl lg:rounded-2xl shadow-2xl"})}),S.jsxs("div",{className:"flex-1 text-white",children:[S.jsx("h1",{className:"text-3xl sm:text-4xl md:text-5xl lg:text-6xl xl:text-7xl font-black mb-4 sm:mb-6 bg-gradient-to-r from-white to-red-400 bg-clip-text text-transparent line-clamp-2",children:t.title||t.name}),S.jsxs("div",{className:"flex flex-wrap items-center gap-3 sm:gap-4 md:gap-6 mb-4 sm:mb-6 text-sm sm:text-base",children:[S.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[S.jsx("div",{className:"text-yellow-400",children:S.jsx(Mu,{size:16,className:"sm:w-5 sm:h-5"})}),S.jsx("span",{className:"font-bold",children:t.vote_average.toFixed(1)}),S.jsxs("span",{className:"text-gray-400 text-xs sm:text-sm",children:["(",t.vote_count,")"]})]}),S.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[S.jsx("div",{className:"text-red-400",children:S.jsx(KP,{size:16,className:"sm:w-5 sm:h-5"})}),S.jsx("span",{children:(t.release_date||t.first_air_date)?.slice(0,4)})]}),t.runtime&&S.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[S.jsx("div",{className:"text-red-400",children:S.jsx(Ep,{size:16,className:"sm:w-5 sm:h-5"})}),S.jsxs("span",{children:[t.runtime," min"]})]})]}),S.jsx("div",{className:"flex flex-wrap gap-2 mb-4 sm:mb-6",children:t.genres.map(U=>S.jsx("span",{className:"px-3 sm:px-4 py-1.5 sm:py-2 bg-white/10 backdrop-blur-md rounded-full text-xs sm:text-sm font-medium border border-white/20",children:U.name},U.id))}),S.jsx("p",{className:"text-sm sm:text-base md:text-lg text-gray-300 mb-6 sm:mb-8 max-w-2xl leading-relaxed line-clamp-3 sm:line-clamp-4",children:t.overview}),M&&I>0&&S.jsxs("div",{className:"mb-4 sm:mb-6 space-y-3 sm:space-y-4",children:[S.jsxs("div",{className:"flex flex-wrap gap-3 sm:gap-4",children:[S.jsxs("div",{className:"flex flex-col",children:[S.jsx("label",{className:"text-xs sm:text-sm text-gray-400 mb-1.5 sm:mb-2 font-medium",children:"Season"}),S.jsx("select",{value:v,onChange:U=>{const ne=Number(U.target.value);b(ne),L(1)},className:"px-3 sm:px-4 py-2 sm:py-3 bg-white/10 backdrop-blur-md border border-white/20 rounded-lg sm:rounded-xl text-white text-sm sm:text-base font-medium cursor-pointer hover:bg-white/20 transition-all focus:outline-none focus:ring-2 focus:ring-red-500",children:Array.from({length:I},(U,ne)=>ne+1).map(U=>S.jsxs("option",{value:U,className:"bg-black",children:["Season ",U]},U))})]}),S.jsxs("div",{className:"flex flex-col",children:[S.jsx("label",{className:"text-xs sm:text-sm text-gray-400 mb-1.5 sm:mb-2 font-medium",children:"Episode"}),S.jsx("select",{value:A,onChange:U=>L(Number(U.target.value)),className:"px-3 sm:px-4 py-2 sm:py-3 bg-white/10 backdrop-blur-md border border-white/20 rounded-lg sm:rounded-xl text-white text-sm sm:text-base font-medium cursor-pointer hover:bg-white/20 transition-all focus:outline-none focus:ring-2 focus:ring-red-500",children:Array.from({length:F[v-1]||10},(U,ne)=>ne+1).map(U=>S.jsxs("option",{value:U,className:"bg-black",children:["Episode ",U]},U))})]})]}),S.jsxs("div",{className:"text-sm text-gray-400",children:["Now playing: ",S.jsxs("span",{className:"text-white font-medium",children:["Season ",v,", Episode ",A]})]})]}),S.jsxs("div",{className:"flex flex-wrap gap-2 sm:gap-3 md:gap-4",children:[S.jsxs("button",{onClick:()=>{x(!0)},className:"flex items-center gap-2 px-4 sm:px-6 md:px-8 py-2.5 sm:py-3 md:py-4 bg-red-600 hover:bg-red-700 rounded-lg sm:rounded-xl font-bold text-sm sm:text-base md:text-lg transition-all shadow-2xl hover:scale-105 active:scale-95",children:[S.jsx("div",{className:"text-white",children:S.jsx(nr,{size:16,className:"sm:w-5 sm:h-5"})}),M?`Watch S${v}E${A}`:"Watch Now"]}),S.jsxs("button",{type:"button",className:"group relative inline-flex items-center gap-2 sm:gap-3 overflow-hidden rounded-lg sm:rounded-full px-4 sm:px-6 md:px-8 py-2.5 sm:py-3 md:py-3.5 text-xs sm:text-sm font-semibold uppercase tracking-wide text-white transition-all duration-300 focus:outline-none focus-visible:ring-2 focus-visible:ring-white/40",children:[S.jsx("span",{className:"absolute inset-0 rounded-lg sm:rounded-full bg-white/10 backdrop-blur-lg transition-all duration-500 group-hover:bg-white/15 group-active:bg-white/10","aria-hidden":"true"}),S.jsx("span",{className:"absolute inset-0 rounded-lg sm:rounded-full border border-white/25 transition-colors duration-500 group-hover:border-red-400/60","aria-hidden":"true"}),S.jsxs("span",{className:"relative flex items-center gap-2 sm:gap-3",children:[S.jsx(n1,{size:16,className:"sm:w-[18px] sm:h-[18px] text-white/80 group-hover:text-white"}),S.jsx("span",{className:"hidden sm:inline",children:"My List"}),S.jsx("span",{className:"sm:hidden",children:"List"})]})]}),S.jsxs("button",{className:"flex items-center gap-2 sm:gap-3 px-4 sm:px-6 md:px-8 py-2.5 sm:py-3 md:py-4 bg-white/10 backdrop-blur-md border border-white/20 hover:bg-white/20 rounded-lg sm:rounded-xl font-bold text-sm sm:text-base md:text-lg transition-all hover:scale-105 active:scale-95",children:[S.jsx("div",{className:"text-white",children:S.jsx(JP,{size:16,className:"sm:w-5 sm:h-5"})}),S.jsx("span",{className:"hidden sm:inline",children:"Share"})]})]})]})]})})]})}),P.length>0&&S.jsxs("div",{className:"container mx-auto px-4 sm:px-6 py-8 sm:py-10 md:py-12 bg-black",children:[S.jsx("h2",{className:"text-2xl sm:text-3xl font-black text-white mb-6 sm:mb-8",children:"More Like This"}),S.jsxs("div",{className:"relative",children:[S.jsx("div",{className:"overflow-hidden",ref:H,children:S.jsx("div",{className:"flex gap-3 sm:gap-4",children:P.map(U=>S.jsxs("div",{onClick:()=>{e(`/${M?"tv":"movie"}/${U.id}`),window.scrollTo({top:0,behavior:"smooth"})},className:"flex-[0_0_140px] sm:flex-[0_0_160px] md:flex-[0_0_180px] lg:flex-[0_0_200px] min-w-0 cursor-pointer group",children:[S.jsxs("div",{className:"relative aspect-[2/3] rounded-lg overflow-hidden bg-neutral-800",children:[U.poster_path?S.jsx("img",{src:`https://image.tmdb.org/t/p/w500${U.poster_path}`,alt:U.title||U.name,className:"w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-500",loading:"lazy"}):S.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-500",children:"No Image"}),S.jsxs("div",{className:"absolute inset-0 bg-black/80 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col items-center justify-center gap-2 sm:gap-3 p-3 sm:p-4",children:[S.jsx("button",{className:"p-2 sm:p-3 bg-red-600 text-white rounded-full hover:scale-110 transition",children:S.jsx(nr,{size:16,className:"sm:w-5 sm:h-5"})}),S.jsxs("div",{className:"text-center",children:[S.jsx("p",{className:"text-white font-semibold text-xs sm:text-sm line-clamp-2",children:U.title||U.name}),U.vote_average>0&&S.jsxs("p",{className:"text-yellow-400 text-xs mt-1",children:[" ",U.vote_average.toFixed(1)]})]})]})]}),S.jsxs("div",{className:"mt-2",children:[S.jsx("h3",{className:"text-white font-medium text-sm line-clamp-1",children:U.title||U.name}),(U.release_date||U.first_air_date)&&S.jsx("p",{className:"text-gray-400 text-xs mt-1",children:(U.release_date||U.first_air_date).split("-")[0]})]})]},U.id))})}),S.jsx("button",{onClick:()=>Z?.scrollPrev(),className:"absolute left-0 top-1/2 -translate-y-1/2 -translate-x-2 sm:-translate-x-4 p-2 sm:p-3 bg-black/80 hover:bg-black text-white rounded-full transition-all hover:scale-110 z-10",children:S.jsx(zP,{size:20,className:"sm:w-6 sm:h-6"})}),S.jsx("button",{onClick:()=>Z?.scrollNext(),className:"absolute right-0 top-1/2 -translate-y-1/2 translate-x-2 sm:translate-x-4 p-2 sm:p-3 bg-black/80 hover:bg-black text-white rounded-full transition-all hover:scale-110 z-10",children:S.jsx(WP,{size:20,className:"sm:w-6 sm:h-6"})})]})]}),S.jsx("div",{className:"container mx-auto px-4 sm:px-6 py-8 sm:py-10 md:py-12",children:S.jsxs("div",{className:"max-w-4xl mx-auto",children:[S.jsx("h2",{className:"text-2xl sm:text-3xl font-black text-white mb-6 sm:mb-8",children:"User Reviews"}),S.jsxs("div",{className:"bg-white/5 backdrop-blur-md rounded-xl sm:rounded-2xl p-4 sm:p-6 border border-white/10 mb-6 sm:mb-8",children:[S.jsx("h3",{className:"text-lg sm:text-xl font-bold text-white mb-3 sm:mb-4",children:"Share Your Review"}),S.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[S.jsx("span",{className:"text-white",children:"Rating:"}),[1,2,3,4,5].map(U=>S.jsx("button",{onClick:()=>h(U),className:`text-2xl ${U<=f?"text-yellow-400":"text-gray-600"} hover:text-yellow-400 transition-colors`,children:""},U))]}),S.jsx("textarea",{value:u,onChange:U=>d(U.target.value),placeholder:"Write your review...",className:"w-full p-3 sm:p-4 bg-black/50 border border-white/20 rounded-lg sm:rounded-xl text-white text-sm sm:text-base placeholder-gray-400 resize-none h-20 sm:h-24 mb-3 sm:mb-4 focus:outline-none focus:border-red-500"}),S.jsxs("button",{onClick:se,disabled:!u.trim()||f===0,className:"flex items-center gap-2 px-4 sm:px-6 py-2 sm:py-3 bg-red-600 hover:bg-red-700 disabled:bg-gray-600 disabled:cursor-not-allowed rounded-lg sm:rounded-xl text-sm sm:text-base font-bold transition-all hover:scale-102 active:scale-98",children:[S.jsx("div",{className:"text-white",children:S.jsx(QP,{size:14,className:"sm:w-4 sm:h-4"})}),"Post Review"]})]}),S.jsx("div",{className:"space-y-4 sm:space-y-6",children:o.map((U,ne)=>S.jsx("div",{className:"bg-white/5 backdrop-blur-md rounded-xl sm:rounded-2xl p-4 sm:p-6 border border-white/10",children:S.jsxs("div",{className:"flex items-start gap-3 sm:gap-4",children:[S.jsx("img",{src:U.avatar,alt:U.user,className:"w-10 h-10 sm:w-12 sm:h-12 rounded-full object-cover flex-shrink-0"}),S.jsxs("div",{className:"flex-1 min-w-0",children:[S.jsxs("div",{className:"flex items-center justify-between mb-2 gap-2",children:[S.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0",children:[S.jsx("h4",{className:"font-bold text-white text-sm sm:text-base truncate",children:U.user}),S.jsx("div",{className:"flex items-center flex-shrink-0",children:[...Array(5)].map((q,te)=>S.jsx("span",{className:`text-xs sm:text-sm ${te<U.rating?"text-yellow-400":"text-gray-600"}`,children:""},te))})]}),S.jsx("span",{className:"text-gray-400 text-xs sm:text-sm whitespace-nowrap",children:U.timestamp})]}),S.jsx("p",{className:"text-gray-300 text-sm sm:text-base mb-3 sm:mb-4 leading-relaxed",children:U.text}),S.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[S.jsxs("button",{className:"flex items-center gap-1.5 sm:gap-2 text-gray-400 hover:text-green-400 transition-colors text-sm",children:[S.jsx("div",{children:S.jsx(eD,{size:14,className:"sm:w-4 sm:h-4"})}),S.jsx("span",{children:U.likes})]}),S.jsxs("button",{className:"flex items-center gap-1.5 sm:gap-2 text-gray-400 hover:text-red-400 transition-colors text-sm",children:[S.jsx("div",{children:S.jsx(ZP,{size:14,className:"sm:w-4 sm:h-4"})}),S.jsx("span",{children:U.dislikes})]})]})]})]})},U.id))})]})})]}):S.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center",children:S.jsx("p",{className:"text-white text-xl",children:"Movie not found"})})},fO=n=>We.get(n).then(e=>e.data),hO=[{id:28,name:"Action"},{id:12,name:"Adventure"},{id:16,name:"Animation"},{id:35,name:"Comedy"},{id:80,name:"Crime"},{id:99,name:"Documentary"},{id:18,name:"Drama"},{id:10751,name:"Family"},{id:14,name:"Fantasy"},{id:36,name:"History"},{id:27,name:"Horror"},{id:10402,name:"Music"},{id:9648,name:"Mystery"},{id:10749,name:"Romance"},{id:878,name:"Sci-Fi"},{id:10770,name:"TV Movie"},{id:53,name:"Thriller"},{id:10752,name:"War"},{id:37,name:"Western"}],mO=Array.from({length:55},(n,e)=>2025-e),pO=()=>{const n=qt(),[e,t]=N.useState(null),[r,s]=N.useState(null),[i,o]=N.useState(1),l=()=>{let g=`${et.TMDB_BASE_URL}/discover/movie?api_key=${et.TMDB_API_KEY}&page=${i}&sort_by=popularity.desc`;return e&&(g+=`&with_genres=${e}`),r&&(g+=`&primary_release_year=${r}`),g},{data:u,error:d,isLoading:f}=$r(l(),fO);N.useEffect(()=>{o(1)},[e,r]);const h=u?.results||[],p=g=>{n(`/movie/${g}`)},x=()=>{o(g=>g+1)};return S.jsx("div",{className:"min-h-screen bg-black pt-20 pb-16",children:S.jsxs("div",{className:"max-w-7xl mx-auto px-4 md:px-6",children:[S.jsxs("div",{className:"mb-8",children:[S.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white mb-4",children:"Movies"}),S.jsx("p",{className:"text-gray-400 text-lg",children:"Explore thousands of movies"})]}),S.jsxs("div",{className:"flex flex-wrap gap-4 mb-8",children:[S.jsxs("div",{className:"relative",children:[S.jsxs("select",{value:e||"",onChange:g=>t(g.target.value?Number(g.target.value):null),className:"appearance-none bg-neutral-800 text-white px-4 py-2.5 pr-10 rounded-lg border border-neutral-700 focus:outline-none focus:border-red-600 cursor-pointer",children:[S.jsx("option",{value:"",children:"All Genres"}),hO.map(g=>S.jsx("option",{value:g.id,children:g.name},g.id))]}),S.jsx(iu,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"})]}),S.jsxs("div",{className:"relative",children:[S.jsxs("select",{value:r||"",onChange:g=>s(g.target.value?Number(g.target.value):null),className:"appearance-none bg-neutral-800 text-white px-4 py-2.5 pr-10 rounded-lg border border-neutral-700 focus:outline-none focus:border-red-600 cursor-pointer",children:[S.jsx("option",{value:"",children:"All Years"}),mO.map(g=>S.jsx("option",{value:g,children:g},g))]}),S.jsx(iu,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"})]}),(e||r)&&S.jsx("button",{onClick:()=>{t(null),s(null)},className:"px-4 py-2.5 bg-red-600 hover:bg-red-700 text-white rounded-lg transition",children:"Clear Filters"})]}),f&&S.jsx("div",{className:"flex justify-center items-center py-20",children:S.jsx("div",{className:"w-12 h-12 border-4 border-red-600 border-t-transparent rounded-full animate-spin"})}),d&&S.jsx("div",{className:"text-center py-20",children:S.jsx("p",{className:"text-red-500 text-xl",children:"Failed to load movies"})}),!f&&!d&&h.length>0&&S.jsxs(S.Fragment,{children:[S.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 md:gap-6",children:h.map(g=>S.jsxs("div",{onClick:()=>p(g.id),className:"group cursor-pointer",children:[S.jsxs("div",{className:"relative aspect-[2/3] rounded-lg overflow-hidden bg-neutral-800",children:[g.poster_path?S.jsx("img",{src:`https://image.tmdb.org/t/p/w500${g.poster_path}`,alt:g.title,className:"w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-500",loading:"lazy"}):S.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-500",children:"No Image"}),S.jsxs("div",{className:"absolute inset-0 bg-black/80 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col items-center justify-center gap-3 p-4",children:[S.jsx("button",{className:"p-3 bg-white text-black rounded-full hover:scale-110 transition",children:S.jsx(nr,{size:20})}),S.jsxs("div",{className:"text-center",children:[S.jsx("p",{className:"text-white font-semibold text-sm line-clamp-2",children:g.title}),g.vote_average>0&&S.jsxs("p",{className:"text-yellow-400 text-xs mt-1",children:[" ",g.vote_average.toFixed(1)]})]})]})]}),S.jsxs("div",{className:"mt-2",children:[S.jsx("h3",{className:"text-white font-medium text-sm line-clamp-1",children:g.title}),g.release_date&&S.jsx("p",{className:"text-gray-400 text-xs mt-1",children:g.release_date.split("-")[0]})]})]},g.id))}),h.length>=20&&S.jsx("div",{className:"text-center mt-12",children:S.jsx("button",{onClick:x,className:"px-8 py-3 bg-neutral-800 hover:bg-neutral-700 text-white rounded-lg transition",children:"Load More"})})]}),!f&&!d&&h.length===0&&S.jsx("div",{className:"text-center py-20",children:S.jsx("p",{className:"text-gray-400 text-xl",children:"No movies found"})})]})})},gO=n=>We.get(n).then(e=>e.data),yO=[{id:10759,name:"Action & Adventure"},{id:16,name:"Animation"},{id:35,name:"Comedy"},{id:80,name:"Crime"},{id:99,name:"Documentary"},{id:18,name:"Drama"},{id:10751,name:"Family"},{id:10762,name:"Kids"},{id:9648,name:"Mystery"},{id:10763,name:"News"},{id:10764,name:"Reality"},{id:10765,name:"Sci-Fi & Fantasy"},{id:10766,name:"Soap"},{id:10767,name:"Talk"},{id:10768,name:"War & Politics"},{id:37,name:"Western"}],xO=Array.from({length:55},(n,e)=>2025-e),vO=()=>{const n=qt(),[e,t]=N.useState(null),[r,s]=N.useState(null),[i,o]=N.useState(1),l=()=>{let g=`${et.TMDB_BASE_URL}/discover/tv?api_key=${et.TMDB_API_KEY}&page=${i}&sort_by=popularity.desc`;return e&&(g+=`&with_genres=${e}`),r&&(g+=`&first_air_date_year=${r}`),g},{data:u,error:d,isLoading:f}=$r(l(),gO);N.useEffect(()=>{o(1)},[e,r]);const h=u?.results||[],p=g=>{n(`/tv/${g}`)},x=()=>{o(g=>g+1)};return S.jsx("div",{className:"min-h-screen bg-black pt-20 pb-16",children:S.jsxs("div",{className:"max-w-7xl mx-auto px-4 md:px-6",children:[S.jsxs("div",{className:"mb-8",children:[S.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white mb-4",children:"TV Series"}),S.jsx("p",{className:"text-gray-400 text-lg",children:"Discover your next binge-worthy series"})]}),S.jsxs("div",{className:"flex flex-wrap gap-4 mb-8",children:[S.jsxs("div",{className:"relative",children:[S.jsxs("select",{value:e||"",onChange:g=>t(g.target.value?Number(g.target.value):null),className:"appearance-none bg-neutral-800 text-white px-4 py-2.5 pr-10 rounded-lg border border-neutral-700 focus:outline-none focus:border-red-600 cursor-pointer",children:[S.jsx("option",{value:"",children:"All Genres"}),yO.map(g=>S.jsx("option",{value:g.id,children:g.name},g.id))]}),S.jsx(iu,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"})]}),S.jsxs("div",{className:"relative",children:[S.jsxs("select",{value:r||"",onChange:g=>s(g.target.value?Number(g.target.value):null),className:"appearance-none bg-neutral-800 text-white px-4 py-2.5 pr-10 rounded-lg border border-neutral-700 focus:outline-none focus:border-red-600 cursor-pointer",children:[S.jsx("option",{value:"",children:"All Years"}),xO.map(g=>S.jsx("option",{value:g,children:g},g))]}),S.jsx(iu,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"})]}),(e||r)&&S.jsx("button",{onClick:()=>{t(null),s(null)},className:"px-4 py-2.5 bg-red-600 hover:bg-red-700 text-white rounded-lg transition",children:"Clear Filters"})]}),f&&S.jsx("div",{className:"flex justify-center items-center py-20",children:S.jsx("div",{className:"w-12 h-12 border-4 border-red-600 border-t-transparent rounded-full animate-spin"})}),d&&S.jsx("div",{className:"text-center py-20",children:S.jsx("p",{className:"text-red-500 text-xl",children:"Failed to load TV series"})}),!f&&!d&&h.length>0&&S.jsxs(S.Fragment,{children:[S.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 md:gap-6",children:h.map(g=>S.jsxs("div",{onClick:()=>p(g.id),className:"group cursor-pointer",children:[S.jsxs("div",{className:"relative aspect-[2/3] rounded-lg overflow-hidden bg-neutral-800",children:[g.poster_path?S.jsx("img",{src:`https://image.tmdb.org/t/p/w500${g.poster_path}`,alt:g.name,className:"w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-500",loading:"lazy"}):S.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-500",children:"No Image"}),S.jsxs("div",{className:"absolute inset-0 bg-black/80 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col items-center justify-center gap-3 p-4",children:[S.jsx("button",{className:"p-3 bg-white text-black rounded-full hover:scale-110 transition",children:S.jsx(nr,{size:20})}),S.jsxs("div",{className:"text-center",children:[S.jsx("p",{className:"text-white font-semibold text-sm line-clamp-2",children:g.name}),g.vote_average>0&&S.jsxs("p",{className:"text-yellow-400 text-xs mt-1",children:[" ",g.vote_average.toFixed(1)]})]})]})]}),S.jsxs("div",{className:"mt-2",children:[S.jsx("h3",{className:"text-white font-medium text-sm line-clamp-1",children:g.name}),g.first_air_date&&S.jsx("p",{className:"text-gray-400 text-xs mt-1",children:g.first_air_date.split("-")[0]})]})]},g.id))}),h.length>=20&&S.jsx("div",{className:"text-center mt-12",children:S.jsx("button",{onClick:x,className:"px-8 py-3 bg-neutral-800 hover:bg-neutral-700 text-white rounded-lg transition",children:"Load More"})})]}),!f&&!d&&h.length===0&&S.jsx("div",{className:"text-center py-20",children:S.jsx("p",{className:"text-gray-400 text-xl",children:"No TV series found"})})]})})},ta=n=>We.get(n).then(e=>e.data),SO=()=>{const n=qt(),[e,t]=N.useState("trending"),r=()=>`${et.TMDB_BASE_URL}/trending/all/week?api_key=${et.TMDB_API_KEY}`,s=()=>`${et.TMDB_BASE_URL}/movie/now_playing?api_key=${et.TMDB_API_KEY}&region=US`,i=()=>`${et.TMDB_BASE_URL}/movie/top_rated?api_key=${et.TMDB_API_KEY}`,o=()=>`${et.TMDB_BASE_URL}/discover/movie?api_key=${et.TMDB_API_KEY}&with_original_language=hi&sort_by=popularity.desc&page=1`,l=()=>`${et.TMDB_BASE_URL}/discover/tv?api_key=${et.TMDB_API_KEY}&with_genres=16&with_keywords=210024|287501&with_original_language=ja&sort_by=popularity.desc&page=1`,{data:u,error:d,isLoading:f}=$r(e==="trending"?r():null,ta),{data:h,error:p,isLoading:x}=$r(e==="new"?s():null,ta),{data:g,error:E,isLoading:v}=$r(e==="topRated"?i():null,ta),{data:b,error:A,isLoading:L}=$r(e==="bollywood"?o():null,ta),{data:I,error:_,isLoading:F}=$r(e==="anime"?l():null,ta),C=()=>{switch(e){case"trending":return u?.results||[];case"new":return h?.results?.map(U=>({...U,media_type:"movie"}))||[];case"topRated":return g?.results?.map(U=>({...U,media_type:"movie"}))||[];case"bollywood":return b?.results?.map(U=>({...U,media_type:"movie"}))||[];case"anime":return I?.results?.map(U=>({...U,media_type:"tv"}))||[];default:return[]}},P=f||x||v||L||F,O=d||p||E||A||_,M=C(),H=U=>{n(`/${U.media_type}/${U.id}`)},Z=U=>U.title||U.name||"Untitled",se=U=>{const ne=U.release_date||U.first_air_date;return ne?ne.split("-")[0]:""};return S.jsx("div",{className:"min-h-screen bg-black pt-20 pb-16",children:S.jsxs("div",{className:"max-w-7xl mx-auto px-4 md:px-6",children:[S.jsxs("div",{className:"mb-8",children:[S.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white mb-4",children:"New & Popular"}),S.jsx("p",{className:"text-gray-400 text-lg",children:"What's trending and recently released"})]}),S.jsxs("div",{className:"flex gap-4 mb-8 border-b border-neutral-800",children:[S.jsxs("button",{onClick:()=>t("trending"),className:`pb-4 px-2 font-semibold transition relative ${e==="trending"?"text-white":"text-gray-400 hover:text-white"}`,children:[S.jsx(Tp,{className:"inline mr-2"}),"Trending",e==="trending"&&S.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-red-600 rounded-t"})]}),S.jsxs("button",{onClick:()=>t("new"),className:`pb-4 px-2 font-semibold transition relative ${e==="new"?"text-white":"text-gray-400 hover:text-white"}`,children:[S.jsx(nr,{className:"inline mr-2"}),"New Releases",e==="new"&&S.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-red-600 rounded-t"})]}),S.jsxs("button",{onClick:()=>t("topRated"),className:`pb-4 px-2 font-semibold transition relative ${e==="topRated"?"text-white":"text-gray-400 hover:text-white"}`,children:[S.jsx(Mu,{className:"inline mr-2"}),"Top Rated",e==="topRated"&&S.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-red-600 rounded-t"})]}),S.jsxs("button",{onClick:()=>t("bollywood"),className:`pb-4 px-2 font-semibold transition relative ${e==="bollywood"?"text-white":"text-gray-400 hover:text-white"}`,children:[S.jsx(Va,{className:"inline mr-2"}),"Bollywood",e==="bollywood"&&S.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-red-600 rounded-t"})]}),S.jsxs("button",{onClick:()=>t("anime"),className:`pb-4 px-2 font-semibold transition relative ${e==="anime"?"text-white":"text-gray-400 hover:text-white"}`,children:[S.jsx(tD,{className:"inline mr-2"}),"Anime",e==="anime"&&S.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-red-600 rounded-t"})]})]}),P&&S.jsx("div",{className:"flex justify-center items-center py-20",children:S.jsx("div",{className:"w-12 h-12 border-4 border-red-600 border-t-transparent rounded-full animate-spin"})}),O&&S.jsx("div",{className:"text-center py-20",children:S.jsx("p",{className:"text-red-500 text-xl",children:"Failed to load content"})}),!P&&!O&&M.length>0&&S.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 md:gap-6",children:M.map(U=>S.jsxs("div",{onClick:()=>H(U),className:"group cursor-pointer",children:[S.jsxs("div",{className:"relative aspect-[2/3] rounded-lg overflow-hidden bg-neutral-800",children:[U.poster_path?S.jsx("img",{src:`https://image.tmdb.org/t/p/w500${U.poster_path}`,alt:Z(U),className:"w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-500",loading:"lazy"}):S.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-500",children:"No Image"}),S.jsx("div",{className:"absolute top-2 right-2 px-2 py-1 bg-black/80 text-white text-xs font-semibold rounded",children:U.media_type==="tv"?"Series":"Movie"}),S.jsxs("div",{className:"absolute inset-0 bg-black/80 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col items-center justify-center gap-3 p-4",children:[S.jsx("button",{className:"p-3 bg-white text-black rounded-full hover:scale-110 transition",children:S.jsx(nr,{size:20})}),S.jsxs("div",{className:"text-center",children:[S.jsx("p",{className:"text-white font-semibold text-sm line-clamp-2",children:Z(U)}),U.vote_average>0&&S.jsxs("p",{className:"text-yellow-400 text-xs mt-1",children:[" ",U.vote_average.toFixed(1)]})]})]})]}),S.jsxs("div",{className:"mt-2",children:[S.jsx("h3",{className:"text-white font-medium text-sm line-clamp-1",children:Z(U)}),S.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[se(U)&&S.jsx("p",{className:"text-gray-400 text-xs",children:se(U)}),U.media_type&&S.jsxs("span",{className:"text-gray-500 text-xs",children:[" ",U.media_type==="tv"?"Series":"Movie"]})]})]})]},U.id))}),!P&&!O&&M.length===0&&S.jsx("div",{className:"text-center py-20",children:S.jsx("p",{className:"text-gray-400 text-xl",children:"No content available"})})]})})},he=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)},EO=Number.isSafeInteger||function(n){return typeof n=="number"&&Math.abs(n)<=TO},TO=Number.MAX_SAFE_INTEGER||9007199254740991;let we=(function(n){return n.NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n})({}),z=(function(n){return n.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",n.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",n.KEY_SYSTEM_NO_SESSION="keySystemNoSession",n.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",n.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",n.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",n.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",n.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",n.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",n.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",n.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",n.MANIFEST_LOAD_ERROR="manifestLoadError",n.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",n.MANIFEST_PARSING_ERROR="manifestParsingError",n.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",n.LEVEL_EMPTY_ERROR="levelEmptyError",n.LEVEL_LOAD_ERROR="levelLoadError",n.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",n.LEVEL_PARSING_ERROR="levelParsingError",n.LEVEL_SWITCH_ERROR="levelSwitchError",n.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",n.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",n.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",n.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",n.FRAG_LOAD_ERROR="fragLoadError",n.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",n.FRAG_DECRYPT_ERROR="fragDecryptError",n.FRAG_PARSING_ERROR="fragParsingError",n.FRAG_GAP="fragGap",n.REMUX_ALLOC_ERROR="remuxAllocError",n.KEY_LOAD_ERROR="keyLoadError",n.KEY_LOAD_TIMEOUT="keyLoadTimeOut",n.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",n.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",n.BUFFER_APPEND_ERROR="bufferAppendError",n.BUFFER_APPENDING_ERROR="bufferAppendingError",n.BUFFER_STALLED_ERROR="bufferStalledError",n.BUFFER_FULL_ERROR="bufferFullError",n.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",n.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",n.ASSET_LIST_LOAD_ERROR="assetListLoadError",n.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",n.ASSET_LIST_PARSING_ERROR="assetListParsingError",n.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",n.INTERNAL_EXCEPTION="internalException",n.INTERNAL_ABORTED="aborted",n.ATTACH_MEDIA_ERROR="attachMediaError",n.UNKNOWN="unknown",n})({}),R=(function(n){return n.MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.MEDIA_ENDED="hlsMediaEnded",n.STALL_RESOLVED="hlsStallResolved",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFERED_TO_END="hlsBufferedToEnd",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached",n.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",n.ASSET_LIST_LOADING="hlsAssetListLoading",n.ASSET_LIST_LOADED="hlsAssetListLoaded",n.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",n.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",n.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",n.INTERSTITIAL_STARTED="hlsInterstitialStarted",n.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",n.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",n.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",n.INTERSTITIAL_ENDED="hlsInterstitialEnded",n.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",n.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",n.EVENT_CUE_ENTER="hlsEventCueEnter",n})({});var Ge={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},ge={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Ni{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){const r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class bO{constructor(e,t,r,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Ni(e),this.fast_=new Ni(t),this.defaultTTFB_=s,this.ttfb_=new Ni(e)}update(e,t){const{slow_:r,fast_:s,ttfb_:i}=this;r.halfLife!==e&&(this.slow_=new Ni(e,r.getEstimate(),r.getTotalWeight())),s.halfLife!==t&&(this.fast_=new Ni(t,s.getEstimate(),s.getTotalWeight())),i.halfLife!==e&&(this.ttfb_=new Ni(e,i.getEstimate(),i.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const r=8*t,s=e/1e3,i=r/s;this.fast_.sample(s,i),this.slow_.sample(s,i)}sampleTTFB(e){const t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function wO(n,e,t){return(e=LO(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function tt(){return tt=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},tt.apply(null,arguments)}function Ov(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function Je(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ov(Object(t),!0).forEach(function(r){wO(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Ov(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function AO(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function LO(n){var e=AO(n,"string");return typeof e=="symbol"?e:e+""}class Vn{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const r=`[${e}]:`;this.trace=xs,this.debug=t.debug.bind(null,r),this.log=t.log.bind(null,r),this.warn=t.warn.bind(null,r),this.info=t.info.bind(null,r),this.error=t.error.bind(null,r)}}const xs=function(){},RO={trace:xs,debug:xs,log:xs,warn:xs,info:xs,error:xs};function bm(){return tt({},RO)}function IO(n,e){const t=self.console[n];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${n}] >`):xs}function Mv(n,e,t){return e[n]?e[n].bind(e):IO(n,t)}const wm=bm();function kO(n,e,t){const r=bm();if(typeof console=="object"&&n===!0||typeof n=="object"){const s=["debug","log","info","warn","error"];s.forEach(i=>{r[i]=Mv(i,n,t)});try{r.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return bm()}s.forEach(i=>{wm[i]=Mv(i,n)})}else tt(wm,r);return r}const Ze=wm;function Rs(n=!0){return typeof self>"u"?void 0:(n||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function CO(n){return typeof self<"u"&&n===self.ManagedMediaSource}function K1(n,e){const t=Object.keys(n),r=Object.keys(e),s=t.length,i=r.length;return!s||!i||s===i&&!t.some(o=>r.indexOf(o)===-1)}function In(n,e=!1){if(typeof TextDecoder<"u"){const d=new TextDecoder("utf-8").decode(n);if(e){const f=d.indexOf("\0");return f!==-1?d.substring(0,f):d}return d.replace(/\0/g,"")}const t=n.length;let r,s,i,o="",l=0;for(;l<t;){if(r=n[l++],r===0&&e)return o;if(r===0||r===3)continue;switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(r);break;case 12:case 13:s=n[l++],o+=String.fromCharCode((r&31)<<6|s&63);break;case 14:s=n[l++],i=n[l++],o+=String.fromCharCode((r&15)<<12|(s&63)<<6|(i&63)<<0);break}}return o}function $t(n){let e="";for(let t=0;t<n.length;t++){let r=n[t].toString(16);r.length<2&&(r="0"+r),e+=r}return e}function z1(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function _O(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var gh={exports:{}},Fv;function PO(){return Fv||(Fv=1,(function(n,e){(function(t){var r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,i=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,l={buildAbsoluteURL:function(u,d,f){if(f=f||{},u=u.trim(),d=d.trim(),!d){if(!f.alwaysNormalize)return u;var h=l.parseURL(u);if(!h)throw new Error("Error trying to parse base URL.");return h.path=l.normalizePath(h.path),l.buildURLFromParts(h)}var p=l.parseURL(d);if(!p)throw new Error("Error trying to parse relative URL.");if(p.scheme)return f.alwaysNormalize?(p.path=l.normalizePath(p.path),l.buildURLFromParts(p)):d;var x=l.parseURL(u);if(!x)throw new Error("Error trying to parse base URL.");if(!x.netLoc&&x.path&&x.path[0]!=="/"){var g=s.exec(x.path);x.netLoc=g[1],x.path=g[2]}x.netLoc&&!x.path&&(x.path="/");var E={scheme:x.scheme,netLoc:p.netLoc,path:null,params:p.params,query:p.query,fragment:p.fragment};if(!p.netLoc&&(E.netLoc=x.netLoc,p.path[0]!=="/"))if(!p.path)E.path=x.path,p.params||(E.params=x.params,p.query||(E.query=x.query));else{var v=x.path,b=v.substring(0,v.lastIndexOf("/")+1)+p.path;E.path=l.normalizePath(b)}return E.path===null&&(E.path=f.alwaysNormalize?l.normalizePath(p.path):p.path),l.buildURLFromParts(E)},parseURL:function(u){var d=r.exec(u);return d?{scheme:d[1]||"",netLoc:d[2]||"",path:d[3]||"",params:d[4]||"",query:d[5]||"",fragment:d[6]||""}:null},normalizePath:function(u){for(u=u.split("").reverse().join("").replace(i,"");u.length!==(u=u.replace(o,"")).length;);return u.split("").reverse().join("")},buildURLFromParts:function(u){return u.scheme+u.netLoc+u.path+u.params+u.query+u.fragment}};n.exports=l})()})(gh)),gh.exports}var Pp=PO();class Dp{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var rt={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class W1{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,NO(this,"stats")}setByteRange(e,t){const r=e.split("@",2);let s;r.length===1?s=t?.byteRangeEndOffset||0:s=parseInt(r[1]),this._byteRange=[s,parseInt(r[0])+s]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[rt.AUDIO]:null,[rt.VIDEO]:null,[rt.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Dp),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Pp.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[rt.AUDIO]=null,e[rt.VIDEO]=null,e[rt.AUDIOVIDEO]=null}}function Tt(n){return n.sn!=="initSegment"}class yh extends W1{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(he(e)&&he(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const r=Object.keys(t);if(r.length===1){const s=this._decryptdata=t[r[0]]||null;s&&(this._decryptdata=s.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=he(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const r=Object.keys(this.levelkeys),s=r.length;if(s>1||s===1&&(t=this.levelkeys[r[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!he(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Tt(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var r;const s=t[e];s&&!((r=this._decryptdata)!=null&&r.keyId)&&(this._decryptdata=s.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,r,s,i,o=!1){const{elementaryStreams:l}=this,u=l[e];if(!u){l[e]={startPTS:t,endPTS:r,startDTS:s,endDTS:i,partial:o};return}u.startPTS=Math.min(u.startPTS,t),u.endPTS=Math.max(u.endPTS,r),u.startDTS=Math.min(u.startDTS,s),u.endDTS=Math.max(u.endDTS,i)}}class DO extends W1{constructor(e,t,r,s,i){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=s;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,i),i&&(this.fragOffset=i.fragOffset+i.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function Y1(n,e){const t=Object.getPrototypeOf(n);if(t){const r=Object.getOwnPropertyDescriptor(t,e);return r||Y1(t,e)}}function NO(n,e){const t=Y1(n,e);t&&(t.enumerable=!0,Object.defineProperty(n,e,t))}const Bv=Math.pow(2,32)-1,OO=[].push,q1={video:1,audio:2,id3:3,text:4};function kt(n){return String.fromCharCode.apply(null,n)}function X1(n,e){const t=n[e]<<8|n[e+1];return t<0?65536+t:t}function Ne(n,e){const t=Q1(n,e);return t<0?4294967296+t:t}function Uv(n,e){let t=Ne(n,e);return t*=Math.pow(2,32),t+=Ne(n,e+4),t}function Q1(n,e){return n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3]}function MO(n){const e=n.byteLength;for(let t=0;t<e;){const r=Ne(n,t);if(r>8&&n[t+4]===109&&n[t+5]===111&&n[t+6]===111&&n[t+7]===102)return!0;t=r>1?t+r:e}return!1}function Ue(n,e){const t=[];if(!e.length)return t;const r=n.byteLength;for(let s=0;s<r;){const i=Ne(n,s),o=kt(n.subarray(s+4,s+8)),l=i>1?s+i:r;if(o===e[0])if(e.length===1)t.push(n.subarray(s+8,l));else{const u=Ue(n.subarray(s+8,l),e.slice(1));u.length&&OO.apply(t,u)}s=l}return t}function FO(n){const e=[],t=n[0];let r=8;const s=Ne(n,r);r+=4;let i=0,o=0;t===0?(i=Ne(n,r),o=Ne(n,r+4),r+=8):(i=Uv(n,r),o=Uv(n,r+8),r+=16),r+=2;let l=n.length+o;const u=X1(n,r);r+=2;for(let d=0;d<u;d++){let f=r;const h=Ne(n,f);f+=4;const p=h&2147483647;if((h&2147483648)>>>31===1)return Ze.warn("SIDX has hierarchical references (not supported)"),null;const g=Ne(n,f);f+=4,e.push({referenceSize:p,subsegmentDuration:g,info:{duration:g/s,start:l,end:l+p-1}}),l+=p,f+=4,r=f}return{earliestPresentationTime:i,timescale:s,version:t,referencesCount:u,references:e}}function J1(n){const e=[],t=Ue(n,["moov","trak"]);for(let s=0;s<t.length;s++){const i=t[s],o=Ue(i,["tkhd"])[0];if(o){let l=o[0];const u=Ne(o,l===0?12:20),d=Ue(i,["mdia","mdhd"])[0];if(d){l=d[0];const f=Ne(d,l===0?12:20),h=Ue(i,["mdia","hdlr"])[0];if(h){const p=kt(h.subarray(8,12)),x={soun:rt.AUDIO,vide:rt.VIDEO}[p],g=Ue(i,["mdia","minf","stbl","stsd"])[0],E=BO(g);x?(e[u]={timescale:f,type:x,stsd:E},e[x]=Je({timescale:f,id:u},E)):e[u]={timescale:f,type:p,stsd:E}}}}}return Ue(n,["moov","mvex","trex"]).forEach(s=>{const i=Ne(s,4),o=e[i];o&&(o.default={duration:Ne(s,12),flags:Ne(s,20)})}),e}function BO(n){const e=n.subarray(8),t=e.subarray(86),r=kt(e.subarray(4,8));let s=r,i;const o=r==="enca"||r==="encv";if(o){const d=Ue(e,[r])[0].subarray(r==="enca"?28:78);Ue(d,["sinf"]).forEach(h=>{const p=Ue(h,["schm"])[0];if(p){const x=kt(p.subarray(4,8));if(x==="cbcs"||x==="cenc"){const g=Ue(h,["frma"])[0];g&&(s=kt(g))}}})}const l=s;switch(s){case"avc1":case"avc2":case"avc3":case"avc4":{const u=Ue(t,["avcC"])[0];u&&u.length>3&&(s+="."+gc(u[1])+gc(u[2])+gc(u[3]),i=pc(l==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const u=Ue(e,[r])[0],d=Ue(u.subarray(28),["esds"])[0];if(d&&d.length>7){let f=4;if(d[f++]!==3)break;f=xh(d,f),f+=2;const h=d[f++];if(h&128&&(f+=2),h&64&&(f+=d[f++]),d[f++]!==4)break;f=xh(d,f);const p=d[f++];if(p===64)s+="."+gc(p);else break;if(f+=12,d[f++]!==5)break;f=xh(d,f);const x=d[f++];let g=(x&248)>>3;g===31&&(g+=1+((x&7)<<3)+((d[f]&224)>>5)),s+="."+g}break}case"hvc1":case"hev1":{const u=Ue(t,["hvcC"])[0];if(u&&u.length>12){const d=u[1],f=["","A","B","C"][d>>6],h=d&31,p=Ne(u,2),x=(d&32)>>5?"H":"L",g=u[12],E=u.subarray(6,12);s+="."+f+h,s+="."+UO(p).toString(16).toUpperCase(),s+="."+x+g;let v="";for(let b=E.length;b--;){const A=E[b];(A||v)&&(v="."+A.toString(16).toUpperCase()+v)}s+=v}i=pc(l=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{s=pc(s,t)||s;break}case"vp09":{const u=Ue(t,["vpcC"])[0];if(u&&u.length>6){const d=u[4],f=u[5],h=u[6]>>4&15;s+="."+mr(d)+"."+mr(f)+"."+mr(h)}break}case"av01":{const u=Ue(t,["av1C"])[0];if(u&&u.length>2){const d=u[1]>>>5,f=u[1]&31,h=u[2]>>>7?"H":"M",p=(u[2]&64)>>6,x=(u[2]&32)>>5,g=d===2&&p?x?12:10:p?10:8,E=(u[2]&16)>>4,v=(u[2]&8)>>3,b=(u[2]&4)>>2,A=u[2]&3;s+="."+d+"."+mr(f)+h+"."+mr(g)+"."+E+"."+v+b+A+"."+mr(1)+"."+mr(1)+"."+mr(1)+"."+0,i=pc("dav1",t)}break}}return{codec:s,encrypted:o,supplemental:i}}function pc(n,e){const t=Ue(e,["dvvC"]),r=t.length?t[0]:Ue(e,["dvcC"])[0];if(r){const s=r[2]>>1&127,i=r[2]<<5&32|r[3]>>3&31;return n+"."+mr(s)+"."+mr(i)}}function UO(n){let e=0;for(let t=0;t<32;t++)e|=(n>>t&1)<<31-t;return e>>>0}function xh(n,e){const t=e+5;for(;n[e++]&128&&e<t;);return e}function gc(n){return("0"+n.toString(16).toUpperCase()).slice(-2)}function mr(n){return(n<10?"0":"")+n}function $O(n,e){if(!n||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&Z1(n,(r,s)=>{const i=r.subarray(8,24);i.some(o=>o!==0)||(Ze.log(`[eme] Patching keyId in 'enc${s?"a":"v"}>sinf>>tenc' box: ${$t(i)} -> ${$t(t)}`),r.set(t,8))})}function jO(n){const e=[];return Z1(n,t=>e.push(t.subarray(8,24))),e}function Z1(n,e){Ue(n,["moov","trak"]).forEach(r=>{const s=Ue(r,["mdia","minf","stbl","stsd"])[0];if(!s)return;const i=s.subarray(8);let o=Ue(i,["enca"]);const l=o.length>0;l||(o=Ue(i,["encv"])),o.forEach(u=>{const d=l?u.subarray(28):u.subarray(78);Ue(d,["sinf"]).forEach(h=>{const p=eb(h);p&&e(p,l)})})})}function eb(n){const e=Ue(n,["schm"])[0];if(e){const t=kt(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const r=Ue(n,["schi","tenc"])[0];if(r)return r}}}function VO(n,e,t){const r={},s=Ue(n,["moof","traf"]);for(let i=0;i<s.length;i++){const o=s[i],l=Ue(o,["tfhd"])[0],u=Ne(l,4),d=e[u];if(!d)continue;r[u]||(r[u]={start:NaN,duration:0,sampleCount:0,timescale:d.timescale,type:d.type});const f=r[u],h=Ue(o,["tfdt"])[0];if(h){const L=h[0];let I=Ne(h,4);L===1&&(I===Bv?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(I*=Bv+1,I+=Ne(h,8))),he(I)&&(!he(f.start)||I<f.start)&&(f.start=I)}const p=d.default,x=Ne(l,0)|p?.flags;let g=p?.duration||0;x&8&&(x&2?g=Ne(l,12):g=Ne(l,8));const E=Ue(o,["trun"]);let v=f.start||0,b=0,A=g;for(let L=0;L<E.length;L++){const I=E[L],_=Ne(I,4),F=f.sampleCount;f.sampleCount+=_;const C=I[3]&1,P=I[3]&4,O=I[2]&1,M=I[2]&2,H=I[2]&4,Z=I[2]&8;let se=8,U=_;for(C&&(se+=4),P&&_&&(!(I[se+1]&1)&&f.keyFrameIndex===void 0&&(f.keyFrameIndex=F),se+=4,O?(A=Ne(I,se),se+=4):A=g,M&&(se+=4),Z&&(se+=4),v+=A,b+=A,U--);U--;)O?(A=Ne(I,se),se+=4):A=g,M&&(se+=4),H&&(I[se+1]&1||f.keyFrameIndex===void 0&&(f.keyFrameIndex=f.sampleCount-(U+1),f.keyFrameStart=v),se+=4),Z&&(se+=4),v+=A,b+=A;!b&&g&&(b+=g*_)}f.duration+=b}if(!Object.keys(r).some(i=>r[i].duration)){let i=1/0,o=0;const l=Ue(n,["sidx"]);for(let u=0;u<l.length;u++){const d=FO(l[u]);if(d!=null&&d.references){i=Math.min(i,d.earliestPresentationTime/d.timescale);const f=d.references.reduce((h,p)=>h+p.info.duration||0,0);o=Math.max(o,f+d.earliestPresentationTime/d.timescale)}}o&&he(o)&&Object.keys(r).forEach(u=>{r[u].duration||(r[u].duration=o*r[u].timescale-r[u].start)})}return r}function GO(n){const e={valid:null,remainder:null},t=Ue(n,["moof"]);if(t.length<2)return e.remainder=n,e;const r=t[t.length-1];return e.valid=n.slice(0,r.byteOffset-8),e.remainder=n.slice(r.byteOffset-8),e}function $n(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function $v(n,e){const t=[],r=e.samples,s=e.timescale,i=e.id;let o=!1;return Ue(r,["moof"]).map(u=>{const d=u.byteOffset-8;Ue(u,["traf"]).map(h=>{const p=Ue(h,["tfdt"]).map(x=>{const g=x[0];let E=Ne(x,4);return g===1&&(E*=Math.pow(2,32),E+=Ne(x,8)),E/s})[0];return p!==void 0&&(n=p),Ue(h,["tfhd"]).map(x=>{const g=Ne(x,4),E=Ne(x,0)&16777215,v=(E&1)!==0,b=(E&2)!==0,A=(E&8)!==0;let L=0;const I=(E&16)!==0;let _=0;const F=(E&32)!==0;let C=8;g===i&&(v&&(C+=8),b&&(C+=4),A&&(L=Ne(x,C),C+=4),I&&(_=Ne(x,C),C+=4),F&&(C+=4),e.type==="video"&&(o=zu(e.codec)),Ue(h,["trun"]).map(P=>{const O=P[0],M=Ne(P,0)&16777215,H=(M&1)!==0;let Z=0;const se=(M&4)!==0,U=(M&256)!==0;let ne=0;const q=(M&512)!==0;let te=0;const G=(M&1024)!==0,Q=(M&2048)!==0;let ee=0;const D=Ne(P,4);let $=8;H&&(Z=Ne(P,$),$+=4),se&&($+=4);let ie=Z+d;for(let ce=0;ce<D;ce++){if(U?(ne=Ne(P,$),$+=4):ne=L,q?(te=Ne(P,$),$+=4):te=_,G&&($+=4),Q&&(O===0?ee=Ne(P,$):ee=Q1(P,$),$+=4),e.type===rt.VIDEO){let ue=0;for(;ue<te;){const fe=Ne(r,ie);if(ie+=4,HO(o,r[ie])){const Ee=r.subarray(ie,ie+fe);Np(Ee,o?2:1,n+ee/s,t)}ie+=fe,ue+=fe+4}}n+=ne/s}}))})})}),t}function zu(n){if(!n)return!1;const e=n.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function HO(n,e){if(n){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Np(n,e,t,r){const s=tb(n);let i=0;i+=e;let o=0,l=0,u=0;for(;i<s.length;){o=0;do{if(i>=s.length)break;u=s[i++],o+=u}while(u===255);l=0;do{if(i>=s.length)break;u=s[i++],l+=u}while(u===255);const d=s.length-i;let f=i;if(l<d)i+=l;else if(l>d){Ze.error(`Malformed SEI payload. ${l} is too small, only ${d} bytes left to parse.`);break}if(o===4){if(s[f++]===181){const p=X1(s,f);if(f+=2,p===49){const x=Ne(s,f);if(f+=4,x===1195456820){const g=s[f++];if(g===3){const E=s[f++],v=31&E,b=64&E,A=b?2+v*3:0,L=new Uint8Array(A);if(b){L[0]=E;for(let I=1;I<A;I++)L[I]=s[f++]}r.push({type:g,payloadType:o,pts:t,bytes:L})}}}}}else if(o===5&&l>16){const h=[];for(let g=0;g<16;g++){const E=s[f++].toString(16);h.push(E.length==1?"0"+E:E),(g===3||g===5||g===7||g===9)&&h.push("-")}const p=l-16,x=new Uint8Array(p);for(let g=0;g<p;g++)x[g]=s[f++];r.push({payloadType:o,pts:t,uuid:h.join(""),userData:In(x),userDataBytes:x})}}}function tb(n){const e=n.byteLength,t=[];let r=1;for(;r<e-2;)n[r]===0&&n[r+1]===0&&n[r+2]===3?(t.push(r+2),r+=2):r++;if(t.length===0)return n;const s=e-t.length,i=new Uint8Array(s);let o=0;for(r=0;r<s;o++,r++)o===t[0]&&(o++,t.shift()),i[r]=n[o];return i}function KO(n){const e=n[0];let t="",r="",s=0,i=0,o=0,l=0,u=0,d=0;if(e===0){for(;kt(n.subarray(d,d+1))!=="\0";)t+=kt(n.subarray(d,d+1)),d+=1;for(t+=kt(n.subarray(d,d+1)),d+=1;kt(n.subarray(d,d+1))!=="\0";)r+=kt(n.subarray(d,d+1)),d+=1;r+=kt(n.subarray(d,d+1)),d+=1,s=Ne(n,12),i=Ne(n,16),l=Ne(n,20),u=Ne(n,24),d=28}else if(e===1){d+=4,s=Ne(n,d),d+=4;const h=Ne(n,d);d+=4;const p=Ne(n,d);for(d+=4,o=2**32*h+p,EO(o)||(o=Number.MAX_SAFE_INTEGER,Ze.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),l=Ne(n,d),d+=4,u=Ne(n,d),d+=4;kt(n.subarray(d,d+1))!=="\0";)t+=kt(n.subarray(d,d+1)),d+=1;for(t+=kt(n.subarray(d,d+1)),d+=1;kt(n.subarray(d,d+1))!=="\0";)r+=kt(n.subarray(d,d+1)),d+=1;r+=kt(n.subarray(d,d+1)),d+=1}const f=n.subarray(d,n.byteLength);return{schemeIdUri:t,value:r,timeScale:s,presentationTime:o,presentationTimeDelta:i,eventDuration:l,id:u,payload:f}}function zO(n,...e){const t=e.length;let r=8,s=t;for(;s--;)r+=e[s].byteLength;const i=new Uint8Array(r);for(i[0]=r>>24&255,i[1]=r>>16&255,i[2]=r>>8&255,i[3]=r&255,i.set(n,4),s=0,r=8;s<t;s++)i.set(e[s],r),r+=e[s].byteLength;return i}function WO(n,e,t){if(n.byteLength!==16)throw new RangeError("Invalid system id");let r,s;r=0,s=new Uint8Array;let i;r>0?(i=new Uint8Array(4),e.length>0&&new DataView(i.buffer).setUint32(0,e.length,!1)):i=new Uint8Array;const o=new Uint8Array(4);return t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),zO([112,115,115,104],new Uint8Array([r,0,0,0]),n,i,s,o,t)}function YO(n){const e=[];if(n instanceof ArrayBuffer){const t=n.byteLength;let r=0;for(;r+32<t;){const s=new DataView(n,r),i=qO(s);e.push(i),r+=i.size}}return e}function qO(n){const e=n.getUint32(0),t=n.byteOffset,r=n.byteLength;if(r<e)return{offset:t,size:r};if(n.getUint32(4)!==1886614376)return{offset:t,size:e};const i=n.getUint32(8)>>>24;if(i!==0&&i!==1)return{offset:t,size:e};const o=n.buffer,l=$t(new Uint8Array(o,t+12,16));let u=null,d=null,f=0;if(i===0)f=28;else{const p=n.getUint32(28);if(!p||r<32+p*16)return{offset:t,size:e};u=[];for(let x=0;x<p;x++)u.push(new Uint8Array(o,t+32+x*16,16));f=32+p*16}if(!f)return{offset:t,size:e};const h=n.getUint32(f);return e-32<h?{offset:t,size:e}:(d=new Uint8Array(o,t+f+4,h),{version:i,systemId:l,kids:u,data:d,offset:t,size:e})}const nb=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Ji={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Op(n,e){const t=Ji[e];return!!t&&!!t[n.slice(0,4)]}function Aa(n,e,t=!0){return!n.split(",").some(r=>!Mp(r,e,t))}function Mp(n,e,t=!0){var r;const s=Rs(t);return(r=s?.isTypeSupported(La(n,e)))!=null?r:!1}function La(n,e){return`${e}/mp4;codecs=${n}`}function jv(n){if(n){const e=n.substring(0,4);return Ji.video[e]}return 2}function uu(n){const e=nb();return n.split(",").reduce((t,r)=>{const i=e&&zu(r)?9:Ji.video[r];return i?(i*2+t)/(t?3:2):(Ji.audio[r]+t)/(t?2:1)},0)}const vh={};function XO(n,e=!0){if(vh[n])return vh[n];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[n];for(let s=0;s<t.length;s++){var r;if(Mp(t[s],"audio",e))return vh[n]=t[s],t[s];if(t[s]==="mp3"&&(r=Rs(e))!=null&&r.isTypeSupported("audio/mpeg"))return""}return n}const QO=/flac|opus|mp4a\.40\.34/i;function du(n,e=!0){return n.replace(QO,t=>XO(t.toLowerCase(),e))}function JO(n,e){const t=[];if(n){const r=n.split(",");for(let s=0;s<r.length;s++)Op(r[s],"video")||t.push(r[s])}return e&&t.push(e),t.join(",")}function jc(n,e){if(n&&(n.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(n)!==-1)&&(Vv(n,"audio")||Vv(n,"video")))return n;if(e){const t=e.split(",");if(t.length>1){if(n){for(let r=t.length;r--;)if(t[r].substring(0,4)===n.substring(0,4))return t[r]}return t[0]}}return e||n}function Vv(n,e){return Op(n,e)&&Mp(n,e)}function ZO(n){const e=n.split(",");for(let t=0;t<e.length;t++){const r=e[t].split(".");r.length>2&&r[0]==="avc1"&&(e[t]=`avc1.${parseInt(r[1]).toString(16)}${("000"+parseInt(r[2]).toString(16)).slice(-4)}`)}return e.join(",")}function eM(n){if(n.startsWith("av01.")){const e=n.split("."),t=["0","111","01","01","01","0"];for(let r=e.length;r>4&&r<10;r++)e[r]=t[r-4];return e.join(".")}return n}function Gv(n){const e=Rs(n)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Am(n){return n.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const tM={supported:!0,powerEfficient:!0,smooth:!0},nM={supported:!1,smooth:!1,powerEfficient:!1},rb={supported:!0,configurations:[],decodingInfoResults:[tM]};function sb(n,e){return{supported:!1,configurations:e,decodingInfoResults:[nM],error:n}}function rM(n,e,t,r,s,i){const o=n.videoCodec,l=n.audioCodec?n.audioGroups:null,u=i?.audioCodec,d=i?.channels,f=d?parseInt(d):u?1/0:2;let h=null;if(l!=null&&l.length)try{l.length===1&&l[0]?h=e.groups[l[0]].channels:h=l.reduce((p,x)=>{if(x){const g=e.groups[x];if(!g)throw new Error(`Audio track group ${x} not found`);Object.keys(g.channels).forEach(E=>{p[E]=(p[E]||0)+g.channels[E]})}return p},{2:0})}catch{return!0}return o!==void 0&&(o.split(",").some(p=>zu(p))||n.width>1920&&n.height>1088||n.height>1920&&n.width>1088||n.frameRate>Math.max(r,30)||n.videoRange!=="SDR"&&n.videoRange!==t||n.bitrate>Math.max(s,8e6))||!!h&&he(f)&&Object.keys(h).some(p=>parseInt(p)>f)}function ib(n,e,t,r={}){const s=n.videoCodec;if(!s&&!n.audioCodec||!t)return Promise.resolve(rb);const i=[],o=sM(n),l=o.length,u=iM(n,e,l>0),d=u.length;for(let f=l||1*d||1;f--;){const h={type:"media-source"};if(l&&(h.video=o[f%l]),d){h.audio=u[f%d];const p=h.audio.bitrate;h.video&&p&&(h.video.bitrate-=p)}i.push(h)}if(s){const f=navigator.userAgent;if(s.split(",").some(h=>zu(h))&&nb())return Promise.resolve(sb(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${f})`),i))}return Promise.all(i.map(f=>{const h=aM(f);return r[h]||(r[h]=t.decodingInfo(f))})).then(f=>({supported:!f.some(h=>!h.supported),configurations:i,decodingInfoResults:f})).catch(f=>({supported:!1,configurations:i,decodingInfoResults:[],error:f}))}function sM(n){var e;const t=(e=n.videoCodec)==null?void 0:e.split(","),r=ob(n),s=n.width||640,i=n.height||480,o=n.frameRate||30,l=n.videoRange.toLowerCase();return t?t.map(u=>{const d={contentType:La(eM(u),"video"),width:s,height:i,bitrate:r,framerate:o};return l!=="sdr"&&(d.transferFunction=l),d}):[]}function iM(n,e,t){var r;const s=(r=n.audioCodec)==null?void 0:r.split(","),i=ob(n);return s&&n.audioGroups?n.audioGroups.reduce((o,l)=>{var u;const d=l?(u=e.groups[l])==null?void 0:u.tracks:null;return d?d.reduce((f,h)=>{if(h.groupId===l){const p=parseFloat(h.channels||"");s.forEach(x=>{const g={contentType:La(x,"audio"),bitrate:t?oM(x,i):i};p&&(g.channels=""+p),f.push(g)})}return f},o):o},[]):[]}function oM(n,e){if(e<=1)return 1;let t=128e3;return n==="ec-3"?t=768e3:n==="ac-3"&&(t=64e4),Math.min(e/2,t)}function ob(n){return Math.ceil(Math.max(n.bitrate*.9,n.averageBitrate)/1e3)*1e3||1}function aM(n){let e="";const{audio:t,video:r}=n;if(r){const s=Am(r.contentType);e+=`${s}_r${r.height}x${r.width}f${Math.ceil(r.framerate)}${r.transferFunction||"sd"}_${Math.ceil(r.bitrate/1e5)}`}if(t){const s=Am(t.contentType);e+=`${r?"_":""}${s}_c${t.channels}`}return e}const Lm=["NONE","TYPE-0","TYPE-1",null];function lM(n){return Lm.indexOf(n)>-1}const fu=["SDR","PQ","HLG"];function cM(n){return!!n&&fu.indexOf(n)>-1}var Vc={No:"",Yes:"YES",v2:"v2"};function Hv(n){const{canSkipUntil:e,canSkipDateRanges:t,age:r}=n,s=r<e/2;return e&&s?t?Vc.v2:Vc.Yes:Vc.No}class Kv{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Ra{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(r=>!!r).map(r=>r.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const r=(t=e.supplemental)==null?void 0:t.videoCodec;r&&r!==e.videoCodec&&(this.codecSet+=`,${r.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return zv(this._audioGroups,e)}hasSubtitleGroup(e){return zv(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let r=this._audioGroups;r||(r=this._audioGroups=[]),r.indexOf(t)===-1&&r.push(t)}else if(e==="text"){let r=this._subtitleGroups;r||(r=this._subtitleGroups=[]),r.indexOf(t)===-1&&r.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function zv(n,e){return!e||!n?!1:n.indexOf(e)!==-1}function uM(){if(typeof matchMedia=="function"){const n=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(n.media!==e.media)return n.matches===!0}return!1}function dM(n,e){let t=!1,r=[];if(n&&(t=n!=="SDR",r=[n]),e){r=e.allowedVideoRanges||fu.slice(0);const s=r.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:s&&uM(),t||(r=["SDR"])}return{preferHDR:t,allowedVideoRanges:r}}const fM=n=>{const e=new WeakSet;return(t,r)=>{if(n&&(r=n(t,r)),typeof r=="object"&&r!==null){if(e.has(r))return;e.add(r)}return r}},st=(n,e)=>JSON.stringify(n,fM(e));function hM(n,e,t,r,s){const i=Object.keys(n),o=r?.channels,l=r?.audioCodec,u=s?.videoCodec,d=o&&parseInt(o)===2;let f=!1,h=!1,p=1/0,x=1/0,g=1/0,E=1/0,v=0,b=[];const{preferHDR:A,allowedVideoRanges:L}=dM(e,s);for(let P=i.length;P--;){const O=n[i[P]];f||(f=O.channels[2]>0),p=Math.min(p,O.minHeight),x=Math.min(x,O.minFramerate),g=Math.min(g,O.minBitrate),L.filter(H=>O.videoRanges[H]>0).length>0&&(h=!0)}p=he(p)?p:0,x=he(x)?x:0;const I=Math.max(1080,p),_=Math.max(30,x);g=he(g)?g:t,t=Math.max(g,t),h||(e=void 0);const F=i.length>1;return{codecSet:i.reduce((P,O)=>{const M=n[O];if(O===P)return P;if(b=h?L.filter(H=>M.videoRanges[H]>0):[],F){if(M.minBitrate>t)return dr(O,`min bitrate of ${M.minBitrate} > current estimate of ${t}`),P;if(!M.hasDefaultAudio)return dr(O,"no renditions with default or auto-select sound found"),P;if(l&&O.indexOf(l.substring(0,4))%5!==0)return dr(O,`audio codec preference "${l}" not found`),P;if(o&&!d){if(!M.channels[o])return dr(O,`no renditions with ${o} channel sound found (channels options: ${Object.keys(M.channels)})`),P}else if((!l||d)&&f&&M.channels[2]===0)return dr(O,"no renditions with stereo sound found"),P;if(M.minHeight>I)return dr(O,`min resolution of ${M.minHeight} > maximum of ${I}`),P;if(M.minFramerate>_)return dr(O,`min framerate of ${M.minFramerate} > maximum of ${_}`),P;if(!b.some(H=>M.videoRanges[H]>0))return dr(O,`no variants with VIDEO-RANGE of ${st(b)} found`),P;if(u&&O.indexOf(u.substring(0,4))%5!==0)return dr(O,`video codec preference "${u}" not found`),P;if(M.maxScore<v)return dr(O,`max score of ${M.maxScore} < selected max of ${v}`),P}return P&&(uu(O)>=uu(P)||M.fragmentError>n[P].fragmentError)?P:(E=M.minIndex,v=M.maxScore,O)},void 0),videoRanges:b,preferHDR:A,minFramerate:x,minBitrate:g,minIndex:E}}function dr(n,e){Ze.log(`[abr] start candidates with "${n}" ignored because ${e}`)}function ab(n){return n.reduce((e,t)=>{let r=e.groups[t.groupId];r||(r=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(t);const s=t.channels||"2";return r.channels[s]=(r.channels[s]||0)+1,r.hasDefault=r.hasDefault||t.default,r.hasAutoSelect=r.hasAutoSelect||t.autoselect,r.hasDefault&&(e.hasDefaultAudio=!0),r.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function mM(n,e,t,r){return n.slice(t,r+1).reduce((s,i,o)=>{if(!i.codecSet)return s;const l=i.audioGroups;let u=s[i.codecSet];u||(s[i.codecSet]=u={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!l,fragmentError:0}),u.minBitrate=Math.min(u.minBitrate,i.bitrate);const d=Math.min(i.height,i.width);return u.minHeight=Math.min(u.minHeight,d),u.minFramerate=Math.min(u.minFramerate,i.frameRate),u.minIndex=Math.min(u.minIndex,o),u.maxScore=Math.max(u.maxScore,i.score),u.fragmentError+=i.fragmentError,u.videoRanges[i.videoRange]=(u.videoRanges[i.videoRange]||0)+1,l&&l.forEach(f=>{if(!f)return;const h=e.groups[f];h&&(u.hasDefaultAudio=u.hasDefaultAudio||e.hasDefaultAudio?h.hasDefault:h.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(h.channels).forEach(p=>{u.channels[p]=(u.channels[p]||0)+h.channels[p]}))}),s},{})}function Wv(n){if(!n)return n;const{lang:e,assocLang:t,characteristics:r,channels:s,audioCodec:i}=n;return{lang:e,assocLang:t,characteristics:r,channels:s,audioCodec:i}}function yr(n,e,t){if("attrs"in n){const r=e.indexOf(n);if(r!==-1)return r}for(let r=0;r<e.length;r++){const s=e[r];if(ri(n,s,t))return r}return-1}function ri(n,e,t){const{groupId:r,name:s,lang:i,assocLang:o,default:l}=n,u=n.forced;return(r===void 0||e.groupId===r)&&(s===void 0||e.name===s)&&(i===void 0||pM(i,e.lang))&&(i===void 0||e.assocLang===o)&&(l===void 0||e.default===l)&&(u===void 0||e.forced===u)&&(!("characteristics"in n)||gM(n.characteristics||"",e.characteristics))&&(t===void 0||t(n,e))}function pM(n,e="--"){return n.length===e.length?n===e:n.startsWith(e)||e.startsWith(n)}function gM(n,e=""){const t=n.split(","),r=e.split(",");return t.length===r.length&&!t.some(s=>r.indexOf(s)===-1)}function Xs(n,e){const{audioCodec:t,channels:r}=n;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(r===void 0||r===(e.channels||"2"))}function yM(n,e,t,r,s){const i=e[r],l=e.reduce((p,x,g)=>{const E=x.uri;return(p[E]||(p[E]=[])).push(g),p},{})[i.uri];l.length>1&&(r=Math.max.apply(Math,l));const u=i.videoRange,d=i.frameRate,f=i.codecSet.substring(0,4),h=Yv(e,r,p=>{if(p.videoRange!==u||p.frameRate!==d||p.codecSet.substring(0,4)!==f)return!1;const x=p.audioGroups,g=t.filter(E=>!x||x.indexOf(E.groupId)!==-1);return yr(n,g,s)>-1});return h>-1?h:Yv(e,r,p=>{const x=p.audioGroups,g=t.filter(E=>!x||x.indexOf(E.groupId)!==-1);return yr(n,g,s)>-1})}function Yv(n,e,t){for(let r=e;r>-1;r--)if(t(n[r]))return r;for(let r=e+1;r<n.length;r++)if(t(n[r]))return r;return-1}function hu(n,e){var t;return!!n&&n!==((t=e.loadLevelObj)==null?void 0:t.uri)}class xM extends Vn{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var r;const{fragCurrent:s,partCurrent:i,hls:o}=this,{autoLevelEnabled:l,media:u}=o;if(!s||!u)return;const d=performance.now(),f=i?i.stats:s.stats,h=i?i.duration:s.duration,p=d-f.loading.start,x=o.minAutoLevel,g=s.level,E=this._nextAutoLevel;if(f.aborted||f.loaded&&f.loaded===f.total||g<=x){this.clearTimer(),this._nextAutoLevel=-1;return}if(!l)return;const v=E>-1&&E!==g,b=!!t||v;if(!b&&(u.paused||!u.playbackRate||!u.readyState))return;const A=o.mainForwardBufferInfo;if(!b&&A===null)return;const L=this.bwEstimator.getEstimateTTFB(),I=Math.abs(u.playbackRate);if(p<=Math.max(L,1e3*(h/(I*2))))return;const _=A?A.len/I:0,F=f.loading.first?f.loading.first-f.loading.start:-1,C=f.loaded&&F>-1,P=this.getBwEstimate(),O=o.levels,M=O[g],H=Math.max(f.loaded,Math.round(h*(s.bitrate||M.averageBitrate)/8));let Z=C?p-F:p;Z<1&&C&&(Z=Math.min(p,f.loaded*8/P));const se=C?f.loaded*1e3/Z:0,U=L/1e3,ne=se?(H-f.loaded)/se:H*8/P+U;if(ne<=_)return;const q=se?se*8:P,te=((r=t?.details||this.hls.latestLevelDetails)==null?void 0:r.live)===!0,G=this.hls.config.abrBandWidthUpFactor;let Q=Number.POSITIVE_INFINITY,ee;for(ee=g-1;ee>x;ee--){const ce=O[ee].maxBitrate,ue=!O[ee].details||te;if(Q=this.getTimeToLoadFrag(U,q,h*ce,ue),Q<Math.min(_,h+U))break}if(Q>=ne||Q>h*10)return;C?this.bwEstimator.sample(p-Math.min(L,F),f.loaded):this.bwEstimator.sampleTTFB(p);const D=O[ee].maxBitrate;this.getBwEstimate()*G>D&&this.resetEstimator(D);const $=this.findBestLevel(D,x,ee,0,_,1,1);$>-1&&(ee=$),this.warn(`Fragment ${s.sn}${i?" part "+i.index:""} of level ${g} is loading too slowly;
      Fragment duration: ${s.duration.toFixed(3)}
      Time to underbuffer: ${_.toFixed(3)} s
      Estimated load time for current fragment: ${ne.toFixed(3)} s
      Estimated load time for down switch fragment: ${Q.toFixed(3)} s
      TTFB estimate: ${F|0} ms
      Current BW estimate: ${he(P)?P|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${ee} @ ${D|0} bps`),o.nextLoadLevel=o.nextAutoLevel=ee,this.clearTimer();const ie=()=>{if(this.clearTimer(),this.fragCurrent===s&&this.hls.loadLevel===ee&&ee>0){const ce=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${ee>0?"and switching down":""}
      Fragment duration: ${s.duration.toFixed(3)} s
      Time to underbuffer: ${ce.toFixed(3)} s`),s.abortRequests(),this.fragCurrent=this.partCurrent=null,ee>x){let ue=this.findBestLevel(this.hls.levels[x].bitrate,x,ee,0,ce,1,1);ue===-1&&(ue=x),this.hls.nextLoadLevel=this.hls.nextAutoLevel=ue,this.resetEstimator(this.hls.levels[ue].bitrate)}}};v||ne>Q*2?ie():this.timer=self.setInterval(ie,Q*1e3),o.trigger(R.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,part:i,stats:f})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new bO(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.FRAG_LOADING,this.onFragLoading,this),e.on(R.FRAG_LOADED,this.onFragLoaded,this),e.on(R.FRAG_BUFFERED,this.onFragBuffered,this),e.on(R.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(R.LEVEL_LOADED,this.onLevelLoaded,this),e.on(R.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(R.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(R.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.FRAG_LOADING,this.onFragLoading,this),e.off(R.FRAG_LOADED,this.onFragLoaded,this),e.off(R.FRAG_BUFFERED,this.onFragBuffered,this),e.off(R.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(R.LEVEL_LOADED,this.onLevelLoaded,this),e.off(R.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(R.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(R.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const r=t.frag;if(!this.ignoreFragment(r)){if(!r.bitrateTest){var s;this.fragCurrent=r,this.partCurrent=(s=t.part)!=null?s:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case z.BUFFER_ADD_CODEC_ERROR:case z.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case z.FRAG_LOAD_TIMEOUT:{const r=t.frag,{fragCurrent:s,partCurrent:i}=this;if(r&&s&&r.sn===s.sn&&r.level===s.level){const o=performance.now(),l=i?i.stats:r.stats,u=o-l.loading.start,d=l.loading.first?l.loading.first-l.loading.start:-1;if(l.loaded&&d>-1){const h=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(u-Math.min(h,d),l.loaded)}else this.bwEstimator.sampleTTFB(u)}break}}}getTimeToLoadFrag(e,t,r,s){const i=e+r/t,o=s?e+this.lastLevelLoadSec:0;return i+o}onLevelLoaded(e,t){const r=this.hls.config,{loading:s}=t.stats,i=s.end-s.first;he(i)&&(this.lastLevelLoadSec=i/1e3),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:r}){const s=r?r.stats:t.stats;if(t.type===ge.MAIN&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const i=r?r.duration:t.duration,o=this.hls.levels[t.level],l=(o.loaded?o.loaded.bytes:0)+s.loaded,u=(o.loaded?o.loaded.duration:0)+i;o.loaded={bytes:l,duration:u},o.realBitrate=Math.round(8*l/u)}if(t.bitrateTest){const i={stats:s,frag:t,part:r,id:t.type};this.onFragBuffered(R.FRAG_BUFFERED,i),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:r,part:s}=t,i=s!=null&&s.stats.loaded?s.stats:r.stats;if(i.aborted||this.ignoreFragment(r))return;const o=i.parsing.end-i.loading.start-Math.min(i.loading.first-i.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,i.loaded),i.bwEstimate=this.getBwEstimate(),r.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==ge.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,r=this.getBwEstimate(),s=this.hls.config.maxStarvationDelay,i=this.findBestLevel(r,t,e,0,s,1,1);if(i>-1)return i;const o=this.hls.firstLevel,l=Math.min(Math.max(o,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${l}`),l}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,r=this.bwEstimator.canEstimate(),s=this.lastLoadedFragLevel>-1;if(e!==-1&&(!r||!s||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const i=r&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,i)&&o[e].loadError<=o[i].loadError)return e}return this._nextAutoLevel=i,this.nextAutoLevelKey=this.getAutoLevelKey(),i}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:r}=this;if(r.levels.length<=1)return r.loadLevel;const{maxAutoLevel:s,config:i,minAutoLevel:o}=r,l=t?t.duration:e?e.duration:0,u=this.getBwEstimate(),d=this.getStarvationDelay();let f=i.abrBandWidthFactor,h=i.abrBandWidthUpFactor;if(d){const v=this.findBestLevel(u,o,s,d,0,f,h);if(v>=0)return this.rebufferNotice=-1,v}let p=l?Math.min(l,i.maxStarvationDelay):i.maxStarvationDelay;if(!d){const v=this.bitrateTestDelay;v&&(p=(l?Math.min(l,i.maxLoadingDelay):i.maxLoadingDelay)-v,this.info(`bitrate test took ${Math.round(1e3*v)}ms, set first fragment max fetchDuration to ${Math.round(1e3*p)} ms`),f=h=1)}const x=this.findBestLevel(u,o,s,d,p,f,h);if(this.rebufferNotice!==x&&(this.rebufferNotice=x,this.info(`${d?"rebuffering expected":"buffer is empty"}, optimal quality level ${x}`)),x>-1)return x;const g=r.levels[o],E=r.loadLevelObj;return E&&g?.bitrate<E.bitrate?o:r.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const r=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,s=e.mainForwardBufferInfo;return(s?s.len:0)/r}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,r,s,i,o,l){var u;const d=s+i,f=this.lastLoadedFragLevel,h=f===-1?this.hls.firstLevel:f,{fragCurrent:p,partCurrent:x}=this,{levels:g,allAudioTracks:E,loadLevel:v,config:b}=this.hls;if(g.length===1)return 0;const A=g[h],L=!!((u=this.hls.latestLevelDetails)!=null&&u.live),I=v===-1||f===-1;let _,F="SDR",C=A?.frameRate||0;const{audioPreference:P,videoPreference:O}=b,M=this.audioTracksByGroup||(this.audioTracksByGroup=ab(E));let H=-1;if(I){if(this.firstSelection!==-1)return this.firstSelection;const q=this.codecTiers||(this.codecTiers=mM(g,M,t,r)),te=hM(q,F,e,P,O),{codecSet:G,videoRanges:Q,minFramerate:ee,minBitrate:D,minIndex:$,preferHDR:ie}=te;H=$,_=G,F=ie?Q[Q.length-1]:Q[0],C=ee,e=Math.max(e,D),this.log(`picked start tier ${st(te)}`)}else _=A?.codecSet,F=A?.videoRange;const Z=x?x.duration:p?p.duration:0,se=this.bwEstimator.getEstimateTTFB()/1e3,U=[];for(let q=r;q>=t;q--){var ne;const te=g[q],G=q>h;if(!te)continue;if(b.useMediaCapabilities&&!te.supportedResult&&!te.supportedPromise){const ue=navigator.mediaCapabilities;typeof ue?.decodingInfo=="function"&&rM(te,M,F,C,e,P)?(te.supportedPromise=ib(te,M,ue,this.supportedCache),te.supportedPromise.then(fe=>{if(!this.hls)return;te.supportedResult=fe;const Ee=this.hls.levels,ye=Ee.indexOf(te);fe.error?this.warn(`MediaCapabilities decodingInfo error: "${fe.error}" for level ${ye} ${st(fe)}`):fe.supported?fe.decodingInfoResults.some(Le=>Le.smooth===!1||Le.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${ye} not smooth or powerEfficient: ${st(fe)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${ye} ${st(fe)}`),ye>-1&&Ee.length>1&&(this.log(`Removing unsupported level ${ye}`),this.hls.removeLevel(ye),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(fe=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${fe}`)})):te.supportedResult=rb}if((_&&te.codecSet!==_||F&&te.videoRange!==F||G&&C>te.frameRate||!G&&C>0&&C<te.frameRate||(ne=te.supportedResult)!=null&&(ne=ne.decodingInfoResults)!=null&&ne.some(ue=>ue.smooth===!1))&&(!I||q!==H)){U.push(q);continue}const Q=te.details,ee=(x?Q?.partTarget:Q?.averagetargetduration)||Z;let D;G?D=l*e:D=o*e;const $=Z&&s>=Z*2&&i===0?te.averageBitrate:te.maxBitrate,ie=this.getTimeToLoadFrag(se,D,$*ee,Q===void 0);if(D>=$&&(q===f||te.loadError===0&&te.fragmentError===0)&&(ie<=se||!he(ie)||L&&!this.bitrateTestDelay||ie<d)){const ue=this.forcedAutoLevel;return q!==v&&(ue===-1||ue!==v)&&(U.length&&this.trace(`Skipped level(s) ${U.join(",")} of ${r} max with CODECS and VIDEO-RANGE:"${g[U[0]].codecs}" ${g[U[0]].videoRange}; not compatible with "${_}" ${F}`),this.info(`switch candidate:${h}->${q} adjustedbw(${Math.round(D)})-bitrate=${Math.round(D-$)} ttfb:${se.toFixed(1)} avgDuration:${ee.toFixed(1)} maxFetchDuration:${d.toFixed(1)} fetchDuration:${ie.toFixed(1)} firstSelection:${I} codecSet:${te.codecSet} videoRange:${te.videoRange} hls.loadLevel:${v}`)),I&&(this.firstSelection=q),q}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:r}=this.hls;return Math.min(Math.max(e,r),t)}}const lb={search:function(n,e){let t=0,r=n.length-1,s=null,i=null;for(;t<=r;){s=(t+r)/2|0,i=n[s];const o=e(i);if(o>0)t=s+1;else if(o<0)r=s-1;else return i}return null}};function vM(n,e,t){if(e===null||!Array.isArray(n)||!n.length||!he(e))return null;const r=n[0].programDateTime;if(e<(r||0))return null;const s=n[n.length-1].endProgramDateTime;if(e>=(s||0))return null;for(let i=0;i<n.length;++i){const o=n[i];if(EM(e,t,o))return o}return null}function oi(n,e,t=0,r=0,s=.005){let i=null;if(n){i=e[1+n.sn-e[0].sn]||null;const l=n.endDTS-t;l>0&&l<15e-7&&(t+=15e-7),i&&n.level!==i.level&&i.end<=n.end&&(i=e[2+n.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(i=e[0]);if(i&&((!n||n.level===i.level)&&qv(t,r,i)===0||SM(i,n,Math.min(s,r))))return i;const o=lb.search(e,qv.bind(null,t,r));return o&&(o!==n||!i)?o:i}function SM(n,e,t){if(e&&e.start===0&&e.level<n.level&&(e.endPTS||0)>0){const r=e.tagList.reduce((s,i)=>(i[0]==="INF"&&(s+=parseFloat(i[1])),s),t);return n.start<=r}return!1}function qv(n=0,e=0,t){if(t.start<=n&&t.start+t.duration>n)return 0;const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-r<=n?1:t.start-r>n&&t.start?-1:0}function EM(n,e,t){const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-r>n}function cb(n,e,t){if(n&&n.startCC<=e&&n.endCC>=e){let r=n.fragments;const{fragmentHint:s}=n;s&&(r=r.concat(s));let i;return lb.search(r,o=>o.cc<e?1:o.cc>e?-1:(i=o,o.end<=t?1:o.start>t?-1:0)),i||null}return null}function mu(n){switch(n.details){case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_TIMEOUT:case z.LEVEL_LOAD_TIMEOUT:case z.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function ub(n){return n.details.startsWith("key")}function db(n){return ub(n)&&!!n.frag&&!n.frag.decryptdata}function Xv(n,e){const t=mu(e);return n.default[`${t?"timeout":"error"}Retry`]}function Fp(n,e){const t=n.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*n.retryDelayMs,n.maxRetryDelayMs)}function Qv(n){return Je(Je({},n),{errorRetry:null,timeoutRetry:null})}function pu(n,e,t,r){if(!n)return!1;const s=r?.code,i=e<n.maxNumRetry&&(TM(s)||!!t);return n.shouldRetry?n.shouldRetry(n,e,t,r,i):i}function TM(n){return Rm(n)||!!n&&(n<400||n>499)}function Rm(n){return n===0&&navigator.onLine===!1}var Ut={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},bn={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class bM extends Vn{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(R.ERROR,this.onError,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(R.ERROR,this.onError,this),e.off(R.ERROR,this.onErrorOut,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return e?.type===ge.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,r=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||r===-1?t.loadLevel:r}variantHasKey(e,t){if(e){var r;if((r=e.details)!=null&&r.hasKey(t))return!0;const s=e.audioGroups;if(s)return this.hls.allAudioTracks.filter(o=>s.indexOf(o.groupId)>=0).some(o=>{var l;return(l=o.details)==null?void 0:l.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var r;if(t.fatal)return;const s=this.hls,i=t.context;switch(t.details){case z.FRAG_LOAD_ERROR:case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_ERROR:case z.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case z.FRAG_PARSING_ERROR:if((r=t.frag)!=null&&r.gap){t.errorAction=Ki();return}case z.FRAG_GAP:case z.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Ut.SendAlternateToPenaltyBox;return}case z.LEVEL_EMPTY_ERROR:case z.LEVEL_PARSING_ERROR:{var o;const u=t.parent===ge.MAIN?t.level:s.loadLevel;t.details===z.LEVEL_EMPTY_ERROR&&((o=t.context)!=null&&(o=o.levelDetails)!=null&&o.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,u):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,u))}return;case z.LEVEL_LOAD_ERROR:case z.LEVEL_LOAD_TIMEOUT:typeof i?.level=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.level));return;case z.AUDIO_TRACK_LOAD_ERROR:case z.AUDIO_TRACK_LOAD_TIMEOUT:case z.SUBTITLE_LOAD_ERROR:case z.SUBTITLE_TRACK_LOAD_TIMEOUT:if(i){const u=s.loadLevelObj;if(u&&(i.type===Ge.AUDIO_TRACK&&u.hasAudioGroup(i.groupId)||i.type===Ge.SUBTITLE_TRACK&&u.hasSubtitleGroup(i.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.loadLevel),t.errorAction.action=Ut.SendAlternateToPenaltyBox,t.errorAction.flags=bn.MoveAllAlternatesMatchingHost;return}}return;case z.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:Ut.SendAlternateToPenaltyBox,flags:bn.MoveAllAlternatesMatchingHDCP};return;case z.KEY_SYSTEM_SESSION_UPDATE_FAILED:case z.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case z.KEY_SYSTEM_NO_SESSION:t.errorAction={action:Ut.SendAlternateToPenaltyBox,flags:bn.MoveAllAlternatesMatchingKey};return;case z.BUFFER_ADD_CODEC_ERROR:case z.REMUX_ALLOC_ERROR:case z.BUFFER_APPEND_ERROR:if(!t.errorAction){var l;t.errorAction=this.getLevelSwitchAction(t,(l=t.level)!=null?l:s.loadLevel)}return;case z.INTERNAL_EXCEPTION:case z.BUFFER_APPENDING_ERROR:case z.BUFFER_FULL_ERROR:case z.LEVEL_SWITCH_ERROR:case z.BUFFER_STALLED_ERROR:case z.BUFFER_SEEK_OVER_HOLE:case z.BUFFER_NUDGE_ON_STALL:t.errorAction=Ki();return}t.type===we.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=Ki())}getPlaylistRetryOrSwitchAction(e,t){const r=this.hls,s=Xv(r.config.playlistLoadPolicy,e),i=this.playlistError++;if(pu(s,i,mu(e),e.response))return{action:Ut.RetryRequest,flags:bn.None,retryConfig:s,retryCount:i};const l=this.getLevelSwitchAction(e,t);return s&&(l.retryConfig=s,l.retryCount=i),l}getFragRetryOrSwitchAction(e){const t=this.hls,r=this.getVariantLevelIndex(e.frag),s=t.levels[r],{fragLoadPolicy:i,keyLoadPolicy:o}=t.config,l=Xv(ub(e)?o:i,e),u=t.levels.reduce((f,h)=>f+h.fragmentError,0);if(s&&(e.details!==z.FRAG_GAP&&s.fragmentError++,!db(e)&&pu(l,u,mu(e),e.response)))return{action:Ut.RetryRequest,flags:bn.None,retryConfig:l,retryCount:u};const d=this.getLevelSwitchAction(e,r);return l&&(d.retryConfig=l,d.retryCount=u),d}getLevelSwitchAction(e,t){const r=this.hls;t==null&&(t=r.loadLevel);const s=this.hls.levels[t];if(s){var i,o;const d=e.details;s.loadError++,d===z.BUFFER_APPEND_ERROR&&s.fragmentError++;let f=-1;const{levels:h,loadLevel:p,minAutoLevel:x,maxAutoLevel:g}=r;!r.autoLevelEnabled&&!r.config.preserveManualLevelOnError&&(r.loadLevel=-1);const E=(i=e.frag)==null?void 0:i.type,b=(E===ge.AUDIO&&d===z.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(d===z.BUFFER_ADD_CODEC_ERROR||d===z.BUFFER_APPEND_ERROR))&&h.some(({audioCodec:F})=>s.audioCodec!==F),L=e.sourceBufferName==="video"&&(d===z.BUFFER_ADD_CODEC_ERROR||d===z.BUFFER_APPEND_ERROR)&&h.some(({codecSet:F,audioCodec:C})=>s.codecSet!==F&&s.audioCodec===C),{type:I,groupId:_}=(o=e.context)!=null?o:{};for(let F=h.length;F--;){const C=(F+p)%h.length;if(C!==p&&C>=x&&C<=g&&h[C].loadError===0){var l,u;const P=h[C];if(d===z.FRAG_GAP&&E===ge.MAIN&&e.frag){const O=h[C].details;if(O){const M=oi(e.frag,O.fragments,e.frag.start);if(M!=null&&M.gap)continue}}else{if(I===Ge.AUDIO_TRACK&&P.hasAudioGroup(_)||I===Ge.SUBTITLE_TRACK&&P.hasSubtitleGroup(_))continue;if(E===ge.AUDIO&&(l=s.audioGroups)!=null&&l.some(O=>P.hasAudioGroup(O))||E===ge.SUBTITLE&&(u=s.subtitleGroups)!=null&&u.some(O=>P.hasSubtitleGroup(O))||b&&s.audioCodec===P.audioCodec||L&&s.codecSet===P.codecSet||!b&&s.codecSet!==P.codecSet)continue}f=C;break}}if(f>-1&&r.loadLevel!==f)return e.levelRetry=!0,this.playlistError=0,{action:Ut.SendAlternateToPenaltyBox,flags:bn.None,nextAutoLevel:f}}return{action:Ut.SendAlternateToPenaltyBox,flags:bn.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var r;switch((r=t.errorAction)==null?void 0:r.action){case Ut.DoNothing:break;case Ut.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==z.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,r=e.errorAction;if(!r)return;const{flags:s}=r,i=r.nextAutoLevel;switch(s){case bn.None:this.switchLevel(e,i);break;case bn.MoveAllAlternatesMatchingHDCP:{const u=this.getVariantLevelIndex(e.frag),d=t.levels[u],f=d?.attrs["HDCP-LEVEL"];if(r.hdcpLevel=f,f==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(f){t.maxHdcpLevel=Lm[Lm.indexOf(f)-1],r.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case bn.MoveAllAlternatesMatchingKey:{const u=e.decryptdata;if(u){const d=this.hls.levels,f=d.length;for(let p=f;p--;)if(this.variantHasKey(d[p],u)){var o,l;this.log(`Banned key found in level ${p} (${d[p].bitrate}bps) or audio group "${(o=d[p].audioGroups)==null?void 0:o.join(",")}" (${(l=e.frag)==null?void 0:l.type} fragment) ${$t(u.keyId||[])}`),d[p].fragmentError++,d[p].loadError++,this.log(`Removing level ${p} with key error (${e.error})`),this.hls.removeLevel(p)}const h=e.frag;if(this.hls.levels.length<f)r.resolved=!0;else if(h&&h.type!==ge.MAIN){const p=h.decryptdata;p&&!u.matches(p)&&(r.resolved=!0)}}break}}r.resolved||this.switchLevel(e,i)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===z.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const r=Am(e.mimeType),s=this.hls.levels;for(let i=s.length;i--;)s[i][`${e.sourceBufferName}Codec`]===r&&(this.log(`Removing level ${i} for ${e.details} ("${r}" not supported)`),this.hls.removeLevel(i))}}}function Ki(n){const e={action:Ut.DoNothing,flags:bn.None};return n&&(e.resolved=!0),e}var Ct={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class wM{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.BUFFER_APPENDED,this.onBufferAppended,this),e.on(R.FRAG_BUFFERED,this.onFragBuffered,this),e.on(R.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.BUFFER_APPENDED,this.onBufferAppended,this),e.off(R.FRAG_BUFFERED,this.onFragBuffered,this),e.off(R.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const r=this.activePartLists[t];if(r)for(let s=r.length;s--;){const i=r[s];if(!i)break;if(i.start<=e&&e<=i.end&&i.loaded)return i}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,r){const{fragments:s}=this,i=Object.keys(s);for(let o=i.length;o--;){const l=s[i[o]];if(l?.body.type===t&&(!r||l.buffered)){const u=l.body;if(u.start<=e&&e<=u.end)return u}}return null}detectEvictedFragments(e,t,r,s,i){this.timeRanges&&(this.timeRanges[e]=t);const o=s?.fragment.sn||-1;Object.keys(this.fragments).forEach(l=>{const u=this.fragments[l];if(!u||o>=u.body.sn)return;if(!u.buffered&&(!u.loaded||i)){u.body.type===r&&this.removeFragment(u.body);return}const d=u.range[e];if(d){if(d.time.length===0){this.removeFragment(u.body);return}d.time.some(f=>{const h=!this.isTimeBuffered(f.startPTS,f.endPTS,t);return h&&this.removeFragment(u.body),h})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const r=e.frag,s=Oi(r),i=this.fragments[s];if(!i||i.buffered&&r.gap)return;const o=!r.relurl;Object.keys(t).forEach(l=>{const u=r.elementaryStreams[l];if(!u)return;const d=t[l],f=o||u.partial===!0;i.range[l]=this.getBufferedTimes(r,e.part,f,d)}),i.loaded=null,Object.keys(i.range).length?(this.bufferedEnd(i,r),yc(i)||this.removeParts(r.sn-1,r.type)):this.removeFragment(i.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const r=this.activePartLists[t];r&&(this.activePartLists[t]=Jv(r,s=>s.fragment.sn>=e))}fragBuffered(e,t){const r=Oi(e);let s=this.fragments[r];!s&&t&&(s=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,this.bufferedEnd(s,e))}getBufferedTimes(e,t,r,s){const i={time:[],partial:r},o=e.start,l=e.end,u=e.minEndPTS||l,d=e.maxStartPTS||o;for(let f=0;f<s.length;f++){const h=s.start(f)-this.bufferPadding,p=s.end(f)+this.bufferPadding;if(d>=h&&u<=p){i.time.push({startPTS:Math.max(o,s.start(f)),endPTS:Math.min(l,s.end(f))});break}else if(o<p&&l>h){const x=Math.max(o,s.start(f)),g=Math.min(l,s.end(f));g>x&&(i.partial=!0,i.time.push({startPTS:x,endPTS:g}))}else if(l<=h)break}return i}getPartialFragment(e){let t=null,r,s,i,o=0;const{bufferPadding:l,fragments:u}=this;return Object.keys(u).forEach(d=>{const f=u[d];f&&yc(f)&&(s=f.body.start-l,i=f.body.end+l,e>=s&&e<=i&&(r=Math.min(e-s,i-e),o<=r&&(t=f.body,o=r)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||yc(t))}getState(e){const t=Oi(e),r=this.fragments[t];return r?r.buffered?yc(r)?Ct.PARTIAL:Ct.OK:Ct.APPENDING:Ct.NOT_LOADED}isTimeBuffered(e,t,r){let s,i;for(let o=0;o<r.length;o++){if(s=r.start(o)-this.bufferPadding,i=r.end(o)+this.bufferPadding,e>=s&&t<=i)return!0;if(t<=s)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const r=t.frag,s=t.part?null:t,i=Oi(r);this.fragments[i]={body:r,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:r,part:s,timeRanges:i,type:o}=t;if(r.sn==="initSegment")return;const l=r.type;if(s){let d=this.activePartLists[l];d||(this.activePartLists[l]=d=[]),d.push(s)}this.timeRanges=i;const u=i[o];this.detectEvictedFragments(o,u,l,s)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Oi(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,r=Object.keys(t);if(!e)return r.length>0;for(let s=r.length;s--;){const i=t[r[s]];if(i?.body.type===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,r,s,i){s&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const l=this.fragments[o];if(!l)return;const u=l.body;u.type!==r||s&&!u.gap||u.start<t&&u.end>e&&(l.buffered||i)&&this.removeFragment(u)})}removeFragment(e){const t=Oi(e);e.clearElementaryStreamInfo();const r=this.activePartLists[e.type];if(r){const s=e.sn;this.activePartLists[e.type]=Jv(r,i=>i.fragment.sn!==s)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(r=>r.clearElementaryStreamInfo())}}function yc(n){var e,t,r;return n.buffered&&!!(n.body.gap||(e=n.range.video)!=null&&e.partial||(t=n.range.audio)!=null&&t.partial||(r=n.range.audiovideo)!=null&&r.partial)}function Oi(n){return`${n.type}_${n.level}_${n.sn}`}function Jv(n,e){return n.filter(t=>{const r=e(t);return r||t.clearElementaryStreamInfo(),r})}var Is={cbc:0,ctr:1};class AM{constructor(e,t,r){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=r}decrypt(e,t){switch(this.aesMode){case Is.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Is.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function LM(n){const e=n.byteLength,t=e&&new DataView(n.buffer).getUint8(e-1);return t?n.slice(0,e-t):n}class RM{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),r=new Uint32Array(4);for(let s=0;s<4;s++)r[s]=t.getUint32(s*4);return r}initTable(){const e=this.sBox,t=this.invSBox,r=this.subMix,s=r[0],i=r[1],o=r[2],l=r[3],u=this.invSubMix,d=u[0],f=u[1],h=u[2],p=u[3],x=new Uint32Array(256);let g=0,E=0,v=0;for(v=0;v<256;v++)v<128?x[v]=v<<1:x[v]=v<<1^283;for(v=0;v<256;v++){let b=E^E<<1^E<<2^E<<3^E<<4;b=b>>>8^b&255^99,e[g]=b,t[b]=g;const A=x[g],L=x[A],I=x[L];let _=x[b]*257^b*16843008;s[g]=_<<24|_>>>8,i[g]=_<<16|_>>>16,o[g]=_<<8|_>>>24,l[g]=_,_=I*16843009^L*65537^A*257^g*16843008,d[b]=_<<24|_>>>8,f[b]=_<<16|_>>>16,h[b]=_<<8|_>>>24,p[b]=_,g?(g=A^x[x[x[I^A]]],E^=x[x[E]]):g=E=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let r=!0,s=0;for(;s<t.length&&r;)r=t[s]===this.key[s],s++;if(r)return;this.key=t;const i=this.keySize=t.length;if(i!==4&&i!==6&&i!==8)throw new Error("Invalid aes key size="+i);const o=this.ksRows=(i+6+1)*4;let l,u;const d=this.keySchedule=new Uint32Array(o),f=this.invKeySchedule=new Uint32Array(o),h=this.sBox,p=this.rcon,x=this.invSubMix,g=x[0],E=x[1],v=x[2],b=x[3];let A,L;for(l=0;l<o;l++){if(l<i){A=d[l]=t[l];continue}L=A,l%i===0?(L=L<<8|L>>>24,L=h[L>>>24]<<24|h[L>>>16&255]<<16|h[L>>>8&255]<<8|h[L&255],L^=p[l/i|0]<<24):i>6&&l%i===4&&(L=h[L>>>24]<<24|h[L>>>16&255]<<16|h[L>>>8&255]<<8|h[L&255]),d[l]=A=(d[l-i]^L)>>>0}for(u=0;u<o;u++)l=o-u,u&3?L=d[l]:L=d[l-4],u<4||l<=4?f[u]=L:f[u]=g[h[L>>>24]]^E[h[L>>>16&255]]^v[h[L>>>8&255]]^b[h[L&255]],f[u]=f[u]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,r){const s=this.keySize+6,i=this.invKeySchedule,o=this.invSBox,l=this.invSubMix,u=l[0],d=l[1],f=l[2],h=l[3],p=this.uint8ArrayToUint32Array_(r);let x=p[0],g=p[1],E=p[2],v=p[3];const b=new Int32Array(e),A=new Int32Array(b.length);let L,I,_,F,C,P,O,M,H,Z,se,U,ne,q;const te=this.networkToHostOrderSwap;for(;t<b.length;){for(H=te(b[t]),Z=te(b[t+1]),se=te(b[t+2]),U=te(b[t+3]),C=H^i[0],P=U^i[1],O=se^i[2],M=Z^i[3],ne=4,q=1;q<s;q++)L=u[C>>>24]^d[P>>16&255]^f[O>>8&255]^h[M&255]^i[ne],I=u[P>>>24]^d[O>>16&255]^f[M>>8&255]^h[C&255]^i[ne+1],_=u[O>>>24]^d[M>>16&255]^f[C>>8&255]^h[P&255]^i[ne+2],F=u[M>>>24]^d[C>>16&255]^f[P>>8&255]^h[O&255]^i[ne+3],C=L,P=I,O=_,M=F,ne=ne+4;L=o[C>>>24]<<24^o[P>>16&255]<<16^o[O>>8&255]<<8^o[M&255]^i[ne],I=o[P>>>24]<<24^o[O>>16&255]<<16^o[M>>8&255]<<8^o[C&255]^i[ne+1],_=o[O>>>24]<<24^o[M>>16&255]<<16^o[C>>8&255]<<8^o[P&255]^i[ne+2],F=o[M>>>24]<<24^o[C>>16&255]<<16^o[P>>8&255]<<8^o[O&255]^i[ne+3],A[t]=te(L^x),A[t+1]=te(F^g),A[t+2]=te(_^E),A[t+3]=te(I^v),x=H,g=Z,E=se,v=U,t=t+4}return A.buffer}}class IM{constructor(e,t,r){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=r}expandKey(){const e=kM(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function kM(n){switch(n){case Is.cbc:return"AES-CBC";case Is.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${n}`)}}const CM=16;class Bp{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?LM(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,r,s){return this.useSoftware?new Promise((i,o)=>{const l=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(l,t,r,s);const u=this.flush();u?i(u.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r,s)}softwareDecrypt(e,t,r,s){const{currentIV:i,currentResult:o,remainderData:l}=this;if(s!==Is.cbc||t.byteLength!==16)return Ze.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),l&&(e=$n(l,e),this.remainderData=null);const u=this.getValidChunk(e);if(!u.length)return null;i&&(r=i);let d=this.softwareDecrypter;d||(d=this.softwareDecrypter=new RM),d.expandKey(t);const f=o;return this.currentResult=d.decrypt(u.buffer,0,r),this.currentIV=u.slice(-16).buffer,f||null}webCryptoDecrypt(e,t,r,s){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,r,s));this.key=t,this.fastAesKey=new IM(this.subtle,t,s)}return this.fastAesKey.expandKey().then(i=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new AM(this.subtle,new Uint8Array(r),s).decrypt(e.buffer,i)):Promise.reject(new Error("web crypto not initialized"))).catch(i=>(Ze.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${i.name}: ${i.message}`),this.onWebCryptoError(e,t,r,s)))}onWebCryptoError(e,t,r,s){const i=this.enableSoftwareAES;if(i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r,s);const o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(i?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const r=e.length-e.length%CM;return r!==e.length&&(t=e.slice(0,r),this.remainderData=e.slice(r)),t}logOnce(e){this.logEnabled&&(Ze.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Zv=Math.pow(2,17);class _M{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const r=e.url;if(!r)return Promise.reject(new Fr({type:we.NETWORK_ERROR,details:z.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${r?"part list":"url"}`),networkDetails:null}));this.abort();const s=this.config,i=s.fLoader,o=s.loader;return new Promise((l,u)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(g=>g[0]==="GAP")){u(tS(e));return}else e.gap=!1;const d=this.loader=i?new i(s):new o(s),f=eS(e);e.loader=d;const h=Qv(s.fragLoadPolicy.default),p={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:Zv};e.stats=d.stats;const x={onSuccess:(g,E,v,b)=>{this.resetLoader(e,d);let A=g.data;v.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(A.slice(0,16)),A=A.slice(16)),l({frag:e,part:null,payload:A,networkDetails:b})},onError:(g,E,v,b)=>{this.resetLoader(e,d),u(new Fr({type:we.NETWORK_ERROR,details:z.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Je({url:r,data:void 0},g),error:new Error(`HTTP Error ${g.code} ${g.text}`),networkDetails:v,stats:b}))},onAbort:(g,E,v)=>{this.resetLoader(e,d),u(new Fr({type:we.NETWORK_ERROR,details:z.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:v,stats:g}))},onTimeout:(g,E,v)=>{this.resetLoader(e,d),u(new Fr({type:we.NETWORK_ERROR,details:z.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${p.timeout}ms`),networkDetails:v,stats:g}))}};t&&(x.onProgress=(g,E,v,b)=>t({frag:e,part:null,payload:v,networkDetails:b})),d.load(f,p,x)})}loadPart(e,t,r){this.abort();const s=this.config,i=s.fLoader,o=s.loader;return new Promise((l,u)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){u(tS(e,t));return}const d=this.loader=i?new i(s):new o(s),f=eS(e,t);e.loader=d;const h=Qv(s.fragLoadPolicy.default),p={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Zv};t.stats=d.stats,d.load(f,p,{onSuccess:(x,g,E,v)=>{this.resetLoader(e,d),this.updateStatsFromPart(e,t);const b={frag:e,part:t,payload:x.data,networkDetails:v};r(b),l(b)},onError:(x,g,E,v)=>{this.resetLoader(e,d),u(new Fr({type:we.NETWORK_ERROR,details:z.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Je({url:f.url,data:void 0},x),error:new Error(`HTTP Error ${x.code} ${x.text}`),networkDetails:E,stats:v}))},onAbort:(x,g,E)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,d),u(new Fr({type:we.NETWORK_ERROR,details:z.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:E,stats:x}))},onTimeout:(x,g,E)=>{this.resetLoader(e,d),u(new Fr({type:we.NETWORK_ERROR,details:z.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${p.timeout}ms`),networkDetails:E,stats:x}))}})})}updateStatsFromPart(e,t){const r=e.stats,s=t.stats,i=s.total;if(r.loaded+=s.loaded,i){const u=Math.round(e.duration/t.duration),d=Math.min(Math.round(r.loaded/i),u),h=(u-d)*Math.round(r.loaded/d);r.total=r.loaded+h}else r.total=Math.max(r.loaded,r.total);const o=r.loading,l=s.loading;o.start?o.first+=l.first-l.start:(o.start=l.start,o.first=l.first),o.end=l.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function eS(n,e=null){const t=e||n,r={frag:n,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},s=t.byteRangeStartOffset,i=t.byteRangeEndOffset;if(he(s)&&he(i)){var o;let l=s,u=i;if(n.sn==="initSegment"&&PM((o=n.decryptdata)==null?void 0:o.method)){const d=i-s;d%16&&(u=i+(16-d%16)),s!==0&&(r.resetIV=!0,l=s-16)}r.rangeStart=l,r.rangeEnd=u}return r}function tS(n,e){const t=new Error(`GAP ${n.gap?"tag":"attribute"} found`),r={type:we.MEDIA_ERROR,details:z.FRAG_GAP,fatal:!1,frag:n,error:t,networkDetails:null};return e&&(r.part=e),(e||n).stats.aborted=!0,new Fr(r)}function PM(n){return n==="AES-128"||n==="AES-256"}class Fr extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class fb extends Vn{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Up{constructor(e,t,r,s=0,i=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=xc(),this.buffering={audio:xc(),video:xc(),audiovideo:xc()},this.level=e,this.sn=t,this.id=r,this.size=s,this.part=i,this.partial=o}}function xc(){return{start:0,executeStart:0,executeEnd:0,end:0}}const nS={length:0,start:()=>0,end:()=>0};class Oe{static isBuffered(e,t){if(e){const r=Oe.getBuffered(e);for(let s=r.length;s--;)if(t>=r.start(s)&&t<=r.end(s))return!0}return!1}static bufferedRanges(e){if(e){const t=Oe.getBuffered(e);return Oe.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});return t}static bufferInfo(e,t,r){if(e){const s=Oe.bufferedRanges(e);if(s.length)return Oe.bufferedInfo(s,t,r)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,r){t=Math.max(0,t),e.length>1&&e.sort((f,h)=>f.start-h.start||h.end-f.end);let s=-1,i=[];if(r)for(let f=0;f<e.length;f++){t>=e[f].start&&t<=e[f].end&&(s=f);const h=i.length;if(h){const p=i[h-1].end;e[f].start-p<r?e[f].end>p&&(i[h-1].end=e[f].end):i.push(e[f])}else i.push(e[f])}else i=e;let o=0,l,u=t,d=t;for(let f=0;f<i.length;f++){const h=i[f].start,p=i[f].end;if(s===-1&&t>=h&&t<=p&&(s=f),t+r>=h&&t<p)u=h,d=p,o=d-t;else if(t+r<h){l=h;break}}return{len:o,start:u||0,end:d||0,nextStart:l,buffered:e,bufferedIndex:s}}static getBuffered(e){try{return e.buffered||nS}catch(t){return Ze.log("failed to get media.buffered",t),nS}}}const hb=/\{\$([a-zA-Z0-9-_]+)\}/g;function rS(n){return hb.test(n)}function Im(n,e){if(n.variableList!==null||n.hasVariableRefs){const t=n.variableList;return e.replace(hb,r=>{const s=r.substring(2,r.length-1),i=t?.[s];return i===void 0?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),r):i})}return e}function sS(n,e,t){let r=n.variableList;r||(n.variableList=r={});let s,i;if("QUERYPARAM"in e){s=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(o.has(s))i=o.get(s);else throw new Error(`"${s}" does not match any query parameter in URI: "${t}"`)}catch(o){n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else s=e.NAME,i=e.VALUE;s in r?n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):r[s]=i||""}function DM(n,e,t){const r=e.IMPORT;if(t&&r in t){let s=n.variableList;s||(n.variableList=s={}),s[r]=t[r]}else n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}const NM=/^(\d+)x(\d+)$/,iS=/(.+?)=(".*?"|.*?)(?:,|$)/g;class ft{constructor(e,t){typeof e=="string"&&(e=ft.parseAttrList(e,t)),tt(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const r=new Uint8Array(t.length/2);for(let s=0;s<t.length/2;s++)r[s]=parseInt(t.slice(s*2,s*2+2),16);return r}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const r=this[e];return r?parseFloat(r):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const r=this[e];return(r?r.split(/[ ,]+/):[]).reduce((s,i)=>(s[i.toLowerCase()]=!0,s),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=NM.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let r;const s={};for(iS.lastIndex=0;(r=iS.exec(e))!==null;){const o=r[1].trim();let l=r[2];const u=l.indexOf('"')===0&&l.lastIndexOf('"')===l.length-1;let d=!1;if(u)l=l.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":d=!0}if(t&&(u||d))l=Im(t,l);else if(!d&&!u)switch(o){case"CLOSED-CAPTIONS":if(l==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Ze.warn(`${e}: attribute ${o} is missing quotes`)}s[o]=l}return s}}const OM="com.apple.hls.interstitial";function MM(n){return n!=="ID"&&n!=="CLASS"&&n!=="CUE"&&n!=="START-DATE"&&n!=="DURATION"&&n!=="END-DATE"&&n!=="END-ON-NEXT"}function FM(n){return n==="SCTE35-OUT"||n==="SCTE35-IN"||n==="SCTE35-CMD"}class mb{constructor(e,t,r=0){var s;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=t?.tagAnchor||null,this.tagOrder=(s=t?.tagOrder)!=null?s:r,t){const i=t.attr;for(const o in i)if(Object.prototype.hasOwnProperty.call(e,o)&&e[o]!==i[o]){Ze.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=o;break}e=tt(new ft({}),i,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const i=t?.endDate||new Date(this.attr["END-DATE"]);he(i.getTime())&&(this._endDate=i)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Ze.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(he(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===OM}get isValid(){return!!this.id&&!this._badValueForSameId&&he(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const BM=10;class UM{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&r>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let r=t.decryptdata;return r||(t.setKeyFormat(e.keyFormat),r=t.decryptdata),!!r&&e.matches(r)})}get hasProgramDateTime(){return this.fragments.length?he(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||BM}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let r=e.length;r--;)if(e[r].index>t)return e[r].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function gu(n,e){return n.length===e.length?!n.some((t,r)=>t!==e[r]):!1}function oS(n,e){return!n&&!e?!0:!n||!e?!1:gu(n,e)}function zi(n){return n==="AES-128"||n==="AES-256"||n==="AES-256-CTR"}function $p(n){switch(n){case"AES-128":case"AES-256":return Is.cbc;case"AES-256-CTR":return Is.ctr;default:throw new Error(`invalid full segment method ${n}`)}}function jp(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0))}function km(n){return Uint8Array.from(unescape(encodeURIComponent(n)),e=>e.charCodeAt(0))}function $M(n){const e=km(n).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function pb(n){const e=function(r,s,i){const o=r[s];r[s]=r[i],r[i]=o};e(n,0,3),e(n,1,2),e(n,4,5),e(n,6,7)}function gb(n){const e=n.split(":");let t=null;if(e[0]==="data"&&e.length===2){const r=e[1].split(";"),s=r[r.length-1].split(",");if(s.length===2){const i=s[0]==="base64",o=s[1];i?(r.splice(-1,1),t=jp(o)):t=$M(o)}}return t}const yu=typeof self<"u"?self:void 0;var ht={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},jt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function Gc(n){switch(n){case jt.FAIRPLAY:return ht.FAIRPLAY;case jt.PLAYREADY:return ht.PLAYREADY;case jt.WIDEVINE:return ht.WIDEVINE;case jt.CLEARKEY:return ht.CLEARKEY}}function Sh(n){switch(n){case ht.FAIRPLAY:return jt.FAIRPLAY;case ht.PLAYREADY:return jt.PLAYREADY;case ht.WIDEVINE:return jt.WIDEVINE;case ht.CLEARKEY:return jt.CLEARKEY}}function ia(n){const{drmSystems:e,widevineLicenseUrl:t}=n,r=e?[ht.FAIRPLAY,ht.WIDEVINE,ht.PLAYREADY,ht.CLEARKEY].filter(s=>!!e[s]):[];return!r[ht.WIDEVINE]&&t&&r.push(ht.WIDEVINE),r}const yb=(function(n){return yu!=null&&(n=yu.navigator)!=null&&n.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function jM(n,e,t,r){let s;switch(n){case ht.FAIRPLAY:s=["cenc","sinf"];break;case ht.WIDEVINE:case ht.PLAYREADY:s=["cenc"];break;case ht.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${n}`)}return VM(s,e,t,r)}function VM(n,e,t,r){return[{initDataTypes:n,persistentState:r.persistentState||"optional",distinctiveIdentifier:r.distinctiveIdentifier||"optional",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:e.map(i=>({contentType:`audio/mp4; codecs=${i}`,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null})),videoCapabilities:t.map(i=>({contentType:`video/mp4; codecs=${i}`,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}))}]}function GM(n){var e;return!!n&&(n.sessionType==="persistent-license"||!!((e=n.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function xb(n){const e=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),r=t.substring(t.indexOf("<"),t.length),o=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("KID")[0];if(o){const l=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(l){const u=jp(l).subarray(0,16);return pb(u),u}}return null}let Mi={};class bs{static clearKeyUriToKeyIdMap(){Mi={}}static setKeyIdForUri(e,t){Mi[e]=t}static addKeyIdForUri(e){const t=Object.keys(Mi).length%Number.MAX_SAFE_INTEGER,r=new Uint8Array(16);return new DataView(r.buffer,12,4).setUint32(0,t),Mi[e]=r,r}constructor(e,t,r,s=[1],i=null,o){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=s,this.iv=i,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!zi(e),o!=null&&o.startsWith("0x")&&(this.keyId=new Uint8Array(z1(o)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&gu(e.keyFormatVersions,this.keyFormatVersions)&&oS(e.iv,this.iv)&&oS(e.keyId,this.keyId)}isSupported(){if(this.method){if(zi(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case jt.FAIRPLAY:case jt.WIDEVINE:case jt.PLAYREADY:case jt.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(zi(this.method)){let i=this.iv;return i||(typeof e!="number"&&(Ze.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),i=KM(e)),new bs(this.method,this.uri,"identity",this.keyFormatVersions,i)}if(this.keyId){const i=Mi[this.uri];if(i&&!gu(this.keyId,i)&&bs.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const r=gb(this.uri);if(r)switch(this.keyFormat){case jt.WIDEVINE:if(this.pssh=r,!this.keyId){const i=YO(r.buffer);if(i.length){var s;const o=i[0];this.keyId=(s=o.kids)!=null&&s.length?o.kids[0]:null}}this.keyId||(this.keyId=aS(t));break;case jt.PLAYREADY:{const i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=WO(i,null,r),this.keyId=xb(r);break}default:{let i=r.subarray(0,16);if(i.length!==16){const o=new Uint8Array(16);o.set(i,16-i.length),i=o}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i;i=HM(t),i||(i=aS(t),i||(i=Mi[this.uri])),i&&(this.keyId=i,bs.setKeyIdForUri(this.uri,i))}return this}}function HM(n){const e=n?.[jt.WIDEVINE];return e?e.keyId:null}function aS(n){const e=n?.[jt.PLAYREADY];if(e){const t=gb(e.uri);if(t)return xb(t)}return null}function KM(n){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=n>>8*(15-t)&255;return e}const lS=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,cS=/#EXT-X-MEDIA:(.*)/g,zM=/^#EXT(?:INF|-X-TARGETDURATION):/m,Eh=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),WM=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class xr{static findGroup(e,t){for(let r=0;r<e.length;r++){const s=e[r];if(s.id===t)return s}}static resolve(e,t){return Pp.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return zM.test(e)}static parseMasterPlaylist(e,t){const r=rS(e),s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:r},i=[];if(lS.lastIndex=0,!e.startsWith("#EXTM3U"))return s.playlistParsingError=new Error("no EXTM3U delimiter"),s;let o;for(;(o=lS.exec(e))!=null;)if(o[1]){var l;const d=new ft(o[1],s),f=Im(s,o[2]),h={attrs:d,bitrate:d.decimalInteger("BANDWIDTH")||d.decimalInteger("AVERAGE-BANDWIDTH"),name:d.NAME,url:xr.resolve(f,t)},p=d.decimalResolution("RESOLUTION");p&&(h.width=p.width,h.height=p.height),fS(d.CODECS,h);const x=d["SUPPLEMENTAL-CODECS"];x&&(h.supplemental={},fS(x,h.supplemental)),(l=h.unknownCodecs)!=null&&l.length||i.push(h),s.levels.push(h)}else if(o[3]){const d=o[3],f=o[4];switch(d){case"SESSION-DATA":{const h=new ft(f,s),p=h["DATA-ID"];p&&(s.sessionData===null&&(s.sessionData={}),s.sessionData[p]=h);break}case"SESSION-KEY":{const h=uS(f,t,s);h.encrypted&&h.isSupported()?(s.sessionKeys===null&&(s.sessionKeys=[]),s.sessionKeys.push(h)):Ze.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${f}"`);break}case"DEFINE":{{const h=new ft(f,s);sS(s,h,t)}break}case"CONTENT-STEERING":{const h=new ft(f,s);s.contentSteering={uri:xr.resolve(h["SERVER-URI"],t),pathwayId:h["PATHWAY-ID"]||"."};break}case"START":{s.startTimeOffset=dS(f);break}}}const u=i.length>0&&i.length<s.levels.length;return s.levels=u?i:s.levels,s.levels.length===0&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,t,r){let s;const i={},o=r.levels,l={AUDIO:o.map(d=>({id:d.attrs.AUDIO,audioCodec:d.audioCodec})),SUBTITLES:o.map(d=>({id:d.attrs.SUBTITLES,textCodec:d.textCodec})),"CLOSED-CAPTIONS":[]};let u=0;for(cS.lastIndex=0;(s=cS.exec(e))!==null;){const d=new ft(s[1],r),f=d.TYPE;if(f){const h=l[f],p=i[f]||[];i[f]=p;const x=d.LANGUAGE,g=d["ASSOC-LANGUAGE"],E=d.CHANNELS,v=d.CHARACTERISTICS,b=d["INSTREAM-ID"],A={attrs:d,bitrate:0,id:u++,groupId:d["GROUP-ID"]||"",name:d.NAME||x||"",type:f,default:d.bool("DEFAULT"),autoselect:d.bool("AUTOSELECT"),forced:d.bool("FORCED"),lang:x,url:d.URI?xr.resolve(d.URI,t):""};if(g&&(A.assocLang=g),E&&(A.channels=E),v&&(A.characteristics=v),b&&(A.instreamId=b),h!=null&&h.length){const L=xr.findGroup(h,A.groupId)||h[0];hS(A,L,"audioCodec"),hS(A,L,"textCodec")}p.push(A)}}return i}static parseLevelPlaylist(e,t,r,s,i,o){var l;const u={url:t},d=new UM(t),f=d.fragments,h=[];let p=null,x=0,g=0,E=0,v=0,b=0,A=null,L=new yh(s,u),I,_,F,C=-1,P=!1,O=null,M;if(Eh.lastIndex=0,d.m3u8=e,d.hasVariableRefs=rS(e),((l=Eh.exec(e))==null?void 0:l[0])!=="#EXTM3U")return d.playlistParsingError=new Error("Missing format identifier #EXTM3U"),d;for(;(I=Eh.exec(e))!==null;){P&&(P=!1,L=new yh(s,u),L.playlistOffset=E,L.setStart(E),L.sn=x,L.cc=v,b&&(L.bitrate=b),L.level=r,p&&(L.initSegment=p,p.rawProgramDateTime&&(L.rawProgramDateTime=p.rawProgramDateTime,p.rawProgramDateTime=null),O&&(L.setByteRange(O),O=null)));const U=I[1];if(U){L.duration=parseFloat(U);const ne=(" "+I[2]).slice(1);L.title=ne||null,L.tagList.push(ne?["INF",U,ne]:["INF",U])}else if(I[3]){if(he(L.duration)){L.playlistOffset=E,L.setStart(E),F&&pS(L,F,d),L.sn=x,L.level=r,L.cc=v,f.push(L);const ne=(" "+I[3]).slice(1);L.relurl=Im(d,ne),Cm(L,A,h),A=L,E+=L.duration,x++,g=0,P=!0}}else{if(I=I[0].match(WM),!I){Ze.warn("No matches on slow regex match for level playlist!");continue}for(_=1;_<I.length&&I[_]===void 0;_++);const ne=(" "+I[_]).slice(1),q=(" "+I[_+1]).slice(1),te=I[_+2]?(" "+I[_+2]).slice(1):null;switch(ne){case"BYTERANGE":A?L.setByteRange(q,A):L.setByteRange(q);break;case"PROGRAM-DATE-TIME":L.rawProgramDateTime=q,L.tagList.push(["PROGRAM-DATE-TIME",q]),C===-1&&(C=f.length);break;case"PLAYLIST-TYPE":d.type&&Or(d,ne,I),d.type=q.toUpperCase();break;case"MEDIA-SEQUENCE":d.startSN!==0?Or(d,ne,I):f.length>0&&gS(d,ne,I),x=d.startSN=parseInt(q);break;case"SKIP":{d.skippedSegments&&Or(d,ne,I);const G=new ft(q,d),Q=G.decimalInteger("SKIPPED-SEGMENTS");if(he(Q)){d.skippedSegments+=Q;for(let D=Q;D--;)f.push(null);x+=Q}const ee=G.enumeratedString("RECENTLY-REMOVED-DATERANGES");ee&&(d.recentlyRemovedDateranges=(d.recentlyRemovedDateranges||[]).concat(ee.split("	")));break}case"TARGETDURATION":d.targetduration!==0&&Or(d,ne,I),d.targetduration=Math.max(parseInt(q),1);break;case"VERSION":d.version!==null&&Or(d,ne,I),d.version=parseInt(q);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":d.live||Or(d,ne,I),d.live=!1;break;case"#":(q||te)&&L.tagList.push(te?[q,te]:[q]);break;case"DISCONTINUITY":v++,L.tagList.push(["DIS"]);break;case"GAP":L.gap=!0,L.tagList.push([ne]);break;case"BITRATE":L.tagList.push([ne,q]),b=parseInt(q)*1e3,he(b)?L.bitrate=b:b=0;break;case"DATERANGE":{const G=new ft(q,d),Q=new mb(G,d.dateRanges[G.ID],d.dateRangeTagCount);d.dateRangeTagCount++,Q.isValid||d.skippedSegments?d.dateRanges[Q.id]=Q:Ze.warn(`Ignoring invalid DATERANGE tag: "${q}"`),L.tagList.push(["EXT-X-DATERANGE",q]);break}case"DEFINE":{{const G=new ft(q,d);"IMPORT"in G?DM(d,G,o):sS(d,G,t)}break}case"DISCONTINUITY-SEQUENCE":d.startCC!==0?Or(d,ne,I):f.length>0&&gS(d,ne,I),d.startCC=v=parseInt(q);break;case"KEY":{const G=uS(q,t,d);if(G.isSupported()){if(G.method==="NONE"){F=void 0;break}F||(F={});const Q=F[G.keyFormat];Q!=null&&Q.matches(G)||(Q&&(F=tt({},F)),F[G.keyFormat]=G)}else Ze.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${q}"`);break}case"START":d.startTimeOffset=dS(q);break;case"MAP":{const G=new ft(q,d);if(L.duration){const Q=new yh(s,u);mS(Q,G,r,F),p=Q,L.initSegment=p,p.rawProgramDateTime&&!L.rawProgramDateTime&&(L.rawProgramDateTime=p.rawProgramDateTime)}else{const Q=L.byteRangeEndOffset;if(Q){const ee=L.byteRangeStartOffset;O=`${Q-ee}@${ee}`}else O=null;mS(L,G,r,F),p=L,P=!0}p.cc=v;break}case"SERVER-CONTROL":{M&&Or(d,ne,I),M=new ft(q),d.canBlockReload=M.bool("CAN-BLOCK-RELOAD"),d.canSkipUntil=M.optionalFloat("CAN-SKIP-UNTIL",0),d.canSkipDateRanges=d.canSkipUntil>0&&M.bool("CAN-SKIP-DATERANGES"),d.partHoldBack=M.optionalFloat("PART-HOLD-BACK",0),d.holdBack=M.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{d.partTarget&&Or(d,ne,I);const G=new ft(q);d.partTarget=G.decimalFloatingPoint("PART-TARGET");break}case"PART":{let G=d.partList;G||(G=d.partList=[]);const Q=g>0?G[G.length-1]:void 0,ee=g++,D=new ft(q,d),$=new DO(D,L,u,ee,Q);G.push($),L.duration+=$.duration;break}case"PRELOAD-HINT":{const G=new ft(q,d);d.preloadHint=G;break}case"RENDITION-REPORT":{const G=new ft(q,d);d.renditionReports=d.renditionReports||[],d.renditionReports.push(G);break}default:Ze.warn(`line parsed but not handled: ${I}`);break}}}A&&!A.relurl?(f.pop(),E-=A.duration,d.partList&&(d.fragmentHint=A)):d.partList&&(Cm(L,A,h),L.cc=v,d.fragmentHint=L,F&&pS(L,F,d)),d.targetduration||(d.playlistParsingError=new Error("Missing Target Duration"));const H=f.length,Z=f[0],se=f[H-1];if(E+=d.skippedSegments*d.targetduration,E>0&&H&&se){d.averagetargetduration=E/H;const U=se.sn;d.endSN=U!=="initSegment"?U:0,d.live||(se.endList=!0),C>0&&(qM(f,C),Z&&h.unshift(Z))}return d.fragmentHint&&(E+=d.fragmentHint.duration),d.totalduration=E,h.length&&d.dateRangeTagCount&&Z&&vb(h,d),d.endCC=v,d}}function vb(n,e){let t=n.length;if(!t)if(e.hasProgramDateTime){const l=e.fragments[e.fragments.length-1];n.push(l),t++}else return;const r=n[t-1],s=e.live?1/0:e.totalduration,i=Object.keys(e.dateRanges);for(let l=i.length;l--;){const u=e.dateRanges[i[l]],d=u.startDate.getTime();u.tagAnchor=r.ref;for(let f=t;f--;){var o;if(((o=n[f])==null?void 0:o.sn)<e.startSN)break;const h=YM(e,d,n,f,s);if(h!==-1){u.tagAnchor=e.fragments[h].ref;break}}}}function YM(n,e,t,r,s){const i=t[r];if(i){const l=i.programDateTime;if(e>=l||r===0){var o;const u=(((o=t[r+1])==null?void 0:o.start)||s)-i.start;if(e<=l+u*1e3){const d=t[r].sn-n.startSN;if(d<0)return-1;const f=n.fragments;if(f.length>t.length){const p=(t[r+1]||f[f.length-1]).sn-n.startSN;for(let x=p;x>d;x--){const g=f[x].programDateTime;if(e>=g&&e<g+f[x].duration*1e3)return x}}return d}}}return-1}function uS(n,e,t){var r,s;const i=new ft(n,t),o=(r=i.METHOD)!=null?r:"",l=i.URI,u=i.hexadecimalInteger("IV"),d=i.KEYFORMATVERSIONS,f=(s=i.KEYFORMAT)!=null?s:"identity";l&&i.IV&&!u&&Ze.error(`Invalid IV: ${i.IV}`);const h=l?xr.resolve(l,e):"",p=(d||"1").split("/").map(Number).filter(Number.isFinite);return new bs(o,h,f,p,u,i.KEYID)}function dS(n){const t=new ft(n).decimalFloatingPoint("TIME-OFFSET");return he(t)?t:null}function fS(n,e){let t=(n||"").split(/[ ,]+/).filter(r=>r);["video","audio","text"].forEach(r=>{const s=t.filter(i=>Op(i,r));s.length&&(e[`${r}Codec`]=s.map(i=>i.split("/")[0]).join(","),t=t.filter(i=>s.indexOf(i)===-1))}),e.unknownCodecs=t}function hS(n,e,t){const r=e[t];r&&(n[t]=r)}function qM(n,e){let t=n[e];for(let r=e;r--;){const s=n[r];if(!s)return;s.programDateTime=t.programDateTime-s.duration*1e3,t=s}}function Cm(n,e,t){n.rawProgramDateTime?t.push(n):e!=null&&e.programDateTime&&(n.programDateTime=e.endProgramDateTime)}function mS(n,e,t,r){n.relurl=e.URI,e.BYTERANGE&&n.setByteRange(e.BYTERANGE),n.level=t,n.sn="initSegment",r&&(n.levelkeys=r),n.initSegment=null}function pS(n,e,t){n.levelkeys=e;const{encryptedFragments:r}=t;(!r.length||r[r.length-1].levelkeys!==e)&&Object.keys(e).some(s=>e[s].isCommonEncryption)&&r.push(n)}function Or(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function gS(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function Th(n,e){const t=e.startPTS;if(he(t)){let r=0,s;e.sn>n.sn?(r=t-n.start,s=n):(r=n.start-t,s=e),s.duration!==r&&s.setDuration(r)}else e.sn>n.sn?n.cc===e.cc&&n.minEndPTS?e.setStart(n.start+(n.minEndPTS-n.start)):e.setStart(n.start+n.duration):e.setStart(Math.max(n.start-e.duration,0))}function Sb(n,e,t,r,s,i,o){r-t<=0&&(o.warn("Fragment should have a positive duration",e),r=t+e.duration,i=s+e.duration);let u=t,d=r;const f=e.startPTS,h=e.endPTS;if(he(f)){const b=Math.abs(f-t);n&&b>n.totalduration?o.warn(`media timestamps and playlist times differ by ${b}s for level ${e.level} ${n.url}`):he(e.deltaPTS)?e.deltaPTS=Math.max(b,e.deltaPTS):e.deltaPTS=b,u=Math.max(t,f),t=Math.min(t,f),s=e.startDTS!==void 0?Math.min(s,e.startDTS):s,d=Math.min(r,h),r=Math.max(r,h),i=e.endDTS!==void 0?Math.max(i,e.endDTS):i}const p=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(r-e.start),e.startPTS=t,e.maxStartPTS=u,e.startDTS=s,e.endPTS=r,e.minEndPTS=d,e.endDTS=i;const x=e.sn;if(!n||x<n.startSN||x>n.endSN)return 0;let g;const E=x-n.startSN,v=n.fragments;for(v[E]=e,g=E;g>0;g--)Th(v[g],v[g-1]);for(g=E;g<v.length-1;g++)Th(v[g],v[g+1]);return n.fragmentHint&&Th(v[v.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,p}function XM(n,e,t){if(n===e)return;let r=null;const s=n.fragments;for(let f=s.length-1;f>=0;f--){const h=s[f].initSegment;if(h){r=h;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;let i;ZM(n,e,(f,h,p,x)=>{if((!e.startCC||e.skippedSegments)&&h.cc!==f.cc){const g=f.cc-h.cc;for(let E=p;E<x.length;E++)x[E].cc+=g;e.endCC=x[x.length-1].cc}he(f.startPTS)&&he(f.endPTS)&&(h.setStart(h.startPTS=f.startPTS),h.startDTS=f.startDTS,h.maxStartPTS=f.maxStartPTS,h.endPTS=f.endPTS,h.endDTS=f.endDTS,h.minEndPTS=f.minEndPTS,h.setDuration(f.endPTS-f.startPTS),h.duration&&(i=h),e.PTSKnown=e.alignedSliding=!0),f.hasStreams&&(h.elementaryStreams=f.elementaryStreams),h.loader=f.loader,f.hasStats&&(h.stats=f.stats),f.initSegment&&(h.initSegment=f.initSegment,r=f.initSegment)});const o=e.fragments,l=e.fragmentHint?o.concat(e.fragmentHint):o;if(r&&l.forEach(f=>{var h;f&&(!f.initSegment||f.initSegment.relurl===((h=r)==null?void 0:h.relurl))&&(f.initSegment=r)}),e.skippedSegments){if(e.deltaUpdateFailed=o.some(f=>!f),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let f=e.skippedSegments;f--;)o.shift();e.startSN=o[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=QM(n.dateRanges,e,t));const f=n.fragments.filter(h=>h.rawProgramDateTime);if(n.hasProgramDateTime&&!e.hasProgramDateTime)for(let h=1;h<l.length;h++)l[h].programDateTime===null&&Cm(l[h],l[h-1],f);vb(f,e)}e.endCC=o[o.length-1].cc}if(!e.startCC){var u;const f=bb(n,e.startSN-1);e.startCC=(u=f?.cc)!=null?u:o[0].cc}JM(n.partList,e.partList,(f,h)=>{h.elementaryStreams=f.elementaryStreams,h.stats=f.stats}),i?Sb(e,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS,t):Eb(n,e),o.length&&(e.totalduration=e.edge-o[0].start),e.driftStartTime=n.driftStartTime,e.driftStart=n.driftStart;const d=e.advancedDateTime;if(e.advanced&&d){const f=e.edge;e.driftStart||(e.driftStartTime=d,e.driftStart=f),e.driftEndTime=d,e.driftEnd=f}else e.driftEndTime=n.driftEndTime,e.driftEnd=n.driftEnd,e.advancedDateTime=n.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=n.requestScheduled)}function QM(n,e,t){const{dateRanges:r,recentlyRemovedDateranges:s}=e,i=tt({},n);s&&s.forEach(u=>{delete i[u]});const l=Object.keys(i).length;return l?(Object.keys(r).forEach(u=>{const d=i[u],f=new mb(r[u].attr,d);f.isValid?(i[u]=f,d||(f.tagOrder+=l)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${st(r[u].attr)}"`)}),i):r}function JM(n,e,t){if(n&&e){let r=0;for(let s=0,i=n.length;s<=i;s++){const o=n[s],l=e[s+r];o&&l&&o.index===l.index&&o.fragment.sn===l.fragment.sn?t(o,l):r--}}}function ZM(n,e,t){const r=e.skippedSegments,s=Math.max(n.startSN,e.startSN)-e.startSN,i=(n.fragmentHint?1:0)+(r?e.endSN:Math.min(n.endSN,e.endSN))-e.startSN,o=e.startSN-n.startSN,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,u=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;for(let d=s;d<=i;d++){const f=u[o+d];let h=l[d];if(r&&!h&&f&&(h=e.fragments[d]=f),f&&h){t(f,h,d,l);const p=f.relurl,x=h.relurl;if(p&&eF(p,x)){e.playlistParsingError=yS(`media sequence mismatch ${h.sn}:`,n,e,f,h);return}else if(f.cc!==h.cc){e.playlistParsingError=yS(`discontinuity sequence mismatch (${f.cc}!=${h.cc})`,n,e,f,h);return}}}}function yS(n,e,t,r,s){return new Error(`${n} ${s.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function Eb(n,e,t=!0){const r=e.startSN+e.skippedSegments-n.startSN,s=n.fragments,i=r>=0;let o=0;if(i&&r<s.length)o=s[r].start;else if(i&&e.startSN===n.endSN+1)o=n.fragmentEnd;else if(i&&t)o=n.fragmentStart+r*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)o=n.fragmentStart;else return;_m(e,o)}function _m(n,e){if(e){const t=n.fragments;for(let r=n.skippedSegments;r<t.length;r++)t[r].addStart(e);n.fragmentHint&&n.fragmentHint.addStart(e)}}function Tb(n,e=1/0){let t=1e3*n.targetduration;if(n.updated){const r=n.fragments;if(r.length&&t*4>e){const i=r[r.length-1].duration*1e3;i<t&&(t=i)}}else t/=2;return Math.round(t)}function bb(n,e,t){if(!n)return null;let r=n.fragments[e-n.startSN];return r||(r=n.fragmentHint,r&&r.sn===e)?r:e<n.startSN&&t&&t.sn===e?t:null}function xS(n,e,t){return n?wb(n.partList,e,t):null}function wb(n,e,t){if(n)for(let r=n.length;r--;){const s=n[r];if(s.index===t&&s.fragment.sn===e)return s}return null}function Ab(n){n.forEach((e,t)=>{var r;(r=e.details)==null||r.fragments.forEach(s=>{s.level=t,s.initSegment&&(s.initSegment.level=t)})})}function eF(n,e){return n!==e&&e?vS(n)!==vS(e):!1}function vS(n){return n.replace(/\?[^?]*$/,"")}function fa(n,e){for(let r=0,s=n.length;r<s;r++){var t;if(((t=n[r])==null?void 0:t.cc)===e)return n[r]}return null}function tF(n,e){return!!(n&&e.startCC<n.endCC&&e.endCC>n.startCC)}function SS(n,e){const t=n.start+e;n.startPTS=t,n.setStart(t),n.endPTS=t+n.duration}function Lb(n,e){const t=e.fragments;for(let r=0,s=t.length;r<s;r++)SS(t[r],n);e.fragmentHint&&SS(e.fragmentHint,n),e.alignedSliding=!0}function nF(n,e){n&&(Rb(e,n),e.alignedSliding||xu(e,n),!e.alignedSliding&&!e.skippedSegments&&Eb(n,e,!1))}function Rb(n,e){if(!tF(e,n))return;const t=Math.min(e.endCC,n.endCC),r=fa(e.fragments,t),s=fa(n.fragments,t);if(!r||!s)return;Ze.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const i=r.start-s.start;Lb(i,n)}function xu(n,e){if(!n.hasProgramDateTime||!e.hasProgramDateTime)return;const t=n.fragments,r=e.fragments;if(!t.length||!r.length)return;let s,i;const o=Math.min(e.endCC,n.endCC);e.startCC<o&&n.startCC<o&&(s=fa(r,o),i=fa(t,o)),(!s||!i)&&(s=r[Math.floor(r.length/2)],i=fa(t,s.cc)||t[Math.floor(t.length/2)]);const l=s.programDateTime,u=i.programDateTime;if(!l||!u)return;const d=(u-l)/1e3-(i.start-s.start);Lb(d,n)}function tn(n,e,t){dn(n,e,t),n.addEventListener(e,t)}function dn(n,e,t){n.removeEventListener(e,t)}const rF={toString:function(n){let e="";const t=n.length;for(let r=0;r<t;r++)e+=`[${n.start(r).toFixed(3)}-${n.end(r).toFixed(3)}]`;return e}},re={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Vp extends fb{constructor(e,t,r,s,i){super(s,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=re.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:o,fragCurrent:l,media:u,mediaBuffer:d,state:f}=this,h=u?u.currentTime:0,p=Oe.bufferInfo(d||u,h,o.maxBufferHole),x=!p.len;if(this.log(`Media seeking to ${he(h)?h.toFixed(3):h}, state: ${f}, ${x?"out of":"in"} buffer`),this.state===re.ENDED)this.resetLoadingState();else if(l){const g=o.maxFragLookUpTolerance,E=l.start-g,v=l.start+l.duration+g;if(x||v<p.start||E>p.end){const b=h>v;(h<E||b)&&(b&&l.loader&&(this.log(`Cancelling fragment load for seek (sn: ${l.sn})`),l.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(u){this.fragmentTracker.removeFragmentsInRange(h,1/0,this.playlistType,!0);const g=this.lastCurrentTime;if(h>g&&(this.lastCurrentTime=h),!this.loadingParts){const E=Math.max(p.end,h),v=this.shouldLoadParts(this.getLevelDetails(),E);v&&(this.log(`LL-Part loading ON after seeking to ${h.toFixed(2)} with buffer @${E.toFixed(2)}`),this.loadingParts=v)}}this.hls.hasEnoughToStart||(this.log(`Setting ${x?"startPosition":"nextLoadPosition"} to ${h} for seek without enough to start`),this.nextLoadPosition=h,x&&(this.startPosition=h)),x&&this.state===re.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=i,this.hls=e,this.fragmentLoader=new _M(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Bp(e.config)}registerListeners(){const{hls:e}=this;e.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(R.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(R.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===re.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=re.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const r=e.end||0,s=this.config.timelineOffset||0;if(r<=s)return!1;const i=e.buffered;this.config.maxBufferHole&&i&&i.length>1&&(e=Oe.bufferedInfo(i,e.start,0));const o=e.nextStart;if(o&&o>s&&o<t.edge||this.media.currentTime<e.start)return!1;const u=t.partList;if(u!=null&&u.length){const f=u[u.length-1];return Oe.isBuffered(this.media,f.start+f.duration/2)}const d=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(d)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const r=this.media=this.mediaBuffer=t.media;tn(r,"seeking",this.onMediaSeeking),tn(r,"ended",this.onMediaEnded);const s=this.config;this.levels&&s.autoStartLoad&&this.state===re.STOPPED&&this.startLoad(s.startPosition)}onMediaDetaching(e,t){const r=!!t.transferMedia,s=this.media;if(s!==null){if(s.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),dn(s,"seeking",this.onMediaSeeking),dn(s,"ended",this.onMediaEnded),this.keyLoader&&!r&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,r){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=re.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this.startFragRequested=!0,this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(e,t,r){const s=i=>{const o=i.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${i.part?" part: "+i.part.index:""} of ${this.fragInfo(o,!1,i.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(i)};this._doFragLoad(e,t,r,s).then(i=>{if(!i)return;const o=this.state,l=i.frag;if(this.fragContextChanged(l)){(o===re.FRAG_LOADING||!this.fragCurrent&&o===re.PARSING)&&(this.fragmentTracker.removeFragment(l),this.state=re.IDLE);return}"payload"in i&&(this.log(`Loaded ${l.type} sn: ${l.sn} of ${this.playlistLabel()} ${l.level}`),this.hls.trigger(R.FRAG_LOADED,i)),this._handleFragmentLoadComplete(i)}).catch(i=>{this.state===re.STOPPED||this.state===re.ERROR||(this.warn(`Frag error: ${i?.message||i}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:r}=this;if(r.getState(e)===Ct.APPENDING){const i=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,i),l=Math.max(e.duration,o?o.len:this.config.maxBufferLength),u=this.backtrackFragment;((u?e.sn-u.sn:0)===1||this.reduceMaxBufferLength(l,e.duration))&&r.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===Ct.PARTIAL&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return t?.live&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,r=null){if(!(e-t))return;const s={startOffset:e,endOffset:t,type:r};this.hls.trigger(R.BUFFER_FLUSHING,s)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(r=>{const s=r?.frag;if(!s||this.fragContextChanged(s)||!this.levels)throw new Error("init load aborted");return r}).then(r=>{const{hls:s}=this,{frag:i,payload:o}=r,l=i.decryptdata;if(o&&o.byteLength>0&&l!=null&&l.key&&l.iv&&zi(l.method)){const u=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),l.key.buffer,l.iv.buffer,$p(l.method)).catch(d=>{throw s.trigger(R.ERROR,{type:we.MEDIA_ERROR,details:z.FRAG_DECRYPT_ERROR,fatal:!1,error:d,reason:d.message,frag:i}),d}).then(d=>{const f=self.performance.now();return s.trigger(R.FRAG_DECRYPTED,{frag:i,payload:d,stats:{tstart:u,tdecrypt:f}}),r.payload=d,this.completeInitSegmentLoad(r)})}return this.completeInitSegmentLoad(r)}).catch(r=>{this.state===re.STOPPED||this.state===re.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const r=e.frag.stats;this.state!==re.STOPPED&&(this.state=re.IDLE),e.frag.data=new Uint8Array(e.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var r,s;const i=e.tracks;if(i&&!t.encrypted&&((r=i.audio)!=null&&r.encrypted||(s=i.video)!=null&&s.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const o=this.media,l=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${o?"attached mediaKeys: "+o.mediaKeys:"detached"})`);return this.warn(l.message),!o||o.mediaKeys?!1:(this.hls.trigger(R.ERROR,{type:we.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_KEYS,fatal:!1,error:l,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const r=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${r?rF.toString(Oe.getBuffered(r)):"(detached)"})`),Tt(e)){var s;if(e.type!==ge.SUBTITLE){const o=e.elementaryStreams;if(!Object.keys(o).some(l=>!!o[l])){this.state=re.IDLE;return}}const i=(s=this.levels)==null?void 0:s[e.level];i!=null&&i.fragmentError&&(this.log(`Resetting level fragment error count of ${i.fragmentError} on frag buffered`),i.fragmentError=0)}this.state=re.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:r,part:s,partsLoaded:i}=e,o=!i||i.length===0||i.some(u=>!u),l=new Up(r.level,r.sn,r.stats.chunkCount+1,0,s?s.index:-1,!o);t.flush(l)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,r=null,s){var i;this.fragCurrent=e;const o=t.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let l=null;if(e.encrypted&&!((i=e.decryptdata)!=null&&i.key)){if(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=re.KEY_LOADING,this.fragCurrent=e,l=this.keyLoader.load(e).then(p=>{if(!this.fragContextChanged(p.frag))return this.hls.trigger(R.KEY_LOADED,p),this.state===re.KEY_LOADING&&(this.state=re.IDLE),p}),this.hls.trigger(R.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(l=this.keyLoader.loadClear(e,o.encryptedFragments,this.startFragRequested),l&&this.log("[eme] blocking frag load until media-keys acquired"));const u=this.fragPrevious;if(Tt(e)&&(!u||e.sn!==u.sn)){const p=this.shouldLoadParts(t.details,e.end);p!==this.loadingParts&&(this.log(`LL-Part loading ${p?"ON":"OFF"} loading sn ${u?.sn}->${e.sn}`),this.loadingParts=p)}if(r=Math.max(e.start,r||0),this.loadingParts&&Tt(e)){const p=o.partList;if(p&&s){r>o.fragmentEnd&&o.fragmentHint&&(e=o.fragmentHint);const x=this.getNextPart(p,e,r);if(x>-1){const g=p[x];e=this.fragCurrent=g.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${g.index} (${x}/${p.length-1}) of ${this.fragInfo(e,!1,g)}) cc: ${e.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=g.start+g.duration,this.state=re.FRAG_LOADING;let E;return l?E=l.then(v=>!v||this.fragContextChanged(v.frag)?null:this.doFragPartsLoad(e,g,t,s)).catch(v=>this.handleFragLoadError(v)):E=this.doFragPartsLoad(e,g,t,s).catch(v=>this.handleFragLoadError(v)),this.hls.trigger(R.FRAG_LOADING,{frag:e,part:g,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):E}else if(!e.url||this.loadedEndOfParts(p,r))return Promise.resolve(null)}}if(Tt(e)&&this.loadingParts){var d;this.log(`LL-Part loading OFF after next part miss @${r.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(d=o.partList)==null?void 0:d.filter(p=>p.loaded).map(p=>`[${p.start}-${p.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+o.startSN+"-"+o.endSN+"]"}, target: ${parseFloat(r.toFixed(3))}`),he(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=re.FRAG_LOADING;const f=this.config.progressive&&e.type!==ge.SUBTITLE;let h;return f&&l?h=l.then(p=>!p||this.fragContextChanged(p.frag)?null:this.fragmentLoader.load(e,s)).catch(p=>this.handleFragLoadError(p)):h=Promise.all([this.fragmentLoader.load(e,f?s:void 0),l]).then(([p])=>(!f&&s&&s(p),p)).catch(p=>this.handleFragLoadError(p)),this.hls.trigger(R.FRAG_LOADING,{frag:e,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):h}doFragPartsLoad(e,t,r,s){return new Promise((i,o)=>{var l;const u=[],d=(l=r.details)==null?void 0:l.partList,f=h=>{this.fragmentLoader.loadPart(e,h,s).then(p=>{u[h.index]=p;const x=p.part;this.hls.trigger(R.FRAG_LOADED,p);const g=xS(r.details,e.sn,h.index+1)||wb(d,e.sn,h.index+1);if(g)f(g);else return i({frag:e,part:x,partsLoaded:u})}).catch(o)};f(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===z.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===we.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(R.ERROR,t)}else this.hls.trigger(R.ERROR,{type:we.OTHER_ERROR,details:z.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==re.PARSING){!this.fragCurrent&&this.state!==re.STOPPED&&this.state!==re.ERROR&&(this.state=re.IDLE);return}const{frag:r,part:s,level:i}=t,o=self.performance.now();r.stats.parsing.end=o,s&&(s.stats.parsing.end=o);const l=this.getLevelDetails(),d=l&&r.sn>l.endSN||this.shouldLoadParts(l,r.end);d!==this.loadingParts&&(this.log(`LL-Part loading ${d?"ON":"OFF"} after parsing segment ending @${r.end.toFixed(2)}`),this.loadingParts=d),this.updateLevelTiming(r,s,i,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var r;const i=e.partList[0];if(i.fragment.type===ge.SUBTITLE)return!1;const o=i.end+(((r=e.fragmentHint)==null?void 0:r.duration)||0);if(t>=o){var s;if((this.hls.hasEnoughToStart?((s=this.media)==null?void 0:s.currentTime)||this.lastCurrentTime:this.getLoadPosition())>i.start-i.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:r}=this,{level:s,sn:i,part:o}=e;if(!(t!=null&&t[s]))return this.warn(`Levels object was unset while buffering fragment ${i} of ${this.playlistLabel()} ${s}. The current chunk will not be buffered.`),null;const l=t[s],u=l.details,d=o>-1?xS(u,i,o):null,f=d?d.fragment:bb(u,i,r);return f?(r&&r!==f&&(f.stats=r.stats),{frag:f,part:d,level:l}):null}bufferFragmentData(e,t,r,s,i){if(this.state!==re.PARSING)return;const{data1:o,data2:l}=e;let u=o;if(l&&(u=$n(o,l)),!u.length)return;const d=this.initPTS[t.cc],f=d?-d.baseTime/d.timescale:void 0,h={type:e.type,frag:t,part:r,chunkMeta:s,offset:f,parent:t.type,data:u};if(this.hls.trigger(R.BUFFER_APPENDING,h),e.dropped&&e.independent&&!r){if(i)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Oe.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const r=t.currentTime,s=Oe.bufferInfo(t,r,0),i=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,i*.25),l=Math.max(Math.min(e.start-o,s.end-o),r+o);e.start-l>o&&this.flushMainBuffer(l,e.start)}getFwdBufferInfo(e,t){var r;const s=this.getLoadPosition();if(!he(s))return null;const o=this.lastCurrentTime>s||(r=this.media)!=null&&r.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,s,t,o)}getFwdBufferInfoAtPos(e,t,r,s){const i=Oe.bufferInfo(e,t,s);if(i.len===0&&i.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(t,r);if(o&&(i.nextStart<=o.end||o.gap)){const l=Math.max(Math.min(i.nextStart,o.end)-t,s);return Oe.bufferInfo(e,t,l)}}return i}getMaxBufferLength(e){const{config:t}=this;let r;return e?r=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):r=t.maxBufferLength,Math.min(r,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const r=this.config,s=Math.max(Math.min(e-t,r.maxBufferLength),t),i=Math.max(e-t*3,r.maxMaxBufferLength/2,s);return i>=s?(r.maxMaxBufferLength=i,this.warn(`Reduce max buffer length to ${i}s`),!0):!1}getAppendedFrag(e,t=ge.MAIN){const r=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){const r=t.fragments,s=r.length;if(!s)return null;const{config:i}=this,o=r[0].start,l=i.lowLatencyMode&&!!t.partList;let u=null;if(t.live){const h=i.initialLiveManifestSize;if(s<h)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${h})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o){var d;l&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),u=this.getInitialLiveFragment(t);const p=this.hls.startPosition,x=this.hls.liveSyncPosition,g=u?(p!==-1&&p>=o?p:x)||u.start:e;this.log(`Setting startPosition to ${g} to match start frag at live edge. mainStart: ${p} liveSyncPosition: ${x} frag.start: ${(d=u)==null?void 0:d.start}`),this.startPosition=this.nextLoadPosition=g}}else e<=o&&(u=r[0]);if(!u){const h=this.loadingParts?t.partEnd:t.fragmentEnd;u=this.getFragmentAtPosition(e,h,t)}let f=this.filterReplacedPrimary(u,t);if(!f&&u){const h=u.sn-t.startSN;f=this.filterReplacedPrimary(r[h+1]||null,t)}return this.mapToInitFragWhenRequired(f)}isLoopLoading(e,t){const r=this.fragmentTracker.getState(e);return(r===Ct.OK||r===Ct.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,r,s,i){let o=null;if(e.gap&&(o=this.getNextFragment(this.nextLoadPosition,t),o&&!o.gap&&r.nextStart)){const l=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,s,0);if(l!==null&&r.len+l.len>=i){const u=o.sn;return this.loopSn!==u&&(this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${u}`),this.loopSn=u),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(ES(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(ES(this.config)&&e.type!==ge.SUBTITLE){const r=this.hls.interstitialsManager,s=r?.bufferingItem;if(s){const o=s.event;if(o){if(o.appendInPlace||Math.abs(e.start-s.start)>1||s.start===0)return null}else if(e.end<=s.start&&t?.live===!1||e.start>s.end&&s.nextEvent&&(s.nextEvent.appendInPlace||e.start-s.end>1))return null}const i=r?.playerQueue;if(i)for(let o=i.length;o--;){const l=i[o].interstitial;if(l.appendInPlace&&e.start>=l.startTime&&e.end<=l.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,r){let s=-1,i=!1,o=!0;for(let l=0,u=e.length;l<u;l++){const d=e[l];if(o=o&&!d.independent,s>-1&&r<d.start)break;const f=d.loaded;f?s=-1:(i||(d.independent||o)&&d.fragment===t)&&(d.fragment!==t&&this.warn(`Need buffer at ${r} but next unloaded part starts at ${d.start}`),s=l),i=f}return s}loadedEndOfParts(e,t){let r;for(let s=e.length;s--;){if(r=e[s],!r.loaded)return!1;if(t>r.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,r=this.fragPrevious;let s=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),s=vM(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){const i=r.sn+1;if(i>=e.startSN&&i<=e.endSN){const o=t[i-e.startSN];r.cc===o.cc&&(s=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=cb(e,r.cc,r.end),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{const i=this.hls.liveSyncPosition;i!==null&&(s=this.getFragmentAtPosition(i,this.bitrateTest?e.fragmentEnd:e.edge,e))}return s}getFragmentAtPosition(e,t,r){const{config:s}=this;let{fragPrevious:i}=this,{fragments:o,endSN:l}=r;const{fragmentHint:u}=r,{maxFragLookUpTolerance:d}=s,f=r.partList,h=!!(this.loadingParts&&f!=null&&f.length&&u);h&&!this.bitrateTest&&f[f.length-1].fragment.sn===u.sn&&(o=o.concat(u),l=u.sn);let p;if(e<t){var x;const E=e<this.lastCurrentTime||e>t-d||(x=this.media)!=null&&x.paused||!this.startFragRequested?0:d;p=oi(i,o,e,E)}else p=o[o.length-1];if(p){const g=p.sn-r.startSN,E=this.fragmentTracker.getState(p);if((E===Ct.OK||E===Ct.PARTIAL&&p.gap)&&(i=p),i&&p.sn===i.sn&&(!h||f[0].fragment.sn>p.sn||!r.live)&&p.level===i.level){const b=o[g+1];p.sn<l&&this.fragmentTracker.getState(b)!==Ct.OK?p=b:p=null}}return p}alignPlaylists(e,t,r){const s=e.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;const i=e.fragmentStart,o=!t,l=e.alignedSliding&&he(i);if(o||!l&&!i){nF(r,e);const u=e.fragmentStart;return this.log(`Live playlist sliding: ${u.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${s}`),u}return i}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let r=this.startPosition;r<t&&(r=-1);const s=this.timelineOffset;if(r===-1){const i=this.startTimeOffset!==null,o=i?this.startTimeOffset:e.startTimeOffset;o!==null&&he(o)?(r=t+o,o<0&&(r+=e.edge),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Setting startPosition to ${r} for start time offset ${o} found in ${i?"multivariant":"media"} playlist`),this.startPosition=r):e.live?(r=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${r}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=r=0),this.lastCurrentTime=r+s}this.nextLoadPosition=r+s}getLoadPosition(){var e;const{media:t}=this;let r=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?r=t.currentTime:this.nextLoadPosition>=0&&(r=this.nextLoadPosition),r}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Tt(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==re.FRAG_LOADING_WAITING_RETRY)&&(this.state=re.IDLE)}onFragmentOrKeyLoadError(e,t){var r;if(t.chunkMeta&&!t.frag){const b=this.getCurrentContext(t.chunkMeta);b&&(t.frag=b.frag)}const s=t.frag;if(!s||s.type!==e||!this.levels)return;if(this.fragContextChanged(s)){var i;this.warn(`Frag load error must match current frag to retry ${s.url} > ${(i=this.fragCurrent)==null?void 0:i.url}`);return}const o=t.details===z.FRAG_GAP;o&&this.fragmentTracker.fragBuffered(s,!0);const l=t.errorAction;if(!l){this.state=re.ERROR;return}const{action:u,flags:d,retryCount:f=0,retryConfig:h}=l,p=!!h,x=p&&u===Ut.RetryRequest,g=p&&!l.resolved&&d===bn.MoveAllAlternatesMatchingHost,E=(r=this.hls.latestLevelDetails)==null?void 0:r.live;if(!x&&g&&Tt(s)&&!s.endList&&E&&!db(t))this.resetFragmentErrors(e),this.treatAsGap(s),l.resolved=!0;else if((x||g)&&f<h.maxNumRetry){var v;const b=Rm((v=t.response)==null?void 0:v.code),A=Fp(h,f);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+A,this.state=re.FRAG_LOADING_WAITING_RETRY,l.resolved=!0,b){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${s.sn} of ${e} ${s.level} errored with ${t.details}, retrying loading ${f+1}/${h.maxNumRetry} in ${A}ms`)}else if(h)if(this.resetFragmentErrors(e),f<h.maxNumRetry)!o&&u!==Ut.RemoveAlternatePermanently&&(l.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${f})`);return}else u===Ut.SendAlternateToPenaltyBox?this.state=re.WAITING_LEVEL:this.state=re.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,r=t===1/0;(!t||e>=t||r&&!Rm(0))&&(r&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=re.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===re.PARSING||this.state===re.PARSED){const t=e.frag,r=e.parent,s=this.getFwdBufferInfo(this.mediaBuffer,r),i=s&&s.len>.5;i&&this.reduceMaxBufferLength(s.len,t?.duration||10);const o=!i;return o&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${r} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(e){e===ge.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==re.STOPPED&&(this.state=re.IDLE)}afterBufferFlushed(e,t,r){if(!e)return;const s=Oe.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,s,r),this.state===re.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==re.STOPPED&&(this.state=re.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,r,s){const i=r.details;if(!i){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((u,d)=>{const f=e.elementaryStreams[d];if(f){const h=f.endPTS-f.startPTS;if(h<=0)return this.warn(`Could not parse fragment ${e.sn} ${d} duration reliably (${h})`),u||!1;const p=s?0:Sb(i,e,f.startPTS,f.endPTS,f.startDTS,f.endDTS,this);return this.hls.trigger(R.LEVEL_PTS_UPDATED,{details:i,level:r,drift:p,type:d,frag:e,start:f.startPTS,end:f.endPTS}),!0}return u},!1)){var l;const u=((l=this.transmuxer)==null?void 0:l.error)===null;if((r.fragmentError===0||u&&(r.fragmentError<2||e.endList))&&this.treatAsGap(e,r),u){const d=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(d.message),this.hls.trigger(R.ERROR,{type:we.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!1,error:d,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=re.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(R.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===ge.MAIN?"level":"track"}fragInfo(e,t=!0,r){var s,i;return`${this.playlistLabel()} ${e.level} (${r?"part":"frag"}:[${((s=t&&!r?e.startPTS:(r||e).start)!=null?s:NaN).toFixed(3)}-${((i=t&&!r?e.endPTS:(r||e).end)!=null?i:NaN).toFixed(3)}]${r&&e.type==="main"?"INDEPENDENT="+(r.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function ES(n){return!!n.interstitialsController&&n.enableInterstitialPlayback!==!1}class Ib{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let r;if(e.length)e.length===1?r=e[0]:r=sF(e,t);else return new Uint8Array(0);return this.reset(),r}reset(){this.chunks.length=0,this.dataLength=0}}function sF(n,e){const t=new Uint8Array(e);let r=0;for(let s=0;s<n.length;s++){const i=n[s];t.set(i,r),r+=i.length}return t}var bh={exports:{}},TS;function iF(){return TS||(TS=1,(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function s(u,d,f){this.fn=u,this.context=d,this.once=f||!1}function i(u,d,f,h,p){if(typeof f!="function")throw new TypeError("The listener must be a function");var x=new s(f,h||u,p),g=t?t+d:d;return u._events[g]?u._events[g].fn?u._events[g]=[u._events[g],x]:u._events[g].push(x):(u._events[g]=x,u._eventsCount++),u}function o(u,d){--u._eventsCount===0?u._events=new r:delete u._events[d]}function l(){this._events=new r,this._eventsCount=0}l.prototype.eventNames=function(){var d=[],f,h;if(this._eventsCount===0)return d;for(h in f=this._events)e.call(f,h)&&d.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(f)):d},l.prototype.listeners=function(d){var f=t?t+d:d,h=this._events[f];if(!h)return[];if(h.fn)return[h.fn];for(var p=0,x=h.length,g=new Array(x);p<x;p++)g[p]=h[p].fn;return g},l.prototype.listenerCount=function(d){var f=t?t+d:d,h=this._events[f];return h?h.fn?1:h.length:0},l.prototype.emit=function(d,f,h,p,x,g){var E=t?t+d:d;if(!this._events[E])return!1;var v=this._events[E],b=arguments.length,A,L;if(v.fn){switch(v.once&&this.removeListener(d,v.fn,void 0,!0),b){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,f),!0;case 3:return v.fn.call(v.context,f,h),!0;case 4:return v.fn.call(v.context,f,h,p),!0;case 5:return v.fn.call(v.context,f,h,p,x),!0;case 6:return v.fn.call(v.context,f,h,p,x,g),!0}for(L=1,A=new Array(b-1);L<b;L++)A[L-1]=arguments[L];v.fn.apply(v.context,A)}else{var I=v.length,_;for(L=0;L<I;L++)switch(v[L].once&&this.removeListener(d,v[L].fn,void 0,!0),b){case 1:v[L].fn.call(v[L].context);break;case 2:v[L].fn.call(v[L].context,f);break;case 3:v[L].fn.call(v[L].context,f,h);break;case 4:v[L].fn.call(v[L].context,f,h,p);break;default:if(!A)for(_=1,A=new Array(b-1);_<b;_++)A[_-1]=arguments[_];v[L].fn.apply(v[L].context,A)}}return!0},l.prototype.on=function(d,f,h){return i(this,d,f,h,!1)},l.prototype.once=function(d,f,h){return i(this,d,f,h,!0)},l.prototype.removeListener=function(d,f,h,p){var x=t?t+d:d;if(!this._events[x])return this;if(!f)return o(this,x),this;var g=this._events[x];if(g.fn)g.fn===f&&(!p||g.once)&&(!h||g.context===h)&&o(this,x);else{for(var E=0,v=[],b=g.length;E<b;E++)(g[E].fn!==f||p&&!g[E].once||h&&g[E].context!==h)&&v.push(g[E]);v.length?this._events[x]=v.length===1?v[0]:v:o(this,x)}return this},l.prototype.removeAllListeners=function(d){var f;return d?(f=t?t+d:d,this._events[f]&&o(this,f)):(this._events=new r,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=t,l.EventEmitter=l,n.exports=l})(bh)),bh.exports}var oF=iF(),Gp=_O(oF);const Ia="1.6.15",Zi={};function aF(){return typeof __HLS_WORKER_BUNDLE__=="function"}function lF(){const n=Zi[Ia];if(n)return n.clientCount++,n;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),s={worker:new self.Worker(t),objectURL:t,clientCount:1};return Zi[Ia]=s,s}function cF(n){const e=Zi[n];if(e)return e.clientCount++,e;const t=new self.URL(n,self.location.href).href,s={worker:new self.Worker(t),scriptURL:t,clientCount:1};return Zi[n]=s,s}function uF(n){const e=Zi[n||Ia];if(e&&e.clientCount--===1){const{worker:r,objectURL:s}=e;delete Zi[n||Ia],s&&self.URL.revokeObjectURL(s),r.terminate()}}function kb(n,e){return e+10<=n.length&&n[e]===51&&n[e+1]===68&&n[e+2]===73&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function Hp(n,e){return e+10<=n.length&&n[e]===73&&n[e+1]===68&&n[e+2]===51&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function Wu(n,e){let t=0;return t=(n[e]&127)<<21,t|=(n[e+1]&127)<<14,t|=(n[e+2]&127)<<7,t|=n[e+3]&127,t}function ka(n,e){const t=e;let r=0;for(;Hp(n,e);){r+=10;const s=Wu(n,e+6);r+=s,kb(n,e+10)&&(r+=10),e+=r}if(r>0)return n.subarray(t,t+r)}function dF(n,e,t,r){const s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],i=e[t+2],o=i>>2&15;if(o>12){const x=new Error(`invalid ADTS sampling index:${o}`);n.emit(R.ERROR,R.ERROR,{type:we.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!0,error:x,reason:x.message});return}const l=(i>>6&3)+1,u=e[t+3]>>6&3|(i&1)<<2,d="mp4a.40."+l,f=s[o];let h=o;(l===5||l===29)&&(h-=3);const p=[l<<3|(h&14)>>1,(h&1)<<7|u<<3];return Ze.log(`manifest codec:${r}, parsed codec:${d}, channels:${u}, rate:${f} (ADTS object type:${l} sampling index:${o})`),{config:p,samplerate:f,channelCount:u,codec:d,parsedCodec:d,manifestCodec:r}}function Cb(n,e){return n[e]===255&&(n[e+1]&246)===240}function _b(n,e){return n[e+1]&1?7:9}function Kp(n,e){return(n[e+3]&3)<<11|n[e+4]<<3|(n[e+5]&224)>>>5}function fF(n,e){return e+5<n.length}function vu(n,e){return e+1<n.length&&Cb(n,e)}function hF(n,e){return fF(n,e)&&Cb(n,e)&&Kp(n,e)<=n.length-e}function mF(n,e){if(vu(n,e)){const t=_b(n,e);if(e+t>=n.length)return!1;const r=Kp(n,e);if(r<=t)return!1;const s=e+r;return s===n.length||vu(n,s)}return!1}function Pb(n,e,t,r,s){if(!n.samplerate){const i=dF(e,t,r,s);if(!i)return;tt(n,i)}}function Db(n){return 1024*9e4/n}function pF(n,e){const t=_b(n,e);if(e+t<=n.length){const r=Kp(n,e)-t;if(r>0)return{headerLength:t,frameLength:r}}}function Nb(n,e,t,r,s){const i=Db(n.samplerate),o=r+s*i,l=pF(e,t);let u;if(l){const{frameLength:h,headerLength:p}=l,x=p+h,g=Math.max(0,t+x-e.length);g?(u=new Uint8Array(x-p),u.set(e.subarray(t+p,e.length),0)):u=e.subarray(t+p,t+x);const E={unit:u,pts:o};return g||n.samples.push(E),{sample:E,length:x,missing:g}}const d=e.length-t;return u=new Uint8Array(d),u.set(e.subarray(t,e.length),0),{sample:{unit:u,pts:o},length:d,missing:-1}}function gF(n,e){return Hp(n,e)&&Wu(n,e+6)+10<=n.length-e}function yF(n){return n instanceof ArrayBuffer?n:n.byteOffset==0&&n.byteLength==n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer}function wh(n,e=0,t=1/0){return xF(n,e,t,Uint8Array)}function xF(n,e,t,r){const s=vF(n);let i=1;"BYTES_PER_ELEMENT"in r&&(i=r.BYTES_PER_ELEMENT);const o=SF(n)?n.byteOffset:0,l=(o+n.byteLength)/i,u=(o+e)/i,d=Math.floor(Math.max(0,Math.min(u,l))),f=Math.floor(Math.min(d+Math.max(t,0),l));return new r(s,d,f-d)}function vF(n){return n instanceof ArrayBuffer?n:n.buffer}function SF(n){return n&&n.buffer instanceof ArrayBuffer&&n.byteLength!==void 0&&n.byteOffset!==void 0}function EF(n){const e={key:n.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(n.size<2)return;if(n.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const r=n.data.subarray(1).indexOf(0);if(r===-1)return;const s=In(wh(n.data,1,r)),i=n.data[2+r],o=n.data.subarray(3+r).indexOf(0);if(o===-1)return;const l=In(wh(n.data,3+r,o));let u;return s==="-->"?u=In(wh(n.data,4+r+o)):u=yF(n.data.subarray(4+r+o)),e.mimeType=s,e.pictureType=i,e.description=l,e.data=u,e}function TF(n){if(n.size<2)return;const e=In(n.data,!0),t=new Uint8Array(n.data.subarray(e.length+1));return{key:n.type,info:e,data:t.buffer}}function bF(n){if(n.size<2)return;if(n.type==="TXXX"){let t=1;const r=In(n.data.subarray(t),!0);t+=r.length+1;const s=In(n.data.subarray(t));return{key:n.type,info:r,data:s}}const e=In(n.data.subarray(1));return{key:n.type,info:"",data:e}}function wF(n){if(n.type==="WXXX"){if(n.size<2)return;let t=1;const r=In(n.data.subarray(t),!0);t+=r.length+1;const s=In(n.data.subarray(t));return{key:n.type,info:r,data:s}}const e=In(n.data);return{key:n.type,info:"",data:e}}function AF(n){return n.type==="PRIV"?TF(n):n.type[0]==="W"?wF(n):n.type==="APIC"?EF(n):bF(n)}function LF(n){const e=String.fromCharCode(n[0],n[1],n[2],n[3]),t=Wu(n,4),r=10;return{type:e,size:t,data:n.subarray(r,r+t)}}const vc=10,RF=10;function Ob(n){let e=0;const t=[];for(;Hp(n,e);){const r=Wu(n,e+6);n[e+5]>>6&1&&(e+=vc),e+=vc;const s=e+r;for(;e+RF<s;){const i=LF(n.subarray(e)),o=AF(i);o&&t.push(o),e+=i.size+vc}kb(n,e)&&(e+=vc)}return t}function Mb(n){return n&&n.key==="PRIV"&&n.info==="com.apple.streaming.transportStreamTimestamp"}function IF(n){if(n.data.byteLength===8){const e=new Uint8Array(n.data),t=e[3]&1;let r=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return r/=45,t&&(r+=4772185884e-2),Math.round(r)}}function zp(n){const e=Ob(n);for(let t=0;t<e.length;t++){const r=e[t];if(Mb(r))return IF(r)}}let Ln=(function(n){return n.audioId3="org.id3",n.dateRange="com.apple.quicktime.HLS",n.emsg="https://aomedia.org/emsg/ID3",n.misbklv="urn:misb:KLV:bin:1910.1",n})({});function pr(n="",e=9e4){return{type:n,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Wp{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(e,t){this.cachedData&&(e=$n(this.cachedData,e),this.cachedData=null);let r=ka(e,0),s=r?r.length:0,i;const o=this._audioTrack,l=this._id3Track,u=r?zp(r):void 0,d=e.length;for((this.basePTS===null||this.frameIndex===0&&he(u))&&(this.basePTS=kF(u,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),r&&r.length>0&&l.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Ln.audioId3,duration:Number.POSITIVE_INFINITY});s<d;){if(this.canParse(e,s)){const f=this.appendFrame(o,e,s);f?(this.frameIndex++,this.lastPTS=f.sample.pts,s+=f.length,i=s):s=d}else gF(e,s)?(r=ka(e,s),l.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Ln.audioId3,duration:Number.POSITIVE_INFINITY}),s+=r.length,i=s):s++;if(s===d&&i!==d){const f=e.slice(i);this.cachedData?this.cachedData=$n(this.cachedData,f):this.cachedData=f}}return{audioTrack:o,videoTrack:pr(),id3Track:l,textTrack:pr()}}demuxSampleAes(e,t,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:pr(),id3Track:this._id3Track,textTrack:pr()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const kF=(n,e,t)=>{if(he(n))return n*90;const r=t?t.baseTime*9e4/t.timescale:0;return e*9e4+r};let Sc=null;const CF=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],_F=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],PF=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],DF=[0,1,1,4];function Fb(n,e,t,r,s){if(t+24>e.length)return;const i=Bb(e,t);if(i&&t+i.frameLength<=e.length){const o=i.samplesPerFrame*9e4/i.sampleRate,l=r+s*o,u={unit:e.subarray(t,t+i.frameLength),pts:l,dts:l};return n.config=[],n.channelCount=i.channelCount,n.samplerate=i.sampleRate,n.samples.push(u),{sample:u,length:i.frameLength,missing:0}}}function Bb(n,e){const t=n[e+1]>>3&3,r=n[e+1]>>1&3,s=n[e+2]>>4&15,i=n[e+2]>>2&3;if(t!==1&&s!==0&&s!==15&&i!==3){const o=n[e+2]>>1&1,l=n[e+3]>>6,u=t===3?3-r:r===3?3:4,d=CF[u*14+s-1]*1e3,h=_F[(t===3?0:t===2?1:2)*3+i],p=l===3?1:2,x=PF[t][r],g=DF[r],E=x*8*g,v=Math.floor(x*d/h+o)*g;if(Sc===null){const L=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Sc=L?parseInt(L[1]):0}return!!Sc&&Sc<=87&&r===2&&d>=224e3&&l===0&&(n[e+3]=n[e+3]|128),{sampleRate:h,channelCount:p,frameLength:v,samplesPerFrame:E}}}function Yp(n,e){return n[e]===255&&(n[e+1]&224)===224&&(n[e+1]&6)!==0}function Ub(n,e){return e+1<n.length&&Yp(n,e)}function NF(n,e){return Yp(n,e)&&4<=n.length-e}function $b(n,e){if(e+1<n.length&&Yp(n,e)){const r=Bb(n,e);let s=4;r!=null&&r.frameLength&&(s=r.frameLength);const i=e+s;return i===n.length||Ub(n,i)}return!1}class OF extends Wp{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const r=ka(e,0);let s=r?.length||0;if($b(e,s))return!1;for(let i=e.length;s<i;s++)if(mF(e,s))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return hF(e,t)}appendFrame(e,t,r){Pb(e,this.observer,t,r,e.manifestCodec);const s=Nb(e,t,r,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s}}const jb=(n,e)=>{let t=0,r=5;e+=r;const s=new Uint32Array(1),i=new Uint32Array(1),o=new Uint8Array(1);for(;r>0;){o[0]=n[e];const l=Math.min(r,8),u=8-l;i[0]=4278190080>>>24+u<<u,s[0]=(o[0]&i[0])>>u,t=t?t<<l|s[0]:s[0],e+=1,r-=l}return t};class MF extends Wp{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,r){const s=Vb(e,t,r,this.basePTS,this.frameIndex);if(s!==-1)return{sample:e.samples[e.samples.length-1],length:s,missing:0}}static probe(e){if(!e)return!1;const t=ka(e,0);if(!t)return!1;const r=t.length;return e[r]===11&&e[r+1]===119&&zp(t)!==void 0&&jb(e,r)<16}}function Vb(n,e,t,r,s){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const i=e[t+4]>>6;if(i>=3)return-1;const l=[48e3,44100,32e3][i],u=e[t+4]&63,f=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][u*3+i]*2;if(t+f>e.length)return-1;const h=e[t+6]>>5;let p=0;h===2?p+=2:(h&1&&h!==1&&(p+=2),h&4&&(p+=2));const x=(e[t+6]<<8|e[t+7])>>12-p&1,E=[2,1,2,3,3,4,4,5][h]+x,v=e[t+5]>>3,b=e[t+5]&7,A=new Uint8Array([i<<6|v<<1|b>>2,(b&3)<<6|h<<3|x<<2|u>>4,u<<4&224]),L=1536/l*9e4,I=r+s*L,_=e.subarray(t,t+f);return n.config=A,n.channelCount=E,n.samplerate=l,n.samples.push({unit:_,pts:I}),f}class FF extends Wp{resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=ka(e,0);let r=t?.length||0;if(t&&e[r]===11&&e[r+1]===119&&zp(t)!==void 0&&jb(e,r)<=16)return!1;for(let s=e.length;r<s;r++)if($b(e,r))return Ze.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return NF(e,t)}appendFrame(e,t,r){if(this.basePTS!==null)return Fb(e,t,r,this.basePTS,this.frameIndex)}}const BF=/\/emsg[-/]ID3/i;class UF{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,s){const i=this.videoTrack=pr("video",1),o=this.audioTrack=pr("audio",1),l=this.txtTrack=pr("text",1);if(this.id3Track=pr("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const u=J1(e);if(u.video){const{id:d,timescale:f,codec:h,supplemental:p}=u.video;i.id=d,i.timescale=l.timescale=f,i.codec=h,i.supplemental=p}if(u.audio){const{id:d,timescale:f,codec:h}=u.audio;o.id=d,o.timescale=f,o.codec=h}l.id=q1.text,i.sampleDuration=0,i.duration=o.duration=s}resetContiguity(){this.remainderData=null}static probe(e){return MO(e)}demux(e,t){this.timeOffset=t;let r=e;const s=this.videoTrack,i=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=$n(this.remainderData,e));const l=GO(r);this.remainderData=l.remainder,s.samples=l.valid||new Uint8Array}else s.samples=r;const o=this.extractID3Track(s,t);return i.samples=$v(t,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const s=this.extractID3Track(t,this.timeOffset);return r.samples=$v(e,t),{videoTrack:t,audioTrack:pr(),id3Track:s,textTrack:pr()}}extractID3Track(e,t){const r=this.id3Track;if(e.samples.length){const s=Ue(e.samples,["emsg"]);s&&s.forEach(i=>{const o=KO(i);if(BF.test(o.schemeIdUri)){const l=bS(o,t);let u=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;u<=.001&&(u=Number.POSITIVE_INFINITY);const d=o.payload;r.samples.push({data:d,len:d.byteLength,dts:l,pts:l,type:Ln.emsg,duration:u})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const l=bS(o,t);r.samples.push({data:o.payload,len:o.payload.byteLength,dts:l,pts:l,type:Ln.misbklv,duration:Number.POSITIVE_INFINITY})}})}return r}demuxSampleAes(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function bS(n,e){return he(n.presentationTime)?n.presentationTime/n.timeScale:e+n.presentationTimeDelta/n.timeScale}class $F{constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new Bp(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Is.cbc)}decryptAacSample(e,t,r){const s=e[t].unit;if(s.length<=16)return;const i=s.subarray(16,s.length-s.length%16),o=i.buffer.slice(i.byteOffset,i.byteOffset+i.length);this.decryptBuffer(o).then(l=>{const u=new Uint8Array(l);s.set(u,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,r)}).catch(r)}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length){r();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,r),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,r=new Int8Array(t);let s=0;for(let i=32;i<e.length-16;i+=160,s+=16)r.set(e.subarray(i,i+16),s);return r}getAvcDecryptedUnit(e,t){const r=new Uint8Array(t);let s=0;for(let i=32;i<e.length-16;i+=160,s+=16)e.set(r.subarray(s,s+16),i);return e}decryptAvcSample(e,t,r,s,i){const o=tb(i.data),l=this.getAvcEncryptedData(o);this.decryptBuffer(l.buffer).then(u=>{i.data=this.getAvcDecryptedUnit(o,u),this.decrypter.isSync()||this.decryptAvcSamples(e,t,r+1,s)}).catch(s)}decryptAvcSamples(e,t,r,s){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length){s();return}const i=e[t].units;for(;!(r>=i.length);r++){const o=i[r];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,t,r,s,o),!this.decrypter.isSync()))return}}}}class Gb{constructor(){this.VideoSample=null}createVideoSample(e,t,r){return{key:e,frame:!1,pts:t,dts:r,units:[],length:0}}getLastNalUnit(e){var t;let r=this.VideoSample,s;if((!r||r.units.length===0)&&(r=e[e.length-1]),(t=r)!=null&&t.units){const i=r.units;s=i[i.length-1]}return s}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const r=t.samples,s=r.length;if(s){const i=r[s-1];e.pts=i.pts,e.dts=i.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,r){const s=t.byteLength;let i=e.naluState||0;const o=i,l=[];let u=0,d,f,h,p=-1,x=0;for(i===-1&&(p=0,x=this.getNALuType(t,0),i=0,u=1);u<s;){if(d=t[u++],!i){i=d?0:1;continue}if(i===1){i=d?0:2;continue}if(!d)i=3;else if(d===1){if(f=u-i-1,p>=0){const g={data:t.subarray(p,f),type:x};l.push(g)}else{const g=this.getLastNalUnit(e.samples);g&&(o&&u<=4-o&&g.state&&(g.data=g.data.subarray(0,g.data.byteLength-o)),f>0&&(g.data=$n(g.data,t.subarray(0,f)),g.state=0))}u<s?(h=this.getNALuType(t,u),p=u,x=h,i=0):i=-1}else i=0}if(p>=0&&i>=0){const g={data:t.subarray(p,s),type:x,state:i};l.push(g)}if(l.length===0){const g=this.getLastNalUnit(e.samples);g&&(g.data=$n(g.data,t))}return e.naluState=i,l}}class ha{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,r=e.byteLength-t,s=new Uint8Array(4),i=Math.min(4,t);if(i===0)throw new Error("no bytes available");s.set(e.subarray(r,r+i)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=i*8,this.bytesAvailable-=i}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const r=this.word>>>32-t;if(e>32&&Ze.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class jF extends Gb{parsePES(e,t,r,s){const i=this.parseNALu(e,r.data,s);let o=this.VideoSample,l,u=!1;r.data=null,o&&i.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),i.forEach(d=>{var f,h;switch(d.type){case 1:{let E=!1;l=!0;const v=d.data;if(u&&v.length>4){const b=this.readSliceType(v);(b===2||b===4||b===7||b===9)&&(E=!0)}if(E){var p;(p=o)!=null&&p.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.frame=!0,o.key=E;break}case 5:l=!0,(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0,o.frame=!0;break;case 6:{l=!0,Np(d.data,1,r.pts,t.samples);break}case 7:{var x,g;l=!0,u=!0;const E=d.data,v=this.readSPS(E);if(!e.sps||e.width!==v.width||e.height!==v.height||((x=e.pixelRatio)==null?void 0:x[0])!==v.pixelRatio[0]||((g=e.pixelRatio)==null?void 0:g[1])!==v.pixelRatio[1]){e.width=v.width,e.height=v.height,e.pixelRatio=v.pixelRatio,e.sps=[E];const b=E.subarray(1,4);let A="avc1.";for(let L=0;L<3;L++){let I=b[L].toString(16);I.length<2&&(I="0"+I),A+=I}e.codec=A}break}case 8:l=!0,e.pps=[d.data];break;case 9:l=!0,e.audFound=!0,(h=o)!=null&&h.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;case 12:l=!0;break;default:l=!1;break}o&&l&&o.units.push(d)}),s&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new ha(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let r=8,s=8,i;for(let o=0;o<e;o++)s!==0&&(i=t.readEG(),s=(r+i+256)%256),r=s===0?r:s}readSPS(e){const t=new ha(e);let r=0,s=0,i=0,o=0,l,u,d;const f=t.readUByte.bind(t),h=t.readBits.bind(t),p=t.readUEG.bind(t),x=t.readBoolean.bind(t),g=t.skipBits.bind(t),E=t.skipEG.bind(t),v=t.skipUEG.bind(t),b=this.skipScalingList.bind(this);f();const A=f();if(h(5),g(3),f(),v(),A===100||A===110||A===122||A===244||A===44||A===83||A===86||A===118||A===128){const P=p();if(P===3&&g(1),v(),v(),g(1),x())for(u=P!==3?8:12,d=0;d<u;d++)x()&&(d<6?b(16,t):b(64,t))}v();const L=p();if(L===0)p();else if(L===1)for(g(1),E(),E(),l=p(),d=0;d<l;d++)E();v(),g(1);const I=p(),_=p(),F=h(1);F===0&&g(1),g(1),x()&&(r=p(),s=p(),i=p(),o=p());let C=[1,1];if(x()&&x())switch(f()){case 1:C=[1,1];break;case 2:C=[12,11];break;case 3:C=[10,11];break;case 4:C=[16,11];break;case 5:C=[40,33];break;case 6:C=[24,11];break;case 7:C=[20,11];break;case 8:C=[32,11];break;case 9:C=[80,33];break;case 10:C=[18,11];break;case 11:C=[15,11];break;case 12:C=[64,33];break;case 13:C=[160,99];break;case 14:C=[4,3];break;case 15:C=[3,2];break;case 16:C=[2,1];break;case 255:{C=[f()<<8|f(),f()<<8|f()];break}}return{width:Math.ceil((I+1)*16-r*2-s*2),height:(2-F)*(_+1)*16-(F?2:4)*(i+o),pixelRatio:C}}}class VF extends Gb{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,r,s){const i=this.parseNALu(e,r.data,s);let o=this.VideoSample,l,u=!1;r.data=null,o&&i.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),i.forEach(d=>{var f,h;switch(d.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),o.frame=!0,l=!0;break;case 16:case 17:case 18:case 21:if(l=!0,u){var p;(p=o)!=null&&p.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:l=!0,(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0,o.frame=!0;break;case 39:l=!0,Np(d.data,2,r.pts,t.samples);break;case 32:l=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=tt(e.params,this.readVPS(d.data)),this.initVPS=d.data),e.vps=[d.data];break;case 33:if(l=!0,u=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],d.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const x=this.readSPS(d.data);e.width=x.width,e.height=x.height,e.pixelRatio=x.pixelRatio,e.codec=x.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const g in x.params)e.params[g]=x.params[g]}this.pushParameterSet(e.sps,d.data,e.vps),o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0;break;case 34:if(l=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const x=this.readPPS(d.data);for(const g in x)e.params[g]=x[g]}this.pushParameterSet(e.pps,d.data,e.vps)}break;case 35:l=!0,e.audFound=!0,(h=o)!=null&&h.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;default:l=!1;break}o&&l&&o.units.push(d)}),s&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}pushParameterSet(e,t,r){(r&&r[0]===this.initVPS||!r&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let r=0;for(let s=0;s<e.byteLength;s++)s>=2&&e[s]===3&&e[s-1]===0&&e[s-2]===0||(t[r]=e[s],r++);return new Uint8Array(t.buffer,0,r)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new ha(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const r=t.readBits(3),s=t.readBoolean();return{numTemporalLayers:r+1,temporalIdNested:s}}readSPS(e){const t=new ha(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const r=t.readBits(3);t.readBoolean();const s=t.readBits(2),i=t.readBoolean(),o=t.readBits(5),l=t.readUByte(),u=t.readUByte(),d=t.readUByte(),f=t.readUByte(),h=t.readUByte(),p=t.readUByte(),x=t.readUByte(),g=t.readUByte(),E=t.readUByte(),v=t.readUByte(),b=t.readUByte(),A=[],L=[];for(let me=0;me<r;me++)A.push(t.readBoolean()),L.push(t.readBoolean());if(r>0)for(let me=r;me<8;me++)t.readBits(2);for(let me=0;me<r;me++)A[me]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),L[me]&&t.readUByte();t.readUEG();const I=t.readUEG();I==3&&t.skipBits(1);const _=t.readUEG(),F=t.readUEG(),C=t.readBoolean();let P=0,O=0,M=0,H=0;C&&(P+=t.readUEG(),O+=t.readUEG(),M+=t.readUEG(),H+=t.readUEG());const Z=t.readUEG(),se=t.readUEG(),U=t.readUEG(),ne=t.readBoolean();for(let me=ne?0:r;me<=r;me++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let Me=0;Me<4;Me++)for(let qe=0;qe<(Me===3?2:6);qe++)if(!t.readBoolean())t.readUEG();else{const Be=Math.min(64,1<<4+(Me<<1));Me>1&&t.readEG();for(let Xe=0;Xe<Be;Xe++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const G=t.readUEG();let Q=0;for(let me=0;me<G;me++){let Me=!1;if(me!==0&&(Me=t.readBoolean()),Me){me===G&&t.readUEG(),t.readBoolean(),t.readUEG();let qe=0;for(let je=0;je<=Q;je++){const Be=t.readBoolean();let Xe=!1;Be||(Xe=t.readBoolean()),(Be||Xe)&&qe++}Q=qe}else{const qe=t.readUEG(),je=t.readUEG();Q=qe+je;for(let Be=0;Be<qe;Be++)t.readUEG(),t.readBoolean();for(let Be=0;Be<je;Be++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const me=t.readUEG();for(let Me=0;Me<me;Me++){for(let qe=0;qe<U+4;qe++)t.readBits(1);t.readBits(1)}}let D=0,$=1,ie=1,ce=!0,ue=1,fe=0;t.readBoolean(),t.readBoolean();let Ee=!1;if(t.readBoolean()){if(t.readBoolean()){const _t=t.readUByte(),_n=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],pn=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];_t>0&&_t<16?($=_n[_t-1],ie=pn[_t-1]):_t===255&&($=t.readBits(16),ie=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Ee=t.readBoolean(),Ee&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(ue=t.readBits(32),fe=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const pn=t.readBoolean(),vt=t.readBoolean();let wt=!1;(pn||vt)&&(wt=t.readBoolean(),wt&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),wt&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let gn=0;gn<=r;gn++){ce=t.readBoolean();const sr=ce||t.readBoolean();let yn=!1;sr?t.readEG():yn=t.readBoolean();const Xt=yn?1:t.readUEG()+1;if(pn)for(let Qt=0;Qt<Xt;Qt++)t.readUEG(),t.readUEG(),wt&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(vt)for(let Qt=0;Qt<Xt;Qt++)t.readUEG(),t.readUEG(),wt&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),D=t.readUEG())}let Le=_,_e=F;if(C){let me=1,Me=1;I===1?me=Me=2:I==2&&(me=2),Le=_-me*O-me*P,_e=F-Me*H-Me*M}const Pe=s?["A","B","C"][s]:"",Te=l<<24|u<<16|d<<8|f;let ve=0;for(let me=0;me<32;me++)ve=(ve|(Te>>me&1)<<31-me)>>>0;let Re=ve.toString(16);return o===1&&Re==="2"&&(Re="6"),{codecString:`hvc1.${Pe}${o}.${Re}.${i?"H":"L"}${b}.B0`,params:{general_tier_flag:i,general_profile_idc:o,general_profile_space:s,general_profile_compatibility_flags:[l,u,d,f],general_constraint_indicator_flags:[h,p,x,g,E,v],general_level_idc:b,bit_depth:Z+8,bit_depth_luma_minus8:Z,bit_depth_chroma_minus8:se,min_spatial_segmentation_idc:D,chroma_format_idc:I,frame_rate:{fixed:ce,fps:fe/ue}},width:Le,height:_e,pixelRatio:[$,ie]}}readPPS(e){const t=new ha(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const s=t.readBoolean(),i=t.readBoolean();let o=1;return i&&s?o=0:i?o=3:s&&(o=2),{parallelismType:o}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Ot=188;class vs{constructor(e,t,r,s){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.logger=s,this.videoParser=null}static probe(e,t){const r=vs.syncOffset(e);return r>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${r}`),r!==-1}static syncOffset(e){const t=e.length;let r=Math.min(Ot*5,t-Ot)+1,s=0;for(;s<r;){let i=!1,o=-1,l=0;for(let u=s;u<t;u+=Ot)if(e[u]===71&&(t-u===Ot||e[u+Ot]===71)){if(l++,o===-1&&(o=u,o!==0&&(r=Math.min(o+Ot*99,e.length-Ot)+1)),i||(i=Pm(e,u)===0),i&&l>1&&(o===0&&l>2||u+Ot>r))return o}else{if(l)return-1;break}s++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:q1[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,r,s){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=vs.createTrack("video"),this._videoTrack.duration=s,this._audioTrack=vs.createTrack("audio",s),this._id3Track=vs.createTrack("id3"),this._txtTrack=vs.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:r}=this;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,r=!1,s=!1){r||(this.sampleAes=null);let i;const o=this._videoTrack,l=this._audioTrack,u=this._id3Track,d=this._txtTrack;let f=o.pid,h=o.pesData,p=l.pid,x=u.pid,g=l.pesData,E=u.pesData,v=null,b=this.pmtParsed,A=this._pmtId,L=e.length;if(this.remainderData&&(e=$n(this.remainderData,e),L=e.length,this.remainderData=null),L<Ot&&!s)return this.remainderData=e,{audioTrack:l,videoTrack:o,id3Track:u,textTrack:d};const I=Math.max(0,vs.syncOffset(e));L-=(L-I)%Ot,L<e.byteLength&&!s&&(this.remainderData=new Uint8Array(e.buffer,L,e.buffer.byteLength-L));let _=0;for(let C=I;C<L;C+=Ot)if(e[C]===71){const P=!!(e[C+1]&64),O=Pm(e,C),M=(e[C+3]&48)>>4;let H;if(M>1){if(H=C+5+e[C+4],H===C+Ot)continue}else H=C+4;switch(O){case f:P&&(h&&(i=Fi(h,this.logger))&&(this.readyVideoParser(o.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(o,d,i,!1)),h={data:[],size:0}),h&&(h.data.push(e.subarray(H,C+Ot)),h.size+=C+Ot-H);break;case p:if(P){if(g&&(i=Fi(g,this.logger)))switch(l.segmentCodec){case"aac":this.parseAACPES(l,i);break;case"mp3":this.parseMPEGPES(l,i);break;case"ac3":this.parseAC3PES(l,i);break}g={data:[],size:0}}g&&(g.data.push(e.subarray(H,C+Ot)),g.size+=C+Ot-H);break;case x:P&&(E&&(i=Fi(E,this.logger))&&this.parseID3PES(u,i),E={data:[],size:0}),E&&(E.data.push(e.subarray(H,C+Ot)),E.size+=C+Ot-H);break;case 0:P&&(H+=e[H]+1),A=this._pmtId=GF(e,H);break;case A:{P&&(H+=e[H]+1);const Z=HF(e,H,this.typeSupported,r,this.observer,this.logger);f=Z.videoPid,f>0&&(o.pid=f,o.segmentCodec=Z.segmentVideoCodec),p=Z.audioPid,p>0&&(l.pid=p,l.segmentCodec=Z.segmentAudioCodec),x=Z.id3Pid,x>0&&(u.pid=x),v!==null&&!b&&(this.logger.warn(`MPEG-TS PMT found at ${C} after unknown PID '${v}'. Backtracking to sync byte @${I} to parse all TS packets.`),v=null,C=I-188),b=this.pmtParsed=!0;break}case 17:case 8191:break;default:v=O;break}}else _++;_>0&&Dm(this.observer,new Error(`Found ${_} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=h,l.pesData=g,u.pesData=E;const F={audioTrack:l,videoTrack:o,id3Track:u,textTrack:d};return s&&this.extractRemainingSamples(F),F}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:r,id3Track:s,textTrack:i}=e,o=r.pesData,l=t.pesData,u=s.pesData;let d;if(o&&(d=Fi(o,this.logger))?(this.readyVideoParser(r.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(r,i,d,!0),r.pesData=null)):r.pesData=o,l&&(d=Fi(l,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,d);break;case"mp3":this.parseMPEGPES(t,d);break;case"ac3":this.parseAC3PES(t,d);break}t.pesData=null}else l!=null&&l.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=l;u&&(d=Fi(u,this.logger))?(this.parseID3PES(s,d),s.pesData=null):s.pesData=u}demuxSampleAes(e,t,r){const s=this.demux(e,r,!0,!this.config.progressive),i=this.sampleAes=new $F(this.observer,this.config,t);return this.decrypt(s,i)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new jF:e==="hevc"&&(this.videoParser=new VF))}decrypt(e,t){return new Promise(r=>{const{audioTrack:s,videoTrack:i}=e;s.samples&&s.segmentCodec==="aac"?t.decryptAacSamples(s.samples,0,()=>{i.samples?t.decryptAvcSamples(i.samples,0,0,()=>{r(e)}):r(e)}):i.samples&&t.decryptAvcSamples(i.samples,0,0,()=>{r(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let r=0;const s=this.aacOverFlow;let i=t.data;if(s){this.aacOverFlow=null;const h=s.missing,p=s.sample.unit.byteLength;if(h===-1)i=$n(s.sample.unit,i);else{const x=p-h;s.sample.unit.set(i.subarray(0,h),x),e.samples.push(s.sample),r=s.missing}}let o,l;for(o=r,l=i.length;o<l-1&&!vu(i,o);o++);if(o!==r){let h;const p=o<l-1;if(p?h=`AAC PES did not start with ADTS header,offset:${o}`:h="No ADTS header found in AAC PES",Dm(this.observer,new Error(h),p,this.logger),!p)return}Pb(e,this.observer,i,o,this.audioCodec);let u;if(t.pts!==void 0)u=t.pts;else if(s){const h=Db(e.samplerate);u=s.sample.pts+h}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let d=0,f;for(;o<l;)if(f=Nb(e,i,o,u,d),o+=f.length,f.missing){this.aacOverFlow=f;break}else for(d++;o<l-1&&!vu(i,o);o++);}parseMPEGPES(e,t){const r=t.data,s=r.length;let i=0,o=0;const l=t.pts;if(l===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<s;)if(Ub(r,o)){const u=Fb(e,r,o,l,i);if(u)o+=u.length,i++;else break}else o++}parseAC3PES(e,t){{const r=t.data,s=t.pts;if(s===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const i=r.length;let o=0,l=0,u;for(;l<i&&(u=Vb(e,r,l,s,o++))>0;)l+=u}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const r=tt({},t,{type:this._videoTrack?Ln.emsg:Ln.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}}function Pm(n,e){return((n[e+1]&31)<<8)+n[e+2]}function GF(n,e){return(n[e+10]&31)<<8|n[e+11]}function HF(n,e,t,r,s,i){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},l=(n[e+1]&15)<<8|n[e+2],u=e+3+l-4,d=(n[e+10]&15)<<8|n[e+11];for(e+=12+d;e<u;){const f=Pm(n,e),h=(n[e+3]&15)<<8|n[e+4];switch(n[e]){case 207:if(!r){Ah("ADTS AAC",i);break}case 15:o.audioPid===-1&&(o.audioPid=f);break;case 21:o.id3Pid===-1&&(o.id3Pid=f);break;case 219:if(!r){Ah("H.264",i);break}case 27:o.videoPid===-1&&(o.videoPid=f);break;case 3:case 4:!t.mpeg&&!t.mp3?i.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=f,o.segmentAudioCodec="mp3");break;case 193:if(!r){Ah("AC-3",i);break}case 129:t.ac3?o.audioPid===-1&&(o.audioPid=f,o.segmentAudioCodec="ac3"):i.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&h>0){let p=e+5,x=h;for(;x>2;){switch(n[p]){case 106:t.ac3!==!0?i.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=f,o.segmentAudioCodec="ac3");break}const E=n[p+1]+2;p+=E,x-=E}}break;case 194:case 135:return Dm(s,new Error("Unsupported EC-3 in M2TS found"),void 0,i),o;case 36:o.videoPid===-1&&(o.videoPid=f,o.segmentVideoCodec="hevc",i.log("HEVC in M2TS found"));break}e+=h+5}return o}function Dm(n,e,t,r){r.warn(`parsing error: ${e.message}`),n.emit(R.ERROR,R.ERROR,{type:we.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Ah(n,e){e.log(`${n} with AES-128-CBC encryption found in unencrypted stream`)}function Fi(n,e){let t=0,r,s,i,o,l;const u=n.data;if(!n||n.size===0)return null;for(;u[0].length<19&&u.length>1;)u[0]=$n(u[0],u[1]),u.splice(1,1);if(r=u[0],(r[0]<<16)+(r[1]<<8)+r[2]===1){if(s=(r[4]<<8)+r[5],s&&s>n.size-6)return null;const f=r[7];f&192&&(o=(r[9]&14)*536870912+(r[10]&255)*4194304+(r[11]&254)*16384+(r[12]&255)*128+(r[13]&254)/2,f&64?(l=(r[14]&14)*536870912+(r[15]&255)*4194304+(r[16]&254)*16384+(r[17]&255)*128+(r[18]&254)/2,o-l>60*9e4&&(e.warn(`${Math.round((o-l)/9e4)}s delta between PTS and DTS, align them`),o=l)):l=o),i=r[8];let h=i+9;if(n.size<=h)return null;n.size-=h;const p=new Uint8Array(n.size);for(let x=0,g=u.length;x<g;x++){r=u[x];let E=r.byteLength;if(h)if(h>E){h-=E;continue}else r=r.subarray(h),E-=h,h=0;p.set(r,t),t+=E}return s&&(s-=i+3),{data:p,pts:o,dts:l,len:s}}return null}class KF{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const ms=Math.pow(2,32)-1;class K{static init(){K.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in K.types)K.types.hasOwnProperty(e)&&(K.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);K.HDLR_TYPES={video:t,audio:r};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);K.STTS=K.STSC=K.STCO=i,K.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),K.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),K.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),K.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),l=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);K.FTYP=K.box(K.types.ftyp,o,u,o,l),K.DINF=K.box(K.types.dinf,K.box(K.types.dref,s))}static box(e,...t){let r=8,s=t.length;const i=s;for(;s--;)r+=t[s].byteLength;const o=new Uint8Array(r);for(o[0]=r>>24&255,o[1]=r>>16&255,o[2]=r>>8&255,o[3]=r&255,o.set(e,4),s=0,r=8;s<i;s++)o.set(t[s],r),r+=t[s].byteLength;return o}static hdlr(e){return K.box(K.types.hdlr,K.HDLR_TYPES[e])}static mdat(e){return K.box(K.types.mdat,e)}static mdhd(e,t){t*=e;const r=Math.floor(t/(ms+1)),s=Math.floor(t%(ms+1));return K.box(K.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,s>>24,s>>16&255,s>>8&255,s&255,85,196,0,0]))}static mdia(e){return K.box(K.types.mdia,K.mdhd(e.timescale||0,e.duration||0),K.hdlr(e.type),K.minf(e))}static mfhd(e){return K.box(K.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?K.box(K.types.minf,K.box(K.types.smhd,K.SMHD),K.DINF,K.stbl(e)):K.box(K.types.minf,K.box(K.types.vmhd,K.VMHD),K.DINF,K.stbl(e))}static moof(e,t,r){return K.box(K.types.moof,K.mfhd(e),K.traf(r,t))}static moov(e){let t=e.length;const r=[];for(;t--;)r[t]=K.trak(e[t]);return K.box.apply(null,[K.types.moov,K.mvhd(e[0].timescale||0,e[0].duration||0)].concat(r).concat(K.mvex(e)))}static mvex(e){let t=e.length;const r=[];for(;t--;)r[t]=K.trex(e[t]);return K.box.apply(null,[K.types.mvex,...r])}static mvhd(e,t){t*=e;const r=Math.floor(t/(ms+1)),s=Math.floor(t%(ms+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,s>>24,s>>16&255,s>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return K.box(K.types.mvhd,i)}static sdtp(e){const t=e.samples||[],r=new Uint8Array(4+t.length);let s,i;for(s=0;s<t.length;s++)i=t[s].flags,r[s+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return K.box(K.types.sdtp,r)}static stbl(e){return K.box(K.types.stbl,K.stsd(e),K.box(K.types.stts,K.STTS),K.box(K.types.stsc,K.STSC),K.box(K.types.stsz,K.STSZ),K.box(K.types.stco,K.STCO))}static avc1(e){let t=[],r=[],s,i,o;for(s=0;s<e.sps.length;s++)i=e.sps[s],o=i.byteLength,t.push(o>>>8&255),t.push(o&255),t=t.concat(Array.prototype.slice.call(i));for(s=0;s<e.pps.length;s++)i=e.pps[s],o=i.byteLength,r.push(o>>>8&255),r.push(o&255),r=r.concat(Array.prototype.slice.call(i));const l=K.box(K.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(r))),u=e.width,d=e.height,f=e.pixelRatio[0],h=e.pixelRatio[1];return K.box(K.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,u&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l,K.box(K.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),K.box(K.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,h>>24,h>>16&255,h>>8&255,h&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return K.box(K.types.mp4a,K.audioStsd(e),K.box(K.types.esds,K.esds(e)))}static mp3(e){return K.box(K.types[".mp3"],K.audioStsd(e))}static ac3(e){return K.box(K.types["ac-3"],K.audioStsd(e),K.box(K.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return K.box(K.types.stsd,K.STSD,K.mp4a(e));if(t==="ac3"&&e.config)return K.box(K.types.stsd,K.STSD,K.ac3(e));if(t==="mp3"&&e.codec==="mp3")return K.box(K.types.stsd,K.STSD,K.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return K.box(K.types.stsd,K.STSD,K.avc1(e));if(t==="hevc"&&e.vps)return K.box(K.types.stsd,K.STSD,K.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,r=(e.duration||0)*(e.timescale||0),s=e.width||0,i=e.height||0,o=Math.floor(r/(ms+1)),l=Math.floor(r%(ms+1));return K.box(K.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,l>>24,l>>16&255,l>>8&255,l&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,s&255,0,0,i>>8&255,i&255,0,0]))}static traf(e,t){const r=K.sdtp(e),s=e.id,i=Math.floor(t/(ms+1)),o=Math.floor(t%(ms+1));return K.box(K.types.traf,K.box(K.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255])),K.box(K.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,o>>24,o>>16&255,o>>8&255,o&255])),K.trun(e,r.length+16+20+8+16+8+8),r)}static trak(e){return e.duration=e.duration||4294967295,K.box(K.types.trak,K.tkhd(e),K.mdia(e))}static trex(e){const t=e.id;return K.box(K.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const r=e.samples||[],s=r.length,i=12+16*s,o=new Uint8Array(i);let l,u,d,f,h,p;for(t+=8+i,o.set([e.type==="video"?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),l=0;l<s;l++)u=r[l],d=u.duration,f=u.size,h=u.flags,p=u.cts,o.set([d>>>24&255,d>>>16&255,d>>>8&255,d&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,h.degradPrio&61440,h.degradPrio&15,p>>>24&255,p>>>16&255,p>>>8&255,p&255],12+16*l);return K.box(K.types.trun,o)}static initSegment(e){K.types||K.init();const t=K.moov(e);return $n(K.FTYP,t)}static hvc1(e){const t=e.params,r=[e.vps,e.sps,e.pps],s=4,i=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),s-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),r.length]);let o=i.length;for(let g=0;g<r.length;g+=1){o+=3;for(let E=0;E<r[g].length;E+=1)o+=2+r[g][E].length}const l=new Uint8Array(o);l.set(i,0),o=i.length;const u=r.length-1;for(let g=0;g<r.length;g+=1){l.set(new Uint8Array([32+g|(g===u?128:0),0,r[g].length]),o),o+=3;for(let E=0;E<r[g].length;E+=1)l.set(new Uint8Array([r[g][E].length>>8,r[g][E].length&255]),o),o+=2,l.set(r[g][E],o),o+=r[g][E].length}const d=K.box(K.types.hvcC,l),f=e.width,h=e.height,p=e.pixelRatio[0],x=e.pixelRatio[1];return K.box(K.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>8&255,f&255,h>>8&255,h&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d,K.box(K.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),K.box(K.types.pasp,new Uint8Array([p>>24,p>>16&255,p>>8&255,p&255,x>>24,x>>16&255,x>>8&255,x&255])))}}K.types=void 0;K.HDLR_TYPES=void 0;K.STTS=void 0;K.STSC=void 0;K.STCO=void 0;K.STSZ=void 0;K.VMHD=void 0;K.SMHD=void 0;K.STSD=void 0;K.FTYP=void 0;K.DINF=void 0;const Hb=9e4;function qp(n,e,t=1,r=!1){const s=n*e*t;return r?Math.round(s):s}function zF(n,e,t=1,r=!1){return qp(n,e,1/t,r)}function na(n,e=!1){return qp(n,1e3,1/Hb,e)}function WF(n,e=1){return qp(n,Hb,1/e)}function wS(n){const{baseTime:e,timescale:t,trackId:r}=n;return`${e/t} (${e}/${t}) trackId: ${r}`}const YF=10*1e3,qF=1024,XF=1152,QF=1536;let Bi=null,Lh=null;function AS(n,e,t,r){return{duration:e,size:t,cts:r,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:n?2:1,isNonSync:n?0:1}}}class Hc extends Vn{constructor(e,t,r,s){if(super("mp4-remuxer",s),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,Bi===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Bi=o?parseInt(o[1]):0}if(Lh===null){const i=navigator.userAgent.match(/Safari\/(\d+)/i);Lh=i?parseInt(i[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&wS(t)} > ${e&&wS(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const r=e[0].pts,s=e.reduce((i,o)=>{let l=o.pts,u=l-i;return u<-4294967296&&(t=!0,l=wn(l,r),u=l-i),u>0?i:l},r);return t&&this.debug("PTS rollover detected"),s}remux(e,t,r,s,i,o,l,u){let d,f,h,p,x,g,E=i,v=i;const b=e.pid>-1,A=t.pid>-1,L=t.samples.length,I=e.samples.length>0,_=l&&L>0||L>1;if((!b||I)&&(!A||_)||this.ISGenerated||l){if(this.ISGenerated){var C,P,O,M;const U=this.videoTrackConfig;(U&&(t.width!==U.width||t.height!==U.height||((C=t.pixelRatio)==null?void 0:C[0])!==((P=U.pixelRatio)==null?void 0:P[0])||((O=t.pixelRatio)==null?void 0:O[1])!==((M=U.pixelRatio)==null?void 0:M[1]))||!U&&_||this.nextAudioTs===null&&I)&&this.resetInitSegment()}this.ISGenerated||(h=this.generateIS(e,t,i,o));const H=this.isVideoContiguous;let Z=-1,se;if(_&&(Z=JF(t.samples),!H&&this.config.forceKeyFrameOnDiscontinuity))if(g=!0,Z>0){this.warn(`Dropped ${Z} out of ${L} video samples due to a missing keyframe`);const U=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(Z),t.dropped+=Z,v+=(t.samples[0].pts-U)/t.inputTimeScale,se=v}else Z===-1&&(this.warn(`No keyframe found out of ${L} video samples`),g=!1);if(this.ISGenerated){if(I&&_){const U=this.getVideoStartPts(t.samples),q=(wn(e.samples[0].pts,U)-U)/t.inputTimeScale;E+=Math.max(0,q),v+=Math.max(0,-q)}if(I){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),h=this.generateIS(e,t,i,o)),f=this.remuxAudio(e,E,this.isAudioContiguous,o,A||_||u===ge.AUDIO?v:void 0),_){const U=f?f.endPTS-f.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),h=this.generateIS(e,t,i,o)),d=this.remuxVideo(t,v,H,U)}}else _&&(d=this.remuxVideo(t,v,H,0));d&&(d.firstKeyFrame=Z,d.independent=Z!==-1,d.firstKeyFramePTS=se)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(x=Kb(r,i,this._initPTS,this._initDTS)),s.samples.length&&(p=zb(s,i,this._initPTS))),{audio:f,video:d,initSegment:h,independent:g,text:p,id3:x}}computeInitPts(e,t,r,s){const i=Math.round(r*t);let o=wn(e,i);if(o<i+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(i-o)/t} ${s}`);o<i+t;)o+=8589934592;return o-i}generateIS(e,t,r,s){const i=e.samples,o=t.samples,l=this.typeSupported,u={},d=this._initPTS;let f=!d||s,h="audio/mp4",p,x,g,E=-1;if(f&&(p=x=1/0),e.config&&i.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":l.mpeg?(h="audio/mpeg",e.codec=""):l.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}u.audio={id:"audio",container:h,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&l.mpeg?new Uint8Array(0):K.initSegment([e]),metadata:{channelCount:e.channelCount}},f&&(E=e.id,g=e.inputTimeScale,!d||g!==d.timescale?p=x=this.computeInitPts(i[0].pts,g,r,"audio"):f=!1)}if(t.sps&&t.pps&&o.length){if(t.timescale=t.inputTimeScale,u.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:K.initSegment([t]),metadata:{width:t.width,height:t.height}},f)if(E=t.id,g=t.inputTimeScale,!d||g!==d.timescale){const v=this.getVideoStartPts(o),b=wn(o[0].dts,v),A=this.computeInitPts(b,g,r,"video"),L=this.computeInitPts(v,g,r,"video");x=Math.min(x,A),p=Math.min(p,L)}else f=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(u).length)return this.ISGenerated=!0,f?(d&&this.warn(`Timestamps at playlist time: ${s?"":"~"}${r} ${p/g} != initPTS: ${d.baseTime/d.timescale} (${d.baseTime}/${d.timescale}) trackId: ${d.trackId}`),this.log(`Found initPTS at playlist time: ${r} offset: ${p/g} (${p}/${g}) trackId: ${E}`),this._initPTS={baseTime:p,timescale:g,trackId:E},this._initDTS={baseTime:x,timescale:g,trackId:E}):p=g=void 0,{tracks:u,initPTS:p,timescale:g,trackId:E}}remuxVideo(e,t,r,s){const i=e.inputTimeScale,o=e.samples,l=[],u=o.length,d=this._initPTS,f=d.baseTime*i/d.timescale;let h=this.nextVideoTs,p=8,x=this.videoSampleDuration,g,E,v=Number.POSITIVE_INFINITY,b=Number.NEGATIVE_INFINITY,A=!1;if(!r||h===null){const D=f+t*i,$=o[0].pts-wn(o[0].dts,o[0].pts);Bi&&h!==null&&Math.abs(D-$-(h+f))<15e3?r=!0:h=D-$-f}const L=h+f;for(let D=0;D<u;D++){const $=o[D];$.pts=wn($.pts,L),$.dts=wn($.dts,L),$.dts<o[D>0?D-1:D].dts&&(A=!0)}A&&o.sort(function(D,$){const ie=D.dts-$.dts,ce=D.pts-$.pts;return ie||ce}),g=o[0].dts,E=o[o.length-1].dts;const I=E-g,_=I?Math.round(I/(u-1)):x||e.inputTimeScale/30;if(r){const D=g-L,$=D>_,ie=D<-1;if(($||ie)&&($?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${na(D,!0)} ms (${D}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${na(-D,!0)} ms (${D}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!ie||L>=o[0].pts||Bi)){g=L;const ce=o[0].pts-D;if($)o[0].dts=g,o[0].pts=ce;else{let ue=!0;for(let fe=0;fe<o.length&&!(o[fe].dts>ce&&ue);fe++){const Ee=o[fe].pts;if(o[fe].dts-=D,o[fe].pts-=D,fe<o.length-1){const ye=o[fe+1].pts,Le=o[fe].pts,_e=ye<=Le,Pe=ye<=Ee;ue=_e==Pe}}}this.log(`Video: Initial PTS/DTS adjusted: ${na(ce,!0)}/${na(g,!0)}, delta: ${na(D,!0)} ms`)}}g=Math.max(0,g);let F=0,C=0,P=g;for(let D=0;D<u;D++){const $=o[D],ie=$.units,ce=ie.length;let ue=0;for(let fe=0;fe<ce;fe++)ue+=ie[fe].data.length;C+=ue,F+=ce,$.length=ue,$.dts<P?($.dts=P,P+=_/4|0||1):P=$.dts,v=Math.min($.pts,v),b=Math.max($.pts,b)}E=o[u-1].dts;const O=C+4*F+8;let M;try{M=new Uint8Array(O)}catch(D){this.observer.emit(R.ERROR,R.ERROR,{type:we.MUX_ERROR,details:z.REMUX_ALLOC_ERROR,fatal:!1,error:D,bytes:O,reason:`fail allocating video mdat ${O}`});return}const H=new DataView(M.buffer);H.setUint32(0,O),M.set(K.types.mdat,4);let Z=!1,se=Number.POSITIVE_INFINITY,U=Number.POSITIVE_INFINITY,ne=Number.NEGATIVE_INFINITY,q=Number.NEGATIVE_INFINITY;for(let D=0;D<u;D++){const $=o[D],ie=$.units;let ce=0;for(let Ee=0,ye=ie.length;Ee<ye;Ee++){const Le=ie[Ee],_e=Le.data,Pe=Le.data.byteLength;H.setUint32(p,Pe),p+=4,M.set(_e,p),p+=Pe,ce+=4+Pe}let ue;if(D<u-1)x=o[D+1].dts-$.dts,ue=o[D+1].pts-$.pts;else{const Ee=this.config,ye=D>0?$.dts-o[D-1].dts:_;if(ue=D>0?$.pts-o[D-1].pts:_,Ee.stretchShortVideoTrack&&this.nextAudioTs!==null){const Le=Math.floor(Ee.maxBufferHole*i),_e=(s?v+s*i:this.nextAudioTs+f)-$.pts;_e>Le?(x=_e-ye,x<0?x=ye:Z=!0,this.log(`It is approximately ${_e/90} ms to the next segment; using duration ${x/90} ms for the last video frame.`)):x=ye}else x=ye}const fe=Math.round($.pts-$.dts);se=Math.min(se,x),ne=Math.max(ne,x),U=Math.min(U,ue),q=Math.max(q,ue),l.push(AS($.key,x,ce,fe))}if(l.length){if(Bi){if(Bi<70){const D=l[0].flags;D.dependsOn=2,D.isNonSync=0}}else if(Lh&&q-U<ne-se&&_/ne<.025&&l[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let D=g;for(let $=0,ie=l.length;$<ie;$++){const ce=D+l[$].duration,ue=D+l[$].cts;if($<ie-1){const fe=ce+l[$+1].cts;l[$].duration=fe-ue}else l[$].duration=$?l[$-1].duration:_;l[$].cts=0,D=ce}}}x=Z||!x?_:x;const te=E+x;this.nextVideoTs=h=te-f,this.videoSampleDuration=x,this.isVideoContiguous=!0;const ee={data1:K.moof(e.sequenceNumber++,g,tt(e,{samples:l})),data2:M,startPTS:(v-f)/i,endPTS:(b+x-f)/i,startDTS:(g-f)/i,endDTS:h/i,type:"video",hasAudio:!1,hasVideo:!0,nb:l.length,dropped:e.dropped};return e.samples=[],e.dropped=0,ee}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return XF;case"ac3":return QF;default:return qF}}remuxAudio(e,t,r,s,i){const o=e.inputTimeScale,l=e.samplerate?e.samplerate:o,u=o/l,d=this.getSamplesPerFrame(e),f=d*u,h=this._initPTS,p=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,x=[],g=i!==void 0;let E=e.samples,v=p?0:8,b=this.nextAudioTs||-1;const A=h.baseTime*o/h.timescale,L=A+t*o;if(this.isAudioContiguous=r=r||E.length&&b>0&&(s&&Math.abs(L-(b+A))<9e3||Math.abs(wn(E[0].pts,L)-(b+A))<20*f),E.forEach(function(q){q.pts=wn(q.pts,L)}),!r||b<0){const q=E.length;if(E=E.filter(te=>te.pts>=0),q!==E.length&&this.warn(`Removed ${E.length-q} of ${q} samples (initPTS ${A} / ${o})`),!E.length)return;i===0?b=0:s&&!g?b=Math.max(0,L-A):b=E[0].pts-A}if(e.segmentCodec==="aac"){const q=this.config.maxAudioFramesDrift;for(let te=0,G=b+A;te<E.length;te++){const Q=E[te],ee=Q.pts,D=ee-G,$=Math.abs(1e3*D/o);if(D<=-q*f&&g)te===0&&(this.warn(`Audio frame @ ${(ee/o).toFixed(3)}s overlaps marker by ${Math.round(1e3*D/o)} ms.`),this.nextAudioTs=b=ee-A,G=ee);else if(D>=q*f&&$<YF&&g){let ie=Math.round(D/f);for(G=ee-ie*f;G<0&&ie&&f;)ie--,G+=f;te===0&&(this.nextAudioTs=b=G-A),this.warn(`Injecting ${ie} audio frames @ ${((G-A)/o).toFixed(3)}s due to ${Math.round(1e3*D/o)} ms gap.`);for(let ce=0;ce<ie;ce++){let ue=KF.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);ue||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),ue=Q.unit.subarray()),E.splice(te,0,{unit:ue,pts:G}),G+=f,te++}}Q.pts=G,G+=f}}let I=null,_=null,F,C=0,P=E.length;for(;P--;)C+=E[P].unit.byteLength;for(let q=0,te=E.length;q<te;q++){const G=E[q],Q=G.unit;let ee=G.pts;if(_!==null){const $=x[q-1];$.duration=Math.round((ee-_)/u)}else if(r&&e.segmentCodec==="aac"&&(ee=b+A),I=ee,C>0){C+=v;try{F=new Uint8Array(C)}catch($){this.observer.emit(R.ERROR,R.ERROR,{type:we.MUX_ERROR,details:z.REMUX_ALLOC_ERROR,fatal:!1,error:$,bytes:C,reason:`fail allocating audio mdat ${C}`});return}p||(new DataView(F.buffer).setUint32(0,C),F.set(K.types.mdat,4))}else return;F.set(Q,v);const D=Q.byteLength;v+=D,x.push(AS(!0,d,D,0)),_=ee}const O=x.length;if(!O)return;const M=x[x.length-1];b=_-A,this.nextAudioTs=b+u*M.duration;const H=p?new Uint8Array(0):K.moof(e.sequenceNumber++,I/u,tt({},e,{samples:x}));e.samples=[];const Z=(I-A)/o,se=this.nextAudioTs/o,ne={data1:H,data2:F,startPTS:Z,endPTS:se,startDTS:Z,endDTS:se,type:"audio",hasAudio:!0,hasVideo:!1,nb:O};return this.isAudioContiguous=!0,ne}}function wn(n,e){let t;if(e===null)return n;for(e<n?t=-8589934592:t=8589934592;Math.abs(n-e)>4294967296;)n+=t;return n}function JF(n){for(let e=0;e<n.length;e++)if(n[e].key)return e;return-1}function Kb(n,e,t,r){const s=n.samples.length;if(!s)return;const i=n.inputTimeScale;for(let l=0;l<s;l++){const u=n.samples[l];u.pts=wn(u.pts-t.baseTime*i/t.timescale,e*i)/i,u.dts=wn(u.dts-r.baseTime*i/r.timescale,e*i)/i}const o=n.samples;return n.samples=[],{samples:o}}function zb(n,e,t){const r=n.samples.length;if(!r)return;const s=n.inputTimeScale;for(let o=0;o<r;o++){const l=n.samples[o];l.pts=wn(l.pts-t.baseTime*s/t.timescale,e*s)/s}n.samples.sort((o,l)=>o.pts-l.pts);const i=n.samples;return n.samples=[],{samples:i}}class ZF extends Vn{constructor(e,t,r,s){super("passthrough-remuxer",s),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,r,s){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(e,s),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:r,videoCodec:s}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:i,video:o}=this.initData=J1(e);if(t)$O(e,t);else{const u=i||o;u!=null&&u.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${u.codec}")!`)}i&&(r=LS(i,rt.AUDIO,this)),o&&(s=LS(o,rt.VIDEO,this));const l={};i&&o?l.audiovideo={container:"video/mp4",codec:r+","+s,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:i?l.audio={container:"audio/mp4",codec:r,encrypted:i.encrypted,initSegment:e,id:"audio"}:o?l.video={container:"video/mp4",codec:s,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=l}remux(e,t,r,s,i,o){var l,u;let{initPTS:d,lastEndTime:f}=this;const h={audio:void 0,video:void 0,text:s,id3:r,initSegment:void 0};he(f)||(f=this.lastEndTime=i||0);const p=t.samples;if(!p.length)return h;const x={initPTS:void 0,timescale:void 0,trackId:void 0};let g=this.initData;if((l=g)!=null&&l.length||(this.generateInitSegment(p),g=this.initData),!((u=g)!=null&&u.length))return this.warn("Failed to generate initSegment."),h;this.emitInitSegment&&(x.tracks=this.initTracks,this.emitInitSegment=!1);const E=VO(p,g,this),v=g.audio?E[g.audio.id]:null,b=g.video?E[g.video.id]:null,A=Ec(b,1/0),L=Ec(v,1/0),I=Ec(b,0,!0),_=Ec(v,0,!0);let F=i,C=0;const P=v&&(!b||!d&&L<A||d&&d.trackId===g.audio.id),O=P?v:b;if(O){const G=O.timescale,Q=O.start-i*G,ee=P?g.audio.id:g.video.id;F=O.start/G,C=P?_-L:I-A,(o||!d)&&(eB(d,F,i,C)||G!==d.timescale)&&(d&&this.warn(`Timestamps at playlist time: ${o?"":"~"}${i} ${Q/G} != initPTS: ${d.baseTime/d.timescale} (${d.baseTime}/${d.timescale}) trackId: ${d.trackId}`),this.log(`Found initPTS at playlist time: ${i} offset: ${F-i} (${Q}/${G}) trackId: ${ee}`),d=null,x.initPTS=Q,x.timescale=G,x.trackId=ee)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${i}`);d?(x.initPTS=d.baseTime,x.timescale=d.timescale,x.trackId=d.trackId):((!x.timescale||x.trackId===void 0||x.initPTS===void 0)&&(this.warn("Could not set initPTS"),x.initPTS=F,x.timescale=1,x.trackId=-1),this.initPTS=d={baseTime:x.initPTS,timescale:x.timescale,trackId:x.trackId});const M=F-d.baseTime/d.timescale,H=M+C;C>0?this.lastEndTime=H:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const Z=!!g.audio,se=!!g.video;let U="";Z&&(U+="audio"),se&&(U+="video");const ne=(g.audio?g.audio.encrypted:!1)||(g.video?g.video.encrypted:!1),q={data1:p,startPTS:M,startDTS:M,endPTS:H,endDTS:H,type:U,hasAudio:Z,hasVideo:se,nb:1,dropped:0,encrypted:ne};h.audio=Z&&!se?q:void 0,h.video=se?q:void 0;const te=b?.sampleCount;if(te){const G=b.keyFrameIndex,Q=G!==-1;q.nb=te,q.dropped=G===0||this.isVideoContiguous?0:Q?G:te,q.independent=Q,q.firstKeyFrame=G,Q&&b.keyFrameStart&&(q.firstKeyFramePTS=(b.keyFrameStart-d.baseTime)/d.timescale),this.isVideoContiguous||(h.independent=Q),this.isVideoContiguous||(this.isVideoContiguous=Q),q.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${G}/${te} dropped: ${q.dropped} start: ${q.firstKeyFramePTS||"NA"}`)}return h.initSegment=x,h.id3=Kb(r,i,d,d),s.samples.length&&(h.text=zb(s,i,d)),h}}function Ec(n,e,t=!1){return n?.start!==void 0?(n.start+(t?n.duration:0))/n.timescale:e}function eB(n,e,t,r){if(n===null)return!0;const s=Math.max(r,1),i=e-n.baseTime/n.timescale;return Math.abs(i-t)>s}function LS(n,e,t){const r=n.codec;return r&&r.length>4?r:e===rt.AUDIO?r==="ec-3"||r==="ac-3"||r==="alac"?r:r==="fLaC"||r==="Opus"?du(r,!1):(t.warn(`Unhandled audio codec "${r}" in mp4 MAP`),r||"mp4a"):(t.warn(`Unhandled video codec "${r}" in mp4 MAP`),r||"avc1")}let Br;try{Br=self.performance.now.bind(self.performance)}catch{Br=Date.now}const Kc=[{demux:UF,remux:ZF},{demux:vs,remux:Hc},{demux:OF,remux:Hc},{demux:FF,remux:Hc}];Kc.splice(2,0,{demux:MF,remux:Hc});class RS{constructor(e,t,r,s,i,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.id=i,this.logger=o}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,r,s){const i=r.transmuxing;i.executeStart=Br();let o=new Uint8Array(e);const{currentTransmuxState:l,transmuxConfig:u}=this;s&&(this.currentTransmuxState=s);const{contiguous:d,discontinuity:f,trackSwitch:h,accurateTimeOffset:p,timeOffset:x,initSegmentChange:g}=s||l,{audioCodec:E,videoCodec:v,defaultInitPts:b,duration:A,initSegmentData:L}=u,I=tB(o,t);if(I&&zi(I.method)){const P=this.getDecrypter(),O=$p(I.method);if(P.isSync()){let M=P.softwareDecrypt(o,I.key.buffer,I.iv.buffer,O);if(r.part>-1){const Z=P.flush();M=Z&&Z.buffer}if(!M)return i.executeEnd=Br(),Rh(r);o=new Uint8Array(M)}else return this.asyncResult=!0,this.decryptionPromise=P.webCryptoDecrypt(o,I.key.buffer,I.iv.buffer,O).then(M=>{const H=this.push(M,null,r);return this.decryptionPromise=null,H}),this.decryptionPromise}const _=this.needsProbing(f,h);if(_){const P=this.configureTransmuxer(o);if(P)return this.logger.warn(`[transmuxer] ${P.message}`),this.observer.emit(R.ERROR,R.ERROR,{type:we.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!1,error:P,reason:P.message}),i.executeEnd=Br(),Rh(r)}(f||h||g||_)&&this.resetInitSegment(L,E,v,A,t),(f||g||_)&&this.resetInitialTimestamp(b),d||this.resetContiguity();const F=this.transmux(o,I,x,p,r);this.asyncResult=Ca(F);const C=this.currentTransmuxState;return C.contiguous=!0,C.discontinuity=!1,C.trackSwitch=!1,i.executeEnd=Br(),F}flush(e){const t=e.transmuxing;t.executeStart=Br();const{decrypter:r,currentTransmuxState:s,decryptionPromise:i}=this;if(i)return this.asyncResult=!0,i.then(()=>this.flush(e));const o=[],{timeOffset:l}=s;if(r){const h=r.flush();h&&o.push(this.push(h.buffer,null,e))}const{demuxer:u,remuxer:d}=this;if(!u||!d){t.executeEnd=Br();const h=[Rh(e)];return this.asyncResult?Promise.resolve(h):h}const f=u.flush(l);return Ca(f)?(this.asyncResult=!0,f.then(h=>(this.flushRemux(o,h,e),o))):(this.flushRemux(o,f,e),this.asyncResult?Promise.resolve(o):o)}flushRemux(e,t,r){const{audioTrack:s,videoTrack:i,id3Track:o,textTrack:l}=t,{accurateTimeOffset:u,timeOffset:d}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${r.sn}${r.part>-1?" part: "+r.part:""} of ${this.id===ge.MAIN?"level":"track"} ${r.level}`);const f=this.remuxer.remux(s,i,o,l,d,u,!0,this.id);e.push({remuxResult:f,chunkMeta:r}),r.transmuxing.executeEnd=Br()}resetInitialTimestamp(e){const{demuxer:t,remuxer:r}=this;!t||!r||(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,s,i){const{demuxer:o,remuxer:l}=this;!o||!l||(o.resetInitSegment(e,t,r,s),l.resetInitSegment(e,t,r,i))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,s,i){let o;return t&&t.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,t,r,s,i):o=this.transmuxUnencrypted(e,r,s,i),o}transmuxUnencrypted(e,t,r,s){const{audioTrack:i,videoTrack:o,id3Track:l,textTrack:u}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(i,o,l,u,t,r,!1,this.id),chunkMeta:s}}transmuxSampleAes(e,t,r,s,i){return this.demuxer.demuxSampleAes(e,t,r).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,r,s,!1,this.id),chunkMeta:i}))}configureTransmuxer(e){const{config:t,observer:r,typeSupported:s}=this;let i;for(let h=0,p=Kc.length;h<p;h++){var o;if((o=Kc[h].demux)!=null&&o.probe(e,this.logger)){i=Kc[h];break}}if(!i)return new Error("Failed to find demuxer by probing fragment data");const l=this.demuxer,u=this.remuxer,d=i.remux,f=i.demux;(!u||!(u instanceof d))&&(this.remuxer=new d(r,t,s,this.logger)),(!l||!(l instanceof f))&&(this.demuxer=new f(r,t,s,this.logger),this.probe=f.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Bp(this.config)),e}}function tB(n,e){let t=null;return n.byteLength>0&&e?.key!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Rh=n=>({remuxResult:{},chunkMeta:n});function Ca(n){return"then"in n&&n.then instanceof Function}class nB{constructor(e,t,r,s,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=s,this.defaultInitPts=i||null}}class rB{constructor(e,t,r,s,i,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=s,this.timeOffset=i,this.initSegmentChange=o}}let IS=0;class Wb{constructor(e,t,r,s){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=IS++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=u=>{const d=u.data,f=this.hls;if(!(!f||!(d!=null&&d.event)||d.instanceNo!==this.instanceNo))switch(d.event){case"init":{var h;const p=(h=this.workerContext)==null?void 0:h.objectURL;p&&self.URL.revokeObjectURL(p);break}case"transmuxComplete":{this.handleTransmuxComplete(d.data);break}case"flush":{this.onFlush(d.data);break}case"workerLog":{f.logger[d.data.logType]&&f.logger[d.data.logType](d.data.message);break}default:{d.data=d.data||{},d.data.frag=this.frag,d.data.part=this.part,d.data.id=this.id,f.trigger(d.event,d.data);break}}},this.onWorkerError=u=>{if(!this.hls)return;const d=new Error(`${u.message}  (${u.filename}:${u.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(R.ERROR,{type:we.OTHER_ERROR,details:z.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:d})};const i=e.config;this.hls=e,this.id=t,this.useWorker=!!i.enableWorker,this.onTransmuxComplete=r,this.onFlush=s;const o=(u,d)=>{d=d||{},d.frag=this.frag||void 0,u===R.ERROR&&(d=d,d.parent=this.id,d.part=this.part,this.error=d.error),this.hls.trigger(u,d)};this.observer=new Gp,this.observer.on(R.FRAG_DECRYPTED,o),this.observer.on(R.ERROR,o);const l=Gv(i.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const u=this.hls.logger;if(i.workerPath||aF()){try{i.workerPath?(u.log(`loading Web Worker ${i.workerPath} for "${t}"`),this.workerContext=cF(i.workerPath)):(u.log(`injecting Web Worker for "${t}"`),this.workerContext=lF());const{worker:f}=this.workerContext;f.addEventListener("message",this.onWorkerMessage),f.addEventListener("error",this.onWorkerError),f.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:l,id:t,config:st(i)})}catch(f){u.warn(`Error setting up "${t}" Web Worker, fallback to inline`,f),this.terminateWorker(),this.error=null,this.transmuxer=new RS(this.observer,l,i,"",t,e.logger)}return}}this.transmuxer=new RS(this.observer,l,i,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=IS++;const t=this.hls.config,r=Gv(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:r,id:this.id,config:st(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),uF(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,r,s,i,o,l,u,d,f){var h,p;d.transmuxing.start=self.performance.now();const{instanceNo:x,transmuxer:g}=this,E=o?o.start:i.start,v=i.decryptdata,b=this.frag,A=!(b&&i.cc===b.cc),L=!(b&&d.level===b.level),I=b?d.sn-b.sn:-1,_=this.part?d.part-this.part.index:-1,F=I===0&&d.id>1&&d.id===b?.stats.chunkCount,C=!L&&(I===1||I===0&&(_===1||F&&_<=0)),P=self.performance.now();(L||I||i.stats.parsing.start===0)&&(i.stats.parsing.start=P),o&&(_||!C)&&(o.stats.parsing.start=P);const O=!(b&&((h=i.initSegment)==null?void 0:h.url)===((p=b.initSegment)==null?void 0:p.url)),M=new rB(A,C,u,L,E,O);if(!C||A||O){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${i.type} sn: ${d.sn}${d.part>-1?" part: "+d.part:""} ${this.id===ge.MAIN?"level":"track"}: ${d.level} id: ${d.id}
        discontinuity: ${A}
        trackSwitch: ${L}
        contiguous: ${C}
        accurateTimeOffset: ${u}
        timeOffset: ${E}
        initSegmentChange: ${O}`);const H=new nB(r,s,t,l,f);this.configureTransmuxer(H)}if(this.frag=i,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:x,cmd:"demux",data:e,decryptdata:v,chunkMeta:d,state:M},e instanceof ArrayBuffer?[e]:[]);else if(g){const H=g.push(e,v,d,M);Ca(H)?H.then(Z=>{this.handleTransmuxComplete(Z)}).catch(Z=>{this.transmuxerError(Z,d,"transmuxer-interface push error")}):this.handleTransmuxComplete(H)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:r}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(r){const s=r.flush(e);Ca(s)?s.then(i=>{this.handleFlushResult(i,e)}).catch(i=>{this.transmuxerError(i,e,"transmuxer-interface flush error")}):this.handleFlushResult(s,e)}}transmuxerError(e,t,r){this.hls&&(this.error=e,this.hls.trigger(R.ERROR,{type:we.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach(r=>{this.handleTransmuxComplete(r)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:r}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):r&&r.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const kS=100;class sB extends Vp{constructor(e,t,r){super(e,t,r,"audio-stream-controller",ge.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(R.LEVEL_LOADED,this.onLevelLoaded,this),e.on(R.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(R.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(R.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(R.BUFFER_RESET,this.onBufferReset,this),e.on(R.BUFFER_CREATED,this.onBufferCreated,this),e.on(R.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(R.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(R.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(R.FRAG_LOADING,this.onFragLoading,this),e.on(R.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(R.LEVEL_LOADED,this.onLevelLoaded,this),e.off(R.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(R.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(R.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(R.BUFFER_RESET,this.onBufferReset,this),e.off(R.BUFFER_CREATED,this.onBufferCreated,this),e.off(R.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(R.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(R.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(R.FRAG_LOADING,this.onFragLoading,this),e.off(R.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:r,initPTS:s,timescale:i,trackId:o}){if(r===ge.MAIN){const l=t.cc,u=this.fragCurrent;if(this.initPTS[l]={baseTime:s,timescale:i,trackId:o},this.log(`InitPTS for cc: ${l} found from main: ${s/i} (${s}/${i}) trackId: ${o}`),this.mainAnchor=t,this.state===re.WAITING_INIT_PTS){const d=this.waitingData;(!d&&!this.loadingParts||d&&d.frag.cc!==l)&&this.syncWithAnchor(t,d?.frag)}else!this.hls.hasEnoughToStart&&u&&u.cc!==l?(u.abortRequests(),this.syncWithAnchor(t,u)):this.state===re.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var r;const s=((r=this.mainFragLoading)==null?void 0:r.frag)||null;if(t&&s?.cc===t.cc)return;const i=(s||e).cc,o=this.getLevelDetails(),l=this.getLoadPosition(),u=cb(o,i,l);u&&(this.log(`Syncing with main frag at ${u.start} cc ${u.cc}`),this.startFragRequested=!1,this.nextLoadPosition=u.start,this.resetLoadingState(),this.state===re.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=re.STOPPED;return}const r=this.lastCurrentTime;this.stopLoad(),this.setInterval(kS),r>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r,this.state=re.IDLE):this.state=re.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case re.IDLE:this.doTickIdle();break;case re.WAITING_TRACK:{const{levels:e,trackId:t}=this,r=e?.[t],s=r?.details;if(s&&!this.waitForLive(r)){if(this.waitForCdnTuneIn(s))break;this.state=re.WAITING_INIT_PTS}break}case re.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case re.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:r,cache:s,complete:i}=e,o=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=re.FRAG_LOADING;const l=s.flush().buffer,u={frag:t,part:r,payload:l,networkDetails:null};this._handleFragmentLoadProgress(u),i&&super._handleFragmentLoadComplete(u)}else o&&o.cc!==e.frag.cc&&this.syncWithAnchor(o,e.frag)}else this.state=re.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:r,media:s,trackId:i}=this,o=t.config;if(!this.buffering||!s&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(r!=null&&r[i]))return;const l=r[i],u=l.details;if(!u||this.waitForLive(l)||this.waitForCdnTuneIn(u)){this.state=re.WAITING_TRACK,this.startFragRequested=!1;return}const d=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&d&&(this.bufferFlushed=!1,this.afterBufferFlushed(d,rt.AUDIO,ge.AUDIO));const f=this.getFwdBufferInfo(d,ge.AUDIO);if(f===null)return;if(!this.switchingTrack&&this._streamEnded(f,u)){t.trigger(R.BUFFER_EOS,{type:"audio"}),this.state=re.ENDED;return}const h=f.len,p=t.maxBufferLength,x=u.fragments,g=x[0].start,E=this.getLoadPosition(),v=this.flushing?E:f.end;if(this.switchingTrack&&s){const L=E;u.PTSKnown&&L<g&&(f.end>g||f.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),s.currentTime=g+.05)}if(h>=p&&!this.switchingTrack&&v<x[x.length-1].start)return;let b=this.getNextFragment(v,u);if(b&&this.isLoopLoading(b,v)&&(b=this.getNextFragmentLoopLoading(b,u,f,ge.MAIN,p)),!b){this.bufferFlushed=!0;return}let A=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&A&&Tt(b)&&!b.endList&&(!u.live||!this.loadingParts&&v<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(A)===Ct.OK&&(this.mainFragLoading=A=null),A&&Tt(A))){if(b.start>A.end){const I=this.fragmentTracker.getFragAtPos(v,ge.MAIN);I&&I.end>A.end&&(A=I,this.mainFragLoading={frag:I,targetBufferTime:null})}if(b.start>A.end)return}this.loadFragment(b,l,v)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(r=>new Ra(r))}onAudioTrackSwitching(e,t){const r=!!t.url;this.trackId=t.id;const{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),r?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==re.STOPPED&&(this.setInterval(kS),this.state=re.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const r=this.cachedTrackLoadedData;r&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(R.AUDIO_TRACK_LOADED,r))}onAudioTrackLoaded(e,t){var r;const{levels:s}=this,{details:i,id:o,groupId:l,track:u}=t;if(!s){this.warn(`Audio tracks reset while loading track ${o} "${u.name}" of "${l}"`);return}const d=this.mainDetails;if(!d||i.endCC>d.endCC||d.expired){this.cachedTrackLoadedData=t,this.state!==re.STOPPED&&(this.state=re.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${u.name}" of "${l}" loaded [${i.startSN},${i.endSN}]${i.lastPartSn?`[part-${i.lastPartSn}-${i.lastPartIndex}]`:""},duration:${i.totalduration}`);const f=s[o];let h=0;if(i.live||(r=f.details)!=null&&r.live){if(this.checkLiveUpdate(i),i.deltaUpdateFailed)return;if(f.details){var p;h=this.alignPlaylists(i,f.details,(p=this.levelLastLoaded)==null?void 0:p.details)}i.alignedSliding||(Rb(i,d),i.alignedSliding||xu(i,d),h=i.fragmentStart)}f.details=i,this.levelLastLoaded=f,this.startFragRequested||this.setStartPosition(d,h),this.hls.trigger(R.AUDIO_TRACK_UPDATED,{details:i,id:o,groupId:t.groupId}),this.state===re.WAITING_TRACK&&!this.waitForCdnTuneIn(i)&&(this.state=re.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:s,payload:i}=e,{config:o,trackId:l,levels:u}=this;if(!u){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const d=u[l];if(!d){this.warn("Audio track is undefined on fragment load progress");return}const f=d.details;if(!f){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(r.start);return}const h=o.defaultAudioCodec||d.audioCodec||"mp4a.40.2";let p=this.transmuxer;p||(p=this.transmuxer=new Wb(this.hls,ge.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const x=this.initPTS[r.cc],g=(t=r.initSegment)==null?void 0:t.data;if(x!==void 0){const v=s?s.index:-1,b=v!==-1,A=new Up(r.level,r.sn,r.stats.chunkCount,i.byteLength,v,b);p.push(i,g,h,"",r,s,f.totalduration,!1,A,x)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${f.startSN} ,${f.endSN}],track ${l}`);const{cache:E}=this.waitingData=this.waitingData||{frag:r,part:s,cache:new Ib,complete:!1};E.push(new Uint8Array(i)),this.state!==re.STOPPED&&(this.state=re.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===ge.MAIN&&Tt(t.frag)&&(this.mainFragLoading=t,this.state===re.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:r,part:s}=t;if(r.type!==ge.AUDIO){!this.audioOnly&&r.type===ge.MAIN&&!r.elementaryStreams.video&&!r.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${s?" p: "+s.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Tt(r)){this.fragPrevious=r;const i=this.switchingTrack;i&&(this.bufferedTrack=i,this.switchingTrack=null,this.hls.trigger(R.AUDIO_TRACK_SWITCHED,Je({},i)))}this.fragBufferedComplete(r,s),this.media&&this.tick()}onError(e,t){var r;if(t.fatal){this.state=re.ERROR;return}switch(t.details){case z.FRAG_GAP:case z.FRAG_PARSING_ERROR:case z.FRAG_DECRYPT_ERROR:case z.FRAG_LOAD_ERROR:case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_ERROR:case z.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ge.AUDIO,t);break;case z.AUDIO_TRACK_LOAD_ERROR:case z.AUDIO_TRACK_LOAD_TIMEOUT:case z.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===re.WAITING_TRACK&&((r=t.context)==null?void 0:r.type)===Ge.AUDIO_TRACK&&(this.state=re.IDLE);break;case z.BUFFER_ADD_CODEC_ERROR:case z.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case z.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case z.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==rt.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==rt.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===re.ENDED&&(this.state=re.IDLE);const r=this.mediaBuffer||this.media;r&&(this.afterBufferFlushed(r,t,ge.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const r="audio",{hls:s}=this,{remuxResult:i,chunkMeta:o}=e,l=this.getCurrentContext(o);if(!l){this.resetWhenMissingContext(o);return}const{frag:u,part:d,level:f}=l,{details:h}=f,{audio:p,text:x,id3:g,initSegment:E}=i;if(this.fragContextChanged(u)||!h){this.fragmentTracker.removeFragment(u);return}if(this.state=re.PARSING,this.switchingTrack&&p&&this.completeAudioSwitch(this.switchingTrack),E!=null&&E.tracks){const v=u.initSegment||u;if(this.unhandledEncryptionError(E,u))return;this._bufferInitSegment(f,E.tracks,v,o),s.trigger(R.FRAG_PARSING_INIT_SEGMENT,{frag:v,id:r,tracks:E.tracks})}if(p){const{startPTS:v,endPTS:b,startDTS:A,endDTS:L}=p;d&&(d.elementaryStreams[rt.AUDIO]={startPTS:v,endPTS:b,startDTS:A,endDTS:L}),u.setElementaryStreamInfo(rt.AUDIO,v,b,A,L),this.bufferFragmentData(p,u,d,o)}if(g!=null&&(t=g.samples)!=null&&t.length){const v=tt({id:r,frag:u,details:h},g);s.trigger(R.FRAG_PARSING_METADATA,v)}if(x){const v=tt({id:r,frag:u,details:h},x);s.trigger(R.FRAG_PARSING_USERDATA,v)}}_bufferInitSegment(e,t,r,s){if(this.state!==re.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const i=t.audio;i.id=ge.AUDIO;const o=e.audioCodec;this.log(`Init audio buffer, container:${i.container}, codecs[level/parsed]=[${o}/${i.codec}]`),o&&o.split(",").length===1&&(i.levelCodec=o),this.hls.trigger(R.BUFFER_CODECS,t);const l=i.initSegment;if(l!=null&&l.byteLength){const u={type:"audio",frag:r,part:null,chunkMeta:s,parent:r.type,data:l};this.hls.trigger(R.BUFFER_APPENDING,u)}this.tickImmediate()}loadFragment(e,t,r){const s=this.fragmentTracker.getState(e);if(this.switchingTrack||s===Ct.NOT_LOADED||s===Ct.PARTIAL){var i;if(!Tt(e))this._loadInitSegment(e,t);else if((i=t.details)!=null&&i.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=re.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragmentStart!==t.details.fragmentStart&&xu(t.details,o)}else super.loadFragment(e,t,r)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:r,assocLang:s,characteristics:i,audioCodec:o,channels:l}=this.bufferedTrack;ri({name:t,lang:r,assocLang:s,characteristics:i,audioCodec:o,channels:l},e,Xs)||(hu(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(R.AUDIO_TRACK_SWITCHED,Je({},e))}}class Xp extends Vn{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,r){const s=t?.renditionReports;if(s){let i=-1;for(let o=0;o<s.length;o++){const l=s[o];let u;try{u=new self.URL(l.URI,t.url).href}catch(d){this.warn(`Could not construct new URL for Rendition Report: ${d}`),u=l.URI||""}if(u===e){i=o;break}else u===e.substring(0,u.length)&&(i=o)}if(i!==-1){const o=s[i],l=parseInt(o["LAST-MSN"])||t.lastPartSn;let u=parseInt(o["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const f=Math.min(t.age-t.partTarget,t.targetduration);u>=0&&f>t.partTarget&&(u+=1)}const d=r&&Hv(r);return new Kv(l,u>=0?u:void 0,d)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(r){this.warn(`Could not construct new URL with HLS Delivery Directives: ${r}`)}return e}playlistLoaded(e,t,r){const{details:s,stats:i}=t,o=self.performance.now(),l=i.loading.first?Math.max(0,o-i.loading.first):0;s.advancedDateTime=Date.now()-l;const u=this.hls.config.timelineOffset;if(u!==s.appliedTimelineOffset){const f=Math.max(u||0,0);s.appliedTimelineOffset=f,s.fragments.forEach(h=>{h.setStart(h.playlistOffset+f)})}if(s.live||r!=null&&r.live){const f="levelInfo"in t?t.levelInfo:t.track;if(s.reloaded(r),r&&s.fragments.length>0){XM(r,s,this);const A=s.playlistParsingError;if(A){this.warn(A);const L=this.hls;if(!L.config.ignorePlaylistParsingErrors){var d;const{networkDetails:I}=t;L.trigger(R.ERROR,{type:we.NETWORK_ERROR,details:z.LEVEL_PARSING_ERROR,fatal:!1,url:s.url,error:A,reason:A.message,level:t.level||void 0,parent:(d=s.fragments[0])==null?void 0:d.type,networkDetails:I,stats:i});return}s.playlistParsingError=null}}s.requestScheduled===-1&&(s.requestScheduled=i.loading.start);const h=this.hls.mainForwardBufferInfo,p=h?h.end-h.len:0,x=(s.edge-p)*1e3,g=Tb(s,x);if(s.requestScheduled+g<o?s.requestScheduled=o:s.requestScheduled+=g,this.log(`live playlist ${e} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:s.updated?"UPDATED":"MISSED"}`),!this.canLoad||!s.live)return;let E,v,b;if(s.canBlockReload&&s.endSN&&s.advanced){const A=this.hls.config.lowLatencyMode,L=s.lastPartSn,I=s.endSN,_=s.lastPartIndex,F=_!==-1,C=L===I;F?C?(v=I+1,b=A?0:_):(v=L,b=A?_+1:s.maxPartIndex):v=I+1;const P=s.age,O=P+s.ageHeader;let M=Math.min(O-s.partTarget,s.targetduration*1.5);if(M>0){if(O>s.targetduration*3)this.log(`Playlist last advanced ${P.toFixed(2)}s ago. Omitting segment and part directives.`),v=void 0,b=void 0;else if(r!=null&&r.tuneInGoal&&O-s.partTarget>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${M} with playlist age: ${s.age}`),M=0;else{const H=Math.floor(M/s.targetduration);if(v+=H,b!==void 0){const Z=Math.round(M%s.targetduration/s.partTarget);b+=Z}this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${P.toFixed(2)}s goal: ${M} skip sn ${H} to part ${b}`)}s.tuneInGoal=M}if(E=this.getDeliveryDirectives(s,t.deliveryDirectives,v,b),A||!C){s.requestScheduled=o,this.loadingPlaylist(f,E);return}}else(s.canBlockReload||s.canSkipUntil)&&(E=this.getDeliveryDirectives(s,t.deliveryDirectives,v,b));E&&v!==void 0&&s.canBlockReload&&(s.requestScheduled=i.loading.first+Math.max(g-l*2,g/2)),this.scheduleLoading(f,E,s)}else this.clearTimer()}scheduleLoading(e,t,r){const s=r||e.details;if(!s){this.loadingPlaylist(e,t);return}const i=self.performance.now(),o=s.requestScheduled;if(i>=o){this.loadingPlaylist(e,t);return}const l=o-i;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(l)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),l)}getDeliveryDirectives(e,t,r,s){let i=Hv(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,s=t.part,i=Vc.No),new Kv(r,s,i)}checkRetry(e){const t=e.details,r=mu(e),s=e.errorAction,{action:i,retryCount:o=0,retryConfig:l}=s||{},u=!!s&&!!l&&(i===Ut.RetryRequest||!s.resolved&&i===Ut.SendAlternateToPenaltyBox);if(u){var d;if(o>=l.maxNumRetry)return!1;if(r&&(d=e.context)!=null&&d.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${l.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const f=Fp(l,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),f),this.warn(`Retrying playlist loading ${o+1}/${l.maxNumRetry} after "${t}" in ${f}ms`)}e.levelRetry=!0,s.resolved=!0}return u}}function Yb(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!_a(n[t].attrs,e[t].attrs))return!1;return!0}function _a(n,e,t){const r=n["STABLE-RENDITION-ID"];return r&&!t?r===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(s=>n[s]!==e[s])}function Nm(n,e){return e.label.toLowerCase()===n.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(n.lang||"").toLowerCase())}class iB extends Xp{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.MANIFEST_PARSED,this.onManifestParsed,this),e.on(R.LEVEL_LOADING,this.onLevelLoading,this),e.on(R.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(R.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(R.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.MANIFEST_PARSED,this.onManifestParsed,this),e.off(R.LEVEL_LOADING,this.onLevelLoading,this),e.off(R.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(R.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(R.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:r,groupId:s,details:i}=t,o=this.tracksInGroup[r];if(!o||o.groupId!==s){this.warn(`Audio track with id:${r} and group:${s} not found in active group ${o?.groupId}`);return}const l=o.details;o.details=t.details,this.log(`Audio track ${r} "${o.name}" lang:${o.lang} group:${s} loaded [${i.startSN}-${i.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,l)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.audioGroups||null,s=this.groupIds;let i=this.currentTrack;if(!r||s?.length!==r?.length||r!=null&&r.some(l=>s?.indexOf(l)===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const l=this.tracks.filter(p=>!r||r.indexOf(p.groupId)!==-1);if(l.length)this.selectDefaultTrack&&!l.some(p=>p.default)&&(this.selectDefaultTrack=!1),l.forEach((p,x)=>{p.id=x});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=l;const u=this.hls.config.audioPreference;if(!i&&u){const p=yr(u,l,Xs);if(p>-1)i=l[p];else{const x=yr(u,this.tracks);i=this.tracks[x]}}let d=this.findTrackId(i);d===-1&&i&&(d=this.findTrackId(null));const f={audioTracks:l};this.log(`Updating audio tracks, ${l.length} track(s) found in group(s): ${r?.join(",")}`),this.hls.trigger(R.AUDIO_TRACKS_UPDATED,f);const h=this.trackId;if(d!==-1&&h===-1)this.setAudioTrack(d);else if(l.length&&h===-1){var o;const p=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${l.length}`);this.warn(p.message),this.hls.trigger(R.ERROR,{type:we.MEDIA_ERROR,details:z.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:p})}}}onError(e,t){t.fatal||!t.context||t.context.type===Ge.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const r=this.allAudioTracks;if(this.selectDefaultTrack=!1,r.length){const s=this.currentTrack;if(s&&ri(e,s,Xs))return s;const i=yr(e,this.tracksInGroup,Xs);if(i>-1){const o=this.tracksInGroup[i];return this.setAudioTrack(i),o}else if(s){let o=t.loadLevel;o===-1&&(o=t.firstAutoLevel);const l=yM(e,t.levels,r,o,Xs);if(l===-1)return null;t.nextLoadLevel=l}if(e.channels||e.audioCodec){const o=yr(e,r);if(o>-1)return r[o]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,s=t[e],i=s.details&&!s.details.live;if(e===this.trackId&&s===r&&i||(this.log(`Switching to audio-track ${e} "${s.name}" lang:${s.lang} group:${s.groupId} channels:${s.channels}`),this.trackId=e,this.currentTrack=s,this.hls.trigger(R.AUDIO_TRACK_SWITCHING,Je({},s)),i))return;const o=this.switchParams(s.url,r?.details,s.details);this.loadPlaylist(o)}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const s=t[r];if(!(this.selectDefaultTrack&&!s.default)&&(!e||ri(e,s,Xs)))return r}if(e){const{name:r,lang:s,assocLang:i,characteristics:o,audioCodec:l,channels:u}=e;for(let d=0;d<t.length;d++){const f=t[d];if(ri({name:r,lang:s,assocLang:i,characteristics:o,audioCodec:l,channels:u},f,Xs))return d}for(let d=0;d<t.length;d++){const f=t[d];if(_a(e.attrs,f.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return d}for(let d=0;d<t.length;d++){const f=t[d];if(_a(e.attrs,f.attrs,["LANGUAGE"]))return d}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&hu(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,s=e.groupId,i=this.getUrlWithDirectives(e.url,t),o=e.details,l=o?.age;this.log(`Loading audio-track ${r} "${e.name}" lang:${e.lang} group:${s}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${l&&o.live?" age "+l.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(R.AUDIO_TRACK_LOADING,{url:i,id:r,groupId:s,deliveryDirectives:t||null,track:e})}}class oB{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,r){if(this.queues===null||this.tracks===null)return;const s=this.queues[t];s.push(e),s.length===1&&!r&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const r={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(r,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const r={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(r)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const r=(t=e[0])==null?void 0:t.label;(r==="async-blocker"||r==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const s=t[0];try{s.execute()}catch(i){var r;if(s.onError(i),this.queues===null||this.tracks===null)return;const o=(r=this.tracks[e])==null?void 0:r.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,r;return(t=this.queues)!=null&&t[e]||(r=this.tracks)!=null&&r[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const r=(t=this.tracks)==null?void 0:t[e],s=r?.buffer;return s?`SourceBuffer${s.updating?" updating":""}${r.ended?" ended":""}${r.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(r=>r.label).join(", "))||""}}const CS=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,qb="HlsJsTrackRemovedError";class aB extends Error{constructor(e){super(e),this.name=qb}}class lB extends Vn{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=r=>{var s;this.hls&&((s=this.mediaSource)==null?void 0:s.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=r=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=r=>{const{media:s,mediaSource:i}=this;r&&this.log("Media source opened"),!(!s||!i)&&(i.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(R.MEDIA_ATTACHED,{media:s,mediaSource:i}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:r,_objectUrl:s}=this;r!==s&&this.error(`Media element src was set while attaching MediaSource (${s} > ${r})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=CO(Rs(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.MANIFEST_PARSED,this.onManifestParsed,this),e.on(R.BUFFER_RESET,this.onBufferReset,this),e.on(R.BUFFER_APPENDING,this.onBufferAppending,this),e.on(R.BUFFER_CODECS,this.onBufferCodecs,this),e.on(R.BUFFER_EOS,this.onBufferEos,this),e.on(R.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(R.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(R.FRAG_PARSED,this.onFragParsed,this),e.on(R.FRAG_CHANGED,this.onFragChanged,this),e.on(R.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.MANIFEST_PARSED,this.onManifestParsed,this),e.off(R.BUFFER_RESET,this.onBufferReset,this),e.off(R.BUFFER_APPENDING,this.onBufferAppending,this),e.off(R.BUFFER_CODECS,this.onBufferCodecs,this),e.off(R.BUFFER_EOS,this.onBufferEos,this),e.off(R.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(R.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(R.FRAG_PARSED,this.onFragParsed,this),e.off(R.FRAG_CHANGED,this.onFragChanged,this),e.off(R.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const r={};if(this.operationQueue){const i=this.isUpdating();i||this.operationQueue.removeBlockers();const o=this.isQueued();(i||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${i?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const s=this.transferData;return!this.sourceBufferCount&&s&&s.mediaSource===t?tt(r,s.tracks):this.sourceBuffers.forEach(i=>{const[o]=i;o&&(r[o]=tt({},this.tracks[o]),this.removeBuffer(o)),i[0]=i[1]=null}),{media:e,mediaSource:t,tracks:r}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var r;let s=2;(t.audio&&!t.video||!t.altAudio)&&(s=1),this.bufferCodecEventsTotal=s,this.log(`${s} bufferCodec event(s) expected.`),(r=this.transferData)!=null&&r.mediaSource&&this.sourceBufferCount&&s&&this.bufferCreated()}onMediaAttaching(e,t){const r=this.media=t.media;this.transferData=this.overrides=void 0;const s=Rs(this.appendSource);if(s){const i=!!t.mediaSource;(i||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const o=this.mediaSource=t.mediaSource||new s;if(this.assignMediaSource(o),i)this._objectUrl=r.src,this.attachTransferred();else{const l=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{r.removeAttribute("src");const u=self.ManagedMediaSource;r.disableRemotePlayback=r.disableRemotePlayback||u&&o instanceof u,_S(r),cB(r,l),r.load()}catch{r.src=l}else r.src=l}r.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,r;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(r=e.constructor)==null?void 0:r.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const r=this.tracks,s=t.tracks,i=s?Object.keys(s):null,o=i?i.length:0,l=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(s&&i&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${st(r,(u,d)=>u==="initSegment"?void 0:d)};
transfer tracks: ${st(s,(u,d)=>u==="initSegment"?void 0:d)}}`),!K1(s,r)){t.mediaSource=null,t.tracks=void 0;const u=e.currentTime,d=this.details,f=Math.max(u,d?.fragments[0].start||0);if(f-u>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${u} -> ${f}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(s)}"->"${Object.keys(r)}") start time: ${f} currentTime: ${u}`),this.onMediaDetaching(R.MEDIA_DETACHING,{}),this.onMediaAttaching(R.MEDIA_ATTACHING,t),e.currentTime=f;return}this.transferData=void 0,i.forEach(u=>{const d=u,f=s[d];if(f){const h=f.buffer;if(h){const p=this.fragmentTracker,x=f.id;if(p.hasFragments(x)||p.hasParts(x)){const v=Oe.getBuffered(h);p.detectEvictedFragments(d,v,x,null,!0)}const g=Ih(d),E=[d,h];this.sourceBuffers[g]=E,h.updating&&this.operationQueue&&this.operationQueue.prependBlocker(d),this.trackSourceBuffer(d,f)}}}),l(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),l()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const r=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:s,mediaSource:i,_objectUrl:o}=this;if(i){if(this.log(`media source ${r?"transferring":"detaching"}`),r)this.sourceBuffers.forEach(([l])=>{l&&this.removeBuffer(l)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const l=i.readyState==="open";try{const u=i.sourceBuffers;for(let d=u.length;d--;)l&&u[d].abort(),i.removeSourceBuffer(u[d]);l&&i.endOfStream()}catch(u){this.warn(`onMediaDetaching: ${u.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(i.removeEventListener("startstreaming",this._onStartStreaming),i.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}s&&(s.removeEventListener("emptied",this._onMediaEmptied),r||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(s.removeAttribute("src"),this.appendSource&&_S(s),s.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(R.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const r=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),r)try{var s;(s=this.mediaSource)!=null&&s.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(r)}catch(i){this.warn(`onBufferReset ${e}`,i)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Ih(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new oB(this.tracks)}onBufferCodecs(e,t){var r;const s=this.tracks,i=Object.keys(t);this.log(`BUFFER_CODECS: "${i}" (current SB count ${this.sourceBufferCount})`);const o="audiovideo"in t&&(s.audio||s.video)||s.audiovideo&&("audio"in t||"video"in t),l=!o&&this.sourceBufferCount&&this.media&&i.some(u=>!s[u]);if(o||l){this.warn(`Unsupported transition between "${Object.keys(s)}" and "${i}" SourceBuffers`);return}i.forEach(u=>{var d,f;const h=t[u],{id:p,codec:x,levelCodec:g,container:E,metadata:v,supplemental:b}=h;let A=s[u];const L=(d=this.transferData)==null||(d=d.tracks)==null?void 0:d[u],I=L!=null&&L.buffer?L:A,_=I?.pendingCodec||I?.codec,F=I?.levelCodec;A||(A=s[u]={buffer:void 0,listeners:[],codec:x,supplemental:b,container:E,levelCodec:g,metadata:v,id:p});const C=jc(_,F),P=C?.replace(CS,"$1");let O=jc(x,g);const M=(f=O)==null?void 0:f.replace(CS,"$1");O&&C&&P!==M&&(u.slice(0,5)==="audio"&&(O=du(O,this.appendSource)),this.log(`switching codec ${_} to ${O}`),O!==(A.pendingCodec||A.codec)&&(A.pendingCodec=O),A.container=E,this.appendChangeType(u,E,O))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((r=t.audio)==null?void 0:r.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const r=this.tracks[t];return e[t]={id:r.id,container:r.container,codec:r.codec,levelCodec:r.levelCodec},e},{})}appendChangeType(e,t,r){const s=`${t};codecs=${r}`,i={label:`change-type=${s}`,execute:()=>{const o=this.tracks[e];if(o){const l=o.buffer;l!=null&&l.changeType&&(this.log(`changing ${e} sourceBuffer type to ${s}`),l.changeType(s),o.codec=r,o.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${e} SourceBuffer type`,o)}};this.append(i,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const r=e.start,s=r+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(r,ge.MAIN))==null?void 0:t.gap)===!0)return;const o={label:"block-audio",execute:()=>{var l;const u=this.tracks.video;(this.lastVideoAppendEnd>s||u!=null&&u.buffer&&Oe.isBuffered(u.buffer,s)||((l=this.fragmentTracker.getAppendedFrag(s,ge.MAIN))==null?void 0:l.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:l=>{this.warn("Error executing block-audio operation",l)}};this.blockedAudioAppend={op:o,frag:e},this.append(o,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:r}=this,{data:s,type:i,parent:o,frag:l,part:u,chunkMeta:d,offset:f}=t,h=d.buffering[i],{sn:p,cc:x}=l,g=self.performance.now();h.start=g;const E=l.stats.buffering,v=u?u.stats.buffering:null;E.start===0&&(E.start=g),v&&v.start===0&&(v.start=g);const b=r.audio;let A=!1;i==="audio"&&b?.container==="audio/mpeg"&&(A=!this.lastMpegAudioChunk||d.id===1||this.lastMpegAudioChunk.sn!==d.sn,this.lastMpegAudioChunk=d);const L=r.video,I=L?.buffer;if(I&&p!=="initSegment"){const C=u||l,P=this.blockedAudioAppend;if(i==="audio"&&o!=="main"&&!this.blockedAudioAppend&&!(L.ending||L.ended)){const M=C.start+C.duration*.05,H=I.buffered,Z=this.currentOp("video");!H.length&&!Z?this.blockAudio(C):!Z&&!Oe.isBuffered(I,M)&&this.lastVideoAppendEnd<M&&this.blockAudio(C)}else if(i==="video"){const O=C.end;if(P){const M=P.frag.start;(O>M||O<this.lastVideoAppendEnd||Oe.isBuffered(I,M))&&this.unblockAudio()}this.lastVideoAppendEnd=O}}const _=(u||l).start,F={label:`append-${i}`,execute:()=>{var C;h.executeStart=self.performance.now();const P=(C=this.tracks[i])==null?void 0:C.buffer;P&&(A?this.updateTimestampOffset(P,_,.1,i,p,x):f!==void 0&&he(f)&&this.updateTimestampOffset(P,f,1e-6,i,p,x)),this.appendExecutor(s,i)},onStart:()=>{},onComplete:()=>{const C=self.performance.now();h.executeEnd=h.end=C,E.first===0&&(E.first=C),v&&v.first===0&&(v.first=C);const P={};this.sourceBuffers.forEach(([O,M])=>{O&&(P[O]=Oe.getBuffered(M))}),this.appendErrors[i]=0,i==="audio"||i==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(R.BUFFER_APPENDED,{type:i,frag:l,part:u,chunkMeta:d,parent:l.type,timeRanges:P})},onError:C=>{var P;const O={type:we.MEDIA_ERROR,parent:l.type,details:z.BUFFER_APPEND_ERROR,sourceBufferName:i,frag:l,part:u,chunkMeta:d,error:C,err:C,fatal:!1},M=(P=this.media)==null?void 0:P.error;if(C.code===DOMException.QUOTA_EXCEEDED_ERR||C.name=="QuotaExceededError"||"quota"in C)O.details=z.BUFFER_FULL_ERROR;else if(C.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!M)O.errorAction=Ki(!0);else if(C.name===qb&&this.sourceBufferCount===0)O.errorAction=Ki(!0);else{const H=++this.appendErrors[i];this.warn(`Failed ${H}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${i}" sourceBuffer (${M||"no media error"})`),(H>=this.hls.config.appendErrorMaxRetry||M)&&(O.fatal=!0)}this.hls.trigger(R.ERROR,O)}};this.log(`queuing "${i}" append sn: ${p}${u?" p: "+u.index:""} of ${l.type===ge.MAIN?"level":"track"} ${l.level} cc: ${x}`),this.append(F,i,this.isPending(this.tracks[i]))}getFlushOp(e,t,r){return this.log(`queuing "${e}" remove ${t}-${r}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,r)},onStart:()=>{},onComplete:()=>{this.hls.trigger(R.BUFFER_FLUSHED,{type:e})},onError:s=>{this.warn(`Failed to remove ${t}-${r} from "${e}" SourceBuffer`,s)}}}onBufferFlushing(e,t){const{type:r,startOffset:s,endOffset:i}=t;r?this.append(this.getFlushOp(r,s,i),r):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,s,i),o)})}onFragParsed(e,t){const{frag:r,part:s}=t,i=[],o=s?s.elementaryStreams:r.elementaryStreams;o[rt.AUDIOVIDEO]?i.push("audiovideo"):(o[rt.AUDIO]&&i.push("audio"),o[rt.VIDEO]&&i.push("video"));const l=()=>{const u=self.performance.now();r.stats.buffering.end=u,s&&(s.stats.buffering.end=u);const d=s?s.stats:r.stats;this.hls.trigger(R.FRAG_BUFFERED,{frag:r,part:s,stats:d,id:r.type})};i.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers(l,i).catch(u=>{this.warn(`Fragment buffered callback ${u}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var r;this.sourceBuffers.forEach(([o])=>{if(o){const l=this.tracks[o];(!t.type||t.type===o)&&(l.ending=!0,l.ended||(l.ended=!0,this.log(`${o} buffer reached EOS`)))}});const s=((r=this.overrides)==null?void 0:r.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var l;return o&&!((l=this.tracks[o])!=null&&l.ended)})?s?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(R.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(R.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===z.BUFFER_APPEND_ERROR&&t.frag){var r;const s=(r=t.errorAction)==null?void 0:r.nextAutoLevel;he(s)&&s!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:r}=this;if(!r||t===null||!this.sourceBufferCount)return;const s=e.config,i=r.currentTime,o=t.levelTargetDuration,l=t.live&&s.liveBackBufferLength!==null?s.liveBackBufferLength:s.backBufferLength;if(he(l)&&l>=0){const d=Math.max(l,o),f=Math.floor(i/o)*o-d;this.flushBackBuffer(i,o,f)}const u=s.frontBufferFlushThreshold;if(he(u)&&u>0){const d=Math.max(s.maxBufferLength,u),f=Math.max(d,o),h=Math.floor(i/o)*o+f;this.flushFrontBuffer(i,o,h)}}flushBackBuffer(e,t,r){this.sourceBuffers.forEach(([s,i])=>{if(i){const l=Oe.getBuffered(i);if(l.length>0&&r>l.start(0)){var o;this.hls.trigger(R.BACK_BUFFER_REACHED,{bufferEnd:r});const u=this.tracks[s];if((o=this.details)!=null&&o.live)this.hls.trigger(R.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r});else if(u!=null&&u.ended){this.log(`Cannot flush ${s} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(R.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:s})}}})}flushFrontBuffer(e,t,r){this.sourceBuffers.forEach(([s,i])=>{if(i){const o=Oe.getBuffered(i),l=o.length;if(l<2)return;const u=o.start(l-1),d=o.end(l-1);if(r>u||e>=u&&e<=d)return;this.hls.trigger(R.BUFFER_FLUSHING,{startOffset:u,endOffset:1/0,type:s})}})}getDurationAndRange(){var e;const{details:t,mediaSource:r}=this;if(!t||!this.media||r?.readyState!=="open")return null;const s=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&r.setLiveSeekableRange){const d=Math.max(0,t.fragmentStart),f=Math.max(d,s);return{duration:1/0,start:d,end:f}}return{duration:1/0}}const i=(e=this.overrides)==null?void 0:e.duration;if(i)return he(i)?{duration:i}:null;const o=this.media.duration,l=he(r.duration)?r.duration:0;return s>l&&s>o||!he(o)?{duration:s}:null}updateMediaSource({duration:e,start:t,end:r}){const s=this.mediaSource;!this.media||!s||s.readyState!=="open"||(s.duration!==e&&(he(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),s.duration=e),t!==void 0&&r!==void 0&&(this.log(`MediaSource duration is set to ${s.duration}. Setting seekable range to ${t}-${r}.`),s.setLiveSeekableRange(t,r)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:r}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${st(r)}`),this.tracksReady){var s;const i=(s=this.transferData)==null?void 0:s.tracks;i&&Object.keys(i).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,r])=>{if(t){const s=this.tracks[t];e[t]={buffer:r,container:s.container,codec:s.codec,supplemental:s.supplemental,levelCodec:s.levelCodec,id:s.id,metadata:s.metadata}}}),this.hls.trigger(R.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(R.ERROR,{type:we.MEDIA_ERROR,details:z.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:r}=this;if(!r)throw new Error("createSourceBuffers called when mediaSource was null");for(const i in e){const o=i,l=e[o];if(this.isPending(l)){const u=this.getTrackCodec(l,o),d=`${l.container};codecs=${u}`;l.codec=u,this.log(`creating sourceBuffer(${d})${this.currentOp(o)?" Queued":""} ${st(l)}`);try{const f=r.addSourceBuffer(d),h=Ih(o),p=[o,f];t[h]=p,l.buffer=f}catch(f){var s;this.error(`error while trying to add sourceBuffer: ${f.message}`),this.shiftAndExecuteNext(o),(s=this.operationQueue)==null||s.removeBlockers(),delete this.tracks[o],this.hls.trigger(R.ERROR,{type:we.MEDIA_ERROR,details:z.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:f,sourceBufferName:o,mimeType:d,parent:l.id});return}this.trackSourceBuffer(o,l)}}this.bufferCreated()}getTrackCodec(e,t){const r=e.supplemental;let s=e.codec;r&&(t==="video"||t==="audiovideo")&&Aa(r,"video")&&(s=JO(s,r));const i=jc(s,e.levelCodec);return i?t.slice(0,5)==="audio"?du(i,this.appendSource):i:""}trackSourceBuffer(e,t){const r=t.buffer;if(!r)return;const s=this.getTrackCodec(t,e);this.tracks[e]={buffer:r,codec:s,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(i,o)=>{const l=o.removedRanges;l!=null&&l.length&&this.hls.trigger(R.BUFFER_FLUSHED,{type:i})})}get mediaSrc(){var e,t;const r=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return r?.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const r=this.currentOp(e);r&&(r.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var r;const s=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(r=this.mediaSource)==null?void 0:r.readyState}`);this.error(`${s}`,t),this.hls.trigger(R.ERROR,{type:we.MEDIA_ERROR,details:z.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:s,fatal:!1});const i=this.currentOp(e);i&&i.onError(s)}updateTimestampOffset(e,t,r,s,i,o){const l=t-e.timestampOffset;Math.abs(l)>=r&&(this.log(`Updating ${s} SourceBuffer timestampOffset to ${t} (sn: ${i} cc: ${o})`),e.timestampOffset=t)}removeExecutor(e,t,r){const{media:s,mediaSource:i}=this,o=this.tracks[e],l=o?.buffer;if(!s||!i||!l){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const u=he(s.duration)?s.duration:1/0,d=he(i.duration)?i.duration:1/0,f=Math.max(0,t),h=Math.min(r,u,d);h>f&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${f},${h}] from the ${e} SourceBuffer`),l.remove(f,h)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const r=this.tracks[t],s=r?.buffer;if(!s)throw new aB(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);r.ending=!1,r.ended=!1,s.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:r}=this,s=t.map(o=>this.appendBlocker(o));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(s).then(o=>{r===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var r;const s=(r=this.tracks[t])==null?void 0:r.buffer;!s||s.updating||this.shiftAndExecuteNext(t)})}append(e,t,r){this.operationQueue&&this.operationQueue.append(e,t,r)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,r){const s=this.tracks[e];if(!s)return;const i=s.buffer;if(!i)return;const o=r.bind(this,e);s.listeners.push({event:t,listener:o}),i.addEventListener(t,o)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const r=t.buffer;r&&(t.listeners.forEach(s=>{r.removeEventListener(s.event,s.listener)}),t.listeners.length=0)}}function _S(n){const e=n.querySelectorAll("source");[].slice.call(e).forEach(t=>{n.removeChild(t)})}function cB(n,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,n.appendChild(t)}function Ih(n){return n==="audio"?1:0}class Qp{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(R.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(R.MANIFEST_PARSED,this.onManifestParsed,this),e.on(R.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(R.BUFFER_CODECS,this.onBufferCodecs,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(R.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(R.MANIFEST_PARSED,this.onManifestParsed,this),e.off(R.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(R.BUFFER_CODECS,this.onBufferCodecs,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&he(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,r=this.getMaxLevel(e.length-1);r!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${r}: ${e[r].height}p@${e[r].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=r,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const r=t.filter((s,i)=>this.isLevelAllowed(s)&&i<=e);return this.clientRect=null,Qp.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,!t.width&&!t.height&&(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(r=>e.bitrate===r.bitrate&&e.width===r.width&&e.height===r.height)}static getMaxLevelByMediaSize(e,t,r){if(!(e!=null&&e.length))return-1;const s=(l,u)=>u?l.width!==u.width||l.height!==u.height:!0;let i=e.length-1;const o=Math.max(t,r);for(let l=0;l<e.length;l+=1){const u=e[l];if((u.width>=o||u.height>=o)&&s(u,e[l+1])){i=l;break}}return i}}const uB={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},cn=uB,dB={HLS:"h"},fB=dB;class Er{constructor(e,t){Array.isArray(e)&&(e=e.map(r=>r instanceof Er?r:new Er(r))),this.value=e,this.params=t}}const hB="Dict";function mB(n){return Array.isArray(n)?JSON.stringify(n):n instanceof Map?"Map{}":n instanceof Set?"Set{}":typeof n=="object"?JSON.stringify(n):String(n)}function pB(n,e,t,r){return new Error(`failed to ${n} "${mB(e)}" as ${t}`,{cause:r})}function Tr(n,e,t){return pB("serialize",n,e,t)}class Xb{constructor(e){this.description=e}}const PS="Bare Item",gB="Boolean";function yB(n){if(typeof n!="boolean")throw Tr(n,gB);return n?"?1":"?0"}function xB(n){return btoa(String.fromCharCode(...n))}const vB="Byte Sequence";function SB(n){if(ArrayBuffer.isView(n)===!1)throw Tr(n,vB);return`:${xB(n)}:`}const EB="Integer";function TB(n){return n<-999999999999999||999999999999999<n}function Qb(n){if(TB(n))throw Tr(n,EB);return n.toString()}function bB(n){return`@${Qb(n.getTime()/1e3)}`}function Jb(n,e){if(n<0)return-Jb(-n,e);const t=Math.pow(10,e);if(Math.abs(n*t%1-.5)<Number.EPSILON){const s=Math.floor(n*t);return(s%2===0?s:s+1)/t}else return Math.round(n*t)/t}const wB="Decimal";function AB(n){const e=Jb(n,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Tr(n,wB);const t=e.toString();return t.includes(".")?t:`${t}.0`}const LB="String",RB=/[\x00-\x1f\x7f]+/;function IB(n){if(RB.test(n))throw Tr(n,LB);return`"${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function kB(n){return n.description||n.toString().slice(7,-1)}const CB="Token";function DS(n){const e=kB(n);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Tr(e,CB);return e}function Om(n){switch(typeof n){case"number":if(!he(n))throw Tr(n,PS);return Number.isInteger(n)?Qb(n):AB(n);case"string":return IB(n);case"symbol":return DS(n);case"boolean":return yB(n);case"object":if(n instanceof Date)return bB(n);if(n instanceof Uint8Array)return SB(n);if(n instanceof Xb)return DS(n);default:throw Tr(n,PS)}}const _B="Key";function Mm(n){if(/^[a-z*][a-z0-9\-_.*]*$/.test(n)===!1)throw Tr(n,_B);return n}function Jp(n){return n==null?"":Object.entries(n).map(([e,t])=>t===!0?`;${Mm(e)}`:`;${Mm(e)}=${Om(t)}`).join("")}function Zb(n){return n instanceof Er?`${Om(n.value)}${Jp(n.params)}`:Om(n)}function PB(n){return`(${n.value.map(Zb).join(" ")})${Jp(n.params)}`}function DB(n,e={whitespace:!0}){if(typeof n!="object"||n==null)throw Tr(n,hB);const t=n instanceof Map?n.entries():Object.entries(n),r=e?.whitespace?" ":"";return Array.from(t).map(([s,i])=>{i instanceof Er||(i=new Er(i));let o=Mm(s);return i.value===!0?o+=Jp(i.params):(o+="=",Array.isArray(i.value)?o+=PB(i):o+=Zb(i)),o}).join(`,${r}`)}function ew(n,e){return DB(n,e)}const fr="CMCD-Object",xt="CMCD-Request",Ks="CMCD-Session",ps="CMCD-Status",NB={br:fr,ab:fr,d:fr,ot:fr,tb:fr,tpb:fr,lb:fr,tab:fr,lab:fr,url:fr,pb:xt,bl:xt,tbl:xt,dl:xt,ltc:xt,mtp:xt,nor:xt,nrr:xt,rc:xt,sn:xt,sta:xt,su:xt,ttfb:xt,ttfbb:xt,ttlb:xt,cmsdd:xt,cmsds:xt,smrt:xt,df:xt,cs:xt,ts:xt,cid:Ks,pr:Ks,sf:Ks,sid:Ks,st:Ks,v:Ks,msd:Ks,bs:ps,bsd:ps,cdn:ps,rtp:ps,bg:ps,pt:ps,ec:ps,e:ps},OB={REQUEST:xt};function MB(n){return Object.keys(n).reduce((e,t)=>{var r;return(r=n[t])===null||r===void 0||r.forEach(s=>e[s]=t),e},{})}function FB(n,e){const t={};if(!n)return t;const r=Object.keys(n),s=e?MB(e):{};return r.reduce((i,o)=>{var l;const u=NB[o]||s[o]||OB.REQUEST,d=(l=i[u])!==null&&l!==void 0?l:i[u]={};return d[o]=n[o],i},t)}function BB(n){return["ot","sf","st","e","sta"].includes(n)}function UB(n){return typeof n=="number"?he(n):n!=null&&n!==""&&n!==!1}const tw="event";function $B(n,e){const t=new URL(n),r=new URL(e);if(t.origin!==r.origin)return n;const s=t.pathname.split("/").slice(1),i=r.pathname.split("/").slice(1,-1);for(;s[0]===i[0];)s.shift(),i.shift();for(;i.length;)i.shift(),s.unshift("..");return s.join("/")+t.search+t.hash}const zc=n=>Math.round(n),Fm=(n,e)=>Array.isArray(n)?n.map(t=>Fm(t,e)):n instanceof Er&&typeof n.value=="string"?new Er(Fm(n.value,e),n.params):(e.baseUrl&&(n=$B(n,e.baseUrl)),e.version===1?encodeURIComponent(n):n),Tc=n=>zc(n/100)*100,jB=(n,e)=>{let t=n;return e.version>=2&&(n instanceof Er&&typeof n.value=="string"?t=new Er([n]):typeof n=="string"&&(t=[n])),Fm(t,e)},VB={br:zc,d:zc,bl:Tc,dl:Tc,mtp:Tc,nor:jB,rtp:Tc,tb:zc},nw="request",rw="response",Zp=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],GB=["e"],HB=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Yu(n){return HB.test(n)}function KB(n){return Zp.includes(n)||GB.includes(n)||Yu(n)}const sw=["d","dl","nor","ot","rtp","su"];function zB(n){return Zp.includes(n)||sw.includes(n)||Yu(n)}const WB=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function YB(n){return Zp.includes(n)||sw.includes(n)||WB.includes(n)||Yu(n)}const qB=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function XB(n){return qB.includes(n)||Yu(n)}const QB={[rw]:YB,[tw]:KB,[nw]:zB};function iw(n,e={}){const t={};if(n==null||typeof n!="object")return t;const r=e.version||n.v||1,s=e.reportingMode||nw,i=r===1?XB:QB[s];let o=Object.keys(n).filter(i);const l=e.filter;typeof l=="function"&&(o=o.filter(l));const u=s===rw||s===tw;u&&!o.includes("ts")&&o.push("ts"),r>1&&!o.includes("v")&&o.push("v");const d=tt({},VB,e.formatters),f={version:r,reportingMode:s,baseUrl:e.baseUrl};return o.sort().forEach(h=>{let p=n[h];const x=d[h];if(typeof x=="function"&&(p=x(p,f)),h==="v"){if(r===1)return;p=r}h=="pr"&&p===1||(u&&h==="ts"&&!he(p)&&(p=Date.now()),UB(p)&&(BB(h)&&typeof p=="string"&&(p=new Xb(p)),t[h]=p))}),t}function JB(n,e={}){const t={};if(!n)return t;const r=iw(n,e),s=FB(r,e?.customHeaderMap);return Object.entries(s).reduce((i,[o,l])=>{const u=ew(l,{whitespace:!1});return u&&(i[o]=u),i},t)}function ZB(n,e,t){return tt(n,JB(e,t))}const eU="CMCD";function tU(n,e={}){return n?ew(iw(n,e),{whitespace:!1}):""}function nU(n,e={}){if(!n)return"";const t=tU(n,e);return encodeURIComponent(t)}function rU(n,e={}){if(!n)return"";const t=nU(n,e);return`${eU}=${t}`}const NS=/CMCD=[^&#]+/;function sU(n,e,t){const r=rU(e,t);if(!r)return n;if(NS.test(n))return n.replace(NS,r);const s=n.includes("?")?"&":"?";return`${n}${s}${r}`}class iU{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=s=>{try{this.apply(s,{ot:cn.MANIFEST,su:!this.initialized})}catch(i){this.hls.logger.warn("Could not generate manifest CMCD data.",i)}},this.applyFragmentData=s=>{try{const{frag:i,part:o}=s,l=this.hls.levels[i.level],u=this.getObjectType(i),d={d:(o||i).duration*1e3,ot:u};(u===cn.VIDEO||u===cn.AUDIO||u==cn.MUXED)&&(d.br=l.bitrate/1e3,d.tb=this.getTopBandwidth(u)/1e3,d.bl=this.getBufferLength(u));const f=o?this.getNextPart(o):this.getNextFrag(i);f!=null&&f.url&&f.url!==i.url&&(d.nor=f.url),this.apply(s,d)}catch(i){this.hls.logger.warn("Could not generate segment CMCD data.",i)}},this.hls=e;const t=this.config=e.config,{cmcd:r}=t;r!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||e.sessionId,this.cid=r.contentId,this.useHeaders=r.useHeaders===!0,this.includeKeys=r.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.MEDIA_DETACHED,this.onMediaDetached,this),e.on(R.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.MEDIA_DETACHED,this.onMediaDetached,this),e.off(R.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r,s;this.audioBuffer=(r=t.tracks.audio)==null?void 0:r.buffer,this.videoBuffer=(s=t.tracks.video)==null?void 0:s.buffer}createData(){var e;return{v:1,sf:fB.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){tt(t,this.createData());const r=t.ot===cn.INIT||t.ot===cn.VIDEO||t.ot===cn.MUXED;this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:s}=this;s&&(t=Object.keys(t).reduce((o,l)=>(s.includes(l)&&(o[l]=t[l]),o),{}));const i={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),ZB(e.headers,t,i)):e.url=sU(e.url,t,i)}getNextFrag(e){var t;const r=(t=this.hls.levels[e.level])==null?void 0:t.details;if(r){const s=e.sn-r.startSN;return r.fragments[s+1]}}getNextPart(e){var t;const{index:r,fragment:s}=e,i=(t=this.hls.levels[s.level])==null||(t=t.details)==null?void 0:t.partList;if(i){const{sn:o}=s;for(let l=i.length-1;l>=0;l--){const u=i[l];if(u.index===r&&u.fragment.sn===o)return i[l+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return cn.TIMED_TEXT;if(e.sn==="initSegment")return cn.INIT;if(t==="audio")return cn.AUDIO;if(t==="main")return this.hls.audioTracks.length?cn.VIDEO:cn.MUXED}getTopBandwidth(e){let t=0,r;const s=this.hls;if(e===cn.AUDIO)r=s.audioTracks;else{const i=s.maxAutoLevel,o=i>-1?i+1:s.levels.length;r=s.levels.slice(0,o)}return r.forEach(i=>{i.bitrate>t&&(t=i.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,r=e===cn.AUDIO?this.audioBuffer:this.videoBuffer;return!r||!t?NaN:Oe.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new r(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,o,l){t(i),this.loader.load(i,o,l)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,r=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new r(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,o,l){t(i),this.loader.load(i,o,l)}}}}const oU=3e5;class aU extends Vn{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(R.MANIFEST_PARSED,this.onManifestParsed,this),e.on(R.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(R.MANIFEST_PARSED,this.onManifestParsed,this),e.off(R.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(r=>r!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:r}=t;r!==null&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:r}=t;if(r?.action===Ut.SendAlternateToPenaltyBox&&r.flags===bn.MoveAllAlternatesMatchingHost){const s=this.levels;let i=this._pathwayPriority,o=this.pathwayId;if(t.context){const{groupId:l,pathwayId:u,type:d}=t.context;l&&s?o=this.getPathwayForGroupId(l,d,o):u&&(o=u)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!i&&s&&(i=this.pathways()),i&&i.length>1&&(this.updatePathwayPriority(i),r.resolved=this.pathwayId!==o),t.details===z.BUFFER_APPEND_ERROR&&!t.fatal?r.resolved=!0:r.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${o} levels: ${s&&s.length} priorities: ${st(i)} penalized: ${st(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const r=this.penalizedPathways,s=performance.now();Object.keys(r).forEach(i=>{s-r[i]>oU&&delete r[i]});for(let i=0;i<e.length;i++){const o=e[i];if(o in r)continue;if(o===this.pathwayId)return;const l=this.hls.nextLoadLevel,u=this.hls.levels[l];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,Ab(t),this.hls.trigger(R.LEVELS_UPDATED,{levels:t});const d=this.hls.levels[l];u&&d&&this.levels&&(d.attrs["STABLE-VARIANT-ID"]!==u.attrs["STABLE-VARIANT-ID"]&&d.bitrate!==u.bitrate&&this.log(`Unstable Pathways change from bitrate ${u.bitrate} to ${d.bitrate}`),this.hls.nextLoadLevel=l);break}}}getPathwayForGroupId(e,t,r){const s=this.getLevelsForPathway(r).concat(this.levels||[]);for(let i=0;i<s.length;i++)if(t===Ge.AUDIO_TRACK&&s[i].hasAudioGroup(e)||t===Ge.SUBTITLE_TRACK&&s[i].hasSubtitleGroup(e))return s[i].pathwayId;return r}clonePathways(e){const t=this.levels;if(!t)return;const r={},s={};e.forEach(i=>{const{ID:o,"BASE-ID":l,"URI-REPLACEMENT":u}=i;if(t.some(f=>f.pathwayId===o))return;const d=this.getLevelsForPathway(l).map(f=>{const h=new ft(f.attrs);h["PATHWAY-ID"]=o;const p=h.AUDIO&&`${h.AUDIO}_clone_${o}`,x=h.SUBTITLES&&`${h.SUBTITLES}_clone_${o}`;p&&(r[h.AUDIO]=p,h.AUDIO=p),x&&(s[h.SUBTITLES]=x,h.SUBTITLES=x);const g=ow(f.uri,h["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",u),E=new Ra({attrs:h,audioCodec:f.audioCodec,bitrate:f.bitrate,height:f.height,name:f.name,url:g,videoCodec:f.videoCodec,width:f.width});if(f.audioGroups)for(let v=1;v<f.audioGroups.length;v++)E.addGroupId("audio",`${f.audioGroups[v]}_clone_${o}`);if(f.subtitleGroups)for(let v=1;v<f.subtitleGroups.length;v++)E.addGroupId("text",`${f.subtitleGroups[v]}_clone_${o}`);return E});t.push(...d),OS(this.audioTracks,r,u,o),OS(this.subtitleTracks,s,u,o)})}loadSteeringManifest(e){const t=this.hls.config,r=t.loader;this.loader&&this.loader.destroy(),this.loader=new r(t);let s;try{s=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(s.protocol!=="data:"){const f=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+f)}const i={responseType:"json",url:s.href},o=t.steeringManifestLoadPolicy.default,l=o.errorRetry||o.timeoutRetry||{},u={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:l.maxNumRetry||0,retryDelay:l.retryDelayMs||0,maxRetryDelay:l.maxRetryDelayMs||0},d={onSuccess:(f,h,p,x)=>{this.log(`Loaded steering manifest: "${s}"`);const g=f.data;if(g?.VERSION!==1){this.log(`Steering VERSION ${g.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=g.TTL;const{"RELOAD-URI":E,"PATHWAY-CLONES":v,"PATHWAY-PRIORITY":b}=g;if(E)try{this.uri=new self.URL(E,s).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${E}`);return}this.scheduleRefresh(this.uri||p.url),v&&this.clonePathways(v);const A={steeringManifest:g,url:s.toString()};this.hls.trigger(R.STEERING_MANIFEST_LOADED,A),b&&this.updatePathwayPriority(b)},onError:(f,h,p,x)=>{if(this.log(`Error loading steering manifest: ${f.code} ${f.text} (${h.url})`),this.stopLoad(),f.code===410){this.enabled=!1,this.log(`Steering manifest ${h.url} no longer available`);return}let g=this.timeToLoad*1e3;if(f.code===429){const E=this.loader;if(typeof E?.getResponseHeader=="function"){const v=E.getResponseHeader("Retry-After");v&&(g=parseFloat(v)*1e3)}this.log(`Steering manifest ${h.url} rate limited`);return}this.scheduleRefresh(this.uri||h.url,g)},onTimeout:(f,h,p)=>{this.log(`Timeout loading steering manifest (${h.url})`),this.scheduleRefresh(this.uri||h.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(i,u,d)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var r;const s=(r=this.hls)==null?void 0:r.media;if(s&&!s.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function OS(n,e,t,r){n&&Object.keys(e).forEach(s=>{const i=n.filter(o=>o.groupId===s).map(o=>{const l=tt({},o);return l.details=void 0,l.attrs=new ft(l.attrs),l.url=l.attrs.URI=ow(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),l.groupId=l.attrs["GROUP-ID"]=e[s],l.attrs["PATHWAY-ID"]=r,l});n.push(...i)})}function ow(n,e,t,r){const{HOST:s,PARAMS:i,[t]:o}=r;let l;e&&(l=o?.[e],l&&(n=l));const u=new self.URL(n);return s&&!l&&(u.host=s),i&&Object.keys(i).sort().forEach(d=>{d&&u.searchParams.set(d,i[d])}),u.href}class Wi extends Vn{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Wi.CDMCleanupPromise?[Wi.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:r,initData:s}=t,i=`"${t.type}" event: init data type: "${r}"`;if(this.debug(i),s!==null){if(!this.keyFormatPromise){let o=Object.keys(this.keySystemAccessPromises);o.length||(o=ia(this.config));const l=o.map(Sh).filter(u=>!!u);this.keyFormatPromise=this.getKeyFormatPromise(l)}this.keyFormatPromise.then(o=>{const l=Gc(o);if(r!=="sinf"||l!==ht.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${r}" for selected key-system ${l}`);return}let u;try{const x=kt(new Uint8Array(s)),g=jp(JSON.parse(x).sinf),E=eb(g);if(!E)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");u=new Uint8Array(E.subarray(8,24))}catch(x){this.warn(`${i} Failed to parse sinf: ${x}`);return}const d=$t(u),{keyIdToKeySessionPromise:f,mediaKeySessions:h}=this;let p=f[d];for(let x=0;x<h.length;x++){const g=h[x],E=g.decryptdata;if(!E.keyId)continue;const v=$t(E.keyId);if(gu(u,E.keyId)||E.uri.replace(/-/g,"").indexOf(d)!==-1){if(p=f[v],!p)continue;if(E.pssh)break;delete f[v],E.pssh=new Uint8Array(s),E.keyId=u,p=f[d]=p.then(()=>this.generateRequestWithPreferredKeySession(g,r,s,"encrypted-event-key-match")),p.catch(b=>this.handleError(b));break}}p||this.handleError(new Error(`Key ID ${d} not encountered in playlist. Key-system sessions ${h.length}.`))}).catch(o=>this.handleError(o))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(R.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(R.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(R.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(R.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(R.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(R.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(R.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(R.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:r}=this.config,s=t?.[e];if(s)return s.licenseUrl;if(e===ht.WIDEVINE&&r)return r}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,r=t?.[e];if(r)return r.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,r=(o,l,u)=>!!o&&u.indexOf(o)===l,s=t.map(o=>o.audioCodec).filter(r),i=t.map(o=>o.videoCodec).filter(r);return s.length+i.length===0&&i.push("avc1.42e01e"),new Promise((o,l)=>{const u=d=>{const f=d.shift();this.getMediaKeysPromise(f,s,i).then(h=>o({keySystem:f,mediaKeys:h})).catch(h=>{d.length?u(d):h instanceof Tn?l(h):l(new Tn({type:we.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_ACCESS,error:h,fatal:!0},h.message))})};u(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:r}=this.config;if(typeof r!="function"){let s=`Configured requestMediaKeySystemAccess is not a function ${r}`;return yb===null&&self.location.protocol==="http:"&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return r(e,t)}getMediaKeysPromise(e,t,r){var s;const i=jM(e,t,r,this.config.drmSystemOptions||{});let o=this.keySystemAccessPromises[e],l=(s=o)==null?void 0:s.keySystemAccess;if(!l){this.log(`Requesting encrypted media "${e}" key-system access with config: ${st(i)}`),l=this.requestMediaKeySystemAccess(e,i);const u=o=this.keySystemAccessPromises[e]={keySystemAccess:l};return l.catch(d=>{this.log(`Failed to obtain access to key-system "${e}": ${d}`)}),l.then(d=>{this.log(`Access for key-system "${d.keySystem}" obtained`);const f=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const h=u.mediaKeys=d.createMediaKeys().then(p=>(this.log(`Media-keys created for "${e}"`),u.hasMediaKeys=!0,f.then(x=>x?this.setMediaKeysServerCertificate(p,e,x):p)));return h.catch(p=>{this.error(`Failed to create media-keys for "${e}"}: ${p}`)}),h})}return l.then(()=>o.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:r}){this.log(`Creating key-system session "${t}" keyId: ${$t(e.keyId||[])} keyUri: ${e.uri}`);const s=r.createSession(),i={decryptdata:e,keySystem:t,mediaKeys:r,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(i),i}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const r=this.createMediaKeySessionContext(e),s=bc(t),i="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(r,i,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const r=e.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyId ${$t(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),r.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Sh(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:r})=>this.attemptSetMediaKeys(t,r))}selectKeySystem(e){return new Promise((t,r)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:s})=>{const i=Sh(s);i?t(i):r(new Error(`Unable to find format for key-system "${s}"`))}).catch(r)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=ia(this.config),r=e.map(Gc).filter(s=>!!s&&t.indexOf(s)!==-1);return this.selectKeySystem(r)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let r=0;r<t.length;r++){const s=lU(e,t[r]);if(s)return s}}loadKey(e){const t=e.keyInfo.decryptdata,r=bc(t),s=this.bannedKeyIds[r];if(s||this.getKeyStatus(t)==="internal-error"){const l=MS(s||"internal-error",t);return this.handleError(l,e.frag),Promise.reject(l)}const i=`(keyId: ${r} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);const o=this.keyIdToKeySessionPromise[r];if(!o){const l=this.getKeySystemForKeyPromise(t).then(({keySystem:u,mediaKeys:d})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(u,d).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:u,mediaKeys:d,decryptdata:t}))))).then(u=>{const d="cenc",f=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(u,d,f,"playlist-key")});return l.catch(u=>this.handleError(u,e.frag)),this.keyIdToKeySessionPromise[r]=l,l}return o.catch(l=>{if(l instanceof Tn){const u=Je({},l.data);this.getKeyStatus(t)==="internal-error"&&(u.decryptdata=t);const d=new Tn(u,l.message);this.handleError(d,e.frag)}}),o}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof Tn){t&&(e.data.frag=t);const r=e.data.decryptdata;this.error(`${e.message}${r?` (${$t(r.keyId||[])})`:""}`),this.hls.trigger(R.ERROR,e.data)}else this.error(e.message),this.hls.trigger(R.ERROR,{type:we.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=bc(e),r=this.keyIdToKeySessionPromise[t];if(!r){const s=Gc(e.keyFormat),i=s?[s]:ia(this.config);return this.attemptKeySystemAccess(i)}return r}getKeySystemSelectionPromise(e){if(e.length||(e=ia(this.config)),e.length===0)throw new Tn({type:we.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${st({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const r=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const s=Promise.all(r).then(()=>this.media?this.media.setMediaKeys(t):new Promise((i,o)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return o(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(i).catch(o)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${e}"`),r.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(i=>r.indexOf(i)===-1)})}generateRequestWithPreferredKeySession(e,t,r,s){var i;const o=(i=this.config.drmSystems)==null||(i=i[e.keySystem])==null?void 0:i.generateRequest;if(o)try{const g=o.call(this.hls,t,r,e);if(!g)throw new Error("Invalid response from configured generateRequest filter");t=g.initDataType,r=g.initData?g.initData:null,e.decryptdata.pssh=r?new Uint8Array(r):null}catch(g){if(this.warn(g.message),this.hls&&this.hls.config.debug)throw g}if(r===null)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(e);const l=bc(e.decryptdata),u=e.decryptdata.uri;this.log(`Generating key-session request for "${s}" keyId: ${l} URI: ${u} (init data type: ${t} length: ${r.byteLength})`);const d=new Gp,f=e._onmessage=g=>{const E=e.mediaKeysSession;if(!E){d.emit("error",new Error("invalid state"));return}const{messageType:v,message:b}=g;this.log(`"${v}" message event for session "${E.sessionId}" message size: ${b.byteLength}`),v==="license-request"||v==="license-renewal"?this.renewLicense(e,b).catch(A=>{d.eventNames().length?d.emit("error",A):this.handleError(A)}):v==="license-release"?e.keySystem===ht.FAIRPLAY&&this.updateKeySession(e,km("acknowledged")).then(()=>this.removeSession(e)).catch(A=>this.handleError(A)):this.warn(`unhandled media key message type "${v}"`)},h=(g,E)=>{E.keyStatus=g;let v;g.startsWith("usable")?d.emit("resolved"):g==="internal-error"||g==="output-restricted"||g==="output-downscaled"?v=MS(g,E.decryptdata):g==="expired"?v=new Error(`key expired (keyId: ${l})`):g==="released"?v=new Error("key released"):g==="status-pending"||this.warn(`unhandled key status change "${g}" (keyId: ${l})`),v&&(d.eventNames().length?d.emit("error",v):this.handleError(v))},p=e._onkeystatuseschange=g=>{if(!e.mediaKeysSession){d.emit("error",new Error("invalid state"));return}const v=this.getKeyStatuses(e);if(!Object.keys(v).some(I=>v[I]!=="status-pending"))return;if(v[l]==="expired"){this.log(`Expired key ${st(v)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let A=v[l];if(A)h(A,e);else{var L;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(L=e.keyStatusTimeouts)[l]||(L[l]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const _=this.getKeyStatus(e.decryptdata);if(_&&_!=="status-pending")return this.log(`No status for keyId ${l} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${_} from other session.`),h(_,e);this.log(`key status for ${l} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),A="internal-error",h(A,e)},1e3)),this.log(`No status for keyId ${l} (${st(v)}).`)}};tn(e.mediaKeysSession,"message",f),tn(e.mediaKeysSession,"keystatuseschange",p);const x=new Promise((g,E)=>{d.on("error",E),d.on("resolved",g)});return e.mediaKeysSession.generateRequest(t,r).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${l} URI: ${u}`)}).catch(g=>{throw new Tn({type:we.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_SESSION,error:g,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${g}`)}).then(()=>x).catch(g=>(d.removeAllListeners(),this.removeSession(e).then(()=>{throw g}))).then(()=>(d.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((r,s)=>{if(typeof s=="string"&&typeof r=="object"){const l=s;s=r,r=l}const i="buffer"in s?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s);if(e.keySystem===ht.PLAYREADY&&i.length===16){const l=$t(i);t[l]=r,pb(i)}const o=$t(i);r==="internal-error"&&(this.bannedKeyIds[o]=r),this.log(`key status change "${r}" for keyStatuses keyId: ${o} key-session "${e.mediaKeysSession.sessionId}"`),t[o]=r}),t}fetchServerCertificate(e){const t=this.config,r=t.loader,s=new r(t),i=this.getServerCertificateUrl(e);return i?(this.log(`Fetching server certificate for "${e}"`),new Promise((o,l)=>{const u={responseType:"arraybuffer",url:i},d=t.certLoadPolicy.default,f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:(p,x,g,E)=>{o(p.data)},onError:(p,x,g,E)=>{l(new Tn({type:we.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:Je({url:u.url,data:void 0},p)},`"${e}" certificate request failed (${i}). Status: ${p.code} (${p.text})`))},onTimeout:(p,x,g)=>{l(new Tn({type:we.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:{url:u.url,data:void 0}},`"${e}" certificate request timed out (${i})`))},onAbort:(p,x,g)=>{l(new Error("aborted"))}};s.load(u,f,h)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,r){return new Promise((s,i)=>{e.setServerCertificate(r).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${r.byteLength}) on "${t}"`),s(e)}).catch(o=>{i(new Tn({type:we.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(r=>this.updateKeySession(e,new Uint8Array(r)).catch(s=>{throw new Tn({type:we.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:s,fatal:!1},s.message)}))}unpackPlayReadyKeyMessage(e,t){const r=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!r.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const s=new DOMParser().parseFromString(r,"application/xml"),i=s.querySelectorAll("HttpHeader");if(i.length>0){let f;for(let h=0,p=i.length;h<p;h++){var o,l;f=i[h];const x=(o=f.querySelector("name"))==null?void 0:o.textContent,g=(l=f.querySelector("value"))==null?void 0:l.textContent;x&&g&&e.setRequestHeader(x,g)}}const u=s.querySelector("Challenge"),d=u?.textContent;if(!d)throw new Error("Cannot find <Challenge> in key message");return km(atob(d))}setupLicenseXHR(e,t,r,s){const i=this.config.licenseXhrSetup;return i?Promise.resolve().then(()=>{if(!r.decryptdata)throw new Error("Key removed");return i.call(this.hls,e,t,r,s)}).catch(o=>{if(!r.decryptdata)throw o;return e.open("POST",t,!0),i.call(this.hls,e,t,r,s)}).then(o=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:o||s})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:s}))}requestLicense(e,t){const r=this.config.keyLoadPolicy.default;return new Promise((s,i)=>{const o=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${o}`);const l=new XMLHttpRequest;l.responseType="arraybuffer",l.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return i(new Error("invalid state"));if(l.readyState===4)if(l.status===200){this._requestLicenseFailureCount=0;let u=l.response;this.log(`License received ${u instanceof ArrayBuffer?u.byteLength:u}`);const d=this.config.licenseResponseCallback;if(d)try{u=d.call(this.hls,l,o,e)}catch(f){this.error(f)}s(u)}else{const u=r.errorRetry,d=u?u.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>d||l.status>=400&&l.status<500)i(new Tn({type:we.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:l,response:{url:o,data:void 0,code:l.status,text:l.statusText}},`License Request XHR failed (${o}). Status: ${l.status} (${l.statusText})`));else{const f=d-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${f} attempts left`),this.requestLicense(e,t).then(s,i)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=l,this.setupLicenseXHR(l,o,e,t).then(({xhr:u,licenseChallenge:d})=>{e.keySystem==ht.PLAYREADY&&(d=this.unpackPlayReadyKeyMessage(u,d)),u.send(d)}).catch(i)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const r=t.media;this.media=r,tn(r,"encrypted",this.onMediaEncrypted),tn(r,"waitingforkey",this.onWaitingForKey);const s=this.mediaResolved;s?s():this.mediaKeys=r.mediaKeys}onMediaDetached(){const e=this.media;e&&(dn(e,"encrypted",this.onMediaEncrypted),dn(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const r=this.media,s=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,bs.clearKeyUriToKeyIdMap();const i=s.length;Wi.CDMCleanupPromise=Promise.all(s.map(o=>this.removeSession(o)).concat((r==null||(e=r.setMediaKeys(null))==null?void 0:e.catch(o=>{this.log(`Could not clear media keys: ${o}`),this.hls&&this.hls.trigger(R.ERROR,{type:we.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${o}`)})}))||Promise.resolve())).catch(o=>{this.log(`Could not close sessions and clear media keys: ${o}`),this.hls&&this.hls.trigger(R.ERROR,{type:we.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${o}`)})}).then(()=>{i&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const r=t.reduce((s,i)=>(s.indexOf(i.keyFormat)===-1&&s.push(i.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${r.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(r)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:r,decryptdata:s}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${$t(s?.keyId||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);i>-1&&this.mediaKeySessions.splice(i,1);const{keyStatusTimeouts:o}=e;o&&Object.keys(o).forEach(d=>self.clearTimeout(o[d]));const{drmSystemOptions:l}=this.config;return(GM(l)?new Promise((d,f)=>{self.setTimeout(()=>f(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(d).catch(f)}):Promise.resolve()).catch(d=>{this.log(`Could not remove session: ${d}`),this.hls&&this.hls.trigger(R.ERROR,{type:we.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${d}`)})}).then(()=>t.close()).catch(d=>{this.log(`Could not close session: ${d}`),this.hls&&this.hls.trigger(R.ERROR,{type:we.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${d}`)})})}return Promise.resolve()}}Wi.CDMCleanupPromise=void 0;function bc(n){if(!n)throw new Error("Could not read keyId of undefined decryptdata");if(n.keyId===null)throw new Error("keyId is null");return $t(n.keyId)}function lU(n,e){if(n.keyId&&e.mediaKeysSession.keyStatuses.has(n.keyId))return e.mediaKeysSession.keyStatuses.get(n.keyId);if(n.matches(e.decryptdata))return e.keyStatus}class Tn extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function MS(n,e){const t=n==="output-restricted",r=t?z.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:z.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new Tn({type:we.KEY_SYSTEM_ERROR,details:r,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${n}"`)}class cU{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(R.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(R.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(R.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(R.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const r=this.hls.config;if(r.capLevelOnFPSDrop){const s=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=s,s&&typeof s.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,r){const s=performance.now();if(t){if(this.lastTime){const i=s-this.lastTime,o=r-this.lastDroppedFrames,l=t-this.lastDecodedFrames,u=1e3*o/i,d=this.hls;if(d.trigger(R.FPS_DROP,{currentDropped:o,currentDecoded:l,totalDroppedFrames:r}),u>0&&o>d.config.fpsDroppedMonitoringThreshold*l){let f=d.currentLevel;d.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+f),f>0&&(d.autoLevelCapping===-1||d.autoLevelCapping>=f)&&(f=f-1,d.trigger(R.FPS_DROP_LEVEL_CAPPING,{level:f,droppedLevel:d.currentLevel}),d.autoLevelCapping=f,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function aw(n,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=n,e.dispatchEvent(t)}function lw(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(e.id))try{if(n.addCue(e),!n.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(r){Ze.debug(`[texttrack-utils]: ${r}`);try{const s=new self.TextTrackCue(e.startTime,e.endTime,e.text);s.id=e.id,n.addCue(s)}catch(s){Ze.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${s}`)}}t==="disabled"&&(n.mode=t)}function Hi(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues)for(let r=n.cues.length;r--;)e&&n.cues[r].removeEventListener("enter",e),n.removeCue(n.cues[r]);t==="disabled"&&(n.mode=t)}function Bm(n,e,t,r){const s=n.mode;if(s==="disabled"&&(n.mode="hidden"),n.cues&&n.cues.length>0){const i=dU(n.cues,e,t);for(let o=0;o<i.length;o++)(!r||r(i[o]))&&n.removeCue(i[o])}s==="disabled"&&(n.mode=s)}function uU(n,e){if(e<=n[0].startTime)return 0;const t=n.length-1;if(e>n[t].endTime)return-1;let r=0,s=t,i;for(;r<=s;)if(i=Math.floor((s+r)/2),e<n[i].startTime)s=i-1;else if(e>n[i].startTime&&r<t)r=i+1;else return i;return n[r].startTime-e<e-n[s].startTime?r:s}function dU(n,e,t){const r=[],s=uU(n,e);if(s>-1)for(let i=s,o=n.length;i<o;i++){const l=n[i];if(l.startTime>=e&&l.endTime<=t)r.push(l);else if(l.startTime>t)return r}return r}function Wc(n){const e=[];for(let t=0;t<n.length;t++){const r=n[t];(r.kind==="subtitles"||r.kind==="captions")&&r.label&&e.push(n[t])}return e}class fU extends Xp{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const r=Wc(this.media.textTracks);for(let i=0;i<r.length;i++)if(r[i].mode==="hidden")t=r[i];else if(r[i].mode==="showing"){t=r[i];break}const s=this.findTrackForTextTrack(t);this.subtitleTrack!==s&&this.setSubtitleTrack(s)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.MANIFEST_PARSED,this.onManifestParsed,this),e.on(R.LEVEL_LOADING,this.onLevelLoading,this),e.on(R.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(R.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(R.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.MANIFEST_PARSED,this.onManifestParsed,this),e.off(R.LEVEL_LOADING,this.onLevelLoading,this),e.off(R.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(R.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(R.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const r=this.media;if(!r)return;const s=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||r.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,s)return;Wc(r.textTracks).forEach(o=>{Hi(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:r,groupId:s,details:i}=t,o=this.tracksInGroup[r];if(!o||o.groupId!==s){this.warn(`Subtitle track with id:${r} and group:${s} not found in active group ${o?.groupId}`);return}const l=o.details;o.details=t.details,this.log(`Subtitle track ${r} "${o.name}" lang:${o.lang} group:${s} loaded [${i.startSN}-${i.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,l)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.subtitleGroups||null,s=this.groupIds;let i=this.currentTrack;if(!r||s?.length!==r?.length||r!=null&&r.some(o=>s?.indexOf(o)===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(f=>!r||r.indexOf(f.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(f=>f.default)&&(this.selectDefaultTrack=!1),o.forEach((f,h)=>{f.id=h});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const l=this.hls.config.subtitlePreference;if(!i&&l){this.selectDefaultTrack=!1;const f=yr(l,o);if(f>-1)i=o[f];else{const h=yr(l,this.tracks);i=this.tracks[h]}}let u=this.findTrackId(i);u===-1&&i&&(u=this.findTrackId(null));const d={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${r?.join(",")}" group-id`),this.hls.trigger(R.SUBTITLE_TRACKS_UPDATED,d),u!==-1&&this.trackId===-1&&this.setSubtitleTrack(u)}}findTrackId(e){const t=this.tracksInGroup,r=this.selectDefaultTrack;for(let s=0;s<t.length;s++){const i=t[s];if(!(r&&!i.default||!r&&!e)&&(!e||ri(i,e)))return s}if(e){for(let s=0;s<t.length;s++){const i=t[s];if(_a(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<t.length;s++){const i=t[s];if(_a(e.attrs,i.attrs,["LANGUAGE"]))return s}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const s=t[r];if(Nm(s,e))return r}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===Ge.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const r=this.currentTrack;if(r&&ri(e,r))return r;const s=yr(e,this.tracksInGroup);if(s>-1){const i=this.tracksInGroup[s];return this.setSubtitleTrack(s),i}else{if(r)return null;{const i=yr(e,t);if(i>-1)return t[i]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,s=e.groupId,i=this.getUrlWithDirectives(e.url,t),o=e.details,l=o?.age;this.log(`Loading subtitle ${r} "${e.name}" lang:${e.lang} group:${s}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${l&&o.live?" age "+l.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(R.SUBTITLE_TRACK_LOADING,{url:i,id:r,groupId:s,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Wc(e.textTracks),r=this.currentTrack;let s;if(r&&(s=t.filter(i=>Nm(r,i))[0],s||this.warn(`Unable to find subtitle TextTrack with name "${r.name}" and language "${r.lang}"`)),[].slice.call(t).forEach(i=>{i.mode!=="disabled"&&i!==s&&(i.mode="disabled")}),s){const i=this.subtitleDisplay?"showing":"hidden";s.mode!==i&&(s.mode=i)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!he(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,s=t[e]||null;if(this.trackId=e,this.currentTrack=s,this.toggleTrackModes(),!s){this.hls.trigger(R.SUBTITLE_TRACK_SWITCH,{id:e});return}const i=!!s.details&&!s.details.live;if(e===this.trackId&&s===r&&i)return;this.log(`Switching to subtitle-track ${e}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:""));const{id:o,groupId:l="",name:u,type:d,url:f}=s;this.hls.trigger(R.SUBTITLE_TRACK_SWITCH,{id:o,groupId:l,name:u,type:d,url:f});const h=this.switchParams(s.url,r?.details,s.details);this.loadPlaylist(h)}}function hU(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const i=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(s=="x"?i:i&3|8).toString(16)})}}}function ma(n){let e=5381,t=n.length;for(;t;)e=e*33^n.charCodeAt(--t);return(e>>>0).toString()}const Yi=.025;let Su=(function(n){return n[n.Point=0]="Point",n[n.Range=1]="Range",n})({});function mU(n,e,t){return`${n.identifier}-${t+1}-${ma(e)}`}class pU{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const r=this.playoutLimit;return e<=0||isNaN(r)?!1:r===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>r}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return kh(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,r=kh(t,e);return t-r<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=he(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return kh(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Yi))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Su.Range:Su.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return gU(this)}}function kh(n,e){return n-e.start<e.duration/2&&!(Math.abs(n-(e.start+e.duration))<Yi)?e.start:e.start+e.duration}function cw(n,e,t){const r=new self.URL(n,t);return r.protocol!=="data:"&&r.searchParams.set("_HLS_primary_id",e),r}function Ch(n,e){for(;(t=n.assetList[++e])!=null&&t.error;)var t;return e}function gU(n){return`["${n.identifier}" ${n.cue.pre?"<pre>":n.cue.post?"<post>":""}${n.timelineStart.toFixed(2)}-${n.resumeTime.toFixed(2)}]`}function Ui(n){const e=n.timelineStart,t=n.duration||0;return`["${n.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class yU{constructor(e,t,r,s){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(R.PLAYOUT_LIMIT_REACHED,{})};const i=this.hls=new e(t);this.interstitial=r,this.assetItem=s;const o=()=>{this.hasDetails=!0};i.once(R.LEVEL_LOADED,o),i.once(R.AUDIO_TRACK_LOADED,o),i.once(R.SUBTITLE_TRACK_LOADED,o),i.on(R.MEDIA_ATTACHING,(l,{media:u})=>{this.removeMediaListeners(),this.mediaAttached=u,this.interstitial.playoutLimit&&(u.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&i.on(R.BUFFER_APPENDED,()=>{const f=this.bufferedEnd;this.reachedPlayout(f)&&(this._bufferedEosTime=f,i.trigger(R.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=cw(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const r=Math.min(this._bufferedEosTime||1/0,this.duration),s=this.timelineOffset,i=Oe.bufferInfo(e,s,0);return this.getAssetTime(i.end)>=r-.02}reachedPlayout(e){const r=this.interstitial.playoutLimit;return this.startOffset+e>=r}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Oe.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const r=t-this.startOffset;if(r>0&&r<e)return r}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const r=e-t;if(Math.abs(r)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,r=this.duration;return Math.min(Math.max(0,e-t),r)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=r=>delete r.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,r){var s;(s=this.hls)==null||s.on(e,t)}once(e,t,r){var s;(s=this.hls)==null||s.once(e,t)}off(e,t,r){var s;(s=this.hls)==null||s.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${Ui(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const FS=.033;class xU extends Vn{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((r,s)=>e<=s.startOffset&&t>s.startOffset?(delete s.error,r+1):r,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let r=-1;e.nextEvent?r=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(r=this.findEventIndex(e.previousEvent.identifier)+1);const s=this.items;if(s)for(s[r]||(t===void 0&&(t=e.start),r=this.findItemIndexAtTime(t));r>=0&&(i=s[r])!=null&&i.event;){var i;r--}return r}findItemIndexAtTime(e,t){const r=this.items;if(r)for(let s=0;s<r.length;s++){let i=r[s];if(t&&t!=="primary"&&(i=i[t]),e===i.start||e>i.start&&e<i.end)return s}return-1}findJumpRestrictedIndex(e,t){const r=this.items;if(r)for(let s=e;s<=t&&r[s];s++){const i=r[s].event;if(i!=null&&i.restrictions.jump&&!i.appendInPlace)return s}return-1}findEventIndex(e){const t=this.items;if(t)for(let s=t.length;s--;){var r;if(((r=t[s].event)==null?void 0:r.identifier)===e)return s}return-1}findAssetIndex(e,t){const r=e.assetList,s=r.length;if(s>1)for(let i=0;i<s;i++){const o=r[i];if(!o.error){const l=o.timelineStart;if(t===l||t>l&&(t<l+(o.duration||0)||i===s-1))return i}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const r=t.assetList,s=r[r.length-1];if(s)return s.identifier}return null}parseInterstitialDateRanges(e,t){const r=e.main.details,{dateRanges:s}=r,i=this.events,o=this.parseDateRanges(s,{url:r.url},t),l=Object.keys(s),u=i?i.filter(d=>!l.includes(d.identifier)):[];o.length&&o.sort((d,f)=>{const h=d.cue.pre,p=d.cue.post,x=f.cue.pre,g=f.cue.post;if(h&&!x)return-1;if(x&&!h||p&&!g)return 1;if(g&&!p)return-1;if(!h&&!x&&!p&&!g){const E=d.startTime,v=f.startTime;if(E!==v)return E-v}return d.dateRange.tagOrder-f.dateRange.tagOrder}),this.events=o,u.forEach(d=>{this.removeEvent(d)}),this.updateSchedule(e,u)}updateSchedule(e,t=[],r=!1){const s=this.events||[];if(s.length||t.length||this.length<2){const i=this.items,o=this.parseSchedule(s,e);(r||t.length||i?.length!==o.length||o.some((u,d)=>Math.abs(u.playout.start-i[d].playout.start)>.005||Math.abs(u.playout.end-i[d].playout.end)>.005))&&(this.items=o,this.onScheduleUpdate(t,i))}}parseDateRanges(e,t,r){const s=[],i=Object.keys(e);for(let o=0;o<i.length;o++){const l=i[o],u=e[l];if(u.isInterstitial){let d=this.eventMap[l];d?d.setDateRange(u):(d=new pU(u,t),this.eventMap[l]=d,r===!1&&(d.appendInPlace=r)),s.push(d)}}return s}parseSchedule(e,t){const r=[],s=t.main.details,i=s.live?1/0:s.edge;let o=0;if(e=e.filter(u=>!u.error&&!(u.cue.once&&u.hasPlayed)),e.length){this.resolveOffsets(e,t);let u=0,d=0;if(e.forEach((f,h)=>{const p=f.cue.pre,x=f.cue.post,g=e[h-1]||null,E=f.appendInPlace,v=x?i:f.startOffset,b=f.duration,A=f.timelineOccupancy===Su.Range?b:0,L=f.resumptionOffset,I=g?.startTime===v,_=v+f.cumulativeDuration;let F=E?_+b:v+L;if(p||!x&&v<=0){const P=d;d+=A,f.timelineStart=_;const O=o;o+=b,r.push({event:f,start:_,end:F,playout:{start:O,end:o},integrated:{start:P,end:d}})}else if(v<=i){if(!I){const M=v-u;if(M>FS){const H=u,Z=d;d+=M;const se=o;o+=M;const U={previousEvent:e[h-1]||null,nextEvent:f,start:H,end:H+M,playout:{start:se,end:o},integrated:{start:Z,end:d}};r.push(U)}else M>0&&g&&(g.cumulativeDuration+=M,r[r.length-1].end=v)}x&&(F=_),f.timelineStart=_;const P=d;d+=A;const O=o;o+=b,r.push({event:f,start:_,end:F,playout:{start:O,end:o},integrated:{start:P,end:d}})}else return;const C=f.resumeTime;x||C>i?u=i:u=C}),u<i){var l;const f=u,h=d,p=i-u;d+=p;const x=o;o+=p,r.push({previousEvent:((l=r[r.length-1])==null?void 0:l.event)||null,nextEvent:null,start:u,end:f+p,playout:{start:x,end:o},integrated:{start:h,end:d}})}this.setDurations(i,o,d)}else r.push({previousEvent:null,nextEvent:null,start:0,end:i,playout:{start:0,end:i},integrated:{start:0,end:i}}),this.setDurations(i,i,i);return r}setDurations(e,t,r){this.durations={primary:e,playout:t,integrated:r}}resolveOffsets(e,t){const r=t.main.details,s=r.live?1/0:r.edge;let i=0,o=-1;e.forEach((l,u)=>{const d=l.cue.pre,f=l.cue.post,h=d?0:f?s:l.startTime;this.updateAssetDurations(l),o===h?l.cumulativeDuration=i:(i=0,o=h),!f&&l.snapOptions.in&&(l.resumeAnchor=oi(null,r.fragments,l.startOffset+l.resumptionOffset,0,0)||void 0),l.appendInPlace&&!l.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(l,t)||(l.appendInPlace=!1)),!l.appendInPlace&&u+1<e.length&&e[u+1].startTime-e[u].resumeTime<FS&&(e[u+1].appendInPlace=!1,e[u+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${l}`));const x=he(l.resumeOffset)?l.resumeOffset:l.duration;i+=x})}primaryCanResumeInPlaceAt(e,t){const r=e.resumeTime,s=e.startTime+e.resumptionOffset;return Math.abs(r-s)>Yi?(this.log(`"${e.identifier}" resumption ${r} not aligned with estimated timeline end ${s}`),!1):!Object.keys(t).some(o=>{const l=t[o].details,u=l.edge;if(r>=u)return this.log(`"${e.identifier}" resumption ${r} past ${o} playlist end ${u}`),!1;const d=oi(null,l.fragments,r);if(!d)return this.log(`"${e.identifier}" resumption ${r} does not align with any fragments in ${o} playlist (${l.fragStart}-${l.fragmentEnd})`),!0;const f=o==="audio"?.175:0;return Math.abs(d.start-r)<Yi+f||Math.abs(d.end-r)<Yi+f?!1:(this.log(`"${e.identifier}" resumption ${r} not aligned with ${o} fragment bounds (${d.start}-${d.end} sn: ${d.sn} cc: ${d.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let r=0,s=!1,i=!1;for(let o=0;o<e.assetList.length;o++){const l=e.assetList[o],u=t+r;l.startOffset=r,l.timelineStart=u,s||(s=l.duration===null),i||(i=!!l.error);const d=l.error?0:l.duration||0;r+=d}s&&!i?e.duration=Math.max(r,e.duration):e.duration=r}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Xn(n){return`[${n.event?'"'+n.event.identifier+'"':"primary"}: ${n.start.toFixed(2)}-${n.end.toFixed(2)}]`}class vU{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const r=e.assetListUrl;let s;try{s=cw(r,this.hls.sessionId,e.baseUrl)}catch(p){const x=this.assignAssetListError(e,z.ASSET_LIST_LOAD_ERROR,p,r);this.hls.trigger(R.ERROR,x);return}t&&s.protocol!=="data:"&&s.searchParams.set("_HLS_start_offset",""+t);const i=this.hls.config,o=i.loader,l=new o(i),u={responseType:"json",url:s.href},d=i.interstitialAssetListLoadPolicy.default,f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:(p,x,g,E)=>{const v=p.data,b=v?.ASSETS;if(!Array.isArray(b)){const A=this.assignAssetListError(e,z.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),g.url,x,E);this.hls.trigger(R.ERROR,A);return}e.assetListResponse=v,this.hls.trigger(R.ASSET_LIST_LOADED,{event:e,assetListResponse:v,networkDetails:E})},onError:(p,x,g,E)=>{const v=this.assignAssetListError(e,z.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${p.code} ${p.text} (${x.url})`),x.url,E,g);this.hls.trigger(R.ERROR,v)},onTimeout:(p,x,g)=>{const E=this.assignAssetListError(e,z.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${x.url})`),x.url,p,g);this.hls.trigger(R.ERROR,E)}};return l.load(u,f,h),this.hls.trigger(R.ASSET_LIST_LOADING,{event:e}),l}assignAssetListError(e,t,r,s,i,o){return e.error=r,{type:we.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:s,error:r,networkDetails:o,stats:i}}}function BS(n){var e;n==null||(e=n.play())==null||e.catch(()=>{})}function wc(n,e){return`[${n}] Advancing timeline position to ${e}`}class SU extends Vn{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled||!this.schedule)return;const s=r-this.timelinePos;if(Math.abs(s)<1/7056e5)return;const o=s<=-.01;this.timelinePos=r,this.bufferedPos=r;const l=this.playingItem;if(!l){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(r,r-s)&&this.updateSchedule(!0),this.checkBuffer(),o&&r<l.start||r>=l.end){var u;const x=this.findItemIndex(l);let g=this.schedule.findItemIndexAtTime(r);if(g===-1&&(g=x+(o?-1:1),this.log(`seeked ${o?"back ":""}to position not covered by schedule ${r} (resolving from ${x} to ${g})`)),!this.isInterstitial(l)&&(u=this.media)!=null&&u.paused&&(this.shouldPlay=!1),!o&&g>x){const E=this.schedule.findJumpRestrictedIndex(x+1,g);if(E>x){this.setSchedulePosition(E);return}}this.setSchedulePosition(g);return}const d=this.playingAsset;if(!d){if(this.playingLastItem&&this.isInterstitial(l)){const x=l.event.assetList[0];x&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(r,x))}return}const f=d.timelineStart,h=d.duration||0;if(o&&r<f||r>=f+h){var p;(p=l.event)!=null&&p.appendInPlace&&(this.clearAssetPlayers(l.event,l),this.flushFrontBuffer(r)),this.setScheduleToAssetAtTime(r,d)}},this.onTimeupdate=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled)return;if(r>this.timelinePos)this.timelinePos=r,r>this.bufferedPos&&this.checkBuffer();else return;const s=this.playingItem;if(!s||this.playingLastItem)return;if(r>=s.end){this.timelinePos=s.end;const l=this.findItemIndex(s);this.setSchedulePosition(l+1)}const i=this.playingAsset;if(!i)return;const o=i.timelineStart+(i.duration||0);r>=o&&this.setScheduleToAssetAtTime(r,i)},this.onScheduleUpdate=(r,s)=>{const i=this.schedule;if(!i)return;const o=this.playingItem,l=i.events||[],u=i.items||[],d=i.durations,f=r.map(E=>E.identifier),h=!!(l.length||f.length);(h||s)&&this.log(`INTERSTITIALS_UPDATED (${l.length}): ${l}
Schedule: ${u.map(E=>Xn(E))} pos: ${this.timelinePos}`),f.length&&this.log(`Removed events ${f}`);let p=null,x=null;o&&(p=this.updateItem(o,this.timelinePos),this.itemsMatch(o,p)?this.playingItem=p:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const g=this.bufferingItem;if(g&&(x=this.updateItem(g,this.bufferedPos),this.itemsMatch(g,x)?this.bufferingItem=x:g.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(g.event,null))),r.forEach(E=>{E.assetList.forEach(v=>{this.clearAssetPlayer(v.identifier,null)})}),this.playerQueue.forEach(E=>{if(E.interstitial.appendInPlace){const v=E.assetItem.timelineStart,b=E.timelineOffset-v;if(b)try{E.timelineOffset=v}catch(A){Math.abs(b)>Yi&&this.warn(`${A} ("${E.assetId}" ${E.timelineOffset}->${v})`)}}}),h||s){if(this.hls.trigger(R.INTERSTITIALS_UPDATED,{events:l.slice(0),schedule:u.slice(0),durations:d,removedIds:f}),this.isInterstitial(o)&&f.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}o&&this.trimInPlace(p,o),g&&x!==p&&this.trimInPlace(x,g),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new vU(e),this.schedule=new xU(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(R.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(R.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(R.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(R.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(R.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(R.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(R.BUFFER_APPENDED,this.onBufferAppended,this),e.on(R.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(R.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(R.MEDIA_ENDED,this.onMediaEnded,this),e.on(R.ERROR,this.onError,this),e.on(R.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(R.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(R.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(R.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(R.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(R.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(R.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(R.BUFFER_CODECS,this.onBufferCodecs,this),e.off(R.BUFFER_APPENDED,this.onBufferAppended,this),e.off(R.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(R.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(R.MEDIA_ENDED,this.onMediaEnded,this),e.off(R.ERROR,this.onError,this),e.off(R.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){dn(e,"play",this.onPlay),dn(e,"pause",this.onPause),dn(e,"seeking",this.onSeeking),dn(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const r=this.media=t.media;tn(r,"seeking",this.onSeeking),tn(r,"timeupdate",this.onTimeupdate),tn(r,"play",this.onPlay),tn(r,"pause",this.onPause)}onMediaAttached(e,t){const r=this.effectivePlayingItem,s=this.detachedData;if(this.detachedData=null,r===null)this.checkStart();else if(!s){this.clearScheduleState();const i=this.findItemIndex(r);this.setSchedulePosition(i)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const r=!!t.transferMedia,s=this.media;if(this.media=null,!r&&(s&&this.removeMediaListeners(s),this.detachedData)){const i=this.getBufferingPlayer();i&&(this.log(`Removing schedule state for detachedData and ${i}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,i.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,r=h=>h&&e.getAssetPlayer(h.identifier),s=(h,p,x,g,E)=>{if(h){let v=h[p].start;const b=h.event;if(b){if(p==="playout"||b.timelineOccupancy!==Su.Point){const A=r(x);A?.interstitial===b&&(v+=A.assetItem.startOffset+A[E])}}else{const A=g==="bufferedPos"?o():e[g];v+=A-h.start}return v}return 0},i=(h,p)=>{var x;if(h!==0&&p!=="primary"&&(x=e.schedule)!=null&&x.length){var g;const E=e.schedule.findItemIndexAtTime(h),v=(g=e.schedule.items)==null?void 0:g[E];if(v){const b=v[p].start-v.start;return h+b}}return h},o=()=>{const h=e.bufferedPos;return h===Number.MAX_VALUE?l("primary"):Math.max(h,0)},l=h=>{var p,x;return(p=e.primaryDetails)!=null&&p.live?e.primaryDetails.edge:((x=e.schedule)==null?void 0:x.durations[h])||0},u=(h,p)=>{var x,g;const E=e.effectivePlayingItem;if(E!=null&&(x=E.event)!=null&&x.restrictions.skip||!e.schedule)return;e.log(`seek to ${h} "${p}"`);const v=e.effectivePlayingItem,b=e.schedule.findItemIndexAtTime(h,p),A=(g=e.schedule.items)==null?void 0:g[b],L=e.getBufferingPlayer(),I=L?.interstitial,_=I?.appendInPlace,F=v&&e.itemsMatch(v,A);if(v&&(_||F)){const C=r(e.playingAsset),P=C?.media||e.primaryMedia;if(P){const O=p==="primary"?P.currentTime:s(v,p,e.playingAsset,"timelinePos","currentTime"),M=h-O,H=(_?O:P.currentTime)+M;if(H>=0&&(!C||_||H<=C.duration)){P.currentTime=H;return}}}if(A){let C=h;if(p!=="primary"){const O=A[p].start,M=h-O;C=A.start+M}const P=!e.isInterstitial(A);if((!e.isInterstitial(v)||v.event.appendInPlace)&&(P||A.event.appendInPlace)){const O=e.media||(_?L?.media:null);O&&(O.currentTime=C)}else if(v){const O=e.findItemIndex(v);if(b>O){const H=e.schedule.findJumpRestrictedIndex(O+1,b);if(H>O){e.setSchedulePosition(H);return}}let M=0;if(P)e.timelinePos=C,e.checkBuffer();else{const H=A.event.assetList,Z=h-(A[p]||A).start;for(let se=H.length;se--;){const U=H[se];if(U.duration&&Z>=U.startOffset&&Z<U.startOffset+U.duration){M=se;break}}}e.setSchedulePosition(b,M)}}},d=()=>{const h=e.effectivePlayingItem;if(e.isInterstitial(h))return h;const p=t();return e.isInterstitial(p)?p:null},f={get bufferedEnd(){const h=t(),p=e.bufferingItem;if(p&&p===h){var x;return s(p,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-p.playout.start||((x=e.bufferingAsset)==null?void 0:x.startOffset)||0}return 0},get currentTime(){const h=d(),p=e.effectivePlayingItem;return p&&p===h?s(p,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-p.playout.start:0},set currentTime(h){const p=d(),x=e.effectivePlayingItem;x&&x===p&&u(h+x.playout.start,"playout")},get duration(){const h=d();return h?h.playout.end-h.playout.start:0},get assetPlayers(){var h;const p=(h=d())==null?void 0:h.event.assetList;return p?p.map(x=>e.getAssetPlayer(x.identifier)):[]},get playingIndex(){var h;const p=(h=d())==null?void 0:h.event;return p&&e.effectivePlayingAsset?p.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return d()}};return this.manager={get events(){var h;return((h=e.schedule)==null||(h=h.events)==null?void 0:h.slice(0))||[]},get schedule(){var h;return((h=e.schedule)==null||(h=h.items)==null?void 0:h.slice(0))||[]},get interstitialPlayer(){return d()?f:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const h=t();return e.findItemIndex(h)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const h=e.effectivePlayingItem;return e.findItemIndex(h)},primary:{get bufferedEnd(){return o()},get currentTime(){const h=e.timelinePos;return h>0?h:0},set currentTime(h){u(h,"primary")},get duration(){return l("primary")},get seekableStart(){var h;return((h=e.primaryDetails)==null?void 0:h.fragmentStart)||0}},integrated:{get bufferedEnd(){return s(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return s(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(h){u(h,"integrated")},get duration(){return l("integrated")},get seekableStart(){var h;return i(((h=e.primaryDetails)==null?void 0:h.fragmentStart)||0,"integrated")}},skip:()=>{const h=e.effectivePlayingItem,p=h?.event;if(p&&!p.restrictions.skip){const x=e.findItemIndex(h);if(p.appendInPlace){const g=h.playout.start+h.event.duration;u(g+.001,"playout")}else e.advanceAfterAssetEnded(p,x,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,r=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!r?!1:this.findItemIndex(t)===r.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const r=this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&!r.event.appendInPlace)return;let s=this.media;!s&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(s=this.primaryMedia);const i=(t=s)==null?void 0:t.currentTime;if(!(i===void 0||!he(i)))return i}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const r=this.getAssetPlayer(e);r&&this.transferMediaFromPlayer(r,t)}transferMediaFromPlayer(e,t){const r=e.interstitial.appendInPlace,s=e.media;if(r&&s===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&s){this.detachedData={media:s};return}const i=e.transferMedia();this.log(`transfer MediaSource from ${e} ${st(i)}`),this.detachedData=i}else t&&s&&(this.shouldPlay||(this.shouldPlay=!s.paused))}transferMediaTo(e,t){var r,s;if(e.media===t)return;let i=null;const o=this.hls,l=e!==o,u=l&&e.interstitial.appendInPlace,d=(r=this.detachedData)==null?void 0:r.mediaSource;let f;if(o.media)u&&(i=o.transferMedia(),this.detachedData=i),f="Primary";else if(d){const g=this.getBufferingPlayer();g?(i=g.transferMedia(),f=`${g}`):f="detached MediaSource"}else f="detached media";if(!i){if(d)i=this.detachedData,this.log(`using detachedData: MediaSource ${st(i)}`);else if(!this.detachedData||o.media===t){const g=this.playerQueue;g.length>1&&g.forEach(E=>{if(l&&E.interstitial.appendInPlace!==u){const v=E.interstitial;this.clearInterstitial(E.interstitial,null),v.appendInPlace=!1,v.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${v}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const h=i&&"mediaSource"in i&&((s=i.mediaSource)==null?void 0:s.readyState)!=="closed",p=h&&i?i:t;this.log(`${h?"transfering MediaSource":"attaching media"} to ${l?e:"Primary"} from ${f} (media.currentTime: ${t.currentTime})`);const x=this.schedule;if(p===i&&x){const g=l&&e.assetId===x.assetIdAtEnd;p.overrides={duration:x.duration,endOfStream:!l||g,cueRemoval:!l}}e.attachMedia(p)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e?.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const r=this.timelinePos,s=this.effectivePlayingItem;if(r===-1){const i=this.hls.startPosition;if(this.log(wc("checkStart",i)),this.timelinePos=i,t.length&&t[0].cue.pre){const o=e.findEventIndex(t[0].identifier);this.setSchedulePosition(o)}else if(i>=0||!this.primaryLive){const o=this.timelinePos=i>0?i:0,l=e.findItemIndexAtTime(o);this.setSchedulePosition(l)}}else if(s&&!this.playingItem){const i=e.findItemIndex(s);this.setSchedulePosition(i)}}advanceAssetBuffering(e,t){const r=e.event,s=r.findAssetIndex(t),i=Ch(r,s);if(!r.isAssetPastPlayoutLimit(i))this.bufferedToEvent(e,i);else if(this.schedule){var o;const l=(o=this.schedule.items)==null?void 0:o[this.findItemIndex(e)+1];l&&this.bufferedToItem(l)}}advanceAfterAssetEnded(e,t,r){const s=Ch(e,r);if(e.isAssetPastPlayoutLimit(s)){if(this.schedule){const i=this.schedule.items;if(i){const o=t+1,l=i.length;if(o>=l){this.setSchedulePosition(-1);return}const u=e.resumeTime;this.timelinePos<u&&(this.log(wc("advanceAfterAssetEnded",u)),this.timelinePos=u,e.appendInPlace&&this.advanceInPlace(u),this.checkBuffer(this.bufferedPos<u)),this.setSchedulePosition(o)}}}else{if(e.appendInPlace){const i=e.assetList[s];i&&this.advanceInPlace(i.timelineStart)}this.setSchedulePosition(t,s)}}setScheduleToAssetAtTime(e,t){const r=this.schedule;if(!r)return;const s=t.parentIdentifier,i=r.getEvent(s);if(i){const o=r.findEventIndex(s),l=r.findAssetIndex(i,e);this.advanceAfterAssetEnded(i,o,l-1)}}setSchedulePosition(e,t){var r;const s=(r=this.schedule)==null?void 0:r.items;if(!s||this.playbackDisabled)return;const i=e>=0?s[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${i&&Xn(i)}) pos: ${this.timelinePos}`);const o=this.waitingItem||this.playingItem,l=this.playingLastItem;if(this.isInterstitial(o)){const f=o.event,h=this.playingAsset,p=h?.identifier,x=p?this.getAssetPlayer(p):null;if(x&&p&&(!this.eventItemsMatch(o,i)||t!==void 0&&p!==f.assetList[t].identifier)){var u;const g=f.findAssetIndex(h);if(this.log(`INTERSTITIAL_ASSET_ENDED ${g+1}/${f.assetList.length} ${Ui(h)}`),this.endedAsset=h,this.playingAsset=null,this.hls.trigger(R.INTERSTITIAL_ASSET_ENDED,{asset:h,assetListIndex:g,event:f,schedule:s.slice(0),scheduleIndex:e,player:x}),o!==this.playingItem){this.itemsMatch(o,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(f,this.findItemIndex(this.playingItem),g);return}this.retreiveMediaSource(p,i),x.media&&!((u=this.detachedData)!=null&&u.mediaSource)&&x.detachMedia()}if(!this.eventItemsMatch(o,i)&&(this.endedItem=o,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${f} ${Xn(o)}`),f.hasPlayed=!0,this.hls.trigger(R.INTERSTITIAL_ENDED,{event:f,schedule:s.slice(0),scheduleIndex:e}),f.cue.once)){var d;this.updateSchedule();const g=(d=this.schedule)==null?void 0:d.items;if(i&&g){const E=this.findItemIndex(i);this.advanceSchedule(E,g,t,o,l)}return}}this.advanceSchedule(e,s,t,o,l)}advanceSchedule(e,t,r,s,i){const o=this.schedule;if(!o)return;const l=t[e]||null,u=this.primaryMedia,d=this.playerQueue;if(d.length&&d.forEach(f=>{const h=f.interstitial,p=o.findEventIndex(h.identifier);(p<e||p>e+1)&&this.clearInterstitial(h,l)}),this.isInterstitial(l)){this.timelinePos=Math.min(Math.max(this.timelinePos,l.start),l.end);const f=l.event;if(r===void 0){r=o.findAssetIndex(f,this.timelinePos);const g=Ch(f,r-1);if(f.isAssetPastPlayoutLimit(g)||f.appendInPlace&&this.timelinePos===l.end){this.advanceAfterAssetEnded(f,e,r);return}r=g}const h=this.waitingItem;this.assetsBuffered(l,u)||this.setBufferingItem(l);let p=this.preloadAssets(f,r);if(this.eventItemsMatch(l,h||s)||(this.waitingItem=l,this.log(`INTERSTITIAL_STARTED ${Xn(l)} ${f.appendInPlace?"append in place":""}`),this.hls.trigger(R.INTERSTITIAL_STARTED,{event:f,schedule:t.slice(0),scheduleIndex:e})),!f.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${f}`);return}if(f.assetListLoader&&(f.assetListLoader.destroy(),f.assetListLoader=void 0),!u){this.log(`Waiting for attachMedia to start Interstitial ${f}`);return}this.waitingItem=this.endedItem=null,this.playingItem=l;const x=f.assetList[r];if(!x){this.advanceAfterAssetEnded(f,e,r||0);return}if(p||(p=this.getAssetPlayer(x.identifier)),p===null||p.destroyed){const g=f.assetList.length;this.warn(`asset ${r+1}/${g} player destroyed ${f}`),p=this.createAssetPlayer(f,x,r),p.loadSource()}if(!this.eventItemsMatch(l,this.bufferingItem)&&f.appendInPlace&&this.isAssetBuffered(x))return;this.startAssetPlayer(p,r,t,e,u),this.shouldPlay&&BS(p.media)}else l?(this.resumePrimary(l,e,s),this.shouldPlay&&BS(this.hls.media)):i&&this.isInterstitial(s)&&(this.endedItem=null,this.playingItem=s,s.event.appendInPlace||this.attachPrimary(o.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,r){var s,i;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Xn(e)}`),!((s=this.detachedData)!=null&&s.mediaSource)){let l=this.timelinePos;(l<e.start||l>=e.end)&&(l=this.getPrimaryResumption(e,t),this.log(wc("resumePrimary",l)),this.timelinePos=l),this.attachPrimary(l,e)}if(!r)return;const o=(i=this.schedule)==null?void 0:i.items;o&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${Xn(e)}`),this.hls.trigger(R.INTERSTITIALS_PRIMARY_RESUMED,{schedule:o.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const r=e.start;if(this.primaryLive){const s=this.primaryDetails;if(t===0)return this.hls.startPosition;if(s&&(r<s.fragmentStart||r>s.edge))return this.hls.liveSyncPosition||-1}return r}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:Oe.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,r){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const s=this.primaryMedia;if(!s)return;const i=this.hls;i.media?this.checkBuffer():(this.transferMediaTo(i,s),r&&this.startLoadingPrimaryAt(e,r)),r||(this.log(wc("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,r))}startLoadingPrimaryAt(e,t){var r;const s=this.hls;!s.loadingEnabled||!s.media||Math.abs((((r=s.mainForwardBufferInfo)==null?void 0:r.start)||s.media.currentTime)-e)>.5?s.startLoad(e,t):s.bufferingEnabled||s.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(R.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(R.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const r=this.hls.levels[t.level];if(!r.details)return;const s=Je(Je({},this.mediaSelection||this.altSelection),{},{main:r});this.mediaSelection=s,this.schedule.parseInterstitialDateRanges(s,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const r=this.hls.audioTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=Je(Je({},this.altSelection),{},{audio:r});return}const i=Je(Je({},s),{},{audio:r});this.mediaSelection=i}onSubtitleTrackUpdated(e,t){const r=this.hls.subtitleTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=Je(Je({},this.altSelection),{},{subtitles:r});return}const i=Je(Je({},s),{},{subtitles:r});this.mediaSelection=i}onAudioTrackSwitching(e,t){const r=Wv(t);this.playerQueue.forEach(({hls:s})=>s&&(s.setAudioOption(t)||s.setAudioOption(r)))}onSubtitleTrackSwitch(e,t){const r=Wv(t);this.playerQueue.forEach(({hls:s})=>s&&(s.setSubtitleOption(t)||t.id!==-1&&s.setSubtitleOption(r)))}onBufferCodecs(e,t){const r=t.tracks;r&&(this.requiredTracks=r)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const r=this.playingItem;if(r&&!this.itemsMatch(r,this.bufferingItem)&&!this.isInterstitial(r)){const s=this.timelinePos;this.bufferedPos=s,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let s=0;s<t.length;s++){const i=t[s];if(i.cue.post){var r;const o=this.schedule.findEventIndex(i.identifier),l=(r=this.schedule.items)==null?void 0:r[o];this.isInterstitial(l)&&this.eventItemsMatch(l,this.bufferingItem)&&this.bufferedToItem(l,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const r=this.findItemIndex(t);this.setSchedulePosition(r+1)}else this.shouldPlay=!1}updateItem(e,t){var r;const s=(r=this.schedule)==null?void 0:r.items;if(e&&s){const i=this.findItemIndex(e,t);return s[i]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((i,o)=>{e.event.isAssetPastPlayoutLimit(o)&&this.clearAssetPlayer(i.identifier,null)});const r=e.end+.25,s=Oe.bufferInfo(this.primaryMedia,r,0);(s.end>r||(s.nextStart||0)>r)&&(this.log(`trim buffered interstitial ${Xn(e)} (was ${Xn(t)})`),this.attachPrimary(r,null,!0),this.flushFrontBuffer(r))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var r;return!!t&&(e===t||e.event.identifier===((r=t.event)==null?void 0:r.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const r=this.mediaSelection;r&&((t=this.schedule)==null||t.updateSchedule(r,[],e))}checkBuffer(e){var t;const r=(t=this.schedule)==null?void 0:t.items;if(!r)return;const s=Oe.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=s.len<1),this.updateBufferedPos(s.end,r,e)}updateBufferedPos(e,t,r){const s=this.schedule,i=this.bufferingItem;if(this.bufferedPos>e||!s)return;if(t.length===1&&this.itemsMatch(t[0],i)){this.bufferedPos=e;return}const o=this.playingItem,l=this.findItemIndex(o);let u=s.findItemIndexAtTime(e);if(this.bufferedPos<e){var d;const f=this.findItemIndex(i),h=Math.min(f+1,t.length-1),p=t[h];if((u===-1&&i&&e>=i.end||(d=p.event)!=null&&d.appendInPlace&&e+.01>=p.start)&&(u=h),this.isInterstitial(i)){const x=i.event;if(h-l>1&&x.appendInPlace===!1||x.assetList.length===0&&x.assetListLoader)return}if(this.bufferedPos=e,u>f&&u>l)this.bufferedToItem(p);else{const x=this.primaryDetails;this.primaryLive&&x&&e>x.edge-x.targetduration&&p.start<x.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(p)&&this.preloadAssets(p.event,0)}}else r&&o&&!this.itemsMatch(o,i)&&(u===l?this.bufferedToItem(o):u===l+1&&this.bufferedToItem(t[u]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(s=>{const i=this.getAssetPlayer(s.identifier);return!(i!=null&&i.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,r=this.schedule;if(!this.itemsMatch(e,t)&&r){const{items:s,events:i}=r;if(!s||!i)return t;const o=this.isInterstitial(e),l=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const u=l?l.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${Xn(e)}`+(t?` (${u.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(o){const d=r.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((f,h)=>{const p=this.getAssetPlayer(f.identifier);p&&(h===d&&p.loadSource(),p.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(d=>d.pauseBuffering());this.hls.trigger(R.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:i.slice(0),schedule:s.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const r=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(r!==null){this.bufferingAsset=null;const s=this.detachedData;s?s.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),r=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(r)}bufferedToEvent(e,t){const r=e.event,s=r.assetList.length===0&&!r.assetListLoader,i=r.cue.once;if(s||!i){const o=this.preloadAssets(r,t);if(o!=null&&o.interstitial.appendInPlace){const l=this.primaryMedia;l&&this.bufferAssetPlayer(o,l)}}}preloadAssets(e,t){const r=e.assetUrl,s=e.assetList.length,i=s===0&&!e.assetListLoader,o=e.cue.once;if(i){const u=e.timelineStart;if(e.appendInPlace){var l;const p=this.playingItem;!this.isInterstitial(p)&&(p==null||(l=p.nextEvent)==null?void 0:l.identifier)===e.identifier&&this.flushFrontBuffer(u+.25)}let d,f=0;if(!this.playingItem&&this.primaryLive&&(f=this.hls.startPosition,f===-1&&(f=this.hls.liveSyncPosition||0)),f&&!(e.cue.pre||e.cue.post)){const p=f-u;p>0&&(d=Math.round(p*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${r?1:s} ${e}${d?` live-start: ${f} start-offset: ${d}`:""}`),r)return this.createAsset(e,0,0,u,e.duration,r);const h=this.assetListLoader.loadAssetList(e,d);h&&(e.assetListLoader=h)}else if(!o&&s){for(let d=t;d<s;d++){const f=e.assetList[d],h=this.getAssetPlayerQueueIndex(f.identifier);(h===-1||this.playerQueue[h].destroyed)&&!f.error&&this.createAssetPlayer(e,f,d)}const u=e.assetList[t];if(u){const d=this.getAssetPlayer(u.identifier);return d&&d.loadSource(),d}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(s=>{this.hls.trigger(R.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:s})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let r=0;r<t.length;r++)if(e===t[r].assetId)return r;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let r=0;r<e.length;r++)if(e[r].media===t)return e[r]}return null}createAsset(e,t,r,s,i,o){const l={parentIdentifier:e.identifier,identifier:mU(e,o,t),duration:i,startOffset:r,timelineStart:s,uri:o};return this.createAssetPlayer(e,l,t)}createAssetPlayer(e,t,r){const s=this.hls,i=s.userConfig;let o=i.videoPreference;const l=s.loadLevelObj||s.levels[s.currentLevel];(o||l)&&(o=tt({},o),l.videoCodec&&(o.videoCodec=l.videoCodec),l.videoRange&&(o.allowedVideoRanges=[l.videoRange]));const u=s.audioTracks[s.audioTrack],d=s.subtitleTracks[s.subtitleTrack];let f=0;if(this.primaryLive||e.appendInPlace){const I=this.timelinePos-t.timelineStart;if(I>1){const _=t.duration;_&&I<_&&(f=I)}}const h=t.identifier,p=Je(Je({},i),{},{maxMaxBufferLength:Math.min(180,s.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:s.sessionId,assetPlayerId:h,abrEwmaDefaultEstimate:s.bandwidthEstimate,interstitialsController:void 0,startPosition:f,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:u||i.audioPreference,subtitlePreference:d||i.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(p.timelineOffset=t.timelineStart));const x=p.cmcd;x!=null&&x.sessionId&&x.contentId&&(p.cmcd=tt({},x,{contentId:ma(t.uri)})),this.getAssetPlayer(h)&&this.warn(`Duplicate date range identifier ${e} and asset ${h}`);const g=new yU(this.HlsPlayerClass,p,e,t);this.playerQueue.push(g),e.assetList[r]=t;let E=!0;const v=I=>{if(I.live){var _;const P=new Error(`Interstitials MUST be VOD assets ${e}`),O={fatal:!0,type:we.OTHER_ERROR,details:z.INTERSTITIAL_ASSET_ITEM_ERROR,error:P},M=((_=this.schedule)==null?void 0:_.findEventIndex(e.identifier))||-1;this.handleAssetItemError(O,e,M,r,P.message);return}const F=I.edge-I.fragmentStart,C=t.duration;(E||C===null||F>C)&&(E=!1,this.log(`Interstitial asset "${h}" duration change ${C} > ${F}`),t.duration=F,this.updateSchedule())};g.on(R.LEVEL_UPDATED,(I,{details:_})=>v(_)),g.on(R.LEVEL_PTS_UPDATED,(I,{details:_})=>v(_)),g.on(R.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const b=(I,_)=>{const F=this.getAssetPlayer(h);if(F&&_.tracks){F.off(R.BUFFER_CODECS,b),F.tracks=_.tracks;const C=this.primaryMedia;this.bufferingAsset===F.assetItem&&C&&!F.media&&this.bufferAssetPlayer(F,C)}};g.on(R.BUFFER_CODECS,b);const A=()=>{var I;const _=this.getAssetPlayer(h);if(this.log(`buffered to end of asset ${_}`),!_||!this.schedule)return;const F=this.schedule.findEventIndex(e.identifier),C=(I=this.schedule.items)==null?void 0:I[F];this.isInterstitial(C)&&this.advanceAssetBuffering(C,t)};g.on(R.BUFFERED_TO_END,A);const L=I=>()=>{if(!this.getAssetPlayer(h)||!this.schedule)return;this.shouldPlay=!0;const F=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,F,I)};return g.once(R.MEDIA_ENDED,L(r)),g.once(R.PLAYOUT_LIMIT_REACHED,L(1/0)),g.on(R.ERROR,(I,_)=>{if(!this.schedule)return;const F=this.getAssetPlayer(h);if(_.details===z.BUFFER_STALLED_ERROR){if(F!=null&&F.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(_,e,this.schedule.findEventIndex(e.identifier),r,`Asset player error ${_.error} ${e}`)}),g.on(R.DESTROYING,()=>{if(!this.getAssetPlayer(h)||!this.schedule)return;const _=new Error(`Asset player destroyed unexpectedly ${h}`),F={fatal:!0,type:we.OTHER_ERROR,details:z.INTERSTITIAL_ASSET_ITEM_ERROR,error:_};this.handleAssetItemError(F,e,this.schedule.findEventIndex(e.identifier),r,_.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${Ui(t)}`),this.hls.trigger(R.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:r,event:e,player:g}),g}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(r=>{this.clearAssetPlayer(r.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const r=this.playerQueue[t];this.transferMediaFromPlayer(r,null),r.resetDetails()}}clearAssetPlayer(e,t){const r=this.getAssetPlayerQueueIndex(e);if(r!==-1){const s=this.playerQueue[r];this.log(`clear ${s} toSegment: ${t&&Xn(t)}`),this.transferMediaFromPlayer(s,t),this.playerQueue.splice(r,1),s.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,r,s,i){const{interstitial:o,assetItem:l,assetId:u}=e,d=o.assetList.length,f=this.playingAsset;this.endedAsset=null,this.playingAsset=l,(!f||f.identifier!==u)&&(f&&(this.clearAssetPlayer(f.identifier,r[s]),delete f.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${d} ${Ui(l)}`),this.hls.trigger(R.INTERSTITIAL_ASSET_STARTED,{asset:l,assetListIndex:t,event:o,schedule:r.slice(0),scheduleIndex:s,player:e})),this.bufferAssetPlayer(e,i)}bufferAssetPlayer(e,t){var r,s;if(!this.schedule)return;const{interstitial:i,assetItem:o}=e,l=this.schedule.findEventIndex(i.identifier),u=(r=this.schedule.items)==null?void 0:r[l];if(!u)return;e.loadSource(),this.setBufferingItem(u),this.bufferingAsset=o;const d=this.getBufferingPlayer();if(d===e)return;const f=i.appendInPlace;if(f&&d?.interstitial.appendInPlace===!1)return;const h=d?.tracks||((s=this.detachedData)==null?void 0:s.tracks)||this.requiredTracks;if(f&&o!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(h&&!K1(h,e.tracks)){const p=new Error(`Asset ${Ui(o)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(h)}')`),x={fatal:!0,type:we.OTHER_ERROR,details:z.INTERSTITIAL_ASSET_ITEM_ERROR,error:p},g=i.findAssetIndex(o);this.handleAssetItemError(x,i,l,g,p.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,r=this.primaryMedia;if(!t||!r)return;const s=r.currentTime,i=t.findAssetIndex(e,s),o=e.assetList[i];if(o){const l=this.getAssetPlayer(o.identifier);if(l){const u=l.currentTime||s-o.timelineStart,d=l.duration-u;if(this.warn(`Stalled at ${u} of ${u+d} in ${l} ${e} (media.currentTime: ${s})`),u&&(d/r.playbackRate<.5||l.bufferedInPlaceToEnd(r))&&l.hls){const f=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,f,i)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,r,s,i){if(e.details===z.BUFFER_STALLED_ERROR)return;const o=t.assetList[s]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${o&&Ui(o)} ${e.error}`),!this.schedule)return;const l=o?.identifier||"",u=this.getAssetPlayerQueueIndex(l),d=this.playerQueue[u]||null,f=this.schedule.items,h=tt({},e,{fatal:!1,errorAction:Ki(!0),asset:o,assetListIndex:s,event:t,schedule:f,scheduleIndex:r,player:d});if(this.hls.trigger(R.INTERSTITIAL_ASSET_ERROR,h),!e.fatal)return;const p=this.playingAsset,x=this.bufferingAsset,g=new Error(i);if(o&&(this.clearAssetPlayer(l,null),o.error=g),!t.assetList.some(E=>!E.error))t.error=g;else for(let E=s;E<t.assetList.length;E++)this.resetAssetPlayer(t.assetList[E].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):p&&p.identifier===l?this.advanceAfterAssetEnded(t,r,s):x&&x.identifier===l&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,x)}primaryFallback(e){const t=e.timelineStart,r=this.effectivePlayingItem;let s=this.timelinePos;if(r){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${s} playing: ${Xn(r)} error: ${e.error}`),s===-1&&(s=this.hls.startPosition);const o=this.updateItem(r,s);this.itemsMatch(r,o)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(s===-1){this.checkStart();return}if(!this.schedule)return;const i=this.schedule.findItemIndexAtTime(s);this.setSchedulePosition(i)}onAssetListLoaded(e,t){var r,s;const i=t.event,o=i.identifier,l=t.assetListResponse.ASSETS;if(!((r=this.schedule)!=null&&r.hasEvent(o)))return;const u=i.timelineStart,d=i.duration;let f=0;l.forEach((E,v)=>{const b=parseFloat(E.DURATION);this.createAsset(i,v,f,u+f,b,E.URI),f+=b}),i.duration=f,this.log(`Loaded asset-list with duration: ${f} (was: ${d}) ${i}`);const h=this.waitingItem,p=h?.event.identifier===o;this.updateSchedule();const x=(s=this.bufferingItem)==null?void 0:s.event;if(p){var g;const E=this.schedule.findEventIndex(o),v=(g=this.schedule.items)==null?void 0:g[E];if(v){if(!this.playingItem&&this.timelinePos>v.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==E){i.error=new Error(`Interstitial ${l.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${i}`),this.log(i.error.message),this.updateSchedule(!0),this.primaryFallback(i);return}this.setBufferingItem(v)}this.setSchedulePosition(E)}else if(x?.identifier===o){const E=i.assetList[0];if(E){const v=this.getAssetPlayer(E.identifier);if(x.appendInPlace){const b=this.primaryMedia;v&&b&&this.bufferAssetPlayer(v,b)}else v&&v.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case z.ASSET_LIST_PARSING_ERROR:case z.ASSET_LIST_LOAD_ERROR:case z.ASSET_LIST_LOAD_TIMEOUT:{const r=t.interstitial;r&&(this.updateSchedule(!0),this.primaryFallback(r));break}case z.BUFFER_STALLED_ERROR:{const r=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&r.event.appendInPlace){this.handleInPlaceStall(r.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const US=500;class EU extends Vp{constructor(e,t,r){super(e,t,r,"subtitle-stream-controller",ge.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(R.LEVEL_LOADED,this.onLevelLoaded,this),e.on(R.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(R.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(R.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(R.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(R.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(R.LEVEL_LOADED,this.onLevelLoaded,this),e.off(R.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(R.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(R.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(R.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(R.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=re.IDLE,this.setInterval(US),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:r,success:s}=t;if(this.fragContextChanged(r)||(Tt(r)&&(this.fragPrevious=r),this.state=re.IDLE),!s)return;const i=this.tracksBuffered[this.currentTrackId];if(!i)return;let o;const l=r.start;for(let d=0;d<i.length;d++)if(l>=i[d].start&&l<=i[d].end){o=i[d];break}const u=r.start+r.duration;o?o.end=u:(o={start:l,end:u},i.push(o)),this.fragmentTracker.fragBuffered(r),this.fragBufferedComplete(r,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:r,endOffset:s}=t;if(r===0&&s!==Number.POSITIVE_INFINITY){const i=s-1;if(i<=0)return;t.endOffsetSubtitles=Math.max(0,i),this.tracksBuffered.forEach(o=>{for(let l=0;l<o.length;){if(o[l].end<=i){o.shift();continue}else if(o[l].start<i)o[l].start=i;else break;l++}}),this.fragmentTracker.removeFragmentsInRange(r,i,ge.SUBTITLE)}}onError(e,t){const r=t.frag;r?.type===ge.SUBTITLE&&(t.details===z.FRAG_GAP&&this.fragmentTracker.fragBuffered(r,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==re.STOPPED&&(this.state=re.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&Yb(this.levels,t)){this.levels=t.map(r=>new Ra(r));return}this.tracksBuffered=[],this.levels=t.map(r=>{const s=new Ra(r);return this.tracksBuffered[s.id]=[],s}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,ge.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var r;if(this.currentTrackId=t.id,!((r=this.levels)!=null&&r.length)||this.currentTrackId===-1){this.clearInterval();return}const s=this.levels[this.currentTrackId];s!=null&&s.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,s&&this.state!==re.STOPPED&&this.setInterval(US)}onSubtitleTrackLoaded(e,t){var r;const{currentTrackId:s,levels:i}=this,{details:o,id:l}=t;if(!i){this.warn(`Subtitle tracks were reset while loading level ${l}`);return}const u=i[l];if(l>=i.length||!u)return;this.log(`Subtitle track ${l} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let d=0;if(o.live||(r=u.details)!=null&&r.live){if(o.deltaUpdateFailed)return;const h=this.mainDetails;if(!h){this.startFragRequested=!1;return}const p=h.fragments[0];if(!u.details)o.hasProgramDateTime&&h.hasProgramDateTime?(xu(o,h),d=o.fragmentStart):p&&(d=p.start,_m(o,d));else{var f;d=this.alignPlaylists(o,u.details,(f=this.levelLastLoaded)==null?void 0:f.details),d===0&&p&&(d=p.start,_m(o,d))}h&&!this.startFragRequested&&this.setStartPosition(h,d)}u.details=o,this.levelLastLoaded=u,l===s&&(this.hls.trigger(R.SUBTITLE_TRACK_UPDATED,{details:o,id:l,groupId:t.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===re.IDLE&&(oi(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),u.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:r}=e,s=t.decryptdata,i=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&s!=null&&s.key&&s.iv&&zi(s.method)){const o=performance.now();this.decrypter.decrypt(new Uint8Array(r),s.key.buffer,s.iv.buffer,$p(s.method)).catch(l=>{throw i.trigger(R.ERROR,{type:we.MEDIA_ERROR,details:z.FRAG_DECRYPT_ERROR,fatal:!1,error:l,reason:l.message,frag:t}),l}).then(l=>{const u=performance.now();i.trigger(R.FRAG_DECRYPTED,{frag:t,payload:l,stats:{tstart:o,tdecrypt:u}})}).catch(l=>{this.warn(`${l.name}: ${l.message}`),this.state=re.IDLE})}}doTick(){if(!this.media){this.state=re.IDLE;return}if(this.state===re.IDLE){const{currentTrackId:e,levels:t}=this,r=t?.[e];if(!r||!t.length||!r.details||this.waitForLive(r))return;const{config:s}=this,i=this.getLoadPosition(),o=Oe.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],i,s.maxBufferHole),{end:l,len:u}=o,d=r.details,f=this.hls.maxBufferLength+d.levelTargetDuration;if(u>f)return;const h=d.fragments,p=h.length,x=d.edge;let g=null;const E=this.fragPrevious;if(l<x){const A=s.maxFragLookUpTolerance,L=l>x-A?0:A;g=oi(E,h,Math.max(h[0].start,l),L),!g&&E&&E.start<h[0].start&&(g=h[0])}else g=h[p-1];if(g=this.filterReplacedPrimary(g,r.details),!g)return;const v=g.sn-d.startSN,b=h[v-1];if(b&&b.cc===g.cc&&this.fragmentTracker.getState(b)===Ct.NOT_LOADED&&(g=b),this.fragmentTracker.getState(g)===Ct.NOT_LOADED){const A=this.mapToInitFragWhenRequired(g);A&&this.loadFragment(A,r,l)}}}loadFragment(e,t,r){Tt(e)?super.loadFragment(e,t,r):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new TU(this.tracksBuffered[this.currentTrackId]||[])}}class TU{constructor(e){this.buffered=void 0;const t=(r,s,i)=>{if(s=s>>>0,s>i-1)throw new DOMException(`Failed to execute '${r}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${i})`);return e[s][r]};this.buffered={get length(){return e.length},end(r){return t("end",r,e.length)},start(r){return t("start",r,e.length)}}}}const bU={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},uw=n=>String.fromCharCode(bU[n]||n),Jn=15,Mr=100,wU={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},AU={17:2,18:4,21:6,22:8,23:10,19:13,20:15},LU={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},RU={25:2,26:4,29:6,30:8,31:10,27:13,28:15},IU=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class kU{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const r=typeof t=="function"?t():t;Ze.log(`${this.time} [${e}] ${r}`)}}}const zs=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].toString(16));return t};class dw{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let r=0;r<t.length;r++){const s=t[r];e.hasOwnProperty(s)&&(this[s]=e[s])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class CU{constructor(){this.uchar=" ",this.penState=new dw}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class _U{constructor(e){this.chars=[],this.pos=0,this.currPenState=new dw,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Mr;t++)this.chars.push(new CU);this.logger=e}equals(e){for(let t=0;t<Mr;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Mr;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Mr;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Mr&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Mr)}moveCursor(e){const t=this.pos+e;if(e>1)for(let r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=uw(e);if(this.pos>=Mr){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Mr;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let r=0;r<Mr;r++){const s=this.chars[r].uchar;s!==" "&&(t=!1),e.push(s)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class _h{constructor(e){this.rows=[],this.currRow=Jn-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Jn;t++)this.rows.push(new _U(e));this.logger=e}reset(){for(let e=0;e<Jn;e++)this.rows[e].clear();this.currRow=Jn-1}equals(e){let t=!0;for(let r=0;r<Jn;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}copy(e){for(let t=0;t<Jn;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Jn;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+st(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let l=0;l<Jn;l++)this.rows[l].clear();const i=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const l=o.rows[i].cueStartTime,u=this.logger.time;if(l!==null&&u!==null&&l<u)for(let d=0;d<this.nrRollUpRows;d++)this.rows[t-this.nrRollUpRows+d+1].copy(o.rows[i+d])}}this.currRow=t;const r=this.rows[this.currRow];if(e.indent!==null){const i=e.indent,o=Math.max(i-1,0);r.setCursor(e.indent),e.color=r.chars[o].penState.foreground}const s={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(s)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+st(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let r="",s=-1;for(let i=0;i<Jn;i++){const o=this.rows[i].getTextString();o&&(s=i+1,e?t.push("Row "+s+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e?r="["+t.join(" | ")+"]":r=t.join(`
`)),r}getTextAndFormat(){return this.rows}}class $S{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new _h(r),this.nonDisplayedMemory=new _h(r),this.lastOutputScreen=new _h(r),this.currRollUpRow=this.displayedMemory.rows[Jn-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Jn-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const r=Math.floor(e/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=s[r]}this.logger.log(2,"MIDROW: "+st(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class jS{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=DU(),this.logger=void 0;const s=this.logger=new kU;this.channels=[null,new $S(e,t,s),new $S(e+1,r,s)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let r=0;r<t.length;r+=2){const s=t[r]&127,i=t[r+1]&127;let o=!1,l=null;if(s===0&&i===0)continue;this.logger.log(3,()=>"["+zs([t[r],t[r+1]])+"] -> ("+zs([s,i])+")");const u=this.cmdHistory;if(s>=16&&s<=31){if(PU(s,i,u)){Ac(null,null,u),this.logger.log(3,()=>"Repeated command ("+zs([s,i])+") is dropped");continue}Ac(s,i,this.cmdHistory),o=this.parseCmd(s,i),o||(o=this.parseMidrow(s,i)),o||(o=this.parsePAC(s,i)),o||(o=this.parseBackgroundAttributes(s,i))}else Ac(null,null,u);if(!o&&(l=this.parseChars(s,i),l)){const f=this.currentChannel;f&&f>0?this.channels[f].insertChars(l):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!l&&this.logger.log(2,()=>"Couldn't parse cleaned data "+zs([s,i])+" orig: "+zs([t[r],t[r+1]]))}}parseCmd(e,t){const r=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=33&&t<=35;if(!(r||s))return!1;const i=e===20||e===21||e===23?1:2,o=this.channels[i];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),this.currentChannel=i,!0}parseMidrow(e,t){let r=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?r=1:r=2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const s=this.channels[r];return s?(s.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+zs([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let r;const s=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,i=(e===16||e===24)&&t>=64&&t<=95;if(!(s||i))return!1;const o=e<=23?1:2;t>=64&&t<=95?r=o===1?wU[e]:LU[e]:r=o===1?AU[e]:RU[e];const l=this.channels[o];return l?(l.setPAC(this.interpretPAC(r,t)),this.currentChannel=o,!0):!1}interpretPAC(e,t){let r;const s={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?r=t-96:r=t-64,s.underline=(r&1)===1,r<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(s.italics=!0,s.color="white"):s.indent=Math.floor((r-16)/2)*4,s}parseChars(e,t){let r,s=null,i=null;if(e>=25?(r=2,i=e-8):(r=1,i=e),i>=17&&i<=19){let o;i===17?o=t+80:i===18?o=t+112:o=t+144,this.logger.log(2,()=>"Special char '"+uw(o)+"' in channel "+r),s=[o]}else e>=32&&e<=127&&(s=t===0?[e]:[e,t]);return s&&this.logger.log(3,()=>"Char codes =  "+zs(s).join(",")),s}parseBackgroundAttributes(e,t){const r=(e===16||e===24)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=45&&t<=47;if(!(r||s))return!1;let i;const o={};e===16||e===24?(i=Math.floor((t-32)/2),o.background=IU[i],t%2===1&&(o.background=o.background+"_semi")):t===45?o.background="transparent":(o.foreground="black",t===47&&(o.underline=!0));const l=e<=23?1:2;return this.channels[l].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Ac(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const r=this.channels[t];r&&r.cueSplitAtTime(e)}}}function Ac(n,e,t){t.a=n,t.b=e}function PU(n,e,t){return t.a===n&&t.b===e}function DU(){return{a:null,b:null}}var eg=(function(){if(yu!=null&&yu.VTTCue)return self.VTTCue;const n=["","lr","rl"],e=["start","middle","end","left","right"];function t(l,u){if(typeof u!="string"||!Array.isArray(l))return!1;const d=u.toLowerCase();return~l.indexOf(d)?d:!1}function r(l){return t(n,l)}function s(l){return t(e,l)}function i(l,...u){let d=1;for(;d<arguments.length;d++){const f=arguments[d];for(const h in f)l[h]=f[h]}return l}function o(l,u,d){const f=this,h={enumerable:!0};f.hasBeenReset=!1;let p="",x=!1,g=l,E=u,v=d,b=null,A="",L=!0,I="auto",_="start",F=50,C="middle",P=50,O="middle";Object.defineProperty(f,"id",i({},h,{get:function(){return p},set:function(M){p=""+M}})),Object.defineProperty(f,"pauseOnExit",i({},h,{get:function(){return x},set:function(M){x=!!M}})),Object.defineProperty(f,"startTime",i({},h,{get:function(){return g},set:function(M){if(typeof M!="number")throw new TypeError("Start time must be set to a number.");g=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"endTime",i({},h,{get:function(){return E},set:function(M){if(typeof M!="number")throw new TypeError("End time must be set to a number.");E=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"text",i({},h,{get:function(){return v},set:function(M){v=""+M,this.hasBeenReset=!0}})),Object.defineProperty(f,"region",i({},h,{get:function(){return b},set:function(M){b=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"vertical",i({},h,{get:function(){return A},set:function(M){const H=r(M);if(H===!1)throw new SyntaxError("An invalid or illegal string was specified.");A=H,this.hasBeenReset=!0}})),Object.defineProperty(f,"snapToLines",i({},h,{get:function(){return L},set:function(M){L=!!M,this.hasBeenReset=!0}})),Object.defineProperty(f,"line",i({},h,{get:function(){return I},set:function(M){if(typeof M!="number"&&M!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");I=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"lineAlign",i({},h,{get:function(){return _},set:function(M){const H=s(M);if(!H)throw new SyntaxError("An invalid or illegal string was specified.");_=H,this.hasBeenReset=!0}})),Object.defineProperty(f,"position",i({},h,{get:function(){return F},set:function(M){if(M<0||M>100)throw new Error("Position must be between 0 and 100.");F=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"positionAlign",i({},h,{get:function(){return C},set:function(M){const H=s(M);if(!H)throw new SyntaxError("An invalid or illegal string was specified.");C=H,this.hasBeenReset=!0}})),Object.defineProperty(f,"size",i({},h,{get:function(){return P},set:function(M){if(M<0||M>100)throw new Error("Size must be between 0 and 100.");P=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"align",i({},h,{get:function(){return O},set:function(M){const H=s(M);if(!H)throw new SyntaxError("An invalid or illegal string was specified.");O=H,this.hasBeenReset=!0}})),f.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o})();class NU{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function fw(n){function e(r,s,i,o){return(r|0)*3600+(s|0)*60+(i|0)+parseFloat(o||0)}const t=n.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class OU{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let s=0;s<r.length;++s)if(t===r[s]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}function hw(n,e,t,r){const s=r?n.split(r):[n];for(const i in s){if(typeof s[i]!="string")continue;const o=s[i].split(t);if(o.length!==2)continue;const l=o[0],u=o[1];e(l,u)}}const Um=new eg(0,0,""),Lc=Um.align==="middle"?"middle":"center";function MU(n,e,t){const r=n;function s(){const l=fw(n);if(l===null)throw new Error("Malformed timestamp: "+r);return n=n.replace(/^[^\sa-zA-Z-]+/,""),l}function i(l,u){const d=new OU;hw(l,function(p,x){let g;switch(p){case"region":for(let E=t.length-1;E>=0;E--)if(t[E].id===x){d.set(p,t[E].region);break}break;case"vertical":d.alt(p,x,["rl","lr"]);break;case"line":g=x.split(","),d.integer(p,g[0]),d.percent(p,g[0])&&d.set("snapToLines",!1),d.alt(p,g[0],["auto"]),g.length===2&&d.alt("lineAlign",g[1],["start",Lc,"end"]);break;case"position":g=x.split(","),d.percent(p,g[0]),g.length===2&&d.alt("positionAlign",g[1],["start",Lc,"end","line-left","line-right","auto"]);break;case"size":d.percent(p,x);break;case"align":d.alt(p,x,["start",Lc,"end","left","right"]);break}},/:/,/\s/),u.region=d.get("region",null),u.vertical=d.get("vertical","");let f=d.get("line","auto");f==="auto"&&Um.line===-1&&(f=-1),u.line=f,u.lineAlign=d.get("lineAlign","start"),u.snapToLines=d.get("snapToLines",!0),u.size=d.get("size",100),u.align=d.get("align",Lc);let h=d.get("position","auto");h==="auto"&&Um.position===50&&(h=u.align==="start"||u.align==="left"?0:u.align==="end"||u.align==="right"?100:50),u.position=h}function o(){n=n.replace(/^\s+/,"")}if(o(),e.startTime=s(),o(),n.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+r);n=n.slice(3),o(),e.endTime=s(),o(),i(n,e)}function mw(n){return n.replace(/<br(?: \/)?>/gi,`
`)}class FU{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new NU,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function r(){let i=t.buffer,o=0;for(i=mw(i);o<i.length&&i[o]!=="\r"&&i[o]!==`
`;)++o;const l=i.slice(0,o);return i[o]==="\r"&&++o,i[o]===`
`&&++o,t.buffer=i.slice(o),l}function s(i){hw(i,function(o,l){},/:/)}try{let i="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;i=r();const l=i.match(/^()?WEBVTT([ \t].*)?$/);if(!(l!=null&&l[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:i=r(),t.state){case"HEADER":/:/.test(i)?s(i):i||(t.state="ID");continue;case"NOTE":i||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){t.state="NOTE";break}if(!i)continue;if(t.cue=new eg(0,0,""),t.state="CUE",i.indexOf("-->")===-1){t.cue.id=i;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{MU(i,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const l=i.indexOf("-->")!==-1;if(!i||l&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=i}continue;case"BADCUE":i||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const BU=/\r\n|\n\r|\n|\r/g,Ph=function(e,t,r=0){return e.slice(r,r+t.length)===t},UU=function(e){let t=parseInt(e.slice(-3));const r=parseInt(e.slice(-6,-4)),s=parseInt(e.slice(-9,-7)),i=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!he(t)||!he(r)||!he(s)||!he(i))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*r,t+=60*1e3*s,t+=3600*1e3*i,t};function tg(n,e,t){return ma(n.toString())+ma(e.toString())+ma(t)}const $U=function(e,t,r){let s=e[t],i=e[s.prevCC];if(!i||!i.new&&s.new){e.ccOffset=e.presentationOffset=s.start,s.new=!1;return}for(;(o=i)!=null&&o.new;){var o;e.ccOffset+=s.start-i.start,s.new=!1,s=i,i=e[s.prevCC]}e.presentationOffset=r};function jU(n,e,t,r,s,i,o){const l=new FU,u=In(new Uint8Array(n)).trim().replace(BU,`
`).split(`
`),d=[],f=e?WF(e.baseTime,e.timescale):0;let h="00:00.000",p=0,x=0,g,E=!0;l.oncue=function(v){const b=t[r];let A=t.ccOffset;const L=(p-f)/9e4;if(b!=null&&b.new&&(x!==void 0?A=t.ccOffset=b.start:$U(t,r,L)),L){if(!e){g=new Error("Missing initPTS for VTT MPEGTS");return}A=L-t.presentationOffset}const I=v.endTime-v.startTime,_=wn((v.startTime+A-x)*9e4,s*9e4)/9e4;v.startTime=Math.max(_,0),v.endTime=Math.max(_+I,0);const F=v.text.trim();v.text=decodeURIComponent(encodeURIComponent(F)),v.id||(v.id=tg(v.startTime,v.endTime,F)),v.endTime>0&&d.push(v)},l.onparsingerror=function(v){g=v},l.onflush=function(){if(g){o(g);return}i(d)},u.forEach(v=>{if(E)if(Ph(v,"X-TIMESTAMP-MAP=")){E=!1,v.slice(16).split(",").forEach(b=>{Ph(b,"LOCAL:")?h=b.slice(6):Ph(b,"MPEGTS:")&&(p=parseInt(b.slice(7)))});try{x=UU(h)/1e3}catch(b){g=b}return}else v===""&&(E=!1);l.parse(v+`
`)}),l.flush()}const Dh="stpp.ttml.im1t",pw=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,gw=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,VU={left:"start",center:"center",right:"end",start:"start",end:"end"};function VS(n,e,t,r){const s=Ue(new Uint8Array(n),["mdat"]);if(s.length===0){r(new Error("Could not parse IMSC1 mdat"));return}const i=s.map(l=>In(l)),o=zF(e.baseTime,1,e.timescale);try{i.forEach(l=>t(GU(l,o)))}catch(l){r(l)}}function GU(n,e){const s=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");const i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(i).reduce((h,p)=>(h[p]=s.getAttribute(`ttp:${p}`)||i[p],h),{}),l=s.getAttribute("xml:space")!=="preserve",u=GS(Nh(s,"styling","style")),d=GS(Nh(s,"layout","region")),f=Nh(s,"body","[begin]");return[].map.call(f,h=>{const p=yw(h,l);if(!p||!h.hasAttribute("begin"))return null;const x=Mh(h.getAttribute("begin"),o),g=Mh(h.getAttribute("dur"),o);let E=Mh(h.getAttribute("end"),o);if(x===null)throw HS(h);if(E===null){if(g===null)throw HS(h);E=x+g}const v=new eg(x-e,E-e,p);v.id=tg(v.startTime,v.endTime,v.text);const b=d[h.getAttribute("region")],A=u[h.getAttribute("style")],L=HU(b,A,u),{textAlign:I}=L;if(I){const _=VU[I];_&&(v.lineAlign=_),v.align=I}return tt(v,L),v}).filter(h=>h!==null)}function Nh(n,e,t){const r=n.getElementsByTagName(e)[0];return r?[].slice.call(r.querySelectorAll(t)):[]}function GS(n){return n.reduce((e,t)=>{const r=t.getAttribute("xml:id");return r&&(e[r]=t),e},{})}function yw(n,e){return[].slice.call(n.childNodes).reduce((t,r,s)=>{var i;return r.nodeName==="br"&&s?t+`
`:(i=r.childNodes)!=null&&i.length?yw(r,e):e?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent},"")}function HU(n,e,t){const r="http://www.w3.org/ns/ttml#styling";let s=null;const i=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=n!=null&&n.hasAttribute("style")?n.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(s=t[o]),i.reduce((l,u)=>{const d=Oh(e,r,u)||Oh(n,r,u)||Oh(s,r,u);return d&&(l[u]=d),l},{})}function Oh(n,e,t){return n&&n.hasAttributeNS(e,t)?n.getAttributeNS(e,t):null}function HS(n){return new Error(`Could not parse ttml timestamp ${n}`)}function Mh(n,e){if(!n)return null;let t=fw(n);return t===null&&(pw.test(n)?t=KU(n,e):gw.test(n)&&(t=zU(n,e))),t}function KU(n,e){const t=pw.exec(n),r=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+r/e.frameRate}function zU(n,e){const t=gw.exec(n),r=Number(t[1]);switch(t[2]){case"h":return r*3600;case"m":return r*60;case"ms":return r*1e3;case"f":return r/e.frameRate;case"t":return r/e.tickRate}return r}class Rc{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class WU{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=zS(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(R.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(R.FRAG_LOADING,this.onFragLoading,this),e.on(R.FRAG_LOADED,this.onFragLoaded,this),e.on(R.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(R.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(R.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(R.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(R.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(R.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(R.FRAG_LOADING,this.onFragLoading,this),e.off(R.FRAG_LOADED,this.onFragLoaded,this),e.off(R.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(R.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(R.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(R.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(R.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Rc(this,"textTrack1"),t=new Rc(this,"textTrack2"),r=new Rc(this,"textTrack3"),s=new Rc(this,"textTrack4");this.cea608Parser1=new jS(1,e,t),this.cea608Parser2=new jS(3,r,s)}addCues(e,t,r,s,i){let o=!1;for(let l=i.length;l--;){const u=i[l],d=YU(u[0],u[1],t,r);if(d>=0&&(u[0]=Math.min(u[0],t),u[1]=Math.max(u[1],r),o=!0,d/(r-t)>.5))return}if(o||i.push([t,r]),this.config.renderTextTracksNatively){const l=this.captionsTracks[e];this.Cues.newCue(l,t,r,s)}else{const l=this.Cues.newCue(null,t,r,s);this.hls.trigger(R.CUES_PARSED,{type:"captions",cues:l,track:e})}}onInitPtsFound(e,{frag:t,id:r,initPTS:s,timescale:i,trackId:o}){const{unparsedVttFrags:l}=this;r===ge.MAIN&&(this.initPTS[t.cc]={baseTime:s,timescale:i,trackId:o}),l.length&&(this.unparsedVttFrags=[],l.forEach(u=>{this.initPTS[u.frag.cc]?this.onFragLoaded(R.FRAG_LOADED,u):this.hls.trigger(R.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:u.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:r}=this;if(r)for(let s=0;s<r.textTracks.length;s++){const i=r.textTracks[s];if(KS(i,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return i}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:r,media:s}=this,{label:i,languageCode:o}=t[e],l=this.getExistingTrack(i,o);if(l)r[e]=l,Hi(r[e]),aw(r[e],s);else{const u=this.createTextTrack("captions",i,o);u&&(u[e]=!0,r[e]=u)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const r=t.label,s={_id:e,label:r,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(R.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(e,t,r){const s=this.media;if(s)return s.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const r=!!t.transferMedia;if(this.media=null,r)return;const{captionsTracks:s}=this;Object.keys(s).forEach(i=>{Hi(s[i]),delete s[i]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=zS(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let r=0;r<t.length;r++)Hi(t[r])}onSubtitleTracksUpdated(e,t){const r=t.subtitleTracks||[],s=r.some(i=>i.textCodec===Dh);if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(Yb(this.tracks,r)){this.tracks=r;return}if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){const o=this.media,l=o?Wc(o.textTracks):null;if(this.tracks.forEach((u,d)=>{let f;if(l){let h=null;for(let p=0;p<l.length;p++)if(l[p]&&KS(l[p],u)){h=l[p],l[p]=null;break}h&&(f=h)}if(f)Hi(f);else{const h=xw(u);f=this.createTextTrack(h,u.name,u.lang),f&&(f.mode="disabled")}f&&this.textTracks.push(f)}),l!=null&&l.length){const u=l.filter(d=>d!==null).map(d=>d.label);u.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${u.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(l=>({label:l.name,kind:l.type.toLowerCase(),default:l.default,subtitleTrack:l}));this.hls.trigger(R.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(r=>{const s=/(?:CC|SERVICE)([1-4])/.exec(r.instreamId);if(!s)return;const i=`textTrack${s[1]}`,o=this.captionsProperties[i];o&&(o.label=r.name,r.lang&&(o.languageCode=r.lang),o.media=r)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t?.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===ge.MAIN){var r,s;const{cea608Parser1:i,cea608Parser2:o,lastSn:l}=this,{cc:u,sn:d}=t.frag,f=(r=(s=t.part)==null?void 0:s.index)!=null?r:-1;i&&o&&(d!==l+1||d===l&&f!==this.lastPartIndex+1||u!==this.lastCc)&&(i.reset(),o.reset()),this.lastCc=u,this.lastSn=d,this.lastPartIndex=f}}onFragLoaded(e,t){const{frag:r,payload:s}=t;if(r.type===ge.SUBTITLE)if(s.byteLength){const i=r.decryptdata,o="stats"in t;if(i==null||!i.encrypted||o){const l=this.tracks[r.level],u=this.vttCCs;u[r.cc]||(u[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),l&&l.textCodec===Dh?this._parseIMSC1(r,s):this._parseVTTs(t)}}else this.hls.trigger(R.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const r=this.hls;VS(t,this.initPTS[e.cc],s=>{this._appendCues(s,e.level),r.trigger(R.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},s=>{r.logger.log(`Failed to parse IMSC1: ${s}`),r.trigger(R.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})}_parseVTTs(e){var t;const{frag:r,payload:s}=e,{initPTS:i,unparsedVttFrags:o}=this,l=i.length-1;if(!i[r.cc]&&l===-1){o.push(e);return}const u=this.hls,d=(t=r.initSegment)!=null&&t.data?$n(r.initSegment.data,new Uint8Array(s)).buffer:s;jU(d,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,f=>{this._appendCues(f,r.level),u.trigger(R.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},f=>{const h=f.message==="Missing initPTS for VTT MPEGTS";h?o.push(e):this._fallbackToIMSC1(r,s),u.logger.log(`Failed to parse VTT cue: ${f}`),!(h&&l>r.cc)&&u.trigger(R.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:f})})}_fallbackToIMSC1(e,t){const r=this.tracks[e.level];r.textCodec||VS(t,this.initPTS[e.cc],()=>{r.textCodec=Dh,this._parseIMSC1(e,t)},()=>{r.textCodec="wvtt"})}_appendCues(e,t){const r=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[t];if(!s||s.mode==="disabled")return;e.forEach(i=>lw(s,i))}else{const s=this.tracks[t];if(!s)return;const i=s.default?"default":"subtitles"+t;r.trigger(R.CUES_PARSED,{type:"subtitles",cues:e,track:i})}}onFragDecrypted(e,t){const{frag:r}=t;r.type===ge.SUBTITLE&&this.onFragLoaded(R.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:r,samples:s}=t;if(!(r.type===ge.MAIN&&this.closedCaptionsForLevel(r)==="NONE"))for(let i=0;i<s.length;i++){const o=s[i].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();const l=this.extractCea608Data(o);this.cea608Parser1.addData(s[i].pts,l[0]),this.cea608Parser2.addData(s[i].pts,l[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:r,endOffsetSubtitles:s,type:i}){const{media:o}=this;if(!(!o||o.currentTime<r)){if(!i||i==="video"){const{captionsTracks:l}=this;Object.keys(l).forEach(u=>Bm(l[u],t,r))}if(this.config.renderTextTracksNatively&&t===0&&s!==void 0){const{textTracks:l}=this;Object.keys(l).forEach(u=>Bm(l[u],t,s))}}}extractCea608Data(e){const t=[[],[]],r=e[0]&31;let s=2;for(let i=0;i<r;i++){const o=e[s++],l=127&e[s++],u=127&e[s++];if(l===0&&u===0)continue;if((4&o)!==0){const f=3&o;(f===0||f===1)&&(t[f].push(l),t[f].push(u))}}return t}}function xw(n){return n.characteristics&&/transcribes-spoken-dialog/gi.test(n.characteristics)&&/describes-music-and-sound/gi.test(n.characteristics)?"captions":"subtitles"}function KS(n,e){return!!n&&n.kind===xw(e)&&Nm(e,n)}function YU(n,e,t,r){return Math.min(e,r)-Math.max(n,t)}function zS(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const qU=/\s/,XU={newCue(n,e,t,r){const s=[];let i,o,l,u,d;const f=self.VTTCue||self.TextTrackCue;for(let p=0;p<r.rows.length;p++)if(i=r.rows[p],l=!0,u=0,d="",!i.isEmpty()){var h;for(let E=0;E<i.chars.length;E++)qU.test(i.chars[E].uchar)&&l?u++:(d+=i.chars[E].uchar,l=!1);i.cueStartTime=e,e===t&&(t+=1e-4),u>=16?u--:u++;const x=mw(d.trim()),g=tg(e,t,x);n!=null&&(h=n.cues)!=null&&h.getCueById(g)||(o=new f(e,t,x),o.id=g,o.line=p+1,o.align="left",o.position=10+Math.min(80,Math.floor(u*8/32)*10),s.push(o))}return n&&s.length&&(s.sort((p,x)=>p.line==="auto"||x.line==="auto"?0:p.line>8&&x.line>8?x.line-p.line:p.line-x.line),s.forEach(p=>lw(n,p))),s}};function QU(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const JU=/(\d+)-(\d+)\/(\d+)/;class WS{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||n$,this.controller=new self.AbortController,this.stats=new Dp}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,r){const s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();const i=ZU(e,this.controller.signal),o=e.responseType==="arraybuffer",l=o?"byteLength":"length",{maxTimeToFirstByteMs:u,maxLoadTimeMs:d}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,i),self.clearTimeout(this.requestTimeout),t.timeout=u&&he(u)?u:d,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},t.timeout),(Ca(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(h=>{var p;this.response=this.loader=h;const x=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=d,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},d-(x-s.loading.start)),!h.ok){const{status:E,statusText:v}=h;throw new r$(v||"fetch, bad network response",E,h)}s.loading.first=x,s.total=t$(h.headers)||s.total;const g=(p=this.callbacks)==null?void 0:p.onProgress;return g&&he(t.highWaterMark)?this.loadProgressively(h,s,e,t.highWaterMark,g):o?h.arrayBuffer():e.responseType==="json"?h.json():h.text()}).then(h=>{var p,x;const g=this.response;if(!g)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);const E=h[l];E&&(s.loaded=s.total=E);const v={url:g.url,data:h,code:g.status},b=(p=this.callbacks)==null?void 0:p.onProgress;b&&!he(t.highWaterMark)&&b(s,e,h,g),(x=this.callbacks)==null||x.onSuccess(v,s,e,g)}).catch(h=>{var p;if(self.clearTimeout(this.requestTimeout),s.aborted)return;const x=h&&h.code||0,g=h?h.message:null;(p=this.callbacks)==null||p.onError({code:x,text:g},e,h?h.details:null,s)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,r,s=0,i){const o=new Ib,l=e.body.getReader(),u=()=>l.read().then(d=>{if(d.done)return o.dataLength&&i(t,r,o.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const f=d.value,h=f.length;return t.loaded+=h,h<s||o.dataLength?(o.push(f),o.dataLength>=s&&i(t,r,o.flush().buffer,e)):i(t,r,f.buffer,e),u()}).catch(()=>Promise.reject());return u()}}function ZU(n,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(tt({},n.headers))};return n.rangeEnd&&t.headers.set("Range","bytes="+n.rangeStart+"-"+String(n.rangeEnd-1)),t}function e$(n){const e=JU.exec(n);if(e)return parseInt(e[2])-parseInt(e[1])+1}function t$(n){const e=n.get("Content-Range");if(e){const r=e$(e);if(he(r))return r}const t=n.get("Content-Length");if(t)return parseInt(t)}function n$(n,e){return new self.Request(n.url,e)}class r$ extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}}const s$=/^age:\s*[\d.]+\s*$/im;class vw{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Dp,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const r=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;const i=this.xhrSetup;i?Promise.resolve().then(()=>{if(!(this.loader!==r||this.stats.aborted))return i(r,t.url)}).catch(o=>{if(!(this.loader!==r||this.stats.aborted))return r.open("GET",t.url,!0),i(r,t.url)}).then(()=>{this.loader!==r||this.stats.aborted||this.openAndSendXhr(r,t,e)}).catch(o=>{var l;(l=this.callbacks)==null||l.onError({code:r.status,text:o.message},t,r,s)}):this.openAndSendXhr(r,t,e)}openAndSendXhr(e,t,r){e.readyState||e.open("GET",t.url,!0);const s=t.headers,{maxTimeToFirstByteMs:i,maxLoadTimeMs:o}=r.loadPolicy;if(s)for(const l in s)e.setRequestHeader(l,s[l]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=i&&he(i)?i:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:r}=this;if(!e||!t)return;const s=t.readyState,i=this.config;if(!r.aborted&&s>=2&&(r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),i.timeout!==i.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),i.timeout=i.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),s===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const d=t.status,f=t.responseType==="text"?t.responseText:null;if(d>=200&&d<300){const g=f??t.response;if(g!=null){var o,l;r.loading.end=Math.max(self.performance.now(),r.loading.first);const E=t.responseType==="arraybuffer"?g.byteLength:g.length;r.loaded=r.total=E,r.bwEstimate=r.total*8e3/(r.loading.end-r.loading.first);const v=(o=this.callbacks)==null?void 0:o.onProgress;v&&v(r,e,g,t);const b={url:t.responseURL,data:g,code:d};(l=this.callbacks)==null||l.onSuccess(b,r,e,t);return}}const h=i.loadPolicy.errorRetry,p=r.retry,x={url:e.url,data:void 0,code:d};if(pu(h,p,!1,x))this.retry(h);else{var u;Ze.error(`${d} while loading ${e.url}`),(u=this.callbacks)==null||u.onError({code:d,text:t.statusText},e,t,r)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(pu(e,t,!0))this.retry(e);else{var r;Ze.warn(`timeout while loading ${(r=this.context)==null?void 0:r.url}`);const s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:r}=this;this.retryDelay=Fp(e,r.retry),r.retry++,Ze.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t?.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&s$.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const i$={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},o$=Je(Je({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:vw,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:xM,bufferController:lB,capLevelController:Qp,errorController:bM,fpsController:cU,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:yb,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:i$},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},a$()),{},{subtitleStreamController:EU,subtitleTrackController:fU,timelineController:WU,audioStreamController:sB,audioTrackController:iB,emeController:Wi,cmcdController:iU,contentSteeringController:aU,interstitialsController:SU});function a$(){return{cueHandler:XU,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function l$(n,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const r=$m(n),s=["manifest","level","frag"],i=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return s.forEach(o=>{const l=`${o==="level"?"playlist":o}LoadPolicy`,u=e[l]===void 0,d=[];i.forEach(f=>{const h=`${o}Loading${f}`,p=e[h];if(p!==void 0&&u){d.push(h);const x=r[l].default;switch(e[l]={default:x},f){case"TimeOut":x.maxLoadTimeMs=p,x.maxTimeToFirstByteMs=p;break;case"MaxRetry":x.errorRetry.maxNumRetry=p,x.timeoutRetry.maxNumRetry=p;break;case"RetryDelay":x.errorRetry.retryDelayMs=p,x.timeoutRetry.retryDelayMs=p;break;case"MaxRetryTimeout":x.errorRetry.maxRetryDelayMs=p,x.timeoutRetry.maxRetryDelayMs=p;break}}}),d.length&&t.warn(`hls.js config: "${d.join('", "')}" setting(s) are deprecated, use "${l}": ${st(e[l])}`)}),Je(Je({},r),e)}function $m(n){return n&&typeof n=="object"?Array.isArray(n)?n.map($m):Object.keys(n).reduce((e,t)=>(e[t]=$m(n[t]),e),{}):n}function c$(n,e){const t=n.loader;t!==WS&&t!==vw?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1):QU()&&(n.loader=WS,n.progressive=!0,n.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const Yc=2,u$=.1,d$=.05,f$=100;class h$ extends fb{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var r;(r=this.media)!=null&&r.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var r;this.ended=((r=this.media)==null?void 0:r.currentTime)||1,this.hls.trigger(R.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(f$),this.mediaSource=t.mediaSource;const r=this.media=t.media;tn(r,"playing",this.onMediaPlaying),tn(r,"waiting",this.onMediaWaiting),tn(r,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:r}=this;r&&(dn(r,"playing",this.onMediaPlaying),dn(r,"waiting",this.onMediaWaiting),dn(r,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var r,s;const i=(r=this.hls)==null?void 0:r.config;if(!i)return;const o=this.media;if(!o)return;const{seeking:l}=o,u=this.seeking&&!l,d=!this.seeking&&l,f=o.paused&&!l||o.ended||o.playbackRate===0;if(this.seeking=l,e!==t){t&&(this.ended=0),this.moved=!0,l||(this.nudgeRetry=0,i.nudgeOnVideoHole&&!f&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(d||u){u&&this.stallResolved(e);return}if(f){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&o.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(R.MEDIA_ENDED,{stalled:!1}));return}if(!Oe.getBuffered(o).length){this.nudgeRetry=0;return}const h=Oe.bufferInfo(o,e,0),p=h.nextStart||0,x=this.fragmentTracker;if(l&&x&&this.hls){const F=YS(this.hls.inFlightFragments,e),C=h.len>Yc,P=!p||F||p-e>Yc&&!x.getPartialFragment(e);if(C||P)return;this.moved=!1}const g=(s=this.hls)==null?void 0:s.latestLevelDetails;if(!this.moved&&this.stalled!==null&&x){if(!(h.len>0)&&!p)return;const C=Math.max(p,h.start||0)-e,O=!!(g!=null&&g.live)?g.targetduration*2:Yc,M=Ic(e,x);if(C>0&&(C<=O||M)){o.paused||this._trySkipBufferHole(M);return}}const E=i.detectStallWithCurrentTimeMs,v=self.performance.now(),b=this.waiting;let A=this.stalled;if(A===null)if(b>0&&v-b<E)A=this.stalled=b;else{this.stalled=v;return}const L=v-A;if(!l&&(L>=E||b)&&this.hls){var I;if(((I=this.mediaSource)==null?void 0:I.readyState)==="ended"&&!(g!=null&&g.live)&&Math.abs(e-(g?.edge||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(R.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(h),!this.media||!this.hls)return}const _=Oe.bufferInfo(o,e,i.maxBufferHole);this._tryFixBufferStall(_,L,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const r=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(r)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(R.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var r;const s=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(r=this.buffered.audio)!=null&&r.length&&s&&s.length>1&&e>s.end(0)){const i=Oe.bufferedInfo(Oe.timeRangesToArray(this.buffered.audio),e,0);if(i.len>1&&t>=i.start){const o=Oe.timeRangesToArray(s),l=Oe.bufferedInfo(o,t,0).bufferedIndex;if(l>-1&&l<o.length-1){const u=Oe.bufferedInfo(o,e,0).bufferedIndex,d=o[l].end,f=o[l+1].start;if((u===-1||u>l)&&f-d<1&&e-d<2){const h=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${d} -> ${f} buffered index: ${u}`);this.warn(h.message),this.media.currentTime+=1e-6;let p=Ic(e,this.fragmentTracker);p&&"fragment"in p?p=p.fragment:p||(p=void 0);const x=Oe.bufferInfo(this.media,e,0);this.hls.trigger(R.ERROR,{type:we.MEDIA_ERROR,details:z.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:h,reason:h.message,frag:p,buffer:x.len,bufferInfo:x})}}}}}_tryFixBufferStall(e,t,r){var s,i;const{fragmentTracker:o,media:l}=this,u=(s=this.hls)==null?void 0:s.config;if(!l||!o||!u)return;const d=(i=this.hls)==null?void 0:i.latestLevelDetails,f=Ic(r,o);if((f||d!=null&&d.live&&r<d.fragmentStart)&&(this._trySkipBufferHole(f)||!this.media))return;const h=e.buffered,p=this.adjacentTraversal(e,r);(h&&h.length>1&&e.len>u.maxBufferHole||e.nextStart&&(e.nextStart-r<u.maxBufferHole||p))&&(t>u.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const r=this.fragmentTracker,s=e.nextStart;if(r&&s){const i=r.getFragAtPos(t,ge.MAIN),o=r.getFragAtPos(s,ge.MAIN);if(i&&o)return o.sn-i.sn<2}return!1}_reportStall(e){const{hls:t,media:r,stallReported:s,stalled:i}=this;if(!s&&i!==null&&r&&t){this.stallReported=!0;const o=new Error(`Playback stalling at @${r.currentTime} due to low buffer (${st(e)})`);this.warn(o.message),t.trigger(R.ERROR,{type:we.MEDIA_ERROR,details:z.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:e.len,bufferInfo:e,stalled:{start:i}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:r,media:s}=this,i=(t=this.hls)==null?void 0:t.config;if(!s||!r||!i)return 0;const o=s.currentTime,l=Oe.bufferInfo(s,o,0),u=o<l.start?l.start:l.nextStart;if(u&&this.hls){const f=l.len<=i.maxBufferHole,h=l.len>0&&l.len<1&&s.readyState<3,p=u-o;if(p>0&&(f||h)){if(p>i.maxBufferHole){let g=!1;if(o===0){const E=r.getAppendedFrag(0,ge.MAIN);E&&u<E.end&&(g=!0)}if(!g&&e){var d;if(!((d=this.hls.loadLevelObj)!=null&&d.details)||YS(this.hls.inFlightFragments,u))return 0;let v=!1,b=e.end;for(;b<u;){const A=Ic(b,r);if(A)b+=A.duration;else{v=!0;break}}if(v)return 0}}const x=Math.max(u+d$,o+u$);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${x}`),this.moved=!0,s.currentTime=x,!(e!=null&&e.gap)){const g=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${x}`),E={type:we.MEDIA_ERROR,details:z.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:g,reason:g.message,buffer:l.len,bufferInfo:l};e&&("fragment"in e?E.part=e:E.frag=e),this.hls.trigger(R.ERROR,E)}return x}}return 0}_tryNudgeBuffer(e){const{hls:t,media:r,nudgeRetry:s}=this,i=t?.config;if(!r||!i)return 0;const o=r.currentTime;if(this.nudgeRetry++,s<i.nudgeMaxRetry){const l=o+(s+1)*i.nudgeOffset,u=new Error(`Nudging 'currentTime' from ${o} to ${l}`);this.warn(u.message),r.currentTime=l,t.trigger(R.ERROR,{type:we.MEDIA_ERROR,details:z.BUFFER_NUDGE_ON_STALL,error:u,fatal:!1,buffer:e.len,bufferInfo:e})}else{const l=new Error(`Playhead still not moving while enough data buffered @${o} after ${i.nudgeMaxRetry} nudges`);this.error(l.message),t.trigger(R.ERROR,{type:we.MEDIA_ERROR,details:z.BUFFER_STALLED_ERROR,error:l,fatal:!0,buffer:e.len,bufferInfo:e})}}}function YS(n,e){const t=qS(n.main);if(t&&t.start<=e)return t;const r=qS(n.audio);return r&&r.start<=e?r:null}function qS(n){if(!n)return null;switch(n.state){case re.IDLE:case re.STOPPED:case re.ENDED:case re.ERROR:return null}return n.frag}function Ic(n,e){return e.getAppendedFrag(n,ge.MAIN)||e.getPartialFragment(n)}const m$=.25;function jm(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Fh(n,e,t,r,s){let i=new n(e,t,"");try{i.value=r,s&&(i.type=s)}catch{i=new n(e,t,st(s?Je({type:s},r):r))}return i}const kc=(()=>{const n=jm();try{n&&new n(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class p${constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(R.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(R.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(R.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(R.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(R.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(R.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(R.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var r;this.media=t.media,((r=t.overrides)==null?void 0:r.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Hi(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const r=e[t];if(r.kind==="metadata"&&r.label==="id3")return aw(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:r,enableID3MetadataCues:s}=this.hls.config;if(!r&&!s)return;const{samples:i}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=jm();if(o)for(let l=0;l<i.length;l++){const u=i[l].type;if(u===Ln.emsg&&!r||!s)continue;const d=Ob(i[l].data),f=i[l].pts;let h=f+i[l].duration;h>kc&&(h=kc),h-f<=0&&(h=f+m$);for(let x=0;x<d.length;x++){const g=d[x];if(!Mb(g)){this.updateId3CueEnds(f,u);const E=Fh(o,f,h,g,u);E&&this.id3Track.addCue(E)}}}}updateId3CueEnds(e,t){var r;const s=(r=this.id3Track)==null?void 0:r.cues;if(s)for(let i=s.length;i--;){const o=s[i];o.type===t&&o.startTime<e&&o.endTime===kc&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:r,type:s}){const{id3Track:i,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:l,enableID3MetadataCues:u}}=o;if(i&&(l||u)){let d;s==="audio"?d=f=>f.type===Ln.audioId3&&u:s==="video"?d=f=>f.type===Ln.emsg&&l:d=f=>f.type===Ln.audioId3&&u||f.type===Ln.emsg&&l,Bm(i,t,r,d)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:r,timelineOffset:s,enableDateRangeMetadataCues:i,interstitialsController:o}=this.hls.config;if(!i)return;const l=jm();if(r&&s&&!o){const{fragmentStart:E,fragmentEnd:v}=e;let b=this.assetCue;b?(b.startTime=E,b.endTime=v):l&&(b=this.assetCue=Fh(l,E,v,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),b&&(b.id=r,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(b),b.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:u}=this,{dateRanges:d}=e,f=Object.keys(d);let h=this.dateRangeCuesAppended;if(u&&t){var p;if((p=u.cues)!=null&&p.length){const E=Object.keys(h).filter(v=>!f.includes(v));for(let v=E.length;v--;){var x;const b=E[v],A=(x=h[b])==null?void 0:x.cues;delete h[b],A&&Object.keys(A).forEach(L=>{const I=A[L];if(I){I.removeEventListener("enter",this.onEventCueEnter);try{u.removeCue(I)}catch{}}})}}else h=this.dateRangeCuesAppended={}}const g=e.fragments[e.fragments.length-1];if(!(f.length===0||!he(g?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let E=0;E<f.length;E++){const v=f[E],b=d[v],A=b.startTime,L=h[v],I=L?.cues||{};let _=L?.durationKnown||!1,F=kc;const{duration:C,endDate:P}=b;if(P&&C!==null)F=A+C,_=!0;else if(b.endOnNext&&!_){const M=f.reduce((H,Z)=>{if(Z!==b.id){const se=d[Z];if(se.class===b.class&&se.startDate>b.startDate&&(!H||b.startDate<H.startDate))return se}return H},null);M&&(F=M.startTime,_=!0)}const O=Object.keys(b.attr);for(let M=0;M<O.length;M++){const H=O[M];if(!MM(H))continue;const Z=I[H];if(Z)_&&!(L!=null&&L.durationKnown)?Z.endTime=F:Math.abs(Z.startTime-A)>.01&&(Z.startTime=A,Z.endTime=F);else if(l){let se=b.attr[H];FM(H)&&(se=z1(se));const ne=Fh(l,A,F,{key:H,data:se},Ln.dateRange);ne&&(ne.id=v,this.id3Track.addCue(ne),I[H]=ne,o&&(H==="X-ASSET-LIST"||H==="X-ASSET-URL")&&ne.addEventListener("enter",this.onEventCueEnter))}}h[v]={cues:I,dateRange:b,durationKnown:_}}}}}class g${constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,r=this.levelDetails;if(!t||!r)return;this.currentTime=t.currentTime;const s=this.computeLatency();if(s===null)return;this._latency=s;const{lowLatencyMode:i,maxLiveSyncPlaybackRate:o}=this.config;if(!i||o===1||!r.live)return;const l=this.targetLatency;if(l===null)return;const u=s-l,d=Math.min(this.maxLatency,l+r.targetduration);if(u<d&&u>.05&&this.forwardBufferLength>1){const h=Math.min(2,Math.max(1,o)),p=Math.round(2/(1+Math.exp(-.75*u-this.edgeStalled))*20)/20,x=Math.min(h,Math.max(1,p));this.changeMediaPlaybackRate(t,x)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:r,targetduration:s}=e,{liveSyncDuration:i,liveSyncDurationCount:o,lowLatencyMode:l}=this.config,u=this.hls.userConfig;let d=l&&r||t;(this._targetLatencyUpdated||u.liveSyncDuration||u.liveSyncDurationCount||d===0)&&(d=i!==void 0?i:o*s);const f=s;return d+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,f)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const r=this.levelDetails;if(r===null)return null;const s=r.edge,i=e-t-this.edgeStalled,o=s-r.totalduration,l=s-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(o,i),l)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(R.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(R.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var r;t.details===z.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(r=this.levelDetails)!=null&&r.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var r,s;e.playbackRate!==t&&((r=this.hls)==null||r.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(s=this.targetLatency)==null?void 0:s.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class y$ extends Xp{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(R.LEVEL_LOADED,this.onLevelLoaded,this),e.on(R.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(R.FRAG_BUFFERED,this.onFragBuffered,this),e.on(R.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(R.LEVEL_LOADED,this.onLevelLoaded,this),e.off(R.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(R.FRAG_BUFFERED,this.onFragBuffered,this),e.off(R.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const r=this.hls.config.preferManagedMediaSource,s=[],i={},o={};let l=!1,u=!1,d=!1;t.levels.forEach(f=>{const h=f.attrs;let{audioCodec:p,videoCodec:x}=f;p&&(f.audioCodec=p=du(p,r)||void 0),x&&(x=f.videoCodec=ZO(x));const{width:g,height:E,unknownCodecs:v}=f,b=v?.length||0;if(l||(l=!!(g&&E)),u||(u=!!x),d||(d=!!p),b||p&&!this.isAudioSupported(p)||x&&!this.isVideoSupported(x)){this.log(`Some or all CODECS not supported "${h.CODECS}"`);return}const{CODECS:A,"FRAME-RATE":L,"HDCP-LEVEL":I,"PATHWAY-ID":_,RESOLUTION:F,"VIDEO-RANGE":C}=h,O=`${`${_||"."}-`}${f.bitrate}-${F}-${L}-${A}-${C}-${I}`;if(i[O])if(i[O].uri!==f.url&&!f.attrs["PATHWAY-ID"]){const M=o[O]+=1;f.attrs["PATHWAY-ID"]=new Array(M+1).join(".");const H=this.createLevel(f);i[O]=H,s.push(H)}else i[O].addGroupId("audio",h.AUDIO),i[O].addGroupId("text",h.SUBTITLES);else{const M=this.createLevel(f);i[O]=M,o[O]=1,s.push(M)}}),this.filterAndSortMediaOptions(s,t,l,u,d)}createLevel(e){const t=new Ra(e),r=e.supplemental;if(r!=null&&r.videoCodec&&!this.isVideoSupported(r.videoCodec)){const s=new Error(`SUPPLEMENTAL-CODECS not supported "${r.videoCodec}"`);this.log(s.message),t.supportedResult=sb(s,[])}return t}isAudioSupported(e){return Aa(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Aa(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,r,s,i){var o;let l=[],u=[],d=e;const f=((o=t.stats)==null?void 0:o.parsing)||{};if((r||s)&&i&&(d=d.filter(({videoCodec:A,videoRange:L,width:I,height:_})=>(!!A||!!(I&&_))&&cM(L))),d.length===0){Promise.resolve().then(()=>{if(this.hls){let A="no level with compatible codecs found in manifest",L=A;t.levels.length&&(L=`one or more CODECS in variant not supported: ${st(t.levels.map(_=>_.attrs.CODECS).filter((_,F,C)=>C.indexOf(_)===F))}`,this.warn(L),A+=` (${L})`);const I=new Error(A);this.hls.trigger(R.ERROR,{type:we.MEDIA_ERROR,details:z.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:I,reason:L})}}),f.end=performance.now();return}t.audioTracks&&(l=t.audioTracks.filter(A=>!A.audioCodec||this.isAudioSupported(A.audioCodec)),XS(l)),t.subtitles&&(u=t.subtitles,XS(u));const h=d.slice(0);d.sort((A,L)=>{if(A.attrs["HDCP-LEVEL"]!==L.attrs["HDCP-LEVEL"])return(A.attrs["HDCP-LEVEL"]||"")>(L.attrs["HDCP-LEVEL"]||"")?1:-1;if(r&&A.height!==L.height)return A.height-L.height;if(A.frameRate!==L.frameRate)return A.frameRate-L.frameRate;if(A.videoRange!==L.videoRange)return fu.indexOf(A.videoRange)-fu.indexOf(L.videoRange);if(A.videoCodec!==L.videoCodec){const I=jv(A.videoCodec),_=jv(L.videoCodec);if(I!==_)return _-I}if(A.uri===L.uri&&A.codecSet!==L.codecSet){const I=uu(A.codecSet),_=uu(L.codecSet);if(I!==_)return _-I}return A.averageBitrate!==L.averageBitrate?A.averageBitrate-L.averageBitrate:0});let p=h[0];if(this.steering&&(d=this.steering.filterParsedLevels(d),d.length!==h.length)){for(let A=0;A<h.length;A++)if(h[A].pathwayId===d[0].pathwayId){p=h[A];break}}this._levels=d;for(let A=0;A<d.length;A++)if(d[A]===p){var x;this._firstLevel=A;const L=p.bitrate,I=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${d.length} level(s) found, first bitrate: ${L}`),((x=this.hls.userConfig)==null?void 0:x.abrEwmaDefaultEstimate)===void 0){const _=Math.min(L,this.hls.config.abrEwmaDefaultEstimateMax);_>I&&I===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=_)}break}const g=i&&!s,E=this.hls.config,v=!!(E.audioStreamController&&E.audioTrackController),b={levels:d,audioTracks:l,subtitleTracks:u,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:i,video:s,altAudio:v&&!g&&l.some(A=>!!A.url)};f.end=performance.now(),this.hls.trigger(R.MANIFEST_PARSED,b)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const f=new Error("invalid level idx"),h=e<0;if(this.hls.trigger(R.ERROR,{type:we.OTHER_ERROR,details:z.LEVEL_SWITCH_ERROR,level:e,fatal:h,error:f,reason:f.message}),h)return;e=Math.min(e,t.length-1)}const r=this.currentLevelIndex,s=this.currentLevel,i=s?s.attrs["PATHWAY-ID"]:void 0,o=t[e],l=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,r===e&&s&&i===l)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${l?" with Pathway "+l:""} from level ${r}${i?" with Pathway "+i:""}`);const u={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(R.LEVEL_SWITCHING,u);const d=o.details;if(!d||d.live){const f=this.switchParams(o.uri,s?.details,d);this.loadPlaylist(f)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),r=e.filter(s=>t.indexOf(s)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=r}}onError(e,t){t.fatal||!t.context||t.context.type===Ge.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===ge.MAIN){const r=t.elementaryStreams;if(!Object.keys(r).some(i=>!!r[i]))return;const s=this._levels[t.level];s!=null&&s.loadError&&(this.log(`Resetting level error count of ${s.loadError} on frag buffered`),s.loadError=0)}}onLevelLoaded(e,t){var r;const{level:s,details:i}=t,o=t.levelInfo;if(!o){var l;this.warn(`Invalid level index ${s}`),(l=t.deliveryDirectives)!=null&&l.skip&&(i.deltaUpdateFailed=!0);return}if(o===this.currentLevel||t.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let u=o.details;u===t.details&&u.advanced&&(u=void 0),this.playlistLoaded(s,t,u)}else(r=t.deliveryDirectives)!=null&&r.skip&&(i.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=this.getUrlWithDirectives(e.uri,t),s=this.currentLevelIndex,i=e.attrs["PATHWAY-ID"],o=e.details,l=o?.age;this.log(`Loading level index ${s}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${i?" Pathway "+i:""}${l&&o.live?" age "+l.toFixed(1)+(o.type&&" "+o.type||""):""} ${r}`),this.hls.trigger(R.LEVEL_LOADING,{url:r,level:s,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const r=this._levels.filter((i,o)=>o!==e?!0:(this.steering&&this.steering.removeLevel(i),i===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,i.details&&i.details.fragments.forEach(l=>l.level=-1)),!1));Ab(r),this._levels=r,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const s=r.length-1;this._firstLevel=Math.min(this._firstLevel,s),this._startLevel&&(this._startLevel=Math.min(this._startLevel,s)),this.hls.trigger(R.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:r}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(R.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:r}))}}function XS(n){const e={};n.forEach(t=>{const r=t.groupId||"";t.id=e[r]=e[r]||0,e[r]++})}function Sw(){return self.SourceBuffer||self.WebKitSourceBuffer}function Ew(){if(!Rs())return!1;const e=Sw();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function x$(){if(!Ew())return!1;const n=Rs();return typeof n?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>n.isTypeSupported(La(e,"video")))||["mp4a.40.2","fLaC"].some(e=>n.isTypeSupported(La(e,"audio"))))}function v$(){var n;const e=Sw();return typeof(e==null||(n=e.prototype)==null?void 0:n.changeType)=="function"}const S$=100;class E$ extends Vp{constructor(e,t,r){super(e,t,r,"stream-controller",ge.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const s=this.media,i=s?s.currentTime:null;if(i===null||!he(i)||(this.log(`Media seeked to ${i.toFixed(3)}`),!this.getBufferedFrag(i)))return;const o=this.getFwdBufferInfoAtPos(s,i,ge.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${i} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(R.MANIFEST_PARSED,this.onManifestParsed,this),e.on(R.LEVEL_LOADING,this.onLevelLoading,this),e.on(R.LEVEL_LOADED,this.onLevelLoaded,this),e.on(R.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(R.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(R.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(R.BUFFER_CREATED,this.onBufferCreated,this),e.on(R.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(R.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(R.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(R.MANIFEST_PARSED,this.onManifestParsed,this),e.off(R.LEVEL_LOADED,this.onLevelLoaded,this),e.off(R.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(R.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(R.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(R.BUFFER_CREATED,this.onBufferCreated,this),e.off(R.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(R.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(R.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:r,hls:s}=this;if(this.stopLoad(),this.setInterval(S$),this.level=-1,!this.startFragRequested){let i=s.startLevel;i===-1&&(s.config.testBandwidth&&this.levels.length>1?(i=0,this.bitrateTest=!0):i=s.firstAutoLevel),s.nextLoadLevel=i,this.level=s.loadLevel,this._hasEnoughToStart=!!t}r>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r),this.state=re.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=re.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case re.WAITING_LEVEL:{const{levels:e,level:t}=this,r=e?.[t],s=r?.details;if(s&&(!s.live||this.levelLastLoaded===r&&!this.waitForLive(r))){if(this.waitForCdnTuneIn(s))break;this.state=re.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=re.IDLE;break}break}case re.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===re.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:r,media:s}=this;if(t===null||!s&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const i=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(r!=null&&r[i]))return;const o=r[i],l=this.getMainFwdBufferInfo();if(l===null)return;const u=this.getLevelDetails();if(u&&this._streamEnded(l,u)){const E={};this.altAudio===2&&(E.type="video"),this.hls.trigger(R.BUFFER_EOS,E),this.state=re.ENDED;return}if(!this.buffering)return;e.loadLevel!==i&&e.manualLevel===-1&&this.log(`Adapting to level ${i} from level ${this.level}`),this.level=e.nextLoadLevel=i;const d=o.details;if(!d||this.state===re.WAITING_LEVEL||this.waitForLive(o)){this.level=i,this.state=re.WAITING_LEVEL,this.startFragRequested=!1;return}const f=l.len,h=this.getMaxBufferLength(o.maxBitrate);if(f>=h)return;this.backtrackFragment&&this.backtrackFragment.start>l.end&&(this.backtrackFragment=null);const p=this.backtrackFragment?this.backtrackFragment.start:l.end;let x=this.getNextFragment(p,d);if(this.couldBacktrack&&!this.fragPrevious&&x&&Tt(x)&&this.fragmentTracker.getState(x)!==Ct.OK){var g;const v=((g=this.backtrackFragment)!=null?g:x).sn-d.startSN,b=d.fragments[v-1];b&&x.cc===b.cc&&(x=b,this.fragmentTracker.removeFragment(b))}else this.backtrackFragment&&l.len&&(this.backtrackFragment=null);if(x&&this.isLoopLoading(x,p)){if(!x.gap){const v=this.audioOnly&&!this.altAudio?rt.AUDIO:rt.VIDEO,b=(v===rt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;b&&this.afterBufferFlushed(b,v,ge.MAIN)}x=this.getNextFragmentLoopLoading(x,d,l,ge.MAIN,h)}x&&(x.initSegment&&!x.initSegment.data&&!this.bitrateTest&&(x=x.initSegment),this.loadFragment(x,o,p))}loadFragment(e,t,r){const s=this.fragmentTracker.getState(e);s===Ct.NOT_LOADED||s===Ct.PARTIAL?Tt(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,r):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,ge.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let r;const s=this.getAppendedFrag(t.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);const i=this.getLevelDetails();if(i!=null&&i.live){const l=this.getMainFwdBufferInfo();if(!l||l.len<i.targetduration*2)return}if(!t.paused&&e){const l=this.hls.nextLoadLevel,u=e[l],d=this.fragLastKbps;d&&this.fragCurrent?r=this.fragCurrent.duration*u.maxBitrate/(1e3*d)+1:r=0}else r=0;const o=this.getBufferedFrag(t.currentTime+r);if(o){const l=this.followingBufferedFrag(o);if(l){this.abortCurrentFrag();const u=l.maxStartPTS?l.maxStartPTS:l.start,d=l.duration,f=Math.max(o.end,u+Math.min(Math.max(d-this.config.maxFragLookUpTolerance,d*(this.couldBacktrack?.5:.125)),d*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(f,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case re.KEY_LOADING:case re.FRAG_LOADING:case re.FRAG_LOADING_WAITING_RETRY:case re.PARSING:case re.PARSED:this.state=re.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const r=t.media;tn(r,"playing",this.onMediaPlaying),tn(r,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:r}=this;r&&(dn(r,"playing",this.onMediaPlaying),dn(r,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(R.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let r=!1,s=!1;for(let i=0;i<t.levels.length;i++){const o=t.levels[i].audioCodec;o&&(r=r||o.indexOf("mp4a.40.2")!==-1,s=s||o.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=r&&s&&!v$(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:r}=this;if(!r||this.state!==re.IDLE)return;const s=t.levelInfo;(!s.details||s.details.live&&(this.levelLastLoaded!==s||s.details.expired)||this.waitForCdnTuneIn(s.details))&&(this.state=re.WAITING_LEVEL)}onLevelLoaded(e,t){var r;const{levels:s,startFragRequested:i}=this,o=t.level,l=t.details,u=l.totalduration;if(!s){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${l.startSN},${l.endSN}]${l.lastPartSn?`[part-${l.lastPartSn}-${l.lastPartIndex}]`:""}, cc [${l.startCC}, ${l.endCC}] duration:${u}`);const d=t.levelInfo,f=this.fragCurrent;f&&(this.state===re.FRAG_LOADING||this.state===re.FRAG_LOADING_WAITING_RETRY)&&f.level!==t.level&&f.loader&&this.abortCurrentFrag();let h=0;if(l.live||(r=d.details)!=null&&r.live){var p;if(this.checkLiveUpdate(l),l.deltaUpdateFailed)return;h=this.alignPlaylists(l,d.details,(p=this.levelLastLoaded)==null?void 0:p.details)}if(d.details=l,this.levelLastLoaded=d,i||this.setStartPosition(l,h),this.hls.trigger(R.LEVEL_UPDATED,{details:l,level:o}),this.state===re.WAITING_LEVEL){if(this.waitForCdnTuneIn(l))return;this.state=re.IDLE}i&&l.live&&this.synchronizeToLiveEdge(l),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:r}=this;if(!r)return;const s=this.hls.liveSyncPosition,i=this.getLoadPosition(),o=e.fragmentStart,l=e.edge,u=i>=o-t.maxFragLookUpTolerance&&i<=l;if(s!==null&&r.duration>s&&(i<s||!u)){const f=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!u&&r.readyState<4||i<l-f)&&(this._hasEnoughToStart||(this.nextLoadPosition=s),r.readyState))if(this.warn(`Playback: ${i.toFixed(3)} is located too far from the end of live sliding playlist: ${l}, reset currentTime to : ${s.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var d;const h=Oe.bufferInfo(r,s,0);if(!((d=h.buffered)!=null&&d.length)){r.currentTime=s;return}if(h.start<=i){r.currentTime=s;return}const{nextStart:x}=Oe.bufferedInfo(h.buffered,i,0);x&&(r.currentTime=x)}else r.currentTime=s}}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:s,payload:i}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const l=o[r.level];if(!l){this.warn(`Level ${r.level} not found on progress`);return}const u=l.details;if(!u){this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),this.fragmentTracker.removeFragment(r);return}const d=l.videoCodec,f=u.PTSKnown||!u.live,h=(t=r.initSegment)==null?void 0:t.data,p=this._getAudioCodec(l),x=this.transmuxer=this.transmuxer||new Wb(this.hls,ge.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),g=s?s.index:-1,E=g!==-1,v=new Up(r.level,r.sn,r.stats.chunkCount,i.byteLength,g,E),b=this.initPTS[r.cc];x.push(i,h,p,d,r,s,u.totalduration,f,v,b)}onAudioTrackSwitching(e,t){const r=this.hls,s=this.altAudio!==0;if(hu(t.url,r))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(s){this.altAudio=0,this.fragmentTracker.removeAllFragments(),r.once(R.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(R.AUDIO_TRACK_SWITCHED,t)}),r.trigger(R.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}r.trigger(R.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const r=hu(t.url,this.hls);if(r){const s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=r?2:0,this.tick()}onBufferCreated(e,t){const r=t.tracks;let s,i,o=!1;for(const l in r){const u=r[l];if(u.id==="main"){if(i=l,s=u,l==="video"){const d=r[l];d&&(this.videoBuffer=d.buffer)}}else o=!0}o&&s?(this.log(`Alternate track found, use ${i}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:r,part:s}=t,i=r.type===ge.MAIN;if(i){if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${s?" p: "+s.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),this.state===re.PARSED&&(this.state=re.IDLE);return}const l=s?s.stats:r.stats;this.fragLastKbps=Math.round(8*l.total/(l.buffering.end-l.loading.first)),Tt(r)&&(this.fragPrevious=r),this.fragBufferedComplete(r,s)}const o=this.media;o&&(!this._hasEnoughToStart&&Oe.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),i&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var r;if(t.fatal){this.state=re.ERROR;return}switch(t.details){case z.FRAG_GAP:case z.FRAG_PARSING_ERROR:case z.FRAG_DECRYPT_ERROR:case z.FRAG_LOAD_ERROR:case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_ERROR:case z.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ge.MAIN,t);break;case z.LEVEL_LOAD_ERROR:case z.LEVEL_LOAD_TIMEOUT:case z.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===re.WAITING_LEVEL&&((r=t.context)==null?void 0:r.type)===Ge.LEVEL&&(this.state=re.IDLE);break;case z.BUFFER_ADD_CODEC_ERROR:case z.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case z.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case z.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=re.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==rt.AUDIO||!this.altAudio){const r=(t===rt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;r&&(this.afterBufferFlushed(r,t,ge.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let r=this.startPosition;if(r>=0&&t<r){if(e.seeking){this.log(`could not seek to ${r}, already seeking at ${t}`);return}const s=this.timelineOffset;s&&r&&(r+=s);const i=this.getLevelDetails(),o=Oe.getBuffered(e),l=o.length?o.start(0):0,u=l-r,d=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||u>0&&(u<d||this.loadingParts&&u<2*(i?.partTarget||0)))&&(this.log(`adjusting start position by ${u} to match buffer start`),r+=u,this.startPosition=r),t<r&&(this.log(`seek to target start position ${r} from current time ${t} buffer start ${l}`),e.currentTime=r)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(r=>{const{hls:s}=this,i=r?.frag;if(!i||this.fragContextChanged(i))return;t.fragmentError=0,this.state=re.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=i.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),s.trigger(R.FRAG_LOADED,r),i.bitrateTest=!1}).catch(r=>{this.state===re.STOPPED||this.state===re.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:r}=this,{remuxResult:s,chunkMeta:i}=e,o=this.getCurrentContext(i);if(!o){this.resetWhenMissingContext(i);return}const{frag:l,part:u,level:d}=o,{video:f,text:h,id3:p,initSegment:x}=s,{details:g}=d,E=this.altAudio?void 0:s.audio;if(this.fragContextChanged(l)){this.fragmentTracker.removeFragment(l);return}if(this.state=re.PARSING,x){const v=x.tracks;if(v){const I=l.initSegment||l;if(this.unhandledEncryptionError(x,l))return;this._bufferInitSegment(d,v,I,i),r.trigger(R.FRAG_PARSING_INIT_SEGMENT,{frag:I,id:t,tracks:v})}const b=x.initPTS,A=x.timescale,L=this.initPTS[l.cc];if(he(b)&&(!L||L.baseTime!==b||L.timescale!==A)){const I=x.trackId;this.initPTS[l.cc]={baseTime:b,timescale:A,trackId:I},r.trigger(R.INIT_PTS_FOUND,{frag:l,id:t,initPTS:b,timescale:A,trackId:I})}}if(f&&g){E&&f.type==="audiovideo"&&this.logMuxedErr(l);const v=g.fragments[l.sn-1-g.startSN],b=l.sn===g.startSN,A=!v||l.cc>v.cc;if(s.independent!==!1){const{startPTS:L,endPTS:I,startDTS:_,endDTS:F}=f;if(u)u.elementaryStreams[f.type]={startPTS:L,endPTS:I,startDTS:_,endDTS:F};else if(f.firstKeyFrame&&f.independent&&i.id===1&&!A&&(this.couldBacktrack=!0),f.dropped&&f.independent){const C=this.getMainFwdBufferInfo(),P=(C?C.end:this.getLoadPosition())+this.config.maxBufferHole,O=f.firstKeyFramePTS?f.firstKeyFramePTS:L;if(!b&&P<O-this.config.maxBufferHole&&!A){this.backtrack(l);return}else A&&(l.gap=!0);l.setElementaryStreamInfo(f.type,l.start,I,l.start,F,!0)}else b&&L-(g.appliedTimelineOffset||0)>Yc&&(l.gap=!0);l.setElementaryStreamInfo(f.type,L,I,_,F),this.backtrackFragment&&(this.backtrackFragment=l),this.bufferFragmentData(f,l,u,i,b||A)}else if(b||A)l.gap=!0;else{this.backtrack(l);return}}if(E){const{startPTS:v,endPTS:b,startDTS:A,endDTS:L}=E;u&&(u.elementaryStreams[rt.AUDIO]={startPTS:v,endPTS:b,startDTS:A,endDTS:L}),l.setElementaryStreamInfo(rt.AUDIO,v,b,A,L),this.bufferFragmentData(E,l,u,i)}if(g&&p!=null&&p.samples.length){const v={id:t,frag:l,details:g,samples:p.samples};r.trigger(R.FRAG_PARSING_METADATA,v)}if(g&&h){const v={id:t,frag:l,details:g,samples:h.samples};r.trigger(R.FRAG_PARSING_USERDATA,v)}}logMuxedErr(e){this.warn(`${Tt(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,r,s){if(this.state!==re.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(r));const{audio:i,video:o,audiovideo:l}=t;if(i){const d=e.audioCodec;let f=jc(i.codec,d);f==="mp4a"&&(f="mp4a.40.5");const h=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){f&&(f.indexOf("mp4a.40.5")!==-1?f="mp4a.40.2":f="mp4a.40.5");const p=i.metadata;p&&"channelCount"in p&&(p.channelCount||1)!==1&&h.indexOf("firefox")===-1&&(f="mp4a.40.5")}f&&f.indexOf("mp4a.40.5")!==-1&&h.indexOf("android")!==-1&&i.container!=="audio/mpeg"&&(f="mp4a.40.2",this.log(`Android: force audio codec to ${f}`)),d&&d!==f&&this.log(`Swapping manifest audio codec "${d}" for "${f}"`),i.levelCodec=f,i.id=ge.MAIN,this.log(`Init audio buffer, container:${i.container}, codecs[selected/level/parsed]=[${f||""}/${d||""}/${i.codec}]`),delete t.audiovideo}if(o){o.levelCodec=e.videoCodec,o.id=ge.MAIN;const d=o.codec;if(d?.length===4)switch(d){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${d}]${o.codec!==d?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete t.audiovideo}l&&(this.log(`Init audiovideo buffer, container:${l.container}, codecs[level/parsed]=[${e.codecs}/${l.codec}]`),delete t.video,delete t.audio);const u=Object.keys(t);if(u.length){if(this.hls.trigger(R.BUFFER_CODECS,t),!this.hls)return;u.forEach(d=>{const h=t[d].initSegment;h!=null&&h.byteLength&&this.hls.trigger(R.BUFFER_APPENDING,{type:d,data:h,frag:r,part:null,chunkMeta:s,parent:r.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,ge.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,r=e?.[t];return r?this.getMaxBufferLength(r.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=re.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const r=e.currentTime;if(Oe.isBuffered(e,r)?t=this.getAppendedFrag(r):Oe.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;const s=this.fragPlaying,i=t.level;(!s||t.sn!==s.sn||s.level!==i)&&(this.fragPlaying=t,this.hls.trigger(R.FRAG_CHANGED,{frag:t}),(!s||s.level!==i)&&this.hls.trigger(R.LEVEL_SWITCHED,{level:i}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return he(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(he(t)){const r=this.getLevelDetails(),s=this.currentFrag||(r?oi(null,r.fragments,t):null);if(s){const i=s.programDateTime;if(i!==null){const o=i+(t-s.start)*1e3;return new Date(o)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class T$ extends Vn{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const r in this.keyIdToKeyInfo){const s=this.keyIdToKeyInfo[r].loader;if(s){var t;if(e&&e!==((t=s.context)==null?void 0:t.frag.type))return;s.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=z.KEY_LOAD_ERROR,r,s,i){return new Fr({type:we.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:i,error:r,networkDetails:s})}loadClear(e,t,r){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let s=0,i=t.length;s<i;s++){const o=t[s];if(e.cc<=o.cc&&(!Tt(e)||!Tt(o)||e.sn<o.sn)||!r&&s==i-1)return this.emeController.selectKeySystemFormat(o).then(l=>{if(!this.emeController)return;o.setKeyFormat(l);const u=Gc(l);if(u)return this.emeController.getKeySystemAccess([u])})}if(this.config.requireKeySystemAccessOnStart){const s=ia(this.config);if(s.length)return this.emeController.getKeySystemAccess(s)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var r,s;t&&e.setKeyFormat(t);const i=e.decryptdata;if(!i){const d=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,z.KEY_LOAD_ERROR,d))}const o=i.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,z.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));const l=Bh(i);let u=this.keyIdToKeyInfo[l];if((r=u)!=null&&r.decryptdata.key)return i.key=u.decryptdata.key,Promise.resolve({frag:e,keyInfo:u});if(this.emeController&&(s=u)!=null&&s.keyLoadPromise)switch(this.emeController.getKeyStatus(u.decryptdata)){case"usable":case"usable-in-future":return u.keyLoadPromise.then(f=>{const{keyInfo:h}=f;return i.key=h.decryptdata.key,{frag:e,keyInfo:h}})}switch(this.log(`${this.keyIdToKeyInfo[l]?"Rel":"L"}oading${i.keyId?" keyId: "+$t(i.keyId):""} URI: ${i.uri} from ${e.type} ${e.level}`),u=this.keyIdToKeyInfo[l]={decryptdata:i,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},i.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return i.keyFormat==="identity"?this.loadKeyHTTP(u,e):this.loadKeyEME(u,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(u,e);default:return Promise.reject(this.createKeyLoadError(e,z.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${i.method}"`)))}}loadKeyEME(e,t){const r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var s;if(!e.decryptdata.keyId&&(s=t.initSegment)!=null&&s.data){const o=jO(t.initSegment.data);if(o.length){let l=o[0];l.some(u=>u!==0)?(this.log(`Using keyId found in init segment ${$t(l)}`),bs.setKeyIdForUri(e.decryptdata.uri,l)):(l=bs.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${$t(l)}`)),e.decryptdata.keyId=l}}if(!e.decryptdata.keyId&&!Tt(t))return Promise.resolve(r);const i=this.emeController.loadKey(r);return(e.keyLoadPromise=i.then(o=>(e.mediaKeySessionContext=o,r))).catch(o=>{throw e.keyLoadPromise=null,"data"in o&&(o.data.frag=t),o})}return Promise.resolve(r)}loadKeyHTTP(e,t){const r=this.config,s=r.loader,i=new s(r);return t.keyLoader=e.loader=i,e.keyLoadPromise=new Promise((o,l)=>{const u={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},d=r.keyLoadPolicy.default,f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:(p,x,g,E)=>{const{frag:v,keyInfo:b}=g,A=Bh(b.decryptdata);if(!v.decryptdata||b!==this.keyIdToKeyInfo[A])return l(this.createKeyLoadError(v,z.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),E));b.decryptdata.key=v.decryptdata.key=new Uint8Array(p.data),v.keyLoader=null,b.loader=null,o({frag:v,keyInfo:b})},onError:(p,x,g,E)=>{this.resetLoader(x),l(this.createKeyLoadError(t,z.KEY_LOAD_ERROR,new Error(`HTTP Error ${p.code} loading key ${p.text}`),g,Je({url:u.url,data:void 0},p)))},onTimeout:(p,x,g)=>{this.resetLoader(x),l(this.createKeyLoadError(t,z.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),g))},onAbort:(p,x,g)=>{this.resetLoader(x),l(this.createKeyLoadError(t,z.INTERNAL_ABORTED,new Error("key loading aborted"),g))}};i.load(u,f,h)})}resetLoader(e){const{frag:t,keyInfo:r,url:s}=e,i=r.loader;t.keyLoader===i&&(t.keyLoader=null,r.loader=null);const o=Bh(r.decryptdata)||s;delete this.keyIdToKeyInfo[o],i&&i.destroy()}}function Bh(n){if(n.keyFormat!==jt.FAIRPLAY){const e=n.keyId;if(e)return $t(e)}return n.uri}function QS(n){const{type:e}=n;switch(e){case Ge.AUDIO_TRACK:return ge.AUDIO;case Ge.SUBTITLE_TRACK:return ge.SUBTITLE;default:return ge.MAIN}}function Uh(n,e){let t=n.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class b${constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.LEVEL_LOADING,this.onLevelLoading,this),e.on(R.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(R.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(R.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.LEVEL_LOADING,this.onLevelLoading,this),e.off(R.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(R.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(R.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,r=t.pLoader,s=t.loader,i=r||s,o=new i(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:r}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Ge.MANIFEST,url:r,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:r,level:s,pathwayId:i,url:o,deliveryDirectives:l,levelInfo:u}=t;this.load({id:r,level:s,pathwayId:i,responseType:"text",type:Ge.LEVEL,url:o,deliveryDirectives:l,levelOrTrack:u})}onAudioTrackLoading(e,t){const{id:r,groupId:s,url:i,deliveryDirectives:o,track:l}=t;this.load({id:r,groupId:s,level:null,responseType:"text",type:Ge.AUDIO_TRACK,url:i,deliveryDirectives:o,levelOrTrack:l})}onSubtitleTrackLoading(e,t){const{id:r,groupId:s,url:i,deliveryDirectives:o,track:l}=t;this.load({id:r,groupId:s,level:null,responseType:"text",type:Ge.SUBTITLE_TRACK,url:i,deliveryDirectives:o,levelOrTrack:l})}onLevelsUpdated(e,t){const r=this.loaders[Ge.LEVEL];if(r){const s=r.context;s&&!t.levels.some(i=>i===s.levelOrTrack)&&(r.abort(),delete this.loaders[Ge.LEVEL])}}load(e){var t;const r=this.hls.config;let s=this.getInternalLoader(e);if(s){const d=this.hls.logger,f=s.context;if(f&&f.levelOrTrack===e.levelOrTrack&&(f.url===e.url||f.deliveryDirectives&&!e.deliveryDirectives)){f.url===e.url?d.log(`[playlist-loader]: ignore ${e.url} ongoing request`):d.log(`[playlist-loader]: ignore ${e.url} in favor of ${f.url}`);return}d.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),s.abort()}let i;if(e.type===Ge.MANIFEST?i=r.manifestLoadPolicy.default:i=tt({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),he((t=e.deliveryDirectives)==null?void 0:t.part)){let d;if(e.type===Ge.LEVEL&&e.level!==null?d=this.hls.levels[e.level].details:e.type===Ge.AUDIO_TRACK&&e.id!==null?d=this.hls.audioTracks[e.id].details:e.type===Ge.SUBTITLE_TRACK&&e.id!==null&&(d=this.hls.subtitleTracks[e.id].details),d){const f=d.partTarget,h=d.targetduration;if(f&&h){const p=Math.max(f*3,h*.8)*1e3;i=tt({},i,{maxTimeToFirstByteMs:Math.min(p,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(p,i.maxTimeToFirstByteMs)})}}}const o=i.errorRetry||i.timeoutRetry||{},l={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},u={onSuccess:(d,f,h,p)=>{const x=this.getInternalLoader(h);this.resetInternalLoader(h.type);const g=d.data;f.parsing.start=performance.now(),xr.isMediaPlaylist(g)||h.type!==Ge.MANIFEST?this.handleTrackOrLevelPlaylist(d,f,h,p||null,x):this.handleMasterPlaylist(d,f,h,p)},onError:(d,f,h,p)=>{this.handleNetworkError(f,h,!1,d,p)},onTimeout:(d,f,h)=>{this.handleNetworkError(f,h,!0,void 0,d)}};s.load(e,l,u)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:r}=this.hls;(e||r)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,r,s){const i=this.hls,o=e.data,l=Uh(e,r),u=xr.parseMasterPlaylist(o,l);if(u.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,r,u.playlistParsingError,s,t);return}const{contentSteering:d,levels:f,sessionData:h,sessionKeys:p,startTimeOffset:x,variableList:g}=u;this.variableList=g,f.forEach(A=>{const{unknownCodecs:L}=A;if(L){const{preferManagedMediaSource:I}=this.hls.config;let{audioCodec:_,videoCodec:F}=A;for(let C=L.length;C--;){const P=L[C];Aa(P,"audio",I)?(A.audioCodec=_=_?`${_},${P}`:P,Ji.audio[_.substring(0,4)]=2,L.splice(C,1)):Aa(P,"video",I)&&(A.videoCodec=F=F?`${F},${P}`:P,Ji.video[F.substring(0,4)]=2,L.splice(C,1))}}});const{AUDIO:E=[],SUBTITLES:v,"CLOSED-CAPTIONS":b}=xr.parseMasterPlaylistMedia(o,l,u);E.length&&!E.some(L=>!L.url)&&f[0].audioCodec&&!f[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),E.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new ft({}),bitrate:0,url:""})),i.trigger(R.MANIFEST_LOADED,{levels:f,audioTracks:E,subtitles:v,captions:b,contentSteering:d,url:l,stats:t,networkDetails:s,sessionData:h,sessionKeys:p,startTimeOffset:x,variableList:g})}handleTrackOrLevelPlaylist(e,t,r,s,i){const o=this.hls,{id:l,level:u,type:d}=r,f=Uh(e,r),h=he(u)?u:he(l)?l:0,p=QS(r),x=xr.parseLevelPlaylist(e.data,f,h,p,0,this.variableList);if(d===Ge.MANIFEST){const g={attrs:new ft({}),bitrate:0,details:x,name:"",url:f};x.requestScheduled=t.loading.start+Tb(x,0),o.trigger(R.MANIFEST_LOADED,{levels:[g],audioTracks:[],url:f,stats:t,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=x,this.handlePlaylistLoaded(x,e,t,r,s,i)}handleManifestParsingError(e,t,r,s,i){this.hls.trigger(R.ERROR,{type:we.NETWORK_ERROR,details:z.MANIFEST_PARSING_ERROR,fatal:t.type===Ge.MANIFEST,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:s,stats:i})}handleNetworkError(e,t,r=!1,s,i){let o=`A network ${r?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${e.type}`;e.type===Ge.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===Ge.AUDIO_TRACK||e.type===Ge.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const l=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let u=z.UNKNOWN,d=!1;const f=this.getInternalLoader(e);switch(e.type){case Ge.MANIFEST:u=r?z.MANIFEST_LOAD_TIMEOUT:z.MANIFEST_LOAD_ERROR,d=!0;break;case Ge.LEVEL:u=r?z.LEVEL_LOAD_TIMEOUT:z.LEVEL_LOAD_ERROR,d=!1;break;case Ge.AUDIO_TRACK:u=r?z.AUDIO_TRACK_LOAD_TIMEOUT:z.AUDIO_TRACK_LOAD_ERROR,d=!1;break;case Ge.SUBTITLE_TRACK:u=r?z.SUBTITLE_TRACK_LOAD_TIMEOUT:z.SUBTITLE_LOAD_ERROR,d=!1;break}f&&this.resetInternalLoader(e.type);const h={type:we.NETWORK_ERROR,details:u,fatal:d,url:e.url,loader:f,context:e,error:l,networkDetails:t,stats:i};if(s){const p=t?.url||e.url;h.response=Je({url:p,data:void 0},s)}this.hls.trigger(R.ERROR,h)}handlePlaylistLoaded(e,t,r,s,i,o){const l=this.hls,{type:u,level:d,levelOrTrack:f,id:h,groupId:p,deliveryDirectives:x}=s,g=Uh(t,s),E=QS(s);let v=typeof s.level=="number"&&E===ge.MAIN?d:void 0;const b=e.playlistParsingError;if(b){if(this.hls.logger.warn(`${b} ${e.url}`),!l.config.ignorePlaylistParsingErrors){l.trigger(R.ERROR,{type:we.NETWORK_ERROR,details:z.LEVEL_PARSING_ERROR,fatal:!1,url:g,error:b,reason:b.message,response:t,context:s,level:v,parent:E,networkDetails:i,stats:r});return}e.playlistParsingError=null}if(!e.fragments.length){const A=e.playlistParsingError=new Error("No Segments found in Playlist");l.trigger(R.ERROR,{type:we.NETWORK_ERROR,details:z.LEVEL_EMPTY_ERROR,fatal:!1,url:g,error:A,reason:A.message,response:t,context:s,level:v,parent:E,networkDetails:i,stats:r});return}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),u){case Ge.MANIFEST:case Ge.LEVEL:if(v){if(!f)v=0;else if(f!==l.levels[v]){const A=l.levels.indexOf(f);A>-1&&(v=A)}}l.trigger(R.LEVEL_LOADED,{details:e,levelInfo:f||l.levels[0],level:v||0,id:h||0,stats:r,networkDetails:i,deliveryDirectives:x,withoutMultiVariant:u===Ge.MANIFEST});break;case Ge.AUDIO_TRACK:l.trigger(R.AUDIO_TRACK_LOADED,{details:e,track:f,id:h||0,groupId:p||"",stats:r,networkDetails:i,deliveryDirectives:x});break;case Ge.SUBTITLE_TRACK:l.trigger(R.SUBTITLE_TRACK_LOADED,{details:e,track:f,id:h||0,groupId:p||"",stats:r,networkDetails:i,deliveryDirectives:x});break}}}class un{static get version(){return Ia}static isMSESupported(){return Ew()}static isSupported(){return x$()}static getMediaSource(){return Rs()}static get Events(){return R}static get MetadataSchema(){return Ln}static get ErrorTypes(){return we}static get ErrorDetails(){return z}static get DefaultConfig(){return un.defaultConfig?un.defaultConfig:o$}static set DefaultConfig(e){un.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Gp,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=kO(e.debug||!1,"Hls instance",e.assetPlayerId),r=this.config=l$(un.DefaultConfig,e,t);this.userConfig=e,r.progressive&&c$(r,t);const{abrController:s,bufferController:i,capLevelController:o,errorController:l,fpsController:u}=r,d=new l(this),f=this.abrController=new s(this),h=new wM(this),p=r.interstitialsController,x=p?this.interstitialsController=new p(this,un):null,g=this.bufferController=new i(this,h),E=this.capLevelController=new o(this),v=new u(this),b=new b$(this),A=r.contentSteeringController,L=A?new A(this):null,I=this.levelController=new y$(this,L),_=new p$(this),F=new T$(this.config,this.logger),C=this.streamController=new E$(this,h,F),P=this.gapController=new h$(this,h);E.setStreamController(C),v.setStreamController(C);const O=[b,I,C];x&&O.splice(1,0,x),L&&O.splice(1,0,L),this.networkControllers=O;const M=[f,g,P,E,v,_,h];this.audioTrackController=this.createController(r.audioTrackController,O);const H=r.audioStreamController;H&&O.push(this.audioStreamController=new H(this,h,F)),this.subtitleTrackController=this.createController(r.subtitleTrackController,O);const Z=r.subtitleStreamController;Z&&O.push(this.subtititleStreamController=new Z(this,h,F)),this.createController(r.timelineController,M),F.emeController=this.emeController=this.createController(r.emeController,M),this.cmcdController=this.createController(r.cmcdController,M),this.latencyController=this.createController(g$,M),this.coreComponents=M,O.push(d);const se=d.onErrorOut;typeof se=="function"&&this.on(R.ERROR,se,d),this.on(R.MANIFEST_LOADED,b.onManifestLoaded,b)}createController(e,t){if(e){const r=new e(this);return t&&t.push(r),r}return null}on(e,t,r=this){this._emitter.on(e,t,r)}once(e,t,r=this){this._emitter.once(e,t,r)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,r=this,s){this._emitter.off(e,t,r,s)}listeners(e){return this._emitter.listeners(e)}emit(e,t,r){return this._emitter.emit(e,t,r)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(r){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+r.message+'". Here is a stacktrace:',r),!this.triggeringException){this.triggeringException=!0;const s=e===R.ERROR;this.trigger(R.ERROR,{type:we.OTHER_ERROR,details:z.INTERNAL_EXCEPTION,fatal:s,event:e,error:r}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(R.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const i=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(R.ERROR,{type:we.OTHER_ERROR,details:z.ATTACH_MEDIA_ERROR,fatal:!0,error:i});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,r=t?e.media:e,s=t?e:{media:r};this._media=r,this.trigger(R.MEDIA_ATTACHING,s)}detachMedia(){this.logger.log("detachMedia"),this.trigger(R.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(R.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,r=this._url,s=this._url=Pp.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${s}`),t&&r&&(r!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(R.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let r=0;r<this.networkControllers.length&&(this.networkControllers[r].startLoad(e,t),!(!this.started||!this.networkControllers));r++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[ge.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[ge.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[ge.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e?.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=hU()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){lM(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const r=e.length;for(let s=0;s<r;s++)if(e[s].maxBitrate>=t)return s;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:r}=this;let s;if(t===-1&&e!=null&&e.length?s=e.length-1:s=t,r)for(let i=s;i--;){const o=e[i].attrs["HDCP-LEVEL"];if(o&&o<=r)return i}return s}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const r=ab(t);return ib(e,r,navigator.mediaCapabilities)}}un.defaultConfig=void 0;const w$=()=>{const[n,e]=N.useState(null),[t,r]=N.useState(null),[s,i]=N.useState(!1),o=N.useRef(null),l=N.useRef(null),u=[{id:"starsports",name:"Star Sports",logo:"https://upload.wikimedia.org/wikipedia/en/thumb/5/5b/Star_Sports_logo.svg/1200px-Star_Sports_logo.svg.png",streamUrl:"http://192.168.91.8/streams/118/index.m3u8",country:" India",category:"Sports"}];N.useEffect(()=>{if(!n||!o.current)return;const p=o.current;if(i(!0),r(null),l.current&&(l.current.destroy(),l.current=null),console.log("Loading stream:",n.streamUrl),un.isSupported()){const x=new un({debug:!0,enableWorker:!0,lowLatencyMode:!1,backBufferLength:90,maxBufferLength:30,maxMaxBufferLength:600,xhrSetup:function(g,E){g.withCredentials=!1}});l.current=x,x.on(un.Events.MANIFEST_PARSED,(g,E)=>{console.log("Manifest parsed, levels:",E.levels),i(!1),p.play().then(()=>console.log("Playing successfully")).catch(v=>{console.error("Autoplay failed:",v),r("Click play button to start")})}),x.on(un.Events.ERROR,(g,E)=>{if(console.error("HLS Error event:",g,E),E.fatal)switch(i(!1),E.type){case un.ErrorTypes.NETWORK_ERROR:console.error("Network error - Cannot load stream"),r("Network error: Cannot connect to stream. Check if URL is accessible."),setTimeout(()=>{console.log("Trying to recover from network error..."),x.startLoad()},3e3);break;case un.ErrorTypes.MEDIA_ERROR:console.error("Media error - trying to recover"),r("Media error: Attempting to recover..."),x.recoverMediaError();break;default:console.error("Fatal error - cannot recover"),r("Fatal error: Unable to play stream"),x.destroy();break}}),x.on(un.Events.FRAG_LOADED,()=>{console.log("Fragment loaded successfully")}),x.loadSource(n.streamUrl),x.attachMedia(p)}else p.canPlayType("application/vnd.apple.mpegurl")?(console.log("Using Safari native HLS"),p.src=n.streamUrl,p.addEventListener("loadedmetadata",()=>{i(!1),p.play().catch(x=>{console.error("Safari autoplay failed:",x),r("Click play button to start")})}),p.addEventListener("error",x=>{console.error("Safari video error:",x),r("Error loading video stream"),i(!1)})):(r("HLS not supported in this browser"),i(!1));return()=>{l.current&&(l.current.destroy(),l.current=null)}},[n]);const d=p=>{e(p),r(null)},f=()=>{o.current&&o.current.play().catch(p=>console.error("Manual play failed:",p))},h=()=>{o.current&&o.current.requestFullscreen&&o.current.requestFullscreen()};return S.jsx("div",{className:"min-h-screen bg-black pt-20 pb-16",children:S.jsxs("div",{className:"max-w-7xl mx-auto mobile-padding sm:px-6",children:[S.jsxs("div",{className:"mb-6 sm:mb-8",children:[S.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[S.jsx(ou,{className:"text-red-600 w-6 h-6 sm:w-8 sm:h-8"}),S.jsx("h1",{className:"text-3xl sm:text-4xl md:text-5xl font-bold text-white",children:"Live TV"}),S.jsxs("div",{className:"flex items-center gap-2 px-2 sm:px-3 py-1 bg-red-600/20 border border-red-600 rounded-full",children:[S.jsxs("span",{className:"relative flex h-2 w-2",children:[S.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-500 opacity-75"}),S.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-red-600"})]}),S.jsx("span",{className:"text-red-500 text-xs font-bold uppercase",children:"Live"})]})]}),S.jsx("p",{className:"text-gray-400 text-sm sm:text-lg",children:"Watch live TV channels streaming now"})]}),n?S.jsx("div",{className:"mb-8",children:S.jsxs("div",{className:"relative bg-black rounded-lg overflow-hidden border-2 border-red-600/50 shadow-2xl shadow-red-600/20",children:[S.jsxs("div",{className:"relative aspect-video bg-black",children:[S.jsx("video",{ref:o,className:"w-full h-full",controls:!0,playsInline:!0,autoPlay:!0,muted:!1}),s&&S.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80 backdrop-blur-sm",children:S.jsxs("div",{className:"text-center",children:[S.jsx("div",{className:"inline-block h-12 w-12 animate-spin rounded-full border-4 border-solid border-red-600 border-r-transparent mb-4"}),S.jsx("p",{className:"text-white text-lg font-semibold",children:"Loading stream..."}),S.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Please wait"})]})}),t&&S.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/90 backdrop-blur-sm",children:S.jsxs("div",{className:"text-center max-w-md mx-4",children:[S.jsx(GP,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),S.jsx("h3",{className:"text-white text-xl font-bold mb-2",children:"Stream Error"}),S.jsx("p",{className:"text-gray-300 text-sm mb-4",children:t}),S.jsxs("button",{onClick:f,className:"px-6 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg font-semibold transition-colors flex items-center gap-2 mx-auto",children:[S.jsx(nr,{className:"w-5 h-5"}),"Retry Stream"]})]})})]}),S.jsx("div",{className:"bg-neutral-900/95 backdrop-blur-sm p-4 border-t border-neutral-800",children:S.jsxs("div",{className:"flex items-center justify-between",children:[S.jsxs("div",{className:"flex items-center gap-4",children:[S.jsx("img",{src:n.logo,alt:n.name,className:"w-12 h-12 object-contain bg-white rounded-lg p-1"}),S.jsxs("div",{children:[S.jsx("h3",{className:"text-white font-bold text-lg",children:n.name}),S.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[S.jsx("span",{children:n.country}),S.jsx("span",{children:""}),S.jsx("span",{className:"text-red-500",children:n.category}),S.jsx("span",{children:""}),S.jsxs("div",{className:"flex items-center gap-1",children:[S.jsxs("span",{className:"relative flex h-2 w-2",children:[S.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-500 opacity-75"}),S.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-red-600"})]}),S.jsx("span",{className:"text-red-500 font-semibold",children:"LIVE"})]})]})]})]}),S.jsx("div",{className:"flex items-center gap-2",children:S.jsx("button",{onClick:h,className:"p-2 bg-neutral-800 hover:bg-neutral-700 rounded-lg transition-colors touch-target",children:S.jsx(qP,{className:"w-5 h-5 text-white"})})})]})})]})}):null,S.jsxs("div",{children:[S.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Available Channels"}),S.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:u.map(p=>S.jsxs("button",{onClick:()=>d(p),className:`group relative bg-neutral-900 rounded-lg overflow-hidden border-2 transition-all hover:scale-105 hover:shadow-2xl ${n?.id===p.id?"border-red-600 shadow-xl shadow-red-600/20":"border-neutral-800 hover:border-red-600/50"}`,children:[S.jsx("div",{className:"aspect-square p-4 flex items-center justify-center bg-white",children:S.jsx("img",{src:p.logo,alt:p.name,className:"w-full h-full object-contain"})}),S.jsxs("div",{className:"p-3 bg-neutral-900",children:[S.jsx("h3",{className:"text-white font-semibold text-sm mb-1 truncate",children:p.name}),S.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-400",children:[S.jsxs("span",{className:"relative flex h-1.5 w-1.5",children:[S.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-500 opacity-75"}),S.jsx("span",{className:"relative inline-flex rounded-full h-1.5 w-1.5 bg-red-600"})]}),S.jsx("span",{className:"text-red-500 font-semibold",children:"LIVE"})]}),S.jsx("p",{className:"text-xs text-gray-500 mt-1",children:p.category})]}),n?.id===p.id&&S.jsx("div",{className:"absolute top-2 right-2",children:S.jsx("div",{className:"p-1.5 bg-red-600 rounded-full",children:S.jsx(nr,{className:"w-3 h-3 text-white"})})})]},p.id))})]}),!n&&S.jsx("div",{className:"mt-12 text-center",children:S.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-neutral-900 border border-neutral-800 rounded-full",children:[S.jsx(ou,{className:"text-red-600"}),S.jsx("span",{className:"text-gray-400 text-sm",children:"Select a channel to start watching"})]})})]})})},JS="http://127.0.0.1:8000/api",A$=300*1e3;class L${axiosInstance;refreshPromise=null;constructor(){this.axiosInstance=We.create({baseURL:JS,timeout:1e4,headers:{"Content-Type":"application/json",Accept:"application/json"},withCredentials:!1}),this.setupInterceptors()}setupInterceptors(){this.axiosInstance.interceptors.request.use(async e=>{const t=await this.getValidAccessToken();return t&&e.headers&&(e.headers.Authorization=`Bearer ${t}`),["post","put","patch","delete"].includes(e.method?.toLowerCase()||"")&&(e.headers["X-Requested-With"]="XMLHttpRequest"),e.headers["X-Request-Time"]=Date.now().toString(),e},e=>Promise.reject(this.handleError(e))),this.axiosInstance.interceptors.response.use(e=>e,async e=>{const t=e.config;if(e.response?.status===401&&!t._retry){t._retry=!0;try{const r=await this.refreshAccessToken();if(r&&t.headers)return t.headers.Authorization=`Bearer ${r}`,this.axiosInstance.request(t)}catch(r){return this.handleAuthFailure(),Promise.reject(this.handleError(r))}}return Promise.reject(this.handleError(e))})}async getValidAccessToken(){const e=this.getStoredAccessToken();if(!e)return null;if(this.isTokenExpiring(e))try{return await this.refreshAccessToken()}catch(t){return console.error("Token refresh failed:",t),null}return e}getStoredAccessToken(){try{const e=localStorage.getItem("sanviplex_auth");return e&&JSON.parse(e).access||null}catch(e){return console.error("Error reading access token:",e),this.clearStoredTokens(),null}}getStoredRefreshToken(){try{const e=localStorage.getItem("sanviplex_auth");return e&&JSON.parse(e).refresh||null}catch(e){return console.error("Error reading refresh token:",e),this.clearStoredTokens(),null}}isTokenExpiring(e){try{const r=JSON.parse(atob(e.split(".")[1])).exp*1e3,s=Date.now();return r-s<A$}catch(t){return console.error("Error parsing token:",t),!0}}async refreshAccessToken(){if(this.refreshPromise)return this.refreshPromise;this.refreshPromise=this.performTokenRefresh();try{return await this.refreshPromise}finally{this.refreshPromise=null}}async performTokenRefresh(){const e=this.getStoredRefreshToken();if(!e)throw new Error("No refresh token available");try{const t=await We.post(`${JS}/token/refresh/`,{refresh:e},{headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},timeout:1e4}),{access:r}=t.data;return this.updateStoredAccessToken(r),r}catch{throw this.handleAuthFailure(),new Error("Token refresh failed")}}updateStoredAccessToken(e){try{const t=localStorage.getItem("sanviplex_auth");if(t){const r=JSON.parse(t);r.access=e,localStorage.setItem("sanviplex_auth",JSON.stringify(r))}}catch(t){console.error("Error updating access token:",t)}}handleAuthFailure(){this.clearStoredTokens(),window.location.pathname.includes("/login")||(window.location.href="/login?expired=true")}clearStoredTokens(){localStorage.removeItem("sanviplex_auth"),localStorage.removeItem("sanviplex_user")}handleError(e){if(We.isAxiosError(e)){if(e.response){const t=e.response.data;if(t&&typeof t=="object"){if(t.detail)return{message:t.detail};const r=Object.entries(t).filter(([s,i])=>Array.isArray(i)&&i.length>0).map(([s,i])=>({field:s,message:i[0]}));if(r.length>0)return r[0]}return{message:`Server error: ${e.response.status}`,code:e.response.status.toString()}}else if(e.request)return{message:"Network error. Please check your connection."}}return{message:e.message||"An unexpected error occurred"}}storeTokens(e){try{localStorage.setItem("sanviplex_auth",JSON.stringify(e))}catch(t){console.error("Error storing tokens:",t)}}clearTokens(){this.clearStoredTokens()}isAuthenticated(){const e=this.getStoredAccessToken();return!!e&&!this.isTokenExpiring(e)}async signup(e){console.log(" Signing up user:",e.email,"API URL:",this.axiosInstance.defaults.baseURL);try{const t=await this.axiosInstance.post("/signup/",e);return console.log(" Signup Response:",t.data),t.data}catch(t){throw console.error(" Signup Error:",t),t}}async login(e,t){console.log(" Logging in user:",e);try{const r=await this.axiosInstance.post("/login/",{email:e,password:t});return console.log(" Login Response:",r.data),r.data}catch(r){throw console.error(" Login Error:",r),r}}async sendOTP(e){console.log(" Sending OTP to:",e,"API URL:",this.axiosInstance.defaults.baseURL);try{const t=await this.axiosInstance.post("/send-otp/",{email:e});return console.log(" OTP Response:",t.data),t.data}catch(t){throw console.error(" OTP Error:",t),t}}async verifyOTP(e,t){return(await this.axiosInstance.post("/verify-otp/",{email:e,otp:t})).data}async updateUserProfile(e){return(await this.axiosInstance.put("/auth/profile/",e)).data.user}async get(e,t){return(await this.axiosInstance.get(e,t)).data}async post(e,t,r){return(await this.axiosInstance.post(e,t,r)).data}async put(e,t,r){return(await this.axiosInstance.put(e,t,r)).data}async delete(e,t){return(await this.axiosInstance.delete(e,t)).data}}const hr=new L$,pa=n=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n),R$=n=>{const e=[];return n.length<8&&e.push("Password must be at least 8 characters long"),/(?=.*[a-z])/.test(n)||e.push("Password must contain at least one lowercase letter"),/(?=.*[A-Z])/.test(n)||e.push("Password must contain at least one uppercase letter"),/(?=.*\d)/.test(n)||e.push("Password must contain at least one number"),{isValid:e.length===0,errors:e}},Tw=N.createContext(void 0),bw=()=>{const n=N.useContext(Tw);if(n===void 0)throw new Error("useAuth must be used within an AuthProvider");return n},I$=({children:n})=>{const[e,t]=N.useState({user:null,isLoading:!0,isAuthenticated:!1,error:null});N.useEffect(()=>{(async()=>{try{const E=localStorage.getItem("sanviplex_user");if(E&&hr.isAuthenticated()){const v=JSON.parse(E);t({user:v,isLoading:!1,isAuthenticated:!0,error:null})}else hr.clearTokens(),localStorage.removeItem("sanviplex_user"),t(v=>({...v,isLoading:!1}))}catch(E){console.error("Auth initialization error:",E),hr.clearTokens(),localStorage.removeItem("sanviplex_user"),t({user:null,isLoading:!1,isAuthenticated:!1,error:"Session expired. Please sign in again."})}})()},[]);const r=g=>{t(E=>({...E,isLoading:g}))},s=g=>{t(E=>({...E,error:g}))},i=g=>{t(E=>({...E,user:g,isAuthenticated:!!g,error:null}))},x={...e,login:async(g,E)=>{r(!0),s(null);try{if(!pa(g))throw new Error("Invalid email format");const v=await hr.login(g,E);if("requires_verification"in v&&v.requires_verification)throw new Error("Please verify your email before logging in. Check your inbox for the verification link.");const b=v;hr.storeTokens({access:b.access,refresh:b.refresh});const A={...b.user,full_name:`${b.user.first_name} ${b.user.last_name}`.trim(),preferences:{language:"en",theme:"dark",notifications:!0,autoplay:!0}};localStorage.setItem("sanviplex_user",JSON.stringify(A)),i(A)}catch(v){const b=v.message||"Login failed";throw s(b),new Error(b)}finally{r(!1)}},signup:async g=>{r(!0),s(null);try{if(!pa(g.email))throw new Error("Invalid email format");return await hr.signup({email:g.email,first_name:g.firstName,last_name:g.lastName,password:g.password,confirm_password:g.password})}catch(E){const v=E.message||"Signup failed";throw s(v),new Error(v)}finally{r(!1)}},sendOTP:async g=>{r(!0),s(null);try{if(!pa(g))throw new Error("Invalid email format");return await hr.sendOTP(g)}catch(E){const v=E.message||"Failed to send OTP";throw s(v),new Error(v)}finally{r(!1)}},verifyOTP:async(g,E)=>{r(!0),s(null);try{const v=await hr.verifyOTP(g,E);hr.storeTokens({access:v.access,refresh:v.refresh});const b={...v.user,full_name:`${v.user.first_name} ${v.user.last_name}`.trim(),preferences:{language:"en",theme:"dark",notifications:!0,autoplay:!0}};localStorage.setItem("sanviplex_user",JSON.stringify(b)),i(b)}catch(v){const b=v.message||"OTP verification failed";throw s(b),new Error(b)}finally{r(!1)}},logout:async()=>{r(!0);try{hr.clearTokens(),localStorage.removeItem("sanviplex_user"),i(null)}catch(g){console.error("Logout error:",g)}finally{r(!1)}},updateProfile:async g=>{if(!e.user)throw new Error("No user logged in");r(!0),s(null);try{const E={...e.user,...g};localStorage.setItem("sanviplex_user",JSON.stringify(E)),i(E)}catch(E){const v=E.message||"Failed to update profile";throw s(v),new Error(v)}finally{r(!1)}},clearError:()=>{s(null)}};return S.jsx(Tw.Provider,{value:x,children:n})},k$=()=>{const n=qt(),{login:e,isLoading:t,error:r}=bw(),[s,i]=N.useState({email:"",password:"",rememberMe:!1}),[o,l]=N.useState(!1),[u,d]=N.useState({}),f=(x,g)=>{i(E=>({...E,[x]:g})),u[x]&&d(E=>({...E,[x]:""}))},h=()=>{const x={};return s.email?pa(s.email)||(x.email="Please enter a valid email address"):x.email="Email is required",s.password||(x.password="Password is required"),d(x),Object.keys(x).length===0},p=async x=>{if(x.preventDefault(),!!h())try{await e(s.email,s.password),n("/")}catch(g){console.error("Login error:",g),d({general:g.message||"Login failed. Please try again."})}};return S.jsxs("div",{className:"min-h-screen bg-black text-white relative flex items-center justify-center overflow-hidden",children:[S.jsxs("div",{className:"fixed inset-0 pointer-events-none z-0",children:[S.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-red-950/20 via-black to-black"}),[...Array(50)].map((x,g)=>S.jsx("div",{className:"absolute w-0.5 h-0.5 bg-red-500/30 rounded-full animate-pulse",style:{left:Math.random()*100+"%",top:Math.random()*100+"%",animationDelay:Math.random()*5+"s",animationDuration:3+Math.random()*4+"s"}},g)),[...Array(8)].map((x,g)=>S.jsx("div",{className:"absolute border border-red-500/20 rounded-2xl animate-pulse",style:{width:20+Math.random()*80+"px",height:20+Math.random()*80+"px",left:Math.random()*100+"%",top:Math.random()*100+"%",animationDelay:Math.random()*3+"s",animationDuration:4+Math.random()*6+"s",transform:`rotate(${Math.random()*360}deg)`}},`shape-${g}`))]}),S.jsxs(ei,{to:"/",className:"absolute top-8 left-8 z-50 flex items-center space-x-2 px-6 py-3 rounded-2xl bg-white/10 backdrop-blur-xl border border-white/20 text-white/80 hover:text-white hover:bg-white/15 transition-all duration-300 group",children:[S.jsx(su,{className:"rotate-180 group-hover:-translate-x-1 transition-transform duration-300",size:18}),S.jsx("span",{className:"font-medium",children:"Back to Sanviplex"})]}),S.jsx("div",{className:"relative z-10 w-full max-w-md mx-auto px-6",children:S.jsxs("div",{className:"bg-black/80 backdrop-blur-3xl border border-white/10 rounded-3xl p-8 shadow-2xl shadow-black/60 relative overflow-hidden",children:[S.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/5 via-transparent to-red-500/5 pointer-events-none"}),S.jsxs("div",{className:"relative z-10 text-center mb-8",children:[S.jsx("div",{className:"flex items-center justify-center mb-6",children:S.jsx("img",{src:"/src/utils/logo.png",alt:"Sanviplex",className:"h-16 w-auto filter drop-shadow-2xl"})}),S.jsx("h1",{className:"text-3xl font-black bg-gradient-to-r from-white via-red-100 to-red-200 bg-clip-text text-transparent mb-2",children:"Welcome Back"}),S.jsx("p",{className:"text-white/60 text-sm",children:"Sign in to continue your streaming journey"})]}),S.jsx("div",{className:"text-center mb-6",children:S.jsx("p",{className:"text-white/80 text-sm",children:"Enter your email and password to sign in"})}),(u.general||r)&&S.jsx("div",{className:"relative z-10 mb-6 p-4 bg-red-500/20 border border-red-500/40 rounded-2xl",children:S.jsxs("div",{className:"flex items-center space-x-2",children:[S.jsx(An,{className:"text-red-400",size:16}),S.jsx("span",{className:"text-red-200 text-sm",children:u.general||r})]})}),S.jsxs("form",{onSubmit:p,className:"relative z-10 space-y-6",children:[S.jsxs("div",{children:[S.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Email Address"}),S.jsxs("div",{className:"relative",children:[S.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:S.jsx(t1,{className:"text-white/40",size:18})}),S.jsx("input",{type:"email",value:s.email,onChange:x=>f("email",x.target.value),placeholder:"Enter your email address",className:`w-full pl-12 pr-4 py-4 bg-white/5 border rounded-2xl text-white placeholder-white/40 focus:outline-none transition-all duration-300 ${u.email?"border-red-500/60 focus:border-red-500 focus:bg-red-500/10":"border-white/20 focus:border-red-500/60 focus:bg-white/10"}`})]}),u.email&&S.jsxs("p",{className:"mt-2 text-red-400 text-xs flex items-center space-x-1",children:[S.jsx(An,{size:12}),S.jsx("span",{children:u.email})]})]}),S.jsxs("div",{children:[S.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Password"}),S.jsxs("div",{className:"relative",children:[S.jsx("input",{type:o?"text":"password",value:s.password,onChange:x=>f("password",x.target.value),placeholder:"Enter your password",className:`w-full pl-4 pr-12 py-4 bg-white/5 border rounded-2xl text-white placeholder-white/40 focus:outline-none transition-all duration-300 ${u.password?"border-red-500/60 focus:border-red-500 focus:bg-red-500/10":"border-white/20 focus:border-red-500/60 focus:bg-white/10"}`}),S.jsx("button",{type:"button",onClick:()=>l(!o),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-white/40 hover:text-white/60 transition-colors duration-200",children:o?S.jsx(im,{size:18}):S.jsx(om,{size:18})})]}),u.password&&S.jsxs("p",{className:"mt-2 text-red-400 text-xs flex items-center space-x-1",children:[S.jsx(An,{size:12}),S.jsx("span",{children:u.password})]})]}),S.jsx("div",{className:"flex items-center",children:S.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer group",children:[S.jsxs("div",{className:"relative",children:[S.jsx("input",{type:"checkbox",checked:s.rememberMe,onChange:x=>f("rememberMe",x.target.checked),className:"sr-only"}),S.jsx("div",{className:`w-5 h-5 rounded border-2 transition-all duration-200 ${s.rememberMe?"bg-red-500 border-red-500":"border-white/30 group-hover:border-white/50"}`,children:s.rememberMe&&S.jsx(sm,{className:"text-white",size:12})})]}),S.jsx("span",{className:"text-white/70 text-sm group-hover:text-white/90 transition-colors duration-200",children:"Remember this device"})]})}),S.jsx("button",{type:"submit",disabled:t,className:"w-full py-4 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold rounded-2xl transition-all duration-300 transform hover:scale-[1.02] hover:shadow-2xl hover:shadow-red-500/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center space-x-2",children:t?S.jsxs(S.Fragment,{children:[S.jsx("div",{className:"w-5 h-5 border-2 border-white/20 border-t-white rounded-full animate-spin"}),S.jsx("span",{children:"Signing In..."})]}):S.jsxs(S.Fragment,{children:[S.jsx("span",{children:"Sign In"}),S.jsx(su,{className:"group-hover:translate-x-1 transition-transform duration-300",size:18})]})})]}),S.jsxs("p",{className:"relative z-10 text-center mt-8 text-white/60",children:["Don't have an account?"," ",S.jsx(ei,{to:"/signup",className:"text-red-400 hover:text-red-300 font-medium transition-colors duration-200",children:"Create one now"})]})]})}),S.jsx("div",{className:"fixed bottom-10 left-10 w-20 h-20 border border-red-500/20 rounded-full animate-pulse"}),S.jsx("div",{className:"fixed top-1/4 right-20 w-16 h-16 border border-red-500/30 rounded-2xl animate-pulse",style:{animationDelay:"1s"}}),S.jsx("div",{className:"fixed bottom-1/4 right-10 w-12 h-12 bg-red-500/10 rounded-full animate-pulse",style:{animationDelay:"2s"}})]})},C$=()=>{const n=qt(),{signup:e,sendOTP:t,verifyOTP:r,isLoading:s,error:i}=bw(),[o,l]=N.useState("form"),[u,d]=N.useState({firstName:"",lastName:"",email:"",password:"",confirmPassword:"",agreeToTerms:!1,subscribeNewsletter:!1}),[f,h]=N.useState(!1),[p,x]=N.useState(!1),[g,E]=N.useState(""),[v,b]=N.useState({}),A=(C,P)=>{d(O=>({...O,[C]:P})),v[C]&&b(O=>({...O,[C]:""}))},L=()=>{const C={};if(u.firstName.trim()||(C.firstName="First name is required"),u.lastName.trim()||(C.lastName="Last name is required"),u.email?pa(u.email)||(C.email="Please enter a valid email address"):C.email="Email is required",!u.password)C.password="Password is required";else{const P=R$(u.password);P.isValid||(C.password=P.errors[0])}return u.confirmPassword?u.password!==u.confirmPassword&&(C.confirmPassword="Passwords do not match"):C.confirmPassword="Please confirm your password",u.agreeToTerms||(C.agreeToTerms="You must agree to the terms and conditions"),b(C),Object.keys(C).length===0},I=async C=>{if(C.preventDefault(),!!L())try{const P=await e({firstName:u.firstName,lastName:u.lastName,email:u.email,password:u.password});console.log("Registration successful:",P.message),l("otp"),b({})}catch(P){console.error("Registration error:",P),b({general:P.message||"Registration failed. Please try again."})}},_=async()=>{if(!g||g.length!==6){b({otp:"Please enter a valid 6-digit OTP"});return}try{await r(u.email,g),n("/")}catch(C){console.error("OTP verification error:",C),b({otp:C.message||"OTP verification failed. Please try again."})}},F=async()=>{try{await t(u.email),b({})}catch(C){b({otp:C.message||"Failed to resend OTP. Please try again."})}};return o==="otp"?S.jsxs("div",{className:"min-h-screen bg-black text-white relative flex items-center justify-center overflow-hidden",children:[S.jsx("div",{className:"fixed inset-0 pointer-events-none z-0",children:S.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-red-950/20 via-black to-black"})}),S.jsx("div",{className:"relative z-10 w-full max-w-md mx-auto px-6",children:S.jsxs("div",{className:"bg-black/80 backdrop-blur-3xl border border-white/10 rounded-3xl p-8 shadow-2xl",children:[S.jsxs("div",{className:"text-center mb-8",children:[S.jsx("h1",{className:"text-3xl font-black bg-gradient-to-r from-white via-red-100 to-red-200 bg-clip-text text-transparent mb-2",children:"Verify Your Email"}),S.jsxs("p",{className:"text-white/60 text-sm",children:["We've sent a 6-digit code to ",u.email]})]}),v.otp&&S.jsx("div",{className:"mb-6 p-4 bg-red-500/20 border border-red-500/40 rounded-2xl",children:S.jsxs("div",{className:"flex items-center space-x-2",children:[S.jsx(An,{className:"text-red-400",size:16}),S.jsx("span",{className:"text-red-200 text-sm",children:v.otp})]})}),S.jsxs("div",{className:"space-y-6",children:[S.jsxs("div",{children:[S.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Verification Code"}),S.jsx("input",{type:"text",value:g,onChange:C=>E(C.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"Enter 6-digit code",className:"w-full px-4 py-4 bg-white/5 border border-white/20 rounded-2xl text-white placeholder-white/40 focus:outline-none focus:border-red-500/60 focus:bg-white/10 transition-all duration-300 text-center text-2xl tracking-widest",maxLength:6})]}),S.jsx("button",{onClick:_,disabled:s||g.length!==6,className:"w-full py-4 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold rounded-2xl transition-all duration-300 transform hover:scale-[1.02] hover:shadow-2xl hover:shadow-red-500/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center space-x-2",children:s?S.jsxs(S.Fragment,{children:[S.jsx("div",{className:"w-5 h-5 border-2 border-white/20 border-t-white rounded-full animate-spin"}),S.jsx("span",{children:"Verifying..."})]}):S.jsxs(S.Fragment,{children:[S.jsx("span",{children:"Verify & Complete Signup"}),S.jsx(su,{size:18})]})}),S.jsxs("div",{className:"text-center space-y-4",children:[S.jsx("button",{onClick:F,disabled:s,className:"text-red-400 hover:text-red-300 text-sm transition-colors duration-200 disabled:opacity-50",children:"Resend Code"}),S.jsx("button",{onClick:()=>l("form"),className:"block w-full text-white/60 hover:text-white/80 text-sm transition-colors duration-200",children:" Back to Signup"})]})]})]})})]}):S.jsxs("div",{className:"min-h-screen relative overflow-hidden bg-black",children:[S.jsxs("div",{className:"absolute inset-0",children:[S.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-red-900/20 via-black to-red-800/10"}),S.jsx("div",{className:"absolute top-20 left-10 w-72 h-72 bg-red-600/10 rounded-full blur-3xl animate-pulse"}),S.jsx("div",{className:"absolute bottom-20 right-10 w-96 h-96 bg-red-500/5 rounded-full blur-3xl animate-pulse delay-1000"}),S.jsx("div",{className:"absolute top-1/2 left-1/4 w-64 h-64 bg-red-400/5 rounded-full blur-3xl animate-pulse delay-500"}),S.jsx("div",{className:"absolute inset-0 opacity-5",style:{backgroundImage:`
              linear-gradient(rgba(255, 0, 0, 0.1) 1px, transparent 1px),
              linear-gradient(90deg, rgba(255, 0, 0, 0.1) 1px, transparent 1px)
            `,backgroundSize:"50px 50px"}})]}),S.jsx("div",{className:"relative z-10 flex items-center justify-center min-h-screen p-4",children:S.jsx("div",{className:"w-full max-w-md",children:S.jsxs("div",{className:"bg-black/40 backdrop-blur-2xl border border-white/10 rounded-3xl shadow-2xl shadow-red-500/10 p-8",children:[S.jsxs("div",{className:"text-center mb-8",children:[S.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-red-500/20 rounded-full mb-4",children:S.jsx(s1,{className:"text-red-400",size:24})}),S.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Create Account"}),S.jsx("p",{className:"text-gray-400 text-sm",children:"Join Sanviplex for unlimited streaming"})]}),(v.general||i)&&S.jsx("div",{className:"relative z-10 mb-6 p-4 bg-red-500/20 border border-red-500/40 rounded-2xl",children:S.jsxs("div",{className:"flex items-center space-x-2",children:[S.jsx(An,{className:"text-red-400",size:16}),S.jsx("span",{className:"text-red-200 text-sm",children:v.general||i})]})}),S.jsxs("form",{onSubmit:I,className:"space-y-6",children:[S.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[S.jsxs("div",{children:[S.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"First Name"}),S.jsx("input",{type:"text",value:u.firstName,onChange:C=>A("firstName",C.target.value),placeholder:"John",className:`w-full px-4 py-4 bg-white/5 border rounded-2xl text-white placeholder-white/40 focus:outline-none transition-all duration-300 ${v.firstName?"border-red-500/60 focus:border-red-500 focus:bg-red-500/10":"border-white/20 focus:border-red-500/60 focus:bg-white/10"}`}),v.firstName&&S.jsxs("p",{className:"mt-2 text-red-400 text-xs flex items-center space-x-1",children:[S.jsx(An,{size:12}),S.jsx("span",{children:v.firstName})]})]}),S.jsxs("div",{children:[S.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Last Name"}),S.jsx("input",{type:"text",value:u.lastName,onChange:C=>A("lastName",C.target.value),placeholder:"Doe",className:`w-full px-4 py-4 bg-white/5 border rounded-2xl text-white placeholder-white/40 focus:outline-none transition-all duration-300 ${v.lastName?"border-red-500/60 focus:border-red-500 focus:bg-red-500/10":"border-white/20 focus:border-red-500/60 focus:bg-white/10"}`}),v.lastName&&S.jsxs("p",{className:"mt-2 text-red-400 text-xs flex items-center space-x-1",children:[S.jsx(An,{size:12}),S.jsx("span",{children:v.lastName})]})]})]}),S.jsxs("div",{children:[S.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Email Address"}),S.jsxs("div",{className:"relative",children:[S.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:S.jsx(t1,{className:"text-white/40",size:18})}),S.jsx("input",{type:"email",value:u.email,onChange:C=>A("email",C.target.value),placeholder:"Enter your email address",className:`w-full pl-12 pr-4 py-4 bg-white/5 border rounded-2xl text-white placeholder-white/40 focus:outline-none transition-all duration-300 ${v.email?"border-red-500/60 focus:border-red-500 focus:bg-red-500/10":"border-white/20 focus:border-red-500/60 focus:bg-white/10"}`})]}),v.email&&S.jsxs("p",{className:"mt-2 text-red-400 text-xs flex items-center space-x-1",children:[S.jsx(An,{size:12}),S.jsx("span",{children:v.email})]})]}),S.jsxs("div",{children:[S.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Password"}),S.jsxs("div",{className:"relative",children:[S.jsx("input",{type:f?"text":"password",value:u.password,onChange:C=>A("password",C.target.value),placeholder:"Create a strong password",className:`w-full pl-4 pr-12 py-4 bg-white/5 border rounded-2xl text-white placeholder-white/40 focus:outline-none transition-all duration-300 ${v.password?"border-red-500/60 focus:border-red-500 focus:bg-red-500/10":"border-white/20 focus:border-red-500/60 focus:bg-white/10"}`}),S.jsx("button",{type:"button",onClick:()=>h(!f),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-white/40 hover:text-white/60 transition-colors duration-200",children:f?S.jsx(im,{size:18}):S.jsx(om,{size:18})})]}),v.password&&S.jsxs("p",{className:"mt-2 text-red-400 text-xs flex items-center space-x-1",children:[S.jsx(An,{size:12}),S.jsx("span",{children:v.password})]})]}),S.jsxs("div",{children:[S.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Confirm Password"}),S.jsxs("div",{className:"relative",children:[S.jsx("input",{type:p?"text":"password",value:u.confirmPassword,onChange:C=>A("confirmPassword",C.target.value),placeholder:"Confirm your password",className:`w-full pl-4 pr-12 py-4 bg-white/5 border rounded-2xl text-white placeholder-white/40 focus:outline-none transition-all duration-300 ${v.confirmPassword?"border-red-500/60 focus:border-red-500 focus:bg-red-500/10":"border-white/20 focus:border-red-500/60 focus:bg-white/10"}`}),S.jsx("button",{type:"button",onClick:()=>x(!p),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-white/40 hover:text-white/60 transition-colors duration-200",children:p?S.jsx(im,{size:18}):S.jsx(om,{size:18})})]}),v.confirmPassword&&S.jsxs("p",{className:"mt-2 text-red-400 text-xs flex items-center space-x-1",children:[S.jsx(An,{size:12}),S.jsx("span",{children:v.confirmPassword})]})]}),S.jsxs("div",{className:"space-y-4",children:[S.jsxs("label",{className:"flex items-start space-x-3 cursor-pointer group",children:[S.jsxs("div",{className:"relative mt-1",children:[S.jsx("input",{type:"checkbox",checked:u.agreeToTerms,onChange:C=>A("agreeToTerms",C.target.checked),className:"sr-only"}),S.jsx("div",{className:`w-5 h-5 rounded border-2 transition-all duration-200 ${u.agreeToTerms?"bg-red-500 border-red-500":"border-white/30 group-hover:border-white/50"}`,children:u.agreeToTerms&&S.jsx(sm,{className:"text-white",size:12})})]}),S.jsxs("span",{className:"text-white/70 text-sm group-hover:text-white/90 transition-colors duration-200",children:["I agree to the"," ",S.jsx(ei,{to:"/terms",className:"text-red-400 hover:text-red-300 underline",children:"Terms of Service"})," ","and"," ",S.jsx(ei,{to:"/privacy",className:"text-red-400 hover:text-red-300 underline",children:"Privacy Policy"})]})]}),v.agreeToTerms&&S.jsxs("p",{className:"text-red-400 text-xs flex items-center space-x-1",children:[S.jsx(An,{size:12}),S.jsx("span",{children:v.agreeToTerms})]}),S.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer group",children:[S.jsxs("div",{className:"relative",children:[S.jsx("input",{type:"checkbox",checked:u.subscribeNewsletter,onChange:C=>A("subscribeNewsletter",C.target.checked),className:"sr-only"}),S.jsx("div",{className:`w-5 h-5 rounded border-2 transition-all duration-200 ${u.subscribeNewsletter?"bg-red-500 border-red-500":"border-white/30 group-hover:border-white/50"}`,children:u.subscribeNewsletter&&S.jsx(sm,{className:"text-white",size:12})})]}),S.jsx("span",{className:"text-white/70 text-sm group-hover:text-white/90 transition-colors duration-200",children:"Subscribe to our newsletter for updates"})]})]}),S.jsx("button",{type:"submit",disabled:s,className:"w-full py-4 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold rounded-2xl transition-all duration-300 transform hover:scale-[1.02] hover:shadow-2xl hover:shadow-red-500/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center space-x-2",children:s?S.jsxs(S.Fragment,{children:[S.jsx("div",{className:"w-5 h-5 border-2 border-white/20 border-t-white rounded-full animate-spin"}),S.jsx("span",{children:"Creating Account..."})]}):S.jsxs(S.Fragment,{children:[S.jsx("span",{children:"Create Account"}),S.jsx(su,{className:"group-hover:translate-x-1 transition-transform duration-300",size:18})]})})]}),S.jsx("div",{className:"text-center mt-8",children:S.jsxs("p",{className:"text-white/60 text-sm",children:["Already have an account?"," ",S.jsx(ei,{to:"/login",className:"text-red-400 hover:text-red-300 font-medium transition-colors duration-200",children:"Sign In"})]})})]})})})]})};class _$ extends N.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("ErrorBoundary caught an error:",e,t)}render(){return this.state.hasError?S.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center",children:S.jsxs("div",{className:"text-center",children:[S.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Something went wrong"}),S.jsx("p",{className:"text-gray-300 mb-6",children:this.state.error?.message}),S.jsx("button",{onClick:()=>this.setState({hasError:!1}),className:"px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Try Again"})]})}):this.props.children}}function P$(){return S.jsx(I$,{children:S.jsx(_$,{children:S.jsx(hI,{children:S.jsx("div",{className:"min-h-screen bg-black overflow-x-hidden antialiased",children:S.jsxs(Zy,{children:[S.jsx(Qn,{path:"/login",element:S.jsx(k$,{})}),S.jsx(Qn,{path:"/signup",element:S.jsx(C$,{})}),S.jsx(Qn,{path:"/*",element:S.jsxs("div",{className:"flex flex-col min-h-screen",children:[S.jsx(BN,{}),S.jsx("main",{className:"flex-1 pb-20 md:pb-8",children:S.jsxs(Zy,{children:[S.jsx(Qn,{path:"/",element:S.jsx(uO,{})}),S.jsx(Qn,{path:"/movies",element:S.jsx(pO,{})}),S.jsx(Qn,{path:"/series",element:S.jsx(vO,{})}),S.jsx(Qn,{path:"/new-popular",element:S.jsx(SO,{})}),S.jsx(Qn,{path:"/live-tv",element:S.jsx(w$,{})}),S.jsx(Qn,{path:"/movie/:id",element:S.jsx(Nv,{})}),S.jsx(Qn,{path:"/tv/:id",element:S.jsx(Nv,{})})]})}),S.jsx(UN,{})]})})]})})})})})}function Bt(n){return`Minified Redux error #${n}; visit https://redux.js.org/Errors?code=${n} for the full message or use the non-minified dev environment for full errors. `}var D$=typeof Symbol=="function"&&Symbol.observable||"@@observable",ZS=D$,$h=()=>Math.random().toString(36).substring(7).split("").join("."),N$={INIT:`@@redux/INIT${$h()}`,REPLACE:`@@redux/REPLACE${$h()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${$h()}`},Eu=N$;function ng(n){if(typeof n!="object"||n===null)return!1;let e=n;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(n)===e||Object.getPrototypeOf(n)===null}function ww(n,e,t){if(typeof n!="function")throw new Error(Bt(2));if(typeof e=="function"&&typeof t=="function"||typeof t=="function"&&typeof arguments[3]=="function")throw new Error(Bt(0));if(typeof e=="function"&&typeof t>"u"&&(t=e,e=void 0),typeof t<"u"){if(typeof t!="function")throw new Error(Bt(1));return t(ww)(n,e)}let r=n,s=e,i=new Map,o=i,l=0,u=!1;function d(){o===i&&(o=new Map,i.forEach((v,b)=>{o.set(b,v)}))}function f(){if(u)throw new Error(Bt(3));return s}function h(v){if(typeof v!="function")throw new Error(Bt(4));if(u)throw new Error(Bt(5));let b=!0;d();const A=l++;return o.set(A,v),function(){if(b){if(u)throw new Error(Bt(6));b=!1,d(),o.delete(A),i=null}}}function p(v){if(!ng(v))throw new Error(Bt(7));if(typeof v.type>"u")throw new Error(Bt(8));if(typeof v.type!="string")throw new Error(Bt(17));if(u)throw new Error(Bt(9));try{u=!0,s=r(s,v)}finally{u=!1}return(i=o).forEach(A=>{A()}),v}function x(v){if(typeof v!="function")throw new Error(Bt(10));r=v,p({type:Eu.REPLACE})}function g(){const v=h;return{subscribe(b){if(typeof b!="object"||b===null)throw new Error(Bt(11));function A(){const I=b;I.next&&I.next(f())}return A(),{unsubscribe:v(A)}},[ZS](){return this}}}return p({type:Eu.INIT}),{dispatch:p,subscribe:h,getState:f,replaceReducer:x,[ZS]:g}}function O$(n){Object.keys(n).forEach(e=>{const t=n[e];if(typeof t(void 0,{type:Eu.INIT})>"u")throw new Error(Bt(12));if(typeof t(void 0,{type:Eu.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(Bt(13))})}function M$(n){const e=Object.keys(n),t={};for(let i=0;i<e.length;i++){const o=e[i];typeof n[o]=="function"&&(t[o]=n[o])}const r=Object.keys(t);let s;try{O$(t)}catch(i){s=i}return function(o={},l){if(s)throw s;let u=!1;const d={};for(let f=0;f<r.length;f++){const h=r[f],p=t[h],x=o[h],g=p(x,l);if(typeof g>"u")throw l&&l.type,new Error(Bt(14));d[h]=g,u=u||g!==x}return u=u||r.length!==Object.keys(o).length,u?d:o}}function Tu(...n){return n.length===0?e=>e:n.length===1?n[0]:n.reduce((e,t)=>(...r)=>e(t(...r)))}function F$(...n){return e=>(t,r)=>{const s=e(t,r);let i=()=>{throw new Error(Bt(15))};const o={getState:s.getState,dispatch:(u,...d)=>i(u,...d)},l=n.map(u=>u(o));return i=Tu(...l)(s.dispatch),{...s,dispatch:i}}}function B$(n){return ng(n)&&"type"in n&&typeof n.type=="string"}var Aw=Symbol.for("immer-nothing"),eE=Symbol.for("immer-draftable"),Cn=Symbol.for("immer-state");function Zn(n,...e){throw new Error(`[Immer] minified error nr: ${n}. Full error at: https://bit.ly/3cXEKWf`)}var eo=Object.getPrototypeOf;function ai(n){return!!n&&!!n[Cn]}function Yr(n){return n?Lw(n)||Array.isArray(n)||!!n[eE]||!!n.constructor?.[eE]||qa(n)||Xu(n):!1}var U$=Object.prototype.constructor.toString();function Lw(n){if(!n||typeof n!="object")return!1;const e=eo(n);if(e===null)return!0;const t=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return t===Object?!0:typeof t=="function"&&Function.toString.call(t)===U$}function bu(n,e){qu(n)===0?Reflect.ownKeys(n).forEach(t=>{e(t,n[t],n)}):n.forEach((t,r)=>e(r,t,n))}function qu(n){const e=n[Cn];return e?e.type_:Array.isArray(n)?1:qa(n)?2:Xu(n)?3:0}function Vm(n,e){return qu(n)===2?n.has(e):Object.prototype.hasOwnProperty.call(n,e)}function Rw(n,e,t){const r=qu(n);r===2?n.set(e,t):r===3?n.add(t):n[e]=t}function $$(n,e){return n===e?n!==0||1/n===1/e:n!==n&&e!==e}function qa(n){return n instanceof Map}function Xu(n){return n instanceof Set}function Qs(n){return n.copy_||n.base_}function Gm(n,e){if(qa(n))return new Map(n);if(Xu(n))return new Set(n);if(Array.isArray(n))return Array.prototype.slice.call(n);const t=Lw(n);if(e===!0||e==="class_only"&&!t){const r=Object.getOwnPropertyDescriptors(n);delete r[Cn];let s=Reflect.ownKeys(r);for(let i=0;i<s.length;i++){const o=s[i],l=r[o];l.writable===!1&&(l.writable=!0,l.configurable=!0),(l.get||l.set)&&(r[o]={configurable:!0,writable:!0,enumerable:l.enumerable,value:n[o]})}return Object.create(eo(n),r)}else{const r=eo(n);if(r!==null&&t)return{...n};const s=Object.create(r);return Object.assign(s,n)}}function rg(n,e=!1){return Qu(n)||ai(n)||!Yr(n)||(qu(n)>1&&Object.defineProperties(n,{set:{value:Cc},add:{value:Cc},clear:{value:Cc},delete:{value:Cc}}),Object.freeze(n),e&&Object.values(n).forEach(t=>rg(t,!0))),n}function Cc(){Zn(2)}function Qu(n){return Object.isFrozen(n)}var j$={};function li(n){const e=j$[n];return e||Zn(0,n),e}var Pa;function Iw(){return Pa}function V$(n,e){return{drafts_:[],parent_:n,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function tE(n,e){e&&(li("Patches"),n.patches_=[],n.inversePatches_=[],n.patchListener_=e)}function Hm(n){Km(n),n.drafts_.forEach(G$),n.drafts_=null}function Km(n){n===Pa&&(Pa=n.parent_)}function nE(n){return Pa=V$(Pa,n)}function G$(n){const e=n[Cn];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function rE(n,e){e.unfinalizedDrafts_=e.drafts_.length;const t=e.drafts_[0];return n!==void 0&&n!==t?(t[Cn].modified_&&(Hm(e),Zn(4)),Yr(n)&&(n=wu(e,n),e.parent_||Au(e,n)),e.patches_&&li("Patches").generateReplacementPatches_(t[Cn].base_,n,e.patches_,e.inversePatches_)):n=wu(e,t,[]),Hm(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),n!==Aw?n:void 0}function wu(n,e,t){if(Qu(e))return e;const r=e[Cn];if(!r)return bu(e,(s,i)=>sE(n,r,e,s,i,t)),e;if(r.scope_!==n)return e;if(!r.modified_)return Au(n,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;const s=r.copy_;let i=s,o=!1;r.type_===3&&(i=new Set(s),s.clear(),o=!0),bu(i,(l,u)=>sE(n,r,s,l,u,t,o)),Au(n,s,!1),t&&n.patches_&&li("Patches").generatePatches_(r,t,n.patches_,n.inversePatches_)}return r.copy_}function sE(n,e,t,r,s,i,o){if(ai(s)){const l=i&&e&&e.type_!==3&&!Vm(e.assigned_,r)?i.concat(r):void 0,u=wu(n,s,l);if(Rw(t,r,u),ai(u))n.canAutoFreeze_=!1;else return}else o&&t.add(s);if(Yr(s)&&!Qu(s)){if(!n.immer_.autoFreeze_&&n.unfinalizedDrafts_<1)return;wu(n,s),(!e||!e.scope_.parent_)&&typeof r!="symbol"&&(qa(t)?t.has(r):Object.prototype.propertyIsEnumerable.call(t,r))&&Au(n,s)}}function Au(n,e,t=!1){!n.parent_&&n.immer_.autoFreeze_&&n.canAutoFreeze_&&rg(e,t)}function H$(n,e){const t=Array.isArray(n),r={type_:t?1:0,scope_:e?e.scope_:Iw(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:n,draft_:null,copy_:null,revoke_:null,isManual_:!1};let s=r,i=sg;t&&(s=[r],i=Da);const{revoke:o,proxy:l}=Proxy.revocable(s,i);return r.draft_=l,r.revoke_=o,l}var sg={get(n,e){if(e===Cn)return n;const t=Qs(n);if(!Vm(t,e))return K$(n,t,e);const r=t[e];return n.finalized_||!Yr(r)?r:r===jh(n.base_,e)?(Vh(n),n.copy_[e]=Wm(r,n)):r},has(n,e){return e in Qs(n)},ownKeys(n){return Reflect.ownKeys(Qs(n))},set(n,e,t){const r=kw(Qs(n),e);if(r?.set)return r.set.call(n.draft_,t),!0;if(!n.modified_){const s=jh(Qs(n),e),i=s?.[Cn];if(i&&i.base_===t)return n.copy_[e]=t,n.assigned_[e]=!1,!0;if($$(t,s)&&(t!==void 0||Vm(n.base_,e)))return!0;Vh(n),zm(n)}return n.copy_[e]===t&&(t!==void 0||e in n.copy_)||Number.isNaN(t)&&Number.isNaN(n.copy_[e])||(n.copy_[e]=t,n.assigned_[e]=!0),!0},deleteProperty(n,e){return jh(n.base_,e)!==void 0||e in n.base_?(n.assigned_[e]=!1,Vh(n),zm(n)):delete n.assigned_[e],n.copy_&&delete n.copy_[e],!0},getOwnPropertyDescriptor(n,e){const t=Qs(n),r=Reflect.getOwnPropertyDescriptor(t,e);return r&&{writable:!0,configurable:n.type_!==1||e!=="length",enumerable:r.enumerable,value:t[e]}},defineProperty(){Zn(11)},getPrototypeOf(n){return eo(n.base_)},setPrototypeOf(){Zn(12)}},Da={};bu(sg,(n,e)=>{Da[n]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}});Da.deleteProperty=function(n,e){return Da.set.call(this,n,e,void 0)};Da.set=function(n,e,t){return sg.set.call(this,n[0],e,t,n[0])};function jh(n,e){const t=n[Cn];return(t?Qs(t):n)[e]}function K$(n,e,t){const r=kw(e,t);return r?"value"in r?r.value:r.get?.call(n.draft_):void 0}function kw(n,e){if(!(e in n))return;let t=eo(n);for(;t;){const r=Object.getOwnPropertyDescriptor(t,e);if(r)return r;t=eo(t)}}function zm(n){n.modified_||(n.modified_=!0,n.parent_&&zm(n.parent_))}function Vh(n){n.copy_||(n.copy_=Gm(n.base_,n.scope_.immer_.useStrictShallowCopy_))}var z$=class{constructor(n){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,r)=>{if(typeof e=="function"&&typeof t!="function"){const i=t;t=e;const o=this;return function(u=i,...d){return o.produce(u,f=>t.call(this,f,...d))}}typeof t!="function"&&Zn(6),r!==void 0&&typeof r!="function"&&Zn(7);let s;if(Yr(e)){const i=nE(this),o=Wm(e,void 0);let l=!0;try{s=t(o),l=!1}finally{l?Hm(i):Km(i)}return tE(i,r),rE(s,i)}else if(!e||typeof e!="object"){if(s=t(e),s===void 0&&(s=e),s===Aw&&(s=void 0),this.autoFreeze_&&rg(s,!0),r){const i=[],o=[];li("Patches").generateReplacementPatches_(e,s,i,o),r(i,o)}return s}else Zn(1,e)},this.produceWithPatches=(e,t)=>{if(typeof e=="function")return(o,...l)=>this.produceWithPatches(o,u=>e(u,...l));let r,s;return[this.produce(e,t,(o,l)=>{r=o,s=l}),r,s]},typeof n?.autoFreeze=="boolean"&&this.setAutoFreeze(n.autoFreeze),typeof n?.useStrictShallowCopy=="boolean"&&this.setUseStrictShallowCopy(n.useStrictShallowCopy)}createDraft(n){Yr(n)||Zn(8),ai(n)&&(n=W$(n));const e=nE(this),t=Wm(n,void 0);return t[Cn].isManual_=!0,Km(e),t}finishDraft(n,e){const t=n&&n[Cn];(!t||!t.isManual_)&&Zn(9);const{scope_:r}=t;return tE(r,e),rE(void 0,r)}setAutoFreeze(n){this.autoFreeze_=n}setUseStrictShallowCopy(n){this.useStrictShallowCopy_=n}applyPatches(n,e){let t;for(t=e.length-1;t>=0;t--){const s=e[t];if(s.path.length===0&&s.op==="replace"){n=s.value;break}}t>-1&&(e=e.slice(t+1));const r=li("Patches").applyPatches_;return ai(n)?r(n,e):this.produce(n,s=>r(s,e))}};function Wm(n,e){const t=qa(n)?li("MapSet").proxyMap_(n,e):Xu(n)?li("MapSet").proxySet_(n,e):H$(n,e);return(e?e.scope_:Iw()).drafts_.push(t),t}function W$(n){return ai(n)||Zn(10,n),Cw(n)}function Cw(n){if(!Yr(n)||Qu(n))return n;const e=n[Cn];let t;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,t=Gm(n,e.scope_.immer_.useStrictShallowCopy_)}else t=Gm(n,!0);return bu(t,(r,s)=>{Rw(t,r,Cw(s))}),e&&(e.finalized_=!1),t}var Y$=new z$,_w=Y$.produce;function Pw(n){return({dispatch:t,getState:r})=>s=>i=>typeof i=="function"?i(t,r,n):s(i)}var q$=Pw(),X$=Pw,Q$=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?Tu:Tu.apply(null,arguments)};function iE(n,e){function t(...r){if(e){let s=e(...r);if(!s)throw new Error(Kr(0));return{type:n,payload:s.payload,..."meta"in s&&{meta:s.meta},..."error"in s&&{error:s.error}}}return{type:n,payload:r[0]}}return t.toString=()=>`${n}`,t.type=n,t.match=r=>B$(r)&&r.type===n,t}var Dw=class oa extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,oa.prototype)}static get[Symbol.species](){return oa}concat(...e){return super.concat.apply(this,e)}prepend(...e){return e.length===1&&Array.isArray(e[0])?new oa(...e[0].concat(this)):new oa(...e.concat(this))}};function oE(n){return Yr(n)?_w(n,()=>{}):n}function _c(n,e,t){return n.has(e)?n.get(e):n.set(e,t(e)).get(e)}function J$(n){return typeof n=="boolean"}var Z$=()=>function(e){const{thunk:t=!0,immutableCheck:r=!0,serializableCheck:s=!0,actionCreatorCheck:i=!0}=e??{};let o=new Dw;return t&&(J$(t)?o.push(q$):o.push(X$(t.extraArgument))),o},ej="RTK_autoBatch",aE=n=>e=>{setTimeout(e,n)},tj=(n={type:"raf"})=>e=>(...t)=>{const r=e(...t);let s=!0,i=!1,o=!1;const l=new Set,u=n.type==="tick"?queueMicrotask:n.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:aE(10):n.type==="callback"?n.queueNotification:aE(n.timeout),d=()=>{o=!1,i&&(i=!1,l.forEach(f=>f()))};return Object.assign({},r,{subscribe(f){const h=()=>s&&f(),p=r.subscribe(h);return l.add(f),()=>{p(),l.delete(f)}},dispatch(f){try{return s=!f?.meta?.[ej],i=!s,i&&(o||(o=!0,u(d))),r.dispatch(f)}finally{s=!0}}})},nj=n=>function(t){const{autoBatch:r=!0}=t??{};let s=new Dw(n);return r&&s.push(tj(typeof r=="object"?r:void 0)),s};function rj(n){const e=Z$(),{reducer:t=void 0,middleware:r,devTools:s=!0,preloadedState:i=void 0,enhancers:o=void 0}=n||{};let l;if(typeof t=="function")l=t;else if(ng(t))l=M$(t);else throw new Error(Kr(1));let u;typeof r=="function"?u=r(e):u=e();let d=Tu;s&&(d=Q$({trace:!1,...typeof s=="object"&&s}));const f=F$(...u),h=nj(f);let p=typeof o=="function"?o(h):h();const x=d(...p);return ww(l,i,x)}function Nw(n){const e={},t=[];let r;const s={addCase(i,o){const l=typeof i=="string"?i:i.type;if(!l)throw new Error(Kr(28));if(l in e)throw new Error(Kr(29));return e[l]=o,s},addAsyncThunk(i,o){return o.pending&&(e[i.pending.type]=o.pending),o.rejected&&(e[i.rejected.type]=o.rejected),o.fulfilled&&(e[i.fulfilled.type]=o.fulfilled),o.settled&&t.push({matcher:i.settled,reducer:o.settled}),s},addMatcher(i,o){return t.push({matcher:i,reducer:o}),s},addDefaultCase(i){return r=i,s}};return n(s),[e,t,r]}function sj(n){return typeof n=="function"}function ij(n,e){let[t,r,s]=Nw(e),i;if(sj(n))i=()=>oE(n());else{const l=oE(n);i=()=>l}function o(l=i(),u){let d=[t[u.type],...r.filter(({matcher:f})=>f(u)).map(({reducer:f})=>f)];return d.filter(f=>!!f).length===0&&(d=[s]),d.reduce((f,h)=>{if(h)if(ai(f)){const x=h(f,u);return x===void 0?f:x}else{if(Yr(f))return _w(f,p=>h(p,u));{const p=h(f,u);if(p===void 0){if(f===null)return f;throw Error("A case reducer on a non-draftable value must not return undefined")}return p}}return f},l)}return o.getInitialState=i,o}var oj=Symbol.for("rtk-slice-createasyncthunk");function aj(n,e){return`${n}/${e}`}function lj({creators:n}={}){const e=n?.asyncThunk?.[oj];return function(r){const{name:s,reducerPath:i=s}=r;if(!s)throw new Error(Kr(11));const o=(typeof r.reducers=="function"?r.reducers(dj()):r.reducers)||{},l=Object.keys(o),u={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},d={addCase(L,I){const _=typeof L=="string"?L:L.type;if(!_)throw new Error(Kr(12));if(_ in u.sliceCaseReducersByType)throw new Error(Kr(13));return u.sliceCaseReducersByType[_]=I,d},addMatcher(L,I){return u.sliceMatchers.push({matcher:L,reducer:I}),d},exposeAction(L,I){return u.actionCreators[L]=I,d},exposeCaseReducer(L,I){return u.sliceCaseReducersByName[L]=I,d}};l.forEach(L=>{const I=o[L],_={reducerName:L,type:aj(s,L),createNotation:typeof r.reducers=="function"};hj(I)?pj(_,I,d,e):fj(_,I,d)});function f(){const[L={},I=[],_=void 0]=typeof r.extraReducers=="function"?Nw(r.extraReducers):[r.extraReducers],F={...L,...u.sliceCaseReducersByType};return ij(r.initialState,C=>{for(let P in F)C.addCase(P,F[P]);for(let P of u.sliceMatchers)C.addMatcher(P.matcher,P.reducer);for(let P of I)C.addMatcher(P.matcher,P.reducer);_&&C.addDefaultCase(_)})}const h=L=>L,p=new Map,x=new WeakMap;let g;function E(L,I){return g||(g=f()),g(L,I)}function v(){return g||(g=f()),g.getInitialState()}function b(L,I=!1){function _(C){let P=C[L];return typeof P>"u"&&I&&(P=_c(x,_,v)),P}function F(C=h){const P=_c(p,I,()=>new WeakMap);return _c(P,C,()=>{const O={};for(const[M,H]of Object.entries(r.selectors??{}))O[M]=cj(H,C,()=>_c(x,C,v),I);return O})}return{reducerPath:L,getSelectors:F,get selectors(){return F(_)},selectSlice:_}}const A={name:s,reducer:E,actions:u.actionCreators,caseReducers:u.sliceCaseReducersByName,getInitialState:v,...b(i),injectInto(L,{reducerPath:I,..._}={}){const F=I??i;return L.inject({reducerPath:F,reducer:E},_),{...A,...b(F,!0)}}};return A}}function cj(n,e,t,r){function s(i,...o){let l=e(i);return typeof l>"u"&&r&&(l=t()),n(l,...o)}return s.unwrapped=n,s}var uj=lj();function dj(){function n(e,t){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...t}}return n.withTypes=()=>n,{reducer(e){return Object.assign({[e.name](...t){return e(...t)}}[e.name],{_reducerDefinitionType:"reducer"})},preparedReducer(e,t){return{_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:t}},asyncThunk:n}}function fj({type:n,reducerName:e,createNotation:t},r,s){let i,o;if("reducer"in r){if(t&&!mj(r))throw new Error(Kr(17));i=r.reducer,o=r.prepare}else i=r;s.addCase(n,i).exposeCaseReducer(e,i).exposeAction(e,o?iE(n,o):iE(n))}function hj(n){return n._reducerDefinitionType==="asyncThunk"}function mj(n){return n._reducerDefinitionType==="reducerWithPrepare"}function pj({type:n,reducerName:e},t,r,s){if(!s)throw new Error(Kr(18));const{payloadCreator:i,fulfilled:o,pending:l,rejected:u,settled:d,options:f}=t,h=s(n,i,f);r.exposeAction(e,h),o&&r.addCase(h.fulfilled,o),l&&r.addCase(h.pending,l),u&&r.addCase(h.rejected,u),d&&r.addMatcher(h.settled,d),r.exposeCaseReducer(e,{fulfilled:o||Pc,pending:l||Pc,rejected:u||Pc,settled:d||Pc})}function Pc(){}function Kr(n){return`Minified Redux Toolkit error #${n}; visit https://redux-toolkit.js.org/Errors?code=${n} for the full message or use the non-minified dev environment for full errors. `}const gj={isScrolled:!1,isSearchActive:!1,searchQuery:"",isSearching:!1,isProfileOpen:!1,isNotificationOpen:!1,isMoviesMenuOpen:!1,isQuickActionsOpen:!1,searchHistory:[]},Ow=uj({name:"ui",initialState:gj,reducers:{setScrolled(n,e){n.isScrolled=e.payload},setSearchActive(n,e){n.isSearchActive=e.payload},toggleSearch(n){n.isSearchActive=!n.isSearchActive},setSearchQuery(n,e){n.searchQuery=e.payload},setSearching(n,e){n.isSearching=e.payload},toggleProfile(n){n.isProfileOpen=!n.isProfileOpen},toggleNotification(n){n.isNotificationOpen=!n.isNotificationOpen},toggleMoviesMenu(n){n.isMoviesMenuOpen=!n.isMoviesMenuOpen},setMoviesMenu(n,e){n.isMoviesMenuOpen=e.payload},toggleQuickActions(n){n.isQuickActionsOpen=!n.isQuickActionsOpen},setQuickActions(n,e){n.isQuickActionsOpen=e.payload},addSearchHistory(n,e){const t=e.payload.trim();if(!t)return;const r=n.searchHistory.findIndex(s=>s.toLowerCase()===t.toLowerCase());r!==-1&&n.searchHistory.splice(r,1),n.searchHistory.unshift(t),n.searchHistory.length>6&&(n.searchHistory=n.searchHistory.slice(0,6))},removeSearchHistoryItem(n,e){n.searchHistory=n.searchHistory.filter(t=>t.toLowerCase()!==e.payload.trim().toLowerCase())},clearSearchHistory(n){n.searchHistory=[]},closeAllOverlays(n){n.isSearchActive=!1,n.isProfileOpen=!1,n.isNotificationOpen=!1,n.isMoviesMenuOpen=!1,n.isQuickActionsOpen=!1}}}),{setScrolled:$j,setSearchActive:jj,toggleSearch:Vj,setSearchQuery:Gj,setSearching:Hj,toggleProfile:Kj,toggleNotification:zj,toggleMoviesMenu:Wj,setMoviesMenu:Yj,toggleQuickActions:qj,setQuickActions:Xj,addSearchHistory:Qj,removeSearchHistoryItem:Jj,clearSearchHistory:Zj,closeAllOverlays:e3}=Ow.actions,yj=Ow.reducer,xj=rj({reducer:{ui:yj}});FL.createRoot(document.getElementById("root")).render(S.jsx(Rn.StrictMode,{children:S.jsx(eR,{store:xj,children:S.jsx(P$,{})})}));
