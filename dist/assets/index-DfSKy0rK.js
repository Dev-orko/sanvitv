(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function aE(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Of={exports:{}},Xo={},Mf={exports:{}},Ve={};var My;function IL(){if(My)return Ve;My=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),i=Symbol.for("react.provider"),o=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),h=Symbol.iterator;function p(D){return D===null||typeof D!="object"?null:(D=h&&D[h]||D["@@iterator"],typeof D=="function"?D:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,S={};function x(D,$,ie){this.props=D,this.context=$,this.refs=S,this.updater=ie||v}x.prototype.isReactComponent={},x.prototype.setState=function(D,$){if(typeof D!="object"&&typeof D!="function"&&D!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,D,$,"setState")},x.prototype.forceUpdate=function(D){this.updater.enqueueForceUpdate(this,D,"forceUpdate")};function b(){}b.prototype=x.prototype;function A(D,$,ie){this.props=D,this.context=$,this.refs=S,this.updater=ie||v}var L=A.prototype=new b;L.constructor=A,g(L,x.prototype),L.isPureReactComponent=!0;var I=Array.isArray,k=Object.prototype.hasOwnProperty,F={current:null},C={key:!0,ref:!0,__self:!0,__source:!0};function P(D,$,ie){var ue,ce={},fe=null,Ee=null;if($!=null)for(ue in $.ref!==void 0&&(Ee=$.ref),$.key!==void 0&&(fe=""+$.key),$)k.call($,ue)&&!C.hasOwnProperty(ue)&&(ce[ue]=$[ue]);var ye=arguments.length-2;if(ye===1)ce.children=ie;else if(1<ye){for(var Le=Array(ye),ke=0;ke<ye;ke++)Le[ke]=arguments[ke+2];ce.children=Le}if(D&&D.defaultProps)for(ue in ye=D.defaultProps,ye)ce[ue]===void 0&&(ce[ue]=ye[ue]);return{$$typeof:n,type:D,key:fe,ref:Ee,props:ce,_owner:F.current}}function O(D,$){return{$$typeof:n,type:D.type,key:$,ref:D.ref,props:D.props,_owner:D._owner}}function M(D){return typeof D=="object"&&D!==null&&D.$$typeof===n}function H(D){var $={"=":"=0",":":"=2"};return"$"+D.replace(/[=:]/g,function(ie){return $[ie]})}var Z=/\/+/g;function se(D,$){return typeof D=="object"&&D!==null&&D.key!=null?H(""+D.key):$.toString(36)}function U(D,$,ie,ue,ce){var fe=typeof D;(fe==="undefined"||fe==="boolean")&&(D=null);var Ee=!1;if(D===null)Ee=!0;else switch(fe){case"string":case"number":Ee=!0;break;case"object":switch(D.$$typeof){case n:case e:Ee=!0}}if(Ee)return Ee=D,ce=ce(Ee),D=ue===""?"."+se(Ee,0):ue,I(ce)?(ie="",D!=null&&(ie=D.replace(Z,"$&/")+"/"),U(ce,$,ie,"",function(ke){return ke})):ce!=null&&(M(ce)&&(ce=O(ce,ie+(!ce.key||Ee&&Ee.key===ce.key?"":(""+ce.key).replace(Z,"$&/")+"/")+D)),$.push(ce)),1;if(Ee=0,ue=ue===""?".":ue+":",I(D))for(var ye=0;ye<D.length;ye++){fe=D[ye];var Le=ue+se(fe,ye);Ee+=U(fe,$,ie,Le,ce)}else if(Le=p(D),typeof Le=="function")for(D=Le.call(D),ye=0;!(fe=D.next()).done;)fe=fe.value,Le=ue+se(fe,ye++),Ee+=U(fe,$,ie,Le,ce);else if(fe==="object")throw $=String(D),Error("Objects are not valid as a React child (found: "+($==="[object Object]"?"object with keys {"+Object.keys(D).join(", ")+"}":$)+"). If you meant to render a collection of children, use an array instead.");return Ee}function ne(D,$,ie){if(D==null)return D;var ue=[],ce=0;return U(D,ue,"","",function(fe){return $.call(ie,fe,ce++)}),ue}function q(D){if(D._status===-1){var $=D._result;$=$(),$.then(function(ie){(D._status===0||D._status===-1)&&(D._status=1,D._result=ie)},function(ie){(D._status===0||D._status===-1)&&(D._status=2,D._result=ie)}),D._status===-1&&(D._status=0,D._result=$)}if(D._status===1)return D._result.default;throw D._result}var te={current:null},G={transition:null},Q={ReactCurrentDispatcher:te,ReactCurrentBatchConfig:G,ReactCurrentOwner:F};function ee(){throw Error("act(...) is not supported in production builds of React.")}return Ve.Children={map:ne,forEach:function(D,$,ie){ne(D,function(){$.apply(this,arguments)},ie)},count:function(D){var $=0;return ne(D,function(){$++}),$},toArray:function(D){return ne(D,function($){return $})||[]},only:function(D){if(!M(D))throw Error("React.Children.only expected to receive a single React element child.");return D}},Ve.Component=x,Ve.Fragment=t,Ve.Profiler=s,Ve.PureComponent=A,Ve.StrictMode=r,Ve.Suspense=c,Ve.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Q,Ve.act=ee,Ve.cloneElement=function(D,$,ie){if(D==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+D+".");var ue=g({},D.props),ce=D.key,fe=D.ref,Ee=D._owner;if($!=null){if($.ref!==void 0&&(fe=$.ref,Ee=F.current),$.key!==void 0&&(ce=""+$.key),D.type&&D.type.defaultProps)var ye=D.type.defaultProps;for(Le in $)k.call($,Le)&&!C.hasOwnProperty(Le)&&(ue[Le]=$[Le]===void 0&&ye!==void 0?ye[Le]:$[Le])}var Le=arguments.length-2;if(Le===1)ue.children=ie;else if(1<Le){ye=Array(Le);for(var ke=0;ke<Le;ke++)ye[ke]=arguments[ke+2];ue.children=ye}return{$$typeof:n,type:D.type,key:ce,ref:fe,props:ue,_owner:Ee}},Ve.createContext=function(D){return D={$$typeof:o,_currentValue:D,_currentValue2:D,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},D.Provider={$$typeof:i,_context:D},D.Consumer=D},Ve.createElement=P,Ve.createFactory=function(D){var $=P.bind(null,D);return $.type=D,$},Ve.createRef=function(){return{current:null}},Ve.forwardRef=function(D){return{$$typeof:l,render:D}},Ve.isValidElement=M,Ve.lazy=function(D){return{$$typeof:f,_payload:{_status:-1,_result:D},_init:q}},Ve.memo=function(D,$){return{$$typeof:d,type:D,compare:$===void 0?null:$}},Ve.startTransition=function(D){var $=G.transition;G.transition={};try{D()}finally{G.transition=$}},Ve.unstable_act=ee,Ve.useCallback=function(D,$){return te.current.useCallback(D,$)},Ve.useContext=function(D){return te.current.useContext(D)},Ve.useDebugValue=function(){},Ve.useDeferredValue=function(D){return te.current.useDeferredValue(D)},Ve.useEffect=function(D,$){return te.current.useEffect(D,$)},Ve.useId=function(){return te.current.useId()},Ve.useImperativeHandle=function(D,$,ie){return te.current.useImperativeHandle(D,$,ie)},Ve.useInsertionEffect=function(D,$){return te.current.useInsertionEffect(D,$)},Ve.useLayoutEffect=function(D,$){return te.current.useLayoutEffect(D,$)},Ve.useMemo=function(D,$){return te.current.useMemo(D,$)},Ve.useReducer=function(D,$,ie){return te.current.useReducer(D,$,ie)},Ve.useRef=function(D){return te.current.useRef(D)},Ve.useState=function(D){return te.current.useState(D)},Ve.useSyncExternalStore=function(D,$,ie){return te.current.useSyncExternalStore(D,$,ie)},Ve.useTransition=function(){return te.current.useTransition()},Ve.version="18.3.1",Ve}var Fy;function Ma(){return Fy||(Fy=1,Mf.exports=IL()),Mf.exports}var By;function _L(){if(By)return Xo;By=1;var n=Ma(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,s=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function o(l,c,d){var f,h={},p=null,v=null;d!==void 0&&(p=""+d),c.key!==void 0&&(p=""+c.key),c.ref!==void 0&&(v=c.ref);for(f in c)r.call(c,f)&&!i.hasOwnProperty(f)&&(h[f]=c[f]);if(l&&l.defaultProps)for(f in c=l.defaultProps,c)h[f]===void 0&&(h[f]=c[f]);return{$$typeof:e,type:l,key:p,ref:v,props:h,_owner:s.current}}return Xo.Fragment=t,Xo.jsx=o,Xo.jsxs=o,Xo}var Uy;function CL(){return Uy||(Uy=1,Of.exports=_L()),Of.exports}var E=CL(),N=Ma();const Ln=aE(N);var au={},Ff={exports:{}},on={},Bf={exports:{}},Uf={};var $y;function kL(){return $y||($y=1,(function(n){function e(G,Q){var ee=G.length;G.push(Q);e:for(;0<ee;){var D=ee-1>>>1,$=G[D];if(0<s($,Q))G[D]=Q,G[ee]=$,ee=D;else break e}}function t(G){return G.length===0?null:G[0]}function r(G){if(G.length===0)return null;var Q=G[0],ee=G.pop();if(ee!==Q){G[0]=ee;e:for(var D=0,$=G.length,ie=$>>>1;D<ie;){var ue=2*(D+1)-1,ce=G[ue],fe=ue+1,Ee=G[fe];if(0>s(ce,ee))fe<$&&0>s(Ee,ce)?(G[D]=Ee,G[fe]=ee,D=fe):(G[D]=ce,G[ue]=ee,D=ue);else if(fe<$&&0>s(Ee,ee))G[D]=Ee,G[fe]=ee,D=fe;else break e}}return Q}function s(G,Q){var ee=G.sortIndex-Q.sortIndex;return ee!==0?ee:G.id-Q.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,l=o.now();n.unstable_now=function(){return o.now()-l}}var c=[],d=[],f=1,h=null,p=3,v=!1,g=!1,S=!1,x=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function L(G){for(var Q=t(d);Q!==null;){if(Q.callback===null)r(d);else if(Q.startTime<=G)r(d),Q.sortIndex=Q.expirationTime,e(c,Q);else break;Q=t(d)}}function I(G){if(S=!1,L(G),!g)if(t(c)!==null)g=!0,q(k);else{var Q=t(d);Q!==null&&te(I,Q.startTime-G)}}function k(G,Q){g=!1,S&&(S=!1,b(P),P=-1),v=!0;var ee=p;try{for(L(Q),h=t(c);h!==null&&(!(h.expirationTime>Q)||G&&!H());){var D=h.callback;if(typeof D=="function"){h.callback=null,p=h.priorityLevel;var $=D(h.expirationTime<=Q);Q=n.unstable_now(),typeof $=="function"?h.callback=$:h===t(c)&&r(c),L(Q)}else r(c);h=t(c)}if(h!==null)var ie=!0;else{var ue=t(d);ue!==null&&te(I,ue.startTime-Q),ie=!1}return ie}finally{h=null,p=ee,v=!1}}var F=!1,C=null,P=-1,O=5,M=-1;function H(){return!(n.unstable_now()-M<O)}function Z(){if(C!==null){var G=n.unstable_now();M=G;var Q=!0;try{Q=C(!0,G)}finally{Q?se():(F=!1,C=null)}}else F=!1}var se;if(typeof A=="function")se=function(){A(Z)};else if(typeof MessageChannel<"u"){var U=new MessageChannel,ne=U.port2;U.port1.onmessage=Z,se=function(){ne.postMessage(null)}}else se=function(){x(Z,0)};function q(G){C=G,F||(F=!0,se())}function te(G,Q){P=x(function(){G(n.unstable_now())},Q)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(G){G.callback=null},n.unstable_continueExecution=function(){g||v||(g=!0,q(k))},n.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<G?Math.floor(1e3/G):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_getFirstCallbackNode=function(){return t(c)},n.unstable_next=function(G){switch(p){case 1:case 2:case 3:var Q=3;break;default:Q=p}var ee=p;p=Q;try{return G()}finally{p=ee}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(G,Q){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var ee=p;p=G;try{return Q()}finally{p=ee}},n.unstable_scheduleCallback=function(G,Q,ee){var D=n.unstable_now();switch(typeof ee=="object"&&ee!==null?(ee=ee.delay,ee=typeof ee=="number"&&0<ee?D+ee:D):ee=D,G){case 1:var $=-1;break;case 2:$=250;break;case 5:$=1073741823;break;case 4:$=1e4;break;default:$=5e3}return $=ee+$,G={id:f++,callback:Q,priorityLevel:G,startTime:ee,expirationTime:$,sortIndex:-1},ee>D?(G.sortIndex=ee,e(d,G),t(c)===null&&G===t(d)&&(S?(b(P),P=-1):S=!0,te(I,ee-D))):(G.sortIndex=$,e(c,G),g||v||(g=!0,q(k))),G},n.unstable_shouldYield=H,n.unstable_wrapCallback=function(G){var Q=p;return function(){var ee=p;p=Q;try{return G.apply(this,arguments)}finally{p=ee}}}})(Uf)),Uf}var jy;function PL(){return jy||(jy=1,Bf.exports=kL()),Bf.exports}var Vy;function DL(){if(Vy)return on;Vy=1;var n=Ma(),e=PL();function t(a){for(var u="https://reactjs.org/docs/error-decoder.html?invariant="+a,m=1;m<arguments.length;m++)u+="&args[]="+encodeURIComponent(arguments[m]);return"Minified React error #"+a+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,s={};function i(a,u){o(a,u),o(a+"Capture",u)}function o(a,u){for(s[a]=u,a=0;a<u.length;a++)r.add(u[a])}var l=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),c=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},h={};function p(a){return c.call(h,a)?!0:c.call(f,a)?!1:d.test(a)?h[a]=!0:(f[a]=!0,!1)}function v(a,u,m,y){if(m!==null&&m.type===0)return!1;switch(typeof u){case"function":case"symbol":return!0;case"boolean":return y?!1:m!==null?!m.acceptsBooleans:(a=a.toLowerCase().slice(0,5),a!=="data-"&&a!=="aria-");default:return!1}}function g(a,u,m,y){if(u===null||typeof u>"u"||v(a,u,m,y))return!0;if(y)return!1;if(m!==null)switch(m.type){case 3:return!u;case 4:return u===!1;case 5:return isNaN(u);case 6:return isNaN(u)||1>u}return!1}function S(a,u,m,y,T,w,_){this.acceptsBooleans=u===2||u===3||u===4,this.attributeName=y,this.attributeNamespace=T,this.mustUseProperty=m,this.propertyName=a,this.type=u,this.sanitizeURL=w,this.removeEmptyString=_}var x={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){x[a]=new S(a,0,!1,a,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var u=a[0];x[u]=new S(u,1,!1,a[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(a){x[a]=new S(a,2,!1,a.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){x[a]=new S(a,2,!1,a,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){x[a]=new S(a,3,!1,a.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(a){x[a]=new S(a,3,!0,a,null,!1,!1)}),["capture","download"].forEach(function(a){x[a]=new S(a,4,!1,a,null,!1,!1)}),["cols","rows","size","span"].forEach(function(a){x[a]=new S(a,6,!1,a,null,!1,!1)}),["rowSpan","start"].forEach(function(a){x[a]=new S(a,5,!1,a.toLowerCase(),null,!1,!1)});var b=/[\-:]([a-z])/g;function A(a){return a[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var u=a.replace(b,A);x[u]=new S(u,1,!1,a,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var u=a.replace(b,A);x[u]=new S(u,1,!1,a,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(a){var u=a.replace(b,A);x[u]=new S(u,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(a){x[a]=new S(a,1,!1,a.toLowerCase(),null,!1,!1)}),x.xlinkHref=new S("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(a){x[a]=new S(a,1,!1,a.toLowerCase(),null,!0,!0)});function L(a,u,m,y){var T=x.hasOwnProperty(u)?x[u]:null;(T!==null?T.type!==0:y||!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(g(u,m,T,y)&&(m=null),y||T===null?p(u)&&(m===null?a.removeAttribute(u):a.setAttribute(u,""+m)):T.mustUseProperty?a[T.propertyName]=m===null?T.type===3?!1:"":m:(u=T.attributeName,y=T.attributeNamespace,m===null?a.removeAttribute(u):(T=T.type,m=T===3||T===4&&m===!0?"":""+m,y?a.setAttributeNS(y,u,m):a.setAttribute(u,m))))}var I=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,k=Symbol.for("react.element"),F=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),P=Symbol.for("react.strict_mode"),O=Symbol.for("react.profiler"),M=Symbol.for("react.provider"),H=Symbol.for("react.context"),Z=Symbol.for("react.forward_ref"),se=Symbol.for("react.suspense"),U=Symbol.for("react.suspense_list"),ne=Symbol.for("react.memo"),q=Symbol.for("react.lazy"),te=Symbol.for("react.offscreen"),G=Symbol.iterator;function Q(a){return a===null||typeof a!="object"?null:(a=G&&a[G]||a["@@iterator"],typeof a=="function"?a:null)}var ee=Object.assign,D;function $(a){if(D===void 0)try{throw Error()}catch(m){var u=m.stack.trim().match(/\n( *(at )?)/);D=u&&u[1]||""}return`
`+D+a}var ie=!1;function ue(a,u){if(!a||ie)return"";ie=!0;var m=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(u)if(u=function(){throw Error()},Object.defineProperty(u.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(u,[])}catch(X){var y=X}Reflect.construct(a,[],u)}else{try{u.call()}catch(X){y=X}a.call(u.prototype)}else{try{throw Error()}catch(X){y=X}a()}}catch(X){if(X&&y&&typeof X.stack=="string"){for(var T=X.stack.split(`
`),w=y.stack.split(`
`),_=T.length-1,B=w.length-1;1<=_&&0<=B&&T[_]!==w[B];)B--;for(;1<=_&&0<=B;_--,B--)if(T[_]!==w[B]){if(_!==1||B!==1)do if(_--,B--,0>B||T[_]!==w[B]){var j=`
`+T[_].replace(" at new "," at ");return a.displayName&&j.includes("<anonymous>")&&(j=j.replace("<anonymous>",a.displayName)),j}while(1<=_&&0<=B);break}}}finally{ie=!1,Error.prepareStackTrace=m}return(a=a?a.displayName||a.name:"")?$(a):""}function ce(a){switch(a.tag){case 5:return $(a.type);case 16:return $("Lazy");case 13:return $("Suspense");case 19:return $("SuspenseList");case 0:case 2:case 15:return a=ue(a.type,!1),a;case 11:return a=ue(a.type.render,!1),a;case 1:return a=ue(a.type,!0),a;default:return""}}function fe(a){if(a==null)return null;if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case C:return"Fragment";case F:return"Portal";case O:return"Profiler";case P:return"StrictMode";case se:return"Suspense";case U:return"SuspenseList"}if(typeof a=="object")switch(a.$$typeof){case H:return(a.displayName||"Context")+".Consumer";case M:return(a._context.displayName||"Context")+".Provider";case Z:var u=a.render;return a=a.displayName,a||(a=u.displayName||u.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case ne:return u=a.displayName||null,u!==null?u:fe(a.type)||"Memo";case q:u=a._payload,a=a._init;try{return fe(a(u))}catch{}}return null}function Ee(a){var u=a.type;switch(a.tag){case 24:return"Cache";case 9:return(u.displayName||"Context")+".Consumer";case 10:return(u._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return a=u.render,a=a.displayName||a.name||"",u.displayName||(a!==""?"ForwardRef("+a+")":"ForwardRef");case 7:return"Fragment";case 5:return u;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return fe(u);case 8:return u===P?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof u=="function")return u.displayName||u.name||null;if(typeof u=="string")return u}return null}function ye(a){switch(typeof a){case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function Le(a){var u=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(u==="checkbox"||u==="radio")}function ke(a){var u=Le(a)?"checked":"value",m=Object.getOwnPropertyDescriptor(a.constructor.prototype,u),y=""+a[u];if(!a.hasOwnProperty(u)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var T=m.get,w=m.set;return Object.defineProperty(a,u,{configurable:!0,get:function(){return T.call(this)},set:function(_){y=""+_,w.call(this,_)}}),Object.defineProperty(a,u,{enumerable:m.enumerable}),{getValue:function(){return y},setValue:function(_){y=""+_},stopTracking:function(){a._valueTracker=null,delete a[u]}}}}function Pe(a){a._valueTracker||(a._valueTracker=ke(a))}function Te(a){if(!a)return!1;var u=a._valueTracker;if(!u)return!0;var m=u.getValue(),y="";return a&&(y=Le(a)?a.checked?"true":"false":a.value),a=y,a!==m?(u.setValue(a),!0):!1}function xe(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}function Re(a,u){var m=u.checked;return ee({},u,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:m??a._wrapperState.initialChecked})}function $e(a,u){var m=u.defaultValue==null?"":u.defaultValue,y=u.checked!=null?u.checked:u.defaultChecked;m=ye(u.value!=null?u.value:m),a._wrapperState={initialChecked:y,initialValue:m,controlled:u.type==="checkbox"||u.type==="radio"?u.checked!=null:u.value!=null}}function me(a,u){u=u.checked,u!=null&&L(a,"checked",u,!1)}function Me(a,u){me(a,u);var m=ye(u.value),y=u.type;if(m!=null)y==="number"?(m===0&&a.value===""||a.value!=m)&&(a.value=""+m):a.value!==""+m&&(a.value=""+m);else if(y==="submit"||y==="reset"){a.removeAttribute("value");return}u.hasOwnProperty("value")?je(a,u.type,m):u.hasOwnProperty("defaultValue")&&je(a,u.type,ye(u.defaultValue)),u.checked==null&&u.defaultChecked!=null&&(a.defaultChecked=!!u.defaultChecked)}function qe(a,u,m){if(u.hasOwnProperty("value")||u.hasOwnProperty("defaultValue")){var y=u.type;if(!(y!=="submit"&&y!=="reset"||u.value!==void 0&&u.value!==null))return;u=""+a._wrapperState.initialValue,m||u===a.value||(a.value=u),a.defaultValue=u}m=a.name,m!==""&&(a.name=""),a.defaultChecked=!!a._wrapperState.initialChecked,m!==""&&(a.name=m)}function je(a,u,m){(u!=="number"||xe(a.ownerDocument)!==a)&&(m==null?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+m&&(a.defaultValue=""+m))}var Be=Array.isArray;function Xe(a,u,m,y){if(a=a.options,u){u={};for(var T=0;T<m.length;T++)u["$"+m[T]]=!0;for(m=0;m<a.length;m++)T=u.hasOwnProperty("$"+a[m].value),a[m].selected!==T&&(a[m].selected=T),T&&y&&(a[m].defaultSelected=!0)}else{for(m=""+ye(m),u=null,T=0;T<a.length;T++){if(a[T].value===m){a[T].selected=!0,y&&(a[T].defaultSelected=!0);return}u!==null||a[T].disabled||(u=a[T])}u!==null&&(u.selected=!0)}}function Ct(a,u){if(u.dangerouslySetInnerHTML!=null)throw Error(t(91));return ee({},u,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}function Cn(a,u){var m=u.value;if(m==null){if(m=u.children,u=u.defaultValue,m!=null){if(u!=null)throw Error(t(92));if(Be(m)){if(1<m.length)throw Error(t(93));m=m[0]}u=m}u==null&&(u=""),m=u}a._wrapperState={initialValue:ye(m)}}function mn(a,u){var m=ye(u.value),y=ye(u.defaultValue);m!=null&&(m=""+m,m!==a.value&&(a.value=m),u.defaultValue==null&&a.defaultValue!==m&&(a.defaultValue=m)),y!=null&&(a.defaultValue=""+y)}function vt(a){var u=a.textContent;u===a._wrapperState.initialValue&&u!==""&&u!==null&&(a.value=u)}function bt(a){switch(a){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function pn(a,u){return a==null||a==="http://www.w3.org/1999/xhtml"?bt(u):a==="http://www.w3.org/2000/svg"&&u==="foreignObject"?"http://www.w3.org/1999/xhtml":a}var tr,gn=(function(a){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(u,m,y,T){MSApp.execUnsafeLocalFunction(function(){return a(u,m,y,T)})}:a})(function(a,u){if(a.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in a)a.innerHTML=u;else{for(tr=tr||document.createElement("div"),tr.innerHTML="<svg>"+u.valueOf().toString()+"</svg>",u=tr.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;u.firstChild;)a.appendChild(u.firstChild)}});function Yt(a,u){if(u){var m=a.firstChild;if(m&&m===a.lastChild&&m.nodeType===3){m.nodeValue=u;return}}a.textContent=u}var qt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},io=["Webkit","ms","Moz","O"];Object.keys(qt).forEach(function(a){io.forEach(function(u){u=u+a.charAt(0).toUpperCase()+a.substring(1),qt[u]=qt[a]})});function _s(a,u,m){return u==null||typeof u=="boolean"||u===""?"":m||typeof u!="number"||u===0||qt.hasOwnProperty(a)&&qt[a]?(""+u).trim():u+"px"}function Qa(a,u){a=a.style;for(var m in u)if(u.hasOwnProperty(m)){var y=m.indexOf("--")===0,T=_s(m,u[m],y);m==="float"&&(m="cssFloat"),y?a.setProperty(m,T):a[m]=T}}var Xc=ee({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function oo(a,u){if(u){if(Xc[a]&&(u.children!=null||u.dangerouslySetInnerHTML!=null))throw Error(t(137,a));if(u.dangerouslySetInnerHTML!=null){if(u.children!=null)throw Error(t(60));if(typeof u.dangerouslySetInnerHTML!="object"||!("__html"in u.dangerouslySetInnerHTML))throw Error(t(61))}if(u.style!=null&&typeof u.style!="object")throw Error(t(62))}}function ao(a,u){if(a.indexOf("-")===-1)return typeof u.is=="string";switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var lo=null;function ci(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var uo=null,br=null,wr=null;function co(a){if(a=Oo(a)){if(typeof uo!="function")throw Error(t(280));var u=a.stateNode;u&&(u=Tl(u),uo(a.stateNode,a.type,u))}}function Ja(a){br?wr?wr.push(a):wr=[a]:br=a}function fo(){if(br){var a=br,u=wr;if(wr=br=null,co(a),u)for(a=0;a<u.length;a++)co(u[a])}}function ho(a,u){return a(u)}function Za(){}var Qc=!1;function sg(a,u,m){if(Qc)return a(u,m);Qc=!0;try{return ho(a,u,m)}finally{Qc=!1,(br!==null||wr!==null)&&(Za(),fo())}}function mo(a,u){var m=a.stateNode;if(m===null)return null;var y=Tl(m);if(y===null)return null;m=y[u];e:switch(u){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(y=!y.disabled)||(a=a.type,y=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!y;break e;default:a=!1}if(a)return null;if(m&&typeof m!="function")throw Error(t(231,u,typeof m));return m}var Jc=!1;if(l)try{var po={};Object.defineProperty(po,"passive",{get:function(){Jc=!0}}),window.addEventListener("test",po,po),window.removeEventListener("test",po,po)}catch{Jc=!1}function N1(a,u,m,y,T,w,_,B,j){var X=Array.prototype.slice.call(arguments,3);try{u.apply(m,X)}catch(ae){this.onError(ae)}}var go=!1,el=null,tl=!1,Zc=null,O1={onError:function(a){go=!0,el=a}};function M1(a,u,m,y,T,w,_,B,j){go=!1,el=null,N1.apply(O1,arguments)}function F1(a,u,m,y,T,w,_,B,j){if(M1.apply(this,arguments),go){if(go){var X=el;go=!1,el=null}else throw Error(t(198));tl||(tl=!0,Zc=X)}}function Cs(a){var u=a,m=a;if(a.alternate)for(;u.return;)u=u.return;else{a=u;do u=a,(u.flags&4098)!==0&&(m=u.return),a=u.return;while(a)}return u.tag===3?m:null}function ig(a){if(a.tag===13){var u=a.memoizedState;if(u===null&&(a=a.alternate,a!==null&&(u=a.memoizedState)),u!==null)return u.dehydrated}return null}function og(a){if(Cs(a)!==a)throw Error(t(188))}function B1(a){var u=a.alternate;if(!u){if(u=Cs(a),u===null)throw Error(t(188));return u!==a?null:a}for(var m=a,y=u;;){var T=m.return;if(T===null)break;var w=T.alternate;if(w===null){if(y=T.return,y!==null){m=y;continue}break}if(T.child===w.child){for(w=T.child;w;){if(w===m)return og(T),a;if(w===y)return og(T),u;w=w.sibling}throw Error(t(188))}if(m.return!==y.return)m=T,y=w;else{for(var _=!1,B=T.child;B;){if(B===m){_=!0,m=T,y=w;break}if(B===y){_=!0,y=T,m=w;break}B=B.sibling}if(!_){for(B=w.child;B;){if(B===m){_=!0,m=w,y=T;break}if(B===y){_=!0,y=w,m=T;break}B=B.sibling}if(!_)throw Error(t(189))}}if(m.alternate!==y)throw Error(t(190))}if(m.tag!==3)throw Error(t(188));return m.stateNode.current===m?a:u}function ag(a){return a=B1(a),a!==null?lg(a):null}function lg(a){if(a.tag===5||a.tag===6)return a;for(a=a.child;a!==null;){var u=lg(a);if(u!==null)return u;a=a.sibling}return null}var ug=e.unstable_scheduleCallback,cg=e.unstable_cancelCallback,U1=e.unstable_shouldYield,$1=e.unstable_requestPaint,xt=e.unstable_now,j1=e.unstable_getCurrentPriorityLevel,ed=e.unstable_ImmediatePriority,dg=e.unstable_UserBlockingPriority,nl=e.unstable_NormalPriority,V1=e.unstable_LowPriority,fg=e.unstable_IdlePriority,rl=null,nr=null;function G1(a){if(nr&&typeof nr.onCommitFiberRoot=="function")try{nr.onCommitFiberRoot(rl,a,void 0,(a.current.flags&128)===128)}catch{}}var jn=Math.clz32?Math.clz32:z1,H1=Math.log,K1=Math.LN2;function z1(a){return a>>>=0,a===0?32:31-(H1(a)/K1|0)|0}var sl=64,il=4194304;function yo(a){switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return a&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return a}}function ol(a,u){var m=a.pendingLanes;if(m===0)return 0;var y=0,T=a.suspendedLanes,w=a.pingedLanes,_=m&268435455;if(_!==0){var B=_&~T;B!==0?y=yo(B):(w&=_,w!==0&&(y=yo(w)))}else _=m&~T,_!==0?y=yo(_):w!==0&&(y=yo(w));if(y===0)return 0;if(u!==0&&u!==y&&(u&T)===0&&(T=y&-y,w=u&-u,T>=w||T===16&&(w&4194240)!==0))return u;if((y&4)!==0&&(y|=m&16),u=a.entangledLanes,u!==0)for(a=a.entanglements,u&=y;0<u;)m=31-jn(u),T=1<<m,y|=a[m],u&=~T;return y}function W1(a,u){switch(a){case 1:case 2:case 4:return u+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return u+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Y1(a,u){for(var m=a.suspendedLanes,y=a.pingedLanes,T=a.expirationTimes,w=a.pendingLanes;0<w;){var _=31-jn(w),B=1<<_,j=T[_];j===-1?((B&m)===0||(B&y)!==0)&&(T[_]=W1(B,u)):j<=u&&(a.expiredLanes|=B),w&=~B}}function td(a){return a=a.pendingLanes&-1073741825,a!==0?a:a&1073741824?1073741824:0}function hg(){var a=sl;return sl<<=1,(sl&4194240)===0&&(sl=64),a}function nd(a){for(var u=[],m=0;31>m;m++)u.push(a);return u}function vo(a,u,m){a.pendingLanes|=u,u!==536870912&&(a.suspendedLanes=0,a.pingedLanes=0),a=a.eventTimes,u=31-jn(u),a[u]=m}function q1(a,u){var m=a.pendingLanes&~u;a.pendingLanes=u,a.suspendedLanes=0,a.pingedLanes=0,a.expiredLanes&=u,a.mutableReadLanes&=u,a.entangledLanes&=u,u=a.entanglements;var y=a.eventTimes;for(a=a.expirationTimes;0<m;){var T=31-jn(m),w=1<<T;u[T]=0,y[T]=-1,a[T]=-1,m&=~w}}function rd(a,u){var m=a.entangledLanes|=u;for(a=a.entanglements;m;){var y=31-jn(m),T=1<<y;T&u|a[y]&u&&(a[y]|=u),m&=~T}}var Qe=0;function mg(a){return a&=-a,1<a?4<a?(a&268435455)!==0?16:536870912:4:1}var pg,sd,gg,yg,vg,id=!1,al=[],Yr=null,qr=null,Xr=null,xo=new Map,So=new Map,Qr=[],X1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function xg(a,u){switch(a){case"focusin":case"focusout":Yr=null;break;case"dragenter":case"dragleave":qr=null;break;case"mouseover":case"mouseout":Xr=null;break;case"pointerover":case"pointerout":xo.delete(u.pointerId);break;case"gotpointercapture":case"lostpointercapture":So.delete(u.pointerId)}}function Eo(a,u,m,y,T,w){return a===null||a.nativeEvent!==w?(a={blockedOn:u,domEventName:m,eventSystemFlags:y,nativeEvent:w,targetContainers:[T]},u!==null&&(u=Oo(u),u!==null&&sd(u)),a):(a.eventSystemFlags|=y,u=a.targetContainers,T!==null&&u.indexOf(T)===-1&&u.push(T),a)}function Q1(a,u,m,y,T){switch(u){case"focusin":return Yr=Eo(Yr,a,u,m,y,T),!0;case"dragenter":return qr=Eo(qr,a,u,m,y,T),!0;case"mouseover":return Xr=Eo(Xr,a,u,m,y,T),!0;case"pointerover":var w=T.pointerId;return xo.set(w,Eo(xo.get(w)||null,a,u,m,y,T)),!0;case"gotpointercapture":return w=T.pointerId,So.set(w,Eo(So.get(w)||null,a,u,m,y,T)),!0}return!1}function Sg(a){var u=ks(a.target);if(u!==null){var m=Cs(u);if(m!==null){if(u=m.tag,u===13){if(u=ig(m),u!==null){a.blockedOn=u,vg(a.priority,function(){gg(m)});return}}else if(u===3&&m.stateNode.current.memoizedState.isDehydrated){a.blockedOn=m.tag===3?m.stateNode.containerInfo:null;return}}}a.blockedOn=null}function ll(a){if(a.blockedOn!==null)return!1;for(var u=a.targetContainers;0<u.length;){var m=ad(a.domEventName,a.eventSystemFlags,u[0],a.nativeEvent);if(m===null){m=a.nativeEvent;var y=new m.constructor(m.type,m);lo=y,m.target.dispatchEvent(y),lo=null}else return u=Oo(m),u!==null&&sd(u),a.blockedOn=m,!1;u.shift()}return!0}function Eg(a,u,m){ll(a)&&m.delete(u)}function J1(){id=!1,Yr!==null&&ll(Yr)&&(Yr=null),qr!==null&&ll(qr)&&(qr=null),Xr!==null&&ll(Xr)&&(Xr=null),xo.forEach(Eg),So.forEach(Eg)}function To(a,u){a.blockedOn===u&&(a.blockedOn=null,id||(id=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,J1)))}function bo(a){function u(T){return To(T,a)}if(0<al.length){To(al[0],a);for(var m=1;m<al.length;m++){var y=al[m];y.blockedOn===a&&(y.blockedOn=null)}}for(Yr!==null&&To(Yr,a),qr!==null&&To(qr,a),Xr!==null&&To(Xr,a),xo.forEach(u),So.forEach(u),m=0;m<Qr.length;m++)y=Qr[m],y.blockedOn===a&&(y.blockedOn=null);for(;0<Qr.length&&(m=Qr[0],m.blockedOn===null);)Sg(m),m.blockedOn===null&&Qr.shift()}var di=I.ReactCurrentBatchConfig,ul=!0;function Z1(a,u,m,y){var T=Qe,w=di.transition;di.transition=null;try{Qe=1,od(a,u,m,y)}finally{Qe=T,di.transition=w}}function eA(a,u,m,y){var T=Qe,w=di.transition;di.transition=null;try{Qe=4,od(a,u,m,y)}finally{Qe=T,di.transition=w}}function od(a,u,m,y){if(ul){var T=ad(a,u,m,y);if(T===null)wd(a,u,y,cl,m),xg(a,y);else if(Q1(T,a,u,m,y))y.stopPropagation();else if(xg(a,y),u&4&&-1<X1.indexOf(a)){for(;T!==null;){var w=Oo(T);if(w!==null&&pg(w),w=ad(a,u,m,y),w===null&&wd(a,u,y,cl,m),w===T)break;T=w}T!==null&&y.stopPropagation()}else wd(a,u,y,null,m)}}var cl=null;function ad(a,u,m,y){if(cl=null,a=ci(y),a=ks(a),a!==null)if(u=Cs(a),u===null)a=null;else if(m=u.tag,m===13){if(a=ig(u),a!==null)return a;a=null}else if(m===3){if(u.stateNode.current.memoizedState.isDehydrated)return u.tag===3?u.stateNode.containerInfo:null;a=null}else u!==a&&(a=null);return cl=a,null}function Tg(a){switch(a){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(j1()){case ed:return 1;case dg:return 4;case nl:case V1:return 16;case fg:return 536870912;default:return 16}default:return 16}}var Jr=null,ld=null,dl=null;function bg(){if(dl)return dl;var a,u=ld,m=u.length,y,T="value"in Jr?Jr.value:Jr.textContent,w=T.length;for(a=0;a<m&&u[a]===T[a];a++);var _=m-a;for(y=1;y<=_&&u[m-y]===T[w-y];y++);return dl=T.slice(a,1<y?1-y:void 0)}function fl(a){var u=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&u===13&&(a=13)):a=u,a===10&&(a=13),32<=a||a===13?a:0}function hl(){return!0}function wg(){return!1}function yn(a){function u(m,y,T,w,_){this._reactName=m,this._targetInst=T,this.type=y,this.nativeEvent=w,this.target=_,this.currentTarget=null;for(var B in a)a.hasOwnProperty(B)&&(m=a[B],this[B]=m?m(w):w[B]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?hl:wg,this.isPropagationStopped=wg,this}return ee(u.prototype,{preventDefault:function(){this.defaultPrevented=!0;var m=this.nativeEvent;m&&(m.preventDefault?m.preventDefault():typeof m.returnValue!="unknown"&&(m.returnValue=!1),this.isDefaultPrevented=hl)},stopPropagation:function(){var m=this.nativeEvent;m&&(m.stopPropagation?m.stopPropagation():typeof m.cancelBubble!="unknown"&&(m.cancelBubble=!0),this.isPropagationStopped=hl)},persist:function(){},isPersistent:hl}),u}var fi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ud=yn(fi),wo=ee({},fi,{view:0,detail:0}),tA=yn(wo),cd,dd,Ao,ml=ee({},wo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:hd,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Ao&&(Ao&&a.type==="mousemove"?(cd=a.screenX-Ao.screenX,dd=a.screenY-Ao.screenY):dd=cd=0,Ao=a),cd)},movementY:function(a){return"movementY"in a?a.movementY:dd}}),Ag=yn(ml),nA=ee({},ml,{dataTransfer:0}),rA=yn(nA),sA=ee({},wo,{relatedTarget:0}),fd=yn(sA),iA=ee({},fi,{animationName:0,elapsedTime:0,pseudoElement:0}),oA=yn(iA),aA=ee({},fi,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),lA=yn(aA),uA=ee({},fi,{data:0}),Lg=yn(uA),cA={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},dA={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},fA={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function hA(a){var u=this.nativeEvent;return u.getModifierState?u.getModifierState(a):(a=fA[a])?!!u[a]:!1}function hd(){return hA}var mA=ee({},wo,{key:function(a){if(a.key){var u=cA[a.key]||a.key;if(u!=="Unidentified")return u}return a.type==="keypress"?(a=fl(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?dA[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:hd,charCode:function(a){return a.type==="keypress"?fl(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?fl(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),pA=yn(mA),gA=ee({},ml,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Rg=yn(gA),yA=ee({},wo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:hd}),vA=yn(yA),xA=ee({},fi,{propertyName:0,elapsedTime:0,pseudoElement:0}),SA=yn(xA),EA=ee({},ml,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),TA=yn(EA),bA=[9,13,27,32],md=l&&"CompositionEvent"in window,Lo=null;l&&"documentMode"in document&&(Lo=document.documentMode);var wA=l&&"TextEvent"in window&&!Lo,Ig=l&&(!md||Lo&&8<Lo&&11>=Lo),_g=" ",Cg=!1;function kg(a,u){switch(a){case"keyup":return bA.indexOf(u.keyCode)!==-1;case"keydown":return u.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Pg(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var hi=!1;function AA(a,u){switch(a){case"compositionend":return Pg(u);case"keypress":return u.which!==32?null:(Cg=!0,_g);case"textInput":return a=u.data,a===_g&&Cg?null:a;default:return null}}function LA(a,u){if(hi)return a==="compositionend"||!md&&kg(a,u)?(a=bg(),dl=ld=Jr=null,hi=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(u.ctrlKey||u.altKey||u.metaKey)||u.ctrlKey&&u.altKey){if(u.char&&1<u.char.length)return u.char;if(u.which)return String.fromCharCode(u.which)}return null;case"compositionend":return Ig&&u.locale!=="ko"?null:u.data;default:return null}}var RA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Dg(a){var u=a&&a.nodeName&&a.nodeName.toLowerCase();return u==="input"?!!RA[a.type]:u==="textarea"}function Ng(a,u,m,y){Ja(y),u=xl(u,"onChange"),0<u.length&&(m=new ud("onChange","change",null,m,y),a.push({event:m,listeners:u}))}var Ro=null,Io=null;function IA(a){Jg(a,0)}function pl(a){var u=vi(a);if(Te(u))return a}function _A(a,u){if(a==="change")return u}var Og=!1;if(l){var pd;if(l){var gd="oninput"in document;if(!gd){var Mg=document.createElement("div");Mg.setAttribute("oninput","return;"),gd=typeof Mg.oninput=="function"}pd=gd}else pd=!1;Og=pd&&(!document.documentMode||9<document.documentMode)}function Fg(){Ro&&(Ro.detachEvent("onpropertychange",Bg),Io=Ro=null)}function Bg(a){if(a.propertyName==="value"&&pl(Io)){var u=[];Ng(u,Io,a,ci(a)),sg(IA,u)}}function CA(a,u,m){a==="focusin"?(Fg(),Ro=u,Io=m,Ro.attachEvent("onpropertychange",Bg)):a==="focusout"&&Fg()}function kA(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return pl(Io)}function PA(a,u){if(a==="click")return pl(u)}function DA(a,u){if(a==="input"||a==="change")return pl(u)}function NA(a,u){return a===u&&(a!==0||1/a===1/u)||a!==a&&u!==u}var Vn=typeof Object.is=="function"?Object.is:NA;function _o(a,u){if(Vn(a,u))return!0;if(typeof a!="object"||a===null||typeof u!="object"||u===null)return!1;var m=Object.keys(a),y=Object.keys(u);if(m.length!==y.length)return!1;for(y=0;y<m.length;y++){var T=m[y];if(!c.call(u,T)||!Vn(a[T],u[T]))return!1}return!0}function Ug(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function $g(a,u){var m=Ug(a);a=0;for(var y;m;){if(m.nodeType===3){if(y=a+m.textContent.length,a<=u&&y>=u)return{node:m,offset:u-a};a=y}e:{for(;m;){if(m.nextSibling){m=m.nextSibling;break e}m=m.parentNode}m=void 0}m=Ug(m)}}function jg(a,u){return a&&u?a===u?!0:a&&a.nodeType===3?!1:u&&u.nodeType===3?jg(a,u.parentNode):"contains"in a?a.contains(u):a.compareDocumentPosition?!!(a.compareDocumentPosition(u)&16):!1:!1}function Vg(){for(var a=window,u=xe();u instanceof a.HTMLIFrameElement;){try{var m=typeof u.contentWindow.location.href=="string"}catch{m=!1}if(m)a=u.contentWindow;else break;u=xe(a.document)}return u}function yd(a){var u=a&&a.nodeName&&a.nodeName.toLowerCase();return u&&(u==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||u==="textarea"||a.contentEditable==="true")}function OA(a){var u=Vg(),m=a.focusedElem,y=a.selectionRange;if(u!==m&&m&&m.ownerDocument&&jg(m.ownerDocument.documentElement,m)){if(y!==null&&yd(m)){if(u=y.start,a=y.end,a===void 0&&(a=u),"selectionStart"in m)m.selectionStart=u,m.selectionEnd=Math.min(a,m.value.length);else if(a=(u=m.ownerDocument||document)&&u.defaultView||window,a.getSelection){a=a.getSelection();var T=m.textContent.length,w=Math.min(y.start,T);y=y.end===void 0?w:Math.min(y.end,T),!a.extend&&w>y&&(T=y,y=w,w=T),T=$g(m,w);var _=$g(m,y);T&&_&&(a.rangeCount!==1||a.anchorNode!==T.node||a.anchorOffset!==T.offset||a.focusNode!==_.node||a.focusOffset!==_.offset)&&(u=u.createRange(),u.setStart(T.node,T.offset),a.removeAllRanges(),w>y?(a.addRange(u),a.extend(_.node,_.offset)):(u.setEnd(_.node,_.offset),a.addRange(u)))}}for(u=[],a=m;a=a.parentNode;)a.nodeType===1&&u.push({element:a,left:a.scrollLeft,top:a.scrollTop});for(typeof m.focus=="function"&&m.focus(),m=0;m<u.length;m++)a=u[m],a.element.scrollLeft=a.left,a.element.scrollTop=a.top}}var MA=l&&"documentMode"in document&&11>=document.documentMode,mi=null,vd=null,Co=null,xd=!1;function Gg(a,u,m){var y=m.window===m?m.document:m.nodeType===9?m:m.ownerDocument;xd||mi==null||mi!==xe(y)||(y=mi,"selectionStart"in y&&yd(y)?y={start:y.selectionStart,end:y.selectionEnd}:(y=(y.ownerDocument&&y.ownerDocument.defaultView||window).getSelection(),y={anchorNode:y.anchorNode,anchorOffset:y.anchorOffset,focusNode:y.focusNode,focusOffset:y.focusOffset}),Co&&_o(Co,y)||(Co=y,y=xl(vd,"onSelect"),0<y.length&&(u=new ud("onSelect","select",null,u,m),a.push({event:u,listeners:y}),u.target=mi)))}function gl(a,u){var m={};return m[a.toLowerCase()]=u.toLowerCase(),m["Webkit"+a]="webkit"+u,m["Moz"+a]="moz"+u,m}var pi={animationend:gl("Animation","AnimationEnd"),animationiteration:gl("Animation","AnimationIteration"),animationstart:gl("Animation","AnimationStart"),transitionend:gl("Transition","TransitionEnd")},Sd={},Hg={};l&&(Hg=document.createElement("div").style,"AnimationEvent"in window||(delete pi.animationend.animation,delete pi.animationiteration.animation,delete pi.animationstart.animation),"TransitionEvent"in window||delete pi.transitionend.transition);function yl(a){if(Sd[a])return Sd[a];if(!pi[a])return a;var u=pi[a],m;for(m in u)if(u.hasOwnProperty(m)&&m in Hg)return Sd[a]=u[m];return a}var Kg=yl("animationend"),zg=yl("animationiteration"),Wg=yl("animationstart"),Yg=yl("transitionend"),qg=new Map,Xg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Zr(a,u){qg.set(a,u),i(u,[a])}for(var Ed=0;Ed<Xg.length;Ed++){var Td=Xg[Ed],FA=Td.toLowerCase(),BA=Td[0].toUpperCase()+Td.slice(1);Zr(FA,"on"+BA)}Zr(Kg,"onAnimationEnd"),Zr(zg,"onAnimationIteration"),Zr(Wg,"onAnimationStart"),Zr("dblclick","onDoubleClick"),Zr("focusin","onFocus"),Zr("focusout","onBlur"),Zr(Yg,"onTransitionEnd"),o("onMouseEnter",["mouseout","mouseover"]),o("onMouseLeave",["mouseout","mouseover"]),o("onPointerEnter",["pointerout","pointerover"]),o("onPointerLeave",["pointerout","pointerover"]),i("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),i("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),i("onBeforeInput",["compositionend","keypress","textInput","paste"]),i("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ko="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),UA=new Set("cancel close invalid load scroll toggle".split(" ").concat(ko));function Qg(a,u,m){var y=a.type||"unknown-event";a.currentTarget=m,F1(y,u,void 0,a),a.currentTarget=null}function Jg(a,u){u=(u&4)!==0;for(var m=0;m<a.length;m++){var y=a[m],T=y.event;y=y.listeners;e:{var w=void 0;if(u)for(var _=y.length-1;0<=_;_--){var B=y[_],j=B.instance,X=B.currentTarget;if(B=B.listener,j!==w&&T.isPropagationStopped())break e;Qg(T,B,X),w=j}else for(_=0;_<y.length;_++){if(B=y[_],j=B.instance,X=B.currentTarget,B=B.listener,j!==w&&T.isPropagationStopped())break e;Qg(T,B,X),w=j}}}if(tl)throw a=Zc,tl=!1,Zc=null,a}function ot(a,u){var m=u[Cd];m===void 0&&(m=u[Cd]=new Set);var y=a+"__bubble";m.has(y)||(Zg(u,a,2,!1),m.add(y))}function bd(a,u,m){var y=0;u&&(y|=4),Zg(m,a,y,u)}var vl="_reactListening"+Math.random().toString(36).slice(2);function Po(a){if(!a[vl]){a[vl]=!0,r.forEach(function(m){m!=="selectionchange"&&(UA.has(m)||bd(m,!1,a),bd(m,!0,a))});var u=a.nodeType===9?a:a.ownerDocument;u===null||u[vl]||(u[vl]=!0,bd("selectionchange",!1,u))}}function Zg(a,u,m,y){switch(Tg(u)){case 1:var T=Z1;break;case 4:T=eA;break;default:T=od}m=T.bind(null,u,m,a),T=void 0,!Jc||u!=="touchstart"&&u!=="touchmove"&&u!=="wheel"||(T=!0),y?T!==void 0?a.addEventListener(u,m,{capture:!0,passive:T}):a.addEventListener(u,m,!0):T!==void 0?a.addEventListener(u,m,{passive:T}):a.addEventListener(u,m,!1)}function wd(a,u,m,y,T){var w=y;if((u&1)===0&&(u&2)===0&&y!==null)e:for(;;){if(y===null)return;var _=y.tag;if(_===3||_===4){var B=y.stateNode.containerInfo;if(B===T||B.nodeType===8&&B.parentNode===T)break;if(_===4)for(_=y.return;_!==null;){var j=_.tag;if((j===3||j===4)&&(j=_.stateNode.containerInfo,j===T||j.nodeType===8&&j.parentNode===T))return;_=_.return}for(;B!==null;){if(_=ks(B),_===null)return;if(j=_.tag,j===5||j===6){y=w=_;continue e}B=B.parentNode}}y=y.return}sg(function(){var X=w,ae=ci(m),le=[];e:{var oe=qg.get(a);if(oe!==void 0){var pe=ud,Se=a;switch(a){case"keypress":if(fl(m)===0)break e;case"keydown":case"keyup":pe=pA;break;case"focusin":Se="focus",pe=fd;break;case"focusout":Se="blur",pe=fd;break;case"beforeblur":case"afterblur":pe=fd;break;case"click":if(m.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":pe=Ag;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":pe=rA;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":pe=vA;break;case Kg:case zg:case Wg:pe=oA;break;case Yg:pe=SA;break;case"scroll":pe=tA;break;case"wheel":pe=TA;break;case"copy":case"cut":case"paste":pe=lA;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":pe=Rg}var be=(u&4)!==0,St=!be&&a==="scroll",W=be?oe!==null?oe+"Capture":null:oe;be=[];for(var V=X,Y;V!==null;){Y=V;var de=Y.stateNode;if(Y.tag===5&&de!==null&&(Y=de,W!==null&&(de=mo(V,W),de!=null&&be.push(Do(V,de,Y)))),St)break;V=V.return}0<be.length&&(oe=new pe(oe,Se,null,m,ae),le.push({event:oe,listeners:be}))}}if((u&7)===0){e:{if(oe=a==="mouseover"||a==="pointerover",pe=a==="mouseout"||a==="pointerout",oe&&m!==lo&&(Se=m.relatedTarget||m.fromElement)&&(ks(Se)||Se[Ar]))break e;if((pe||oe)&&(oe=ae.window===ae?ae:(oe=ae.ownerDocument)?oe.defaultView||oe.parentWindow:window,pe?(Se=m.relatedTarget||m.toElement,pe=X,Se=Se?ks(Se):null,Se!==null&&(St=Cs(Se),Se!==St||Se.tag!==5&&Se.tag!==6)&&(Se=null)):(pe=null,Se=X),pe!==Se)){if(be=Ag,de="onMouseLeave",W="onMouseEnter",V="mouse",(a==="pointerout"||a==="pointerover")&&(be=Rg,de="onPointerLeave",W="onPointerEnter",V="pointer"),St=pe==null?oe:vi(pe),Y=Se==null?oe:vi(Se),oe=new be(de,V+"leave",pe,m,ae),oe.target=St,oe.relatedTarget=Y,de=null,ks(ae)===X&&(be=new be(W,V+"enter",Se,m,ae),be.target=Y,be.relatedTarget=St,de=be),St=de,pe&&Se)t:{for(be=pe,W=Se,V=0,Y=be;Y;Y=gi(Y))V++;for(Y=0,de=W;de;de=gi(de))Y++;for(;0<V-Y;)be=gi(be),V--;for(;0<Y-V;)W=gi(W),Y--;for(;V--;){if(be===W||W!==null&&be===W.alternate)break t;be=gi(be),W=gi(W)}be=null}else be=null;pe!==null&&e0(le,oe,pe,be,!1),Se!==null&&St!==null&&e0(le,St,Se,be,!0)}}e:{if(oe=X?vi(X):window,pe=oe.nodeName&&oe.nodeName.toLowerCase(),pe==="select"||pe==="input"&&oe.type==="file")var Ae=_A;else if(Dg(oe))if(Og)Ae=DA;else{Ae=kA;var Ie=CA}else(pe=oe.nodeName)&&pe.toLowerCase()==="input"&&(oe.type==="checkbox"||oe.type==="radio")&&(Ae=PA);if(Ae&&(Ae=Ae(a,X))){Ng(le,Ae,m,ae);break e}Ie&&Ie(a,oe,X),a==="focusout"&&(Ie=oe._wrapperState)&&Ie.controlled&&oe.type==="number"&&je(oe,"number",oe.value)}switch(Ie=X?vi(X):window,a){case"focusin":(Dg(Ie)||Ie.contentEditable==="true")&&(mi=Ie,vd=X,Co=null);break;case"focusout":Co=vd=mi=null;break;case"mousedown":xd=!0;break;case"contextmenu":case"mouseup":case"dragend":xd=!1,Gg(le,m,ae);break;case"selectionchange":if(MA)break;case"keydown":case"keyup":Gg(le,m,ae)}var _e;if(md)e:{switch(a){case"compositionstart":var De="onCompositionStart";break e;case"compositionend":De="onCompositionEnd";break e;case"compositionupdate":De="onCompositionUpdate";break e}De=void 0}else hi?kg(a,m)&&(De="onCompositionEnd"):a==="keydown"&&m.keyCode===229&&(De="onCompositionStart");De&&(Ig&&m.locale!=="ko"&&(hi||De!=="onCompositionStart"?De==="onCompositionEnd"&&hi&&(_e=bg()):(Jr=ae,ld="value"in Jr?Jr.value:Jr.textContent,hi=!0)),Ie=xl(X,De),0<Ie.length&&(De=new Lg(De,a,null,m,ae),le.push({event:De,listeners:Ie}),_e?De.data=_e:(_e=Pg(m),_e!==null&&(De.data=_e)))),(_e=wA?AA(a,m):LA(a,m))&&(X=xl(X,"onBeforeInput"),0<X.length&&(ae=new Lg("onBeforeInput","beforeinput",null,m,ae),le.push({event:ae,listeners:X}),ae.data=_e))}Jg(le,u)})}function Do(a,u,m){return{instance:a,listener:u,currentTarget:m}}function xl(a,u){for(var m=u+"Capture",y=[];a!==null;){var T=a,w=T.stateNode;T.tag===5&&w!==null&&(T=w,w=mo(a,m),w!=null&&y.unshift(Do(a,w,T)),w=mo(a,u),w!=null&&y.push(Do(a,w,T))),a=a.return}return y}function gi(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5);return a||null}function e0(a,u,m,y,T){for(var w=u._reactName,_=[];m!==null&&m!==y;){var B=m,j=B.alternate,X=B.stateNode;if(j!==null&&j===y)break;B.tag===5&&X!==null&&(B=X,T?(j=mo(m,w),j!=null&&_.unshift(Do(m,j,B))):T||(j=mo(m,w),j!=null&&_.push(Do(m,j,B)))),m=m.return}_.length!==0&&a.push({event:u,listeners:_})}var $A=/\r\n?/g,jA=/\u0000|\uFFFD/g;function t0(a){return(typeof a=="string"?a:""+a).replace($A,`
`).replace(jA,"")}function Sl(a,u,m){if(u=t0(u),t0(a)!==u&&m)throw Error(t(425))}function El(){}var Ad=null,Ld=null;function Rd(a,u){return a==="textarea"||a==="noscript"||typeof u.children=="string"||typeof u.children=="number"||typeof u.dangerouslySetInnerHTML=="object"&&u.dangerouslySetInnerHTML!==null&&u.dangerouslySetInnerHTML.__html!=null}var Id=typeof setTimeout=="function"?setTimeout:void 0,VA=typeof clearTimeout=="function"?clearTimeout:void 0,n0=typeof Promise=="function"?Promise:void 0,GA=typeof queueMicrotask=="function"?queueMicrotask:typeof n0<"u"?function(a){return n0.resolve(null).then(a).catch(HA)}:Id;function HA(a){setTimeout(function(){throw a})}function _d(a,u){var m=u,y=0;do{var T=m.nextSibling;if(a.removeChild(m),T&&T.nodeType===8)if(m=T.data,m==="/$"){if(y===0){a.removeChild(T),bo(u);return}y--}else m!=="$"&&m!=="$?"&&m!=="$!"||y++;m=T}while(m);bo(u)}function es(a){for(;a!=null;a=a.nextSibling){var u=a.nodeType;if(u===1||u===3)break;if(u===8){if(u=a.data,u==="$"||u==="$!"||u==="$?")break;if(u==="/$")return null}}return a}function r0(a){a=a.previousSibling;for(var u=0;a;){if(a.nodeType===8){var m=a.data;if(m==="$"||m==="$!"||m==="$?"){if(u===0)return a;u--}else m==="/$"&&u++}a=a.previousSibling}return null}var yi=Math.random().toString(36).slice(2),rr="__reactFiber$"+yi,No="__reactProps$"+yi,Ar="__reactContainer$"+yi,Cd="__reactEvents$"+yi,KA="__reactListeners$"+yi,zA="__reactHandles$"+yi;function ks(a){var u=a[rr];if(u)return u;for(var m=a.parentNode;m;){if(u=m[Ar]||m[rr]){if(m=u.alternate,u.child!==null||m!==null&&m.child!==null)for(a=r0(a);a!==null;){if(m=a[rr])return m;a=r0(a)}return u}a=m,m=a.parentNode}return null}function Oo(a){return a=a[rr]||a[Ar],!a||a.tag!==5&&a.tag!==6&&a.tag!==13&&a.tag!==3?null:a}function vi(a){if(a.tag===5||a.tag===6)return a.stateNode;throw Error(t(33))}function Tl(a){return a[No]||null}var kd=[],xi=-1;function ts(a){return{current:a}}function at(a){0>xi||(a.current=kd[xi],kd[xi]=null,xi--)}function rt(a,u){xi++,kd[xi]=a.current,a.current=u}var ns={},jt=ts(ns),en=ts(!1),Ps=ns;function Si(a,u){var m=a.type.contextTypes;if(!m)return ns;var y=a.stateNode;if(y&&y.__reactInternalMemoizedUnmaskedChildContext===u)return y.__reactInternalMemoizedMaskedChildContext;var T={},w;for(w in m)T[w]=u[w];return y&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=u,a.__reactInternalMemoizedMaskedChildContext=T),T}function tn(a){return a=a.childContextTypes,a!=null}function bl(){at(en),at(jt)}function s0(a,u,m){if(jt.current!==ns)throw Error(t(168));rt(jt,u),rt(en,m)}function i0(a,u,m){var y=a.stateNode;if(u=u.childContextTypes,typeof y.getChildContext!="function")return m;y=y.getChildContext();for(var T in y)if(!(T in u))throw Error(t(108,Ee(a)||"Unknown",T));return ee({},m,y)}function wl(a){return a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||ns,Ps=jt.current,rt(jt,a),rt(en,en.current),!0}function o0(a,u,m){var y=a.stateNode;if(!y)throw Error(t(169));m?(a=i0(a,u,Ps),y.__reactInternalMemoizedMergedChildContext=a,at(en),at(jt),rt(jt,a)):at(en),rt(en,m)}var Lr=null,Al=!1,Pd=!1;function a0(a){Lr===null?Lr=[a]:Lr.push(a)}function WA(a){Al=!0,a0(a)}function rs(){if(!Pd&&Lr!==null){Pd=!0;var a=0,u=Qe;try{var m=Lr;for(Qe=1;a<m.length;a++){var y=m[a];do y=y(!0);while(y!==null)}Lr=null,Al=!1}catch(T){throw Lr!==null&&(Lr=Lr.slice(a+1)),ug(ed,rs),T}finally{Qe=u,Pd=!1}}return null}var Ei=[],Ti=0,Ll=null,Rl=0,kn=[],Pn=0,Ds=null,Rr=1,Ir="";function Ns(a,u){Ei[Ti++]=Rl,Ei[Ti++]=Ll,Ll=a,Rl=u}function l0(a,u,m){kn[Pn++]=Rr,kn[Pn++]=Ir,kn[Pn++]=Ds,Ds=a;var y=Rr;a=Ir;var T=32-jn(y)-1;y&=~(1<<T),m+=1;var w=32-jn(u)+T;if(30<w){var _=T-T%5;w=(y&(1<<_)-1).toString(32),y>>=_,T-=_,Rr=1<<32-jn(u)+T|m<<T|y,Ir=w+a}else Rr=1<<w|m<<T|y,Ir=a}function Dd(a){a.return!==null&&(Ns(a,1),l0(a,1,0))}function Nd(a){for(;a===Ll;)Ll=Ei[--Ti],Ei[Ti]=null,Rl=Ei[--Ti],Ei[Ti]=null;for(;a===Ds;)Ds=kn[--Pn],kn[Pn]=null,Ir=kn[--Pn],kn[Pn]=null,Rr=kn[--Pn],kn[Pn]=null}var vn=null,xn=null,lt=!1,Gn=null;function u0(a,u){var m=Mn(5,null,null,0);m.elementType="DELETED",m.stateNode=u,m.return=a,u=a.deletions,u===null?(a.deletions=[m],a.flags|=16):u.push(m)}function c0(a,u){switch(a.tag){case 5:var m=a.type;return u=u.nodeType!==1||m.toLowerCase()!==u.nodeName.toLowerCase()?null:u,u!==null?(a.stateNode=u,vn=a,xn=es(u.firstChild),!0):!1;case 6:return u=a.pendingProps===""||u.nodeType!==3?null:u,u!==null?(a.stateNode=u,vn=a,xn=null,!0):!1;case 13:return u=u.nodeType!==8?null:u,u!==null?(m=Ds!==null?{id:Rr,overflow:Ir}:null,a.memoizedState={dehydrated:u,treeContext:m,retryLane:1073741824},m=Mn(18,null,null,0),m.stateNode=u,m.return=a,a.child=m,vn=a,xn=null,!0):!1;default:return!1}}function Od(a){return(a.mode&1)!==0&&(a.flags&128)===0}function Md(a){if(lt){var u=xn;if(u){var m=u;if(!c0(a,u)){if(Od(a))throw Error(t(418));u=es(m.nextSibling);var y=vn;u&&c0(a,u)?u0(y,m):(a.flags=a.flags&-4097|2,lt=!1,vn=a)}}else{if(Od(a))throw Error(t(418));a.flags=a.flags&-4097|2,lt=!1,vn=a}}}function d0(a){for(a=a.return;a!==null&&a.tag!==5&&a.tag!==3&&a.tag!==13;)a=a.return;vn=a}function Il(a){if(a!==vn)return!1;if(!lt)return d0(a),lt=!0,!1;var u;if((u=a.tag!==3)&&!(u=a.tag!==5)&&(u=a.type,u=u!=="head"&&u!=="body"&&!Rd(a.type,a.memoizedProps)),u&&(u=xn)){if(Od(a))throw f0(),Error(t(418));for(;u;)u0(a,u),u=es(u.nextSibling)}if(d0(a),a.tag===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(t(317));e:{for(a=a.nextSibling,u=0;a;){if(a.nodeType===8){var m=a.data;if(m==="/$"){if(u===0){xn=es(a.nextSibling);break e}u--}else m!=="$"&&m!=="$!"&&m!=="$?"||u++}a=a.nextSibling}xn=null}}else xn=vn?es(a.stateNode.nextSibling):null;return!0}function f0(){for(var a=xn;a;)a=es(a.nextSibling)}function bi(){xn=vn=null,lt=!1}function Fd(a){Gn===null?Gn=[a]:Gn.push(a)}var YA=I.ReactCurrentBatchConfig;function Mo(a,u,m){if(a=m.ref,a!==null&&typeof a!="function"&&typeof a!="object"){if(m._owner){if(m=m._owner,m){if(m.tag!==1)throw Error(t(309));var y=m.stateNode}if(!y)throw Error(t(147,a));var T=y,w=""+a;return u!==null&&u.ref!==null&&typeof u.ref=="function"&&u.ref._stringRef===w?u.ref:(u=function(_){var B=T.refs;_===null?delete B[w]:B[w]=_},u._stringRef=w,u)}if(typeof a!="string")throw Error(t(284));if(!m._owner)throw Error(t(290,a))}return a}function _l(a,u){throw a=Object.prototype.toString.call(u),Error(t(31,a==="[object Object]"?"object with keys {"+Object.keys(u).join(", ")+"}":a))}function h0(a){var u=a._init;return u(a._payload)}function m0(a){function u(W,V){if(a){var Y=W.deletions;Y===null?(W.deletions=[V],W.flags|=16):Y.push(V)}}function m(W,V){if(!a)return null;for(;V!==null;)u(W,V),V=V.sibling;return null}function y(W,V){for(W=new Map;V!==null;)V.key!==null?W.set(V.key,V):W.set(V.index,V),V=V.sibling;return W}function T(W,V){return W=ds(W,V),W.index=0,W.sibling=null,W}function w(W,V,Y){return W.index=Y,a?(Y=W.alternate,Y!==null?(Y=Y.index,Y<V?(W.flags|=2,V):Y):(W.flags|=2,V)):(W.flags|=1048576,V)}function _(W){return a&&W.alternate===null&&(W.flags|=2),W}function B(W,V,Y,de){return V===null||V.tag!==6?(V=_f(Y,W.mode,de),V.return=W,V):(V=T(V,Y),V.return=W,V)}function j(W,V,Y,de){var Ae=Y.type;return Ae===C?ae(W,V,Y.props.children,de,Y.key):V!==null&&(V.elementType===Ae||typeof Ae=="object"&&Ae!==null&&Ae.$$typeof===q&&h0(Ae)===V.type)?(de=T(V,Y.props),de.ref=Mo(W,V,Y),de.return=W,de):(de=Zl(Y.type,Y.key,Y.props,null,W.mode,de),de.ref=Mo(W,V,Y),de.return=W,de)}function X(W,V,Y,de){return V===null||V.tag!==4||V.stateNode.containerInfo!==Y.containerInfo||V.stateNode.implementation!==Y.implementation?(V=Cf(Y,W.mode,de),V.return=W,V):(V=T(V,Y.children||[]),V.return=W,V)}function ae(W,V,Y,de,Ae){return V===null||V.tag!==7?(V=Vs(Y,W.mode,de,Ae),V.return=W,V):(V=T(V,Y),V.return=W,V)}function le(W,V,Y){if(typeof V=="string"&&V!==""||typeof V=="number")return V=_f(""+V,W.mode,Y),V.return=W,V;if(typeof V=="object"&&V!==null){switch(V.$$typeof){case k:return Y=Zl(V.type,V.key,V.props,null,W.mode,Y),Y.ref=Mo(W,null,V),Y.return=W,Y;case F:return V=Cf(V,W.mode,Y),V.return=W,V;case q:var de=V._init;return le(W,de(V._payload),Y)}if(Be(V)||Q(V))return V=Vs(V,W.mode,Y,null),V.return=W,V;_l(W,V)}return null}function oe(W,V,Y,de){var Ae=V!==null?V.key:null;if(typeof Y=="string"&&Y!==""||typeof Y=="number")return Ae!==null?null:B(W,V,""+Y,de);if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case k:return Y.key===Ae?j(W,V,Y,de):null;case F:return Y.key===Ae?X(W,V,Y,de):null;case q:return Ae=Y._init,oe(W,V,Ae(Y._payload),de)}if(Be(Y)||Q(Y))return Ae!==null?null:ae(W,V,Y,de,null);_l(W,Y)}return null}function pe(W,V,Y,de,Ae){if(typeof de=="string"&&de!==""||typeof de=="number")return W=W.get(Y)||null,B(V,W,""+de,Ae);if(typeof de=="object"&&de!==null){switch(de.$$typeof){case k:return W=W.get(de.key===null?Y:de.key)||null,j(V,W,de,Ae);case F:return W=W.get(de.key===null?Y:de.key)||null,X(V,W,de,Ae);case q:var Ie=de._init;return pe(W,V,Y,Ie(de._payload),Ae)}if(Be(de)||Q(de))return W=W.get(Y)||null,ae(V,W,de,Ae,null);_l(V,de)}return null}function Se(W,V,Y,de){for(var Ae=null,Ie=null,_e=V,De=V=0,Dt=null;_e!==null&&De<Y.length;De++){_e.index>De?(Dt=_e,_e=null):Dt=_e.sibling;var We=oe(W,_e,Y[De],de);if(We===null){_e===null&&(_e=Dt);break}a&&_e&&We.alternate===null&&u(W,_e),V=w(We,V,De),Ie===null?Ae=We:Ie.sibling=We,Ie=We,_e=Dt}if(De===Y.length)return m(W,_e),lt&&Ns(W,De),Ae;if(_e===null){for(;De<Y.length;De++)_e=le(W,Y[De],de),_e!==null&&(V=w(_e,V,De),Ie===null?Ae=_e:Ie.sibling=_e,Ie=_e);return lt&&Ns(W,De),Ae}for(_e=y(W,_e);De<Y.length;De++)Dt=pe(_e,W,De,Y[De],de),Dt!==null&&(a&&Dt.alternate!==null&&_e.delete(Dt.key===null?De:Dt.key),V=w(Dt,V,De),Ie===null?Ae=Dt:Ie.sibling=Dt,Ie=Dt);return a&&_e.forEach(function(fs){return u(W,fs)}),lt&&Ns(W,De),Ae}function be(W,V,Y,de){var Ae=Q(Y);if(typeof Ae!="function")throw Error(t(150));if(Y=Ae.call(Y),Y==null)throw Error(t(151));for(var Ie=Ae=null,_e=V,De=V=0,Dt=null,We=Y.next();_e!==null&&!We.done;De++,We=Y.next()){_e.index>De?(Dt=_e,_e=null):Dt=_e.sibling;var fs=oe(W,_e,We.value,de);if(fs===null){_e===null&&(_e=Dt);break}a&&_e&&fs.alternate===null&&u(W,_e),V=w(fs,V,De),Ie===null?Ae=fs:Ie.sibling=fs,Ie=fs,_e=Dt}if(We.done)return m(W,_e),lt&&Ns(W,De),Ae;if(_e===null){for(;!We.done;De++,We=Y.next())We=le(W,We.value,de),We!==null&&(V=w(We,V,De),Ie===null?Ae=We:Ie.sibling=We,Ie=We);return lt&&Ns(W,De),Ae}for(_e=y(W,_e);!We.done;De++,We=Y.next())We=pe(_e,W,De,We.value,de),We!==null&&(a&&We.alternate!==null&&_e.delete(We.key===null?De:We.key),V=w(We,V,De),Ie===null?Ae=We:Ie.sibling=We,Ie=We);return a&&_e.forEach(function(RL){return u(W,RL)}),lt&&Ns(W,De),Ae}function St(W,V,Y,de){if(typeof Y=="object"&&Y!==null&&Y.type===C&&Y.key===null&&(Y=Y.props.children),typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case k:e:{for(var Ae=Y.key,Ie=V;Ie!==null;){if(Ie.key===Ae){if(Ae=Y.type,Ae===C){if(Ie.tag===7){m(W,Ie.sibling),V=T(Ie,Y.props.children),V.return=W,W=V;break e}}else if(Ie.elementType===Ae||typeof Ae=="object"&&Ae!==null&&Ae.$$typeof===q&&h0(Ae)===Ie.type){m(W,Ie.sibling),V=T(Ie,Y.props),V.ref=Mo(W,Ie,Y),V.return=W,W=V;break e}m(W,Ie);break}else u(W,Ie);Ie=Ie.sibling}Y.type===C?(V=Vs(Y.props.children,W.mode,de,Y.key),V.return=W,W=V):(de=Zl(Y.type,Y.key,Y.props,null,W.mode,de),de.ref=Mo(W,V,Y),de.return=W,W=de)}return _(W);case F:e:{for(Ie=Y.key;V!==null;){if(V.key===Ie)if(V.tag===4&&V.stateNode.containerInfo===Y.containerInfo&&V.stateNode.implementation===Y.implementation){m(W,V.sibling),V=T(V,Y.children||[]),V.return=W,W=V;break e}else{m(W,V);break}else u(W,V);V=V.sibling}V=Cf(Y,W.mode,de),V.return=W,W=V}return _(W);case q:return Ie=Y._init,St(W,V,Ie(Y._payload),de)}if(Be(Y))return Se(W,V,Y,de);if(Q(Y))return be(W,V,Y,de);_l(W,Y)}return typeof Y=="string"&&Y!==""||typeof Y=="number"?(Y=""+Y,V!==null&&V.tag===6?(m(W,V.sibling),V=T(V,Y),V.return=W,W=V):(m(W,V),V=_f(Y,W.mode,de),V.return=W,W=V),_(W)):m(W,V)}return St}var wi=m0(!0),p0=m0(!1),Cl=ts(null),kl=null,Ai=null,Bd=null;function Ud(){Bd=Ai=kl=null}function $d(a){var u=Cl.current;at(Cl),a._currentValue=u}function jd(a,u,m){for(;a!==null;){var y=a.alternate;if((a.childLanes&u)!==u?(a.childLanes|=u,y!==null&&(y.childLanes|=u)):y!==null&&(y.childLanes&u)!==u&&(y.childLanes|=u),a===m)break;a=a.return}}function Li(a,u){kl=a,Bd=Ai=null,a=a.dependencies,a!==null&&a.firstContext!==null&&((a.lanes&u)!==0&&(nn=!0),a.firstContext=null)}function Dn(a){var u=a._currentValue;if(Bd!==a)if(a={context:a,memoizedValue:u,next:null},Ai===null){if(kl===null)throw Error(t(308));Ai=a,kl.dependencies={lanes:0,firstContext:a}}else Ai=Ai.next=a;return u}var Os=null;function Vd(a){Os===null?Os=[a]:Os.push(a)}function g0(a,u,m,y){var T=u.interleaved;return T===null?(m.next=m,Vd(u)):(m.next=T.next,T.next=m),u.interleaved=m,_r(a,y)}function _r(a,u){a.lanes|=u;var m=a.alternate;for(m!==null&&(m.lanes|=u),m=a,a=a.return;a!==null;)a.childLanes|=u,m=a.alternate,m!==null&&(m.childLanes|=u),m=a,a=a.return;return m.tag===3?m.stateNode:null}var ss=!1;function Gd(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function y0(a,u){a=a.updateQueue,u.updateQueue===a&&(u.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,effects:a.effects})}function Cr(a,u){return{eventTime:a,lane:u,tag:0,payload:null,callback:null,next:null}}function is(a,u,m){var y=a.updateQueue;if(y===null)return null;if(y=y.shared,(Ke&2)!==0){var T=y.pending;return T===null?u.next=u:(u.next=T.next,T.next=u),y.pending=u,_r(a,m)}return T=y.interleaved,T===null?(u.next=u,Vd(y)):(u.next=T.next,T.next=u),y.interleaved=u,_r(a,m)}function Pl(a,u,m){if(u=u.updateQueue,u!==null&&(u=u.shared,(m&4194240)!==0)){var y=u.lanes;y&=a.pendingLanes,m|=y,u.lanes=m,rd(a,m)}}function v0(a,u){var m=a.updateQueue,y=a.alternate;if(y!==null&&(y=y.updateQueue,m===y)){var T=null,w=null;if(m=m.firstBaseUpdate,m!==null){do{var _={eventTime:m.eventTime,lane:m.lane,tag:m.tag,payload:m.payload,callback:m.callback,next:null};w===null?T=w=_:w=w.next=_,m=m.next}while(m!==null);w===null?T=w=u:w=w.next=u}else T=w=u;m={baseState:y.baseState,firstBaseUpdate:T,lastBaseUpdate:w,shared:y.shared,effects:y.effects},a.updateQueue=m;return}a=m.lastBaseUpdate,a===null?m.firstBaseUpdate=u:a.next=u,m.lastBaseUpdate=u}function Dl(a,u,m,y){var T=a.updateQueue;ss=!1;var w=T.firstBaseUpdate,_=T.lastBaseUpdate,B=T.shared.pending;if(B!==null){T.shared.pending=null;var j=B,X=j.next;j.next=null,_===null?w=X:_.next=X,_=j;var ae=a.alternate;ae!==null&&(ae=ae.updateQueue,B=ae.lastBaseUpdate,B!==_&&(B===null?ae.firstBaseUpdate=X:B.next=X,ae.lastBaseUpdate=j))}if(w!==null){var le=T.baseState;_=0,ae=X=j=null,B=w;do{var oe=B.lane,pe=B.eventTime;if((y&oe)===oe){ae!==null&&(ae=ae.next={eventTime:pe,lane:0,tag:B.tag,payload:B.payload,callback:B.callback,next:null});e:{var Se=a,be=B;switch(oe=u,pe=m,be.tag){case 1:if(Se=be.payload,typeof Se=="function"){le=Se.call(pe,le,oe);break e}le=Se;break e;case 3:Se.flags=Se.flags&-65537|128;case 0:if(Se=be.payload,oe=typeof Se=="function"?Se.call(pe,le,oe):Se,oe==null)break e;le=ee({},le,oe);break e;case 2:ss=!0}}B.callback!==null&&B.lane!==0&&(a.flags|=64,oe=T.effects,oe===null?T.effects=[B]:oe.push(B))}else pe={eventTime:pe,lane:oe,tag:B.tag,payload:B.payload,callback:B.callback,next:null},ae===null?(X=ae=pe,j=le):ae=ae.next=pe,_|=oe;if(B=B.next,B===null){if(B=T.shared.pending,B===null)break;oe=B,B=oe.next,oe.next=null,T.lastBaseUpdate=oe,T.shared.pending=null}}while(!0);if(ae===null&&(j=le),T.baseState=j,T.firstBaseUpdate=X,T.lastBaseUpdate=ae,u=T.shared.interleaved,u!==null){T=u;do _|=T.lane,T=T.next;while(T!==u)}else w===null&&(T.shared.lanes=0);Bs|=_,a.lanes=_,a.memoizedState=le}}function x0(a,u,m){if(a=u.effects,u.effects=null,a!==null)for(u=0;u<a.length;u++){var y=a[u],T=y.callback;if(T!==null){if(y.callback=null,y=m,typeof T!="function")throw Error(t(191,T));T.call(y)}}}var Fo={},sr=ts(Fo),Bo=ts(Fo),Uo=ts(Fo);function Ms(a){if(a===Fo)throw Error(t(174));return a}function Hd(a,u){switch(rt(Uo,u),rt(Bo,a),rt(sr,Fo),a=u.nodeType,a){case 9:case 11:u=(u=u.documentElement)?u.namespaceURI:pn(null,"");break;default:a=a===8?u.parentNode:u,u=a.namespaceURI||null,a=a.tagName,u=pn(u,a)}at(sr),rt(sr,u)}function Ri(){at(sr),at(Bo),at(Uo)}function S0(a){Ms(Uo.current);var u=Ms(sr.current),m=pn(u,a.type);u!==m&&(rt(Bo,a),rt(sr,m))}function Kd(a){Bo.current===a&&(at(sr),at(Bo))}var ut=ts(0);function Nl(a){for(var u=a;u!==null;){if(u.tag===13){var m=u.memoizedState;if(m!==null&&(m=m.dehydrated,m===null||m.data==="$?"||m.data==="$!"))return u}else if(u.tag===19&&u.memoizedProps.revealOrder!==void 0){if((u.flags&128)!==0)return u}else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===a)break;for(;u.sibling===null;){if(u.return===null||u.return===a)return null;u=u.return}u.sibling.return=u.return,u=u.sibling}return null}var zd=[];function Wd(){for(var a=0;a<zd.length;a++)zd[a]._workInProgressVersionPrimary=null;zd.length=0}var Ol=I.ReactCurrentDispatcher,Yd=I.ReactCurrentBatchConfig,Fs=0,ct=null,Lt=null,kt=null,Ml=!1,$o=!1,jo=0,qA=0;function Vt(){throw Error(t(321))}function qd(a,u){if(u===null)return!1;for(var m=0;m<u.length&&m<a.length;m++)if(!Vn(a[m],u[m]))return!1;return!0}function Xd(a,u,m,y,T,w){if(Fs=w,ct=u,u.memoizedState=null,u.updateQueue=null,u.lanes=0,Ol.current=a===null||a.memoizedState===null?ZA:eL,a=m(y,T),$o){w=0;do{if($o=!1,jo=0,25<=w)throw Error(t(301));w+=1,kt=Lt=null,u.updateQueue=null,Ol.current=tL,a=m(y,T)}while($o)}if(Ol.current=Ul,u=Lt!==null&&Lt.next!==null,Fs=0,kt=Lt=ct=null,Ml=!1,u)throw Error(t(300));return a}function Qd(){var a=jo!==0;return jo=0,a}function ir(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return kt===null?ct.memoizedState=kt=a:kt=kt.next=a,kt}function Nn(){if(Lt===null){var a=ct.alternate;a=a!==null?a.memoizedState:null}else a=Lt.next;var u=kt===null?ct.memoizedState:kt.next;if(u!==null)kt=u,Lt=a;else{if(a===null)throw Error(t(310));Lt=a,a={memoizedState:Lt.memoizedState,baseState:Lt.baseState,baseQueue:Lt.baseQueue,queue:Lt.queue,next:null},kt===null?ct.memoizedState=kt=a:kt=kt.next=a}return kt}function Vo(a,u){return typeof u=="function"?u(a):u}function Jd(a){var u=Nn(),m=u.queue;if(m===null)throw Error(t(311));m.lastRenderedReducer=a;var y=Lt,T=y.baseQueue,w=m.pending;if(w!==null){if(T!==null){var _=T.next;T.next=w.next,w.next=_}y.baseQueue=T=w,m.pending=null}if(T!==null){w=T.next,y=y.baseState;var B=_=null,j=null,X=w;do{var ae=X.lane;if((Fs&ae)===ae)j!==null&&(j=j.next={lane:0,action:X.action,hasEagerState:X.hasEagerState,eagerState:X.eagerState,next:null}),y=X.hasEagerState?X.eagerState:a(y,X.action);else{var le={lane:ae,action:X.action,hasEagerState:X.hasEagerState,eagerState:X.eagerState,next:null};j===null?(B=j=le,_=y):j=j.next=le,ct.lanes|=ae,Bs|=ae}X=X.next}while(X!==null&&X!==w);j===null?_=y:j.next=B,Vn(y,u.memoizedState)||(nn=!0),u.memoizedState=y,u.baseState=_,u.baseQueue=j,m.lastRenderedState=y}if(a=m.interleaved,a!==null){T=a;do w=T.lane,ct.lanes|=w,Bs|=w,T=T.next;while(T!==a)}else T===null&&(m.lanes=0);return[u.memoizedState,m.dispatch]}function Zd(a){var u=Nn(),m=u.queue;if(m===null)throw Error(t(311));m.lastRenderedReducer=a;var y=m.dispatch,T=m.pending,w=u.memoizedState;if(T!==null){m.pending=null;var _=T=T.next;do w=a(w,_.action),_=_.next;while(_!==T);Vn(w,u.memoizedState)||(nn=!0),u.memoizedState=w,u.baseQueue===null&&(u.baseState=w),m.lastRenderedState=w}return[w,y]}function E0(){}function T0(a,u){var m=ct,y=Nn(),T=u(),w=!Vn(y.memoizedState,T);if(w&&(y.memoizedState=T,nn=!0),y=y.queue,ef(A0.bind(null,m,y,a),[a]),y.getSnapshot!==u||w||kt!==null&&kt.memoizedState.tag&1){if(m.flags|=2048,Go(9,w0.bind(null,m,y,T,u),void 0,null),Pt===null)throw Error(t(349));(Fs&30)!==0||b0(m,u,T)}return T}function b0(a,u,m){a.flags|=16384,a={getSnapshot:u,value:m},u=ct.updateQueue,u===null?(u={lastEffect:null,stores:null},ct.updateQueue=u,u.stores=[a]):(m=u.stores,m===null?u.stores=[a]:m.push(a))}function w0(a,u,m,y){u.value=m,u.getSnapshot=y,L0(u)&&R0(a)}function A0(a,u,m){return m(function(){L0(u)&&R0(a)})}function L0(a){var u=a.getSnapshot;a=a.value;try{var m=u();return!Vn(a,m)}catch{return!0}}function R0(a){var u=_r(a,1);u!==null&&Wn(u,a,1,-1)}function I0(a){var u=ir();return typeof a=="function"&&(a=a()),u.memoizedState=u.baseState=a,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vo,lastRenderedState:a},u.queue=a,a=a.dispatch=JA.bind(null,ct,a),[u.memoizedState,a]}function Go(a,u,m,y){return a={tag:a,create:u,destroy:m,deps:y,next:null},u=ct.updateQueue,u===null?(u={lastEffect:null,stores:null},ct.updateQueue=u,u.lastEffect=a.next=a):(m=u.lastEffect,m===null?u.lastEffect=a.next=a:(y=m.next,m.next=a,a.next=y,u.lastEffect=a)),a}function _0(){return Nn().memoizedState}function Fl(a,u,m,y){var T=ir();ct.flags|=a,T.memoizedState=Go(1|u,m,void 0,y===void 0?null:y)}function Bl(a,u,m,y){var T=Nn();y=y===void 0?null:y;var w=void 0;if(Lt!==null){var _=Lt.memoizedState;if(w=_.destroy,y!==null&&qd(y,_.deps)){T.memoizedState=Go(u,m,w,y);return}}ct.flags|=a,T.memoizedState=Go(1|u,m,w,y)}function C0(a,u){return Fl(8390656,8,a,u)}function ef(a,u){return Bl(2048,8,a,u)}function k0(a,u){return Bl(4,2,a,u)}function P0(a,u){return Bl(4,4,a,u)}function D0(a,u){if(typeof u=="function")return a=a(),u(a),function(){u(null)};if(u!=null)return a=a(),u.current=a,function(){u.current=null}}function N0(a,u,m){return m=m!=null?m.concat([a]):null,Bl(4,4,D0.bind(null,u,a),m)}function tf(){}function O0(a,u){var m=Nn();u=u===void 0?null:u;var y=m.memoizedState;return y!==null&&u!==null&&qd(u,y[1])?y[0]:(m.memoizedState=[a,u],a)}function M0(a,u){var m=Nn();u=u===void 0?null:u;var y=m.memoizedState;return y!==null&&u!==null&&qd(u,y[1])?y[0]:(a=a(),m.memoizedState=[a,u],a)}function F0(a,u,m){return(Fs&21)===0?(a.baseState&&(a.baseState=!1,nn=!0),a.memoizedState=m):(Vn(m,u)||(m=hg(),ct.lanes|=m,Bs|=m,a.baseState=!0),u)}function XA(a,u){var m=Qe;Qe=m!==0&&4>m?m:4,a(!0);var y=Yd.transition;Yd.transition={};try{a(!1),u()}finally{Qe=m,Yd.transition=y}}function B0(){return Nn().memoizedState}function QA(a,u,m){var y=us(a);if(m={lane:y,action:m,hasEagerState:!1,eagerState:null,next:null},U0(a))$0(u,m);else if(m=g0(a,u,m,y),m!==null){var T=Qt();Wn(m,a,y,T),j0(m,u,y)}}function JA(a,u,m){var y=us(a),T={lane:y,action:m,hasEagerState:!1,eagerState:null,next:null};if(U0(a))$0(u,T);else{var w=a.alternate;if(a.lanes===0&&(w===null||w.lanes===0)&&(w=u.lastRenderedReducer,w!==null))try{var _=u.lastRenderedState,B=w(_,m);if(T.hasEagerState=!0,T.eagerState=B,Vn(B,_)){var j=u.interleaved;j===null?(T.next=T,Vd(u)):(T.next=j.next,j.next=T),u.interleaved=T;return}}catch{}finally{}m=g0(a,u,T,y),m!==null&&(T=Qt(),Wn(m,a,y,T),j0(m,u,y))}}function U0(a){var u=a.alternate;return a===ct||u!==null&&u===ct}function $0(a,u){$o=Ml=!0;var m=a.pending;m===null?u.next=u:(u.next=m.next,m.next=u),a.pending=u}function j0(a,u,m){if((m&4194240)!==0){var y=u.lanes;y&=a.pendingLanes,m|=y,u.lanes=m,rd(a,m)}}var Ul={readContext:Dn,useCallback:Vt,useContext:Vt,useEffect:Vt,useImperativeHandle:Vt,useInsertionEffect:Vt,useLayoutEffect:Vt,useMemo:Vt,useReducer:Vt,useRef:Vt,useState:Vt,useDebugValue:Vt,useDeferredValue:Vt,useTransition:Vt,useMutableSource:Vt,useSyncExternalStore:Vt,useId:Vt,unstable_isNewReconciler:!1},ZA={readContext:Dn,useCallback:function(a,u){return ir().memoizedState=[a,u===void 0?null:u],a},useContext:Dn,useEffect:C0,useImperativeHandle:function(a,u,m){return m=m!=null?m.concat([a]):null,Fl(4194308,4,D0.bind(null,u,a),m)},useLayoutEffect:function(a,u){return Fl(4194308,4,a,u)},useInsertionEffect:function(a,u){return Fl(4,2,a,u)},useMemo:function(a,u){var m=ir();return u=u===void 0?null:u,a=a(),m.memoizedState=[a,u],a},useReducer:function(a,u,m){var y=ir();return u=m!==void 0?m(u):u,y.memoizedState=y.baseState=u,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:u},y.queue=a,a=a.dispatch=QA.bind(null,ct,a),[y.memoizedState,a]},useRef:function(a){var u=ir();return a={current:a},u.memoizedState=a},useState:I0,useDebugValue:tf,useDeferredValue:function(a){return ir().memoizedState=a},useTransition:function(){var a=I0(!1),u=a[0];return a=XA.bind(null,a[1]),ir().memoizedState=a,[u,a]},useMutableSource:function(){},useSyncExternalStore:function(a,u,m){var y=ct,T=ir();if(lt){if(m===void 0)throw Error(t(407));m=m()}else{if(m=u(),Pt===null)throw Error(t(349));(Fs&30)!==0||b0(y,u,m)}T.memoizedState=m;var w={value:m,getSnapshot:u};return T.queue=w,C0(A0.bind(null,y,w,a),[a]),y.flags|=2048,Go(9,w0.bind(null,y,w,m,u),void 0,null),m},useId:function(){var a=ir(),u=Pt.identifierPrefix;if(lt){var m=Ir,y=Rr;m=(y&~(1<<32-jn(y)-1)).toString(32)+m,u=":"+u+"R"+m,m=jo++,0<m&&(u+="H"+m.toString(32)),u+=":"}else m=qA++,u=":"+u+"r"+m.toString(32)+":";return a.memoizedState=u},unstable_isNewReconciler:!1},eL={readContext:Dn,useCallback:O0,useContext:Dn,useEffect:ef,useImperativeHandle:N0,useInsertionEffect:k0,useLayoutEffect:P0,useMemo:M0,useReducer:Jd,useRef:_0,useState:function(){return Jd(Vo)},useDebugValue:tf,useDeferredValue:function(a){var u=Nn();return F0(u,Lt.memoizedState,a)},useTransition:function(){var a=Jd(Vo)[0],u=Nn().memoizedState;return[a,u]},useMutableSource:E0,useSyncExternalStore:T0,useId:B0,unstable_isNewReconciler:!1},tL={readContext:Dn,useCallback:O0,useContext:Dn,useEffect:ef,useImperativeHandle:N0,useInsertionEffect:k0,useLayoutEffect:P0,useMemo:M0,useReducer:Zd,useRef:_0,useState:function(){return Zd(Vo)},useDebugValue:tf,useDeferredValue:function(a){var u=Nn();return Lt===null?u.memoizedState=a:F0(u,Lt.memoizedState,a)},useTransition:function(){var a=Zd(Vo)[0],u=Nn().memoizedState;return[a,u]},useMutableSource:E0,useSyncExternalStore:T0,useId:B0,unstable_isNewReconciler:!1};function Hn(a,u){if(a&&a.defaultProps){u=ee({},u),a=a.defaultProps;for(var m in a)u[m]===void 0&&(u[m]=a[m]);return u}return u}function nf(a,u,m,y){u=a.memoizedState,m=m(y,u),m=m==null?u:ee({},u,m),a.memoizedState=m,a.lanes===0&&(a.updateQueue.baseState=m)}var $l={isMounted:function(a){return(a=a._reactInternals)?Cs(a)===a:!1},enqueueSetState:function(a,u,m){a=a._reactInternals;var y=Qt(),T=us(a),w=Cr(y,T);w.payload=u,m!=null&&(w.callback=m),u=is(a,w,T),u!==null&&(Wn(u,a,T,y),Pl(u,a,T))},enqueueReplaceState:function(a,u,m){a=a._reactInternals;var y=Qt(),T=us(a),w=Cr(y,T);w.tag=1,w.payload=u,m!=null&&(w.callback=m),u=is(a,w,T),u!==null&&(Wn(u,a,T,y),Pl(u,a,T))},enqueueForceUpdate:function(a,u){a=a._reactInternals;var m=Qt(),y=us(a),T=Cr(m,y);T.tag=2,u!=null&&(T.callback=u),u=is(a,T,y),u!==null&&(Wn(u,a,y,m),Pl(u,a,y))}};function V0(a,u,m,y,T,w,_){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(y,w,_):u.prototype&&u.prototype.isPureReactComponent?!_o(m,y)||!_o(T,w):!0}function G0(a,u,m){var y=!1,T=ns,w=u.contextType;return typeof w=="object"&&w!==null?w=Dn(w):(T=tn(u)?Ps:jt.current,y=u.contextTypes,w=(y=y!=null)?Si(a,T):ns),u=new u(m,w),a.memoizedState=u.state!==null&&u.state!==void 0?u.state:null,u.updater=$l,a.stateNode=u,u._reactInternals=a,y&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=T,a.__reactInternalMemoizedMaskedChildContext=w),u}function H0(a,u,m,y){a=u.state,typeof u.componentWillReceiveProps=="function"&&u.componentWillReceiveProps(m,y),typeof u.UNSAFE_componentWillReceiveProps=="function"&&u.UNSAFE_componentWillReceiveProps(m,y),u.state!==a&&$l.enqueueReplaceState(u,u.state,null)}function rf(a,u,m,y){var T=a.stateNode;T.props=m,T.state=a.memoizedState,T.refs={},Gd(a);var w=u.contextType;typeof w=="object"&&w!==null?T.context=Dn(w):(w=tn(u)?Ps:jt.current,T.context=Si(a,w)),T.state=a.memoizedState,w=u.getDerivedStateFromProps,typeof w=="function"&&(nf(a,u,w,m),T.state=a.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof T.getSnapshotBeforeUpdate=="function"||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(u=T.state,typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount(),u!==T.state&&$l.enqueueReplaceState(T,T.state,null),Dl(a,m,T,y),T.state=a.memoizedState),typeof T.componentDidMount=="function"&&(a.flags|=4194308)}function Ii(a,u){try{var m="",y=u;do m+=ce(y),y=y.return;while(y);var T=m}catch(w){T=`
Error generating stack: `+w.message+`
`+w.stack}return{value:a,source:u,stack:T,digest:null}}function sf(a,u,m){return{value:a,source:null,stack:m??null,digest:u??null}}function of(a,u){try{console.error(u.value)}catch(m){setTimeout(function(){throw m})}}var nL=typeof WeakMap=="function"?WeakMap:Map;function K0(a,u,m){m=Cr(-1,m),m.tag=3,m.payload={element:null};var y=u.value;return m.callback=function(){Wl||(Wl=!0,Ef=y),of(a,u)},m}function z0(a,u,m){m=Cr(-1,m),m.tag=3;var y=a.type.getDerivedStateFromError;if(typeof y=="function"){var T=u.value;m.payload=function(){return y(T)},m.callback=function(){of(a,u)}}var w=a.stateNode;return w!==null&&typeof w.componentDidCatch=="function"&&(m.callback=function(){of(a,u),typeof y!="function"&&(as===null?as=new Set([this]):as.add(this));var _=u.stack;this.componentDidCatch(u.value,{componentStack:_!==null?_:""})}),m}function W0(a,u,m){var y=a.pingCache;if(y===null){y=a.pingCache=new nL;var T=new Set;y.set(u,T)}else T=y.get(u),T===void 0&&(T=new Set,y.set(u,T));T.has(m)||(T.add(m),a=gL.bind(null,a,u,m),u.then(a,a))}function Y0(a){do{var u;if((u=a.tag===13)&&(u=a.memoizedState,u=u!==null?u.dehydrated!==null:!0),u)return a;a=a.return}while(a!==null);return null}function q0(a,u,m,y,T){return(a.mode&1)===0?(a===u?a.flags|=65536:(a.flags|=128,m.flags|=131072,m.flags&=-52805,m.tag===1&&(m.alternate===null?m.tag=17:(u=Cr(-1,1),u.tag=2,is(m,u,1))),m.lanes|=1),a):(a.flags|=65536,a.lanes=T,a)}var rL=I.ReactCurrentOwner,nn=!1;function Xt(a,u,m,y){u.child=a===null?p0(u,null,m,y):wi(u,a.child,m,y)}function X0(a,u,m,y,T){m=m.render;var w=u.ref;return Li(u,T),y=Xd(a,u,m,y,w,T),m=Qd(),a!==null&&!nn?(u.updateQueue=a.updateQueue,u.flags&=-2053,a.lanes&=~T,kr(a,u,T)):(lt&&m&&Dd(u),u.flags|=1,Xt(a,u,y,T),u.child)}function Q0(a,u,m,y,T){if(a===null){var w=m.type;return typeof w=="function"&&!If(w)&&w.defaultProps===void 0&&m.compare===null&&m.defaultProps===void 0?(u.tag=15,u.type=w,J0(a,u,w,y,T)):(a=Zl(m.type,null,y,u,u.mode,T),a.ref=u.ref,a.return=u,u.child=a)}if(w=a.child,(a.lanes&T)===0){var _=w.memoizedProps;if(m=m.compare,m=m!==null?m:_o,m(_,y)&&a.ref===u.ref)return kr(a,u,T)}return u.flags|=1,a=ds(w,y),a.ref=u.ref,a.return=u,u.child=a}function J0(a,u,m,y,T){if(a!==null){var w=a.memoizedProps;if(_o(w,y)&&a.ref===u.ref)if(nn=!1,u.pendingProps=y=w,(a.lanes&T)!==0)(a.flags&131072)!==0&&(nn=!0);else return u.lanes=a.lanes,kr(a,u,T)}return af(a,u,m,y,T)}function Z0(a,u,m){var y=u.pendingProps,T=y.children,w=a!==null?a.memoizedState:null;if(y.mode==="hidden")if((u.mode&1)===0)u.memoizedState={baseLanes:0,cachePool:null,transitions:null},rt(Ci,Sn),Sn|=m;else{if((m&1073741824)===0)return a=w!==null?w.baseLanes|m:m,u.lanes=u.childLanes=1073741824,u.memoizedState={baseLanes:a,cachePool:null,transitions:null},u.updateQueue=null,rt(Ci,Sn),Sn|=a,null;u.memoizedState={baseLanes:0,cachePool:null,transitions:null},y=w!==null?w.baseLanes:m,rt(Ci,Sn),Sn|=y}else w!==null?(y=w.baseLanes|m,u.memoizedState=null):y=m,rt(Ci,Sn),Sn|=y;return Xt(a,u,T,m),u.child}function ey(a,u){var m=u.ref;(a===null&&m!==null||a!==null&&a.ref!==m)&&(u.flags|=512,u.flags|=2097152)}function af(a,u,m,y,T){var w=tn(m)?Ps:jt.current;return w=Si(u,w),Li(u,T),m=Xd(a,u,m,y,w,T),y=Qd(),a!==null&&!nn?(u.updateQueue=a.updateQueue,u.flags&=-2053,a.lanes&=~T,kr(a,u,T)):(lt&&y&&Dd(u),u.flags|=1,Xt(a,u,m,T),u.child)}function ty(a,u,m,y,T){if(tn(m)){var w=!0;wl(u)}else w=!1;if(Li(u,T),u.stateNode===null)Vl(a,u),G0(u,m,y),rf(u,m,y,T),y=!0;else if(a===null){var _=u.stateNode,B=u.memoizedProps;_.props=B;var j=_.context,X=m.contextType;typeof X=="object"&&X!==null?X=Dn(X):(X=tn(m)?Ps:jt.current,X=Si(u,X));var ae=m.getDerivedStateFromProps,le=typeof ae=="function"||typeof _.getSnapshotBeforeUpdate=="function";le||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(B!==y||j!==X)&&H0(u,_,y,X),ss=!1;var oe=u.memoizedState;_.state=oe,Dl(u,y,_,T),j=u.memoizedState,B!==y||oe!==j||en.current||ss?(typeof ae=="function"&&(nf(u,m,ae,y),j=u.memoizedState),(B=ss||V0(u,m,B,y,oe,j,X))?(le||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount()),typeof _.componentDidMount=="function"&&(u.flags|=4194308)):(typeof _.componentDidMount=="function"&&(u.flags|=4194308),u.memoizedProps=y,u.memoizedState=j),_.props=y,_.state=j,_.context=X,y=B):(typeof _.componentDidMount=="function"&&(u.flags|=4194308),y=!1)}else{_=u.stateNode,y0(a,u),B=u.memoizedProps,X=u.type===u.elementType?B:Hn(u.type,B),_.props=X,le=u.pendingProps,oe=_.context,j=m.contextType,typeof j=="object"&&j!==null?j=Dn(j):(j=tn(m)?Ps:jt.current,j=Si(u,j));var pe=m.getDerivedStateFromProps;(ae=typeof pe=="function"||typeof _.getSnapshotBeforeUpdate=="function")||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(B!==le||oe!==j)&&H0(u,_,y,j),ss=!1,oe=u.memoizedState,_.state=oe,Dl(u,y,_,T);var Se=u.memoizedState;B!==le||oe!==Se||en.current||ss?(typeof pe=="function"&&(nf(u,m,pe,y),Se=u.memoizedState),(X=ss||V0(u,m,X,y,oe,Se,j)||!1)?(ae||typeof _.UNSAFE_componentWillUpdate!="function"&&typeof _.componentWillUpdate!="function"||(typeof _.componentWillUpdate=="function"&&_.componentWillUpdate(y,Se,j),typeof _.UNSAFE_componentWillUpdate=="function"&&_.UNSAFE_componentWillUpdate(y,Se,j)),typeof _.componentDidUpdate=="function"&&(u.flags|=4),typeof _.getSnapshotBeforeUpdate=="function"&&(u.flags|=1024)):(typeof _.componentDidUpdate!="function"||B===a.memoizedProps&&oe===a.memoizedState||(u.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||B===a.memoizedProps&&oe===a.memoizedState||(u.flags|=1024),u.memoizedProps=y,u.memoizedState=Se),_.props=y,_.state=Se,_.context=j,y=X):(typeof _.componentDidUpdate!="function"||B===a.memoizedProps&&oe===a.memoizedState||(u.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||B===a.memoizedProps&&oe===a.memoizedState||(u.flags|=1024),y=!1)}return lf(a,u,m,y,w,T)}function lf(a,u,m,y,T,w){ey(a,u);var _=(u.flags&128)!==0;if(!y&&!_)return T&&o0(u,m,!1),kr(a,u,w);y=u.stateNode,rL.current=u;var B=_&&typeof m.getDerivedStateFromError!="function"?null:y.render();return u.flags|=1,a!==null&&_?(u.child=wi(u,a.child,null,w),u.child=wi(u,null,B,w)):Xt(a,u,B,w),u.memoizedState=y.state,T&&o0(u,m,!0),u.child}function ny(a){var u=a.stateNode;u.pendingContext?s0(a,u.pendingContext,u.pendingContext!==u.context):u.context&&s0(a,u.context,!1),Hd(a,u.containerInfo)}function ry(a,u,m,y,T){return bi(),Fd(T),u.flags|=256,Xt(a,u,m,y),u.child}var uf={dehydrated:null,treeContext:null,retryLane:0};function cf(a){return{baseLanes:a,cachePool:null,transitions:null}}function sy(a,u,m){var y=u.pendingProps,T=ut.current,w=!1,_=(u.flags&128)!==0,B;if((B=_)||(B=a!==null&&a.memoizedState===null?!1:(T&2)!==0),B?(w=!0,u.flags&=-129):(a===null||a.memoizedState!==null)&&(T|=1),rt(ut,T&1),a===null)return Md(u),a=u.memoizedState,a!==null&&(a=a.dehydrated,a!==null)?((u.mode&1)===0?u.lanes=1:a.data==="$!"?u.lanes=8:u.lanes=1073741824,null):(_=y.children,a=y.fallback,w?(y=u.mode,w=u.child,_={mode:"hidden",children:_},(y&1)===0&&w!==null?(w.childLanes=0,w.pendingProps=_):w=eu(_,y,0,null),a=Vs(a,y,m,null),w.return=u,a.return=u,w.sibling=a,u.child=w,u.child.memoizedState=cf(m),u.memoizedState=uf,a):df(u,_));if(T=a.memoizedState,T!==null&&(B=T.dehydrated,B!==null))return sL(a,u,_,y,B,T,m);if(w){w=y.fallback,_=u.mode,T=a.child,B=T.sibling;var j={mode:"hidden",children:y.children};return(_&1)===0&&u.child!==T?(y=u.child,y.childLanes=0,y.pendingProps=j,u.deletions=null):(y=ds(T,j),y.subtreeFlags=T.subtreeFlags&14680064),B!==null?w=ds(B,w):(w=Vs(w,_,m,null),w.flags|=2),w.return=u,y.return=u,y.sibling=w,u.child=y,y=w,w=u.child,_=a.child.memoizedState,_=_===null?cf(m):{baseLanes:_.baseLanes|m,cachePool:null,transitions:_.transitions},w.memoizedState=_,w.childLanes=a.childLanes&~m,u.memoizedState=uf,y}return w=a.child,a=w.sibling,y=ds(w,{mode:"visible",children:y.children}),(u.mode&1)===0&&(y.lanes=m),y.return=u,y.sibling=null,a!==null&&(m=u.deletions,m===null?(u.deletions=[a],u.flags|=16):m.push(a)),u.child=y,u.memoizedState=null,y}function df(a,u){return u=eu({mode:"visible",children:u},a.mode,0,null),u.return=a,a.child=u}function jl(a,u,m,y){return y!==null&&Fd(y),wi(u,a.child,null,m),a=df(u,u.pendingProps.children),a.flags|=2,u.memoizedState=null,a}function sL(a,u,m,y,T,w,_){if(m)return u.flags&256?(u.flags&=-257,y=sf(Error(t(422))),jl(a,u,_,y)):u.memoizedState!==null?(u.child=a.child,u.flags|=128,null):(w=y.fallback,T=u.mode,y=eu({mode:"visible",children:y.children},T,0,null),w=Vs(w,T,_,null),w.flags|=2,y.return=u,w.return=u,y.sibling=w,u.child=y,(u.mode&1)!==0&&wi(u,a.child,null,_),u.child.memoizedState=cf(_),u.memoizedState=uf,w);if((u.mode&1)===0)return jl(a,u,_,null);if(T.data==="$!"){if(y=T.nextSibling&&T.nextSibling.dataset,y)var B=y.dgst;return y=B,w=Error(t(419)),y=sf(w,y,void 0),jl(a,u,_,y)}if(B=(_&a.childLanes)!==0,nn||B){if(y=Pt,y!==null){switch(_&-_){case 4:T=2;break;case 16:T=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:T=32;break;case 536870912:T=268435456;break;default:T=0}T=(T&(y.suspendedLanes|_))!==0?0:T,T!==0&&T!==w.retryLane&&(w.retryLane=T,_r(a,T),Wn(y,a,T,-1))}return Rf(),y=sf(Error(t(421))),jl(a,u,_,y)}return T.data==="$?"?(u.flags|=128,u.child=a.child,u=yL.bind(null,a),T._reactRetry=u,null):(a=w.treeContext,xn=es(T.nextSibling),vn=u,lt=!0,Gn=null,a!==null&&(kn[Pn++]=Rr,kn[Pn++]=Ir,kn[Pn++]=Ds,Rr=a.id,Ir=a.overflow,Ds=u),u=df(u,y.children),u.flags|=4096,u)}function iy(a,u,m){a.lanes|=u;var y=a.alternate;y!==null&&(y.lanes|=u),jd(a.return,u,m)}function ff(a,u,m,y,T){var w=a.memoizedState;w===null?a.memoizedState={isBackwards:u,rendering:null,renderingStartTime:0,last:y,tail:m,tailMode:T}:(w.isBackwards=u,w.rendering=null,w.renderingStartTime=0,w.last=y,w.tail=m,w.tailMode=T)}function oy(a,u,m){var y=u.pendingProps,T=y.revealOrder,w=y.tail;if(Xt(a,u,y.children,m),y=ut.current,(y&2)!==0)y=y&1|2,u.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=u.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&iy(a,m,u);else if(a.tag===19)iy(a,m,u);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===u)break e;for(;a.sibling===null;){if(a.return===null||a.return===u)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}y&=1}if(rt(ut,y),(u.mode&1)===0)u.memoizedState=null;else switch(T){case"forwards":for(m=u.child,T=null;m!==null;)a=m.alternate,a!==null&&Nl(a)===null&&(T=m),m=m.sibling;m=T,m===null?(T=u.child,u.child=null):(T=m.sibling,m.sibling=null),ff(u,!1,T,m,w);break;case"backwards":for(m=null,T=u.child,u.child=null;T!==null;){if(a=T.alternate,a!==null&&Nl(a)===null){u.child=T;break}a=T.sibling,T.sibling=m,m=T,T=a}ff(u,!0,m,null,w);break;case"together":ff(u,!1,null,null,void 0);break;default:u.memoizedState=null}return u.child}function Vl(a,u){(u.mode&1)===0&&a!==null&&(a.alternate=null,u.alternate=null,u.flags|=2)}function kr(a,u,m){if(a!==null&&(u.dependencies=a.dependencies),Bs|=u.lanes,(m&u.childLanes)===0)return null;if(a!==null&&u.child!==a.child)throw Error(t(153));if(u.child!==null){for(a=u.child,m=ds(a,a.pendingProps),u.child=m,m.return=u;a.sibling!==null;)a=a.sibling,m=m.sibling=ds(a,a.pendingProps),m.return=u;m.sibling=null}return u.child}function iL(a,u,m){switch(u.tag){case 3:ny(u),bi();break;case 5:S0(u);break;case 1:tn(u.type)&&wl(u);break;case 4:Hd(u,u.stateNode.containerInfo);break;case 10:var y=u.type._context,T=u.memoizedProps.value;rt(Cl,y._currentValue),y._currentValue=T;break;case 13:if(y=u.memoizedState,y!==null)return y.dehydrated!==null?(rt(ut,ut.current&1),u.flags|=128,null):(m&u.child.childLanes)!==0?sy(a,u,m):(rt(ut,ut.current&1),a=kr(a,u,m),a!==null?a.sibling:null);rt(ut,ut.current&1);break;case 19:if(y=(m&u.childLanes)!==0,(a.flags&128)!==0){if(y)return oy(a,u,m);u.flags|=128}if(T=u.memoizedState,T!==null&&(T.rendering=null,T.tail=null,T.lastEffect=null),rt(ut,ut.current),y)break;return null;case 22:case 23:return u.lanes=0,Z0(a,u,m)}return kr(a,u,m)}var ay,hf,ly,uy;ay=function(a,u){for(var m=u.child;m!==null;){if(m.tag===5||m.tag===6)a.appendChild(m.stateNode);else if(m.tag!==4&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===u)break;for(;m.sibling===null;){if(m.return===null||m.return===u)return;m=m.return}m.sibling.return=m.return,m=m.sibling}},hf=function(){},ly=function(a,u,m,y){var T=a.memoizedProps;if(T!==y){a=u.stateNode,Ms(sr.current);var w=null;switch(m){case"input":T=Re(a,T),y=Re(a,y),w=[];break;case"select":T=ee({},T,{value:void 0}),y=ee({},y,{value:void 0}),w=[];break;case"textarea":T=Ct(a,T),y=Ct(a,y),w=[];break;default:typeof T.onClick!="function"&&typeof y.onClick=="function"&&(a.onclick=El)}oo(m,y);var _;m=null;for(X in T)if(!y.hasOwnProperty(X)&&T.hasOwnProperty(X)&&T[X]!=null)if(X==="style"){var B=T[X];for(_ in B)B.hasOwnProperty(_)&&(m||(m={}),m[_]="")}else X!=="dangerouslySetInnerHTML"&&X!=="children"&&X!=="suppressContentEditableWarning"&&X!=="suppressHydrationWarning"&&X!=="autoFocus"&&(s.hasOwnProperty(X)?w||(w=[]):(w=w||[]).push(X,null));for(X in y){var j=y[X];if(B=T?.[X],y.hasOwnProperty(X)&&j!==B&&(j!=null||B!=null))if(X==="style")if(B){for(_ in B)!B.hasOwnProperty(_)||j&&j.hasOwnProperty(_)||(m||(m={}),m[_]="");for(_ in j)j.hasOwnProperty(_)&&B[_]!==j[_]&&(m||(m={}),m[_]=j[_])}else m||(w||(w=[]),w.push(X,m)),m=j;else X==="dangerouslySetInnerHTML"?(j=j?j.__html:void 0,B=B?B.__html:void 0,j!=null&&B!==j&&(w=w||[]).push(X,j)):X==="children"?typeof j!="string"&&typeof j!="number"||(w=w||[]).push(X,""+j):X!=="suppressContentEditableWarning"&&X!=="suppressHydrationWarning"&&(s.hasOwnProperty(X)?(j!=null&&X==="onScroll"&&ot("scroll",a),w||B===j||(w=[])):(w=w||[]).push(X,j))}m&&(w=w||[]).push("style",m);var X=w;(u.updateQueue=X)&&(u.flags|=4)}},uy=function(a,u,m,y){m!==y&&(u.flags|=4)};function Ho(a,u){if(!lt)switch(a.tailMode){case"hidden":u=a.tail;for(var m=null;u!==null;)u.alternate!==null&&(m=u),u=u.sibling;m===null?a.tail=null:m.sibling=null;break;case"collapsed":m=a.tail;for(var y=null;m!==null;)m.alternate!==null&&(y=m),m=m.sibling;y===null?u||a.tail===null?a.tail=null:a.tail.sibling=null:y.sibling=null}}function Gt(a){var u=a.alternate!==null&&a.alternate.child===a.child,m=0,y=0;if(u)for(var T=a.child;T!==null;)m|=T.lanes|T.childLanes,y|=T.subtreeFlags&14680064,y|=T.flags&14680064,T.return=a,T=T.sibling;else for(T=a.child;T!==null;)m|=T.lanes|T.childLanes,y|=T.subtreeFlags,y|=T.flags,T.return=a,T=T.sibling;return a.subtreeFlags|=y,a.childLanes=m,u}function oL(a,u,m){var y=u.pendingProps;switch(Nd(u),u.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Gt(u),null;case 1:return tn(u.type)&&bl(),Gt(u),null;case 3:return y=u.stateNode,Ri(),at(en),at(jt),Wd(),y.pendingContext&&(y.context=y.pendingContext,y.pendingContext=null),(a===null||a.child===null)&&(Il(u)?u.flags|=4:a===null||a.memoizedState.isDehydrated&&(u.flags&256)===0||(u.flags|=1024,Gn!==null&&(wf(Gn),Gn=null))),hf(a,u),Gt(u),null;case 5:Kd(u);var T=Ms(Uo.current);if(m=u.type,a!==null&&u.stateNode!=null)ly(a,u,m,y,T),a.ref!==u.ref&&(u.flags|=512,u.flags|=2097152);else{if(!y){if(u.stateNode===null)throw Error(t(166));return Gt(u),null}if(a=Ms(sr.current),Il(u)){y=u.stateNode,m=u.type;var w=u.memoizedProps;switch(y[rr]=u,y[No]=w,a=(u.mode&1)!==0,m){case"dialog":ot("cancel",y),ot("close",y);break;case"iframe":case"object":case"embed":ot("load",y);break;case"video":case"audio":for(T=0;T<ko.length;T++)ot(ko[T],y);break;case"source":ot("error",y);break;case"img":case"image":case"link":ot("error",y),ot("load",y);break;case"details":ot("toggle",y);break;case"input":$e(y,w),ot("invalid",y);break;case"select":y._wrapperState={wasMultiple:!!w.multiple},ot("invalid",y);break;case"textarea":Cn(y,w),ot("invalid",y)}oo(m,w),T=null;for(var _ in w)if(w.hasOwnProperty(_)){var B=w[_];_==="children"?typeof B=="string"?y.textContent!==B&&(w.suppressHydrationWarning!==!0&&Sl(y.textContent,B,a),T=["children",B]):typeof B=="number"&&y.textContent!==""+B&&(w.suppressHydrationWarning!==!0&&Sl(y.textContent,B,a),T=["children",""+B]):s.hasOwnProperty(_)&&B!=null&&_==="onScroll"&&ot("scroll",y)}switch(m){case"input":Pe(y),qe(y,w,!0);break;case"textarea":Pe(y),vt(y);break;case"select":case"option":break;default:typeof w.onClick=="function"&&(y.onclick=El)}y=T,u.updateQueue=y,y!==null&&(u.flags|=4)}else{_=T.nodeType===9?T:T.ownerDocument,a==="http://www.w3.org/1999/xhtml"&&(a=bt(m)),a==="http://www.w3.org/1999/xhtml"?m==="script"?(a=_.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild)):typeof y.is=="string"?a=_.createElement(m,{is:y.is}):(a=_.createElement(m),m==="select"&&(_=a,y.multiple?_.multiple=!0:y.size&&(_.size=y.size))):a=_.createElementNS(a,m),a[rr]=u,a[No]=y,ay(a,u,!1,!1),u.stateNode=a;e:{switch(_=ao(m,y),m){case"dialog":ot("cancel",a),ot("close",a),T=y;break;case"iframe":case"object":case"embed":ot("load",a),T=y;break;case"video":case"audio":for(T=0;T<ko.length;T++)ot(ko[T],a);T=y;break;case"source":ot("error",a),T=y;break;case"img":case"image":case"link":ot("error",a),ot("load",a),T=y;break;case"details":ot("toggle",a),T=y;break;case"input":$e(a,y),T=Re(a,y),ot("invalid",a);break;case"option":T=y;break;case"select":a._wrapperState={wasMultiple:!!y.multiple},T=ee({},y,{value:void 0}),ot("invalid",a);break;case"textarea":Cn(a,y),T=Ct(a,y),ot("invalid",a);break;default:T=y}oo(m,T),B=T;for(w in B)if(B.hasOwnProperty(w)){var j=B[w];w==="style"?Qa(a,j):w==="dangerouslySetInnerHTML"?(j=j?j.__html:void 0,j!=null&&gn(a,j)):w==="children"?typeof j=="string"?(m!=="textarea"||j!=="")&&Yt(a,j):typeof j=="number"&&Yt(a,""+j):w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&w!=="autoFocus"&&(s.hasOwnProperty(w)?j!=null&&w==="onScroll"&&ot("scroll",a):j!=null&&L(a,w,j,_))}switch(m){case"input":Pe(a),qe(a,y,!1);break;case"textarea":Pe(a),vt(a);break;case"option":y.value!=null&&a.setAttribute("value",""+ye(y.value));break;case"select":a.multiple=!!y.multiple,w=y.value,w!=null?Xe(a,!!y.multiple,w,!1):y.defaultValue!=null&&Xe(a,!!y.multiple,y.defaultValue,!0);break;default:typeof T.onClick=="function"&&(a.onclick=El)}switch(m){case"button":case"input":case"select":case"textarea":y=!!y.autoFocus;break e;case"img":y=!0;break e;default:y=!1}}y&&(u.flags|=4)}u.ref!==null&&(u.flags|=512,u.flags|=2097152)}return Gt(u),null;case 6:if(a&&u.stateNode!=null)uy(a,u,a.memoizedProps,y);else{if(typeof y!="string"&&u.stateNode===null)throw Error(t(166));if(m=Ms(Uo.current),Ms(sr.current),Il(u)){if(y=u.stateNode,m=u.memoizedProps,y[rr]=u,(w=y.nodeValue!==m)&&(a=vn,a!==null))switch(a.tag){case 3:Sl(y.nodeValue,m,(a.mode&1)!==0);break;case 5:a.memoizedProps.suppressHydrationWarning!==!0&&Sl(y.nodeValue,m,(a.mode&1)!==0)}w&&(u.flags|=4)}else y=(m.nodeType===9?m:m.ownerDocument).createTextNode(y),y[rr]=u,u.stateNode=y}return Gt(u),null;case 13:if(at(ut),y=u.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(lt&&xn!==null&&(u.mode&1)!==0&&(u.flags&128)===0)f0(),bi(),u.flags|=98560,w=!1;else if(w=Il(u),y!==null&&y.dehydrated!==null){if(a===null){if(!w)throw Error(t(318));if(w=u.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(t(317));w[rr]=u}else bi(),(u.flags&128)===0&&(u.memoizedState=null),u.flags|=4;Gt(u),w=!1}else Gn!==null&&(wf(Gn),Gn=null),w=!0;if(!w)return u.flags&65536?u:null}return(u.flags&128)!==0?(u.lanes=m,u):(y=y!==null,y!==(a!==null&&a.memoizedState!==null)&&y&&(u.child.flags|=8192,(u.mode&1)!==0&&(a===null||(ut.current&1)!==0?Rt===0&&(Rt=3):Rf())),u.updateQueue!==null&&(u.flags|=4),Gt(u),null);case 4:return Ri(),hf(a,u),a===null&&Po(u.stateNode.containerInfo),Gt(u),null;case 10:return $d(u.type._context),Gt(u),null;case 17:return tn(u.type)&&bl(),Gt(u),null;case 19:if(at(ut),w=u.memoizedState,w===null)return Gt(u),null;if(y=(u.flags&128)!==0,_=w.rendering,_===null)if(y)Ho(w,!1);else{if(Rt!==0||a!==null&&(a.flags&128)!==0)for(a=u.child;a!==null;){if(_=Nl(a),_!==null){for(u.flags|=128,Ho(w,!1),y=_.updateQueue,y!==null&&(u.updateQueue=y,u.flags|=4),u.subtreeFlags=0,y=m,m=u.child;m!==null;)w=m,a=y,w.flags&=14680066,_=w.alternate,_===null?(w.childLanes=0,w.lanes=a,w.child=null,w.subtreeFlags=0,w.memoizedProps=null,w.memoizedState=null,w.updateQueue=null,w.dependencies=null,w.stateNode=null):(w.childLanes=_.childLanes,w.lanes=_.lanes,w.child=_.child,w.subtreeFlags=0,w.deletions=null,w.memoizedProps=_.memoizedProps,w.memoizedState=_.memoizedState,w.updateQueue=_.updateQueue,w.type=_.type,a=_.dependencies,w.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),m=m.sibling;return rt(ut,ut.current&1|2),u.child}a=a.sibling}w.tail!==null&&xt()>ki&&(u.flags|=128,y=!0,Ho(w,!1),u.lanes=4194304)}else{if(!y)if(a=Nl(_),a!==null){if(u.flags|=128,y=!0,m=a.updateQueue,m!==null&&(u.updateQueue=m,u.flags|=4),Ho(w,!0),w.tail===null&&w.tailMode==="hidden"&&!_.alternate&&!lt)return Gt(u),null}else 2*xt()-w.renderingStartTime>ki&&m!==1073741824&&(u.flags|=128,y=!0,Ho(w,!1),u.lanes=4194304);w.isBackwards?(_.sibling=u.child,u.child=_):(m=w.last,m!==null?m.sibling=_:u.child=_,w.last=_)}return w.tail!==null?(u=w.tail,w.rendering=u,w.tail=u.sibling,w.renderingStartTime=xt(),u.sibling=null,m=ut.current,rt(ut,y?m&1|2:m&1),u):(Gt(u),null);case 22:case 23:return Lf(),y=u.memoizedState!==null,a!==null&&a.memoizedState!==null!==y&&(u.flags|=8192),y&&(u.mode&1)!==0?(Sn&1073741824)!==0&&(Gt(u),u.subtreeFlags&6&&(u.flags|=8192)):Gt(u),null;case 24:return null;case 25:return null}throw Error(t(156,u.tag))}function aL(a,u){switch(Nd(u),u.tag){case 1:return tn(u.type)&&bl(),a=u.flags,a&65536?(u.flags=a&-65537|128,u):null;case 3:return Ri(),at(en),at(jt),Wd(),a=u.flags,(a&65536)!==0&&(a&128)===0?(u.flags=a&-65537|128,u):null;case 5:return Kd(u),null;case 13:if(at(ut),a=u.memoizedState,a!==null&&a.dehydrated!==null){if(u.alternate===null)throw Error(t(340));bi()}return a=u.flags,a&65536?(u.flags=a&-65537|128,u):null;case 19:return at(ut),null;case 4:return Ri(),null;case 10:return $d(u.type._context),null;case 22:case 23:return Lf(),null;case 24:return null;default:return null}}var Gl=!1,Ht=!1,lL=typeof WeakSet=="function"?WeakSet:Set,ve=null;function _i(a,u){var m=a.ref;if(m!==null)if(typeof m=="function")try{m(null)}catch(y){gt(a,u,y)}else m.current=null}function mf(a,u,m){try{m()}catch(y){gt(a,u,y)}}var cy=!1;function uL(a,u){if(Ad=ul,a=Vg(),yd(a)){if("selectionStart"in a)var m={start:a.selectionStart,end:a.selectionEnd};else e:{m=(m=a.ownerDocument)&&m.defaultView||window;var y=m.getSelection&&m.getSelection();if(y&&y.rangeCount!==0){m=y.anchorNode;var T=y.anchorOffset,w=y.focusNode;y=y.focusOffset;try{m.nodeType,w.nodeType}catch{m=null;break e}var _=0,B=-1,j=-1,X=0,ae=0,le=a,oe=null;t:for(;;){for(var pe;le!==m||T!==0&&le.nodeType!==3||(B=_+T),le!==w||y!==0&&le.nodeType!==3||(j=_+y),le.nodeType===3&&(_+=le.nodeValue.length),(pe=le.firstChild)!==null;)oe=le,le=pe;for(;;){if(le===a)break t;if(oe===m&&++X===T&&(B=_),oe===w&&++ae===y&&(j=_),(pe=le.nextSibling)!==null)break;le=oe,oe=le.parentNode}le=pe}m=B===-1||j===-1?null:{start:B,end:j}}else m=null}m=m||{start:0,end:0}}else m=null;for(Ld={focusedElem:a,selectionRange:m},ul=!1,ve=u;ve!==null;)if(u=ve,a=u.child,(u.subtreeFlags&1028)!==0&&a!==null)a.return=u,ve=a;else for(;ve!==null;){u=ve;try{var Se=u.alternate;if((u.flags&1024)!==0)switch(u.tag){case 0:case 11:case 15:break;case 1:if(Se!==null){var be=Se.memoizedProps,St=Se.memoizedState,W=u.stateNode,V=W.getSnapshotBeforeUpdate(u.elementType===u.type?be:Hn(u.type,be),St);W.__reactInternalSnapshotBeforeUpdate=V}break;case 3:var Y=u.stateNode.containerInfo;Y.nodeType===1?Y.textContent="":Y.nodeType===9&&Y.documentElement&&Y.removeChild(Y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(de){gt(u,u.return,de)}if(a=u.sibling,a!==null){a.return=u.return,ve=a;break}ve=u.return}return Se=cy,cy=!1,Se}function Ko(a,u,m){var y=u.updateQueue;if(y=y!==null?y.lastEffect:null,y!==null){var T=y=y.next;do{if((T.tag&a)===a){var w=T.destroy;T.destroy=void 0,w!==void 0&&mf(u,m,w)}T=T.next}while(T!==y)}}function Hl(a,u){if(u=u.updateQueue,u=u!==null?u.lastEffect:null,u!==null){var m=u=u.next;do{if((m.tag&a)===a){var y=m.create;m.destroy=y()}m=m.next}while(m!==u)}}function pf(a){var u=a.ref;if(u!==null){var m=a.stateNode;switch(a.tag){case 5:a=m;break;default:a=m}typeof u=="function"?u(a):u.current=a}}function dy(a){var u=a.alternate;u!==null&&(a.alternate=null,dy(u)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(u=a.stateNode,u!==null&&(delete u[rr],delete u[No],delete u[Cd],delete u[KA],delete u[zA])),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}function fy(a){return a.tag===5||a.tag===3||a.tag===4}function hy(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||fy(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function gf(a,u,m){var y=a.tag;if(y===5||y===6)a=a.stateNode,u?m.nodeType===8?m.parentNode.insertBefore(a,u):m.insertBefore(a,u):(m.nodeType===8?(u=m.parentNode,u.insertBefore(a,m)):(u=m,u.appendChild(a)),m=m._reactRootContainer,m!=null||u.onclick!==null||(u.onclick=El));else if(y!==4&&(a=a.child,a!==null))for(gf(a,u,m),a=a.sibling;a!==null;)gf(a,u,m),a=a.sibling}function yf(a,u,m){var y=a.tag;if(y===5||y===6)a=a.stateNode,u?m.insertBefore(a,u):m.appendChild(a);else if(y!==4&&(a=a.child,a!==null))for(yf(a,u,m),a=a.sibling;a!==null;)yf(a,u,m),a=a.sibling}var Ot=null,Kn=!1;function os(a,u,m){for(m=m.child;m!==null;)my(a,u,m),m=m.sibling}function my(a,u,m){if(nr&&typeof nr.onCommitFiberUnmount=="function")try{nr.onCommitFiberUnmount(rl,m)}catch{}switch(m.tag){case 5:Ht||_i(m,u);case 6:var y=Ot,T=Kn;Ot=null,os(a,u,m),Ot=y,Kn=T,Ot!==null&&(Kn?(a=Ot,m=m.stateNode,a.nodeType===8?a.parentNode.removeChild(m):a.removeChild(m)):Ot.removeChild(m.stateNode));break;case 18:Ot!==null&&(Kn?(a=Ot,m=m.stateNode,a.nodeType===8?_d(a.parentNode,m):a.nodeType===1&&_d(a,m),bo(a)):_d(Ot,m.stateNode));break;case 4:y=Ot,T=Kn,Ot=m.stateNode.containerInfo,Kn=!0,os(a,u,m),Ot=y,Kn=T;break;case 0:case 11:case 14:case 15:if(!Ht&&(y=m.updateQueue,y!==null&&(y=y.lastEffect,y!==null))){T=y=y.next;do{var w=T,_=w.destroy;w=w.tag,_!==void 0&&((w&2)!==0||(w&4)!==0)&&mf(m,u,_),T=T.next}while(T!==y)}os(a,u,m);break;case 1:if(!Ht&&(_i(m,u),y=m.stateNode,typeof y.componentWillUnmount=="function"))try{y.props=m.memoizedProps,y.state=m.memoizedState,y.componentWillUnmount()}catch(B){gt(m,u,B)}os(a,u,m);break;case 21:os(a,u,m);break;case 22:m.mode&1?(Ht=(y=Ht)||m.memoizedState!==null,os(a,u,m),Ht=y):os(a,u,m);break;default:os(a,u,m)}}function py(a){var u=a.updateQueue;if(u!==null){a.updateQueue=null;var m=a.stateNode;m===null&&(m=a.stateNode=new lL),u.forEach(function(y){var T=vL.bind(null,a,y);m.has(y)||(m.add(y),y.then(T,T))})}}function zn(a,u){var m=u.deletions;if(m!==null)for(var y=0;y<m.length;y++){var T=m[y];try{var w=a,_=u,B=_;e:for(;B!==null;){switch(B.tag){case 5:Ot=B.stateNode,Kn=!1;break e;case 3:Ot=B.stateNode.containerInfo,Kn=!0;break e;case 4:Ot=B.stateNode.containerInfo,Kn=!0;break e}B=B.return}if(Ot===null)throw Error(t(160));my(w,_,T),Ot=null,Kn=!1;var j=T.alternate;j!==null&&(j.return=null),T.return=null}catch(X){gt(T,u,X)}}if(u.subtreeFlags&12854)for(u=u.child;u!==null;)gy(u,a),u=u.sibling}function gy(a,u){var m=a.alternate,y=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:if(zn(u,a),or(a),y&4){try{Ko(3,a,a.return),Hl(3,a)}catch(be){gt(a,a.return,be)}try{Ko(5,a,a.return)}catch(be){gt(a,a.return,be)}}break;case 1:zn(u,a),or(a),y&512&&m!==null&&_i(m,m.return);break;case 5:if(zn(u,a),or(a),y&512&&m!==null&&_i(m,m.return),a.flags&32){var T=a.stateNode;try{Yt(T,"")}catch(be){gt(a,a.return,be)}}if(y&4&&(T=a.stateNode,T!=null)){var w=a.memoizedProps,_=m!==null?m.memoizedProps:w,B=a.type,j=a.updateQueue;if(a.updateQueue=null,j!==null)try{B==="input"&&w.type==="radio"&&w.name!=null&&me(T,w),ao(B,_);var X=ao(B,w);for(_=0;_<j.length;_+=2){var ae=j[_],le=j[_+1];ae==="style"?Qa(T,le):ae==="dangerouslySetInnerHTML"?gn(T,le):ae==="children"?Yt(T,le):L(T,ae,le,X)}switch(B){case"input":Me(T,w);break;case"textarea":mn(T,w);break;case"select":var oe=T._wrapperState.wasMultiple;T._wrapperState.wasMultiple=!!w.multiple;var pe=w.value;pe!=null?Xe(T,!!w.multiple,pe,!1):oe!==!!w.multiple&&(w.defaultValue!=null?Xe(T,!!w.multiple,w.defaultValue,!0):Xe(T,!!w.multiple,w.multiple?[]:"",!1))}T[No]=w}catch(be){gt(a,a.return,be)}}break;case 6:if(zn(u,a),or(a),y&4){if(a.stateNode===null)throw Error(t(162));T=a.stateNode,w=a.memoizedProps;try{T.nodeValue=w}catch(be){gt(a,a.return,be)}}break;case 3:if(zn(u,a),or(a),y&4&&m!==null&&m.memoizedState.isDehydrated)try{bo(u.containerInfo)}catch(be){gt(a,a.return,be)}break;case 4:zn(u,a),or(a);break;case 13:zn(u,a),or(a),T=a.child,T.flags&8192&&(w=T.memoizedState!==null,T.stateNode.isHidden=w,!w||T.alternate!==null&&T.alternate.memoizedState!==null||(Sf=xt())),y&4&&py(a);break;case 22:if(ae=m!==null&&m.memoizedState!==null,a.mode&1?(Ht=(X=Ht)||ae,zn(u,a),Ht=X):zn(u,a),or(a),y&8192){if(X=a.memoizedState!==null,(a.stateNode.isHidden=X)&&!ae&&(a.mode&1)!==0)for(ve=a,ae=a.child;ae!==null;){for(le=ve=ae;ve!==null;){switch(oe=ve,pe=oe.child,oe.tag){case 0:case 11:case 14:case 15:Ko(4,oe,oe.return);break;case 1:_i(oe,oe.return);var Se=oe.stateNode;if(typeof Se.componentWillUnmount=="function"){y=oe,m=oe.return;try{u=y,Se.props=u.memoizedProps,Se.state=u.memoizedState,Se.componentWillUnmount()}catch(be){gt(y,m,be)}}break;case 5:_i(oe,oe.return);break;case 22:if(oe.memoizedState!==null){xy(le);continue}}pe!==null?(pe.return=oe,ve=pe):xy(le)}ae=ae.sibling}e:for(ae=null,le=a;;){if(le.tag===5){if(ae===null){ae=le;try{T=le.stateNode,X?(w=T.style,typeof w.setProperty=="function"?w.setProperty("display","none","important"):w.display="none"):(B=le.stateNode,j=le.memoizedProps.style,_=j!=null&&j.hasOwnProperty("display")?j.display:null,B.style.display=_s("display",_))}catch(be){gt(a,a.return,be)}}}else if(le.tag===6){if(ae===null)try{le.stateNode.nodeValue=X?"":le.memoizedProps}catch(be){gt(a,a.return,be)}}else if((le.tag!==22&&le.tag!==23||le.memoizedState===null||le===a)&&le.child!==null){le.child.return=le,le=le.child;continue}if(le===a)break e;for(;le.sibling===null;){if(le.return===null||le.return===a)break e;ae===le&&(ae=null),le=le.return}ae===le&&(ae=null),le.sibling.return=le.return,le=le.sibling}}break;case 19:zn(u,a),or(a),y&4&&py(a);break;case 21:break;default:zn(u,a),or(a)}}function or(a){var u=a.flags;if(u&2){try{e:{for(var m=a.return;m!==null;){if(fy(m)){var y=m;break e}m=m.return}throw Error(t(160))}switch(y.tag){case 5:var T=y.stateNode;y.flags&32&&(Yt(T,""),y.flags&=-33);var w=hy(a);yf(a,w,T);break;case 3:case 4:var _=y.stateNode.containerInfo,B=hy(a);gf(a,B,_);break;default:throw Error(t(161))}}catch(j){gt(a,a.return,j)}a.flags&=-3}u&4096&&(a.flags&=-4097)}function cL(a,u,m){ve=a,yy(a)}function yy(a,u,m){for(var y=(a.mode&1)!==0;ve!==null;){var T=ve,w=T.child;if(T.tag===22&&y){var _=T.memoizedState!==null||Gl;if(!_){var B=T.alternate,j=B!==null&&B.memoizedState!==null||Ht;B=Gl;var X=Ht;if(Gl=_,(Ht=j)&&!X)for(ve=T;ve!==null;)_=ve,j=_.child,_.tag===22&&_.memoizedState!==null?Sy(T):j!==null?(j.return=_,ve=j):Sy(T);for(;w!==null;)ve=w,yy(w),w=w.sibling;ve=T,Gl=B,Ht=X}vy(a)}else(T.subtreeFlags&8772)!==0&&w!==null?(w.return=T,ve=w):vy(a)}}function vy(a){for(;ve!==null;){var u=ve;if((u.flags&8772)!==0){var m=u.alternate;try{if((u.flags&8772)!==0)switch(u.tag){case 0:case 11:case 15:Ht||Hl(5,u);break;case 1:var y=u.stateNode;if(u.flags&4&&!Ht)if(m===null)y.componentDidMount();else{var T=u.elementType===u.type?m.memoizedProps:Hn(u.type,m.memoizedProps);y.componentDidUpdate(T,m.memoizedState,y.__reactInternalSnapshotBeforeUpdate)}var w=u.updateQueue;w!==null&&x0(u,w,y);break;case 3:var _=u.updateQueue;if(_!==null){if(m=null,u.child!==null)switch(u.child.tag){case 5:m=u.child.stateNode;break;case 1:m=u.child.stateNode}x0(u,_,m)}break;case 5:var B=u.stateNode;if(m===null&&u.flags&4){m=B;var j=u.memoizedProps;switch(u.type){case"button":case"input":case"select":case"textarea":j.autoFocus&&m.focus();break;case"img":j.src&&(m.src=j.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(u.memoizedState===null){var X=u.alternate;if(X!==null){var ae=X.memoizedState;if(ae!==null){var le=ae.dehydrated;le!==null&&bo(le)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}Ht||u.flags&512&&pf(u)}catch(oe){gt(u,u.return,oe)}}if(u===a){ve=null;break}if(m=u.sibling,m!==null){m.return=u.return,ve=m;break}ve=u.return}}function xy(a){for(;ve!==null;){var u=ve;if(u===a){ve=null;break}var m=u.sibling;if(m!==null){m.return=u.return,ve=m;break}ve=u.return}}function Sy(a){for(;ve!==null;){var u=ve;try{switch(u.tag){case 0:case 11:case 15:var m=u.return;try{Hl(4,u)}catch(j){gt(u,m,j)}break;case 1:var y=u.stateNode;if(typeof y.componentDidMount=="function"){var T=u.return;try{y.componentDidMount()}catch(j){gt(u,T,j)}}var w=u.return;try{pf(u)}catch(j){gt(u,w,j)}break;case 5:var _=u.return;try{pf(u)}catch(j){gt(u,_,j)}}}catch(j){gt(u,u.return,j)}if(u===a){ve=null;break}var B=u.sibling;if(B!==null){B.return=u.return,ve=B;break}ve=u.return}}var dL=Math.ceil,Kl=I.ReactCurrentDispatcher,vf=I.ReactCurrentOwner,On=I.ReactCurrentBatchConfig,Ke=0,Pt=null,wt=null,Mt=0,Sn=0,Ci=ts(0),Rt=0,zo=null,Bs=0,zl=0,xf=0,Wo=null,rn=null,Sf=0,ki=1/0,Pr=null,Wl=!1,Ef=null,as=null,Yl=!1,ls=null,ql=0,Yo=0,Tf=null,Xl=-1,Ql=0;function Qt(){return(Ke&6)!==0?xt():Xl!==-1?Xl:Xl=xt()}function us(a){return(a.mode&1)===0?1:(Ke&2)!==0&&Mt!==0?Mt&-Mt:YA.transition!==null?(Ql===0&&(Ql=hg()),Ql):(a=Qe,a!==0||(a=window.event,a=a===void 0?16:Tg(a.type)),a)}function Wn(a,u,m,y){if(50<Yo)throw Yo=0,Tf=null,Error(t(185));vo(a,m,y),((Ke&2)===0||a!==Pt)&&(a===Pt&&((Ke&2)===0&&(zl|=m),Rt===4&&cs(a,Mt)),sn(a,y),m===1&&Ke===0&&(u.mode&1)===0&&(ki=xt()+500,Al&&rs()))}function sn(a,u){var m=a.callbackNode;Y1(a,u);var y=ol(a,a===Pt?Mt:0);if(y===0)m!==null&&cg(m),a.callbackNode=null,a.callbackPriority=0;else if(u=y&-y,a.callbackPriority!==u){if(m!=null&&cg(m),u===1)a.tag===0?WA(Ty.bind(null,a)):a0(Ty.bind(null,a)),GA(function(){(Ke&6)===0&&rs()}),m=null;else{switch(mg(y)){case 1:m=ed;break;case 4:m=dg;break;case 16:m=nl;break;case 536870912:m=fg;break;default:m=nl}m=Cy(m,Ey.bind(null,a))}a.callbackPriority=u,a.callbackNode=m}}function Ey(a,u){if(Xl=-1,Ql=0,(Ke&6)!==0)throw Error(t(327));var m=a.callbackNode;if(Pi()&&a.callbackNode!==m)return null;var y=ol(a,a===Pt?Mt:0);if(y===0)return null;if((y&30)!==0||(y&a.expiredLanes)!==0||u)u=Jl(a,y);else{u=y;var T=Ke;Ke|=2;var w=wy();(Pt!==a||Mt!==u)&&(Pr=null,ki=xt()+500,$s(a,u));do try{mL();break}catch(B){by(a,B)}while(!0);Ud(),Kl.current=w,Ke=T,wt!==null?u=0:(Pt=null,Mt=0,u=Rt)}if(u!==0){if(u===2&&(T=td(a),T!==0&&(y=T,u=bf(a,T))),u===1)throw m=zo,$s(a,0),cs(a,y),sn(a,xt()),m;if(u===6)cs(a,y);else{if(T=a.current.alternate,(y&30)===0&&!fL(T)&&(u=Jl(a,y),u===2&&(w=td(a),w!==0&&(y=w,u=bf(a,w))),u===1))throw m=zo,$s(a,0),cs(a,y),sn(a,xt()),m;switch(a.finishedWork=T,a.finishedLanes=y,u){case 0:case 1:throw Error(t(345));case 2:js(a,rn,Pr);break;case 3:if(cs(a,y),(y&130023424)===y&&(u=Sf+500-xt(),10<u)){if(ol(a,0)!==0)break;if(T=a.suspendedLanes,(T&y)!==y){Qt(),a.pingedLanes|=a.suspendedLanes&T;break}a.timeoutHandle=Id(js.bind(null,a,rn,Pr),u);break}js(a,rn,Pr);break;case 4:if(cs(a,y),(y&4194240)===y)break;for(u=a.eventTimes,T=-1;0<y;){var _=31-jn(y);w=1<<_,_=u[_],_>T&&(T=_),y&=~w}if(y=T,y=xt()-y,y=(120>y?120:480>y?480:1080>y?1080:1920>y?1920:3e3>y?3e3:4320>y?4320:1960*dL(y/1960))-y,10<y){a.timeoutHandle=Id(js.bind(null,a,rn,Pr),y);break}js(a,rn,Pr);break;case 5:js(a,rn,Pr);break;default:throw Error(t(329))}}}return sn(a,xt()),a.callbackNode===m?Ey.bind(null,a):null}function bf(a,u){var m=Wo;return a.current.memoizedState.isDehydrated&&($s(a,u).flags|=256),a=Jl(a,u),a!==2&&(u=rn,rn=m,u!==null&&wf(u)),a}function wf(a){rn===null?rn=a:rn.push.apply(rn,a)}function fL(a){for(var u=a;;){if(u.flags&16384){var m=u.updateQueue;if(m!==null&&(m=m.stores,m!==null))for(var y=0;y<m.length;y++){var T=m[y],w=T.getSnapshot;T=T.value;try{if(!Vn(w(),T))return!1}catch{return!1}}}if(m=u.child,u.subtreeFlags&16384&&m!==null)m.return=u,u=m;else{if(u===a)break;for(;u.sibling===null;){if(u.return===null||u.return===a)return!0;u=u.return}u.sibling.return=u.return,u=u.sibling}}return!0}function cs(a,u){for(u&=~xf,u&=~zl,a.suspendedLanes|=u,a.pingedLanes&=~u,a=a.expirationTimes;0<u;){var m=31-jn(u),y=1<<m;a[m]=-1,u&=~y}}function Ty(a){if((Ke&6)!==0)throw Error(t(327));Pi();var u=ol(a,0);if((u&1)===0)return sn(a,xt()),null;var m=Jl(a,u);if(a.tag!==0&&m===2){var y=td(a);y!==0&&(u=y,m=bf(a,y))}if(m===1)throw m=zo,$s(a,0),cs(a,u),sn(a,xt()),m;if(m===6)throw Error(t(345));return a.finishedWork=a.current.alternate,a.finishedLanes=u,js(a,rn,Pr),sn(a,xt()),null}function Af(a,u){var m=Ke;Ke|=1;try{return a(u)}finally{Ke=m,Ke===0&&(ki=xt()+500,Al&&rs())}}function Us(a){ls!==null&&ls.tag===0&&(Ke&6)===0&&Pi();var u=Ke;Ke|=1;var m=On.transition,y=Qe;try{if(On.transition=null,Qe=1,a)return a()}finally{Qe=y,On.transition=m,Ke=u,(Ke&6)===0&&rs()}}function Lf(){Sn=Ci.current,at(Ci)}function $s(a,u){a.finishedWork=null,a.finishedLanes=0;var m=a.timeoutHandle;if(m!==-1&&(a.timeoutHandle=-1,VA(m)),wt!==null)for(m=wt.return;m!==null;){var y=m;switch(Nd(y),y.tag){case 1:y=y.type.childContextTypes,y!=null&&bl();break;case 3:Ri(),at(en),at(jt),Wd();break;case 5:Kd(y);break;case 4:Ri();break;case 13:at(ut);break;case 19:at(ut);break;case 10:$d(y.type._context);break;case 22:case 23:Lf()}m=m.return}if(Pt=a,wt=a=ds(a.current,null),Mt=Sn=u,Rt=0,zo=null,xf=zl=Bs=0,rn=Wo=null,Os!==null){for(u=0;u<Os.length;u++)if(m=Os[u],y=m.interleaved,y!==null){m.interleaved=null;var T=y.next,w=m.pending;if(w!==null){var _=w.next;w.next=T,y.next=_}m.pending=y}Os=null}return a}function by(a,u){do{var m=wt;try{if(Ud(),Ol.current=Ul,Ml){for(var y=ct.memoizedState;y!==null;){var T=y.queue;T!==null&&(T.pending=null),y=y.next}Ml=!1}if(Fs=0,kt=Lt=ct=null,$o=!1,jo=0,vf.current=null,m===null||m.return===null){Rt=1,zo=u,wt=null;break}e:{var w=a,_=m.return,B=m,j=u;if(u=Mt,B.flags|=32768,j!==null&&typeof j=="object"&&typeof j.then=="function"){var X=j,ae=B,le=ae.tag;if((ae.mode&1)===0&&(le===0||le===11||le===15)){var oe=ae.alternate;oe?(ae.updateQueue=oe.updateQueue,ae.memoizedState=oe.memoizedState,ae.lanes=oe.lanes):(ae.updateQueue=null,ae.memoizedState=null)}var pe=Y0(_);if(pe!==null){pe.flags&=-257,q0(pe,_,B,w,u),pe.mode&1&&W0(w,X,u),u=pe,j=X;var Se=u.updateQueue;if(Se===null){var be=new Set;be.add(j),u.updateQueue=be}else Se.add(j);break e}else{if((u&1)===0){W0(w,X,u),Rf();break e}j=Error(t(426))}}else if(lt&&B.mode&1){var St=Y0(_);if(St!==null){(St.flags&65536)===0&&(St.flags|=256),q0(St,_,B,w,u),Fd(Ii(j,B));break e}}w=j=Ii(j,B),Rt!==4&&(Rt=2),Wo===null?Wo=[w]:Wo.push(w),w=_;do{switch(w.tag){case 3:w.flags|=65536,u&=-u,w.lanes|=u;var W=K0(w,j,u);v0(w,W);break e;case 1:B=j;var V=w.type,Y=w.stateNode;if((w.flags&128)===0&&(typeof V.getDerivedStateFromError=="function"||Y!==null&&typeof Y.componentDidCatch=="function"&&(as===null||!as.has(Y)))){w.flags|=65536,u&=-u,w.lanes|=u;var de=z0(w,B,u);v0(w,de);break e}}w=w.return}while(w!==null)}Ly(m)}catch(Ae){u=Ae,wt===m&&m!==null&&(wt=m=m.return);continue}break}while(!0)}function wy(){var a=Kl.current;return Kl.current=Ul,a===null?Ul:a}function Rf(){(Rt===0||Rt===3||Rt===2)&&(Rt=4),Pt===null||(Bs&268435455)===0&&(zl&268435455)===0||cs(Pt,Mt)}function Jl(a,u){var m=Ke;Ke|=2;var y=wy();(Pt!==a||Mt!==u)&&(Pr=null,$s(a,u));do try{hL();break}catch(T){by(a,T)}while(!0);if(Ud(),Ke=m,Kl.current=y,wt!==null)throw Error(t(261));return Pt=null,Mt=0,Rt}function hL(){for(;wt!==null;)Ay(wt)}function mL(){for(;wt!==null&&!U1();)Ay(wt)}function Ay(a){var u=_y(a.alternate,a,Sn);a.memoizedProps=a.pendingProps,u===null?Ly(a):wt=u,vf.current=null}function Ly(a){var u=a;do{var m=u.alternate;if(a=u.return,(u.flags&32768)===0){if(m=oL(m,u,Sn),m!==null){wt=m;return}}else{if(m=aL(m,u),m!==null){m.flags&=32767,wt=m;return}if(a!==null)a.flags|=32768,a.subtreeFlags=0,a.deletions=null;else{Rt=6,wt=null;return}}if(u=u.sibling,u!==null){wt=u;return}wt=u=a}while(u!==null);Rt===0&&(Rt=5)}function js(a,u,m){var y=Qe,T=On.transition;try{On.transition=null,Qe=1,pL(a,u,m,y)}finally{On.transition=T,Qe=y}return null}function pL(a,u,m,y){do Pi();while(ls!==null);if((Ke&6)!==0)throw Error(t(327));m=a.finishedWork;var T=a.finishedLanes;if(m===null)return null;if(a.finishedWork=null,a.finishedLanes=0,m===a.current)throw Error(t(177));a.callbackNode=null,a.callbackPriority=0;var w=m.lanes|m.childLanes;if(q1(a,w),a===Pt&&(wt=Pt=null,Mt=0),(m.subtreeFlags&2064)===0&&(m.flags&2064)===0||Yl||(Yl=!0,Cy(nl,function(){return Pi(),null})),w=(m.flags&15990)!==0,(m.subtreeFlags&15990)!==0||w){w=On.transition,On.transition=null;var _=Qe;Qe=1;var B=Ke;Ke|=4,vf.current=null,uL(a,m),gy(m,a),OA(Ld),ul=!!Ad,Ld=Ad=null,a.current=m,cL(m),$1(),Ke=B,Qe=_,On.transition=w}else a.current=m;if(Yl&&(Yl=!1,ls=a,ql=T),w=a.pendingLanes,w===0&&(as=null),G1(m.stateNode),sn(a,xt()),u!==null)for(y=a.onRecoverableError,m=0;m<u.length;m++)T=u[m],y(T.value,{componentStack:T.stack,digest:T.digest});if(Wl)throw Wl=!1,a=Ef,Ef=null,a;return(ql&1)!==0&&a.tag!==0&&Pi(),w=a.pendingLanes,(w&1)!==0?a===Tf?Yo++:(Yo=0,Tf=a):Yo=0,rs(),null}function Pi(){if(ls!==null){var a=mg(ql),u=On.transition,m=Qe;try{if(On.transition=null,Qe=16>a?16:a,ls===null)var y=!1;else{if(a=ls,ls=null,ql=0,(Ke&6)!==0)throw Error(t(331));var T=Ke;for(Ke|=4,ve=a.current;ve!==null;){var w=ve,_=w.child;if((ve.flags&16)!==0){var B=w.deletions;if(B!==null){for(var j=0;j<B.length;j++){var X=B[j];for(ve=X;ve!==null;){var ae=ve;switch(ae.tag){case 0:case 11:case 15:Ko(8,ae,w)}var le=ae.child;if(le!==null)le.return=ae,ve=le;else for(;ve!==null;){ae=ve;var oe=ae.sibling,pe=ae.return;if(dy(ae),ae===X){ve=null;break}if(oe!==null){oe.return=pe,ve=oe;break}ve=pe}}}var Se=w.alternate;if(Se!==null){var be=Se.child;if(be!==null){Se.child=null;do{var St=be.sibling;be.sibling=null,be=St}while(be!==null)}}ve=w}}if((w.subtreeFlags&2064)!==0&&_!==null)_.return=w,ve=_;else e:for(;ve!==null;){if(w=ve,(w.flags&2048)!==0)switch(w.tag){case 0:case 11:case 15:Ko(9,w,w.return)}var W=w.sibling;if(W!==null){W.return=w.return,ve=W;break e}ve=w.return}}var V=a.current;for(ve=V;ve!==null;){_=ve;var Y=_.child;if((_.subtreeFlags&2064)!==0&&Y!==null)Y.return=_,ve=Y;else e:for(_=V;ve!==null;){if(B=ve,(B.flags&2048)!==0)try{switch(B.tag){case 0:case 11:case 15:Hl(9,B)}}catch(Ae){gt(B,B.return,Ae)}if(B===_){ve=null;break e}var de=B.sibling;if(de!==null){de.return=B.return,ve=de;break e}ve=B.return}}if(Ke=T,rs(),nr&&typeof nr.onPostCommitFiberRoot=="function")try{nr.onPostCommitFiberRoot(rl,a)}catch{}y=!0}return y}finally{Qe=m,On.transition=u}}return!1}function Ry(a,u,m){u=Ii(m,u),u=K0(a,u,1),a=is(a,u,1),u=Qt(),a!==null&&(vo(a,1,u),sn(a,u))}function gt(a,u,m){if(a.tag===3)Ry(a,a,m);else for(;u!==null;){if(u.tag===3){Ry(u,a,m);break}else if(u.tag===1){var y=u.stateNode;if(typeof u.type.getDerivedStateFromError=="function"||typeof y.componentDidCatch=="function"&&(as===null||!as.has(y))){a=Ii(m,a),a=z0(u,a,1),u=is(u,a,1),a=Qt(),u!==null&&(vo(u,1,a),sn(u,a));break}}u=u.return}}function gL(a,u,m){var y=a.pingCache;y!==null&&y.delete(u),u=Qt(),a.pingedLanes|=a.suspendedLanes&m,Pt===a&&(Mt&m)===m&&(Rt===4||Rt===3&&(Mt&130023424)===Mt&&500>xt()-Sf?$s(a,0):xf|=m),sn(a,u)}function Iy(a,u){u===0&&((a.mode&1)===0?u=1:(u=il,il<<=1,(il&130023424)===0&&(il=4194304)));var m=Qt();a=_r(a,u),a!==null&&(vo(a,u,m),sn(a,m))}function yL(a){var u=a.memoizedState,m=0;u!==null&&(m=u.retryLane),Iy(a,m)}function vL(a,u){var m=0;switch(a.tag){case 13:var y=a.stateNode,T=a.memoizedState;T!==null&&(m=T.retryLane);break;case 19:y=a.stateNode;break;default:throw Error(t(314))}y!==null&&y.delete(u),Iy(a,m)}var _y;_y=function(a,u,m){if(a!==null)if(a.memoizedProps!==u.pendingProps||en.current)nn=!0;else{if((a.lanes&m)===0&&(u.flags&128)===0)return nn=!1,iL(a,u,m);nn=(a.flags&131072)!==0}else nn=!1,lt&&(u.flags&1048576)!==0&&l0(u,Rl,u.index);switch(u.lanes=0,u.tag){case 2:var y=u.type;Vl(a,u),a=u.pendingProps;var T=Si(u,jt.current);Li(u,m),T=Xd(null,u,y,a,T,m);var w=Qd();return u.flags|=1,typeof T=="object"&&T!==null&&typeof T.render=="function"&&T.$$typeof===void 0?(u.tag=1,u.memoizedState=null,u.updateQueue=null,tn(y)?(w=!0,wl(u)):w=!1,u.memoizedState=T.state!==null&&T.state!==void 0?T.state:null,Gd(u),T.updater=$l,u.stateNode=T,T._reactInternals=u,rf(u,y,a,m),u=lf(null,u,y,!0,w,m)):(u.tag=0,lt&&w&&Dd(u),Xt(null,u,T,m),u=u.child),u;case 16:y=u.elementType;e:{switch(Vl(a,u),a=u.pendingProps,T=y._init,y=T(y._payload),u.type=y,T=u.tag=SL(y),a=Hn(y,a),T){case 0:u=af(null,u,y,a,m);break e;case 1:u=ty(null,u,y,a,m);break e;case 11:u=X0(null,u,y,a,m);break e;case 14:u=Q0(null,u,y,Hn(y.type,a),m);break e}throw Error(t(306,y,""))}return u;case 0:return y=u.type,T=u.pendingProps,T=u.elementType===y?T:Hn(y,T),af(a,u,y,T,m);case 1:return y=u.type,T=u.pendingProps,T=u.elementType===y?T:Hn(y,T),ty(a,u,y,T,m);case 3:e:{if(ny(u),a===null)throw Error(t(387));y=u.pendingProps,w=u.memoizedState,T=w.element,y0(a,u),Dl(u,y,null,m);var _=u.memoizedState;if(y=_.element,w.isDehydrated)if(w={element:y,isDehydrated:!1,cache:_.cache,pendingSuspenseBoundaries:_.pendingSuspenseBoundaries,transitions:_.transitions},u.updateQueue.baseState=w,u.memoizedState=w,u.flags&256){T=Ii(Error(t(423)),u),u=ry(a,u,y,m,T);break e}else if(y!==T){T=Ii(Error(t(424)),u),u=ry(a,u,y,m,T);break e}else for(xn=es(u.stateNode.containerInfo.firstChild),vn=u,lt=!0,Gn=null,m=p0(u,null,y,m),u.child=m;m;)m.flags=m.flags&-3|4096,m=m.sibling;else{if(bi(),y===T){u=kr(a,u,m);break e}Xt(a,u,y,m)}u=u.child}return u;case 5:return S0(u),a===null&&Md(u),y=u.type,T=u.pendingProps,w=a!==null?a.memoizedProps:null,_=T.children,Rd(y,T)?_=null:w!==null&&Rd(y,w)&&(u.flags|=32),ey(a,u),Xt(a,u,_,m),u.child;case 6:return a===null&&Md(u),null;case 13:return sy(a,u,m);case 4:return Hd(u,u.stateNode.containerInfo),y=u.pendingProps,a===null?u.child=wi(u,null,y,m):Xt(a,u,y,m),u.child;case 11:return y=u.type,T=u.pendingProps,T=u.elementType===y?T:Hn(y,T),X0(a,u,y,T,m);case 7:return Xt(a,u,u.pendingProps,m),u.child;case 8:return Xt(a,u,u.pendingProps.children,m),u.child;case 12:return Xt(a,u,u.pendingProps.children,m),u.child;case 10:e:{if(y=u.type._context,T=u.pendingProps,w=u.memoizedProps,_=T.value,rt(Cl,y._currentValue),y._currentValue=_,w!==null)if(Vn(w.value,_)){if(w.children===T.children&&!en.current){u=kr(a,u,m);break e}}else for(w=u.child,w!==null&&(w.return=u);w!==null;){var B=w.dependencies;if(B!==null){_=w.child;for(var j=B.firstContext;j!==null;){if(j.context===y){if(w.tag===1){j=Cr(-1,m&-m),j.tag=2;var X=w.updateQueue;if(X!==null){X=X.shared;var ae=X.pending;ae===null?j.next=j:(j.next=ae.next,ae.next=j),X.pending=j}}w.lanes|=m,j=w.alternate,j!==null&&(j.lanes|=m),jd(w.return,m,u),B.lanes|=m;break}j=j.next}}else if(w.tag===10)_=w.type===u.type?null:w.child;else if(w.tag===18){if(_=w.return,_===null)throw Error(t(341));_.lanes|=m,B=_.alternate,B!==null&&(B.lanes|=m),jd(_,m,u),_=w.sibling}else _=w.child;if(_!==null)_.return=w;else for(_=w;_!==null;){if(_===u){_=null;break}if(w=_.sibling,w!==null){w.return=_.return,_=w;break}_=_.return}w=_}Xt(a,u,T.children,m),u=u.child}return u;case 9:return T=u.type,y=u.pendingProps.children,Li(u,m),T=Dn(T),y=y(T),u.flags|=1,Xt(a,u,y,m),u.child;case 14:return y=u.type,T=Hn(y,u.pendingProps),T=Hn(y.type,T),Q0(a,u,y,T,m);case 15:return J0(a,u,u.type,u.pendingProps,m);case 17:return y=u.type,T=u.pendingProps,T=u.elementType===y?T:Hn(y,T),Vl(a,u),u.tag=1,tn(y)?(a=!0,wl(u)):a=!1,Li(u,m),G0(u,y,T),rf(u,y,T,m),lf(null,u,y,!0,a,m);case 19:return oy(a,u,m);case 22:return Z0(a,u,m)}throw Error(t(156,u.tag))};function Cy(a,u){return ug(a,u)}function xL(a,u,m,y){this.tag=a,this.key=m,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=u,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=y,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Mn(a,u,m,y){return new xL(a,u,m,y)}function If(a){return a=a.prototype,!(!a||!a.isReactComponent)}function SL(a){if(typeof a=="function")return If(a)?1:0;if(a!=null){if(a=a.$$typeof,a===Z)return 11;if(a===ne)return 14}return 2}function ds(a,u){var m=a.alternate;return m===null?(m=Mn(a.tag,u,a.key,a.mode),m.elementType=a.elementType,m.type=a.type,m.stateNode=a.stateNode,m.alternate=a,a.alternate=m):(m.pendingProps=u,m.type=a.type,m.flags=0,m.subtreeFlags=0,m.deletions=null),m.flags=a.flags&14680064,m.childLanes=a.childLanes,m.lanes=a.lanes,m.child=a.child,m.memoizedProps=a.memoizedProps,m.memoizedState=a.memoizedState,m.updateQueue=a.updateQueue,u=a.dependencies,m.dependencies=u===null?null:{lanes:u.lanes,firstContext:u.firstContext},m.sibling=a.sibling,m.index=a.index,m.ref=a.ref,m}function Zl(a,u,m,y,T,w){var _=2;if(y=a,typeof a=="function")If(a)&&(_=1);else if(typeof a=="string")_=5;else e:switch(a){case C:return Vs(m.children,T,w,u);case P:_=8,T|=8;break;case O:return a=Mn(12,m,u,T|2),a.elementType=O,a.lanes=w,a;case se:return a=Mn(13,m,u,T),a.elementType=se,a.lanes=w,a;case U:return a=Mn(19,m,u,T),a.elementType=U,a.lanes=w,a;case te:return eu(m,T,w,u);default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case M:_=10;break e;case H:_=9;break e;case Z:_=11;break e;case ne:_=14;break e;case q:_=16,y=null;break e}throw Error(t(130,a==null?a:typeof a,""))}return u=Mn(_,m,u,T),u.elementType=a,u.type=y,u.lanes=w,u}function Vs(a,u,m,y){return a=Mn(7,a,y,u),a.lanes=m,a}function eu(a,u,m,y){return a=Mn(22,a,y,u),a.elementType=te,a.lanes=m,a.stateNode={isHidden:!1},a}function _f(a,u,m){return a=Mn(6,a,null,u),a.lanes=m,a}function Cf(a,u,m){return u=Mn(4,a.children!==null?a.children:[],a.key,u),u.lanes=m,u.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},u}function EL(a,u,m,y,T){this.tag=u,this.containerInfo=a,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=nd(0),this.expirationTimes=nd(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=nd(0),this.identifierPrefix=y,this.onRecoverableError=T,this.mutableSourceEagerHydrationData=null}function kf(a,u,m,y,T,w,_,B,j){return a=new EL(a,u,m,B,j),u===1?(u=1,w===!0&&(u|=8)):u=0,w=Mn(3,null,null,u),a.current=w,w.stateNode=a,w.memoizedState={element:y,isDehydrated:m,cache:null,transitions:null,pendingSuspenseBoundaries:null},Gd(w),a}function TL(a,u,m){var y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:F,key:y==null?null:""+y,children:a,containerInfo:u,implementation:m}}function ky(a){if(!a)return ns;a=a._reactInternals;e:{if(Cs(a)!==a||a.tag!==1)throw Error(t(170));var u=a;do{switch(u.tag){case 3:u=u.stateNode.context;break e;case 1:if(tn(u.type)){u=u.stateNode.__reactInternalMemoizedMergedChildContext;break e}}u=u.return}while(u!==null);throw Error(t(171))}if(a.tag===1){var m=a.type;if(tn(m))return i0(a,m,u)}return u}function Py(a,u,m,y,T,w,_,B,j){return a=kf(m,y,!0,a,T,w,_,B,j),a.context=ky(null),m=a.current,y=Qt(),T=us(m),w=Cr(y,T),w.callback=u??null,is(m,w,T),a.current.lanes=T,vo(a,T,y),sn(a,y),a}function tu(a,u,m,y){var T=u.current,w=Qt(),_=us(T);return m=ky(m),u.context===null?u.context=m:u.pendingContext=m,u=Cr(w,_),u.payload={element:a},y=y===void 0?null:y,y!==null&&(u.callback=y),a=is(T,u,_),a!==null&&(Wn(a,T,_,w),Pl(a,T,_)),_}function nu(a){if(a=a.current,!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function Dy(a,u){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var m=a.retryLane;a.retryLane=m!==0&&m<u?m:u}}function Pf(a,u){Dy(a,u),(a=a.alternate)&&Dy(a,u)}function bL(){return null}var Ny=typeof reportError=="function"?reportError:function(a){console.error(a)};function Df(a){this._internalRoot=a}ru.prototype.render=Df.prototype.render=function(a){var u=this._internalRoot;if(u===null)throw Error(t(409));tu(a,u,null,null)},ru.prototype.unmount=Df.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var u=a.containerInfo;Us(function(){tu(null,a,null,null)}),u[Ar]=null}};function ru(a){this._internalRoot=a}ru.prototype.unstable_scheduleHydration=function(a){if(a){var u=yg();a={blockedOn:null,target:a,priority:u};for(var m=0;m<Qr.length&&u!==0&&u<Qr[m].priority;m++);Qr.splice(m,0,a),m===0&&Sg(a)}};function Nf(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function su(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11&&(a.nodeType!==8||a.nodeValue!==" react-mount-point-unstable "))}function Oy(){}function wL(a,u,m,y,T){if(T){if(typeof y=="function"){var w=y;y=function(){var X=nu(_);w.call(X)}}var _=Py(u,y,a,0,null,!1,!1,"",Oy);return a._reactRootContainer=_,a[Ar]=_.current,Po(a.nodeType===8?a.parentNode:a),Us(),_}for(;T=a.lastChild;)a.removeChild(T);if(typeof y=="function"){var B=y;y=function(){var X=nu(j);B.call(X)}}var j=kf(a,0,!1,null,null,!1,!1,"",Oy);return a._reactRootContainer=j,a[Ar]=j.current,Po(a.nodeType===8?a.parentNode:a),Us(function(){tu(u,j,m,y)}),j}function iu(a,u,m,y,T){var w=m._reactRootContainer;if(w){var _=w;if(typeof T=="function"){var B=T;T=function(){var j=nu(_);B.call(j)}}tu(u,_,a,T)}else _=wL(m,u,a,T,y);return nu(_)}pg=function(a){switch(a.tag){case 3:var u=a.stateNode;if(u.current.memoizedState.isDehydrated){var m=yo(u.pendingLanes);m!==0&&(rd(u,m|1),sn(u,xt()),(Ke&6)===0&&(ki=xt()+500,rs()))}break;case 13:Us(function(){var y=_r(a,1);if(y!==null){var T=Qt();Wn(y,a,1,T)}}),Pf(a,1)}},sd=function(a){if(a.tag===13){var u=_r(a,134217728);if(u!==null){var m=Qt();Wn(u,a,134217728,m)}Pf(a,134217728)}},gg=function(a){if(a.tag===13){var u=us(a),m=_r(a,u);if(m!==null){var y=Qt();Wn(m,a,u,y)}Pf(a,u)}},yg=function(){return Qe},vg=function(a,u){var m=Qe;try{return Qe=a,u()}finally{Qe=m}},uo=function(a,u,m){switch(u){case"input":if(Me(a,m),u=m.name,m.type==="radio"&&u!=null){for(m=a;m.parentNode;)m=m.parentNode;for(m=m.querySelectorAll("input[name="+JSON.stringify(""+u)+'][type="radio"]'),u=0;u<m.length;u++){var y=m[u];if(y!==a&&y.form===a.form){var T=Tl(y);if(!T)throw Error(t(90));Te(y),Me(y,T)}}}break;case"textarea":mn(a,m);break;case"select":u=m.value,u!=null&&Xe(a,!!m.multiple,u,!1)}},ho=Af,Za=Us;var AL={usingClientEntryPoint:!1,Events:[Oo,vi,Tl,Ja,fo,Af]},qo={findFiberByHostInstance:ks,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},LL={bundleType:qo.bundleType,version:qo.version,rendererPackageName:qo.rendererPackageName,rendererConfig:qo.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:I.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){return a=ag(a),a===null?null:a.stateNode},findFiberByHostInstance:qo.findFiberByHostInstance||bL,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ou=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ou.isDisabled&&ou.supportsFiber)try{rl=ou.inject(LL),nr=ou}catch{}}return on.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=AL,on.createPortal=function(a,u){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Nf(u))throw Error(t(200));return TL(a,u,null,m)},on.createRoot=function(a,u){if(!Nf(a))throw Error(t(299));var m=!1,y="",T=Ny;return u!=null&&(u.unstable_strictMode===!0&&(m=!0),u.identifierPrefix!==void 0&&(y=u.identifierPrefix),u.onRecoverableError!==void 0&&(T=u.onRecoverableError)),u=kf(a,1,!1,null,null,m,!1,y,T),a[Ar]=u.current,Po(a.nodeType===8?a.parentNode:a),new Df(u)},on.findDOMNode=function(a){if(a==null)return null;if(a.nodeType===1)return a;var u=a._reactInternals;if(u===void 0)throw typeof a.render=="function"?Error(t(188)):(a=Object.keys(a).join(","),Error(t(268,a)));return a=ag(u),a=a===null?null:a.stateNode,a},on.flushSync=function(a){return Us(a)},on.hydrate=function(a,u,m){if(!su(u))throw Error(t(200));return iu(null,a,u,!0,m)},on.hydrateRoot=function(a,u,m){if(!Nf(a))throw Error(t(405));var y=m!=null&&m.hydratedSources||null,T=!1,w="",_=Ny;if(m!=null&&(m.unstable_strictMode===!0&&(T=!0),m.identifierPrefix!==void 0&&(w=m.identifierPrefix),m.onRecoverableError!==void 0&&(_=m.onRecoverableError)),u=Py(u,null,a,1,m??null,T,!1,w,_),a[Ar]=u.current,Po(a),y)for(a=0;a<y.length;a++)m=y[a],T=m._getVersion,T=T(m._source),u.mutableSourceEagerHydrationData==null?u.mutableSourceEagerHydrationData=[m,T]:u.mutableSourceEagerHydrationData.push(m,T);return new ru(u)},on.render=function(a,u,m){if(!su(u))throw Error(t(200));return iu(null,a,u,!1,m)},on.unmountComponentAtNode=function(a){if(!su(a))throw Error(t(40));return a._reactRootContainer?(Us(function(){iu(null,null,a,!1,function(){a._reactRootContainer=null,a[Ar]=null})}),!0):!1},on.unstable_batchedUpdates=Af,on.unstable_renderSubtreeIntoContainer=function(a,u,m,y){if(!su(m))throw Error(t(200));if(a==null||a._reactInternals===void 0)throw Error(t(38));return iu(a,u,m,!1,y)},on.version="18.3.1-next-f1338f8080-20240426",on}var Gy;function lE(){if(Gy)return Ff.exports;Gy=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Ff.exports=DL(),Ff.exports}var Hy;function NL(){if(Hy)return au;Hy=1;var n=lE();return au.createRoot=n.createRoot,au.hydrateRoot=n.hydrateRoot,au}var OL=NL(),$f={exports:{}},jf={};var Ky;function ML(){if(Ky)return jf;Ky=1;var n=Ma();function e(c,d){return c===d&&(c!==0||1/c===1/d)||c!==c&&d!==d}var t=typeof Object.is=="function"?Object.is:e,r=n.useSyncExternalStore,s=n.useRef,i=n.useEffect,o=n.useMemo,l=n.useDebugValue;return jf.useSyncExternalStoreWithSelector=function(c,d,f,h,p){var v=s(null);if(v.current===null){var g={hasValue:!1,value:null};v.current=g}else g=v.current;v=o(function(){function x(k){if(!b){if(b=!0,A=k,k=h(k),p!==void 0&&g.hasValue){var F=g.value;if(p(F,k))return L=F}return L=k}if(F=L,t(A,k))return F;var C=h(k);return p!==void 0&&p(F,C)?(A=k,F):(A=k,L=C)}var b=!1,A,L,I=f===void 0?null:f;return[function(){return x(d())},I===null?void 0:function(){return x(I())}]},[d,f,h,p]);var S=r(c,v[0],v[1]);return i(function(){g.hasValue=!0,g.value=S},[S]),l(S),S},jf}var zy;function FL(){return zy||(zy=1,$f.exports=ML()),$f.exports}FL();function BL(n){n()}function UL(){let n=null,e=null;return{clear(){n=null,e=null},notify(){BL(()=>{let t=n;for(;t;)t.callback(),t=t.next})},get(){const t=[];let r=n;for(;r;)t.push(r),r=r.next;return t},subscribe(t){let r=!0;const s=e={callback:t,next:null,prev:e};return s.prev?s.prev.next=s:n=s,function(){!r||n===null||(r=!1,s.next?s.next.prev=s.prev:e=s.prev,s.prev?s.prev.next=s.next:n=s.next)}}}}var Wy={notify(){},get:()=>[]};function $L(n,e){let t,r=Wy,s=0,i=!1;function o(S){f();const x=r.subscribe(S);let b=!1;return()=>{b||(b=!0,x(),h())}}function l(){r.notify()}function c(){g.onStateChange&&g.onStateChange()}function d(){return i}function f(){s++,t||(t=n.subscribe(c),r=UL())}function h(){s--,t&&s===0&&(t(),t=void 0,r.clear(),r=Wy)}function p(){i||(i=!0,f())}function v(){i&&(i=!1,h())}const g={addNestedSub:o,notifyNestedSubs:l,handleChangeWrapper:c,isSubscribed:d,trySubscribe:p,tryUnsubscribe:v,getListeners:()=>r};return g}var jL=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",VL=jL(),GL=()=>typeof navigator<"u"&&navigator.product==="ReactNative",HL=GL(),KL=()=>VL||HL?N.useLayoutEffect:N.useEffect,zL=KL(),WL=Symbol.for("react-redux-context"),YL=typeof globalThis<"u"?globalThis:{};function qL(){if(!N.createContext)return{};const n=YL[WL]??=new Map;let e=n.get(N.createContext);return e||(e=N.createContext(null),n.set(N.createContext,e)),e}var XL=qL();function QL(n){const{children:e,context:t,serverState:r,store:s}=n,i=N.useMemo(()=>{const c=$L(s);return{store:s,subscription:c,getServerState:r?()=>r:void 0}},[s,r]),o=N.useMemo(()=>s.getState(),[s]);zL(()=>{const{subscription:c}=i;return c.onStateChange=c.notifyNestedSubs,c.trySubscribe(),o!==s.getState()&&c.notifyNestedSubs(),()=>{c.tryUnsubscribe(),c.onStateChange=void 0}},[i,o]);const l=t||XL;return N.createElement(l.Provider,{value:i},e)}var JL=QL;var Yy="popstate";function ZL(n={}){function e(r,s){let{pathname:i,search:o,hash:l}=r.location;return jh("",{pathname:i,search:o,hash:l},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function t(r,s){return typeof s=="string"?s:ya(s)}return tR(e,t,null,n)}function pt(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function yr(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function eR(){return Math.random().toString(36).substring(2,10)}function qy(n,e){return{usr:n.state,key:n.key,idx:e}}function jh(n,e,t=null,r){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?to(e):e,state:t,key:e&&e.key||r||eR()}}function ya({pathname:n="/",search:e="",hash:t=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(n+=t.charAt(0)==="#"?t:"#"+t),n}function to(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substring(t),n=n.substring(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substring(r),n=n.substring(0,r)),n&&(e.pathname=n)}return e}function tR(n,e,t,r={}){let{window:s=document.defaultView,v5Compat:i=!1}=r,o=s.history,l="POP",c=null,d=f();d==null&&(d=0,o.replaceState({...o.state,idx:d},""));function f(){return(o.state||{idx:null}).idx}function h(){l="POP";let x=f(),b=x==null?null:x-d;d=x,c&&c({action:l,location:S.location,delta:b})}function p(x,b){l="PUSH";let A=jh(S.location,x,b);d=f()+1;let L=qy(A,d),I=S.createHref(A);try{o.pushState(L,"",I)}catch(k){if(k instanceof DOMException&&k.name==="DataCloneError")throw k;s.location.assign(I)}i&&c&&c({action:l,location:S.location,delta:1})}function v(x,b){l="REPLACE";let A=jh(S.location,x,b);d=f();let L=qy(A,d),I=S.createHref(A);o.replaceState(L,"",I),i&&c&&c({action:l,location:S.location,delta:0})}function g(x){return nR(x)}let S={get action(){return l},get location(){return n(s,o)},listen(x){if(c)throw new Error("A history only accepts one active listener");return s.addEventListener(Yy,h),c=x,()=>{s.removeEventListener(Yy,h),c=null}},createHref(x){return e(s,x)},createURL:g,encodeLocation(x){let b=g(x);return{pathname:b.pathname,search:b.search,hash:b.hash}},push:p,replace:v,go(x){return o.go(x)}};return S}function nR(n,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),pt(t,"No window.location.(origin|href) available to create URL");let r=typeof n=="string"?n:ya(n);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=t+r),new URL(r,t)}function uE(n,e,t="/"){return rR(n,e,t,!1)}function rR(n,e,t,r){let s=typeof e=="string"?to(e):e,i=Hr(s.pathname||"/",t);if(i==null)return null;let o=cE(n);sR(o);let l=null;for(let c=0;l==null&&c<o.length;++c){let d=pR(i);l=hR(o[c],d,r)}return l}function cE(n,e=[],t=[],r="",s=!1){let i=(o,l,c=s,d)=>{let f={relativePath:d===void 0?o.path||"":d,caseSensitive:o.caseSensitive===!0,childrenIndex:l,route:o};if(f.relativePath.startsWith("/")){if(!f.relativePath.startsWith(r)&&c)return;pt(f.relativePath.startsWith(r),`Absolute route path "${f.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),f.relativePath=f.relativePath.slice(r.length)}let h=$r([r,f.relativePath]),p=t.concat(f);o.children&&o.children.length>0&&(pt(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${h}".`),cE(o.children,e,p,h,c)),!(o.path==null&&!o.index)&&e.push({path:h,score:dR(h,o.index),routesMeta:p})};return n.forEach((o,l)=>{if(o.path===""||!o.path?.includes("?"))i(o,l);else for(let c of dE(o.path))i(o,l,!0,c)}),e}function dE(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,s=t.endsWith("?"),i=t.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let o=dE(r.join("/")),l=[];return l.push(...o.map(c=>c===""?i:[i,c].join("/"))),s&&l.push(...o),l.map(c=>n.startsWith("/")&&c===""?"/":c)}function sR(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:fR(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}var iR=/^:[\w-]+$/,oR=3,aR=2,lR=1,uR=10,cR=-2,Xy=n=>n==="*";function dR(n,e){let t=n.split("/"),r=t.length;return t.some(Xy)&&(r+=cR),e&&(r+=aR),t.filter(s=>!Xy(s)).reduce((s,i)=>s+(iR.test(i)?oR:i===""?lR:uR),r)}function fR(n,e){return n.length===e.length&&n.slice(0,-1).every((r,s)=>r===e[s])?n[n.length-1]-e[e.length-1]:0}function hR(n,e,t=!1){let{routesMeta:r}=n,s={},i="/",o=[];for(let l=0;l<r.length;++l){let c=r[l],d=l===r.length-1,f=i==="/"?e:e.slice(i.length)||"/",h=qu({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},f),p=c.route;if(!h&&d&&t&&!r[r.length-1].route.index&&(h=qu({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},f)),!h)return null;Object.assign(s,h.params),o.push({params:s,pathname:$r([i,h.pathname]),pathnameBase:xR($r([i,h.pathnameBase])),route:p}),h.pathnameBase!=="/"&&(i=$r([i,h.pathnameBase]))}return o}function qu(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=mR(n.path,n.caseSensitive,n.end),s=e.match(t);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),l=s.slice(1);return{params:r.reduce((d,{paramName:f,isOptional:h},p)=>{if(f==="*"){let g=l[p]||"";o=i.slice(0,i.length-g.length).replace(/(.)\/+$/,"$1")}const v=l[p];return h&&!v?d[f]=void 0:d[f]=(v||"").replace(/%2F/g,"/"),d},{}),pathname:i,pathnameBase:o,pattern:n}}function mR(n,e=!1,t=!0){yr(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let r=[],s="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,c)=>(r.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(r.push({paramName:"*"}),s+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?s+="\\/*$":n!==""&&n!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function pR(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return yr(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function Hr(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}function gR(n,e="/"){let{pathname:t,search:r="",hash:s=""}=typeof n=="string"?to(n):n;return{pathname:t?t.startsWith("/")?t:yR(t,e):e,search:SR(r),hash:ER(s)}}function yR(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(s=>{s===".."?t.length>1&&t.pop():s!=="."&&t.push(s)}),t.length>1?t.join("/"):"/"}function Vf(n,e,t,r){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function vR(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function fE(n){let e=vR(n);return e.map((t,r)=>r===e.length-1?t.pathname:t.pathnameBase)}function hE(n,e,t,r=!1){let s;typeof n=="string"?s=to(n):(s={...n},pt(!s.pathname||!s.pathname.includes("?"),Vf("?","pathname","search",s)),pt(!s.pathname||!s.pathname.includes("#"),Vf("#","pathname","hash",s)),pt(!s.search||!s.search.includes("#"),Vf("#","search","hash",s)));let i=n===""||s.pathname==="",o=i?"/":s.pathname,l;if(o==null)l=t;else{let h=e.length-1;if(!r&&o.startsWith("..")){let p=o.split("/");for(;p[0]==="..";)p.shift(),h-=1;s.pathname=p.join("/")}l=h>=0?e[h]:"/"}let c=gR(s,l),d=o&&o!=="/"&&o.endsWith("/"),f=(i||o===".")&&t.endsWith("/");return!c.pathname.endsWith("/")&&(d||f)&&(c.pathname+="/"),c}var $r=n=>n.join("/").replace(/\/\/+/g,"/"),xR=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),SR=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,ER=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function TR(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}var mE=["POST","PUT","PATCH","DELETE"];new Set(mE);var bR=["GET",...mE];new Set(bR);var no=N.createContext(null);no.displayName="DataRouter";var Ac=N.createContext(null);Ac.displayName="DataRouterState";N.createContext(!1);var pE=N.createContext({isTransitioning:!1});pE.displayName="ViewTransition";var wR=N.createContext(new Map);wR.displayName="Fetchers";var AR=N.createContext(null);AR.displayName="Await";var Sr=N.createContext(null);Sr.displayName="Navigation";var Fa=N.createContext(null);Fa.displayName="Location";var Er=N.createContext({outlet:null,matches:[],isDataRoute:!1});Er.displayName="Route";var Wm=N.createContext(null);Wm.displayName="RouteError";function LR(n,{relative:e}={}){pt(Ba(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:r}=N.useContext(Sr),{hash:s,pathname:i,search:o}=Ua(n,{relative:e}),l=i;return t!=="/"&&(l=i==="/"?t:$r([t,i])),r.createHref({pathname:l,search:o,hash:s})}function Ba(){return N.useContext(Fa)!=null}function Tr(){return pt(Ba(),"useLocation() may be used only in the context of a <Router> component."),N.useContext(Fa).location}var gE="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function yE(n){N.useContext(Sr).static||N.useLayoutEffect(n)}function hn(){let{isDataRoute:n}=N.useContext(Er);return n?$R():RR()}function RR(){pt(Ba(),"useNavigate() may be used only in the context of a <Router> component.");let n=N.useContext(no),{basename:e,navigator:t}=N.useContext(Sr),{matches:r}=N.useContext(Er),{pathname:s}=Tr(),i=JSON.stringify(fE(r)),o=N.useRef(!1);return yE(()=>{o.current=!0}),N.useCallback((c,d={})=>{if(yr(o.current,gE),!o.current)return;if(typeof c=="number"){t.go(c);return}let f=hE(c,JSON.parse(i),s,d.relative==="path");n==null&&e!=="/"&&(f.pathname=f.pathname==="/"?e:$r([e,f.pathname])),(d.replace?t.replace:t.push)(f,d.state,d)},[e,t,i,s,n])}N.createContext(null);function IR(){let{matches:n}=N.useContext(Er),e=n[n.length-1];return e?e.params:{}}function Ua(n,{relative:e}={}){let{matches:t}=N.useContext(Er),{pathname:r}=Tr(),s=JSON.stringify(fE(t));return N.useMemo(()=>hE(n,JSON.parse(s),r,e==="path"),[n,s,r,e])}function _R(n,e){return vE(n,e)}function vE(n,e,t,r,s){pt(Ba(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i}=N.useContext(Sr),{matches:o}=N.useContext(Er),l=o[o.length-1],c=l?l.params:{},d=l?l.pathname:"/",f=l?l.pathnameBase:"/",h=l&&l.route;{let A=h&&h.path||"";xE(d,!h||A.endsWith("*")||A.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${d}" (under <Route path="${A}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${A}"> to <Route path="${A==="/"?"*":`${A}/*`}">.`)}let p=Tr(),v;if(e){let A=typeof e=="string"?to(e):e;pt(f==="/"||A.pathname?.startsWith(f),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${f}" but pathname "${A.pathname}" was given in the \`location\` prop.`),v=A}else v=p;let g=v.pathname||"/",S=g;if(f!=="/"){let A=f.replace(/^\//,"").split("/");S="/"+g.replace(/^\//,"").split("/").slice(A.length).join("/")}let x=uE(n,{pathname:S});yr(h||x!=null,`No routes matched location "${v.pathname}${v.search}${v.hash}" `),yr(x==null||x[x.length-1].route.element!==void 0||x[x.length-1].route.Component!==void 0||x[x.length-1].route.lazy!==void 0,`Matched leaf route at location "${v.pathname}${v.search}${v.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let b=NR(x&&x.map(A=>Object.assign({},A,{params:Object.assign({},c,A.params),pathname:$r([f,i.encodeLocation?i.encodeLocation(A.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:A.pathname]),pathnameBase:A.pathnameBase==="/"?f:$r([f,i.encodeLocation?i.encodeLocation(A.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:A.pathnameBase])})),o,t,r,s);return e&&b?N.createElement(Fa.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...v},navigationType:"POP"}},b):b}function CR(){let n=UR(),e=TR(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,r="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:r},i={padding:"2px 4px",backgroundColor:r},o=null;return console.error("Error handled by React Router default ErrorBoundary:",n),o=N.createElement(N.Fragment,null,N.createElement("p",null," Hey developer "),N.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",N.createElement("code",{style:i},"ErrorBoundary")," or"," ",N.createElement("code",{style:i},"errorElement")," prop on your route.")),N.createElement(N.Fragment,null,N.createElement("h2",null,"Unexpected Application Error!"),N.createElement("h3",{style:{fontStyle:"italic"}},e),t?N.createElement("pre",{style:s},t):null,o)}var kR=N.createElement(CR,null),PR=class extends N.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){this.props.unstable_onError?this.props.unstable_onError(n,e):console.error("React Router caught the following error during render",n)}render(){return this.state.error!==void 0?N.createElement(Er.Provider,{value:this.props.routeContext},N.createElement(Wm.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function DR({routeContext:n,match:e,children:t}){let r=N.useContext(no);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),N.createElement(Er.Provider,{value:n},t)}function NR(n,e=[],t=null,r=null,s=null){if(n==null){if(!t)return null;if(t.errors)n=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let i=n,o=t?.errors;if(o!=null){let d=i.findIndex(f=>f.route.id&&o?.[f.route.id]!==void 0);pt(d>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),i=i.slice(0,Math.min(i.length,d+1))}let l=!1,c=-1;if(t)for(let d=0;d<i.length;d++){let f=i[d];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(c=d),f.route.id){let{loaderData:h,errors:p}=t,v=f.route.loader&&!h.hasOwnProperty(f.route.id)&&(!p||p[f.route.id]===void 0);if(f.route.lazy||v){l=!0,c>=0?i=i.slice(0,c+1):i=[i[0]];break}}}return i.reduceRight((d,f,h)=>{let p,v=!1,g=null,S=null;t&&(p=o&&f.route.id?o[f.route.id]:void 0,g=f.route.errorElement||kR,l&&(c<0&&h===0?(xE("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),v=!0,S=null):c===h&&(v=!0,S=f.route.hydrateFallbackElement||null)));let x=e.concat(i.slice(0,h+1)),b=()=>{let A;return p?A=g:v?A=S:f.route.Component?A=N.createElement(f.route.Component,null):f.route.element?A=f.route.element:A=d,N.createElement(DR,{match:f,routeContext:{outlet:d,matches:x,isDataRoute:t!=null},children:A})};return t&&(f.route.ErrorBoundary||f.route.errorElement||h===0)?N.createElement(PR,{location:t.location,revalidation:t.revalidation,component:g,error:p,children:b(),routeContext:{outlet:null,matches:x,isDataRoute:!0},unstable_onError:r}):b()},null)}function Ym(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function OR(n){let e=N.useContext(no);return pt(e,Ym(n)),e}function MR(n){let e=N.useContext(Ac);return pt(e,Ym(n)),e}function FR(n){let e=N.useContext(Er);return pt(e,Ym(n)),e}function qm(n){let e=FR(n),t=e.matches[e.matches.length-1];return pt(t.route.id,`${n} can only be used on routes that contain a unique "id"`),t.route.id}function BR(){return qm("useRouteId")}function UR(){let n=N.useContext(Wm),e=MR("useRouteError"),t=qm("useRouteError");return n!==void 0?n:e.errors?.[t]}function $R(){let{router:n}=OR("useNavigate"),e=qm("useNavigate"),t=N.useRef(!1);return yE(()=>{t.current=!0}),N.useCallback(async(s,i={})=>{yr(t.current,gE),t.current&&(typeof s=="number"?n.navigate(s):await n.navigate(s,{fromRouteId:e,...i}))},[n,e])}var Qy={};function xE(n,e,t){!e&&!Qy[n]&&(Qy[n]=!0,yr(!1,t))}N.memo(jR);function jR({routes:n,future:e,state:t,unstable_onError:r}){return vE(n,void 0,t,r,e)}function qn(n){pt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function VR({basename:n="/",children:e=null,location:t,navigationType:r="POP",navigator:s,static:i=!1}){pt(!Ba(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=n.replace(/^\/*/,"/"),l=N.useMemo(()=>({basename:o,navigator:s,static:i,future:{}}),[o,s,i]);typeof t=="string"&&(t=to(t));let{pathname:c="/",search:d="",hash:f="",state:h=null,key:p="default"}=t,v=N.useMemo(()=>{let g=Hr(c,o);return g==null?null:{location:{pathname:g,search:d,hash:f,state:h,key:p},navigationType:r}},[o,c,d,f,h,p,r]);return yr(v!=null,`<Router basename="${o}"> is not able to match the URL "${c}${d}${f}" because it does not start with the basename, so the <Router> won't render anything.`),v==null?null:N.createElement(Sr.Provider,{value:l},N.createElement(Fa.Provider,{children:e,value:v}))}function Jy({children:n,location:e}){return _R(Vh(n),e)}function Vh(n,e=[]){let t=[];return N.Children.forEach(n,(r,s)=>{if(!N.isValidElement(r))return;let i=[...e,s];if(r.type===N.Fragment){t.push.apply(t,Vh(r.props.children,i));return}pt(r.type===qn,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),pt(!r.props.index||!r.props.children,"An index route cannot have child routes.");let o={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=Vh(r.props.children,i)),t.push(o)}),t}var Nu="get",Ou="application/x-www-form-urlencoded";function Lc(n){return n!=null&&typeof n.tagName=="string"}function GR(n){return Lc(n)&&n.tagName.toLowerCase()==="button"}function HR(n){return Lc(n)&&n.tagName.toLowerCase()==="form"}function KR(n){return Lc(n)&&n.tagName.toLowerCase()==="input"}function zR(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function WR(n,e){return n.button===0&&(!e||e==="_self")&&!zR(n)}var lu=null;function YR(){if(lu===null)try{new FormData(document.createElement("form"),0),lu=!1}catch{lu=!0}return lu}var qR=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Gf(n){return n!=null&&!qR.has(n)?(yr(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Ou}"`),null):n}function XR(n,e){let t,r,s,i,o;if(HR(n)){let l=n.getAttribute("action");r=l?Hr(l,e):null,t=n.getAttribute("method")||Nu,s=Gf(n.getAttribute("enctype"))||Ou,i=new FormData(n)}else if(GR(n)||KR(n)&&(n.type==="submit"||n.type==="image")){let l=n.form;if(l==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let c=n.getAttribute("formaction")||l.getAttribute("action");if(r=c?Hr(c,e):null,t=n.getAttribute("formmethod")||l.getAttribute("method")||Nu,s=Gf(n.getAttribute("formenctype"))||Gf(l.getAttribute("enctype"))||Ou,i=new FormData(l,n),!YR()){let{name:d,type:f,value:h}=n;if(f==="image"){let p=d?`${d}.`:"";i.append(`${p}x`,"0"),i.append(`${p}y`,"0")}else d&&i.append(d,h)}}else{if(Lc(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=Nu,r=null,s=Ou,o=n}return i&&s==="text/plain"&&(o=i,i=void 0),{action:r,method:t.toLowerCase(),encType:s,formData:i,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Xm(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function QR(n,e,t){let r=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return r.pathname==="/"?r.pathname=`_root.${t}`:e&&Hr(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${t}`,r}async function JR(n,e){if(n.id in e)return e[n.id];try{let t=await import(n.module);return e[n.id]=t,t}catch(t){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function ZR(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function eI(n,e,t){let r=await Promise.all(n.map(async s=>{let i=e.routes[s.route.id];if(i){let o=await JR(i,t);return o.links?o.links():[]}return[]}));return sI(r.flat(1).filter(ZR).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function Zy(n,e,t,r,s,i){let o=(c,d)=>t[d]?c.route.id!==t[d].route.id:!0,l=(c,d)=>t[d].pathname!==c.pathname||t[d].route.path?.endsWith("*")&&t[d].params["*"]!==c.params["*"];return i==="assets"?e.filter((c,d)=>o(c,d)||l(c,d)):i==="data"?e.filter((c,d)=>{let f=r.routes[c.route.id];if(!f||!f.hasLoader)return!1;if(o(c,d)||l(c,d))return!0;if(c.route.shouldRevalidate){let h=c.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:c.params,defaultShouldRevalidate:!0});if(typeof h=="boolean")return h}return!0}):[]}function tI(n,e,{includeHydrateFallback:t}={}){return nI(n.map(r=>{let s=e.routes[r.route.id];if(!s)return[];let i=[s.module];return s.clientActionModule&&(i=i.concat(s.clientActionModule)),s.clientLoaderModule&&(i=i.concat(s.clientLoaderModule)),t&&s.hydrateFallbackModule&&(i=i.concat(s.hydrateFallbackModule)),s.imports&&(i=i.concat(s.imports)),i}).flat(1))}function nI(n){return[...new Set(n)]}function rI(n){let e={},t=Object.keys(n).sort();for(let r of t)e[r]=n[r];return e}function sI(n,e){let t=new Set;return new Set(e),n.reduce((r,s)=>{let i=JSON.stringify(rI(s));return t.has(i)||(t.add(i),r.push({key:i,link:s})),r},[])}function SE(){let n=N.useContext(no);return Xm(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function iI(){let n=N.useContext(Ac);return Xm(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var Qm=N.createContext(void 0);Qm.displayName="FrameworkContext";function EE(){let n=N.useContext(Qm);return Xm(n,"You must render this element inside a <HydratedRouter> element"),n}function oI(n,e){let t=N.useContext(Qm),[r,s]=N.useState(!1),[i,o]=N.useState(!1),{onFocus:l,onBlur:c,onMouseEnter:d,onMouseLeave:f,onTouchStart:h}=e,p=N.useRef(null);N.useEffect(()=>{if(n==="render"&&o(!0),n==="viewport"){let S=b=>{b.forEach(A=>{o(A.isIntersecting)})},x=new IntersectionObserver(S,{threshold:.5});return p.current&&x.observe(p.current),()=>{x.disconnect()}}},[n]),N.useEffect(()=>{if(r){let S=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(S)}}},[r]);let v=()=>{s(!0)},g=()=>{s(!1),o(!1)};return t?n!=="intent"?[i,p,{}]:[i,p,{onFocus:Qo(l,v),onBlur:Qo(c,g),onMouseEnter:Qo(d,v),onMouseLeave:Qo(f,g),onTouchStart:Qo(h,v)}]:[!1,p,{}]}function Qo(n,e){return t=>{n&&n(t),t.defaultPrevented||e(t)}}function aI({page:n,...e}){let{router:t}=SE(),r=N.useMemo(()=>uE(t.routes,n,t.basename),[t.routes,n,t.basename]);return r?N.createElement(uI,{page:n,matches:r,...e}):null}function lI(n){let{manifest:e,routeModules:t}=EE(),[r,s]=N.useState([]);return N.useEffect(()=>{let i=!1;return eI(n,e,t).then(o=>{i||s(o)}),()=>{i=!0}},[n,e,t]),r}function uI({page:n,matches:e,...t}){let r=Tr(),{manifest:s,routeModules:i}=EE(),{basename:o}=SE(),{loaderData:l,matches:c}=iI(),d=N.useMemo(()=>Zy(n,e,c,s,r,"data"),[n,e,c,s,r]),f=N.useMemo(()=>Zy(n,e,c,s,r,"assets"),[n,e,c,s,r]),h=N.useMemo(()=>{if(n===r.pathname+r.search+r.hash)return[];let g=new Set,S=!1;if(e.forEach(b=>{let A=s.routes[b.route.id];!A||!A.hasLoader||(!d.some(L=>L.route.id===b.route.id)&&b.route.id in l&&i[b.route.id]?.shouldRevalidate||A.hasClientLoader?S=!0:g.add(b.route.id))}),g.size===0)return[];let x=QR(n,o,"data");return S&&g.size>0&&x.searchParams.set("_routes",e.filter(b=>g.has(b.route.id)).map(b=>b.route.id).join(",")),[x.pathname+x.search]},[o,l,r,s,d,e,n,i]),p=N.useMemo(()=>tI(f,s),[f,s]),v=lI(f);return N.createElement(N.Fragment,null,h.map(g=>N.createElement("link",{key:g,rel:"prefetch",as:"fetch",href:g,...t})),p.map(g=>N.createElement("link",{key:g,rel:"modulepreload",href:g,...t})),v.map(({key:g,link:S})=>N.createElement("link",{key:g,nonce:t.nonce,...S})))}function cI(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var TE=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{TE&&(window.__reactRouterVersion="7.9.4")}catch{}function dI({basename:n,children:e,window:t}){let r=N.useRef();r.current==null&&(r.current=ZL({window:t,v5Compat:!0}));let s=r.current,[i,o]=N.useState({action:s.action,location:s.location}),l=N.useCallback(c=>{N.startTransition(()=>o(c))},[o]);return N.useLayoutEffect(()=>s.listen(l),[s,l]),N.createElement(VR,{basename:n,children:e,location:i.location,navigationType:i.action,navigator:s})}var bE=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Zs=N.forwardRef(function({onClick:e,discover:t="render",prefetch:r="none",relative:s,reloadDocument:i,replace:o,state:l,target:c,to:d,preventScrollReset:f,viewTransition:h,...p},v){let{basename:g}=N.useContext(Sr),S=typeof d=="string"&&bE.test(d),x,b=!1;if(typeof d=="string"&&S&&(x=d,TE))try{let O=new URL(window.location.href),M=d.startsWith("//")?new URL(O.protocol+d):new URL(d),H=Hr(M.pathname,g);M.origin===O.origin&&H!=null?d=H+M.search+M.hash:b=!0}catch{yr(!1,`<Link to="${d}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let A=LR(d,{relative:s}),[L,I,k]=oI(r,p),F=pI(d,{replace:o,state:l,target:c,preventScrollReset:f,relative:s,viewTransition:h});function C(O){e&&e(O),O.defaultPrevented||F(O)}let P=N.createElement("a",{...p,...k,href:x||A,onClick:b||i?e:C,ref:cI(v,I),target:c,"data-discover":!S&&t==="render"?"true":void 0});return L&&!S?N.createElement(N.Fragment,null,P,N.createElement(aI,{page:A})):P});Zs.displayName="Link";var fI=N.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:r="",end:s=!1,style:i,to:o,viewTransition:l,children:c,...d},f){let h=Ua(o,{relative:d.relative}),p=Tr(),v=N.useContext(Ac),{navigator:g,basename:S}=N.useContext(Sr),x=v!=null&&SI(h)&&l===!0,b=g.encodeLocation?g.encodeLocation(h).pathname:h.pathname,A=p.pathname,L=v&&v.navigation&&v.navigation.location?v.navigation.location.pathname:null;t||(A=A.toLowerCase(),L=L?L.toLowerCase():null,b=b.toLowerCase()),L&&S&&(L=Hr(L,S)||L);const I=b!=="/"&&b.endsWith("/")?b.length-1:b.length;let k=A===b||!s&&A.startsWith(b)&&A.charAt(I)==="/",F=L!=null&&(L===b||!s&&L.startsWith(b)&&L.charAt(b.length)==="/"),C={isActive:k,isPending:F,isTransitioning:x},P=k?e:void 0,O;typeof r=="function"?O=r(C):O=[r,k?"active":null,F?"pending":null,x?"transitioning":null].filter(Boolean).join(" ");let M=typeof i=="function"?i(C):i;return N.createElement(Zs,{...d,"aria-current":P,className:O,ref:f,style:M,to:o,viewTransition:l},typeof c=="function"?c(C):c)});fI.displayName="NavLink";var hI=N.forwardRef(({discover:n="render",fetcherKey:e,navigate:t,reloadDocument:r,replace:s,state:i,method:o=Nu,action:l,onSubmit:c,relative:d,preventScrollReset:f,viewTransition:h,...p},v)=>{let g=vI(),S=xI(l,{relative:d}),x=o.toLowerCase()==="get"?"get":"post",b=typeof l=="string"&&bE.test(l),A=L=>{if(c&&c(L),L.defaultPrevented)return;L.preventDefault();let I=L.nativeEvent.submitter,k=I?.getAttribute("formmethod")||o;g(I||L.currentTarget,{fetcherKey:e,method:k,navigate:t,replace:s,state:i,relative:d,preventScrollReset:f,viewTransition:h})};return N.createElement("form",{ref:v,method:x,action:S,onSubmit:r?c:A,...p,"data-discover":!b&&n==="render"?"true":void 0})});hI.displayName="Form";function mI(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function wE(n){let e=N.useContext(no);return pt(e,mI(n)),e}function pI(n,{target:e,replace:t,state:r,preventScrollReset:s,relative:i,viewTransition:o}={}){let l=hn(),c=Tr(),d=Ua(n,{relative:i});return N.useCallback(f=>{if(WR(f,e)){f.preventDefault();let h=t!==void 0?t:ya(c)===ya(d);l(n,{replace:h,state:r,preventScrollReset:s,relative:i,viewTransition:o})}},[c,l,d,t,r,e,n,s,i,o])}var gI=0,yI=()=>`__${String(++gI)}__`;function vI(){let{router:n}=wE("useSubmit"),{basename:e}=N.useContext(Sr),t=BR();return N.useCallback(async(r,s={})=>{let{action:i,method:o,encType:l,formData:c,body:d}=XR(r,e);if(s.navigate===!1){let f=s.fetcherKey||yI();await n.fetch(f,t,s.action||i,{preventScrollReset:s.preventScrollReset,formData:c,body:d,formMethod:s.method||o,formEncType:s.encType||l,flushSync:s.flushSync})}else await n.navigate(s.action||i,{preventScrollReset:s.preventScrollReset,formData:c,body:d,formMethod:s.method||o,formEncType:s.encType||l,replace:s.replace,state:s.state,fromRouteId:t,flushSync:s.flushSync,viewTransition:s.viewTransition})},[n,e,t])}function xI(n,{relative:e}={}){let{basename:t}=N.useContext(Sr),r=N.useContext(Er);pt(r,"useFormAction must be used inside a RouteContext");let[s]=r.matches.slice(-1),i={...Ua(n||".",{relative:e})},o=Tr();if(n==null){i.search=o.search;let l=new URLSearchParams(i.search),c=l.getAll("index");if(c.some(f=>f==="")){l.delete("index"),c.filter(h=>h).forEach(h=>l.append("index",h));let f=l.toString();i.search=f?`?${f}`:""}}return(!n||n===".")&&s.route.index&&(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(i.pathname=i.pathname==="/"?t:$r([t,i.pathname])),ya(i)}function SI(n,{relative:e}={}){let t=N.useContext(pE);pt(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=wE("useViewTransitionState"),s=Ua(n,{relative:e});if(!t.isTransitioning)return!1;let i=Hr(t.currentLocation.pathname,r)||t.currentLocation.pathname,o=Hr(t.nextLocation.pathname,r)||t.nextLocation.pathname;return qu(s.pathname,o)!=null||qu(s.pathname,i)!=null}var EI=lE();const TI=aE(EI),AE=N.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"}),Rc=N.createContext({}),Ic=N.createContext(null),_c=typeof document<"u",Jm=_c?N.useLayoutEffect:N.useEffect,LE=N.createContext({strict:!1}),Zm=n=>n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),bI="framerAppearId",RE="data-"+Zm(bI);function wI(n,e,t,r){const{visualElement:s}=N.useContext(Rc),i=N.useContext(LE),o=N.useContext(Ic),l=N.useContext(AE).reducedMotion,c=N.useRef();r=r||i.renderer,!c.current&&r&&(c.current=r(n,{visualState:e,parent:s,props:t,presenceContext:o,blockInitialAnimation:o?o.initial===!1:!1,reducedMotionConfig:l}));const d=c.current;N.useInsertionEffect(()=>{d&&d.update(t,o)});const f=N.useRef(!!(t[RE]&&!window.HandoffComplete));return Jm(()=>{d&&(d.render(),f.current&&d.animationState&&d.animationState.animateChanges())}),N.useEffect(()=>{d&&(d.updateFeatures(),!f.current&&d.animationState&&d.animationState.animateChanges(),f.current&&(f.current=!1,window.HandoffComplete=!0))}),d}function Ui(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function AI(n,e,t){return N.useCallback(r=>{r&&n.mount&&n.mount(r),e&&(r?e.mount(r):e.unmount()),t&&(typeof t=="function"?t(r):Ui(t)&&(t.current=r))},[e])}function va(n){return typeof n=="string"||Array.isArray(n)}function Cc(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}const ep=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],tp=["initial",...ep];function kc(n){return Cc(n.animate)||tp.some(e=>va(n[e]))}function IE(n){return!!(kc(n)||n.variants)}function LI(n,e){if(kc(n)){const{initial:t,animate:r}=n;return{initial:t===!1||va(t)?t:void 0,animate:va(r)?r:void 0}}return n.inherit!==!1?e:{}}function RI(n){const{initial:e,animate:t}=LI(n,N.useContext(Rc));return N.useMemo(()=>({initial:e,animate:t}),[ev(e),ev(t)])}function ev(n){return Array.isArray(n)?n.join(" "):n}const tv={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},xa={};for(const n in tv)xa[n]={isEnabled:e=>tv[n].some(t=>!!e[t])};function II(n){for(const e in n)xa[e]={...xa[e],...n[e]}}const np=N.createContext({}),_E=N.createContext({}),_I=Symbol.for("motionComponentSymbol");function CI({preloadedFeatures:n,createVisualElement:e,useRender:t,useVisualState:r,Component:s}){n&&II(n);function i(l,c){let d;const f={...N.useContext(AE),...l,layoutId:kI(l)},{isStatic:h}=f,p=RI(l),v=r(l,h);if(!h&&_c){p.visualElement=wI(s,v,f,e);const g=N.useContext(_E),S=N.useContext(LE).strict;p.visualElement&&(d=p.visualElement.loadFeatures(f,S,n,g))}return N.createElement(Rc.Provider,{value:p},d&&p.visualElement?N.createElement(d,{visualElement:p.visualElement,...f}):null,t(s,l,AI(v,p.visualElement,c),v,h,p.visualElement))}const o=N.forwardRef(i);return o[_I]=s,o}function kI({layoutId:n}){const e=N.useContext(np).id;return e&&n!==void 0?e+"-"+n:n}function PI(n){function e(r,s={}){return CI(n(r,s))}if(typeof Proxy>"u")return e;const t=new Map;return new Proxy(e,{get:(r,s)=>(t.has(s)||t.set(s,e(s)),t.get(s))})}const DI=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function rp(n){return typeof n!="string"||n.includes("-")?!1:!!(DI.indexOf(n)>-1||/[A-Z]/.test(n))}const Xu={};function NI(n){Object.assign(Xu,n)}const $a=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],li=new Set($a);function CE(n,{layout:e,layoutId:t}){return li.has(n)||n.startsWith("origin")||(e||t!==void 0)&&(!!Xu[n]||n==="opacity")}const fn=n=>!!(n&&n.getVelocity),OI={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},MI=$a.length;function FI(n,{enableHardwareAcceleration:e=!0,allowTransformNone:t=!0},r,s){let i="";for(let o=0;o<MI;o++){const l=$a[o];if(n[l]!==void 0){const c=OI[l]||l;i+=`${c}(${n[l]}) `}}return e&&!n.z&&(i+="translateZ(0)"),i=i.trim(),s?i=s(n,r?"":i):t&&r&&(i="none"),i}const kE=n=>e=>typeof e=="string"&&e.startsWith(n),PE=kE("--"),Gh=kE("var(--"),BI=/var\s*\(\s*--[\w-]+(\s*,\s*(?:(?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)+)?\s*\)/g,UI=(n,e)=>e&&typeof n=="number"?e.transform(n):n,bs=(n,e,t)=>Math.min(Math.max(t,n),e),ui={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},aa={...ui,transform:n=>bs(0,1,n)},uu={...ui,default:1},la=n=>Math.round(n*1e5)/1e5,Pc=/(-)?([\d]*\.?[\d])+/g,DE=/(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))/gi,$I=/^(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))$/i;function ja(n){return typeof n=="string"}const Va=n=>({test:e=>ja(e)&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),ps=Va("deg"),gr=Va("%"),Ce=Va("px"),jI=Va("vh"),VI=Va("vw"),nv={...gr,parse:n=>gr.parse(n)/100,transform:n=>gr.transform(n*100)},rv={...ui,transform:Math.round},NE={borderWidth:Ce,borderTopWidth:Ce,borderRightWidth:Ce,borderBottomWidth:Ce,borderLeftWidth:Ce,borderRadius:Ce,radius:Ce,borderTopLeftRadius:Ce,borderTopRightRadius:Ce,borderBottomRightRadius:Ce,borderBottomLeftRadius:Ce,width:Ce,maxWidth:Ce,height:Ce,maxHeight:Ce,size:Ce,top:Ce,right:Ce,bottom:Ce,left:Ce,padding:Ce,paddingTop:Ce,paddingRight:Ce,paddingBottom:Ce,paddingLeft:Ce,margin:Ce,marginTop:Ce,marginRight:Ce,marginBottom:Ce,marginLeft:Ce,rotate:ps,rotateX:ps,rotateY:ps,rotateZ:ps,scale:uu,scaleX:uu,scaleY:uu,scaleZ:uu,skew:ps,skewX:ps,skewY:ps,distance:Ce,translateX:Ce,translateY:Ce,translateZ:Ce,x:Ce,y:Ce,z:Ce,perspective:Ce,transformPerspective:Ce,opacity:aa,originX:nv,originY:nv,originZ:Ce,zIndex:rv,fillOpacity:aa,strokeOpacity:aa,numOctaves:rv};function sp(n,e,t,r){const{style:s,vars:i,transform:o,transformOrigin:l}=n;let c=!1,d=!1,f=!0;for(const h in e){const p=e[h];if(PE(h)){i[h]=p;continue}const v=NE[h],g=UI(p,v);if(li.has(h)){if(c=!0,o[h]=g,!f)continue;p!==(v.default||0)&&(f=!1)}else h.startsWith("origin")?(d=!0,l[h]=g):s[h]=g}if(e.transform||(c||r?s.transform=FI(n.transform,t,f,r):s.transform&&(s.transform="none")),d){const{originX:h="50%",originY:p="50%",originZ:v=0}=l;s.transformOrigin=`${h} ${p} ${v}`}}const ip=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function OE(n,e,t){for(const r in e)!fn(e[r])&&!CE(r,t)&&(n[r]=e[r])}function GI({transformTemplate:n},e,t){return N.useMemo(()=>{const r=ip();return sp(r,e,{enableHardwareAcceleration:!t},n),Object.assign({},r.vars,r.style)},[e])}function HI(n,e,t){const r=n.style||{},s={};return OE(s,r,n),Object.assign(s,GI(n,e,t)),n.transformValues?n.transformValues(s):s}function KI(n,e,t){const r={},s=HI(n,e,t);return n.drag&&n.dragListener!==!1&&(r.draggable=!1,s.userSelect=s.WebkitUserSelect=s.WebkitTouchCallout="none",s.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(r.tabIndex=0),r.style=s,r}const zI=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","transformValues","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Qu(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||zI.has(n)}let ME=n=>!Qu(n);function WI(n){n&&(ME=e=>e.startsWith("on")?!Qu(e):n(e))}try{WI(require("@emotion/is-prop-valid").default)}catch{}function YI(n,e,t){const r={};for(const s in n)s==="values"&&typeof n.values=="object"||(ME(s)||t===!0&&Qu(s)||!e&&!Qu(s)||n.draggable&&s.startsWith("onDrag"))&&(r[s]=n[s]);return r}function sv(n,e,t){return typeof n=="string"?n:Ce.transform(e+t*n)}function qI(n,e,t){const r=sv(e,n.x,n.width),s=sv(t,n.y,n.height);return`${r} ${s}`}const XI={offset:"stroke-dashoffset",array:"stroke-dasharray"},QI={offset:"strokeDashoffset",array:"strokeDasharray"};function JI(n,e,t=1,r=0,s=!0){n.pathLength=1;const i=s?XI:QI;n[i.offset]=Ce.transform(-r);const o=Ce.transform(e),l=Ce.transform(t);n[i.array]=`${o} ${l}`}function op(n,{attrX:e,attrY:t,attrScale:r,originX:s,originY:i,pathLength:o,pathSpacing:l=1,pathOffset:c=0,...d},f,h,p){if(sp(n,d,f,p),h){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:v,style:g,dimensions:S}=n;v.transform&&(S&&(g.transform=v.transform),delete v.transform),S&&(s!==void 0||i!==void 0||g.transform)&&(g.transformOrigin=qI(S,s!==void 0?s:.5,i!==void 0?i:.5)),e!==void 0&&(v.x=e),t!==void 0&&(v.y=t),r!==void 0&&(v.scale=r),o!==void 0&&JI(v,o,l,c,!1)}const FE=()=>({...ip(),attrs:{}}),ap=n=>typeof n=="string"&&n.toLowerCase()==="svg";function ZI(n,e,t,r){const s=N.useMemo(()=>{const i=FE();return op(i,e,{enableHardwareAcceleration:!1},ap(r),n.transformTemplate),{...i.attrs,style:{...i.style}}},[e]);if(n.style){const i={};OE(i,n.style,n),s.style={...i,...s.style}}return s}function e_(n=!1){return(t,r,s,{latestValues:i},o)=>{const c=(rp(t)?ZI:KI)(r,i,o,t),f={...YI(r,typeof t=="string",n),...c,ref:s},{children:h}=r,p=N.useMemo(()=>fn(h)?h.get():h,[h]);return N.createElement(t,{...f,children:p})}}function BE(n,{style:e,vars:t},r,s){Object.assign(n.style,e,s&&s.getProjectionStyles(r));for(const i in t)n.style.setProperty(i,t[i])}const UE=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function $E(n,e,t,r){BE(n,e,void 0,r);for(const s in e.attrs)n.setAttribute(UE.has(s)?s:Zm(s),e.attrs[s])}function lp(n,e){const{style:t}=n,r={};for(const s in t)(fn(t[s])||e.style&&fn(e.style[s])||CE(s,n))&&(r[s]=t[s]);return r}function jE(n,e){const t=lp(n,e);for(const r in n)if(fn(n[r])||fn(e[r])){const s=$a.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;t[s]=n[r]}return t}function up(n,e,t,r={},s={}){return typeof e=="function"&&(e=e(t!==void 0?t:n.custom,r,s)),typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"&&(e=e(t!==void 0?t:n.custom,r,s)),e}function VE(n){const e=N.useRef(null);return e.current===null&&(e.current=n()),e.current}const Ju=n=>Array.isArray(n),t_=n=>!!(n&&typeof n=="object"&&n.mix&&n.toValue),n_=n=>Ju(n)?n[n.length-1]||0:n;function Mu(n){const e=fn(n)?n.get():n;return t_(e)?e.toValue():e}function r_({scrapeMotionValuesFromProps:n,createRenderState:e,onMount:t},r,s,i){const o={latestValues:s_(r,s,i,n),renderState:e()};return t&&(o.mount=l=>t(r,l,o)),o}const GE=n=>(e,t)=>{const r=N.useContext(Rc),s=N.useContext(Ic),i=()=>r_(n,e,r,s);return t?i():VE(i)};function s_(n,e,t,r){const s={},i=r(n,{});for(const p in i)s[p]=Mu(i[p]);let{initial:o,animate:l}=n;const c=kc(n),d=IE(n);e&&d&&!c&&n.inherit!==!1&&(o===void 0&&(o=e.initial),l===void 0&&(l=e.animate));let f=t?t.initial===!1:!1;f=f||o===!1;const h=f?l:o;return h&&typeof h!="boolean"&&!Cc(h)&&(Array.isArray(h)?h:[h]).forEach(v=>{const g=up(n,v);if(!g)return;const{transitionEnd:S,transition:x,...b}=g;for(const A in b){let L=b[A];if(Array.isArray(L)){const I=f?L.length-1:0;L=L[I]}L!==null&&(s[A]=L)}for(const A in S)s[A]=S[A]}),s}const Tt=n=>n;class iv{constructor(){this.order=[],this.scheduled=new Set}add(e){if(!this.scheduled.has(e))return this.scheduled.add(e),this.order.push(e),!0}remove(e){const t=this.order.indexOf(e);t!==-1&&(this.order.splice(t,1),this.scheduled.delete(e))}clear(){this.order.length=0,this.scheduled.clear()}}function i_(n){let e=new iv,t=new iv,r=0,s=!1,i=!1;const o=new WeakSet,l={schedule:(c,d=!1,f=!1)=>{const h=f&&s,p=h?e:t;return d&&o.add(c),p.add(c)&&h&&s&&(r=e.order.length),c},cancel:c=>{t.remove(c),o.delete(c)},process:c=>{if(s){i=!0;return}if(s=!0,[e,t]=[t,e],t.clear(),r=e.order.length,r)for(let d=0;d<r;d++){const f=e.order[d];f(c),o.has(f)&&(l.schedule(f),n())}s=!1,i&&(i=!1,l.process(c))}};return l}const cu=["prepare","read","update","preRender","render","postRender"],o_=40;function a_(n,e){let t=!1,r=!0;const s={delta:0,timestamp:0,isProcessing:!1},i=cu.reduce((h,p)=>(h[p]=i_(()=>t=!0),h),{}),o=h=>i[h].process(s),l=()=>{const h=performance.now();t=!1,s.delta=r?1e3/60:Math.max(Math.min(h-s.timestamp,o_),1),s.timestamp=h,s.isProcessing=!0,cu.forEach(o),s.isProcessing=!1,t&&e&&(r=!1,n(l))},c=()=>{t=!0,r=!0,s.isProcessing||n(l)};return{schedule:cu.reduce((h,p)=>{const v=i[p];return h[p]=(g,S=!1,x=!1)=>(t||c(),v.schedule(g,S,x)),h},{}),cancel:h=>cu.forEach(p=>i[p].cancel(h)),state:s,steps:i}}const{schedule:it,cancel:Kr,state:Kt,steps:Hf}=a_(typeof requestAnimationFrame<"u"?requestAnimationFrame:Tt,!0),l_={useVisualState:GE({scrapeMotionValuesFromProps:jE,createRenderState:FE,onMount:(n,e,{renderState:t,latestValues:r})=>{it.read(()=>{try{t.dimensions=typeof e.getBBox=="function"?e.getBBox():e.getBoundingClientRect()}catch{t.dimensions={x:0,y:0,width:0,height:0}}}),it.render(()=>{op(t,r,{enableHardwareAcceleration:!1},ap(e.tagName),n.transformTemplate),$E(e,t)})}})},u_={useVisualState:GE({scrapeMotionValuesFromProps:lp,createRenderState:ip})};function c_(n,{forwardMotionProps:e=!1},t,r){return{...rp(n)?l_:u_,preloadedFeatures:t,useRender:e_(e),createVisualElement:r,Component:n}}function Ur(n,e,t,r={passive:!0}){return n.addEventListener(e,t,r),()=>n.removeEventListener(e,t)}const HE=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1;function Dc(n,e="page"){return{point:{x:n[e+"X"],y:n[e+"Y"]}}}const d_=n=>e=>HE(e)&&n(e,Dc(e));function jr(n,e,t,r){return Ur(n,e,d_(t),r)}const f_=(n,e)=>t=>e(n(t)),Ss=(...n)=>n.reduce(f_);function KE(n){let e=null;return()=>{const t=()=>{e=null};return e===null?(e=n,t):!1}}const ov=KE("dragHorizontal"),av=KE("dragVertical");function zE(n){let e=!1;if(n==="y")e=av();else if(n==="x")e=ov();else{const t=ov(),r=av();t&&r?e=()=>{t(),r()}:(t&&t(),r&&r())}return e}function WE(){const n=zE(!0);return n?(n(),!1):!0}class Is{constructor(e){this.isMounted=!1,this.node=e}update(){}}function lv(n,e){const t="pointer"+(e?"enter":"leave"),r="onHover"+(e?"Start":"End"),s=(i,o)=>{if(i.pointerType==="touch"||WE())return;const l=n.getProps();n.animationState&&l.whileHover&&n.animationState.setActive("whileHover",e),l[r]&&it.update(()=>l[r](i,o))};return jr(n.current,t,s,{passive:!n.getProps()[r]})}class h_ extends Is{mount(){this.unmount=Ss(lv(this.node,!0),lv(this.node,!1))}unmount(){}}class m_ extends Is{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Ss(Ur(this.node.current,"focus",()=>this.onFocus()),Ur(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const YE=(n,e)=>e?n===e?!0:YE(n,e.parentElement):!1;function Kf(n,e){if(!e)return;const t=new PointerEvent("pointer"+n);e(t,Dc(t))}class p_ extends Is{constructor(){super(...arguments),this.removeStartListeners=Tt,this.removeEndListeners=Tt,this.removeAccessibleListeners=Tt,this.startPointerPress=(e,t)=>{if(this.isPressing)return;this.removeEndListeners();const r=this.node.getProps(),i=jr(window,"pointerup",(l,c)=>{if(!this.checkPressEnd())return;const{onTap:d,onTapCancel:f,globalTapTarget:h}=this.node.getProps();it.update(()=>{!h&&!YE(this.node.current,l.target)?f&&f(l,c):d&&d(l,c)})},{passive:!(r.onTap||r.onPointerUp)}),o=jr(window,"pointercancel",(l,c)=>this.cancelPress(l,c),{passive:!(r.onTapCancel||r.onPointerCancel)});this.removeEndListeners=Ss(i,o),this.startPress(e,t)},this.startAccessiblePress=()=>{const e=i=>{if(i.key!=="Enter"||this.isPressing)return;const o=l=>{l.key!=="Enter"||!this.checkPressEnd()||Kf("up",(c,d)=>{const{onTap:f}=this.node.getProps();f&&it.update(()=>f(c,d))})};this.removeEndListeners(),this.removeEndListeners=Ur(this.node.current,"keyup",o),Kf("down",(l,c)=>{this.startPress(l,c)})},t=Ur(this.node.current,"keydown",e),r=()=>{this.isPressing&&Kf("cancel",(i,o)=>this.cancelPress(i,o))},s=Ur(this.node.current,"blur",r);this.removeAccessibleListeners=Ss(t,s)}}startPress(e,t){this.isPressing=!0;const{onTapStart:r,whileTap:s}=this.node.getProps();s&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),r&&it.update(()=>r(e,t))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!WE()}cancelPress(e,t){if(!this.checkPressEnd())return;const{onTapCancel:r}=this.node.getProps();r&&it.update(()=>r(e,t))}mount(){const e=this.node.getProps(),t=jr(e.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(e.onTapStart||e.onPointerStart)}),r=Ur(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=Ss(t,r)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const Hh=new WeakMap,zf=new WeakMap,g_=n=>{const e=Hh.get(n.target);e&&e(n)},y_=n=>{n.forEach(g_)};function v_({root:n,...e}){const t=n||document;zf.has(t)||zf.set(t,{});const r=zf.get(t),s=JSON.stringify(e);return r[s]||(r[s]=new IntersectionObserver(y_,{root:n,...e})),r[s]}function x_(n,e,t){const r=v_(e);return Hh.set(n,t),r.observe(n),()=>{Hh.delete(n),r.unobserve(n)}}const S_={some:0,all:1};class E_ extends Is{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:r,amount:s="some",once:i}=e,o={root:t?t.current:void 0,rootMargin:r,threshold:typeof s=="number"?s:S_[s]},l=c=>{const{isIntersecting:d}=c;if(this.isInView===d||(this.isInView=d,i&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:f,onViewportLeave:h}=this.node.getProps(),p=d?f:h;p&&p(c)};return x_(this.node.current,o,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(T_(e,t))&&this.startObserver()}unmount(){}}function T_({viewport:n={}},{viewport:e={}}={}){return t=>n[t]!==e[t]}const b_={inView:{Feature:E_},tap:{Feature:p_},focus:{Feature:m_},hover:{Feature:h_}};function qE(n,e){if(!Array.isArray(e))return!1;const t=e.length;if(t!==n.length)return!1;for(let r=0;r<t;r++)if(e[r]!==n[r])return!1;return!0}function w_(n){const e={};return n.values.forEach((t,r)=>e[r]=t.get()),e}function A_(n){const e={};return n.values.forEach((t,r)=>e[r]=t.getVelocity()),e}function Nc(n,e,t){const r=n.getProps();return up(r,e,t!==void 0?t:r.custom,w_(n),A_(n))}let cp=Tt;const ei=n=>n*1e3,Vr=n=>n/1e3,L_={current:!1},XE=n=>Array.isArray(n)&&typeof n[0]=="number";function QE(n){return!!(!n||typeof n=="string"&&JE[n]||XE(n)||Array.isArray(n)&&n.every(QE))}const ra=([n,e,t,r])=>`cubic-bezier(${n}, ${e}, ${t}, ${r})`,JE={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:ra([0,.65,.55,1]),circOut:ra([.55,0,1,.45]),backIn:ra([.31,.01,.66,-.59]),backOut:ra([.33,1.53,.69,.99])};function ZE(n){if(n)return XE(n)?ra(n):Array.isArray(n)?n.map(ZE):JE[n]}function R_(n,e,t,{delay:r=0,duration:s,repeat:i=0,repeatType:o="loop",ease:l,times:c}={}){const d={[e]:t};c&&(d.offset=c);const f=ZE(l);return Array.isArray(f)&&(d.easing=f),n.animate(d,{delay:r,duration:s,easing:Array.isArray(f)?"linear":f,fill:"both",iterations:i+1,direction:o==="reverse"?"alternate":"normal"})}function I_(n,{repeat:e,repeatType:t="loop"}){const r=e&&t!=="loop"&&e%2===1?0:n.length-1;return n[r]}const eT=(n,e,t)=>(((1-3*t+3*e)*n+(3*t-6*e))*n+3*e)*n,__=1e-7,C_=12;function k_(n,e,t,r,s){let i,o,l=0;do o=e+(t-e)/2,i=eT(o,r,s)-n,i>0?t=o:e=o;while(Math.abs(i)>__&&++l<C_);return o}function Ga(n,e,t,r){if(n===e&&t===r)return Tt;const s=i=>k_(i,0,1,n,t);return i=>i===0||i===1?i:eT(s(i),e,r)}const P_=Ga(.42,0,1,1),D_=Ga(0,0,.58,1),tT=Ga(.42,0,.58,1),N_=n=>Array.isArray(n)&&typeof n[0]!="number",nT=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,rT=n=>e=>1-n(1-e),dp=n=>1-Math.sin(Math.acos(n)),sT=rT(dp),O_=nT(dp),iT=Ga(.33,1.53,.69,.99),fp=rT(iT),M_=nT(fp),F_=n=>(n*=2)<1?.5*fp(n):.5*(2-Math.pow(2,-10*(n-1))),B_={linear:Tt,easeIn:P_,easeInOut:tT,easeOut:D_,circIn:dp,circInOut:O_,circOut:sT,backIn:fp,backInOut:M_,backOut:iT,anticipate:F_},uv=n=>{if(Array.isArray(n)){cp(n.length===4);const[e,t,r,s]=n;return Ga(e,t,r,s)}else if(typeof n=="string")return B_[n];return n},hp=(n,e)=>t=>!!(ja(t)&&$I.test(t)&&t.startsWith(n)||e&&Object.prototype.hasOwnProperty.call(t,e)),oT=(n,e,t)=>r=>{if(!ja(r))return r;const[s,i,o,l]=r.match(Pc);return{[n]:parseFloat(s),[e]:parseFloat(i),[t]:parseFloat(o),alpha:l!==void 0?parseFloat(l):1}},U_=n=>bs(0,255,n),Wf={...ui,transform:n=>Math.round(U_(n))},Qs={test:hp("rgb","red"),parse:oT("red","green","blue"),transform:({red:n,green:e,blue:t,alpha:r=1})=>"rgba("+Wf.transform(n)+", "+Wf.transform(e)+", "+Wf.transform(t)+", "+la(aa.transform(r))+")"};function $_(n){let e="",t="",r="",s="";return n.length>5?(e=n.substring(1,3),t=n.substring(3,5),r=n.substring(5,7),s=n.substring(7,9)):(e=n.substring(1,2),t=n.substring(2,3),r=n.substring(3,4),s=n.substring(4,5),e+=e,t+=t,r+=r,s+=s),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(r,16),alpha:s?parseInt(s,16)/255:1}}const Kh={test:hp("#"),parse:$_,transform:Qs.transform},$i={test:hp("hsl","hue"),parse:oT("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:t,alpha:r=1})=>"hsla("+Math.round(n)+", "+gr.transform(la(e))+", "+gr.transform(la(t))+", "+la(aa.transform(r))+")"},Jt={test:n=>Qs.test(n)||Kh.test(n)||$i.test(n),parse:n=>Qs.test(n)?Qs.parse(n):$i.test(n)?$i.parse(n):Kh.parse(n),transform:n=>ja(n)?n:n.hasOwnProperty("red")?Qs.transform(n):$i.transform(n)},ht=(n,e,t)=>-t*n+t*e+n;function Yf(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*(2/3-t)*6:n}function j_({hue:n,saturation:e,lightness:t,alpha:r}){n/=360,e/=100,t/=100;let s=0,i=0,o=0;if(!e)s=i=o=t;else{const l=t<.5?t*(1+e):t+e-t*e,c=2*t-l;s=Yf(c,l,n+1/3),i=Yf(c,l,n),o=Yf(c,l,n-1/3)}return{red:Math.round(s*255),green:Math.round(i*255),blue:Math.round(o*255),alpha:r}}const qf=(n,e,t)=>{const r=n*n;return Math.sqrt(Math.max(0,t*(e*e-r)+r))},V_=[Kh,Qs,$i],G_=n=>V_.find(e=>e.test(n));function cv(n){const e=G_(n);let t=e.parse(n);return e===$i&&(t=j_(t)),t}const aT=(n,e)=>{const t=cv(n),r=cv(e),s={...t};return i=>(s.red=qf(t.red,r.red,i),s.green=qf(t.green,r.green,i),s.blue=qf(t.blue,r.blue,i),s.alpha=ht(t.alpha,r.alpha,i),Qs.transform(s))};function H_(n){var e,t;return isNaN(n)&&ja(n)&&(((e=n.match(Pc))===null||e===void 0?void 0:e.length)||0)+(((t=n.match(DE))===null||t===void 0?void 0:t.length)||0)>0}const lT={regex:BI,countKey:"Vars",token:"${v}",parse:Tt},uT={regex:DE,countKey:"Colors",token:"${c}",parse:Jt.parse},cT={regex:Pc,countKey:"Numbers",token:"${n}",parse:ui.parse};function Xf(n,{regex:e,countKey:t,token:r,parse:s}){const i=n.tokenised.match(e);i&&(n["num"+t]=i.length,n.tokenised=n.tokenised.replace(e,r),n.values.push(...i.map(s)))}function Zu(n){const e=n.toString(),t={value:e,tokenised:e,values:[],numVars:0,numColors:0,numNumbers:0};return t.value.includes("var(--")&&Xf(t,lT),Xf(t,uT),Xf(t,cT),t}function dT(n){return Zu(n).values}function fT(n){const{values:e,numColors:t,numVars:r,tokenised:s}=Zu(n),i=e.length;return o=>{let l=s;for(let c=0;c<i;c++)c<r?l=l.replace(lT.token,o[c]):c<r+t?l=l.replace(uT.token,Jt.transform(o[c])):l=l.replace(cT.token,la(o[c]));return l}}const K_=n=>typeof n=="number"?0:n;function z_(n){const e=dT(n);return fT(n)(e.map(K_))}const ws={test:H_,parse:dT,createTransformer:fT,getAnimatableNone:z_},hT=(n,e)=>t=>`${t>0?e:n}`;function mT(n,e){return typeof n=="number"?t=>ht(n,e,t):Jt.test(n)?aT(n,e):n.startsWith("var(")?hT(n,e):gT(n,e)}const pT=(n,e)=>{const t=[...n],r=t.length,s=n.map((i,o)=>mT(i,e[o]));return i=>{for(let o=0;o<r;o++)t[o]=s[o](i);return t}},W_=(n,e)=>{const t={...n,...e},r={};for(const s in t)n[s]!==void 0&&e[s]!==void 0&&(r[s]=mT(n[s],e[s]));return s=>{for(const i in r)t[i]=r[i](s);return t}},gT=(n,e)=>{const t=ws.createTransformer(e),r=Zu(n),s=Zu(e);return r.numVars===s.numVars&&r.numColors===s.numColors&&r.numNumbers>=s.numNumbers?Ss(pT(r.values,s.values),t):hT(n,e)},Sa=(n,e,t)=>{const r=e-n;return r===0?1:(t-n)/r},dv=(n,e)=>t=>ht(n,e,t);function Y_(n){return typeof n=="number"?dv:typeof n=="string"?Jt.test(n)?aT:gT:Array.isArray(n)?pT:typeof n=="object"?W_:dv}function q_(n,e,t){const r=[],s=t||Y_(n[0]),i=n.length-1;for(let o=0;o<i;o++){let l=s(n[o],n[o+1]);if(e){const c=Array.isArray(e)?e[o]||Tt:e;l=Ss(c,l)}r.push(l)}return r}function yT(n,e,{clamp:t=!0,ease:r,mixer:s}={}){const i=n.length;if(cp(i===e.length),i===1)return()=>e[0];n[0]>n[i-1]&&(n=[...n].reverse(),e=[...e].reverse());const o=q_(e,r,s),l=o.length,c=d=>{let f=0;if(l>1)for(;f<n.length-2&&!(d<n[f+1]);f++);const h=Sa(n[f],n[f+1],d);return o[f](h)};return t?d=>c(bs(n[0],n[i-1],d)):c}function X_(n,e){const t=n[n.length-1];for(let r=1;r<=e;r++){const s=Sa(0,e,r);n.push(ht(t,1,s))}}function Q_(n){const e=[0];return X_(e,n.length-1),e}function J_(n,e){return n.map(t=>t*e)}function Z_(n,e){return n.map(()=>e||tT).splice(0,n.length-1)}function ec({duration:n=300,keyframes:e,times:t,ease:r="easeInOut"}){const s=N_(r)?r.map(uv):uv(r),i={done:!1,value:e[0]},o=J_(t&&t.length===e.length?t:Q_(e),n),l=yT(o,e,{ease:Array.isArray(s)?s:Z_(e,s)});return{calculatedDuration:n,next:c=>(i.value=l(c),i.done=c>=n,i)}}function vT(n,e){return e?n*(1e3/e):0}const eC=5;function xT(n,e,t){const r=Math.max(e-eC,0);return vT(t-n(r),e-r)}const Qf=.001,tC=.01,nC=10,rC=.05,sC=1;function iC({duration:n=800,bounce:e=.25,velocity:t=0,mass:r=1}){let s,i,o=1-e;o=bs(rC,sC,o),n=bs(tC,nC,Vr(n)),o<1?(s=d=>{const f=d*o,h=f*n,p=f-t,v=zh(d,o),g=Math.exp(-h);return Qf-p/v*g},i=d=>{const h=d*o*n,p=h*t+t,v=Math.pow(o,2)*Math.pow(d,2)*n,g=Math.exp(-h),S=zh(Math.pow(d,2),o);return(-s(d)+Qf>0?-1:1)*((p-v)*g)/S}):(s=d=>{const f=Math.exp(-d*n),h=(d-t)*n+1;return-Qf+f*h},i=d=>{const f=Math.exp(-d*n),h=(t-d)*(n*n);return f*h});const l=5/n,c=aC(s,i,l);if(n=ei(n),isNaN(c))return{stiffness:100,damping:10,duration:n};{const d=Math.pow(c,2)*r;return{stiffness:d,damping:o*2*Math.sqrt(r*d),duration:n}}}const oC=12;function aC(n,e,t){let r=t;for(let s=1;s<oC;s++)r=r-n(r)/e(r);return r}function zh(n,e){return n*Math.sqrt(1-e*e)}const lC=["duration","bounce"],uC=["stiffness","damping","mass"];function fv(n,e){return e.some(t=>n[t]!==void 0)}function cC(n){let e={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...n};if(!fv(n,uC)&&fv(n,lC)){const t=iC(n);e={...e,...t,mass:1},e.isResolvedFromDuration=!0}return e}function ST({keyframes:n,restDelta:e,restSpeed:t,...r}){const s=n[0],i=n[n.length-1],o={done:!1,value:s},{stiffness:l,damping:c,mass:d,duration:f,velocity:h,isResolvedFromDuration:p}=cC({...r,velocity:-Vr(r.velocity||0)}),v=h||0,g=c/(2*Math.sqrt(l*d)),S=i-s,x=Vr(Math.sqrt(l/d)),b=Math.abs(S)<5;t||(t=b?.01:2),e||(e=b?.005:.5);let A;if(g<1){const L=zh(x,g);A=I=>{const k=Math.exp(-g*x*I);return i-k*((v+g*x*S)/L*Math.sin(L*I)+S*Math.cos(L*I))}}else if(g===1)A=L=>i-Math.exp(-x*L)*(S+(v+x*S)*L);else{const L=x*Math.sqrt(g*g-1);A=I=>{const k=Math.exp(-g*x*I),F=Math.min(L*I,300);return i-k*((v+g*x*S)*Math.sinh(F)+L*S*Math.cosh(F))/L}}return{calculatedDuration:p&&f||null,next:L=>{const I=A(L);if(p)o.done=L>=f;else{let k=v;L!==0&&(g<1?k=xT(A,L,I):k=0);const F=Math.abs(k)<=t,C=Math.abs(i-I)<=e;o.done=F&&C}return o.value=o.done?i:I,o}}}function hv({keyframes:n,velocity:e=0,power:t=.8,timeConstant:r=325,bounceDamping:s=10,bounceStiffness:i=500,modifyTarget:o,min:l,max:c,restDelta:d=.5,restSpeed:f}){const h=n[0],p={done:!1,value:h},v=P=>l!==void 0&&P<l||c!==void 0&&P>c,g=P=>l===void 0?c:c===void 0||Math.abs(l-P)<Math.abs(c-P)?l:c;let S=t*e;const x=h+S,b=o===void 0?x:o(x);b!==x&&(S=b-h);const A=P=>-S*Math.exp(-P/r),L=P=>b+A(P),I=P=>{const O=A(P),M=L(P);p.done=Math.abs(O)<=d,p.value=p.done?b:M};let k,F;const C=P=>{v(p.value)&&(k=P,F=ST({keyframes:[p.value,g(p.value)],velocity:xT(L,P,p.value),damping:s,stiffness:i,restDelta:d,restSpeed:f}))};return C(0),{calculatedDuration:null,next:P=>{let O=!1;return!F&&k===void 0&&(O=!0,I(P),C(P)),k!==void 0&&P>k?F.next(P-k):(!O&&I(P),p)}}}const dC=n=>{const e=({timestamp:t})=>n(t);return{start:()=>it.update(e,!0),stop:()=>Kr(e),now:()=>Kt.isProcessing?Kt.timestamp:performance.now()}},mv=2e4;function pv(n){let e=0;const t=50;let r=n.next(e);for(;!r.done&&e<mv;)e+=t,r=n.next(e);return e>=mv?1/0:e}const fC={decay:hv,inertia:hv,tween:ec,keyframes:ec,spring:ST};function tc({autoplay:n=!0,delay:e=0,driver:t=dC,keyframes:r,type:s="keyframes",repeat:i=0,repeatDelay:o=0,repeatType:l="loop",onPlay:c,onStop:d,onComplete:f,onUpdate:h,...p}){let v=1,g=!1,S,x;const b=()=>{x=new Promise(D=>{S=D})};b();let A;const L=fC[s]||ec;let I;L!==ec&&typeof r[0]!="number"&&(I=yT([0,100],r,{clamp:!1}),r=[0,100]);const k=L({...p,keyframes:r});let F;l==="mirror"&&(F=L({...p,keyframes:[...r].reverse(),velocity:-(p.velocity||0)}));let C="idle",P=null,O=null,M=null;k.calculatedDuration===null&&i&&(k.calculatedDuration=pv(k));const{calculatedDuration:H}=k;let Z=1/0,se=1/0;H!==null&&(Z=H+o,se=Z*(i+1)-o);let U=0;const ne=D=>{if(O===null)return;v>0&&(O=Math.min(O,D)),v<0&&(O=Math.min(D-se/v,O)),P!==null?U=P:U=Math.round(D-O)*v;const $=U-e*(v>=0?1:-1),ie=v>=0?$<0:$>se;U=Math.max($,0),C==="finished"&&P===null&&(U=se);let ue=U,ce=k;if(i){const Le=Math.min(U,se)/Z;let ke=Math.floor(Le),Pe=Le%1;!Pe&&Le>=1&&(Pe=1),Pe===1&&ke--,ke=Math.min(ke,i+1),!!(ke%2)&&(l==="reverse"?(Pe=1-Pe,o&&(Pe-=o/Z)):l==="mirror"&&(ce=F)),ue=bs(0,1,Pe)*Z}const fe=ie?{done:!1,value:r[0]}:ce.next(ue);I&&(fe.value=I(fe.value));let{done:Ee}=fe;!ie&&H!==null&&(Ee=v>=0?U>=se:U<=0);const ye=P===null&&(C==="finished"||C==="running"&&Ee);return h&&h(fe.value),ye&&G(),fe},q=()=>{A&&A.stop(),A=void 0},te=()=>{C="idle",q(),S(),b(),O=M=null},G=()=>{C="finished",f&&f(),q(),S()},Q=()=>{if(g)return;A||(A=t(ne));const D=A.now();c&&c(),P!==null?O=D-P:(!O||C==="finished")&&(O=D),C==="finished"&&b(),M=O,P=null,C="running",A.start()};n&&Q();const ee={then(D,$){return x.then(D,$)},get time(){return Vr(U)},set time(D){D=ei(D),U=D,P!==null||!A||v===0?P=D:O=A.now()-D/v},get duration(){const D=k.calculatedDuration===null?pv(k):k.calculatedDuration;return Vr(D)},get speed(){return v},set speed(D){D===v||!A||(v=D,ee.time=Vr(U))},get state(){return C},play:Q,pause:()=>{C="paused",P=U},stop:()=>{g=!0,C!=="idle"&&(C="idle",d&&d(),te())},cancel:()=>{M!==null&&ne(M),te()},complete:()=>{C="finished"},sample:D=>(O=0,ne(D))};return ee}function hC(n){let e;return()=>(e===void 0&&(e=n()),e)}const mC=hC(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),pC=new Set(["opacity","clipPath","filter","transform","backgroundColor"]),du=10,gC=2e4,yC=(n,e)=>e.type==="spring"||n==="backgroundColor"||!QE(e.ease);function vC(n,e,{onUpdate:t,onComplete:r,...s}){if(!(mC()&&pC.has(e)&&!s.repeatDelay&&s.repeatType!=="mirror"&&s.damping!==0&&s.type!=="inertia"))return!1;let o=!1,l,c,d=!1;const f=()=>{c=new Promise(L=>{l=L})};f();let{keyframes:h,duration:p=300,ease:v,times:g}=s;if(yC(e,s)){const L=tc({...s,repeat:0,delay:0});let I={done:!1,value:h[0]};const k=[];let F=0;for(;!I.done&&F<gC;)I=L.sample(F),k.push(I.value),F+=du;g=void 0,h=k,p=F-du,v="linear"}const S=R_(n.owner.current,e,h,{...s,duration:p,ease:v,times:g}),x=()=>{d=!1,S.cancel()},b=()=>{d=!0,it.update(x),l(),f()};return S.onfinish=()=>{d||(n.set(I_(h,s)),r&&r(),b())},{then(L,I){return c.then(L,I)},attachTimeline(L){return S.timeline=L,S.onfinish=null,Tt},get time(){return Vr(S.currentTime||0)},set time(L){S.currentTime=ei(L)},get speed(){return S.playbackRate},set speed(L){S.playbackRate=L},get duration(){return Vr(p)},play:()=>{o||(S.play(),Kr(x))},pause:()=>S.pause(),stop:()=>{if(o=!0,S.playState==="idle")return;const{currentTime:L}=S;if(L){const I=tc({...s,autoplay:!1});n.setWithVelocity(I.sample(L-du).value,I.sample(L).value,du)}b()},complete:()=>{d||S.finish()},cancel:b}}function xC({keyframes:n,delay:e,onUpdate:t,onComplete:r}){const s=()=>(t&&t(n[n.length-1]),r&&r(),{time:0,speed:1,duration:0,play:Tt,pause:Tt,stop:Tt,then:i=>(i(),Promise.resolve()),cancel:Tt,complete:Tt});return e?tc({keyframes:[0,1],duration:0,delay:e,onComplete:s}):s()}const SC={type:"spring",stiffness:500,damping:25,restSpeed:10},EC=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),TC={type:"keyframes",duration:.8},bC={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},wC=(n,{keyframes:e})=>e.length>2?TC:li.has(n)?n.startsWith("scale")?EC(e[1]):SC:bC,Wh=(n,e)=>n==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(ws.test(e)||e==="0")&&!e.startsWith("url(")),AC=new Set(["brightness","contrast","saturate","opacity"]);function LC(n){const[e,t]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[r]=t.match(Pc)||[];if(!r)return n;const s=t.replace(r,"");let i=AC.has(e)?1:0;return r!==t&&(i*=100),e+"("+i+s+")"}const RC=/([a-z-]*)\(.*?\)/g,Yh={...ws,getAnimatableNone:n=>{const e=n.match(RC);return e?e.map(LC).join(" "):n}},IC={...NE,color:Jt,backgroundColor:Jt,outlineColor:Jt,fill:Jt,stroke:Jt,borderColor:Jt,borderTopColor:Jt,borderRightColor:Jt,borderBottomColor:Jt,borderLeftColor:Jt,filter:Yh,WebkitFilter:Yh},mp=n=>IC[n];function ET(n,e){let t=mp(n);return t!==Yh&&(t=ws),t.getAnimatableNone?t.getAnimatableNone(e):void 0}const TT=n=>/^0[^.\s]+$/.test(n);function _C(n){if(typeof n=="number")return n===0;if(n!==null)return n==="none"||n==="0"||TT(n)}function CC(n,e,t,r){const s=Wh(e,t);let i;Array.isArray(t)?i=[...t]:i=[null,t];const o=r.from!==void 0?r.from:n.get();let l;const c=[];for(let d=0;d<i.length;d++)i[d]===null&&(i[d]=d===0?o:i[d-1]),_C(i[d])&&c.push(d),typeof i[d]=="string"&&i[d]!=="none"&&i[d]!=="0"&&(l=i[d]);if(s&&c.length&&l)for(let d=0;d<c.length;d++){const f=c[d];i[f]=ET(e,l)}return i}function kC({when:n,delay:e,delayChildren:t,staggerChildren:r,staggerDirection:s,repeat:i,repeatType:o,repeatDelay:l,from:c,elapsed:d,...f}){return!!Object.keys(f).length}function pp(n,e){return n[e]||n.default||n}const PC={skipAnimations:!1},gp=(n,e,t,r={})=>s=>{const i=pp(r,n)||{},o=i.delay||r.delay||0;let{elapsed:l=0}=r;l=l-ei(o);const c=CC(e,n,t,i),d=c[0],f=c[c.length-1],h=Wh(n,d),p=Wh(n,f);let v={keyframes:c,velocity:e.getVelocity(),ease:"easeOut",...i,delay:-l,onUpdate:g=>{e.set(g),i.onUpdate&&i.onUpdate(g)},onComplete:()=>{s(),i.onComplete&&i.onComplete()}};if(kC(i)||(v={...v,...wC(n,v)}),v.duration&&(v.duration=ei(v.duration)),v.repeatDelay&&(v.repeatDelay=ei(v.repeatDelay)),!h||!p||L_.current||i.type===!1||PC.skipAnimations)return xC(v);if(!r.isHandoff&&e.owner&&e.owner.current instanceof HTMLElement&&!e.owner.getProps().onUpdate){const g=vC(e,n,v);if(g)return g}return tc(v)};function nc(n){return!!(fn(n)&&n.add)}const bT=n=>/^\-?\d*\.?\d+$/.test(n);function yp(n,e){n.indexOf(e)===-1&&n.push(e)}function vp(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}class xp{constructor(){this.subscriptions=[]}add(e){return yp(this.subscriptions,e),()=>vp(this.subscriptions,e)}notify(e,t,r){const s=this.subscriptions.length;if(s)if(s===1)this.subscriptions[0](e,t,r);else for(let i=0;i<s;i++){const o=this.subscriptions[i];o&&o(e,t,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const DC=n=>!isNaN(parseFloat(n));class NC{constructor(e,t={}){this.version="10.18.0",this.timeDelta=0,this.lastUpdated=0,this.canTrackVelocity=!1,this.events={},this.updateAndNotify=(r,s=!0)=>{this.prev=this.current,this.current=r;const{delta:i,timestamp:o}=Kt;this.lastUpdated!==o&&(this.timeDelta=i,this.lastUpdated=o,it.postRender(this.scheduleVelocityCheck)),this.prev!==this.current&&this.events.change&&this.events.change.notify(this.current),this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()),s&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.scheduleVelocityCheck=()=>it.postRender(this.velocityCheck),this.velocityCheck=({timestamp:r})=>{r!==this.lastUpdated&&(this.prev=this.current,this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()))},this.hasAnimated=!1,this.prev=this.current=e,this.canTrackVelocity=DC(this.current),this.owner=t.owner}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new xp);const r=this.events[e].add(t);return e==="change"?()=>{r(),it.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e,t=!0){!t||!this.passiveEffect?this.updateAndNotify(e,t):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,t,r){this.set(t),this.prev=e,this.timeDelta=r}jump(e){this.updateAndNotify(e),this.prev=e,this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){return this.canTrackVelocity?vT(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Yi(n,e){return new NC(n,e)}const wT=n=>e=>e.test(n),OC={test:n=>n==="auto",parse:n=>n},AT=[ui,Ce,gr,ps,VI,jI,OC],Jo=n=>AT.find(wT(n)),MC=[...AT,Jt,ws],FC=n=>MC.find(wT(n));function BC(n,e,t){n.hasValue(e)?n.getValue(e).set(t):n.addValue(e,Yi(t))}function UC(n,e){const t=Nc(n,e);let{transitionEnd:r={},transition:s={},...i}=t?n.makeTargetAnimatable(t,!1):{};i={...i,...r};for(const o in i){const l=n_(i[o]);BC(n,o,l)}}function $C(n,e,t){var r,s;const i=Object.keys(e).filter(l=>!n.hasValue(l)),o=i.length;if(o)for(let l=0;l<o;l++){const c=i[l],d=e[c];let f=null;Array.isArray(d)&&(f=d[0]),f===null&&(f=(s=(r=t[c])!==null&&r!==void 0?r:n.readValue(c))!==null&&s!==void 0?s:e[c]),f!=null&&(typeof f=="string"&&(bT(f)||TT(f))?f=parseFloat(f):!FC(f)&&ws.test(d)&&(f=ET(c,d)),n.addValue(c,Yi(f,{owner:n})),t[c]===void 0&&(t[c]=f),f!==null&&n.setBaseTarget(c,f))}}function jC(n,e){return e?(e[n]||e.default||e).from:void 0}function VC(n,e,t){const r={};for(const s in n){const i=jC(s,e);if(i!==void 0)r[s]=i;else{const o=t.getValue(s);o&&(r[s]=o.get())}}return r}function GC({protectedKeys:n,needsAnimating:e},t){const r=n.hasOwnProperty(t)&&e[t]!==!0;return e[t]=!1,r}function HC(n,e){const t=n.get();if(Array.isArray(e)){for(let r=0;r<e.length;r++)if(e[r]!==t)return!0}else return t!==e}function LT(n,e,{delay:t=0,transitionOverride:r,type:s}={}){let{transition:i=n.getDefaultTransition(),transitionEnd:o,...l}=n.makeTargetAnimatable(e);const c=n.getValue("willChange");r&&(i=r);const d=[],f=s&&n.animationState&&n.animationState.getState()[s];for(const h in l){const p=n.getValue(h),v=l[h];if(!p||v===void 0||f&&GC(f,h))continue;const g={delay:t,elapsed:0,...pp(i||{},h)};if(window.HandoffAppearAnimations){const b=n.getProps()[RE];if(b){const A=window.HandoffAppearAnimations(b,h,p,it);A!==null&&(g.elapsed=A,g.isHandoff=!0)}}let S=!g.isHandoff&&!HC(p,v);if(g.type==="spring"&&(p.getVelocity()||g.velocity)&&(S=!1),p.animation&&(S=!1),S)continue;p.start(gp(h,p,v,n.shouldReduceMotion&&li.has(h)?{type:!1}:g));const x=p.animation;nc(c)&&(c.add(h),x.then(()=>c.remove(h))),d.push(x)}return o&&Promise.all(d).then(()=>{o&&UC(n,o)}),d}function qh(n,e,t={}){const r=Nc(n,e,t.custom);let{transition:s=n.getDefaultTransition()||{}}=r||{};t.transitionOverride&&(s=t.transitionOverride);const i=r?()=>Promise.all(LT(n,r,t)):()=>Promise.resolve(),o=n.variantChildren&&n.variantChildren.size?(c=0)=>{const{delayChildren:d=0,staggerChildren:f,staggerDirection:h}=s;return KC(n,e,d+c,f,h,t)}:()=>Promise.resolve(),{when:l}=s;if(l){const[c,d]=l==="beforeChildren"?[i,o]:[o,i];return c().then(()=>d())}else return Promise.all([i(),o(t.delay)])}function KC(n,e,t=0,r=0,s=1,i){const o=[],l=(n.variantChildren.size-1)*r,c=s===1?(d=0)=>d*r:(d=0)=>l-d*r;return Array.from(n.variantChildren).sort(zC).forEach((d,f)=>{d.notify("AnimationStart",e),o.push(qh(d,e,{...i,delay:t+c(f)}).then(()=>d.notify("AnimationComplete",e)))}),Promise.all(o)}function zC(n,e){return n.sortNodePosition(e)}function WC(n,e,t={}){n.notify("AnimationStart",e);let r;if(Array.isArray(e)){const s=e.map(i=>qh(n,i,t));r=Promise.all(s)}else if(typeof e=="string")r=qh(n,e,t);else{const s=typeof e=="function"?Nc(n,e,t.custom):e;r=Promise.all(LT(n,s,t))}return r.then(()=>n.notify("AnimationComplete",e))}const YC=[...ep].reverse(),qC=ep.length;function XC(n){return e=>Promise.all(e.map(({animation:t,options:r})=>WC(n,t,r)))}function QC(n){let e=XC(n);const t=ZC();let r=!0;const s=(c,d)=>{const f=Nc(n,d);if(f){const{transition:h,transitionEnd:p,...v}=f;c={...c,...v,...p}}return c};function i(c){e=c(n)}function o(c,d){const f=n.getProps(),h=n.getVariantContext(!0)||{},p=[],v=new Set;let g={},S=1/0;for(let b=0;b<qC;b++){const A=YC[b],L=t[A],I=f[A]!==void 0?f[A]:h[A],k=va(I),F=A===d?L.isActive:null;F===!1&&(S=b);let C=I===h[A]&&I!==f[A]&&k;if(C&&r&&n.manuallyAnimateOnMount&&(C=!1),L.protectedKeys={...g},!L.isActive&&F===null||!I&&!L.prevProp||Cc(I)||typeof I=="boolean")continue;let O=JC(L.prevProp,I)||A===d&&L.isActive&&!C&&k||b>S&&k,M=!1;const H=Array.isArray(I)?I:[I];let Z=H.reduce(s,{});F===!1&&(Z={});const{prevResolvedValues:se={}}=L,U={...se,...Z},ne=q=>{O=!0,v.has(q)&&(M=!0,v.delete(q)),L.needsAnimating[q]=!0};for(const q in U){const te=Z[q],G=se[q];if(g.hasOwnProperty(q))continue;let Q=!1;Ju(te)&&Ju(G)?Q=!qE(te,G):Q=te!==G,Q?te!==void 0?ne(q):v.add(q):te!==void 0&&v.has(q)?ne(q):L.protectedKeys[q]=!0}L.prevProp=I,L.prevResolvedValues=Z,L.isActive&&(g={...g,...Z}),r&&n.blockInitialAnimation&&(O=!1),O&&(!C||M)&&p.push(...H.map(q=>({animation:q,options:{type:A,...c}})))}if(v.size){const b={};v.forEach(A=>{const L=n.getBaseTarget(A);L!==void 0&&(b[A]=L)}),p.push({animation:b})}let x=!!p.length;return r&&(f.initial===!1||f.initial===f.animate)&&!n.manuallyAnimateOnMount&&(x=!1),r=!1,x?e(p):Promise.resolve()}function l(c,d,f){var h;if(t[c].isActive===d)return Promise.resolve();(h=n.variantChildren)===null||h===void 0||h.forEach(v=>{var g;return(g=v.animationState)===null||g===void 0?void 0:g.setActive(c,d)}),t[c].isActive=d;const p=o(f,c);for(const v in t)t[v].protectedKeys={};return p}return{animateChanges:o,setActive:l,setAnimateFunction:i,getState:()=>t}}function JC(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!qE(e,n):!1}function Gs(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function ZC(){return{animate:Gs(!0),whileInView:Gs(),whileHover:Gs(),whileTap:Gs(),whileDrag:Gs(),whileFocus:Gs(),exit:Gs()}}class ek extends Is{constructor(e){super(e),e.animationState||(e.animationState=QC(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();this.unmount(),Cc(e)&&(this.unmount=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){}}let tk=0;class nk extends Is{constructor(){super(...arguments),this.id=tk++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t,custom:r}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===s)return;const i=this.node.animationState.setActive("exit",!e,{custom:r??this.node.getProps().custom});t&&!e&&i.then(()=>t(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const rk={animation:{Feature:ek},exit:{Feature:nk}},gv=(n,e)=>Math.abs(n-e);function sk(n,e){const t=gv(n.x,e.x),r=gv(n.y,e.y);return Math.sqrt(t**2+r**2)}class RT{constructor(e,t,{transformPagePoint:r,contextWindow:s,dragSnapToOrigin:i=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const h=Zf(this.lastMoveEventInfo,this.history),p=this.startEvent!==null,v=sk(h.offset,{x:0,y:0})>=3;if(!p&&!v)return;const{point:g}=h,{timestamp:S}=Kt;this.history.push({...g,timestamp:S});const{onStart:x,onMove:b}=this.handlers;p||(x&&x(this.lastMoveEvent,h),this.startEvent=this.lastMoveEvent),b&&b(this.lastMoveEvent,h)},this.handlePointerMove=(h,p)=>{this.lastMoveEvent=h,this.lastMoveEventInfo=Jf(p,this.transformPagePoint),it.update(this.updatePoint,!0)},this.handlePointerUp=(h,p)=>{this.end();const{onEnd:v,onSessionEnd:g,resumeAnimation:S}=this.handlers;if(this.dragSnapToOrigin&&S&&S(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const x=Zf(h.type==="pointercancel"?this.lastMoveEventInfo:Jf(p,this.transformPagePoint),this.history);this.startEvent&&v&&v(h,x),g&&g(h,x)},!HE(e))return;this.dragSnapToOrigin=i,this.handlers=t,this.transformPagePoint=r,this.contextWindow=s||window;const o=Dc(e),l=Jf(o,this.transformPagePoint),{point:c}=l,{timestamp:d}=Kt;this.history=[{...c,timestamp:d}];const{onSessionStart:f}=t;f&&f(e,Zf(l,this.history)),this.removeListeners=Ss(jr(this.contextWindow,"pointermove",this.handlePointerMove),jr(this.contextWindow,"pointerup",this.handlePointerUp),jr(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Kr(this.updatePoint)}}function Jf(n,e){return e?{point:e(n.point)}:n}function yv(n,e){return{x:n.x-e.x,y:n.y-e.y}}function Zf({point:n},e){return{point:n,delta:yv(n,IT(e)),offset:yv(n,ik(e)),velocity:ok(e,.1)}}function ik(n){return n[0]}function IT(n){return n[n.length-1]}function ok(n,e){if(n.length<2)return{x:0,y:0};let t=n.length-1,r=null;const s=IT(n);for(;t>=0&&(r=n[t],!(s.timestamp-r.timestamp>ei(e)));)t--;if(!r)return{x:0,y:0};const i=Vr(s.timestamp-r.timestamp);if(i===0)return{x:0,y:0};const o={x:(s.x-r.x)/i,y:(s.y-r.y)/i};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function In(n){return n.max-n.min}function Xh(n,e=0,t=.01){return Math.abs(n-e)<=t}function vv(n,e,t,r=.5){n.origin=r,n.originPoint=ht(e.min,e.max,n.origin),n.scale=In(t)/In(e),(Xh(n.scale,1,1e-4)||isNaN(n.scale))&&(n.scale=1),n.translate=ht(t.min,t.max,n.origin)-n.originPoint,(Xh(n.translate)||isNaN(n.translate))&&(n.translate=0)}function ua(n,e,t,r){vv(n.x,e.x,t.x,r?r.originX:void 0),vv(n.y,e.y,t.y,r?r.originY:void 0)}function xv(n,e,t){n.min=t.min+e.min,n.max=n.min+In(e)}function ak(n,e,t){xv(n.x,e.x,t.x),xv(n.y,e.y,t.y)}function Sv(n,e,t){n.min=e.min-t.min,n.max=n.min+In(e)}function ca(n,e,t){Sv(n.x,e.x,t.x),Sv(n.y,e.y,t.y)}function lk(n,{min:e,max:t},r){return e!==void 0&&n<e?n=r?ht(e,n,r.min):Math.max(n,e):t!==void 0&&n>t&&(n=r?ht(t,n,r.max):Math.min(n,t)),n}function Ev(n,e,t){return{min:e!==void 0?n.min+e:void 0,max:t!==void 0?n.max+t-(n.max-n.min):void 0}}function uk(n,{top:e,left:t,bottom:r,right:s}){return{x:Ev(n.x,t,s),y:Ev(n.y,e,r)}}function Tv(n,e){let t=e.min-n.min,r=e.max-n.max;return e.max-e.min<n.max-n.min&&([t,r]=[r,t]),{min:t,max:r}}function ck(n,e){return{x:Tv(n.x,e.x),y:Tv(n.y,e.y)}}function dk(n,e){let t=.5;const r=In(n),s=In(e);return s>r?t=Sa(e.min,e.max-r,n.min):r>s&&(t=Sa(n.min,n.max-s,e.min)),bs(0,1,t)}function fk(n,e){const t={};return e.min!==void 0&&(t.min=e.min-n.min),e.max!==void 0&&(t.max=e.max-n.min),t}const Qh=.35;function hk(n=Qh){return n===!1?n=0:n===!0&&(n=Qh),{x:bv(n,"left","right"),y:bv(n,"top","bottom")}}function bv(n,e,t){return{min:wv(n,e),max:wv(n,t)}}function wv(n,e){return typeof n=="number"?n:n[e]||0}const Av=()=>({translate:0,scale:1,origin:0,originPoint:0}),ji=()=>({x:Av(),y:Av()}),Lv=()=>({min:0,max:0}),At=()=>({x:Lv(),y:Lv()});function Bn(n){return[n("x"),n("y")]}function _T({top:n,left:e,right:t,bottom:r}){return{x:{min:e,max:t},y:{min:n,max:r}}}function mk({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function pk(n,e){if(!e)return n;const t=e({x:n.left,y:n.top}),r=e({x:n.right,y:n.bottom});return{top:t.y,left:t.x,bottom:r.y,right:r.x}}function eh(n){return n===void 0||n===1}function Jh({scale:n,scaleX:e,scaleY:t}){return!eh(n)||!eh(e)||!eh(t)}function zs(n){return Jh(n)||CT(n)||n.z||n.rotate||n.rotateX||n.rotateY}function CT(n){return Rv(n.x)||Rv(n.y)}function Rv(n){return n&&n!=="0%"}function rc(n,e,t){const r=n-t,s=e*r;return t+s}function Iv(n,e,t,r,s){return s!==void 0&&(n=rc(n,s,r)),rc(n,t,r)+e}function Zh(n,e=0,t=1,r,s){n.min=Iv(n.min,e,t,r,s),n.max=Iv(n.max,e,t,r,s)}function kT(n,{x:e,y:t}){Zh(n.x,e.translate,e.scale,e.originPoint),Zh(n.y,t.translate,t.scale,t.originPoint)}function gk(n,e,t,r=!1){const s=t.length;if(!s)return;e.x=e.y=1;let i,o;for(let l=0;l<s;l++){i=t[l],o=i.projectionDelta;const c=i.instance;c&&c.style&&c.style.display==="contents"||(r&&i.options.layoutScroll&&i.scroll&&i!==i.root&&Vi(n,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),o&&(e.x*=o.x.scale,e.y*=o.y.scale,kT(n,o)),r&&zs(i.latestValues)&&Vi(n,i.latestValues))}e.x=_v(e.x),e.y=_v(e.y)}function _v(n){return Number.isInteger(n)||n>1.0000000000001||n<.999999999999?n:1}function gs(n,e){n.min=n.min+e,n.max=n.max+e}function Cv(n,e,[t,r,s]){const i=e[s]!==void 0?e[s]:.5,o=ht(n.min,n.max,i);Zh(n,e[t],e[r],o,e.scale)}const yk=["x","scaleX","originX"],vk=["y","scaleY","originY"];function Vi(n,e){Cv(n.x,e,yk),Cv(n.y,e,vk)}function PT(n,e){return _T(pk(n.getBoundingClientRect(),e))}function xk(n,e,t){const r=PT(n,t),{scroll:s}=e;return s&&(gs(r.x,s.offset.x),gs(r.y,s.offset.y)),r}const DT=({current:n})=>n?n.ownerDocument.defaultView:null,Sk=new WeakMap;class Ek{constructor(e){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=At(),this.visualElement=e}start(e,{snapToCursor:t=!1}={}){const{presenceContext:r}=this.visualElement;if(r&&r.isPresent===!1)return;const s=f=>{const{dragSnapToOrigin:h}=this.getProps();h?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(Dc(f,"page").point)},i=(f,h)=>{const{drag:p,dragPropagation:v,onDragStart:g}=this.getProps();if(p&&!v&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=zE(p),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Bn(x=>{let b=this.getAxisMotionValue(x).get()||0;if(gr.test(b)){const{projection:A}=this.visualElement;if(A&&A.layout){const L=A.layout.layoutBox[x];L&&(b=In(L)*(parseFloat(b)/100))}}this.originPoint[x]=b}),g&&it.update(()=>g(f,h),!1,!0);const{animationState:S}=this.visualElement;S&&S.setActive("whileDrag",!0)},o=(f,h)=>{const{dragPropagation:p,dragDirectionLock:v,onDirectionLock:g,onDrag:S}=this.getProps();if(!p&&!this.openGlobalLock)return;const{offset:x}=h;if(v&&this.currentDirection===null){this.currentDirection=Tk(x),this.currentDirection!==null&&g&&g(this.currentDirection);return}this.updateAxis("x",h.point,x),this.updateAxis("y",h.point,x),this.visualElement.render(),S&&S(f,h)},l=(f,h)=>this.stop(f,h),c=()=>Bn(f=>{var h;return this.getAnimationState(f)==="paused"&&((h=this.getAxisMotionValue(f).animation)===null||h===void 0?void 0:h.play())}),{dragSnapToOrigin:d}=this.getProps();this.panSession=new RT(e,{onSessionStart:s,onStart:i,onMove:o,onSessionEnd:l,resumeAnimation:c},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:d,contextWindow:DT(this.visualElement)})}stop(e,t){const r=this.isDragging;if(this.cancel(),!r)return;const{velocity:s}=t;this.startAnimation(s);const{onDragEnd:i}=this.getProps();i&&it.update(()=>i(e,t))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:r}=this.getProps();!r&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,r){const{drag:s}=this.getProps();if(!r||!fu(e,s,this.currentDirection))return;const i=this.getAxisMotionValue(e);let o=this.originPoint[e]+r[e];this.constraints&&this.constraints[e]&&(o=lk(o,this.constraints[e],this.elastic[e])),i.set(o)}resolveConstraints(){var e;const{dragConstraints:t,dragElastic:r}=this.getProps(),s=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,i=this.constraints;t&&Ui(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&s?this.constraints=uk(s.layoutBox,t):this.constraints=!1,this.elastic=hk(r),i!==this.constraints&&s&&this.constraints&&!this.hasMutatedConstraints&&Bn(o=>{this.getAxisMotionValue(o)&&(this.constraints[o]=fk(s.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!Ui(e))return!1;const r=e.current,{projection:s}=this.visualElement;if(!s||!s.layout)return!1;const i=xk(r,s.root,this.visualElement.getTransformPagePoint());let o=ck(s.layout.layoutBox,i);if(t){const l=t(mk(o));this.hasMutatedConstraints=!!l,l&&(o=_T(l))}return o}startAnimation(e){const{drag:t,dragMomentum:r,dragElastic:s,dragTransition:i,dragSnapToOrigin:o,onDragTransitionEnd:l}=this.getProps(),c=this.constraints||{},d=Bn(f=>{if(!fu(f,t,this.currentDirection))return;let h=c&&c[f]||{};o&&(h={min:0,max:0});const p=s?200:1e6,v=s?40:1e7,g={type:"inertia",velocity:r?e[f]:0,bounceStiffness:p,bounceDamping:v,timeConstant:750,restDelta:1,restSpeed:10,...i,...h};return this.startAxisValueAnimation(f,g)});return Promise.all(d).then(l)}startAxisValueAnimation(e,t){const r=this.getAxisMotionValue(e);return r.start(gp(e,r,0,t))}stopAnimation(){Bn(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Bn(e=>{var t;return(t=this.getAxisMotionValue(e).animation)===null||t===void 0?void 0:t.pause()})}getAnimationState(e){var t;return(t=this.getAxisMotionValue(e).animation)===null||t===void 0?void 0:t.state}getAxisMotionValue(e){const t="_drag"+e.toUpperCase(),r=this.visualElement.getProps(),s=r[t];return s||this.visualElement.getValue(e,(r.initial?r.initial[e]:void 0)||0)}snapToCursor(e){Bn(t=>{const{drag:r}=this.getProps();if(!fu(t,r,this.currentDirection))return;const{projection:s}=this.visualElement,i=this.getAxisMotionValue(t);if(s&&s.layout){const{min:o,max:l}=s.layout.layoutBox[t];i.set(e[t]-ht(o,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:r}=this.visualElement;if(!Ui(t)||!r||!this.constraints)return;this.stopAnimation();const s={x:0,y:0};Bn(o=>{const l=this.getAxisMotionValue(o);if(l){const c=l.get();s[o]=dk({min:c,max:c},this.constraints[o])}});const{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),Bn(o=>{if(!fu(o,e,null))return;const l=this.getAxisMotionValue(o),{min:c,max:d}=this.constraints[o];l.set(ht(c,d,s[o]))})}addListeners(){if(!this.visualElement.current)return;Sk.set(this.visualElement,this);const e=this.visualElement.current,t=jr(e,"pointerdown",c=>{const{drag:d,dragListener:f=!0}=this.getProps();d&&f&&this.start(c)}),r=()=>{const{dragConstraints:c}=this.getProps();Ui(c)&&(this.constraints=this.resolveRefConstraints())},{projection:s}=this.visualElement,i=s.addEventListener("measure",r);s&&!s.layout&&(s.root&&s.root.updateScroll(),s.updateLayout()),r();const o=Ur(window,"resize",()=>this.scalePositionWithinConstraints()),l=s.addEventListener("didUpdate",(({delta:c,hasLayoutChanged:d})=>{this.isDragging&&d&&(Bn(f=>{const h=this.getAxisMotionValue(f);h&&(this.originPoint[f]+=c[f].translate,h.set(h.get()+c[f].translate))}),this.visualElement.render())}));return()=>{o(),t(),i(),l&&l()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:r=!1,dragPropagation:s=!1,dragConstraints:i=!1,dragElastic:o=Qh,dragMomentum:l=!0}=e;return{...e,drag:t,dragDirectionLock:r,dragPropagation:s,dragConstraints:i,dragElastic:o,dragMomentum:l}}}function fu(n,e,t){return(e===!0||e===n)&&(t===null||t===n)}function Tk(n,e=10){let t=null;return Math.abs(n.y)>e?t="y":Math.abs(n.x)>e&&(t="x"),t}class bk extends Is{constructor(e){super(e),this.removeGroupControls=Tt,this.removeListeners=Tt,this.controls=new Ek(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Tt}unmount(){this.removeGroupControls(),this.removeListeners()}}const kv=n=>(e,t)=>{n&&it.update(()=>n(e,t))};class wk extends Is{constructor(){super(...arguments),this.removePointerDownListener=Tt}onPointerDown(e){this.session=new RT(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:DT(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:r,onPanEnd:s}=this.node.getProps();return{onSessionStart:kv(e),onStart:kv(t),onMove:r,onEnd:(i,o)=>{delete this.session,s&&it.update(()=>s(i,o))}}}mount(){this.removePointerDownListener=jr(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}function Ak(){const n=N.useContext(Ic);if(n===null)return[!0,null];const{isPresent:e,onExitComplete:t,register:r}=n,s=N.useId();return N.useEffect(()=>r(s),[]),!e&&t?[!1,()=>t&&t(s)]:[!0]}const Fu={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function Pv(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const Zo={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if(Ce.test(n))n=parseFloat(n);else return n;const t=Pv(n,e.target.x),r=Pv(n,e.target.y);return`${t}% ${r}%`}},Lk={correct:(n,{treeScale:e,projectionDelta:t})=>{const r=n,s=ws.parse(n);if(s.length>5)return r;const i=ws.createTransformer(n),o=typeof s[0]!="number"?1:0,l=t.x.scale*e.x,c=t.y.scale*e.y;s[0+o]/=l,s[1+o]/=c;const d=ht(l,c,.5);return typeof s[2+o]=="number"&&(s[2+o]/=d),typeof s[3+o]=="number"&&(s[3+o]/=d),i(s)}};class Rk extends Ln.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:r,layoutId:s}=this.props,{projection:i}=e;NI(Ik),i&&(t.group&&t.group.add(i),r&&r.register&&s&&r.register(i),i.root.didUpdate(),i.addEventListener("animationComplete",()=>{this.safeToRemove()}),i.setOptions({...i.options,onExitComplete:()=>this.safeToRemove()})),Fu.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:r,drag:s,isPresent:i}=this.props,o=r.projection;return o&&(o.isPresent=i,s||e.layoutDependency!==t||t===void 0?o.willUpdate():this.safeToRemove(),e.isPresent!==i&&(i?o.promote():o.relegate()||it.postRender(()=>{const l=o.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),queueMicrotask(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:r}=this.props,{projection:s}=e;s&&(s.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(s),r&&r.deregister&&r.deregister(s))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function NT(n){const[e,t]=Ak(),r=N.useContext(np);return Ln.createElement(Rk,{...n,layoutGroup:r,switchLayoutGroup:N.useContext(_E),isPresent:e,safeToRemove:t})}const Ik={borderRadius:{...Zo,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Zo,borderTopRightRadius:Zo,borderBottomLeftRadius:Zo,borderBottomRightRadius:Zo,boxShadow:Lk},OT=["TopLeft","TopRight","BottomLeft","BottomRight"],_k=OT.length,Dv=n=>typeof n=="string"?parseFloat(n):n,Nv=n=>typeof n=="number"||Ce.test(n);function Ck(n,e,t,r,s,i){s?(n.opacity=ht(0,t.opacity!==void 0?t.opacity:1,kk(r)),n.opacityExit=ht(e.opacity!==void 0?e.opacity:1,0,Pk(r))):i&&(n.opacity=ht(e.opacity!==void 0?e.opacity:1,t.opacity!==void 0?t.opacity:1,r));for(let o=0;o<_k;o++){const l=`border${OT[o]}Radius`;let c=Ov(e,l),d=Ov(t,l);if(c===void 0&&d===void 0)continue;c||(c=0),d||(d=0),c===0||d===0||Nv(c)===Nv(d)?(n[l]=Math.max(ht(Dv(c),Dv(d),r),0),(gr.test(d)||gr.test(c))&&(n[l]+="%")):n[l]=d}(e.rotate||t.rotate)&&(n.rotate=ht(e.rotate||0,t.rotate||0,r))}function Ov(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const kk=MT(0,.5,sT),Pk=MT(.5,.95,Tt);function MT(n,e,t){return r=>r<n?0:r>e?1:t(Sa(n,e,r))}function Mv(n,e){n.min=e.min,n.max=e.max}function Fn(n,e){Mv(n.x,e.x),Mv(n.y,e.y)}function Fv(n,e,t,r,s){return n-=e,n=rc(n,1/t,r),s!==void 0&&(n=rc(n,1/s,r)),n}function Dk(n,e=0,t=1,r=.5,s,i=n,o=n){if(gr.test(e)&&(e=parseFloat(e),e=ht(o.min,o.max,e/100)-o.min),typeof e!="number")return;let l=ht(i.min,i.max,r);n===i&&(l-=e),n.min=Fv(n.min,e,t,l,s),n.max=Fv(n.max,e,t,l,s)}function Bv(n,e,[t,r,s],i,o){Dk(n,e[t],e[r],e[s],e.scale,i,o)}const Nk=["x","scaleX","originX"],Ok=["y","scaleY","originY"];function Uv(n,e,t,r){Bv(n.x,e,Nk,t?t.x:void 0,r?r.x:void 0),Bv(n.y,e,Ok,t?t.y:void 0,r?r.y:void 0)}function $v(n){return n.translate===0&&n.scale===1}function FT(n){return $v(n.x)&&$v(n.y)}function Mk(n,e){return n.x.min===e.x.min&&n.x.max===e.x.max&&n.y.min===e.y.min&&n.y.max===e.y.max}function BT(n,e){return Math.round(n.x.min)===Math.round(e.x.min)&&Math.round(n.x.max)===Math.round(e.x.max)&&Math.round(n.y.min)===Math.round(e.y.min)&&Math.round(n.y.max)===Math.round(e.y.max)}function jv(n){return In(n.x)/In(n.y)}class Fk{constructor(){this.members=[]}add(e){yp(this.members,e),e.scheduleRender()}remove(e){if(vp(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const t=this.members[this.members.length-1];t&&this.promote(t)}}relegate(e){const t=this.members.findIndex(s=>e===s);if(t===0)return!1;let r;for(let s=t;s>=0;s--){const i=this.members[s];if(i.isPresent!==!1){r=i;break}}return r?(this.promote(r),!0):!1}promote(e,t){const r=this.lead;if(e!==r&&(this.prevLead=r,this.lead=e,e.show(),r)){r.instance&&r.scheduleRender(),e.scheduleRender(),e.resumeFrom=r,t&&(e.resumeFrom.preserveOpacity=!0),r.snapshot&&(e.snapshot=r.snapshot,e.snapshot.latestValues=r.animationValues||r.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:s}=e.options;s===!1&&r.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:r}=e;t.onExitComplete&&t.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function Vv(n,e,t){let r="";const s=n.x.translate/e.x,i=n.y.translate/e.y;if((s||i)&&(r=`translate3d(${s}px, ${i}px, 0) `),(e.x!==1||e.y!==1)&&(r+=`scale(${1/e.x}, ${1/e.y}) `),t){const{rotate:c,rotateX:d,rotateY:f}=t;c&&(r+=`rotate(${c}deg) `),d&&(r+=`rotateX(${d}deg) `),f&&(r+=`rotateY(${f}deg) `)}const o=n.x.scale*e.x,l=n.y.scale*e.y;return(o!==1||l!==1)&&(r+=`scale(${o}, ${l})`),r||"none"}const Bk=(n,e)=>n.depth-e.depth;class Uk{constructor(){this.children=[],this.isDirty=!1}add(e){yp(this.children,e),this.isDirty=!0}remove(e){vp(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(Bk),this.isDirty=!1,this.children.forEach(e)}}function $k(n,e){const t=performance.now(),r=({timestamp:s})=>{const i=s-t;i>=e&&(Kr(r),n(i-e))};return it.read(r,!0),()=>Kr(r)}function jk(n){window.MotionDebug&&window.MotionDebug.record(n)}function Vk(n){return n instanceof SVGElement&&n.tagName!=="svg"}function Gk(n,e,t){const r=fn(n)?n:Yi(n);return r.start(gp("",r,e,t)),r.animation}const Gv=["","X","Y","Z"],Hk={visibility:"hidden"},Hv=1e3;let Kk=0;const Ws={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function UT({attachResizeListener:n,defaultParent:e,measureScroll:t,checkIsScrollRoot:r,resetTransform:s}){return class{constructor(o={},l=e?.()){this.id=Kk++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Ws.totalNodes=Ws.resolvedTargetDeltas=Ws.recalculatedProjection=0,this.nodes.forEach(Yk),this.nodes.forEach(Zk),this.nodes.forEach(eP),this.nodes.forEach(qk),jk(Ws)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new Uk)}addEventListener(o,l){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new xp),this.eventHandlers.get(o).add(l)}notifyListeners(o,...l){const c=this.eventHandlers.get(o);c&&c.notify(...l)}hasListeners(o){return this.eventHandlers.has(o)}mount(o,l=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=Vk(o),this.instance=o;const{layoutId:c,layout:d,visualElement:f}=this.options;if(f&&!f.current&&f.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),l&&(d||c)&&(this.isLayoutDirty=!0),n){let h;const p=()=>this.root.updateBlockedByResize=!1;n(o,()=>{this.root.updateBlockedByResize=!0,h&&h(),h=$k(p,250),Fu.hasAnimatedSinceResize&&(Fu.hasAnimatedSinceResize=!1,this.nodes.forEach(zv))})}c&&this.root.registerSharedNode(c,this),this.options.animate!==!1&&f&&(c||d)&&this.addEventListener("didUpdate",({delta:h,hasLayoutChanged:p,hasRelativeTargetChanged:v,layout:g})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const S=this.options.transition||f.getDefaultTransition()||iP,{onLayoutAnimationStart:x,onLayoutAnimationComplete:b}=f.getProps(),A=!this.targetLayout||!BT(this.targetLayout,g)||v,L=!p&&v;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||L||p&&(A||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(h,L);const I={...pp(S,"layout"),onPlay:x,onComplete:b};(f.shouldReduceMotion||this.options.layoutRoot)&&(I.delay=0,I.type=!1),this.startAnimation(I)}else p||zv(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=g})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Kr(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(tP),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let f=0;f<this.path.length;f++){const h=this.path[f];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:l,layout:c}=this.options;if(l===void 0&&!c)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(Kv);return}this.isUpdating||this.nodes.forEach(Qk),this.isUpdating=!1,this.nodes.forEach(Jk),this.nodes.forEach(zk),this.nodes.forEach(Wk),this.clearAllSnapshots();const l=performance.now();Kt.delta=bs(0,1e3/60,l-Kt.timestamp),Kt.timestamp=l,Kt.isProcessing=!0,Hf.update.process(Kt),Hf.preRender.process(Kt),Hf.render.process(Kt),Kt.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,queueMicrotask(()=>this.update()))}clearAllSnapshots(){this.nodes.forEach(Xk),this.sharedNodes.forEach(nP)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,it.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){it.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutCorrected=At(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let l=!!(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(l=!1),l&&(this.scroll={animationId:this.root.animationId,phase:o,isRoot:r(this.instance),offset:t(this.instance)})}resetTransform(){if(!s)return;const o=this.isLayoutDirty||this.shouldResetTransform,l=this.projectionDelta&&!FT(this.projectionDelta),c=this.getTransformTemplate(),d=c?c(this.latestValues,""):void 0,f=d!==this.prevTransformTemplateValue;o&&(l||zs(this.latestValues)||f)&&(s(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const l=this.measurePageBox();let c=this.removeElementScroll(l);return o&&(c=this.removeTransform(c)),oP(c),{animationId:this.root.animationId,measuredBox:l,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:o}=this.options;if(!o)return At();const l=o.measureViewportBox(),{scroll:c}=this.root;return c&&(gs(l.x,c.offset.x),gs(l.y,c.offset.y)),l}removeElementScroll(o){const l=At();Fn(l,o);for(let c=0;c<this.path.length;c++){const d=this.path[c],{scroll:f,options:h}=d;if(d!==this.root&&f&&h.layoutScroll){if(f.isRoot){Fn(l,o);const{scroll:p}=this.root;p&&(gs(l.x,-p.offset.x),gs(l.y,-p.offset.y))}gs(l.x,f.offset.x),gs(l.y,f.offset.y)}}return l}applyTransform(o,l=!1){const c=At();Fn(c,o);for(let d=0;d<this.path.length;d++){const f=this.path[d];!l&&f.options.layoutScroll&&f.scroll&&f!==f.root&&Vi(c,{x:-f.scroll.offset.x,y:-f.scroll.offset.y}),zs(f.latestValues)&&Vi(c,f.latestValues)}return zs(this.latestValues)&&Vi(c,this.latestValues),c}removeTransform(o){const l=At();Fn(l,o);for(let c=0;c<this.path.length;c++){const d=this.path[c];if(!d.instance||!zs(d.latestValues))continue;Jh(d.latestValues)&&d.updateSnapshot();const f=At(),h=d.measurePageBox();Fn(f,h),Uv(l,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,f)}return zs(this.latestValues)&&Uv(l,this.latestValues),l}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Kt.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){var l;const c=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=c.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=c.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=c.isSharedProjectionDirty);const d=!!this.resumingFrom||this!==c;if(!(o||d&&this.isSharedProjectionDirty||this.isProjectionDirty||!((l=this.parent)===null||l===void 0)&&l.isProjectionDirty||this.attemptToResolveRelativeTarget))return;const{layout:h,layoutId:p}=this.options;if(!(!this.layout||!(h||p))){if(this.resolvedRelativeTargetAt=Kt.timestamp,!this.targetDelta&&!this.relativeTarget){const v=this.getClosestProjectingParent();v&&v.layout&&this.animationProgress!==1?(this.relativeParent=v,this.forceRelativeParentToResolveTarget(),this.relativeTarget=At(),this.relativeTargetOrigin=At(),ca(this.relativeTargetOrigin,this.layout.layoutBox,v.layout.layoutBox),Fn(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=At(),this.targetWithTransforms=At()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),ak(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Fn(this.target,this.layout.layoutBox),kT(this.target,this.targetDelta)):Fn(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const v=this.getClosestProjectingParent();v&&!!v.resumingFrom==!!this.resumingFrom&&!v.options.layoutScroll&&v.target&&this.animationProgress!==1?(this.relativeParent=v,this.forceRelativeParentToResolveTarget(),this.relativeTarget=At(),this.relativeTargetOrigin=At(),ca(this.relativeTargetOrigin,this.target,v.target),Fn(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Ws.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||Jh(this.parent.latestValues)||CT(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var o;const l=this.getLead(),c=!!this.resumingFrom||this!==l;let d=!0;if((this.isProjectionDirty||!((o=this.parent)===null||o===void 0)&&o.isProjectionDirty)&&(d=!1),c&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(d=!1),this.resolvedRelativeTargetAt===Kt.timestamp&&(d=!1),d)return;const{layout:f,layoutId:h}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(f||h))return;Fn(this.layoutCorrected,this.layout.layoutBox);const p=this.treeScale.x,v=this.treeScale.y;gk(this.layoutCorrected,this.treeScale,this.path,c),l.layout&&!l.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(l.target=l.layout.layoutBox);const{target:g}=l;if(!g){this.projectionTransform&&(this.projectionDelta=ji(),this.projectionTransform="none",this.scheduleRender());return}this.projectionDelta||(this.projectionDelta=ji(),this.projectionDeltaWithTransform=ji());const S=this.projectionTransform;ua(this.projectionDelta,this.layoutCorrected,g,this.latestValues),this.projectionTransform=Vv(this.projectionDelta,this.treeScale),(this.projectionTransform!==S||this.treeScale.x!==p||this.treeScale.y!==v)&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",g)),Ws.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){if(this.options.scheduleRender&&this.options.scheduleRender(),o){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(o,l=!1){const c=this.snapshot,d=c?c.latestValues:{},f={...this.latestValues},h=ji();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const p=At(),v=c?c.source:void 0,g=this.layout?this.layout.source:void 0,S=v!==g,x=this.getStack(),b=!x||x.members.length<=1,A=!!(S&&!b&&this.options.crossfade===!0&&!this.path.some(sP));this.animationProgress=0;let L;this.mixTargetDelta=I=>{const k=I/1e3;Wv(h.x,o.x,k),Wv(h.y,o.y,k),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(ca(p,this.layout.layoutBox,this.relativeParent.layout.layoutBox),rP(this.relativeTarget,this.relativeTargetOrigin,p,k),L&&Mk(this.relativeTarget,L)&&(this.isProjectionDirty=!1),L||(L=At()),Fn(L,this.relativeTarget)),S&&(this.animationValues=f,Ck(f,d,this.latestValues,k,A,b)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=k},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Kr(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=it.update(()=>{Fu.hasAnimatedSinceResize=!0,this.currentAnimation=Gk(0,Hv,{...o,onUpdate:l=>{this.mixTargetDelta(l),o.onUpdate&&o.onUpdate(l)},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Hv),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:l,target:c,layout:d,latestValues:f}=o;if(!(!l||!c||!d)){if(this!==o&&this.layout&&d&&$T(this.options.animationType,this.layout.layoutBox,d.layoutBox)){c=this.target||At();const h=In(this.layout.layoutBox.x);c.x.min=o.target.x.min,c.x.max=c.x.min+h;const p=In(this.layout.layoutBox.y);c.y.min=o.target.y.min,c.y.max=c.y.min+p}Fn(l,c),Vi(l,f),ua(this.projectionDeltaWithTransform,this.layoutCorrected,l,f)}}registerSharedNode(o,l){this.sharedNodes.has(o)||this.sharedNodes.set(o,new Fk),this.sharedNodes.get(o).add(l);const d=l.options.initialPromotionConfig;l.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(l):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){var o;const{layoutId:l}=this.options;return l?((o=this.getStack())===null||o===void 0?void 0:o.lead)||this:this}getPrevLead(){var o;const{layoutId:l}=this.options;return l?(o=this.getStack())===null||o===void 0?void 0:o.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:l,preserveFollowOpacity:c}={}){const d=this.getStack();d&&d.promote(this,c),o&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetRotation(){const{visualElement:o}=this.options;if(!o)return;let l=!1;const{latestValues:c}=o;if((c.rotate||c.rotateX||c.rotateY||c.rotateZ)&&(l=!0),!l)return;const d={};for(let f=0;f<Gv.length;f++){const h="rotate"+Gv[f];c[h]&&(d[h]=c[h],o.setStaticValue(h,0))}o.render();for(const f in d)o.setStaticValue(f,d[f]);o.scheduleRender()}getProjectionStyles(o){var l,c;if(!this.instance||this.isSVG)return;if(!this.isVisible)return Hk;const d={visibility:""},f=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,d.opacity="",d.pointerEvents=Mu(o?.pointerEvents)||"",d.transform=f?f(this.latestValues,""):"none",d;const h=this.getLead();if(!this.projectionDelta||!this.layout||!h.target){const S={};return this.options.layoutId&&(S.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,S.pointerEvents=Mu(o?.pointerEvents)||""),this.hasProjected&&!zs(this.latestValues)&&(S.transform=f?f({},""):"none",this.hasProjected=!1),S}const p=h.animationValues||h.latestValues;this.applyTransformsToTarget(),d.transform=Vv(this.projectionDeltaWithTransform,this.treeScale,p),f&&(d.transform=f(p,d.transform));const{x:v,y:g}=this.projectionDelta;d.transformOrigin=`${v.origin*100}% ${g.origin*100}% 0`,h.animationValues?d.opacity=h===this?(c=(l=p.opacity)!==null&&l!==void 0?l:this.latestValues.opacity)!==null&&c!==void 0?c:1:this.preserveOpacity?this.latestValues.opacity:p.opacityExit:d.opacity=h===this?p.opacity!==void 0?p.opacity:"":p.opacityExit!==void 0?p.opacityExit:0;for(const S in Xu){if(p[S]===void 0)continue;const{correct:x,applyTo:b}=Xu[S],A=d.transform==="none"?p[S]:x(p[S],h);if(b){const L=b.length;for(let I=0;I<L;I++)d[b[I]]=A}else d[S]=A}return this.options.layoutId&&(d.pointerEvents=h===this?Mu(o?.pointerEvents)||"":"none"),d}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>{var l;return(l=o.currentAnimation)===null||l===void 0?void 0:l.stop()}),this.root.nodes.forEach(Kv),this.root.sharedNodes.clear()}}}function zk(n){n.updateLayout()}function Wk(n){var e;const t=((e=n.resumeFrom)===null||e===void 0?void 0:e.snapshot)||n.snapshot;if(n.isLead()&&n.layout&&t&&n.hasListeners("didUpdate")){const{layoutBox:r,measuredBox:s}=n.layout,{animationType:i}=n.options,o=t.source!==n.layout.source;i==="size"?Bn(h=>{const p=o?t.measuredBox[h]:t.layoutBox[h],v=In(p);p.min=r[h].min,p.max=p.min+v}):$T(i,t.layoutBox,r)&&Bn(h=>{const p=o?t.measuredBox[h]:t.layoutBox[h],v=In(r[h]);p.max=p.min+v,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[h].max=n.relativeTarget[h].min+v)});const l=ji();ua(l,r,t.layoutBox);const c=ji();o?ua(c,n.applyTransform(s,!0),t.measuredBox):ua(c,r,t.layoutBox);const d=!FT(l);let f=!1;if(!n.resumeFrom){const h=n.getClosestProjectingParent();if(h&&!h.resumeFrom){const{snapshot:p,layout:v}=h;if(p&&v){const g=At();ca(g,t.layoutBox,p.layoutBox);const S=At();ca(S,r,v.layoutBox),BT(g,S)||(f=!0),h.options.layoutRoot&&(n.relativeTarget=S,n.relativeTargetOrigin=g,n.relativeParent=h)}}}n.notifyListeners("didUpdate",{layout:r,snapshot:t,delta:c,layoutDelta:l,hasLayoutChanged:d,hasRelativeTargetChanged:f})}else if(n.isLead()){const{onExitComplete:r}=n.options;r&&r()}n.options.transition=void 0}function Yk(n){Ws.totalNodes++,n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function qk(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function Xk(n){n.clearSnapshot()}function Kv(n){n.clearMeasurements()}function Qk(n){n.isLayoutDirty=!1}function Jk(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function zv(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function Zk(n){n.resolveTargetDelta()}function eP(n){n.calcProjection()}function tP(n){n.resetRotation()}function nP(n){n.removeLeadSnapshot()}function Wv(n,e,t){n.translate=ht(e.translate,0,t),n.scale=ht(e.scale,1,t),n.origin=e.origin,n.originPoint=e.originPoint}function Yv(n,e,t,r){n.min=ht(e.min,t.min,r),n.max=ht(e.max,t.max,r)}function rP(n,e,t,r){Yv(n.x,e.x,t.x,r),Yv(n.y,e.y,t.y,r)}function sP(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const iP={duration:.45,ease:[.4,0,.1,1]},qv=n=>typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes(n),Xv=qv("applewebkit/")&&!qv("chrome/")?Math.round:Tt;function Qv(n){n.min=Xv(n.min),n.max=Xv(n.max)}function oP(n){Qv(n.x),Qv(n.y)}function $T(n,e,t){return n==="position"||n==="preserve-aspect"&&!Xh(jv(e),jv(t),.2)}const aP=UT({attachResizeListener:(n,e)=>Ur(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),th={current:void 0},jT=UT({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!th.current){const n=new aP({});n.mount(window),n.setOptions({layoutScroll:!0}),th.current=n}return th.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),lP={pan:{Feature:wk},drag:{Feature:bk,ProjectionNode:jT,MeasureLayout:NT}},uP=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/;function cP(n){const e=uP.exec(n);if(!e)return[,];const[,t,r]=e;return[t,r]}function em(n,e,t=1){const[r,s]=cP(n);if(!r)return;const i=window.getComputedStyle(e).getPropertyValue(r);if(i){const o=i.trim();return bT(o)?parseFloat(o):o}else return Gh(s)?em(s,e,t+1):s}function dP(n,{...e},t){const r=n.current;if(!(r instanceof Element))return{target:e,transitionEnd:t};t&&(t={...t}),n.values.forEach(s=>{const i=s.get();if(!Gh(i))return;const o=em(i,r);o&&s.set(o)});for(const s in e){const i=e[s];if(!Gh(i))continue;const o=em(i,r);o&&(e[s]=o,t||(t={}),t[s]===void 0&&(t[s]=i))}return{target:e,transitionEnd:t}}const fP=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),VT=n=>fP.has(n),hP=n=>Object.keys(n).some(VT),Jv=n=>n===ui||n===Ce,Zv=(n,e)=>parseFloat(n.split(", ")[e]),ex=(n,e)=>(t,{transform:r})=>{if(r==="none"||!r)return 0;const s=r.match(/^matrix3d\((.+)\)$/);if(s)return Zv(s[1],e);{const i=r.match(/^matrix\((.+)\)$/);return i?Zv(i[1],n):0}},mP=new Set(["x","y","z"]),pP=$a.filter(n=>!mP.has(n));function gP(n){const e=[];return pP.forEach(t=>{const r=n.getValue(t);r!==void 0&&(e.push([t,r.get()]),r.set(t.startsWith("scale")?1:0))}),e.length&&n.render(),e}const qi={width:({x:n},{paddingLeft:e="0",paddingRight:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),height:({y:n},{paddingTop:e="0",paddingBottom:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:ex(4,13),y:ex(5,14)};qi.translateX=qi.x;qi.translateY=qi.y;const yP=(n,e,t)=>{const r=e.measureViewportBox(),s=e.current,i=getComputedStyle(s),{display:o}=i,l={};o==="none"&&e.setStaticValue("display",n.display||"block"),t.forEach(d=>{l[d]=qi[d](r,i)}),e.render();const c=e.measureViewportBox();return t.forEach(d=>{const f=e.getValue(d);f&&f.jump(l[d]),n[d]=qi[d](c,i)}),n},vP=(n,e,t={},r={})=>{e={...e},r={...r};const s=Object.keys(e).filter(VT);let i=[],o=!1;const l=[];if(s.forEach(c=>{const d=n.getValue(c);if(!n.hasValue(c))return;let f=t[c],h=Jo(f);const p=e[c];let v;if(Ju(p)){const g=p.length,S=p[0]===null?1:0;f=p[S],h=Jo(f);for(let x=S;x<g&&p[x]!==null;x++)v?cp(Jo(p[x])===v):v=Jo(p[x])}else v=Jo(p);if(h!==v)if(Jv(h)&&Jv(v)){const g=d.get();typeof g=="string"&&d.set(parseFloat(g)),typeof p=="string"?e[c]=parseFloat(p):Array.isArray(p)&&v===Ce&&(e[c]=p.map(parseFloat))}else h?.transform&&v?.transform&&(f===0||p===0)?f===0?d.set(v.transform(f)):e[c]=h.transform(p):(o||(i=gP(n),o=!0),l.push(c),r[c]=r[c]!==void 0?r[c]:e[c],d.jump(p))}),l.length){const c=l.indexOf("height")>=0?window.pageYOffset:null,d=yP(e,n,l);return i.length&&i.forEach(([f,h])=>{n.getValue(f).set(h)}),n.render(),_c&&c!==null&&window.scrollTo({top:c}),{target:d,transitionEnd:r}}else return{target:e,transitionEnd:r}};function xP(n,e,t,r){return hP(e)?vP(n,e,t,r):{target:e,transitionEnd:r}}const SP=(n,e,t,r)=>{const s=dP(n,e,r);return e=s.target,r=s.transitionEnd,xP(n,e,t,r)},tm={current:null},GT={current:!1};function EP(){if(GT.current=!0,!!_c)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>tm.current=n.matches;n.addListener(e),e()}else tm.current=!1}function TP(n,e,t){const{willChange:r}=e;for(const s in e){const i=e[s],o=t[s];if(fn(i))n.addValue(s,i),nc(r)&&r.add(s);else if(fn(o))n.addValue(s,Yi(i,{owner:n})),nc(r)&&r.remove(s);else if(o!==i)if(n.hasValue(s)){const l=n.getValue(s);!l.hasAnimated&&l.set(i)}else{const l=n.getStaticValue(s);n.addValue(s,Yi(l!==void 0?l:i,{owner:n}))}}for(const s in t)e[s]===void 0&&n.removeValue(s);return e}const tx=new WeakMap,HT=Object.keys(xa),bP=HT.length,nx=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],wP=tp.length;class AP{constructor({parent:e,props:t,presenceContext:r,reducedMotionConfig:s,visualState:i},o={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>it.render(this.render,!1,!0);const{latestValues:l,renderState:c}=i;this.latestValues=l,this.baseTarget={...l},this.initialValues=t.initial?{...l}:{},this.renderState=c,this.parent=e,this.props=t,this.presenceContext=r,this.depth=e?e.depth+1:0,this.reducedMotionConfig=s,this.options=o,this.isControllingVariants=kc(t),this.isVariantNode=IE(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:d,...f}=this.scrapeMotionValuesFromProps(t,{});for(const h in f){const p=f[h];l[h]!==void 0&&fn(p)&&(p.set(l[h],!1),nc(d)&&d.add(h))}}scrapeMotionValuesFromProps(e,t){return{}}mount(e){this.current=e,tx.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((t,r)=>this.bindToMotionValue(r,t)),GT.current||EP(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:tm.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){tx.delete(this.current),this.projection&&this.projection.unmount(),Kr(this.notifyUpdate),Kr(this.render),this.valueSubscriptions.forEach(e=>e()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features)this.features[e].unmount();this.current=null}bindToMotionValue(e,t){const r=li.has(e),s=t.on("change",o=>{this.latestValues[e]=o,this.props.onUpdate&&it.update(this.notifyUpdate,!1,!0),r&&this.projection&&(this.projection.isTransformDirty=!0)}),i=t.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(e,()=>{s(),i()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}loadFeatures({children:e,...t},r,s,i){let o,l;for(let c=0;c<bP;c++){const d=HT[c],{isEnabled:f,Feature:h,ProjectionNode:p,MeasureLayout:v}=xa[d];p&&(o=p),f(t)&&(!this.features[d]&&h&&(this.features[d]=new h(this)),v&&(l=v))}if((this.type==="html"||this.type==="svg")&&!this.projection&&o){this.projection=new o(this.latestValues,this.parent&&this.parent.projection);const{layoutId:c,layout:d,drag:f,dragConstraints:h,layoutScroll:p,layoutRoot:v}=t;this.projection.setOptions({layoutId:c,layout:d,alwaysMeasureLayout:!!f||h&&Ui(h),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:typeof d=="string"?d:"both",initialPromotionConfig:i,layoutScroll:p,layoutRoot:v})}return l}updateFeatures(){for(const e in this.features){const t=this.features[e];t.isMounted?t.update():(t.mount(),t.isMounted=!0)}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):At()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}makeTargetAnimatable(e,t=!0){return this.makeTargetAnimatableFromInstance(e,this.props,t)}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let r=0;r<nx.length;r++){const s=nx[r];this.propEventSubscriptions[s]&&(this.propEventSubscriptions[s](),delete this.propEventSubscriptions[s]);const i=e["on"+s];i&&(this.propEventSubscriptions[s]=this.on(s,i))}this.prevMotionValues=TP(this,this.scrapeMotionValuesFromProps(e,this.prevProps),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(e=!1){if(e)return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const r=this.parent?this.parent.getVariantContext()||{}:{};return this.props.initial!==void 0&&(r.initial=this.props.initial),r}const t={};for(let r=0;r<wP;r++){const s=tp[r],i=this.props[s];(va(i)||i===!1)&&(t[s]=i)}return t}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){t!==this.values.get(e)&&(this.removeValue(e),this.bindToMotionValue(e,t)),this.values.set(e,t),this.latestValues[e]=t.get()}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let r=this.values.get(e);return r===void 0&&t!==void 0&&(r=Yi(t,{owner:this}),this.addValue(e,r)),r}readValue(e){var t;return this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(t=this.getBaseTargetFromProps(this.props,e))!==null&&t!==void 0?t:this.readValueFromInstance(this.current,e,this.options)}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){var t;const{initial:r}=this.props,s=typeof r=="string"||typeof r=="object"?(t=up(this.props,r))===null||t===void 0?void 0:t[e]:void 0;if(r&&s!==void 0)return s;const i=this.getBaseTargetFromProps(this.props,e);return i!==void 0&&!fn(i)?i:this.initialValues[e]!==void 0&&s===void 0?void 0:this.baseTarget[e]}on(e,t){return this.events[e]||(this.events[e]=new xp),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}}class KT extends AP{sortInstanceNodePosition(e,t){return e.compareDocumentPosition(t)&2?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:r}){delete t[e],delete r[e]}makeTargetAnimatableFromInstance({transition:e,transitionEnd:t,...r},{transformValues:s},i){let o=VC(r,e||{},this);if(s&&(t&&(t=s(t)),r&&(r=s(r)),o&&(o=s(o))),i){$C(this,r,o);const l=SP(this,r,o,t);t=l.transitionEnd,r=l.target}return{transition:e,transitionEnd:t,...r}}}function LP(n){return window.getComputedStyle(n)}class RP extends KT{constructor(){super(...arguments),this.type="html"}readValueFromInstance(e,t){if(li.has(t)){const r=mp(t);return r&&r.default||0}else{const r=LP(e),s=(PE(t)?r.getPropertyValue(t):r[t])||0;return typeof s=="string"?s.trim():s}}measureInstanceViewportBox(e,{transformPagePoint:t}){return PT(e,t)}build(e,t,r,s){sp(e,t,r,s.transformTemplate)}scrapeMotionValuesFromProps(e,t){return lp(e,t)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;fn(e)&&(this.childSubscription=e.on("change",t=>{this.current&&(this.current.textContent=`${t}`)}))}renderInstance(e,t,r,s){BE(e,t,r,s)}}class IP extends KT{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(li.has(t)){const r=mp(t);return r&&r.default||0}return t=UE.has(t)?t:Zm(t),e.getAttribute(t)}measureInstanceViewportBox(){return At()}scrapeMotionValuesFromProps(e,t){return jE(e,t)}build(e,t,r,s){op(e,t,r,this.isSVGTag,s.transformTemplate)}renderInstance(e,t,r,s){$E(e,t,r,s)}mount(e){this.isSVGTag=ap(e.tagName),super.mount(e)}}const _P=(n,e)=>rp(n)?new IP(e,{enableHardwareAcceleration:!1}):new RP(e,{enableHardwareAcceleration:!0}),CP={layout:{ProjectionNode:jT,MeasureLayout:NT}},kP={...rk,...b_,...lP,...CP},Xi=PI((n,e)=>c_(n,e,kP,_P));function zT(){const n=N.useRef(!1);return Jm(()=>(n.current=!0,()=>{n.current=!1}),[]),n}function PP(){const n=zT(),[e,t]=N.useState(0),r=N.useCallback(()=>{n.current&&t(e+1)},[e]);return[N.useCallback(()=>it.postRender(r),[r]),e]}class DP extends N.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const r=this.props.sizeRef.current;r.height=t.offsetHeight||0,r.width=t.offsetWidth||0,r.top=t.offsetTop,r.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function NP({children:n,isPresent:e}){const t=N.useId(),r=N.useRef(null),s=N.useRef({width:0,height:0,top:0,left:0});return N.useInsertionEffect(()=>{const{width:i,height:o,top:l,left:c}=s.current;if(e||!r.current||!i||!o)return;r.current.dataset.motionPopId=t;const d=document.createElement("style");return document.head.appendChild(d),d.sheet&&d.sheet.insertRule(`
          [data-motion-pop-id="${t}"] {
            position: absolute !important;
            width: ${i}px !important;
            height: ${o}px !important;
            top: ${l}px !important;
            left: ${c}px !important;
          }
        `),()=>{document.head.removeChild(d)}},[e]),N.createElement(DP,{isPresent:e,childRef:r,sizeRef:s},N.cloneElement(n,{ref:r}))}const nh=({children:n,initial:e,isPresent:t,onExitComplete:r,custom:s,presenceAffectsLayout:i,mode:o})=>{const l=VE(OP),c=N.useId(),d=N.useMemo(()=>({id:c,initial:e,isPresent:t,custom:s,onExitComplete:f=>{l.set(f,!0);for(const h of l.values())if(!h)return;r&&r()},register:f=>(l.set(f,!1),()=>l.delete(f))}),i?void 0:[t]);return N.useMemo(()=>{l.forEach((f,h)=>l.set(h,!1))},[t]),N.useEffect(()=>{!t&&!l.size&&r&&r()},[t]),o==="popLayout"&&(n=N.createElement(NP,{isPresent:t},n)),N.createElement(Ic.Provider,{value:d},n)};function OP(){return new Map}function MP(n){return N.useEffect(()=>()=>n(),[])}const Ys=n=>n.key||"";function FP(n,e){n.forEach(t=>{const r=Ys(t);e.set(r,t)})}function BP(n){const e=[];return N.Children.forEach(n,t=>{N.isValidElement(t)&&e.push(t)}),e}const Ea=({children:n,custom:e,initial:t=!0,onExitComplete:r,exitBeforeEnter:s,presenceAffectsLayout:i=!0,mode:o="sync"})=>{const l=N.useContext(np).forceRender||PP()[0],c=zT(),d=BP(n);let f=d;const h=N.useRef(new Map).current,p=N.useRef(f),v=N.useRef(new Map).current,g=N.useRef(!0);if(Jm(()=>{g.current=!1,FP(d,v),p.current=f}),MP(()=>{g.current=!0,v.clear(),h.clear()}),g.current)return N.createElement(N.Fragment,null,f.map(A=>N.createElement(nh,{key:Ys(A),isPresent:!0,initial:t?void 0:!1,presenceAffectsLayout:i,mode:o},A)));f=[...f];const S=p.current.map(Ys),x=d.map(Ys),b=S.length;for(let A=0;A<b;A++){const L=S[A];x.indexOf(L)===-1&&!h.has(L)&&h.set(L,void 0)}return o==="wait"&&h.size&&(f=[]),h.forEach((A,L)=>{if(x.indexOf(L)!==-1)return;const I=v.get(L);if(!I)return;const k=S.indexOf(L);let F=A;if(!F){const C=()=>{h.delete(L);const P=Array.from(v.keys()).filter(O=>!x.includes(O));if(P.forEach(O=>v.delete(O)),p.current=d.filter(O=>{const M=Ys(O);return M===L||P.includes(M)}),!h.size){if(c.current===!1)return;l(),r&&r()}};F=N.createElement(nh,{key:Ys(I),isPresent:!1,onExitComplete:C,custom:e,presenceAffectsLayout:i,mode:o},I),h.set(L,F)}f.splice(k,0,F)}),f=f.map(A=>{const L=A.key;return h.has(L)?A:N.createElement(nh,{key:Ys(A),isPresent:!0,presenceAffectsLayout:i,mode:o},A)}),N.createElement(N.Fragment,null,h.size?f:f.map(A=>N.cloneElement(A)))};var WT={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},rx=Ln.createContext&&Ln.createContext(WT),Es=function(){return Es=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=e[s])}return n},Es.apply(this,arguments)},UP=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};function YT(n){return n&&n.map(function(e,t){return Ln.createElement(e.tag,Es({key:t},e.attr),YT(e.child))})}function He(n){return function(e){return Ln.createElement($P,Es({attr:Es({},n.attr)},e),YT(n.child))}}function $P(n){var e=function(t){var r=n.attr,s=n.size,i=n.title,o=UP(n,["attr","size","title"]),l=s||t.size||"1em",c;return t.className&&(c=t.className),n.className&&(c=(c?c+" ":"")+n.className),Ln.createElement("svg",Es({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,o,{className:c,style:Es(Es({color:n.color||t.color},t.style),n.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),i&&Ln.createElement("title",null,i),n.children)};return rx!==void 0?Ln.createElement(rx.Consumer,null,function(t){return e(t)}):e(WT)}function sc(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"5",y1:"12",x2:"19",y2:"12"}},{tag:"polyline",attr:{points:"12 5 19 12 12 19"}}]})(n)}function jP(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}},{tag:"path",attr:{d:"M13.73 21a2 2 0 0 1-3.46 0"}}]})(n)}function VP(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"line",attr:{x1:"16",y1:"2",x2:"16",y2:"6"}},{tag:"line",attr:{x1:"8",y1:"2",x2:"8",y2:"6"}},{tag:"line",attr:{x1:"3",y1:"10",x2:"21",y2:"10"}}]})(n)}function nm(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"20 6 9 17 4 12"}}]})(n)}function ic(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"6 9 12 15 18 9"}}]})(n)}function GP(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"15 18 9 12 15 6"}}]})(n)}function HP(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"9 18 15 12 9 6"}}]})(n)}function Sp(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"polyline",attr:{points:"12 6 12 12 16 14"}}]})(n)}function qT(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}},{tag:"polyline",attr:{points:"7 10 12 15 17 10"}},{tag:"line",attr:{x1:"12",y1:"15",x2:"12",y2:"3"}}]})(n)}function rm(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"}},{tag:"line",attr:{x1:"1",y1:"1",x2:"23",y2:"23"}}]})(n)}function sm(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}},{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}}]})(n)}function Oc(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"2",y:"2",width:"20",height:"20",rx:"2.18",ry:"2.18"}},{tag:"line",attr:{x1:"7",y1:"2",x2:"7",y2:"22"}},{tag:"line",attr:{x1:"17",y1:"2",x2:"17",y2:"22"}},{tag:"line",attr:{x1:"2",y1:"12",x2:"22",y2:"12"}},{tag:"line",attr:{x1:"2",y1:"7",x2:"7",y2:"7"}},{tag:"line",attr:{x1:"2",y1:"17",x2:"7",y2:"17"}},{tag:"line",attr:{x1:"17",y1:"17",x2:"22",y2:"17"}},{tag:"line",attr:{x1:"17",y1:"7",x2:"22",y2:"7"}}]})(n)}function XT(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"}}]})(n)}function KP(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}},{tag:"polyline",attr:{points:"9 22 9 12 15 12 15 22"}}]})(n)}function zP(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"12",y1:"16",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12.01",y2:"8"}}]})(n)}function QT(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}},{tag:"polyline",attr:{points:"16 17 21 12 16 7"}},{tag:"line",attr:{x1:"21",y1:"12",x2:"9",y2:"12"}}]})(n)}function JT(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"}},{tag:"polyline",attr:{points:"22,6 12,13 2,6"}}]})(n)}function WP(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"}}]})(n)}function YP(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"3",y1:"12",x2:"21",y2:"12"}},{tag:"line",attr:{x1:"3",y1:"6",x2:"21",y2:"6"}},{tag:"line",attr:{x1:"3",y1:"18",x2:"21",y2:"18"}}]})(n)}function zr(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"5 3 19 12 5 21 5 3"}}]})(n)}function ZT(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"12",y1:"5",x2:"12",y2:"19"}},{tag:"line",attr:{x1:"5",y1:"12",x2:"19",y2:"12"}}]})(n)}function im(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"2"}},{tag:"path",attr:{d:"M16.24 7.76a6 6 0 0 1 0 8.49m-8.48-.01a6 6 0 0 1 0-8.49m11.31-2.82a10 10 0 0 1 0 14.14m-14.14 0a10 10 0 0 1 0-14.14"}}]})(n)}function oc(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"11",cy:"11",r:"8"}},{tag:"line",attr:{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}}]})(n)}function qP(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"22",y1:"2",x2:"11",y2:"13"}},{tag:"polygon",attr:{points:"22 2 15 22 11 13 2 9 22 2"}}]})(n)}function eb(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}}]})(n)}function XP(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"18",cy:"5",r:"3"}},{tag:"circle",attr:{cx:"6",cy:"12",r:"3"}},{tag:"circle",attr:{cx:"18",cy:"19",r:"3"}},{tag:"line",attr:{x1:"8.59",y1:"13.51",x2:"15.42",y2:"17.49"}},{tag:"line",attr:{x1:"15.41",y1:"6.51",x2:"8.59",y2:"10.49"}}]})(n)}function Ta(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"}}]})(n)}function QP(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"}}]})(n)}function JP(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"}}]})(n)}function tb(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"23 6 13.5 15.5 8.5 10.5 1 18"}},{tag:"polyline",attr:{points:"17 6 23 6 23 12"}}]})(n)}function Ep(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"2",y:"7",width:"20",height:"15",rx:"2",ry:"2"}},{tag:"polyline",attr:{points:"17 2 12 7 7 2"}}]})(n)}function nb(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"12",cy:"7",r:"4"}}]})(n)}function ln(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"18",y1:"6",x2:"6",y2:"18"}},{tag:"line",attr:{x1:"6",y1:"6",x2:"18",y2:"18"}}]})(n)}function ZP(n){return He({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"}}]})(n)}function rb(n,e){return function(){return n.apply(e,arguments)}}const{toString:eD}=Object.prototype,{getPrototypeOf:Tp}=Object,{iterator:Mc,toStringTag:sb}=Symbol,Fc=(n=>e=>{const t=eD.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),er=n=>(n=n.toLowerCase(),e=>Fc(e)===n),Bc=n=>e=>typeof e===n,{isArray:ro}=Array,Qi=Bc("undefined");function Ha(n){return n!==null&&!Qi(n)&&n.constructor!==null&&!Qi(n.constructor)&&cn(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const ib=er("ArrayBuffer");function tD(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&ib(n.buffer),e}const nD=Bc("string"),cn=Bc("function"),ob=Bc("number"),Ka=n=>n!==null&&typeof n=="object",rD=n=>n===!0||n===!1,Bu=n=>{if(Fc(n)!=="object")return!1;const e=Tp(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(sb in n)&&!(Mc in n)},sD=n=>{if(!Ka(n)||Ha(n))return!1;try{return Object.keys(n).length===0&&Object.getPrototypeOf(n)===Object.prototype}catch{return!1}},iD=er("Date"),oD=er("File"),aD=er("Blob"),lD=er("FileList"),uD=n=>Ka(n)&&cn(n.pipe),cD=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||cn(n.append)&&((e=Fc(n))==="formdata"||e==="object"&&cn(n.toString)&&n.toString()==="[object FormData]"))},dD=er("URLSearchParams"),[fD,hD,mD,pD]=["ReadableStream","Request","Response","Headers"].map(er),gD=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function za(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let r,s;if(typeof n!="object"&&(n=[n]),ro(n))for(r=0,s=n.length;r<s;r++)e.call(null,n[r],r,n);else{if(Ha(n))return;const i=t?Object.getOwnPropertyNames(n):Object.keys(n),o=i.length;let l;for(r=0;r<o;r++)l=i[r],e.call(null,n[l],l,n)}}function ab(n,e){if(Ha(n))return null;e=e.toLowerCase();const t=Object.keys(n);let r=t.length,s;for(;r-- >0;)if(s=t[r],e===s.toLowerCase())return s;return null}const Js=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,lb=n=>!Qi(n)&&n!==Js;function om(){const{caseless:n,skipUndefined:e}=lb(this)&&this||{},t={},r=(s,i)=>{const o=n&&ab(t,i)||i;Bu(t[o])&&Bu(s)?t[o]=om(t[o],s):Bu(s)?t[o]=om({},s):ro(s)?t[o]=s.slice():(!e||!Qi(s))&&(t[o]=s)};for(let s=0,i=arguments.length;s<i;s++)arguments[s]&&za(arguments[s],r);return t}const yD=(n,e,t,{allOwnKeys:r}={})=>(za(e,(s,i)=>{t&&cn(s)?n[i]=rb(s,t):n[i]=s},{allOwnKeys:r}),n),vD=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),xD=(n,e,t,r)=>{n.prototype=Object.create(e.prototype,r),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},SD=(n,e,t,r)=>{let s,i,o;const l={};if(e=e||{},n==null)return e;do{for(s=Object.getOwnPropertyNames(n),i=s.length;i-- >0;)o=s[i],(!r||r(o,n,e))&&!l[o]&&(e[o]=n[o],l[o]=!0);n=t!==!1&&Tp(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},ED=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const r=n.indexOf(e,t);return r!==-1&&r===t},TD=n=>{if(!n)return null;if(ro(n))return n;let e=n.length;if(!ob(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},bD=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&Tp(Uint8Array)),wD=(n,e)=>{const r=(n&&n[Mc]).call(n);let s;for(;(s=r.next())&&!s.done;){const i=s.value;e.call(n,i[0],i[1])}},AD=(n,e)=>{let t;const r=[];for(;(t=n.exec(e))!==null;)r.push(t);return r},LD=er("HTMLFormElement"),RD=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,s){return r.toUpperCase()+s}),sx=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),ID=er("RegExp"),ub=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),r={};za(t,(s,i)=>{let o;(o=e(s,i,n))!==!1&&(r[i]=o||s)}),Object.defineProperties(n,r)},_D=n=>{ub(n,(e,t)=>{if(cn(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const r=n[t];if(cn(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},CD=(n,e)=>{const t={},r=s=>{s.forEach(i=>{t[i]=!0})};return ro(n)?r(n):r(String(n).split(e)),t},kD=()=>{},PD=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e;function DD(n){return!!(n&&cn(n.append)&&n[sb]==="FormData"&&n[Mc])}const ND=n=>{const e=new Array(10),t=(r,s)=>{if(Ka(r)){if(e.indexOf(r)>=0)return;if(Ha(r))return r;if(!("toJSON"in r)){e[s]=r;const i=ro(r)?[]:{};return za(r,(o,l)=>{const c=t(o,s+1);!Qi(c)&&(i[l]=c)}),e[s]=void 0,i}}return r};return t(n,0)},OD=er("AsyncFunction"),MD=n=>n&&(Ka(n)||cn(n))&&cn(n.then)&&cn(n.catch),cb=((n,e)=>n?setImmediate:e?((t,r)=>(Js.addEventListener("message",({source:s,data:i})=>{s===Js&&i===t&&r.length&&r.shift()()},!1),s=>{r.push(s),Js.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",cn(Js.postMessage)),FD=typeof queueMicrotask<"u"?queueMicrotask.bind(Js):typeof process<"u"&&process.nextTick||cb,BD=n=>n!=null&&cn(n[Mc]),J={isArray:ro,isArrayBuffer:ib,isBuffer:Ha,isFormData:cD,isArrayBufferView:tD,isString:nD,isNumber:ob,isBoolean:rD,isObject:Ka,isPlainObject:Bu,isEmptyObject:sD,isReadableStream:fD,isRequest:hD,isResponse:mD,isHeaders:pD,isUndefined:Qi,isDate:iD,isFile:oD,isBlob:aD,isRegExp:ID,isFunction:cn,isStream:uD,isURLSearchParams:dD,isTypedArray:bD,isFileList:lD,forEach:za,merge:om,extend:yD,trim:gD,stripBOM:vD,inherits:xD,toFlatObject:SD,kindOf:Fc,kindOfTest:er,endsWith:ED,toArray:TD,forEachEntry:wD,matchAll:AD,isHTMLForm:LD,hasOwnProperty:sx,hasOwnProp:sx,reduceDescriptors:ub,freezeMethods:_D,toObjectSet:CD,toCamelCase:RD,noop:kD,toFiniteNumber:PD,findKey:ab,global:Js,isContextDefined:lb,isSpecCompliantForm:DD,toJSONObject:ND,isAsyncFn:OD,isThenable:MD,setImmediate:cb,asap:FD,isIterable:BD};function Fe(n,e,t,r,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),s&&(this.response=s,this.status=s.status?s.status:null)}J.inherits(Fe,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:J.toJSONObject(this.config),code:this.code,status:this.status}}});const db=Fe.prototype,fb={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{fb[n]={value:n}});Object.defineProperties(Fe,fb);Object.defineProperty(db,"isAxiosError",{value:!0});Fe.from=(n,e,t,r,s,i)=>{const o=Object.create(db);J.toFlatObject(n,o,function(f){return f!==Error.prototype},d=>d!=="isAxiosError");const l=n&&n.message?n.message:"Error",c=e==null&&n?n.code:e;return Fe.call(o,l,c,t,r,s),n&&o.cause==null&&Object.defineProperty(o,"cause",{value:n,configurable:!0}),o.name=n&&n.name||"Error",i&&Object.assign(o,i),o};const UD=null;function am(n){return J.isPlainObject(n)||J.isArray(n)}function hb(n){return J.endsWith(n,"[]")?n.slice(0,-2):n}function ix(n,e,t){return n?n.concat(e).map(function(s,i){return s=hb(s),!t&&i?"["+s+"]":s}).join(t?".":""):e}function $D(n){return J.isArray(n)&&!n.some(am)}const jD=J.toFlatObject(J,{},null,function(e){return/^is[A-Z]/.test(e)});function Uc(n,e,t){if(!J.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=J.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(S,x){return!J.isUndefined(x[S])});const r=t.metaTokens,s=t.visitor||f,i=t.dots,o=t.indexes,c=(t.Blob||typeof Blob<"u"&&Blob)&&J.isSpecCompliantForm(e);if(!J.isFunction(s))throw new TypeError("visitor must be a function");function d(g){if(g===null)return"";if(J.isDate(g))return g.toISOString();if(J.isBoolean(g))return g.toString();if(!c&&J.isBlob(g))throw new Fe("Blob is not supported. Use a Buffer instead.");return J.isArrayBuffer(g)||J.isTypedArray(g)?c&&typeof Blob=="function"?new Blob([g]):Buffer.from(g):g}function f(g,S,x){let b=g;if(g&&!x&&typeof g=="object"){if(J.endsWith(S,"{}"))S=r?S:S.slice(0,-2),g=JSON.stringify(g);else if(J.isArray(g)&&$D(g)||(J.isFileList(g)||J.endsWith(S,"[]"))&&(b=J.toArray(g)))return S=hb(S),b.forEach(function(L,I){!(J.isUndefined(L)||L===null)&&e.append(o===!0?ix([S],I,i):o===null?S:S+"[]",d(L))}),!1}return am(g)?!0:(e.append(ix(x,S,i),d(g)),!1)}const h=[],p=Object.assign(jD,{defaultVisitor:f,convertValue:d,isVisitable:am});function v(g,S){if(!J.isUndefined(g)){if(h.indexOf(g)!==-1)throw Error("Circular reference detected in "+S.join("."));h.push(g),J.forEach(g,function(b,A){(!(J.isUndefined(b)||b===null)&&s.call(e,b,J.isString(A)?A.trim():A,S,p))===!0&&v(b,S?S.concat(A):[A])}),h.pop()}}if(!J.isObject(n))throw new TypeError("data must be an object");return v(n),e}function ox(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function bp(n,e){this._pairs=[],n&&Uc(n,this,e)}const mb=bp.prototype;mb.append=function(e,t){this._pairs.push([e,t])};mb.toString=function(e){const t=e?function(r){return e.call(this,r,ox)}:ox;return this._pairs.map(function(s){return t(s[0])+"="+t(s[1])},"").join("&")};function VD(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function pb(n,e,t){if(!e)return n;const r=t&&t.encode||VD;J.isFunction(t)&&(t={serialize:t});const s=t&&t.serialize;let i;if(s?i=s(e,t):i=J.isURLSearchParams(e)?e.toString():new bp(e,t).toString(r),i){const o=n.indexOf("#");o!==-1&&(n=n.slice(0,o)),n+=(n.indexOf("?")===-1?"?":"&")+i}return n}class ax{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){J.forEach(this.handlers,function(r){r!==null&&e(r)})}}const gb={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},GD=typeof URLSearchParams<"u"?URLSearchParams:bp,HD=typeof FormData<"u"?FormData:null,KD=typeof Blob<"u"?Blob:null,zD={isBrowser:!0,classes:{URLSearchParams:GD,FormData:HD,Blob:KD},protocols:["http","https","file","blob","url","data"]},wp=typeof window<"u"&&typeof document<"u",lm=typeof navigator=="object"&&navigator||void 0,WD=wp&&(!lm||["ReactNative","NativeScript","NS"].indexOf(lm.product)<0),YD=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",qD=wp&&window.location.href||"http://localhost",XD=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:wp,hasStandardBrowserEnv:WD,hasStandardBrowserWebWorkerEnv:YD,navigator:lm,origin:qD},Symbol.toStringTag,{value:"Module"})),Wt={...XD,...zD};function QD(n,e){return Uc(n,new Wt.classes.URLSearchParams,{visitor:function(t,r,s,i){return Wt.isNode&&J.isBuffer(t)?(this.append(r,t.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)},...e})}function JD(n){return J.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function ZD(n){const e={},t=Object.keys(n);let r;const s=t.length;let i;for(r=0;r<s;r++)i=t[r],e[i]=n[i];return e}function yb(n){function e(t,r,s,i){let o=t[i++];if(o==="__proto__")return!0;const l=Number.isFinite(+o),c=i>=t.length;return o=!o&&J.isArray(s)?s.length:o,c?(J.hasOwnProp(s,o)?s[o]=[s[o],r]:s[o]=r,!l):((!s[o]||!J.isObject(s[o]))&&(s[o]=[]),e(t,r,s[o],i)&&J.isArray(s[o])&&(s[o]=ZD(s[o])),!l)}if(J.isFormData(n)&&J.isFunction(n.entries)){const t={};return J.forEachEntry(n,(r,s)=>{e(JD(r),s,t,0)}),t}return null}function eN(n,e,t){if(J.isString(n))try{return(e||JSON.parse)(n),J.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(n)}const Wa={transitional:gb,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",s=r.indexOf("application/json")>-1,i=J.isObject(e);if(i&&J.isHTMLForm(e)&&(e=new FormData(e)),J.isFormData(e))return s?JSON.stringify(yb(e)):e;if(J.isArrayBuffer(e)||J.isBuffer(e)||J.isStream(e)||J.isFile(e)||J.isBlob(e)||J.isReadableStream(e))return e;if(J.isArrayBufferView(e))return e.buffer;if(J.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let l;if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return QD(e,this.formSerializer).toString();if((l=J.isFileList(e))||r.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return Uc(l?{"files[]":e}:e,c&&new c,this.formSerializer)}}return i||s?(t.setContentType("application/json",!1),eN(e)):e}],transformResponse:[function(e){const t=this.transitional||Wa.transitional,r=t&&t.forcedJSONParsing,s=this.responseType==="json";if(J.isResponse(e)||J.isReadableStream(e))return e;if(e&&J.isString(e)&&(r&&!this.responseType||s)){const o=!(t&&t.silentJSONParsing)&&s;try{return JSON.parse(e,this.parseReviver)}catch(l){if(o)throw l.name==="SyntaxError"?Fe.from(l,Fe.ERR_BAD_RESPONSE,this,null,this.response):l}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Wt.classes.FormData,Blob:Wt.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};J.forEach(["delete","get","head","post","put","patch"],n=>{Wa.headers[n]={}});const tN=J.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),nN=n=>{const e={};let t,r,s;return n&&n.split(`
`).forEach(function(o){s=o.indexOf(":"),t=o.substring(0,s).trim().toLowerCase(),r=o.substring(s+1).trim(),!(!t||e[t]&&tN[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e},lx=Symbol("internals");function ea(n){return n&&String(n).trim().toLowerCase()}function Uu(n){return n===!1||n==null?n:J.isArray(n)?n.map(Uu):String(n)}function rN(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=t.exec(n);)e[r[1]]=r[2];return e}const sN=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function rh(n,e,t,r,s){if(J.isFunction(r))return r.call(this,e,t);if(s&&(e=t),!!J.isString(e)){if(J.isString(r))return e.indexOf(r)!==-1;if(J.isRegExp(r))return r.test(e)}}function iN(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function oN(n,e){const t=J.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(n,r+t,{value:function(s,i,o){return this[r].call(this,e,s,i,o)},configurable:!0})})}let dn=class{constructor(e){e&&this.set(e)}set(e,t,r){const s=this;function i(l,c,d){const f=ea(c);if(!f)throw new Error("header name must be a non-empty string");const h=J.findKey(s,f);(!h||s[h]===void 0||d===!0||d===void 0&&s[h]!==!1)&&(s[h||c]=Uu(l))}const o=(l,c)=>J.forEach(l,(d,f)=>i(d,f,c));if(J.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(J.isString(e)&&(e=e.trim())&&!sN(e))o(nN(e),t);else if(J.isObject(e)&&J.isIterable(e)){let l={},c,d;for(const f of e){if(!J.isArray(f))throw TypeError("Object iterator must return a key-value pair");l[d=f[0]]=(c=l[d])?J.isArray(c)?[...c,f[1]]:[c,f[1]]:f[1]}o(l,t)}else e!=null&&i(t,e,r);return this}get(e,t){if(e=ea(e),e){const r=J.findKey(this,e);if(r){const s=this[r];if(!t)return s;if(t===!0)return rN(s);if(J.isFunction(t))return t.call(this,s,r);if(J.isRegExp(t))return t.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=ea(e),e){const r=J.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||rh(this,this[r],r,t)))}return!1}delete(e,t){const r=this;let s=!1;function i(o){if(o=ea(o),o){const l=J.findKey(r,o);l&&(!t||rh(r,r[l],l,t))&&(delete r[l],s=!0)}}return J.isArray(e)?e.forEach(i):i(e),s}clear(e){const t=Object.keys(this);let r=t.length,s=!1;for(;r--;){const i=t[r];(!e||rh(this,this[i],i,e,!0))&&(delete this[i],s=!0)}return s}normalize(e){const t=this,r={};return J.forEach(this,(s,i)=>{const o=J.findKey(r,i);if(o){t[o]=Uu(s),delete t[i];return}const l=e?iN(i):String(i).trim();l!==i&&delete t[i],t[l]=Uu(s),r[l]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return J.forEach(this,(r,s)=>{r!=null&&r!==!1&&(t[s]=e&&J.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(s=>r.set(s)),r}static accessor(e){const r=(this[lx]=this[lx]={accessors:{}}).accessors,s=this.prototype;function i(o){const l=ea(o);r[l]||(oN(s,o),r[l]=!0)}return J.isArray(e)?e.forEach(i):i(e),this}};dn.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);J.reduceDescriptors(dn.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(r){this[t]=r}}});J.freezeMethods(dn);function sh(n,e){const t=this||Wa,r=e||t,s=dn.from(r.headers);let i=r.data;return J.forEach(n,function(l){i=l.call(t,i,s.normalize(),e?e.status:void 0)}),s.normalize(),i}function vb(n){return!!(n&&n.__CANCEL__)}function so(n,e,t){Fe.call(this,n??"canceled",Fe.ERR_CANCELED,e,t),this.name="CanceledError"}J.inherits(so,Fe,{__CANCEL__:!0});function xb(n,e,t){const r=t.config.validateStatus;!t.status||!r||r(t.status)?n(t):e(new Fe("Request failed with status code "+t.status,[Fe.ERR_BAD_REQUEST,Fe.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function aN(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function lN(n,e){n=n||10;const t=new Array(n),r=new Array(n);let s=0,i=0,o;return e=e!==void 0?e:1e3,function(c){const d=Date.now(),f=r[i];o||(o=d),t[s]=c,r[s]=d;let h=i,p=0;for(;h!==s;)p+=t[h++],h=h%n;if(s=(s+1)%n,s===i&&(i=(i+1)%n),d-o<e)return;const v=f&&d-f;return v?Math.round(p*1e3/v):void 0}}function uN(n,e){let t=0,r=1e3/e,s,i;const o=(d,f=Date.now())=>{t=f,s=null,i&&(clearTimeout(i),i=null),n(...d)};return[(...d)=>{const f=Date.now(),h=f-t;h>=r?o(d,f):(s=d,i||(i=setTimeout(()=>{i=null,o(s)},r-h)))},()=>s&&o(s)]}const ac=(n,e,t=3)=>{let r=0;const s=lN(50,250);return uN(i=>{const o=i.loaded,l=i.lengthComputable?i.total:void 0,c=o-r,d=s(c),f=o<=l;r=o;const h={loaded:o,total:l,progress:l?o/l:void 0,bytes:c,rate:d||void 0,estimated:d&&l&&f?(l-o)/d:void 0,event:i,lengthComputable:l!=null,[e?"download":"upload"]:!0};n(h)},t)},ux=(n,e)=>{const t=n!=null;return[r=>e[0]({lengthComputable:t,total:n,loaded:r}),e[1]]},cx=n=>(...e)=>J.asap(()=>n(...e)),cN=Wt.hasStandardBrowserEnv?((n,e)=>t=>(t=new URL(t,Wt.origin),n.protocol===t.protocol&&n.host===t.host&&(e||n.port===t.port)))(new URL(Wt.origin),Wt.navigator&&/(msie|trident)/i.test(Wt.navigator.userAgent)):()=>!0,dN=Wt.hasStandardBrowserEnv?{write(n,e,t,r,s,i){const o=[n+"="+encodeURIComponent(e)];J.isNumber(t)&&o.push("expires="+new Date(t).toGMTString()),J.isString(r)&&o.push("path="+r),J.isString(s)&&o.push("domain="+s),i===!0&&o.push("secure"),document.cookie=o.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function fN(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function hN(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function Sb(n,e,t){let r=!fN(e);return n&&(r||t==!1)?hN(n,e):e}const dx=n=>n instanceof dn?{...n}:n;function ri(n,e){e=e||{};const t={};function r(d,f,h,p){return J.isPlainObject(d)&&J.isPlainObject(f)?J.merge.call({caseless:p},d,f):J.isPlainObject(f)?J.merge({},f):J.isArray(f)?f.slice():f}function s(d,f,h,p){if(J.isUndefined(f)){if(!J.isUndefined(d))return r(void 0,d,h,p)}else return r(d,f,h,p)}function i(d,f){if(!J.isUndefined(f))return r(void 0,f)}function o(d,f){if(J.isUndefined(f)){if(!J.isUndefined(d))return r(void 0,d)}else return r(void 0,f)}function l(d,f,h){if(h in e)return r(d,f);if(h in n)return r(void 0,d)}const c={url:i,method:i,data:i,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:l,headers:(d,f,h)=>s(dx(d),dx(f),h,!0)};return J.forEach(Object.keys({...n,...e}),function(f){const h=c[f]||s,p=h(n[f],e[f],f);J.isUndefined(p)&&h!==l||(t[f]=p)}),t}const Eb=n=>{const e=ri({},n);let{data:t,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:i,headers:o,auth:l}=e;if(e.headers=o=dn.from(o),e.url=pb(Sb(e.baseURL,e.url,e.allowAbsoluteUrls),n.params,n.paramsSerializer),l&&o.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),J.isFormData(t)){if(Wt.hasStandardBrowserEnv||Wt.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(J.isFunction(t.getHeaders)){const c=t.getHeaders(),d=["content-type","content-length"];Object.entries(c).forEach(([f,h])=>{d.includes(f.toLowerCase())&&o.set(f,h)})}}if(Wt.hasStandardBrowserEnv&&(r&&J.isFunction(r)&&(r=r(e)),r||r!==!1&&cN(e.url))){const c=s&&i&&dN.read(i);c&&o.set(s,c)}return e},mN=typeof XMLHttpRequest<"u",pN=mN&&function(n){return new Promise(function(t,r){const s=Eb(n);let i=s.data;const o=dn.from(s.headers).normalize();let{responseType:l,onUploadProgress:c,onDownloadProgress:d}=s,f,h,p,v,g;function S(){v&&v(),g&&g(),s.cancelToken&&s.cancelToken.unsubscribe(f),s.signal&&s.signal.removeEventListener("abort",f)}let x=new XMLHttpRequest;x.open(s.method.toUpperCase(),s.url,!0),x.timeout=s.timeout;function b(){if(!x)return;const L=dn.from("getAllResponseHeaders"in x&&x.getAllResponseHeaders()),k={data:!l||l==="text"||l==="json"?x.responseText:x.response,status:x.status,statusText:x.statusText,headers:L,config:n,request:x};xb(function(C){t(C),S()},function(C){r(C),S()},k),x=null}"onloadend"in x?x.onloadend=b:x.onreadystatechange=function(){!x||x.readyState!==4||x.status===0&&!(x.responseURL&&x.responseURL.indexOf("file:")===0)||setTimeout(b)},x.onabort=function(){x&&(r(new Fe("Request aborted",Fe.ECONNABORTED,n,x)),x=null)},x.onerror=function(I){const k=I&&I.message?I.message:"Network Error",F=new Fe(k,Fe.ERR_NETWORK,n,x);F.event=I||null,r(F),x=null},x.ontimeout=function(){let I=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const k=s.transitional||gb;s.timeoutErrorMessage&&(I=s.timeoutErrorMessage),r(new Fe(I,k.clarifyTimeoutError?Fe.ETIMEDOUT:Fe.ECONNABORTED,n,x)),x=null},i===void 0&&o.setContentType(null),"setRequestHeader"in x&&J.forEach(o.toJSON(),function(I,k){x.setRequestHeader(k,I)}),J.isUndefined(s.withCredentials)||(x.withCredentials=!!s.withCredentials),l&&l!=="json"&&(x.responseType=s.responseType),d&&([p,g]=ac(d,!0),x.addEventListener("progress",p)),c&&x.upload&&([h,v]=ac(c),x.upload.addEventListener("progress",h),x.upload.addEventListener("loadend",v)),(s.cancelToken||s.signal)&&(f=L=>{x&&(r(!L||L.type?new so(null,n,x):L),x.abort(),x=null)},s.cancelToken&&s.cancelToken.subscribe(f),s.signal&&(s.signal.aborted?f():s.signal.addEventListener("abort",f)));const A=aN(s.url);if(A&&Wt.protocols.indexOf(A)===-1){r(new Fe("Unsupported protocol "+A+":",Fe.ERR_BAD_REQUEST,n));return}x.send(i||null)})},gN=(n,e)=>{const{length:t}=n=n?n.filter(Boolean):[];if(e||t){let r=new AbortController,s;const i=function(d){if(!s){s=!0,l();const f=d instanceof Error?d:this.reason;r.abort(f instanceof Fe?f:new so(f instanceof Error?f.message:f))}};let o=e&&setTimeout(()=>{o=null,i(new Fe(`timeout ${e} of ms exceeded`,Fe.ETIMEDOUT))},e);const l=()=>{n&&(o&&clearTimeout(o),o=null,n.forEach(d=>{d.unsubscribe?d.unsubscribe(i):d.removeEventListener("abort",i)}),n=null)};n.forEach(d=>d.addEventListener("abort",i));const{signal:c}=r;return c.unsubscribe=()=>J.asap(l),c}},yN=function*(n,e){let t=n.byteLength;if(t<e){yield n;return}let r=0,s;for(;r<t;)s=r+e,yield n.slice(r,s),r=s},vN=async function*(n,e){for await(const t of xN(n))yield*yN(t,e)},xN=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:t,value:r}=await e.read();if(t)break;yield r}}finally{await e.cancel()}},fx=(n,e,t,r)=>{const s=vN(n,e);let i=0,o,l=c=>{o||(o=!0,r&&r(c))};return new ReadableStream({async pull(c){try{const{done:d,value:f}=await s.next();if(d){l(),c.close();return}let h=f.byteLength;if(t){let p=i+=h;t(p)}c.enqueue(new Uint8Array(f))}catch(d){throw l(d),d}},cancel(c){return l(c),s.return()}},{highWaterMark:2})},hx=64*1024,{isFunction:hu}=J,SN=(({Request:n,Response:e})=>({Request:n,Response:e}))(J.global),{ReadableStream:mx,TextEncoder:px}=J.global,gx=(n,...e)=>{try{return!!n(...e)}catch{return!1}},EN=n=>{n=J.merge.call({skipUndefined:!0},SN,n);const{fetch:e,Request:t,Response:r}=n,s=e?hu(e):typeof fetch=="function",i=hu(t),o=hu(r);if(!s)return!1;const l=s&&hu(mx),c=s&&(typeof px=="function"?(g=>S=>g.encode(S))(new px):async g=>new Uint8Array(await new t(g).arrayBuffer())),d=i&&l&&gx(()=>{let g=!1;const S=new t(Wt.origin,{body:new mx,method:"POST",get duplex(){return g=!0,"half"}}).headers.has("Content-Type");return g&&!S}),f=o&&l&&gx(()=>J.isReadableStream(new r("").body)),h={stream:f&&(g=>g.body)};s&&["text","arrayBuffer","blob","formData","stream"].forEach(g=>{!h[g]&&(h[g]=(S,x)=>{let b=S&&S[g];if(b)return b.call(S);throw new Fe(`Response type '${g}' is not supported`,Fe.ERR_NOT_SUPPORT,x)})});const p=async g=>{if(g==null)return 0;if(J.isBlob(g))return g.size;if(J.isSpecCompliantForm(g))return(await new t(Wt.origin,{method:"POST",body:g}).arrayBuffer()).byteLength;if(J.isArrayBufferView(g)||J.isArrayBuffer(g))return g.byteLength;if(J.isURLSearchParams(g)&&(g=g+""),J.isString(g))return(await c(g)).byteLength},v=async(g,S)=>{const x=J.toFiniteNumber(g.getContentLength());return x??p(S)};return async g=>{let{url:S,method:x,data:b,signal:A,cancelToken:L,timeout:I,onDownloadProgress:k,onUploadProgress:F,responseType:C,headers:P,withCredentials:O="same-origin",fetchOptions:M}=Eb(g),H=e||fetch;C=C?(C+"").toLowerCase():"text";let Z=gN([A,L&&L.toAbortSignal()],I),se=null;const U=Z&&Z.unsubscribe&&(()=>{Z.unsubscribe()});let ne;try{if(F&&d&&x!=="get"&&x!=="head"&&(ne=await v(P,b))!==0){let D=new t(S,{method:"POST",body:b,duplex:"half"}),$;if(J.isFormData(b)&&($=D.headers.get("content-type"))&&P.setContentType($),D.body){const[ie,ue]=ux(ne,ac(cx(F)));b=fx(D.body,hx,ie,ue)}}J.isString(O)||(O=O?"include":"omit");const q=i&&"credentials"in t.prototype,te={...M,signal:Z,method:x.toUpperCase(),headers:P.normalize().toJSON(),body:b,duplex:"half",credentials:q?O:void 0};se=i&&new t(S,te);let G=await(i?H(se,M):H(S,te));const Q=f&&(C==="stream"||C==="response");if(f&&(k||Q&&U)){const D={};["status","statusText","headers"].forEach(ce=>{D[ce]=G[ce]});const $=J.toFiniteNumber(G.headers.get("content-length")),[ie,ue]=k&&ux($,ac(cx(k),!0))||[];G=new r(fx(G.body,hx,ie,()=>{ue&&ue(),U&&U()}),D)}C=C||"text";let ee=await h[J.findKey(h,C)||"text"](G,g);return!Q&&U&&U(),await new Promise((D,$)=>{xb(D,$,{data:ee,headers:dn.from(G.headers),status:G.status,statusText:G.statusText,config:g,request:se})})}catch(q){throw U&&U(),q&&q.name==="TypeError"&&/Load failed|fetch/i.test(q.message)?Object.assign(new Fe("Network Error",Fe.ERR_NETWORK,g,se),{cause:q.cause||q}):Fe.from(q,q&&q.code,g,se)}}},TN=new Map,Tb=n=>{let e=n?n.env:{};const{fetch:t,Request:r,Response:s}=e,i=[r,s,t];let o=i.length,l=o,c,d,f=TN;for(;l--;)c=i[l],d=f.get(c),d===void 0&&f.set(c,d=l?new Map:EN(e)),f=d;return d};Tb();const um={http:UD,xhr:pN,fetch:{get:Tb}};J.forEach(um,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const yx=n=>`- ${n}`,bN=n=>J.isFunction(n)||n===null||n===!1,bb={getAdapter:(n,e)=>{n=J.isArray(n)?n:[n];const{length:t}=n;let r,s;const i={};for(let o=0;o<t;o++){r=n[o];let l;if(s=r,!bN(r)&&(s=um[(l=String(r)).toLowerCase()],s===void 0))throw new Fe(`Unknown adapter '${l}'`);if(s&&(J.isFunction(s)||(s=s.get(e))))break;i[l||"#"+o]=s}if(!s){const o=Object.entries(i).map(([c,d])=>`adapter ${c} `+(d===!1?"is not supported by the environment":"is not available in the build"));let l=t?o.length>1?`since :
`+o.map(yx).join(`
`):" "+yx(o[0]):"as no adapter specified";throw new Fe("There is no suitable adapter to dispatch the request "+l,"ERR_NOT_SUPPORT")}return s},adapters:um};function ih(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new so(null,n)}function vx(n){return ih(n),n.headers=dn.from(n.headers),n.data=sh.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),bb.getAdapter(n.adapter||Wa.adapter,n)(n).then(function(r){return ih(n),r.data=sh.call(n,n.transformResponse,r),r.headers=dn.from(r.headers),r},function(r){return vb(r)||(ih(n),r&&r.response&&(r.response.data=sh.call(n,n.transformResponse,r.response),r.response.headers=dn.from(r.response.headers))),Promise.reject(r)})}const wb="1.12.2",$c={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{$c[n]=function(r){return typeof r===n||"a"+(e<1?"n ":" ")+n}});const xx={};$c.transitional=function(e,t,r){function s(i,o){return"[Axios v"+wb+"] Transitional option '"+i+"'"+o+(r?". "+r:"")}return(i,o,l)=>{if(e===!1)throw new Fe(s(o," has been removed"+(t?" in "+t:"")),Fe.ERR_DEPRECATED);return t&&!xx[o]&&(xx[o]=!0,console.warn(s(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(i,o,l):!0}};$c.spelling=function(e){return(t,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};function wN(n,e,t){if(typeof n!="object")throw new Fe("options must be an object",Fe.ERR_BAD_OPTION_VALUE);const r=Object.keys(n);let s=r.length;for(;s-- >0;){const i=r[s],o=e[i];if(o){const l=n[i],c=l===void 0||o(l,i,n);if(c!==!0)throw new Fe("option "+i+" must be "+c,Fe.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Fe("Unknown option "+i,Fe.ERR_BAD_OPTION)}}const $u={assertOptions:wN,validators:$c},ar=$u.validators;let ti=class{constructor(e){this.defaults=e||{},this.interceptors={request:new ax,response:new ax}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const i=s.stack?s.stack.replace(/^.+\n/,""):"";try{r.stack?i&&!String(r.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+i):r.stack=i}catch{}}throw r}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=ri(this.defaults,t);const{transitional:r,paramsSerializer:s,headers:i}=t;r!==void 0&&$u.assertOptions(r,{silentJSONParsing:ar.transitional(ar.boolean),forcedJSONParsing:ar.transitional(ar.boolean),clarifyTimeoutError:ar.transitional(ar.boolean)},!1),s!=null&&(J.isFunction(s)?t.paramsSerializer={serialize:s}:$u.assertOptions(s,{encode:ar.function,serialize:ar.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),$u.assertOptions(t,{baseUrl:ar.spelling("baseURL"),withXsrfToken:ar.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=i&&J.merge(i.common,i[t.method]);i&&J.forEach(["delete","get","head","post","put","patch","common"],g=>{delete i[g]}),t.headers=dn.concat(o,i);const l=[];let c=!0;this.interceptors.request.forEach(function(S){typeof S.runWhen=="function"&&S.runWhen(t)===!1||(c=c&&S.synchronous,l.unshift(S.fulfilled,S.rejected))});const d=[];this.interceptors.response.forEach(function(S){d.push(S.fulfilled,S.rejected)});let f,h=0,p;if(!c){const g=[vx.bind(this),void 0];for(g.unshift(...l),g.push(...d),p=g.length,f=Promise.resolve(t);h<p;)f=f.then(g[h++],g[h++]);return f}p=l.length;let v=t;for(;h<p;){const g=l[h++],S=l[h++];try{v=g(v)}catch(x){S.call(this,x);break}}try{f=vx.call(this,v)}catch(g){return Promise.reject(g)}for(h=0,p=d.length;h<p;)f=f.then(d[h++],d[h++]);return f}getUri(e){e=ri(this.defaults,e);const t=Sb(e.baseURL,e.url,e.allowAbsoluteUrls);return pb(t,e.params,e.paramsSerializer)}};J.forEach(["delete","get","head","options"],function(e){ti.prototype[e]=function(t,r){return this.request(ri(r||{},{method:e,url:t,data:(r||{}).data}))}});J.forEach(["post","put","patch"],function(e){function t(r){return function(i,o,l){return this.request(ri(l||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:i,data:o}))}}ti.prototype[e]=t(),ti.prototype[e+"Form"]=t(!0)});let AN=class Ab{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(i){t=i});const r=this;this.promise.then(s=>{if(!r._listeners)return;let i=r._listeners.length;for(;i-- >0;)r._listeners[i](s);r._listeners=null}),this.promise.then=s=>{let i;const o=new Promise(l=>{r.subscribe(l),i=l}).then(s);return o.cancel=function(){r.unsubscribe(i)},o},e(function(i,o,l){r.reason||(r.reason=new so(i,o,l),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=r=>{e.abort(r)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new Ab(function(s){e=s}),cancel:e}}};function LN(n){return function(t){return n.apply(null,t)}}function RN(n){return J.isObject(n)&&n.isAxiosError===!0}const cm={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(cm).forEach(([n,e])=>{cm[e]=n});function Lb(n){const e=new ti(n),t=rb(ti.prototype.request,e);return J.extend(t,ti.prototype,e,{allOwnKeys:!0}),J.extend(t,e,null,{allOwnKeys:!0}),t.create=function(s){return Lb(ri(n,s))},t}const Ye=Lb(Wa);Ye.Axios=ti;Ye.CanceledError=so;Ye.CancelToken=AN;Ye.isCancel=vb;Ye.VERSION=wb;Ye.toFormData=Uc;Ye.AxiosError=Fe;Ye.Cancel=Ye.CanceledError;Ye.all=function(e){return Promise.all(e)};Ye.spread=LN;Ye.isAxiosError=RN;Ye.mergeConfig=ri;Ye.AxiosHeaders=dn;Ye.formToJSON=n=>yb(J.isHTMLForm(n)?new FormData(n):n);Ye.getAdapter=bb.getAdapter;Ye.HttpStatusCode=cm;Ye.default=Ye;const{Axios:vj,AxiosError:xj,CanceledError:Sj,isCancel:Ej,CancelToken:Tj,VERSION:bj,all:wj,Cancel:Aj,isAxiosError:Lj,spread:Rj,toFormData:Ij,AxiosHeaders:_j,HttpStatusCode:Cj,formToJSON:kj,getAdapter:Pj,mergeConfig:Dj}=Ye,st={TMDB_API_KEY:"3ccf3bbfa9b25213ac74c50f96d238d0",TMDB_READ_TOKEN:"eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIzY2NmM2JiZmE5YjI1MjEzYWM3NGM1MGY5NmQyMzhkMCIsIm5iZiI6MTczMjk3NDAwMy4wNjIsInN1YiI6IjY3NGIxNWIzMDExNzg1MWNkMDFjMjQ4OCIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ._aQY-s2iBoSka9Sc7Iry4EpXgPjBWm__HSIvnrxNtZ4",TMDB_BASE_URL:"https://api.themoviedb.org/3",TMDB_IMAGE_BASE_URL:"https://image.tmdb.org/t/p"},Jn=Xi.div,Sx=Xi.button,da={name:"Orko Biswas",email:"orkobiswas.mail@gmail.com",avatarInitial:"O",plan:"Developer"},Rb=[{id:1,title:"New Episode Available",message:"Succession S4E10 is now streaming",time:"2m ago",type:"new",read:!1},{id:2,title:"Download Complete",message:"Oppenheimer (2023) is ready to watch",time:"1h ago",type:"download",read:!1},{id:3,title:"Watchlist Update",message:"Dune: Part Two is now available",time:"3h ago",type:"update",read:!0},{id:4,title:"Top Pick For You",message:"Based on your interest in Sci-Fi",time:"1d ago",type:"recommend",read:!0}],dm=["Inception","The Bear","Stranger Things"],IN=()=>{const[n,e]=N.useState(0);return N.useEffect(()=>{const t=()=>e(window.pageYOffset);return window.addEventListener("scroll",t),t(),()=>window.removeEventListener("scroll",t)},[]),n},Ib=(n,e)=>{const[t,r]=N.useState(n);return N.useEffect(()=>{const s=setTimeout(()=>r(n),e);return()=>clearTimeout(s)},[n,e]),t},_N=()=>{const n=hn(),e=()=>{n("/"),window.scrollTo({top:0,behavior:"smooth"})};return E.jsx("div",{onClick:e,className:"flex items-center cursor-pointer select-none touch-target",children:E.jsx("div",{className:"relative",children:E.jsx("span",{className:"text-[18px] sm:text-[24px] md:text-[28px] font-black tracking-[-0.05em] leading-none",style:{fontFamily:"system-ui, -apple-system, sans-serif",fontStretch:"condensed",letterSpacing:"-0.02em"},children:E.jsx("span",{className:"text-[#E50914]",children:"SanviTV"})})})})},CN=()=>{const n=hn(),e=Tr(),t=[{label:"Home",path:"/"},{label:"Movies",path:"/movies"},{label:"Series",path:"/series"},{label:"New & Popular",path:"/new-popular"},{label:"Live TV",path:"/live-tv",live:!0}];return E.jsx("nav",{className:"hidden md:flex items-center gap-1 lg:gap-2",children:t.map(r=>{const s=e.pathname===r.path;return E.jsxs("button",{onClick:()=>n(r.path),className:`relative px-2 lg:px-4 py-2 text-xs lg:text-sm font-medium rounded-lg transition-colors duration-300 ${s?"text-white":"text-neutral-400 hover:text-white"}`,children:[E.jsxs("span",{className:"flex items-center gap-1.5",children:[r.label,r.live&&E.jsxs("span",{className:"relative flex h-2 w-2",children:[E.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-500 opacity-75"}),E.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-red-600"})]})]}),s&&E.jsx(Jn,{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-red-600",layoutId:"underline",transition:{type:"spring",stiffness:300,damping:30}})]},r.label)})})},kN=()=>{const n=hn(),[e,t]=N.useState(""),[r,s]=N.useState(!1),[i,o]=N.useState([]),[l,c]=N.useState(!1),[d,f]=N.useState(()=>{const S=localStorage.getItem("searchHistory");return S?JSON.parse(S):dm}),h=Ib(e,500);N.useEffect(()=>{if(!h||h.trim().length<2){o([]),c(!1);return}(async()=>{c(!0);try{const b=(await Ye.get(`${st.TMDB_BASE_URL}/search/multi?api_key=${st.TMDB_API_KEY}&query=${encodeURIComponent(h)}&page=1`)).data.results.filter(A=>A.media_type==="movie"||A.media_type==="tv").slice(0,6);o(b)}catch(x){console.error("Search error:",x),o([])}finally{c(!1)}})()},[h]);const p=S=>{const x=S.title||S.name||"",b=[x,...d.filter(A=>A!==x)].slice(0,5);f(b),localStorage.setItem("searchHistory",JSON.stringify(b)),n(`/${S.media_type}/${S.id}`),t(""),s(!1)},v=S=>{t(S)},g=()=>{f([]),localStorage.removeItem("searchHistory")};return E.jsxs("div",{className:"relative hidden md:block",children:[E.jsxs(Jn,{className:"relative flex items-center",animate:{width:r?260:180},transition:{type:"spring",stiffness:400,damping:30},children:[E.jsx(oc,{className:"absolute left-3 text-neutral-500 pointer-events-none",size:16}),E.jsx("input",{type:"text",placeholder:"Search...",value:e,onChange:S=>t(S.target.value),onFocus:()=>s(!0),onBlur:()=>setTimeout(()=>s(!1),200),className:"w-full h-9 pl-10 pr-3 bg-neutral-800/50 text-white text-sm placeholder-neutral-500 border border-transparent rounded-full transition-colors duration-300 focus:outline-none focus:border-neutral-600 focus:bg-neutral-800"})]}),E.jsx(Ea,{children:r&&(e.length>0||dm.length>0)&&E.jsx(Jn,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"absolute top-full left-0 mt-2 w-full max-w-[350px] bg-neutral-900/80 backdrop-blur-xl border border-neutral-700 rounded-xl shadow-2xl overflow-hidden",children:l?E.jsx("div",{className:"flex items-center justify-center p-6",children:E.jsx("div",{className:"w-6 h-6 border-2 border-red-600 border-t-transparent rounded-full animate-spin"})}):i.length>0?i.map(S=>E.jsxs("div",{onClick:()=>p(S),className:"flex items-center gap-3 p-3 hover:bg-neutral-800 cursor-pointer transition-colors",children:[S.poster_path?E.jsx("img",{src:`https://image.tmdb.org/t/p/w92${S.poster_path}`,alt:S.title||S.name,className:"w-10 h-14 object-cover rounded"}):E.jsx("div",{className:"w-10 h-14 bg-neutral-700 rounded flex items-center justify-center",children:S.media_type==="tv"?E.jsx(Ep,{className:"text-neutral-500"}):E.jsx(Oc,{className:"text-neutral-500"})}),E.jsxs("div",{className:"flex-1",children:[E.jsx("p",{className:"font-semibold text-white text-sm line-clamp-1",children:S.title||S.name}),E.jsxs("p",{className:"text-xs text-neutral-400",children:[S.media_type==="tv"?"TV Series":"Movie",S.release_date&&`  ${S.release_date.split("-")[0]}`]})]})]},S.id)):e.length>1?E.jsxs("p",{className:"text-center text-sm text-neutral-400 p-4",children:['No results for "',e,'"']}):E.jsxs("div",{className:"p-2",children:[E.jsxs("div",{className:"flex items-center justify-between px-3 py-2",children:[E.jsx("h4",{className:"text-xs font-semibold text-neutral-500 uppercase",children:"Recent Searches"}),d.length>0&&E.jsx("button",{onClick:g,className:"text-xs text-neutral-500 hover:text-red-500 transition-colors",children:"Clear"})]}),d.length>0?d.map((S,x)=>E.jsxs("div",{onClick:()=>v(S),className:"flex items-center gap-3 p-3 hover:bg-neutral-800 rounded-md cursor-pointer text-sm text-neutral-200",children:[E.jsx(Sp,{className:"text-neutral-500"}),E.jsx("span",{children:S})]},x)):E.jsx("p",{className:"text-center text-xs text-neutral-500 p-4",children:"No recent searches"})]})})})]})},_b=({children:n,onClose:e})=>E.jsx(Jn,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{type:"spring",damping:20,stiffness:300},className:"absolute top-full right-0 mt-2 sm:mt-4 w-[calc(100vw-2rem)] max-w-[360px] sm:max-w-[400px] rounded-xl sm:rounded-2xl overflow-hidden shadow-2xl z-50 bg-neutral-900/80 backdrop-blur-xl border border-neutral-700",children:n}),PN=({onClose:n})=>E.jsxs(_b,{onClose:n,children:[E.jsxs("div",{className:"p-3 sm:p-4 border-b border-neutral-700 flex items-center justify-between",children:[E.jsx("h3",{className:"font-bold text-white text-base sm:text-lg",children:"Notifications"}),E.jsx("button",{onClick:n,className:"p-1.5 rounded-full hover:bg-neutral-700 transition-colors text-neutral-400 hover:text-white",children:E.jsx(ln,{size:18})})]}),E.jsx("div",{className:"max-h-[70vh] sm:max-h-96 overflow-y-auto scrollbar-hide custom-scrollbar",children:Rb.map((e,t)=>E.jsx(Jn,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:t*.05},className:`p-4 border-b border-neutral-800 cursor-pointer transition-colors hover:bg-neutral-800 ${e.read?"":"bg-red-600/5"}`},e.id))})]}),DN=({onClose:n,user:e})=>{const t=[{icon:nb,label:"My Profile"},{icon:XT,label:"Watchlist"},{icon:qT,label:"Downloads"},{icon:eb,label:"Settings"}];return E.jsxs(_b,{onClose:n,children:[E.jsxs("div",{className:"p-4 sm:p-5",children:[E.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[E.jsx("div",{className:"w-12 h-12 sm:w-14 sm:h-14 rounded-full bg-gradient-to-br from-red-500 to-red-700 flex items-center justify-center text-white font-bold text-xl sm:text-2xl",children:e.avatarInitial}),E.jsxs("div",{children:[E.jsx("h3",{className:"font-bold text-white text-base sm:text-lg line-clamp-1",children:e.name}),E.jsx("p",{className:"text-neutral-400 text-xs sm:text-sm line-clamp-1",children:e.email})]})]}),E.jsx("div",{className:"mt-4 px-2 py-1 bg-gradient-to-r from-red-500 to-red-600 rounded-full text-xs font-bold text-white inline-block",children:e.plan.toUpperCase()})]}),E.jsx("div",{className:"p-2 border-t border-neutral-800",children:t.map((r,s)=>E.jsxs(Sx,{whileHover:{backgroundColor:"rgba(255,255,255,0.05)",x:4},className:"w-full flex items-center gap-4 p-3 rounded-lg text-left",children:[E.jsx(r.icon,{className:"text-neutral-400",size:20}),E.jsx("span",{className:"text-neutral-200 font-medium",children:r.label})]},r.label))}),E.jsx("div",{className:"p-2 border-t border-neutral-700",children:E.jsxs(Sx,{whileHover:{backgroundColor:"rgba(255,255,255,0.05)",x:4},className:"w-full flex items-center gap-4 p-3 rounded-lg text-left",children:[E.jsx(QT,{className:"text-red-500",size:20}),E.jsx("span",{className:"text-red-500 font-medium",children:"Sign Out"})]})})]})},NN=({isOpen:n,onClose:e})=>{const t=hn(),r=Tr(),s=[{icon:KP,label:"Home",path:"/"},{icon:Oc,label:"Movies",path:"/movies"},{icon:Ep,label:"Series",path:"/series"},{icon:tb,label:"New & Popular",path:"/new-popular"},{icon:im,label:"Live TV",path:"/live-tv",live:!0},{icon:XT,label:"My Watchlist",path:"/watchlist"},{icon:qT,label:"Downloads",path:"/downloads"},{icon:eb,label:"Settings",path:"/settings"}],i=o=>{t(o),e()};return E.jsx(Ea,{children:n&&E.jsxs(E.Fragment,{children:[E.jsx(Jn,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:e,className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 md:hidden"}),E.jsxs(Jn,{initial:{x:"-100%"},animate:{x:0},exit:{x:"-100%"},transition:{type:"spring",damping:25,stiffness:200},className:"fixed left-0 top-0 bottom-0 w-[85vw] max-w-[320px] bg-neutral-900 z-50 md:hidden overflow-y-auto hide-scrollbar-mobile",children:[E.jsxs("div",{className:"p-4 border-b border-neutral-800 flex items-center justify-between sticky top-0 bg-neutral-900 z-10",children:[E.jsxs("div",{className:"flex items-center gap-3",children:[E.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-red-500 to-red-700 flex items-center justify-center text-white font-bold text-lg",children:da.avatarInitial}),E.jsxs("div",{children:[E.jsx("h3",{className:"font-bold text-white text-sm line-clamp-1",children:da.name}),E.jsx("p",{className:"text-neutral-400 text-xs",children:da.plan})]})]}),E.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-neutral-800 transition-colors touch-target",children:E.jsx(ln,{className:"text-white",size:22})})]}),E.jsx("div",{className:"p-2 mt-2",children:s.map((o,l)=>{const c=r.pathname===o.path;return E.jsx(Jn,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:l*.05},children:E.jsxs("button",{onClick:()=>i(o.path),className:`w-full flex items-center gap-4 p-4 rounded-lg transition-colors touch-target ${c?"bg-red-600 text-white":"text-neutral-300 hover:bg-neutral-800"}`,children:[E.jsx(o.icon,{size:22}),E.jsx("span",{className:"font-medium text-base flex-1 text-left",children:o.label}),o.live&&E.jsxs("span",{className:"relative flex h-2.5 w-2.5",children:[E.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-500 opacity-75"}),E.jsx("span",{className:"relative inline-flex rounded-full h-2.5 w-2.5 bg-red-600"})]})]})},o.path)})}),E.jsx("div",{className:"p-4 mt-auto border-t border-neutral-800",children:E.jsxs("button",{className:"w-full flex items-center gap-4 p-4 rounded-lg text-red-500 hover:bg-neutral-800 transition-colors touch-target",children:[E.jsx(QT,{size:22}),E.jsx("span",{className:"font-medium text-base",children:"Sign Out"})]})})]})]})})},ON=({isOpen:n,onClose:e})=>{const t=hn(),[r,s]=N.useState(""),[i,o]=N.useState([]),[l,c]=N.useState(!1),[d,f]=N.useState(()=>{const x=localStorage.getItem("searchHistory");return x?JSON.parse(x):dm}),h=Ib(r,500),p=N.useRef(null);N.useEffect(()=>{n&&p.current&&setTimeout(()=>p.current?.focus(),100)},[n]),N.useEffect(()=>{if(!h||h.trim().length<2){o([]),c(!1);return}(async()=>{c(!0);try{const A=(await Ye.get(`${st.TMDB_BASE_URL}/search/multi?api_key=${st.TMDB_API_KEY}&query=${encodeURIComponent(h)}&page=1`)).data.results.filter(L=>L.media_type==="movie"||L.media_type==="tv").slice(0,10);o(A)}catch(b){console.error("Search error:",b),o([])}finally{c(!1)}})()},[h]);const v=x=>{const b=x.title||x.name||"",A=[b,...d.filter(L=>L!==b)].slice(0,5);f(A),localStorage.setItem("searchHistory",JSON.stringify(A)),t(`/${x.media_type}/${x.id}`),s(""),e()},g=x=>{s(x)},S=()=>{f([]),localStorage.removeItem("searchHistory")};return E.jsx(Ea,{children:n&&E.jsxs(Jn,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-neutral-900 z-50 md:hidden flex flex-col",children:[E.jsxs("div",{className:"flex items-center gap-3 p-4 border-b border-neutral-800",children:[E.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-neutral-800 transition-colors touch-target",children:E.jsx(ln,{className:"text-white",size:22})}),E.jsxs("div",{className:"flex-1 relative",children:[E.jsx(oc,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-neutral-500",size:18}),E.jsx("input",{ref:p,type:"text",placeholder:"Search movies & series...",value:r,onChange:x=>s(x.target.value),className:"w-full h-12 pl-12 pr-4 bg-neutral-800 text-white text-base placeholder-neutral-500 rounded-full focus:outline-none focus:ring-2 focus:ring-red-600 touch-target"})]})]}),E.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar-mobile",children:l?E.jsx("div",{className:"flex items-center justify-center p-12",children:E.jsx("div",{className:"w-8 h-8 border-2 border-red-600 border-t-transparent rounded-full animate-spin"})}):i.length>0?E.jsx("div",{className:"p-2",children:i.map(x=>E.jsxs("div",{onClick:()=>v(x),className:"flex items-center gap-4 p-4 hover:bg-neutral-800 rounded-lg cursor-pointer transition-colors touch-target",children:[x.poster_path?E.jsx("img",{src:`https://image.tmdb.org/t/p/w92${x.poster_path}`,alt:x.title||x.name,className:"w-12 h-16 object-cover rounded"}):E.jsx("div",{className:"w-12 h-16 bg-neutral-700 rounded flex items-center justify-center",children:x.media_type==="tv"?E.jsx(Ep,{className:"text-neutral-500",size:20}):E.jsx(Oc,{className:"text-neutral-500",size:20})}),E.jsxs("div",{className:"flex-1",children:[E.jsx("p",{className:"font-semibold text-white text-base line-clamp-1",children:x.title||x.name}),E.jsxs("p",{className:"text-sm text-neutral-400",children:[x.media_type==="tv"?"TV Series":"Movie",x.release_date&&`  ${x.release_date.split("-")[0]}`]})]})]},x.id))}):r.length>1?E.jsxs("div",{className:"text-center p-12",children:[E.jsx(oc,{className:"mx-auto text-neutral-600 mb-3",size:40}),E.jsxs("p",{className:"text-neutral-400",children:['No results for "',r,'"']})]}):E.jsxs("div",{className:"p-4",children:[E.jsxs("div",{className:"flex items-center justify-between mb-4",children:[E.jsx("h4",{className:"text-sm font-semibold text-neutral-400 uppercase",children:"Recent Searches"}),d.length>0&&E.jsx("button",{onClick:S,className:"text-sm text-neutral-500 hover:text-red-500 transition-colors touch-target",children:"Clear"})]}),d.length>0?E.jsx("div",{className:"space-y-2",children:d.map((x,b)=>E.jsxs("div",{onClick:()=>g(x),className:"flex items-center gap-4 p-4 hover:bg-neutral-800 rounded-lg cursor-pointer text-base text-neutral-200 touch-target",children:[E.jsx(Sp,{className:"text-neutral-500",size:20}),E.jsx("span",{children:x})]},b))}):E.jsx("p",{className:"text-center text-neutral-500 p-8",children:"No recent searches"})]})})]})})};function MN(){const n=IN(),[e,t]=N.useState(null),[r,s]=N.useState(!1),[i,o]=N.useState(!1),l=n>10,c=N.useCallback(()=>{t(null),s(!1),o(!1)},[]),d=Rb.filter(f=>!f.read).length;return E.jsxs(E.Fragment,{children:[E.jsx(NN,{isOpen:r,onClose:()=>s(!1)}),E.jsx(ON,{isOpen:i,onClose:()=>o(!1)}),E.jsx(Jn,{className:"fixed top-0 left-0 right-0 z-40 transition-colors duration-300",animate:{background:l?"rgba(10, 10, 10, 0.95)":"linear-gradient(180deg, rgba(10,10,10,0.8) 0%, transparent 100%)",backdropFilter:l?"blur(20px)":"blur(10px)",borderBottom:l?"1px solid rgba(255, 255, 255, 0.1)":"1px solid transparent"},children:E.jsxs("div",{className:"flex items-center justify-between px-3 sm:px-4 md:px-6 h-14 sm:h-18 md:h-20 max-w-7xl mx-auto",children:[E.jsxs("div",{className:"flex items-center gap-2 sm:gap-8",children:[E.jsx("button",{onClick:()=>s(!0),className:"md:hidden p-2 rounded-full text-neutral-300 hover:text-white hover:bg-neutral-700/50 transition-colors touch-target",children:E.jsx(YP,{size:22})}),E.jsx(_N,{}),E.jsx(CN,{})]}),E.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 md:gap-4",children:[E.jsx(kN,{}),E.jsx("button",{onClick:()=>o(!0),className:"md:hidden p-2 rounded-full text-neutral-300 hover:text-white hover:bg-neutral-700/50 transition-colors touch-target",children:E.jsx(oc,{size:20})}),E.jsxs("div",{className:"relative",children:[E.jsxs("button",{onClick:()=>t(f=>f==="notifications"?null:"notifications"),className:"p-2 sm:p-2.5 rounded-full text-neutral-300 hover:text-white hover:bg-neutral-700/50 transition-colors touch-target",children:[d>0&&E.jsx(Jn,{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-600 rounded-full flex items-center justify-center text-xs font-bold text-white border-2 border-neutral-900",children:d}),E.jsx(jP,{size:20})]}),E.jsx(Ea,{children:e==="notifications"&&E.jsx(PN,{onClose:c})})]}),E.jsxs("div",{className:"relative",children:[E.jsx("button",{onClick:()=>t(f=>f==="profile"?null:"profile"),className:"w-9 h-9 sm:w-10 sm:h-10 rounded-full bg-gradient-to-br from-red-500 to-red-700 flex items-center justify-center text-white font-bold text-base sm:text-lg touch-target",children:da.avatarInitial}),E.jsx(Ea,{children:e==="profile"&&E.jsx(DN,{onClose:c,user:da})})]})]})]})})]})}function FN(n){return Object.prototype.toString.call(n)==="[object Object]"}function Ex(n){return FN(n)||Array.isArray(n)}function BN(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function Ap(n,e){const t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;const s=JSON.stringify(Object.keys(n.breakpoints||{})),i=JSON.stringify(Object.keys(e.breakpoints||{}));return s!==i?!1:t.every(o=>{const l=n[o],c=e[o];return typeof l=="function"?`${l}`==`${c}`:!Ex(l)||!Ex(c)?l===c:Ap(l,c)})}function Tx(n){return n.concat().sort((e,t)=>e.name>t.name?1:-1).map(e=>e.options)}function UN(n,e){if(n.length!==e.length)return!1;const t=Tx(n),r=Tx(e);return t.every((s,i)=>{const o=r[i];return Ap(s,o)})}function Lp(n){return typeof n=="number"}function fm(n){return typeof n=="string"}function jc(n){return typeof n=="boolean"}function bx(n){return Object.prototype.toString.call(n)==="[object Object]"}function mt(n){return Math.abs(n)}function Rp(n){return Math.sign(n)}function fa(n,e){return mt(n-e)}function $N(n,e){if(n===0||e===0||mt(n)<=mt(e))return 0;const t=fa(mt(n),mt(e));return mt(t/n)}function jN(n){return Math.round(n*100)/100}function ba(n){return wa(n).map(Number)}function Zn(n){return n[Ya(n)]}function Ya(n){return Math.max(0,n.length-1)}function Ip(n,e){return e===Ya(n)}function wx(n,e=0){return Array.from(Array(n),(t,r)=>e+r)}function wa(n){return Object.keys(n)}function Cb(n,e){return[n,e].reduce((t,r)=>(wa(r).forEach(s=>{const i=t[s],o=r[s],l=bx(i)&&bx(o);t[s]=l?Cb(i,o):o}),t),{})}function hm(n,e){return typeof e.MouseEvent<"u"&&n instanceof e.MouseEvent}function VN(n,e){const t={start:r,center:s,end:i};function r(){return 0}function s(c){return i(c)/2}function i(c){return e-c}function o(c,d){return fm(n)?t[n](c):n(e,c,d)}return{measure:o}}function Aa(){let n=[];function e(s,i,o,l={passive:!0}){let c;if("addEventListener"in s)s.addEventListener(i,o,l),c=()=>s.removeEventListener(i,o,l);else{const d=s;d.addListener(o),c=()=>d.removeListener(o)}return n.push(c),r}function t(){n=n.filter(s=>s())}const r={add:e,clear:t};return r}function GN(n,e,t,r){const s=Aa(),i=1e3/60;let o=null,l=0,c=0;function d(){s.add(n,"visibilitychange",()=>{n.hidden&&g()})}function f(){v(),s.clear()}function h(x){if(!c)return;o||(o=x,t(),t());const b=x-o;for(o=x,l+=b;l>=i;)t(),l-=i;const A=l/i;r(A),c&&(c=e.requestAnimationFrame(h))}function p(){c||(c=e.requestAnimationFrame(h))}function v(){e.cancelAnimationFrame(c),o=null,l=0,c=0}function g(){o=null,l=0}return{init:d,destroy:f,start:p,stop:v,update:t,render:r}}function HN(n,e){const t=e==="rtl",r=n==="y",s=r?"y":"x",i=r?"x":"y",o=!r&&t?-1:1,l=f(),c=h();function d(g){const{height:S,width:x}=g;return r?S:x}function f(){return r?"top":t?"right":"left"}function h(){return r?"bottom":t?"left":"right"}function p(g){return g*o}return{scroll:s,cross:i,startEdge:l,endEdge:c,measureSize:d,direction:p}}function si(n=0,e=0){const t=mt(n-e);function r(d){return d<n}function s(d){return d>e}function i(d){return r(d)||s(d)}function o(d){return i(d)?r(d)?n:e:d}function l(d){return t?d-t*Math.ceil((d-e)/t):d}return{length:t,max:e,min:n,constrain:o,reachedAny:i,reachedMax:s,reachedMin:r,removeOffset:l}}function kb(n,e,t){const{constrain:r}=si(0,n),s=n+1;let i=o(e);function o(p){return t?mt((s+p)%s):r(p)}function l(){return i}function c(p){return i=o(p),h}function d(p){return f().set(l()+p)}function f(){return kb(n,l(),t)}const h={get:l,set:c,add:d,clone:f};return h}function KN(n,e,t,r,s,i,o,l,c,d,f,h,p,v,g,S,x,b,A){const{cross:L,direction:I}=n,k=["INPUT","SELECT","TEXTAREA"],F={passive:!1},C=Aa(),P=Aa(),O=si(50,225).constrain(v.measure(20)),M={mouse:300,touch:400},H={mouse:500,touch:600},Z=g?43:25;let se=!1,U=0,ne=0,q=!1,te=!1,G=!1,Q=!1;function ee(Te){if(!A)return;function xe($e){(jc(A)||A(Te,$e))&&fe($e)}const Re=e;C.add(Re,"dragstart",$e=>$e.preventDefault(),F).add(Re,"touchmove",()=>{},F).add(Re,"touchend",()=>{}).add(Re,"touchstart",xe).add(Re,"mousedown",xe).add(Re,"touchcancel",ye).add(Re,"contextmenu",ye).add(Re,"click",Le,!0)}function D(){C.clear(),P.clear()}function $(){const Te=Q?t:e;P.add(Te,"touchmove",Ee,F).add(Te,"touchend",ye).add(Te,"mousemove",Ee,F).add(Te,"mouseup",ye)}function ie(Te){const xe=Te.nodeName||"";return k.includes(xe)}function ue(){return(g?H:M)[Q?"mouse":"touch"]}function ce(Te,xe){const Re=h.add(Rp(Te)*-1),$e=f.byDistance(Te,!g).distance;return g||mt(Te)<O?$e:x&&xe?$e*.5:f.byIndex(Re.get(),0).distance}function fe(Te){const xe=hm(Te,r);Q=xe,G=g&&xe&&!Te.buttons&&se,se=fa(s.get(),o.get())>=2,!(xe&&Te.button!==0)&&(ie(Te.target)||(q=!0,i.pointerDown(Te),d.useFriction(0).useDuration(0),s.set(o),$(),U=i.readPoint(Te),ne=i.readPoint(Te,L),p.emit("pointerDown")))}function Ee(Te){if(!hm(Te,r)&&Te.touches.length>=2)return ye(Te);const Re=i.readPoint(Te),$e=i.readPoint(Te,L),me=fa(Re,U),Me=fa($e,ne);if(!te&&!Q&&(!Te.cancelable||(te=me>Me,!te)))return ye(Te);const qe=i.pointerMove(Te);me>S&&(G=!0),d.useFriction(.3).useDuration(.75),l.start(),s.add(I(qe)),Te.preventDefault()}function ye(Te){const Re=f.byDistance(0,!1).index!==h.get(),$e=i.pointerUp(Te)*ue(),me=ce(I($e),Re),Me=$N($e,me),qe=Z-10*Me,je=b+Me/50;te=!1,q=!1,P.clear(),d.useDuration(qe).useFriction(je),c.distance(me,!g),Q=!1,p.emit("pointerUp")}function Le(Te){G&&(Te.stopPropagation(),Te.preventDefault(),G=!1)}function ke(){return q}return{init:ee,destroy:D,pointerDown:ke}}function zN(n,e){let r,s;function i(h){return h.timeStamp}function o(h,p){const g=`client${(p||n.scroll)==="x"?"X":"Y"}`;return(hm(h,e)?h:h.touches[0])[g]}function l(h){return r=h,s=h,o(h)}function c(h){const p=o(h)-o(s),v=i(h)-i(r)>170;return s=h,v&&(r=h),p}function d(h){if(!r||!s)return 0;const p=o(s)-o(r),v=i(h)-i(r),g=i(h)-i(s)>170,S=p/v;return v&&!g&&mt(S)>.1?S:0}return{pointerDown:l,pointerMove:c,pointerUp:d,readPoint:o}}function WN(){function n(t){const{offsetTop:r,offsetLeft:s,offsetWidth:i,offsetHeight:o}=t;return{top:r,right:s+i,bottom:r+o,left:s,width:i,height:o}}return{measure:n}}function YN(n){function e(r){return n*(r/100)}return{measure:e}}function qN(n,e,t,r,s,i,o){const l=[n].concat(r);let c,d,f=[],h=!1;function p(x){return s.measureSize(o.measure(x))}function v(x){if(!i)return;d=p(n),f=r.map(p);function b(A){for(const L of A){if(h)return;const I=L.target===n,k=r.indexOf(L.target),F=I?d:f[k],C=p(I?n:r[k]);if(mt(C-F)>=.5){x.reInit(),e.emit("resize");break}}}c=new ResizeObserver(A=>{(jc(i)||i(x,A))&&b(A)}),t.requestAnimationFrame(()=>{l.forEach(A=>c.observe(A))})}function g(){h=!0,c&&c.disconnect()}return{init:v,destroy:g}}function XN(n,e,t,r,s,i){let o=0,l=0,c=s,d=i,f=n.get(),h=0;function p(){const F=r.get()-n.get(),C=!c;let P=0;return C?(o=0,t.set(r),n.set(r),P=F):(t.set(n),o+=F/c,o*=d,f+=o,n.add(o),P=f-h),l=Rp(P),h=f,k}function v(){const F=r.get()-e.get();return mt(F)<.001}function g(){return c}function S(){return l}function x(){return o}function b(){return L(s)}function A(){return I(i)}function L(F){return c=F,k}function I(F){return d=F,k}const k={direction:S,duration:g,velocity:x,seek:p,settled:v,useBaseFriction:A,useBaseDuration:b,useFriction:I,useDuration:L};return k}function QN(n,e,t,r,s){const i=s.measure(10),o=s.measure(50),l=si(.1,.99);let c=!1;function d(){return!(c||!n.reachedAny(t.get())||!n.reachedAny(e.get()))}function f(v){if(!d())return;const g=n.reachedMin(e.get())?"min":"max",S=mt(n[g]-e.get()),x=t.get()-e.get(),b=l.constrain(S/o);t.subtract(x*b),!v&&mt(x)<i&&(t.set(n.constrain(t.get())),r.useDuration(25).useBaseFriction())}function h(v){c=!v}return{shouldConstrain:d,constrain:f,toggleActive:h}}function JN(n,e,t,r,s){const i=si(-e+n,0),o=h(),l=f(),c=p();function d(g,S){return fa(g,S)<=1}function f(){const g=o[0],S=Zn(o),x=o.lastIndexOf(g),b=o.indexOf(S)+1;return si(x,b)}function h(){return t.map((g,S)=>{const{min:x,max:b}=i,A=i.constrain(g),L=!S,I=Ip(t,S);return L?b:I||d(x,A)?x:d(b,A)?b:A}).map(g=>parseFloat(g.toFixed(3)))}function p(){if(e<=n+s)return[i.max];if(r==="keepSnaps")return o;const{min:g,max:S}=l;return o.slice(g,S)}return{snapsContained:c,scrollContainLimit:l}}function ZN(n,e,t){const r=e[0],s=t?r-n:Zn(e);return{limit:si(s,r)}}function eO(n,e,t,r){const i=e.min+.1,o=e.max+.1,{reachedMin:l,reachedMax:c}=si(i,o);function d(p){return p===1?c(t.get()):p===-1?l(t.get()):!1}function f(p){if(!d(p))return;const v=n*(p*-1);r.forEach(g=>g.add(v))}return{loop:f}}function tO(n){const{max:e,length:t}=n;function r(i){const o=i-e;return t?o/-t:0}return{get:r}}function nO(n,e,t,r,s){const{startEdge:i,endEdge:o}=n,{groupSlides:l}=s,c=h().map(e.measure),d=p(),f=v();function h(){return l(r).map(S=>Zn(S)[o]-S[0][i]).map(mt)}function p(){return r.map(S=>t[i]-S[i]).map(S=>-mt(S))}function v(){return l(d).map(S=>S[0]).map((S,x)=>S+c[x])}return{snaps:d,snapsAligned:f}}function rO(n,e,t,r,s,i){const{groupSlides:o}=s,{min:l,max:c}=r,d=f();function f(){const p=o(i),v=!n||e==="keepSnaps";return t.length===1?[i]:v?p:p.slice(l,c).map((g,S,x)=>{const b=!S,A=Ip(x,S);if(b){const L=Zn(x[0])+1;return wx(L)}if(A){const L=Ya(i)-Zn(x)[0]+1;return wx(L,Zn(x)[0])}return g})}return{slideRegistry:d}}function sO(n,e,t,r,s){const{reachedAny:i,removeOffset:o,constrain:l}=r;function c(g){return g.concat().sort((S,x)=>mt(S)-mt(x))[0]}function d(g){const S=n?o(g):l(g),x=e.map((A,L)=>({diff:f(A-S,0),index:L})).sort((A,L)=>mt(A.diff)-mt(L.diff)),{index:b}=x[0];return{index:b,distance:S}}function f(g,S){const x=[g,g+t,g-t];if(!n)return g;if(!S)return c(x);const b=x.filter(A=>Rp(A)===S);return b.length?c(b):Zn(x)-t}function h(g,S){const x=e[g]-s.get(),b=f(x,S);return{index:g,distance:b}}function p(g,S){const x=s.get()+g,{index:b,distance:A}=d(x),L=!n&&i(x);if(!S||L)return{index:b,distance:g};const I=e[b]-A,k=g+f(I,0);return{index:b,distance:k}}return{byDistance:p,byIndex:h,shortcut:f}}function iO(n,e,t,r,s,i,o){function l(h){const p=h.distance,v=h.index!==e.get();i.add(p),p&&(r.duration()?n.start():(n.update(),n.render(1),n.update())),v&&(t.set(e.get()),e.set(h.index),o.emit("select"))}function c(h,p){const v=s.byDistance(h,p);l(v)}function d(h,p){const v=e.clone().set(h),g=s.byIndex(v.get(),p);l(g)}return{distance:c,index:d}}function oO(n,e,t,r,s,i,o,l){const c={passive:!0,capture:!0};let d=0;function f(v){if(!l)return;function g(S){if(new Date().getTime()-d>10)return;o.emit("slideFocusStart"),n.scrollLeft=0;const A=t.findIndex(L=>L.includes(S));Lp(A)&&(s.useDuration(0),r.index(A,0),o.emit("slideFocus"))}i.add(document,"keydown",h,!1),e.forEach((S,x)=>{i.add(S,"focus",b=>{(jc(l)||l(v,b))&&g(x)},c)})}function h(v){v.code==="Tab"&&(d=new Date().getTime())}return{init:f}}function sa(n){let e=n;function t(){return e}function r(c){e=o(c)}function s(c){e+=o(c)}function i(c){e-=o(c)}function o(c){return Lp(c)?c:c.get()}return{get:t,set:r,add:s,subtract:i}}function Pb(n,e){const t=n.scroll==="x"?o:l,r=e.style;let s=null,i=!1;function o(p){return`translate3d(${p}px,0px,0px)`}function l(p){return`translate3d(0px,${p}px,0px)`}function c(p){if(i)return;const v=jN(n.direction(p));v!==s&&(r.transform=t(v),s=v)}function d(p){i=!p}function f(){i||(r.transform="",e.getAttribute("style")||e.removeAttribute("style"))}return{clear:f,to:c,toggleActive:d}}function aO(n,e,t,r,s,i,o,l,c){const f=ba(s),h=ba(s).reverse(),p=b().concat(A());function v(C,P){return C.reduce((O,M)=>O-s[M],P)}function g(C,P){return C.reduce((O,M)=>v(O,P)>0?O.concat([M]):O,[])}function S(C){return i.map((P,O)=>({start:P-r[O]+.5+C,end:P+e-.5+C}))}function x(C,P,O){const M=S(P);return C.map(H=>{const Z=O?0:-t,se=O?t:0,U=O?"end":"start",ne=M[H][U];return{index:H,loopPoint:ne,slideLocation:sa(-1),translate:Pb(n,c[H]),target:()=>l.get()>ne?Z:se}})}function b(){const C=o[0],P=g(h,C);return x(P,t,!1)}function A(){const C=e-o[0]-1,P=g(f,C);return x(P,-t,!0)}function L(){return p.every(({index:C})=>{const P=f.filter(O=>O!==C);return v(P,e)<=.1})}function I(){p.forEach(C=>{const{target:P,translate:O,slideLocation:M}=C,H=P();H!==M.get()&&(O.to(H),M.set(H))})}function k(){p.forEach(C=>C.translate.clear())}return{canLoop:L,clear:k,loop:I,loopPoints:p}}function lO(n,e,t){let r,s=!1;function i(c){if(!t)return;function d(f){for(const h of f)if(h.type==="childList"){c.reInit(),e.emit("slidesChanged");break}}r=new MutationObserver(f=>{s||(jc(t)||t(c,f))&&d(f)}),r.observe(n,{childList:!0})}function o(){r&&r.disconnect(),s=!0}return{init:i,destroy:o}}function uO(n,e,t,r){const s={};let i=null,o=null,l,c=!1;function d(){l=new IntersectionObserver(g=>{c||(g.forEach(S=>{const x=e.indexOf(S.target);s[x]=S}),i=null,o=null,t.emit("slidesInView"))},{root:n.parentElement,threshold:r}),e.forEach(g=>l.observe(g))}function f(){l&&l.disconnect(),c=!0}function h(g){return wa(s).reduce((S,x)=>{const b=parseInt(x),{isIntersecting:A}=s[b];return(g&&A||!g&&!A)&&S.push(b),S},[])}function p(g=!0){if(g&&i)return i;if(!g&&o)return o;const S=h(g);return g&&(i=S),g||(o=S),S}return{init:d,destroy:f,get:p}}function cO(n,e,t,r,s,i){const{measureSize:o,startEdge:l,endEdge:c}=n,d=t[0]&&s,f=g(),h=S(),p=t.map(o),v=x();function g(){if(!d)return 0;const A=t[0];return mt(e[l]-A[l])}function S(){if(!d)return 0;const A=i.getComputedStyle(Zn(r));return parseFloat(A.getPropertyValue(`margin-${c}`))}function x(){return t.map((A,L,I)=>{const k=!L,F=Ip(I,L);return k?p[L]+f:F?p[L]+h:I[L+1][l]-A[l]}).map(mt)}return{slideSizes:p,slideSizesWithGaps:v,startGap:f,endGap:h}}function dO(n,e,t,r,s,i,o,l,c){const{startEdge:d,endEdge:f,direction:h}=n,p=Lp(t);function v(b,A){return ba(b).filter(L=>L%A===0).map(L=>b.slice(L,L+A))}function g(b){return b.length?ba(b).reduce((A,L,I)=>{const k=Zn(A)||0,F=k===0,C=L===Ya(b),P=s[d]-i[k][d],O=s[d]-i[L][f],M=!r&&F?h(o):0,H=!r&&C?h(l):0,Z=mt(O-H-(P+M));return I&&Z>e+c&&A.push(L),C&&A.push(b.length),A},[]).map((A,L,I)=>{const k=Math.max(I[L-1]||0);return b.slice(k,A)}):[]}function S(b){return p?v(b,t):g(b)}return{groupSlides:S}}function fO(n,e,t,r,s,i,o){const{align:l,axis:c,direction:d,startIndex:f,loop:h,duration:p,dragFree:v,dragThreshold:g,inViewThreshold:S,slidesToScroll:x,skipSnaps:b,containScroll:A,watchResize:L,watchSlides:I,watchDrag:k,watchFocus:F}=i,C=2,P=WN(),O=P.measure(e),M=t.map(P.measure),H=HN(c,d),Z=H.measureSize(O),se=YN(Z),U=VN(l,Z),ne=!h&&!!A,q=h||!!A,{slideSizes:te,slideSizesWithGaps:G,startGap:Q,endGap:ee}=cO(H,O,M,t,q,s),D=dO(H,Z,x,h,O,M,Q,ee,C),{snaps:$,snapsAligned:ie}=nO(H,U,O,M,D),ue=-Zn($)+Zn(G),{snapsContained:ce,scrollContainLimit:fe}=JN(Z,ue,ie,A,C),Ee=ne?ce:ie,{limit:ye}=ZN(ue,Ee,h),Le=kb(Ya(Ee),f,h),ke=Le.clone(),Pe=ba(t),Te=({dragHandler:Yt,scrollBody:qt,scrollBounds:io,options:{loop:_s}})=>{_s||io.constrain(Yt.pointerDown()),qt.seek()},xe=({scrollBody:Yt,translate:qt,location:io,offsetLocation:_s,previousLocation:Qa,scrollLooper:Xc,slideLooper:oo,dragHandler:ao,animation:lo,eventHandler:ci,scrollBounds:uo,options:{loop:br}},wr)=>{const co=Yt.settled(),Ja=!uo.shouldConstrain(),fo=br?co:co&&Ja,ho=fo&&!ao.pointerDown();ho&&lo.stop();const Za=io.get()*wr+Qa.get()*(1-wr);_s.set(Za),br&&(Xc.loop(Yt.direction()),oo.loop()),qt.to(_s.get()),ho&&ci.emit("settle"),fo||ci.emit("scroll")},Re=GN(r,s,()=>Te(gn),Yt=>xe(gn,Yt)),$e=.68,me=Ee[Le.get()],Me=sa(me),qe=sa(me),je=sa(me),Be=sa(me),Xe=XN(Me,je,qe,Be,p,$e),Ct=sO(h,Ee,ue,ye,Be),Cn=iO(Re,Le,ke,Xe,Ct,Be,o),mn=tO(ye),vt=Aa(),bt=uO(e,t,o,S),{slideRegistry:pn}=rO(ne,A,Ee,fe,D,Pe),tr=oO(n,t,pn,Cn,Xe,vt,o,F),gn={ownerDocument:r,ownerWindow:s,eventHandler:o,containerRect:O,slideRects:M,animation:Re,axis:H,dragHandler:KN(H,n,r,s,Be,zN(H,s),Me,Re,Cn,Xe,Ct,Le,o,se,v,g,b,$e,k),eventStore:vt,percentOfView:se,index:Le,indexPrevious:ke,limit:ye,location:Me,offsetLocation:je,previousLocation:qe,options:i,resizeHandler:qN(e,o,s,t,H,L,P),scrollBody:Xe,scrollBounds:QN(ye,je,Be,Xe,se),scrollLooper:eO(ue,ye,je,[Me,je,qe,Be]),scrollProgress:mn,scrollSnapList:Ee.map(mn.get),scrollSnaps:Ee,scrollTarget:Ct,scrollTo:Cn,slideLooper:aO(H,Z,ue,te,G,$,Ee,je,t),slideFocus:tr,slidesHandler:lO(e,o,I),slidesInView:bt,slideIndexes:Pe,slideRegistry:pn,slidesToScroll:D,target:Be,translate:Pb(H,e)};return gn}function hO(){let n={},e;function t(d){e=d}function r(d){return n[d]||[]}function s(d){return r(d).forEach(f=>f(e,d)),c}function i(d,f){return n[d]=r(d).concat([f]),c}function o(d,f){return n[d]=r(d).filter(h=>h!==f),c}function l(){n={}}const c={init:t,emit:s,off:o,on:i,clear:l};return c}const mO={align:"center",axis:"x",container:null,slides:null,containScroll:"trimSnaps",direction:"ltr",slidesToScroll:1,inViewThreshold:0,breakpoints:{},dragFree:!1,dragThreshold:10,loop:!1,skipSnaps:!1,duration:25,startIndex:0,active:!0,watchDrag:!0,watchResize:!0,watchSlides:!0,watchFocus:!0};function pO(n){function e(i,o){return Cb(i,o||{})}function t(i){const o=i.breakpoints||{},l=wa(o).filter(c=>n.matchMedia(c).matches).map(c=>o[c]).reduce((c,d)=>e(c,d),{});return e(i,l)}function r(i){return i.map(o=>wa(o.breakpoints||{})).reduce((o,l)=>o.concat(l),[]).map(n.matchMedia)}return{mergeOptions:e,optionsAtMedia:t,optionsMediaQueries:r}}function gO(n){let e=[];function t(i,o){return e=o.filter(({options:l})=>n.optionsAtMedia(l).active!==!1),e.forEach(l=>l.init(i,n)),o.reduce((l,c)=>Object.assign(l,{[c.name]:c}),{})}function r(){e=e.filter(i=>i.destroy())}return{init:t,destroy:r}}function lc(n,e,t){const r=n.ownerDocument,s=r.defaultView,i=pO(s),o=gO(i),l=Aa(),c=hO(),{mergeOptions:d,optionsAtMedia:f,optionsMediaQueries:h}=i,{on:p,off:v,emit:g}=c,S=H;let x=!1,b,A=d(mO,lc.globalOptions),L=d(A),I=[],k,F,C;function P(){const{container:Pe,slides:Te}=L;F=(fm(Pe)?n.querySelector(Pe):Pe)||n.children[0];const Re=fm(Te)?F.querySelectorAll(Te):Te;C=[].slice.call(Re||F.children)}function O(Pe){const Te=fO(n,F,C,r,s,Pe,c);if(Pe.loop&&!Te.slideLooper.canLoop()){const xe=Object.assign({},Pe,{loop:!1});return O(xe)}return Te}function M(Pe,Te){x||(A=d(A,Pe),L=f(A),I=Te||I,P(),b=O(L),h([A,...I.map(({options:xe})=>xe)]).forEach(xe=>l.add(xe,"change",H)),L.active&&(b.translate.to(b.location.get()),b.animation.init(),b.slidesInView.init(),b.slideFocus.init(ke),b.eventHandler.init(ke),b.resizeHandler.init(ke),b.slidesHandler.init(ke),b.options.loop&&b.slideLooper.loop(),F.offsetParent&&C.length&&b.dragHandler.init(ke),k=o.init(ke,I)))}function H(Pe,Te){const xe=D();Z(),M(d({startIndex:xe},Pe),Te),c.emit("reInit")}function Z(){b.dragHandler.destroy(),b.eventStore.clear(),b.translate.clear(),b.slideLooper.clear(),b.resizeHandler.destroy(),b.slidesHandler.destroy(),b.slidesInView.destroy(),b.animation.destroy(),o.destroy(),l.clear()}function se(){x||(x=!0,l.clear(),Z(),c.emit("destroy"),c.clear())}function U(Pe,Te,xe){!L.active||x||(b.scrollBody.useBaseFriction().useDuration(Te===!0?0:L.duration),b.scrollTo.index(Pe,xe||0))}function ne(Pe){const Te=b.index.add(1).get();U(Te,Pe,-1)}function q(Pe){const Te=b.index.add(-1).get();U(Te,Pe,1)}function te(){return b.index.add(1).get()!==D()}function G(){return b.index.add(-1).get()!==D()}function Q(){return b.scrollSnapList}function ee(){return b.scrollProgress.get(b.offsetLocation.get())}function D(){return b.index.get()}function $(){return b.indexPrevious.get()}function ie(){return b.slidesInView.get()}function ue(){return b.slidesInView.get(!1)}function ce(){return k}function fe(){return b}function Ee(){return n}function ye(){return F}function Le(){return C}const ke={canScrollNext:te,canScrollPrev:G,containerNode:ye,internalEngine:fe,destroy:se,off:v,on:p,emit:g,plugins:ce,previousScrollSnap:$,reInit:S,rootNode:Ee,scrollNext:ne,scrollPrev:q,scrollProgress:ee,scrollSnapList:Q,scrollTo:U,selectedScrollSnap:D,slideNodes:Le,slidesInView:ie,slidesNotInView:ue};return M(e,t),setTimeout(()=>c.emit("init"),0),ke}lc.globalOptions=void 0;function Vc(n={},e=[]){const t=N.useRef(n),r=N.useRef(e),[s,i]=N.useState(),[o,l]=N.useState(),c=N.useCallback(()=>{s&&s.reInit(t.current,r.current)},[s]);return N.useEffect(()=>{Ap(t.current,n)||(t.current=n,c())},[n,c]),N.useEffect(()=>{UN(r.current,e)||(r.current=e,c())},[e,c]),N.useEffect(()=>{if(BN()&&o){lc.globalOptions=Vc.globalOptions;const d=lc(o,t.current,r.current);return i(d),()=>d.destroy()}else i(void 0)},[o,i]),[l,s]}Vc.globalOptions=void 0;const yO={active:!0,breakpoints:{},delay:4e3,jump:!1,playOnInit:!0,stopOnFocusIn:!0,stopOnInteraction:!0,stopOnMouseEnter:!1,stopOnLastSnap:!1,rootNode:null};function vO(n,e){const t=n.scrollSnapList();return typeof e=="number"?t.map(()=>e):e(t,n)}function xO(n,e){const t=n.rootNode();return e&&e(t)||t}function Gc(n={}){let e,t,r,s,i=null,o=0,l=!1,c=!1,d=!1,f=!1;function h(U,ne){t=U;const{mergeOptions:q,optionsAtMedia:te}=ne,G=q(yO,Gc.globalOptions),Q=q(G,n);if(e=te(Q),t.scrollSnapList().length<=1)return;f=e.jump,r=!1,s=vO(t,e.delay);const{eventStore:ee,ownerDocument:D}=t.internalEngine(),$=!!t.internalEngine().options.watchDrag,ie=xO(t,e.rootNode);ee.add(D,"visibilitychange",b),$&&t.on("pointerDown",L),$&&!e.stopOnInteraction&&t.on("pointerUp",I),e.stopOnMouseEnter&&ee.add(ie,"mouseenter",k),e.stopOnMouseEnter&&!e.stopOnInteraction&&ee.add(ie,"mouseleave",F),e.stopOnFocusIn&&t.on("slideFocusStart",x),e.stopOnFocusIn&&!e.stopOnInteraction&&ee.add(t.containerNode(),"focusout",S),e.playOnInit&&S()}function p(){t.off("pointerDown",L).off("pointerUp",I).off("slideFocusStart",x),x(),r=!0,l=!1}function v(){const{ownerWindow:U}=t.internalEngine();U.clearTimeout(o),o=U.setTimeout(H,s[t.selectedScrollSnap()]),i=new Date().getTime(),t.emit("autoplay:timerset")}function g(){const{ownerWindow:U}=t.internalEngine();U.clearTimeout(o),o=0,i=null,t.emit("autoplay:timerstopped")}function S(){if(!r){if(A()){d=!0;return}l||t.emit("autoplay:play"),v(),l=!0}}function x(){r||(l&&t.emit("autoplay:stop"),g(),l=!1)}function b(){if(A())return d=l,x();d&&S()}function A(){const{ownerDocument:U}=t.internalEngine();return U.visibilityState==="hidden"}function L(){c||x()}function I(){c||S()}function k(){c=!0,x()}function F(){c=!1,S()}function C(U){typeof U<"u"&&(f=U),S()}function P(){l&&x()}function O(){l&&S()}function M(){return l}function H(){const{index:U}=t.internalEngine(),ne=U.clone().add(1).get(),q=t.scrollSnapList().length-1,te=e.stopOnLastSnap&&ne===q;if(t.canScrollNext()?t.scrollNext(f):t.scrollTo(0,f),t.emit("autoplay:select"),te)return x();S()}function Z(){if(!i)return null;const U=s[t.selectedScrollSnap()],ne=new Date().getTime()-i;return U-ne}return{name:"autoplay",options:n,init:h,destroy:p,play:C,stop:P,reset:O,isPlaying:M,timeUntilNext:Z}}Gc.globalOptions=void 0;var oh={exports:{}},ah={};var Ax;function SO(){if(Ax)return ah;Ax=1;var n=Ma();function e(h,p){return h===p&&(h!==0||1/h===1/p)||h!==h&&p!==p}var t=typeof Object.is=="function"?Object.is:e,r=n.useState,s=n.useEffect,i=n.useLayoutEffect,o=n.useDebugValue;function l(h,p){var v=p(),g=r({inst:{value:v,getSnapshot:p}}),S=g[0].inst,x=g[1];return i(function(){S.value=v,S.getSnapshot=p,c(S)&&x({inst:S})},[h,v,p]),s(function(){return c(S)&&x({inst:S}),h(function(){c(S)&&x({inst:S})})},[h]),o(v),v}function c(h){var p=h.getSnapshot;h=h.value;try{var v=p();return!t(h,v)}catch{return!0}}function d(h,p){return p()}var f=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?d:l;return ah.useSyncExternalStore=n.useSyncExternalStore!==void 0?n.useSyncExternalStore:f,ah}var Lx;function EO(){return Lx||(Lx=1,oh.exports=SO()),oh.exports}var TO=EO();const Db=0,Nb=1,Ob=2,Rx=3;var Ix=Object.prototype.hasOwnProperty;function mm(n,e){var t,r;if(n===e)return!0;if(n&&e&&(t=n.constructor)===e.constructor){if(t===Date)return n.getTime()===e.getTime();if(t===RegExp)return n.toString()===e.toString();if(t===Array){if((r=n.length)===e.length)for(;r--&&mm(n[r],e[r]););return r===-1}if(!t||typeof n=="object"){r=0;for(t in n)if(Ix.call(n,t)&&++r&&!Ix.call(e,t)||!(t in e)||!mm(n[t],e[t]))return!1;return Object.keys(e).length===r}}return n!==n&&e!==e}const Fr=new WeakMap,xs=()=>{},zt=xs(),pm=Object,ze=n=>n===zt,hr=n=>typeof n=="function",As=(n,e)=>({...n,...e}),Mb=n=>hr(n.then),lh={},mu={},_p="undefined",qa=typeof window!=_p,gm=typeof document!=_p,bO=qa&&"Deno"in window,wO=()=>qa&&typeof window.requestAnimationFrame!=_p,Fb=(n,e)=>{const t=Fr.get(n);return[()=>!ze(e)&&n.get(e)||lh,r=>{if(!ze(e)){const s=n.get(e);e in mu||(mu[e]=s),t[5](e,As(s,r),s||lh)}},t[6],()=>!ze(e)&&e in mu?mu[e]:!ze(e)&&n.get(e)||lh]};let ym=!0;const AO=()=>ym,[vm,xm]=qa&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[xs,xs],LO=()=>{const n=gm&&document.visibilityState;return ze(n)||n!=="hidden"},RO=n=>(gm&&document.addEventListener("visibilitychange",n),vm("focus",n),()=>{gm&&document.removeEventListener("visibilitychange",n),xm("focus",n)}),IO=n=>{const e=()=>{ym=!0,n()},t=()=>{ym=!1};return vm("online",e),vm("offline",t),()=>{xm("online",e),xm("offline",t)}},_O={isOnline:AO,isVisible:LO},CO={initFocus:RO,initReconnect:IO},_x=!Ln.useId,La=!qa||bO,kO=n=>wO()?window.requestAnimationFrame(n):setTimeout(n,1),uh=La?N.useEffect:N.useLayoutEffect,ch=typeof navigator<"u"&&navigator.connection,Cx=!La&&ch&&(["slow-2g","2g"].includes(ch.effectiveType)||ch.saveData),pu=new WeakMap,PO=n=>pm.prototype.toString.call(n),dh=(n,e)=>n===`[object ${e}]`;let DO=0;const Sm=n=>{const e=typeof n,t=PO(n),r=dh(t,"Date"),s=dh(t,"RegExp"),i=dh(t,"Object");let o,l;if(pm(n)===n&&!r&&!s){if(o=pu.get(n),o)return o;if(o=++DO+"~",pu.set(n,o),Array.isArray(n)){for(o="@",l=0;l<n.length;l++)o+=Sm(n[l])+",";pu.set(n,o)}if(i){o="#";const c=pm.keys(n).sort();for(;!ze(l=c.pop());)ze(n[l])||(o+=l+":"+Sm(n[l])+",");pu.set(n,o)}}else o=r?n.toJSON():e=="symbol"?n.toString():e=="string"?JSON.stringify(n):""+n;return o},Cp=n=>{if(hr(n))try{n=n()}catch{n=""}const e=n;return n=typeof n=="string"?n:(Array.isArray(n)?n.length:n)?Sm(n):"",[n,e]};let NO=0;const Em=()=>++NO;async function Bb(...n){const[e,t,r,s]=n,i=As({populateCache:!0,throwOnError:!0},typeof s=="boolean"?{revalidate:s}:s||{});let o=i.populateCache;const l=i.rollbackOnError;let c=i.optimisticData;const d=p=>typeof l=="function"?l(p):l!==!1,f=i.throwOnError;if(hr(t)){const p=t,v=[],g=e.keys();for(const S of g)!/^\$(inf|sub)\$/.test(S)&&p(e.get(S)._k)&&v.push(S);return Promise.all(v.map(h))}return h(t);async function h(p){const[v]=Cp(p);if(!v)return;const[g,S]=Fb(e,v),[x,b,A,L]=Fr.get(e),I=()=>{const U=x[v];return(hr(i.revalidate)?i.revalidate(g().data,p):i.revalidate!==!1)&&(delete A[v],delete L[v],U&&U[0])?U[0](Ob).then(()=>g().data):g().data};if(n.length<3)return I();let k=r,F,C=!1;const P=Em();b[v]=[P,0];const O=!ze(c),M=g(),H=M.data,Z=M._c,se=ze(Z)?H:Z;if(O&&(c=hr(c)?c(se,H):c,S({data:c,_c:se})),hr(k))try{k=k(se)}catch(U){F=U,C=!0}if(k&&Mb(k))if(k=await k.catch(U=>{F=U,C=!0}),P!==b[v][0]){if(C)throw F;return k}else C&&O&&d(F)&&(o=!0,S({data:se,_c:zt}));if(o&&!C)if(hr(o)){const U=o(k,se);S({data:U,error:zt,_c:zt})}else S({data:k,error:zt,_c:zt});if(b[v][1]=Em(),Promise.resolve(I()).then(()=>{S({_c:zt})}),C){if(f)throw F;return}return k}}const kx=(n,e)=>{for(const t in n)n[t][0]&&n[t][0](e)},OO=(n,e)=>{if(!Fr.has(n)){const t=As(CO,e),r=Object.create(null),s=Bb.bind(zt,n);let i=xs;const o=Object.create(null),l=(f,h)=>{const p=o[f]||[];return o[f]=p,p.push(h),()=>p.splice(p.indexOf(h),1)},c=(f,h,p)=>{n.set(f,h);const v=o[f];if(v)for(const g of v)g(h,p)},d=()=>{if(!Fr.has(n)&&(Fr.set(n,[r,Object.create(null),Object.create(null),Object.create(null),s,c,l]),!La)){const f=t.initFocus(setTimeout.bind(zt,kx.bind(zt,r,Db))),h=t.initReconnect(setTimeout.bind(zt,kx.bind(zt,r,Nb)));i=()=>{f&&f(),h&&h(),Fr.delete(n)}}};return d(),[n,s,d,i]}return[n,Fr.get(n)[4]]},MO=(n,e,t,r,s)=>{const i=t.errorRetryCount,o=s.retryCount,l=~~((Math.random()+.5)*(1<<(o<8?o:8)))*t.errorRetryInterval;!ze(i)&&o>i||setTimeout(r,l,s)},FO=mm,[Ub,BO]=OO(new Map),UO=As({onLoadingSlow:xs,onSuccess:xs,onError:xs,onErrorRetry:MO,onDiscarded:xs,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:Cx?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:Cx?5e3:3e3,compare:FO,isPaused:()=>!1,cache:Ub,mutate:BO,fallback:{}},_O),$O=(n,e)=>{const t=As(n,e);if(e){const{use:r,fallback:s}=n,{use:i,fallback:o}=e;r&&i&&(t.use=r.concat(i)),s&&o&&(t.fallback=As(s,o))}return t},jO=N.createContext({}),VO="$inf$",$b=qa&&window.__SWR_DEVTOOLS_USE__,GO=$b?window.__SWR_DEVTOOLS_USE__:[],HO=()=>{$b&&(window.__SWR_DEVTOOLS_REACT__=Ln)},KO=n=>hr(n[1])?[n[0],n[1],n[2]||{}]:[n[0],null,(n[1]===null?n[2]:n[1])||{}],zO=()=>{const n=N.useContext(jO);return N.useMemo(()=>As(UO,n),[n])},WO=n=>(e,t,r)=>n(e,t&&((...i)=>{const[o]=Cp(e),[,,,l]=Fr.get(Ub);if(o.startsWith(VO))return t(...i);const c=l[o];return ze(c)?t(...i):(delete l[o],c)}),r),YO=GO.concat(WO),qO=n=>function(...t){const r=zO(),[s,i,o]=KO(t),l=$O(r,o);let c=n;const{use:d}=l,f=(d||[]).concat(YO);for(let h=f.length;h--;)c=f[h](c);return c(s,i||l.fetcher||null,l)},XO=(n,e,t)=>{const r=e[n]||(e[n]=[]);return r.push(t),()=>{const s=r.indexOf(t);s>=0&&(r[s]=r[r.length-1],r.pop())}};HO();const fh=Ln.use||(n=>{switch(n.status){case"pending":throw n;case"fulfilled":return n.value;case"rejected":throw n.reason;default:throw n.status="pending",n.then(e=>{n.status="fulfilled",n.value=e},e=>{n.status="rejected",n.reason=e}),n}}),hh={dedupe:!0},Px=Promise.resolve(zt),QO=(n,e,t)=>{const{cache:r,compare:s,suspense:i,fallbackData:o,revalidateOnMount:l,revalidateIfStale:c,refreshInterval:d,refreshWhenHidden:f,refreshWhenOffline:h,keepPreviousData:p}=t,[v,g,S,x]=Fr.get(r),[b,A]=Cp(n),L=N.useRef(!1),I=N.useRef(!1),k=N.useRef(b),F=N.useRef(e),C=N.useRef(t),P=()=>C.current,O=()=>P().isVisible()&&P().isOnline(),[M,H,Z,se]=Fb(r,b),U=N.useRef({}).current,ne=ze(o)?ze(t.fallback)?zt:t.fallback[b]:o,q=(xe,Re)=>{for(const $e in U){const me=$e;if(me==="data"){if(!s(xe[me],Re[me])&&(!ze(xe[me])||!s(ce,Re[me])))return!1}else if(Re[me]!==xe[me])return!1}return!0},te=N.useMemo(()=>{const xe=!b||!e?!1:ze(l)?P().isPaused()||i?!1:c!==!1:l,Re=Be=>{const Xe=As(Be);return delete Xe._k,xe?{isValidating:!0,isLoading:!0,...Xe}:Xe},$e=M(),me=se(),Me=Re($e),qe=$e===me?Me:Re(me);let je=Me;return[()=>{const Be=Re(M());return q(Be,je)?(je.data=Be.data,je.isLoading=Be.isLoading,je.isValidating=Be.isValidating,je.error=Be.error,je):(je=Be,Be)},()=>qe]},[r,b]),G=TO.useSyncExternalStore(N.useCallback(xe=>Z(b,(Re,$e)=>{q($e,Re)||xe()}),[r,b]),te[0],te[1]),Q=!L.current,ee=v[b]&&v[b].length>0,D=G.data,$=ze(D)?ne&&Mb(ne)?fh(ne):ne:D,ie=G.error,ue=N.useRef($),ce=p?ze(D)?ze(ue.current)?$:ue.current:D:$,fe=ee&&!ze(ie)?!1:Q&&!ze(l)?l:P().isPaused()?!1:i?ze($)?!1:c:ze($)||c,Ee=!!(b&&e&&Q&&fe),ye=ze(G.isValidating)?Ee:G.isValidating,Le=ze(G.isLoading)?Ee:G.isLoading,ke=N.useCallback(async xe=>{const Re=F.current;if(!b||!Re||I.current||P().isPaused())return!1;let $e,me,Me=!0;const qe=xe||{},je=!S[b]||!qe.dedupe,Be=()=>_x?!I.current&&b===k.current&&L.current:b===k.current,Xe={isValidating:!1,isLoading:!1},Ct=()=>{H(Xe)},Cn=()=>{const vt=S[b];vt&&vt[1]===me&&delete S[b]},mn={isValidating:!0};ze(M().data)&&(mn.isLoading=!0);try{if(je&&(H(mn),t.loadingTimeout&&ze(M().data)&&setTimeout(()=>{Me&&Be()&&P().onLoadingSlow(b,t)},t.loadingTimeout),S[b]=[Re(A),Em()]),[$e,me]=S[b],$e=await $e,je&&setTimeout(Cn,t.dedupingInterval),!S[b]||S[b][1]!==me)return je&&Be()&&P().onDiscarded(b),!1;Xe.error=zt;const vt=g[b];if(!ze(vt)&&(me<=vt[0]||me<=vt[1]||vt[1]===0))return Ct(),je&&Be()&&P().onDiscarded(b),!1;const bt=M().data;Xe.data=s(bt,$e)?bt:$e,je&&Be()&&P().onSuccess($e,b,t)}catch(vt){Cn();const bt=P(),{shouldRetryOnError:pn}=bt;bt.isPaused()||(Xe.error=vt,je&&Be()&&(bt.onError(vt,b,bt),(pn===!0||hr(pn)&&pn(vt))&&(!P().revalidateOnFocus||!P().revalidateOnReconnect||O())&&bt.onErrorRetry(vt,b,bt,tr=>{const gn=v[b];gn&&gn[0]&&gn[0](Rx,tr)},{retryCount:(qe.retryCount||0)+1,dedupe:!0})))}return Me=!1,Ct(),!0},[b,r]),Pe=N.useCallback((...xe)=>Bb(r,k.current,...xe),[]);if(uh(()=>{F.current=e,C.current=t,ze(D)||(ue.current=D)}),uh(()=>{if(!b)return;const xe=ke.bind(zt,hh);let Re=0;P().revalidateOnFocus&&(Re=Date.now()+P().focusThrottleInterval);const me=XO(b,v,(Me,qe={})=>{if(Me==Db){const je=Date.now();P().revalidateOnFocus&&je>Re&&O()&&(Re=je+P().focusThrottleInterval,xe())}else if(Me==Nb)P().revalidateOnReconnect&&O()&&xe();else{if(Me==Ob)return ke();if(Me==Rx)return ke(qe)}});return I.current=!1,k.current=b,L.current=!0,H({_k:A}),fe&&(S[b]||(ze($)||La?xe():kO(xe))),()=>{I.current=!0,me()}},[b]),uh(()=>{let xe;function Re(){const me=hr(d)?d(M().data):d;me&&xe!==-1&&(xe=setTimeout($e,me))}function $e(){!M().error&&(f||P().isVisible())&&(h||P().isOnline())?ke(hh).then(Re):Re()}return Re(),()=>{xe&&(clearTimeout(xe),xe=-1)}},[d,f,h,b]),N.useDebugValue(ce),i){const xe=b&&ze($);if(!_x&&La&&xe)throw new Error("Fallback data is required when using Suspense in SSR.");xe&&(F.current=e,C.current=t,I.current=!1);const Re=x[b],$e=!ze(Re)&&xe?Pe(Re):Px;if(fh($e),!ze(ie)&&xe)throw ie;const me=xe?ke(hh):Px;!ze(ce)&&xe&&(me.status="fulfilled",me.value=!0),fh(me)}return{mutate:Pe,get data(){return U.data=!0,ce},get error(){return U.error=!0,ie},get isValidating(){return U.isValidating=!0,ye},get isLoading(){return U.isLoading=!0,Le}}},Br=qO(QO),JO=n=>Ye.get(n).then(e=>e.data),jb=N.memo(({movie:n})=>{const e=hn(),t=n.title||n.name||"Untitled",r=(n.release_date||n.first_air_date||"").split("-")[0],s=n.backdrop_path?`https://image.tmdb.org/t/p/original${n.backdrop_path}`:"https://via.placeholder.com/1920x1080/000000/666666?text=No+Image";return E.jsxs("div",{className:"relative h-[75vh] sm:h-[70vh] md:h-[80vh] lg:h-[85vh] w-full overflow-hidden",children:[E.jsx("div",{className:"absolute inset-0 scale-105",children:E.jsx("img",{src:s,alt:t,className:"w-full h-full object-cover"})}),E.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-black/70 to-black/30 sm:from-black sm:via-black/50 sm:to-transparent"}),E.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-black/40 via-transparent to-black/40 sm:hidden"}),n.vote_average>0&&E.jsx("div",{className:"absolute top-20 sm:top-8 right-4 sm:right-8 z-10",children:E.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-black/90 backdrop-blur-xl rounded-full border border-yellow-500/30 shadow-2xl",children:[E.jsx(Ta,{className:"w-4 h-4 text-yellow-400 fill-yellow-400"}),E.jsx("span",{className:"text-white font-bold text-sm",children:n.vote_average.toFixed(1)})]})}),E.jsx("div",{className:"absolute inset-0 flex flex-col justify-end",children:E.jsx("div",{className:"mobile-padding-sm sm:p-6 md:p-8 lg:p-12 xl:p-16 pb-20 sm:pb-16",children:E.jsxs("div",{className:"max-w-3xl space-y-2.5 sm:space-y-4",children:[E.jsx("h1",{className:"text-2xl sm:text-4xl md:text-5xl lg:text-6xl xl:text-7xl font-black text-white line-clamp-2 leading-tight drop-shadow-2xl",children:t}),E.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[r&&E.jsx("span",{className:"text-sm sm:text-base md:text-lg text-gray-200 font-medium",children:r}),r&&n.vote_average>0&&E.jsx("span",{className:"w-1 h-1 rounded-full bg-gray-500"}),n.vote_average>0&&E.jsxs("div",{className:"flex items-center gap-1.5",children:[E.jsx(Ta,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-yellow-400 fill-yellow-400"}),E.jsx("span",{className:"text-sm sm:text-base text-gray-200 font-semibold",children:n.vote_average.toFixed(1)})]})]}),n.overview&&E.jsx("p",{className:"text-xs sm:text-sm md:text-base lg:text-lg text-gray-200 line-clamp-2 sm:line-clamp-3 max-w-2xl leading-relaxed drop-shadow-lg",children:n.overview}),E.jsxs("div",{className:"flex flex-wrap gap-3 pt-3 sm:pt-4",children:[E.jsxs("button",{onClick:()=>e(`/${n.media_type||"movie"}/${n.id}`),className:"touch-target flex-1 sm:flex-none px-5 sm:px-6 md:px-8 py-3 sm:py-2.5 md:py-3 bg-white text-black text-sm sm:text-base font-bold rounded-lg sm:rounded hover:bg-gray-200 transition-all flex items-center justify-center gap-2 shadow-2xl active:scale-95",children:[E.jsx(zr,{className:"w-5 h-5"}),E.jsx("span",{children:"Play Now"})]}),E.jsxs("button",{onClick:()=>e(`/${n.media_type||"movie"}/${n.id}`),className:"touch-target flex-1 sm:flex-none px-5 sm:px-6 md:px-8 py-3 sm:py-2.5 md:py-3 bg-white/10 backdrop-blur-md text-white text-sm sm:text-base font-bold rounded-lg sm:rounded hover:bg-white/20 transition-all flex items-center justify-center gap-2 border border-white/20 shadow-xl active:scale-95",children:[E.jsx(zP,{className:"w-5 h-5"}),E.jsx("span",{className:"hidden sm:inline",children:"More Info"}),E.jsx("span",{className:"sm:hidden",children:"Info"})]})]})]})})})]})});jb.displayName="MovieSlide";const ZO=()=>{const{data:n,error:e,isLoading:t}=Br(`${st.TMDB_BASE_URL}/trending/all/day?api_key=${st.TMDB_API_KEY}`,JO,{revalidateOnFocus:!1}),r=N.useMemo(()=>n?.results?.slice(0,7)||[],[n]),[s,i]=Vc({loop:!0},[Gc({delay:5e3,stopOnInteraction:!1})]),[o,l]=N.useState(0),c=N.useCallback(()=>{i&&l(i.selectedScrollSnap())},[i]);return N.useEffect(()=>{i&&(i.on("select",c),c())},[i,c]),t?E.jsx("div",{className:"h-[70vh] sm:h-[70vh] md:h-[80vh] lg:h-[85vh] bg-black flex items-center justify-center",children:E.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 border-4 border-gray-600 border-t-white rounded-full animate-spin"})}):e||!r.length?E.jsx("div",{className:"h-[70vh] sm:h-[70vh] md:h-[80vh] lg:h-[85vh] bg-black flex items-center justify-center",children:E.jsx("p",{className:"text-white text-base sm:text-lg md:text-xl",children:"Unable to load content"})}):E.jsxs("div",{className:"relative",children:[E.jsx("div",{className:"overflow-hidden",ref:s,children:E.jsx("div",{className:"flex",children:r.map(d=>E.jsx("div",{className:"flex-[0_0_100%] min-w-0",children:E.jsx(jb,{movie:d})},d.id))})}),E.jsxs("div",{className:"absolute bottom-6 sm:bottom-6 left-0 right-0 flex flex-col items-center gap-2 pb-safe",children:[E.jsxs("div",{className:"sm:hidden text-white/60 text-xs font-medium uppercase tracking-wider flex items-center gap-2",children:[E.jsx("span",{children:"Swipe"}),E.jsx("svg",{className:"w-4 h-4 animate-pulse",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:E.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14 5l7 7m0 0l-7 7m7-7H3"})})]}),E.jsxs("div",{className:"flex items-center gap-3",children:[E.jsxs("span",{className:"sm:hidden text-white/80 text-xs font-semibold",children:[o+1,"/",r.length]}),E.jsx("div",{className:"flex gap-1.5 sm:gap-2",children:r.map((d,f)=>E.jsx("button",{onClick:()=>i?.scrollTo(f),className:`transition-all ${f===o?"w-8 sm:w-8 h-2 bg-white shadow-lg shadow-white/50":"w-2 h-2 bg-white/40 hover:bg-white/60 active:scale-90"} rounded-full`,"aria-label":`Go to slide ${f+1}`},f))})]})]})]})},e2=n=>Ye.get(n).then(e=>e.data),Vb=N.memo(({movie:n,index:e,onPlay:t})=>{const[r,s]=N.useState(!1);return E.jsxs("div",{className:"group cursor-pointer touch-target",onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),onClick:t,children:[E.jsx("div",{className:`relative overflow-hidden rounded-lg sm:rounded-xl bg-gradient-to-br from-gray-900/50 to-black/50 backdrop-blur-sm border border-white/10 transition-all duration-300 transform active:scale-95 ${r?"scale-105 border-red-500/50 shadow-2xl shadow-red-500/20 -translate-y-2":""}`,children:E.jsxs("div",{style:{aspectRatio:"27/40"},className:"relative overflow-hidden",children:[E.jsx("img",{src:n.poster_path?`https://image.tmdb.org/t/p/w500${n.poster_path}`:"https://via.placeholder.com/270x400/1a1a1a/ef4444?text=No+Image",alt:n.title||n.name,className:`w-full h-full object-cover transition-transform duration-500 ${r?"scale-110":""}`,loading:"lazy"}),r&&E.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/90 via-black/50 to-transparent flex items-center justify-center",children:E.jsx(Xi.button,{initial:{scale:0,rotate:-90},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:300,damping:25},className:"p-4 bg-red-600/90 backdrop-blur-sm rounded-full shadow-2xl border-2 border-white/20 hover:bg-red-500 transition-colors duration-200",onClick:i=>{i.stopPropagation(),t()},children:E.jsx(zr,{size:24,className:"text-white"})})}),E.jsx("div",{className:"absolute top-3 right-3 px-2 py-1 bg-black/80 backdrop-blur-sm rounded-lg border border-red-500/30",children:E.jsxs("div",{className:"flex items-center space-x-1",children:[E.jsx(Ta,{size:12,className:"text-yellow-400"}),E.jsx("span",{className:"text-white text-xs sm:text-sm font-bold",children:n.vote_average.toFixed(1)})]})}),r&&E.jsxs("div",{className:"absolute bottom-3 left-3 right-3 flex justify-between",children:[E.jsx("button",{onClick:i=>i.stopPropagation(),className:"p-2 bg-white/20 backdrop-blur-sm rounded-full border border-white/30 hover:bg-red-500/50 transition-colors duration-200",children:E.jsx(ZT,{size:16,className:"text-white"})}),E.jsx("div",{className:"px-3 py-1 bg-red-600/90 backdrop-blur-sm rounded-full border border-red-400/50",children:E.jsx("span",{className:"text-white text-xs font-bold",children:"WATCH"})})]})]})}),E.jsxs("div",{className:"mt-4 px-1",children:[E.jsx("h3",{className:`font-bold text-white text-sm mb-1 truncate transition-colors duration-200 ${r?"text-red-400":""}`,children:n.title||n.name}),E.jsx("p",{className:"text-gray-400 text-xs",children:(n.release_date||n.first_air_date||"").slice(0,4)})]})]})});Vb.displayName="MovieCard";const t2=({title:n,endpoint:e})=>{const t=hn(),{data:r,error:s,isLoading:i}=Br(e?`${st.TMDB_BASE_URL}${e}?api_key=${st.TMDB_API_KEY}`:null,e2,{revalidateOnFocus:!1,revalidateOnReconnect:!1,dedupingInterval:6e4});if(s)return null;if(i)return E.jsx("section",{className:"mb-8 sm:mb-12 md:mb-16",children:E.jsxs("div",{className:"container mx-auto mobile-padding sm:px-6",children:[E.jsx("div",{className:"h-6 sm:h-8 bg-gradient-to-r from-red-800/30 to-red-900/30 rounded-lg w-48 sm:w-64 mb-4 sm:mb-6 animate-pulse"}),E.jsx("div",{className:"mobile-card-grid tablet-grid-3 desktop-grid-6 gap-3 sm:gap-4 md:gap-6",children:Array.from({length:6}).map((d,f)=>E.jsx("div",{className:"aspect-[27/40] bg-gradient-to-br from-gray-800/50 to-gray-900/50 rounded-lg sm:rounded-xl animate-pulse"},f))})]})});const l=(r?.results||[]).filter(d=>{const f=d.media_type==="tv"||!d.media_type&&!d.title?"tv":"movie",h=!!(d.poster_path||d.backdrop_path);return(f==="movie"||f==="tv")&&h}),c=d=>{const f=d.media_type==="tv"||!d.media_type&&!d.title?"tv":"movie";t(`/${f}/${d.id}`)};return E.jsx("section",{className:"mb-16",children:E.jsxs("div",{className:"container mx-auto mobile-padding sm:px-6",children:[E.jsx("div",{className:"mb-8",children:E.jsxs("h2",{className:"text-3xl font-black text-white mb-3 relative",children:[n,E.jsx("div",{className:"absolute -bottom-1 left-0 h-1 bg-gradient-to-r from-red-500 to-red-600 w-24 rounded-full"})]})}),E.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6",children:l.slice(0,18).map((d,f)=>E.jsx(Vb,{movie:d,index:f,onPlay:()=>c(d)},`${d.id}-${f}`))})]})})},n2=N.memo(t2),r2={home:[{key:"trending-all",title:"Trending Now",endpoint:"/trending/all/week"},{key:"in-theaters",title:"In Theaters",endpoint:"/movie/now_playing"},{key:"popular-movies",title:"Popular Movies",endpoint:"/movie/popular"},{key:"popular-tv",title:"Popular TV Shows",endpoint:"/tv/popular"},{key:"top-rated-movies",title:"Top Rated Movies",endpoint:"/movie/top_rated"},{key:"family-night",title:"Family Picks",endpoint:"/discover/movie?with_genres=10751"},{key:"sci-fi",title:"Science Fiction",endpoint:"/discover/movie?with_genres=878"}],movies:[{key:"trending-movies",title:"Trending Movies",endpoint:"/trending/movie/week"},{key:"movies-now-playing",title:"Now Playing",endpoint:"/movie/now_playing"},{key:"movies-popular",title:"Popular Movies",endpoint:"/movie/popular"},{key:"movies-top-rated",title:"Top Rated Movies",endpoint:"/movie/top_rated"},{key:"movies-upcoming",title:"Upcoming Releases",endpoint:"/movie/upcoming"},{key:"movies-action",title:"Action and Adventure",endpoint:"/discover/movie?with_genres=28,12"},{key:"movies-comedy",title:"Comedy Hits",endpoint:"/discover/movie?with_genres=35"},{key:"movies-horror",title:"Horror Highlights",endpoint:"/discover/movie?with_genres=27"},{key:"movies-animation",title:"Animated Favorites",endpoint:"/discover/movie?with_genres=16"}],series:[{key:"trending-tv",title:"Trending TV",endpoint:"/trending/tv/week"},{key:"tv-popular",title:"Popular TV Shows",endpoint:"/tv/popular"},{key:"tv-top-rated",title:"Top Rated TV",endpoint:"/tv/top_rated"},{key:"tv-on-air",title:"Currently Airing",endpoint:"/tv/on_the_air"},{key:"tv-airing-today",title:"Airing Today",endpoint:"/tv/airing_today"},{key:"tv-drama",title:"Drama and Suspense",endpoint:"/discover/tv?with_genres=18,9648,80"},{key:"tv-documentary",title:"Documentary Series",endpoint:"/discover/tv?with_genres=99"},{key:"tv-animation",title:"Animated Series",endpoint:"/discover/tv?with_genres=16"}],new:[{key:"trending-today",title:"Trending Today",endpoint:"/trending/all/day"},{key:"trending-week",title:"Trending This Week",endpoint:"/trending/all/week"},{key:"upcoming-movies",title:"Coming Soon",endpoint:"/movie/upcoming"},{key:"now-playing-new",title:"Now Playing In Theaters",endpoint:"/movie/now_playing"},{key:"tv-on-the-air",title:"New Episodes",endpoint:"/tv/on_the_air"},{key:"tv-airing-today-new",title:"Fresh On TV Today",endpoint:"/tv/airing_today"}]},s2={home:"all",movies:"movie",series:"tv",new:"all"},i2=n=>{const e=new URLSearchParams(n).get("section");return e==="movies"||e==="series"||e==="new"?e:"home"};function o2(){const n=Tr(),e=N.useMemo(()=>i2(n.search),[n.search]),t=N.useMemo(()=>r2[e],[e]),r=s2[e];return N.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[e]),E.jsx("div",{className:"relative min-h-screen bg-black text-white",children:E.jsxs("main",{className:"relative z-10",children:[E.jsx(ZO,{variant:r}),E.jsx("div",{className:"py-12 space-y-16",children:t.map(s=>E.jsx(n2,{title:s.title,endpoint:s.endpoint},s.key))})]})})}const a2=({videoUrl:n,title:e,onClose:t,poster:r,autoPlay:s=!0,movieId:i,isTV:o,season:l,episode:c,movieData:d})=>{const[f,h]=N.useState(""),[p,v]=N.useState(!0),g=N.useRef(null),S=N.useRef(null);N.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow="unset"}),[]),N.useEffect(()=>{i?h(o&&l&&c?`https://player.videasy.net/tv/${i}/${l}/${c}`:`https://player.videasy.net/movie/${i}`):n&&h(n)},[n,i,o,l,c]);const x=()=>{v(!0),g.current&&clearTimeout(g.current),g.current=setTimeout(()=>{v(!1)},3e3)},b=()=>{v(!1)},A=L=>{L.target===L.currentTarget&&t?.()};return E.jsx(Xi.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black/98 z-50 flex items-center justify-center p-0 sm:p-4",onClick:A,children:E.jsxs(Xi.div,{initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.98},transition:{duration:.3,ease:"easeOut"},className:"w-full h-full sm:h-auto sm:max-w-7xl sm:max-h-[95vh] overflow-y-auto custom-scrollbar",children:[E.jsx("div",{ref:S,className:"relative bg-black shadow-2xl group w-full h-full sm:h-auto",style:{height:window.innerWidth<640?"100vh":"clamp(350px, 65vh, 75vh)",borderRadius:window.innerWidth<640?"0":"8px",padding:window.innerWidth<640?"0":"2px",background:window.innerWidth<640?"#000":"linear-gradient(135deg, #dc2626, #000000, #dc2626)",overflow:"hidden"},onMouseMove:x,onMouseLeave:b,children:E.jsxs("div",{className:"w-full h-full bg-black rounded-[6px] overflow-hidden relative",children:[E.jsx("div",{className:`absolute top-0 left-0 right-0 z-50 transition-all duration-300 ${p?"opacity-100 translate-y-0":"opacity-0 -translate-y-full pointer-events-none"}`,children:E.jsx("div",{className:"bg-gradient-to-b from-black/90 via-black/60 to-transparent p-3 sm:p-4 md:p-6",children:E.jsx("h2",{className:"text-white text-sm sm:text-base md:text-lg lg:text-xl font-bold drop-shadow-lg line-clamp-1",children:e})})}),f&&E.jsx("iframe",{src:f,className:"w-full h-full border-0",allowFullScreen:!0,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",title:e})]})}),d&&E.jsxs("div",{className:"mt-3 sm:mt-4 grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4",children:[E.jsxs("div",{className:"bg-neutral-900 rounded-lg p-3 sm:p-4",children:[E.jsx("h3",{className:"text-lg sm:text-xl font-bold text-white mb-2 sm:mb-3 line-clamp-1",children:e}),E.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-2 sm:mb-3 text-xs",children:[d.vote_average&&E.jsxs("span",{className:"text-green-500 font-semibold whitespace-nowrap",children:[Math.round(d.vote_average*10),"% Match"]}),(d.release_date||d.first_air_date)&&E.jsx("span",{className:"text-white font-medium whitespace-nowrap",children:(d.release_date||d.first_air_date)?.slice(0,4)}),d.runtime&&E.jsxs("span",{className:"border border-gray-600 px-2 py-0.5 text-gray-300 text-xs font-medium whitespace-nowrap",children:[Math.floor(d.runtime/60),"h ",d.runtime%60,"m"]}),E.jsx("span",{className:"border border-gray-600 px-2 py-0.5 text-gray-300 text-xs font-medium whitespace-nowrap",children:"HD"})]}),d.tagline&&E.jsxs("p",{className:"text-gray-400 italic text-xs sm:text-sm mb-2 line-clamp-2",children:['"',d.tagline,'"']}),d.overview&&E.jsx("p",{className:"text-white text-xs sm:text-sm leading-relaxed line-clamp-3 sm:line-clamp-4",children:d.overview})]}),E.jsxs("div",{className:"bg-neutral-900 rounded-lg p-3 sm:p-4",children:[E.jsx("h4",{className:"text-sm sm:text-base font-bold text-white mb-2 sm:mb-3",children:"More Information"}),E.jsxs("div",{className:"grid grid-cols-1 gap-2 text-xs sm:text-xs",children:[d.genres&&d.genres.length>0&&E.jsxs("div",{className:"flex gap-2",children:[E.jsx("span",{className:"text-gray-500 min-w-[70px] sm:min-w-[90px] font-medium flex-shrink-0",children:"Genres:"}),E.jsx("span",{className:"text-white break-words",children:d.genres.map(L=>L.name).join(", ")})]}),d.vote_average&&E.jsxs("div",{className:"flex gap-2",children:[E.jsx("span",{className:"text-gray-500 min-w-[70px] sm:min-w-[90px] font-medium flex-shrink-0",children:"Rating:"}),E.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 flex-wrap",children:[E.jsxs("span",{className:"text-yellow-400 font-bold text-xs sm:text-sm whitespace-nowrap",children:[" ",d.vote_average.toFixed(1)]}),d.vote_count&&E.jsxs("span",{className:"text-gray-400 text-xs whitespace-nowrap",children:["(",d.vote_count.toLocaleString(),")"]})]})]}),d.status&&E.jsxs("div",{className:"flex gap-2",children:[E.jsx("span",{className:"text-gray-500 min-w-[70px] sm:min-w-[90px] font-medium flex-shrink-0",children:"Status:"}),E.jsx("span",{className:"text-white",children:d.status})]}),d.spoken_languages&&d.spoken_languages.length>0&&E.jsxs("div",{className:"flex gap-2",children:[E.jsx("span",{className:"text-gray-500 min-w-[70px] sm:min-w-[90px] font-medium flex-shrink-0",children:"Languages:"}),E.jsx("span",{className:"text-white break-words",children:d.spoken_languages.map(L=>L.name).join(", ")})]}),d.production_companies&&d.production_companies.length>0&&E.jsxs("div",{className:"flex gap-2",children:[E.jsx("span",{className:"text-gray-500 min-w-[70px] sm:min-w-[90px] font-medium flex-shrink-0",children:"Production:"}),E.jsx("span",{className:"text-white break-words line-clamp-2",children:d.production_companies.slice(0,2).map(L=>L.name).join(", ")})]}),d.budget&&d.budget>0&&E.jsxs("div",{className:"flex gap-2",children:[E.jsx("span",{className:"text-gray-500 min-w-[70px] sm:min-w-[90px] font-medium flex-shrink-0",children:"Budget:"}),E.jsxs("span",{className:"text-white whitespace-nowrap",children:["$",(d.budget/1e6).toFixed(0),"M"]})]}),d.revenue&&d.revenue>0&&E.jsxs("div",{className:"flex gap-2",children:[E.jsx("span",{className:"text-gray-500 min-w-[70px] sm:min-w-[90px] font-medium flex-shrink-0",children:"Revenue:"}),E.jsxs("span",{className:"text-white whitespace-nowrap",children:["$",(d.revenue/1e6).toFixed(0),"M"]})]})]})]})]})]})})},Dx=()=>{const{id:n}=IR(),e=hn(),[t,r]=N.useState(null),[s,i]=N.useState(!0),[o,l]=N.useState([{id:"1",user:"Alex Johnson",avatar:"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=40&h=40&fit=crop&crop=face",text:"Amazing movie! The cinematography and storyline were absolutely incredible. Highly recommend watching this masterpiece.",rating:5,timestamp:"2 hours ago",likes:24,dislikes:1},{id:"2",user:"Sarah Kim",avatar:"https://images.unsplash.com/photo-1494790108755-2616b612b1c8?w=40&h=40&fit=crop&crop=face",text:"Great acting and visual effects. The plot kept me engaged throughout. Worth every minute of the runtime.",rating:4,timestamp:"5 hours ago",likes:18,dislikes:2},{id:"3",user:"Mike Chen",avatar:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=40&h=40&fit=crop&crop=face",text:"Solid film with excellent character development. The soundtrack complements the scenes perfectly.",rating:4,timestamp:"1 day ago",likes:12,dislikes:0}]),[c,d]=N.useState(""),[f,h]=N.useState(0),[p,v]=N.useState(!1),[g,S]=N.useState(null),[x,b]=N.useState(1),[A,L]=N.useState(1),[I,k]=N.useState(1),[F,C]=N.useState([]),[P,O]=N.useState([]),M=location.pathname.includes("/tv/"),[H,Z]=Vc({loop:!0,align:"start"},[Gc({delay:3e3,stopOnInteraction:!1})]);N.useEffect(()=>{let U=document.getElementById("player-root");return U||(U=document.createElement("div"),U.id="player-root",document.body.appendChild(U)),S(U),()=>{}},[]),N.useEffect(()=>{const U=async()=>{try{const te=M?"tv":"movie",G=`${st.TMDB_BASE_URL}/${te}/${n}?api_key=${st.TMDB_API_KEY}`;console.log(" Fetching movie details from TMDB:",G);const Q=await Ye.get(G);if(console.log(" TMDB Response:",Q.data),console.log(" Movie title from TMDB:",Q.data.title||Q.data.name),r(Q.data),M&&Q.data.seasons){const $=Q.data.seasons.filter(ie=>ie.season_number>0);if(k($.length),$.length>0){const ie=$.map(ue=>ue.episode_count);C(ie),b(1),L(1)}}const ee=`${st.TMDB_BASE_URL}/${te}/${n}/similar?api_key=${st.TMDB_API_KEY}`,D=await Ye.get(ee);O(D.data.results.slice(0,12))}catch(te){console.error(" Error fetching movie from TMDB:",te),console.error(" Error details:",{status:te.response?.status,message:te.response?.data,url:te.config?.url})}finally{i(!1)}};n&&(console.log(" MovieDetails: Loading movie ID:",n),U());const ne=window.open;window.open=function(...te){return console.log("Redirect attempt blocked via window.open:",te),null};const q=te=>{const G=te.target;G.tagName==="A"&&G.getAttribute("target")==="_blank"&&(te.preventDefault(),te.stopPropagation(),console.log("External link click blocked"))};return document.addEventListener("click",q,!0),()=>{window.open=ne,document.removeEventListener("click",q,!0)}},[n,M]);const se=()=>{if(!c.trim()||f===0)return;const U={id:Date.now().toString(),user:"You",avatar:"https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=40&h=40&fit=crop&crop=face",text:c,rating:f,timestamp:"Just now",likes:0,dislikes:0};l([U,...o]),d(""),h(0)};return s?E.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center",children:E.jsx(Xi.span,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:E.jsx("span",{className:"w-12 h-12 border-4 border-red-500 border-t-transparent rounded-full inline-block"})})}):t?E.jsxs("div",{className:"min-h-screen bg-black",children:[p&&t&&g&&TI.createPortal(E.jsx(a2,{videoUrl:"",title:t.title||t.name||"Video",poster:t.poster_path?`https://image.tmdb.org/t/p/w500${t.poster_path}`:void 0,movieId:n,isTV:M,season:x,episode:A,movieData:{overview:t.overview,vote_average:t.vote_average,vote_count:t.vote_count,release_date:t.release_date,first_air_date:t.first_air_date,runtime:t.runtime,genres:t.genres,spoken_languages:t.spoken_languages,production_companies:t.production_companies,tagline:t.tagline,status:t.status,budget:t.budget,revenue:t.revenue},onClose:()=>{console.log("VideoPlayer onClose called"),v(!1)}}),g),E.jsx("div",{className:"relative",children:E.jsxs("div",{className:"h-[70vh] sm:h-[80vh] md:h-[90vh] lg:h-screen bg-cover bg-center bg-no-repeat relative",style:{backgroundImage:`url(https://image.tmdb.org/t/p/original${t.backdrop_path})`},children:[E.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-black/70 to-transparent"}),E.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-black via-transparent to-black/50"}),E.jsx("div",{className:"absolute inset-0 flex items-center",children:E.jsxs("div",{className:"container mx-auto px-4 sm:px-6 flex items-center gap-6 sm:gap-8 md:gap-12",children:[E.jsx("div",{className:"hidden lg:block flex-shrink-0",children:E.jsx("img",{src:`https://image.tmdb.org/t/p/w500${t.poster_path}`,alt:t.title||t.name,className:"w-60 lg:w-72 xl:w-80 h-auto rounded-xl lg:rounded-2xl shadow-2xl"})}),E.jsxs("div",{className:"flex-1 text-white",children:[E.jsx("h1",{className:"text-3xl sm:text-4xl md:text-5xl lg:text-6xl xl:text-7xl font-black mb-4 sm:mb-6 bg-gradient-to-r from-white to-red-400 bg-clip-text text-transparent line-clamp-2",children:t.title||t.name}),E.jsxs("div",{className:"flex flex-wrap items-center gap-3 sm:gap-4 md:gap-6 mb-4 sm:mb-6 text-sm sm:text-base",children:[E.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[E.jsx("div",{className:"text-yellow-400",children:E.jsx(Ta,{size:16,className:"sm:w-5 sm:h-5"})}),E.jsx("span",{className:"font-bold",children:t.vote_average.toFixed(1)}),E.jsxs("span",{className:"text-gray-400 text-xs sm:text-sm",children:["(",t.vote_count,")"]})]}),E.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[E.jsx("div",{className:"text-red-400",children:E.jsx(VP,{size:16,className:"sm:w-5 sm:h-5"})}),E.jsx("span",{children:(t.release_date||t.first_air_date)?.slice(0,4)})]}),t.runtime&&E.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[E.jsx("div",{className:"text-red-400",children:E.jsx(Sp,{size:16,className:"sm:w-5 sm:h-5"})}),E.jsxs("span",{children:[t.runtime," min"]})]})]}),E.jsx("div",{className:"flex flex-wrap gap-2 mb-4 sm:mb-6",children:t.genres.map(U=>E.jsx("span",{className:"px-3 sm:px-4 py-1.5 sm:py-2 bg-white/10 backdrop-blur-md rounded-full text-xs sm:text-sm font-medium border border-white/20",children:U.name},U.id))}),E.jsx("p",{className:"text-sm sm:text-base md:text-lg text-gray-300 mb-6 sm:mb-8 max-w-2xl leading-relaxed line-clamp-3 sm:line-clamp-4",children:t.overview}),M&&I>0&&E.jsxs("div",{className:"mb-4 sm:mb-6 space-y-3 sm:space-y-4",children:[E.jsxs("div",{className:"flex flex-wrap gap-3 sm:gap-4",children:[E.jsxs("div",{className:"flex flex-col",children:[E.jsx("label",{className:"text-xs sm:text-sm text-gray-400 mb-1.5 sm:mb-2 font-medium",children:"Season"}),E.jsx("select",{value:x,onChange:U=>{const ne=Number(U.target.value);b(ne),L(1)},className:"px-3 sm:px-4 py-2 sm:py-3 bg-white/10 backdrop-blur-md border border-white/20 rounded-lg sm:rounded-xl text-white text-sm sm:text-base font-medium cursor-pointer hover:bg-white/20 transition-all focus:outline-none focus:ring-2 focus:ring-red-500",children:Array.from({length:I},(U,ne)=>ne+1).map(U=>E.jsxs("option",{value:U,className:"bg-black",children:["Season ",U]},U))})]}),E.jsxs("div",{className:"flex flex-col",children:[E.jsx("label",{className:"text-xs sm:text-sm text-gray-400 mb-1.5 sm:mb-2 font-medium",children:"Episode"}),E.jsx("select",{value:A,onChange:U=>L(Number(U.target.value)),className:"px-3 sm:px-4 py-2 sm:py-3 bg-white/10 backdrop-blur-md border border-white/20 rounded-lg sm:rounded-xl text-white text-sm sm:text-base font-medium cursor-pointer hover:bg-white/20 transition-all focus:outline-none focus:ring-2 focus:ring-red-500",children:Array.from({length:F[x-1]||10},(U,ne)=>ne+1).map(U=>E.jsxs("option",{value:U,className:"bg-black",children:["Episode ",U]},U))})]})]}),E.jsxs("div",{className:"text-sm text-gray-400",children:["Now playing: ",E.jsxs("span",{className:"text-white font-medium",children:["Season ",x,", Episode ",A]})]})]}),E.jsxs("div",{className:"flex flex-wrap gap-2 sm:gap-3 md:gap-4",children:[E.jsxs("button",{onClick:()=>{v(!0)},className:"flex items-center gap-2 px-4 sm:px-6 md:px-8 py-2.5 sm:py-3 md:py-4 bg-red-600 hover:bg-red-700 rounded-lg sm:rounded-xl font-bold text-sm sm:text-base md:text-lg transition-all shadow-2xl hover:scale-105 active:scale-95",children:[E.jsx("div",{className:"text-white",children:E.jsx(zr,{size:16,className:"sm:w-5 sm:h-5"})}),M?`Watch S${x}E${A}`:"Watch Now"]}),E.jsxs("button",{type:"button",className:"group relative inline-flex items-center gap-2 sm:gap-3 overflow-hidden rounded-lg sm:rounded-full px-4 sm:px-6 md:px-8 py-2.5 sm:py-3 md:py-3.5 text-xs sm:text-sm font-semibold uppercase tracking-wide text-white transition-all duration-300 focus:outline-none focus-visible:ring-2 focus-visible:ring-white/40",children:[E.jsx("span",{className:"absolute inset-0 rounded-lg sm:rounded-full bg-white/10 backdrop-blur-lg transition-all duration-500 group-hover:bg-white/15 group-active:bg-white/10","aria-hidden":"true"}),E.jsx("span",{className:"absolute inset-0 rounded-lg sm:rounded-full border border-white/25 transition-colors duration-500 group-hover:border-red-400/60","aria-hidden":"true"}),E.jsxs("span",{className:"relative flex items-center gap-2 sm:gap-3",children:[E.jsx(ZT,{size:16,className:"sm:w-[18px] sm:h-[18px] text-white/80 group-hover:text-white"}),E.jsx("span",{className:"hidden sm:inline",children:"My List"}),E.jsx("span",{className:"sm:hidden",children:"List"})]})]}),E.jsxs("button",{className:"flex items-center gap-2 sm:gap-3 px-4 sm:px-6 md:px-8 py-2.5 sm:py-3 md:py-4 bg-white/10 backdrop-blur-md border border-white/20 hover:bg-white/20 rounded-lg sm:rounded-xl font-bold text-sm sm:text-base md:text-lg transition-all hover:scale-105 active:scale-95",children:[E.jsx("div",{className:"text-white",children:E.jsx(XP,{size:16,className:"sm:w-5 sm:h-5"})}),E.jsx("span",{className:"hidden sm:inline",children:"Share"})]})]})]})]})})]})}),P.length>0&&E.jsxs("div",{className:"container mx-auto px-4 sm:px-6 py-8 sm:py-10 md:py-12 bg-black",children:[E.jsx("h2",{className:"text-2xl sm:text-3xl font-black text-white mb-6 sm:mb-8",children:"More Like This"}),E.jsxs("div",{className:"relative",children:[E.jsx("div",{className:"overflow-hidden",ref:H,children:E.jsx("div",{className:"flex gap-3 sm:gap-4",children:P.map(U=>E.jsxs("div",{onClick:()=>{e(`/${M?"tv":"movie"}/${U.id}`),window.scrollTo({top:0,behavior:"smooth"})},className:"flex-[0_0_140px] sm:flex-[0_0_160px] md:flex-[0_0_180px] lg:flex-[0_0_200px] min-w-0 cursor-pointer group",children:[E.jsxs("div",{className:"relative aspect-[2/3] rounded-lg overflow-hidden bg-neutral-800",children:[U.poster_path?E.jsx("img",{src:`https://image.tmdb.org/t/p/w500${U.poster_path}`,alt:U.title||U.name,className:"w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-500",loading:"lazy"}):E.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-500",children:"No Image"}),E.jsxs("div",{className:"absolute inset-0 bg-black/80 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col items-center justify-center gap-2 sm:gap-3 p-3 sm:p-4",children:[E.jsx("button",{className:"p-2 sm:p-3 bg-red-600 text-white rounded-full hover:scale-110 transition",children:E.jsx(zr,{size:16,className:"sm:w-5 sm:h-5"})}),E.jsxs("div",{className:"text-center",children:[E.jsx("p",{className:"text-white font-semibold text-xs sm:text-sm line-clamp-2",children:U.title||U.name}),U.vote_average>0&&E.jsxs("p",{className:"text-yellow-400 text-xs mt-1",children:[" ",U.vote_average.toFixed(1)]})]})]})]}),E.jsxs("div",{className:"mt-2",children:[E.jsx("h3",{className:"text-white font-medium text-sm line-clamp-1",children:U.title||U.name}),(U.release_date||U.first_air_date)&&E.jsx("p",{className:"text-gray-400 text-xs mt-1",children:(U.release_date||U.first_air_date).split("-")[0]})]})]},U.id))})}),E.jsx("button",{onClick:()=>Z?.scrollPrev(),className:"absolute left-0 top-1/2 -translate-y-1/2 -translate-x-2 sm:-translate-x-4 p-2 sm:p-3 bg-black/80 hover:bg-black text-white rounded-full transition-all hover:scale-110 z-10",children:E.jsx(GP,{size:20,className:"sm:w-6 sm:h-6"})}),E.jsx("button",{onClick:()=>Z?.scrollNext(),className:"absolute right-0 top-1/2 -translate-y-1/2 translate-x-2 sm:translate-x-4 p-2 sm:p-3 bg-black/80 hover:bg-black text-white rounded-full transition-all hover:scale-110 z-10",children:E.jsx(HP,{size:20,className:"sm:w-6 sm:h-6"})})]})]}),E.jsx("div",{className:"container mx-auto px-4 sm:px-6 py-8 sm:py-10 md:py-12",children:E.jsxs("div",{className:"max-w-4xl mx-auto",children:[E.jsx("h2",{className:"text-2xl sm:text-3xl font-black text-white mb-6 sm:mb-8",children:"User Reviews"}),E.jsxs("div",{className:"bg-white/5 backdrop-blur-md rounded-xl sm:rounded-2xl p-4 sm:p-6 border border-white/10 mb-6 sm:mb-8",children:[E.jsx("h3",{className:"text-lg sm:text-xl font-bold text-white mb-3 sm:mb-4",children:"Share Your Review"}),E.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[E.jsx("span",{className:"text-white",children:"Rating:"}),[1,2,3,4,5].map(U=>E.jsx("button",{onClick:()=>h(U),className:`text-2xl ${U<=f?"text-yellow-400":"text-gray-600"} hover:text-yellow-400 transition-colors`,children:""},U))]}),E.jsx("textarea",{value:c,onChange:U=>d(U.target.value),placeholder:"Write your review...",className:"w-full p-3 sm:p-4 bg-black/50 border border-white/20 rounded-lg sm:rounded-xl text-white text-sm sm:text-base placeholder-gray-400 resize-none h-20 sm:h-24 mb-3 sm:mb-4 focus:outline-none focus:border-red-500"}),E.jsxs("button",{onClick:se,disabled:!c.trim()||f===0,className:"flex items-center gap-2 px-4 sm:px-6 py-2 sm:py-3 bg-red-600 hover:bg-red-700 disabled:bg-gray-600 disabled:cursor-not-allowed rounded-lg sm:rounded-xl text-sm sm:text-base font-bold transition-all hover:scale-102 active:scale-98",children:[E.jsx("div",{className:"text-white",children:E.jsx(qP,{size:14,className:"sm:w-4 sm:h-4"})}),"Post Review"]})]}),E.jsx("div",{className:"space-y-4 sm:space-y-6",children:o.map((U,ne)=>E.jsx("div",{className:"bg-white/5 backdrop-blur-md rounded-xl sm:rounded-2xl p-4 sm:p-6 border border-white/10",children:E.jsxs("div",{className:"flex items-start gap-3 sm:gap-4",children:[E.jsx("img",{src:U.avatar,alt:U.user,className:"w-10 h-10 sm:w-12 sm:h-12 rounded-full object-cover flex-shrink-0"}),E.jsxs("div",{className:"flex-1 min-w-0",children:[E.jsxs("div",{className:"flex items-center justify-between mb-2 gap-2",children:[E.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0",children:[E.jsx("h4",{className:"font-bold text-white text-sm sm:text-base truncate",children:U.user}),E.jsx("div",{className:"flex items-center flex-shrink-0",children:[...Array(5)].map((q,te)=>E.jsx("span",{className:`text-xs sm:text-sm ${te<U.rating?"text-yellow-400":"text-gray-600"}`,children:""},te))})]}),E.jsx("span",{className:"text-gray-400 text-xs sm:text-sm whitespace-nowrap",children:U.timestamp})]}),E.jsx("p",{className:"text-gray-300 text-sm sm:text-base mb-3 sm:mb-4 leading-relaxed",children:U.text}),E.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[E.jsxs("button",{className:"flex items-center gap-1.5 sm:gap-2 text-gray-400 hover:text-green-400 transition-colors text-sm",children:[E.jsx("div",{children:E.jsx(JP,{size:14,className:"sm:w-4 sm:h-4"})}),E.jsx("span",{children:U.likes})]}),E.jsxs("button",{className:"flex items-center gap-1.5 sm:gap-2 text-gray-400 hover:text-red-400 transition-colors text-sm",children:[E.jsx("div",{children:E.jsx(QP,{size:14,className:"sm:w-4 sm:h-4"})}),E.jsx("span",{children:U.dislikes})]})]})]})]})},U.id))})]})})]}):E.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center",children:E.jsx("p",{className:"text-white text-xl",children:"Movie not found"})})},l2=n=>Ye.get(n).then(e=>e.data),u2=[{id:28,name:"Action"},{id:12,name:"Adventure"},{id:16,name:"Animation"},{id:35,name:"Comedy"},{id:80,name:"Crime"},{id:99,name:"Documentary"},{id:18,name:"Drama"},{id:10751,name:"Family"},{id:14,name:"Fantasy"},{id:36,name:"History"},{id:27,name:"Horror"},{id:10402,name:"Music"},{id:9648,name:"Mystery"},{id:10749,name:"Romance"},{id:878,name:"Sci-Fi"},{id:10770,name:"TV Movie"},{id:53,name:"Thriller"},{id:10752,name:"War"},{id:37,name:"Western"}],c2=Array.from({length:55},(n,e)=>2025-e),d2=()=>{const n=hn(),[e,t]=N.useState(null),[r,s]=N.useState(null),[i,o]=N.useState(1),l=()=>{let g=`${st.TMDB_BASE_URL}/discover/movie?api_key=${st.TMDB_API_KEY}&page=${i}&sort_by=popularity.desc`;return e&&(g+=`&with_genres=${e}`),r&&(g+=`&primary_release_year=${r}`),g},{data:c,error:d,isLoading:f}=Br(l(),l2);N.useEffect(()=>{o(1)},[e,r]);const h=c?.results||[],p=g=>{n(`/movie/${g}`)},v=()=>{o(g=>g+1)};return E.jsx("div",{className:"min-h-screen bg-black pt-20 pb-16",children:E.jsxs("div",{className:"max-w-7xl mx-auto px-4 md:px-6",children:[E.jsxs("div",{className:"mb-8",children:[E.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white mb-4",children:"Movies"}),E.jsx("p",{className:"text-gray-400 text-lg",children:"Explore thousands of movies"})]}),E.jsxs("div",{className:"flex flex-wrap gap-4 mb-8",children:[E.jsxs("div",{className:"relative",children:[E.jsxs("select",{value:e||"",onChange:g=>t(g.target.value?Number(g.target.value):null),className:"appearance-none bg-neutral-800 text-white px-4 py-2.5 pr-10 rounded-lg border border-neutral-700 focus:outline-none focus:border-red-600 cursor-pointer",children:[E.jsx("option",{value:"",children:"All Genres"}),u2.map(g=>E.jsx("option",{value:g.id,children:g.name},g.id))]}),E.jsx(ic,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"})]}),E.jsxs("div",{className:"relative",children:[E.jsxs("select",{value:r||"",onChange:g=>s(g.target.value?Number(g.target.value):null),className:"appearance-none bg-neutral-800 text-white px-4 py-2.5 pr-10 rounded-lg border border-neutral-700 focus:outline-none focus:border-red-600 cursor-pointer",children:[E.jsx("option",{value:"",children:"All Years"}),c2.map(g=>E.jsx("option",{value:g,children:g},g))]}),E.jsx(ic,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"})]}),(e||r)&&E.jsx("button",{onClick:()=>{t(null),s(null)},className:"px-4 py-2.5 bg-red-600 hover:bg-red-700 text-white rounded-lg transition",children:"Clear Filters"})]}),f&&E.jsx("div",{className:"flex justify-center items-center py-20",children:E.jsx("div",{className:"w-12 h-12 border-4 border-red-600 border-t-transparent rounded-full animate-spin"})}),d&&E.jsx("div",{className:"text-center py-20",children:E.jsx("p",{className:"text-red-500 text-xl",children:"Failed to load movies"})}),!f&&!d&&h.length>0&&E.jsxs(E.Fragment,{children:[E.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 md:gap-6",children:h.map(g=>E.jsxs("div",{onClick:()=>p(g.id),className:"group cursor-pointer",children:[E.jsxs("div",{className:"relative aspect-[2/3] rounded-lg overflow-hidden bg-neutral-800",children:[g.poster_path?E.jsx("img",{src:`https://image.tmdb.org/t/p/w500${g.poster_path}`,alt:g.title,className:"w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-500",loading:"lazy"}):E.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-500",children:"No Image"}),E.jsxs("div",{className:"absolute inset-0 bg-black/80 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col items-center justify-center gap-3 p-4",children:[E.jsx("button",{className:"p-3 bg-white text-black rounded-full hover:scale-110 transition",children:E.jsx(zr,{size:20})}),E.jsxs("div",{className:"text-center",children:[E.jsx("p",{className:"text-white font-semibold text-sm line-clamp-2",children:g.title}),g.vote_average>0&&E.jsxs("p",{className:"text-yellow-400 text-xs mt-1",children:[" ",g.vote_average.toFixed(1)]})]})]})]}),E.jsxs("div",{className:"mt-2",children:[E.jsx("h3",{className:"text-white font-medium text-sm line-clamp-1",children:g.title}),g.release_date&&E.jsx("p",{className:"text-gray-400 text-xs mt-1",children:g.release_date.split("-")[0]})]})]},g.id))}),h.length>=20&&E.jsx("div",{className:"text-center mt-12",children:E.jsx("button",{onClick:v,className:"px-8 py-3 bg-neutral-800 hover:bg-neutral-700 text-white rounded-lg transition",children:"Load More"})})]}),!f&&!d&&h.length===0&&E.jsx("div",{className:"text-center py-20",children:E.jsx("p",{className:"text-gray-400 text-xl",children:"No movies found"})})]})})},f2=n=>Ye.get(n).then(e=>e.data),h2=[{id:10759,name:"Action & Adventure"},{id:16,name:"Animation"},{id:35,name:"Comedy"},{id:80,name:"Crime"},{id:99,name:"Documentary"},{id:18,name:"Drama"},{id:10751,name:"Family"},{id:10762,name:"Kids"},{id:9648,name:"Mystery"},{id:10763,name:"News"},{id:10764,name:"Reality"},{id:10765,name:"Sci-Fi & Fantasy"},{id:10766,name:"Soap"},{id:10767,name:"Talk"},{id:10768,name:"War & Politics"},{id:37,name:"Western"}],m2=Array.from({length:55},(n,e)=>2025-e),p2=()=>{const n=hn(),[e,t]=N.useState(null),[r,s]=N.useState(null),[i,o]=N.useState(1),l=()=>{let g=`${st.TMDB_BASE_URL}/discover/tv?api_key=${st.TMDB_API_KEY}&page=${i}&sort_by=popularity.desc`;return e&&(g+=`&with_genres=${e}`),r&&(g+=`&first_air_date_year=${r}`),g},{data:c,error:d,isLoading:f}=Br(l(),f2);N.useEffect(()=>{o(1)},[e,r]);const h=c?.results||[],p=g=>{n(`/tv/${g}`)},v=()=>{o(g=>g+1)};return E.jsx("div",{className:"min-h-screen bg-black pt-20 pb-16",children:E.jsxs("div",{className:"max-w-7xl mx-auto px-4 md:px-6",children:[E.jsxs("div",{className:"mb-8",children:[E.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white mb-4",children:"TV Series"}),E.jsx("p",{className:"text-gray-400 text-lg",children:"Discover your next binge-worthy series"})]}),E.jsxs("div",{className:"flex flex-wrap gap-4 mb-8",children:[E.jsxs("div",{className:"relative",children:[E.jsxs("select",{value:e||"",onChange:g=>t(g.target.value?Number(g.target.value):null),className:"appearance-none bg-neutral-800 text-white px-4 py-2.5 pr-10 rounded-lg border border-neutral-700 focus:outline-none focus:border-red-600 cursor-pointer",children:[E.jsx("option",{value:"",children:"All Genres"}),h2.map(g=>E.jsx("option",{value:g.id,children:g.name},g.id))]}),E.jsx(ic,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"})]}),E.jsxs("div",{className:"relative",children:[E.jsxs("select",{value:r||"",onChange:g=>s(g.target.value?Number(g.target.value):null),className:"appearance-none bg-neutral-800 text-white px-4 py-2.5 pr-10 rounded-lg border border-neutral-700 focus:outline-none focus:border-red-600 cursor-pointer",children:[E.jsx("option",{value:"",children:"All Years"}),m2.map(g=>E.jsx("option",{value:g,children:g},g))]}),E.jsx(ic,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"})]}),(e||r)&&E.jsx("button",{onClick:()=>{t(null),s(null)},className:"px-4 py-2.5 bg-red-600 hover:bg-red-700 text-white rounded-lg transition",children:"Clear Filters"})]}),f&&E.jsx("div",{className:"flex justify-center items-center py-20",children:E.jsx("div",{className:"w-12 h-12 border-4 border-red-600 border-t-transparent rounded-full animate-spin"})}),d&&E.jsx("div",{className:"text-center py-20",children:E.jsx("p",{className:"text-red-500 text-xl",children:"Failed to load TV series"})}),!f&&!d&&h.length>0&&E.jsxs(E.Fragment,{children:[E.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 md:gap-6",children:h.map(g=>E.jsxs("div",{onClick:()=>p(g.id),className:"group cursor-pointer",children:[E.jsxs("div",{className:"relative aspect-[2/3] rounded-lg overflow-hidden bg-neutral-800",children:[g.poster_path?E.jsx("img",{src:`https://image.tmdb.org/t/p/w500${g.poster_path}`,alt:g.name,className:"w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-500",loading:"lazy"}):E.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-500",children:"No Image"}),E.jsxs("div",{className:"absolute inset-0 bg-black/80 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col items-center justify-center gap-3 p-4",children:[E.jsx("button",{className:"p-3 bg-white text-black rounded-full hover:scale-110 transition",children:E.jsx(zr,{size:20})}),E.jsxs("div",{className:"text-center",children:[E.jsx("p",{className:"text-white font-semibold text-sm line-clamp-2",children:g.name}),g.vote_average>0&&E.jsxs("p",{className:"text-yellow-400 text-xs mt-1",children:[" ",g.vote_average.toFixed(1)]})]})]})]}),E.jsxs("div",{className:"mt-2",children:[E.jsx("h3",{className:"text-white font-medium text-sm line-clamp-1",children:g.name}),g.first_air_date&&E.jsx("p",{className:"text-gray-400 text-xs mt-1",children:g.first_air_date.split("-")[0]})]})]},g.id))}),h.length>=20&&E.jsx("div",{className:"text-center mt-12",children:E.jsx("button",{onClick:v,className:"px-8 py-3 bg-neutral-800 hover:bg-neutral-700 text-white rounded-lg transition",children:"Load More"})})]}),!f&&!d&&h.length===0&&E.jsx("div",{className:"text-center py-20",children:E.jsx("p",{className:"text-gray-400 text-xl",children:"No TV series found"})})]})})},ta=n=>Ye.get(n).then(e=>e.data),g2=()=>{const n=hn(),[e,t]=N.useState("trending"),r=()=>`${st.TMDB_BASE_URL}/trending/all/week?api_key=${st.TMDB_API_KEY}`,s=()=>`${st.TMDB_BASE_URL}/movie/now_playing?api_key=${st.TMDB_API_KEY}&region=US`,i=()=>`${st.TMDB_BASE_URL}/movie/top_rated?api_key=${st.TMDB_API_KEY}`,o=()=>`${st.TMDB_BASE_URL}/discover/movie?api_key=${st.TMDB_API_KEY}&with_original_language=hi&sort_by=popularity.desc&page=1`,l=()=>`${st.TMDB_BASE_URL}/discover/tv?api_key=${st.TMDB_API_KEY}&with_genres=16&with_keywords=210024|287501&with_original_language=ja&sort_by=popularity.desc&page=1`,{data:c,error:d,isLoading:f}=Br(e==="trending"?r():null,ta),{data:h,error:p,isLoading:v}=Br(e==="new"?s():null,ta),{data:g,error:S,isLoading:x}=Br(e==="topRated"?i():null,ta),{data:b,error:A,isLoading:L}=Br(e==="bollywood"?o():null,ta),{data:I,error:k,isLoading:F}=Br(e==="anime"?l():null,ta),C=()=>{switch(e){case"trending":return c?.results||[];case"new":return h?.results?.map(U=>({...U,media_type:"movie"}))||[];case"topRated":return g?.results?.map(U=>({...U,media_type:"movie"}))||[];case"bollywood":return b?.results?.map(U=>({...U,media_type:"movie"}))||[];case"anime":return I?.results?.map(U=>({...U,media_type:"tv"}))||[];default:return[]}},P=f||v||x||L||F,O=d||p||S||A||k,M=C(),H=U=>{n(`/${U.media_type}/${U.id}`)},Z=U=>U.title||U.name||"Untitled",se=U=>{const ne=U.release_date||U.first_air_date;return ne?ne.split("-")[0]:""};return E.jsx("div",{className:"min-h-screen bg-black pt-20 pb-16",children:E.jsxs("div",{className:"max-w-7xl mx-auto px-4 md:px-6",children:[E.jsxs("div",{className:"mb-8",children:[E.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white mb-4",children:"New & Popular"}),E.jsx("p",{className:"text-gray-400 text-lg",children:"What's trending and recently released"})]}),E.jsxs("div",{className:"flex gap-4 mb-8 border-b border-neutral-800",children:[E.jsxs("button",{onClick:()=>t("trending"),className:`pb-4 px-2 font-semibold transition relative ${e==="trending"?"text-white":"text-gray-400 hover:text-white"}`,children:[E.jsx(tb,{className:"inline mr-2"}),"Trending",e==="trending"&&E.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-red-600 rounded-t"})]}),E.jsxs("button",{onClick:()=>t("new"),className:`pb-4 px-2 font-semibold transition relative ${e==="new"?"text-white":"text-gray-400 hover:text-white"}`,children:[E.jsx(zr,{className:"inline mr-2"}),"New Releases",e==="new"&&E.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-red-600 rounded-t"})]}),E.jsxs("button",{onClick:()=>t("topRated"),className:`pb-4 px-2 font-semibold transition relative ${e==="topRated"?"text-white":"text-gray-400 hover:text-white"}`,children:[E.jsx(Ta,{className:"inline mr-2"}),"Top Rated",e==="topRated"&&E.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-red-600 rounded-t"})]}),E.jsxs("button",{onClick:()=>t("bollywood"),className:`pb-4 px-2 font-semibold transition relative ${e==="bollywood"?"text-white":"text-gray-400 hover:text-white"}`,children:[E.jsx(Oc,{className:"inline mr-2"}),"Bollywood",e==="bollywood"&&E.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-red-600 rounded-t"})]}),E.jsxs("button",{onClick:()=>t("anime"),className:`pb-4 px-2 font-semibold transition relative ${e==="anime"?"text-white":"text-gray-400 hover:text-white"}`,children:[E.jsx(ZP,{className:"inline mr-2"}),"Anime",e==="anime"&&E.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-red-600 rounded-t"})]})]}),P&&E.jsx("div",{className:"flex justify-center items-center py-20",children:E.jsx("div",{className:"w-12 h-12 border-4 border-red-600 border-t-transparent rounded-full animate-spin"})}),O&&E.jsx("div",{className:"text-center py-20",children:E.jsx("p",{className:"text-red-500 text-xl",children:"Failed to load content"})}),!P&&!O&&M.length>0&&E.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 md:gap-6",children:M.map(U=>E.jsxs("div",{onClick:()=>H(U),className:"group cursor-pointer",children:[E.jsxs("div",{className:"relative aspect-[2/3] rounded-lg overflow-hidden bg-neutral-800",children:[U.poster_path?E.jsx("img",{src:`https://image.tmdb.org/t/p/w500${U.poster_path}`,alt:Z(U),className:"w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-500",loading:"lazy"}):E.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-500",children:"No Image"}),E.jsx("div",{className:"absolute top-2 right-2 px-2 py-1 bg-black/80 text-white text-xs font-semibold rounded",children:U.media_type==="tv"?"Series":"Movie"}),E.jsxs("div",{className:"absolute inset-0 bg-black/80 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col items-center justify-center gap-3 p-4",children:[E.jsx("button",{className:"p-3 bg-white text-black rounded-full hover:scale-110 transition",children:E.jsx(zr,{size:20})}),E.jsxs("div",{className:"text-center",children:[E.jsx("p",{className:"text-white font-semibold text-sm line-clamp-2",children:Z(U)}),U.vote_average>0&&E.jsxs("p",{className:"text-yellow-400 text-xs mt-1",children:[" ",U.vote_average.toFixed(1)]})]})]})]}),E.jsxs("div",{className:"mt-2",children:[E.jsx("h3",{className:"text-white font-medium text-sm line-clamp-1",children:Z(U)}),E.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[se(U)&&E.jsx("p",{className:"text-gray-400 text-xs",children:se(U)}),U.media_type&&E.jsxs("span",{className:"text-gray-500 text-xs",children:[" ",U.media_type==="tv"?"Series":"Movie"]})]})]})]},U.id))}),!P&&!O&&M.length===0&&E.jsx("div",{className:"text-center py-20",children:E.jsx("p",{className:"text-gray-400 text-xl",children:"No content available"})})]})})},he=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)},y2=Number.isSafeInteger||function(n){return typeof n=="number"&&Math.abs(n)<=v2},v2=Number.MAX_SAFE_INTEGER||9007199254740991;let we=(function(n){return n.NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n})({}),z=(function(n){return n.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",n.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",n.KEY_SYSTEM_NO_SESSION="keySystemNoSession",n.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",n.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",n.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",n.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",n.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",n.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",n.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",n.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",n.MANIFEST_LOAD_ERROR="manifestLoadError",n.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",n.MANIFEST_PARSING_ERROR="manifestParsingError",n.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",n.LEVEL_EMPTY_ERROR="levelEmptyError",n.LEVEL_LOAD_ERROR="levelLoadError",n.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",n.LEVEL_PARSING_ERROR="levelParsingError",n.LEVEL_SWITCH_ERROR="levelSwitchError",n.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",n.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",n.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",n.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",n.FRAG_LOAD_ERROR="fragLoadError",n.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",n.FRAG_DECRYPT_ERROR="fragDecryptError",n.FRAG_PARSING_ERROR="fragParsingError",n.FRAG_GAP="fragGap",n.REMUX_ALLOC_ERROR="remuxAllocError",n.KEY_LOAD_ERROR="keyLoadError",n.KEY_LOAD_TIMEOUT="keyLoadTimeOut",n.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",n.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",n.BUFFER_APPEND_ERROR="bufferAppendError",n.BUFFER_APPENDING_ERROR="bufferAppendingError",n.BUFFER_STALLED_ERROR="bufferStalledError",n.BUFFER_FULL_ERROR="bufferFullError",n.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",n.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",n.ASSET_LIST_LOAD_ERROR="assetListLoadError",n.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",n.ASSET_LIST_PARSING_ERROR="assetListParsingError",n.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",n.INTERNAL_EXCEPTION="internalException",n.INTERNAL_ABORTED="aborted",n.ATTACH_MEDIA_ERROR="attachMediaError",n.UNKNOWN="unknown",n})({}),R=(function(n){return n.MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.MEDIA_ENDED="hlsMediaEnded",n.STALL_RESOLVED="hlsStallResolved",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFERED_TO_END="hlsBufferedToEnd",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached",n.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",n.ASSET_LIST_LOADING="hlsAssetListLoading",n.ASSET_LIST_LOADED="hlsAssetListLoaded",n.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",n.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",n.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",n.INTERSTITIAL_STARTED="hlsInterstitialStarted",n.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",n.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",n.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",n.INTERSTITIAL_ENDED="hlsInterstitialEnded",n.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",n.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",n.EVENT_CUE_ENTER="hlsEventCueEnter",n})({});var Ge={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},ge={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Di{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){const r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class x2{constructor(e,t,r,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Di(e),this.fast_=new Di(t),this.defaultTTFB_=s,this.ttfb_=new Di(e)}update(e,t){const{slow_:r,fast_:s,ttfb_:i}=this;r.halfLife!==e&&(this.slow_=new Di(e,r.getEstimate(),r.getTotalWeight())),s.halfLife!==t&&(this.fast_=new Di(t,s.getEstimate(),s.getTotalWeight())),i.halfLife!==e&&(this.ttfb_=new Di(e,i.getEstimate(),i.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const r=8*t,s=e/1e3,i=r/s;this.fast_.sample(s,i),this.slow_.sample(s,i)}sampleTTFB(e){const t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function S2(n,e,t){return(e=T2(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function et(){return et=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},et.apply(null,arguments)}function Nx(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function Je(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Nx(Object(t),!0).forEach(function(r){S2(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Nx(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function E2(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function T2(n){var e=E2(n,"string");return typeof e=="symbol"?e:e+""}class $n{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const r=`[${e}]:`;this.trace=ys,this.debug=t.debug.bind(null,r),this.log=t.log.bind(null,r),this.warn=t.warn.bind(null,r),this.info=t.info.bind(null,r),this.error=t.error.bind(null,r)}}const ys=function(){},b2={trace:ys,debug:ys,log:ys,warn:ys,info:ys,error:ys};function Tm(){return et({},b2)}function w2(n,e){const t=self.console[n];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${n}] >`):ys}function Ox(n,e,t){return e[n]?e[n].bind(e):w2(n,t)}const bm=Tm();function A2(n,e,t){const r=Tm();if(typeof console=="object"&&n===!0||typeof n=="object"){const s=["debug","log","info","warn","error"];s.forEach(i=>{r[i]=Ox(i,n,t)});try{r.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return Tm()}s.forEach(i=>{bm[i]=Ox(i,n)})}else et(bm,r);return r}const Ze=bm;function Ls(n=!0){return typeof self>"u"?void 0:(n||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function L2(n){return typeof self<"u"&&n===self.ManagedMediaSource}function Gb(n,e){const t=Object.keys(n),r=Object.keys(e),s=t.length,i=r.length;return!s||!i||s===i&&!t.some(o=>r.indexOf(o)===-1)}function Rn(n,e=!1){if(typeof TextDecoder<"u"){const d=new TextDecoder("utf-8").decode(n);if(e){const f=d.indexOf("\0");return f!==-1?d.substring(0,f):d}return d.replace(/\0/g,"")}const t=n.length;let r,s,i,o="",l=0;for(;l<t;){if(r=n[l++],r===0&&e)return o;if(r===0||r===3)continue;switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(r);break;case 12:case 13:s=n[l++],o+=String.fromCharCode((r&31)<<6|s&63);break;case 14:s=n[l++],i=n[l++],o+=String.fromCharCode((r&15)<<12|(s&63)<<6|(i&63)<<0);break}}return o}function Ut(n){let e="";for(let t=0;t<n.length;t++){let r=n[t].toString(16);r.length<2&&(r="0"+r),e+=r}return e}function Hb(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function R2(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var mh={exports:{}},Mx;function I2(){return Mx||(Mx=1,(function(n,e){(function(t){var r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,i=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,l={buildAbsoluteURL:function(c,d,f){if(f=f||{},c=c.trim(),d=d.trim(),!d){if(!f.alwaysNormalize)return c;var h=l.parseURL(c);if(!h)throw new Error("Error trying to parse base URL.");return h.path=l.normalizePath(h.path),l.buildURLFromParts(h)}var p=l.parseURL(d);if(!p)throw new Error("Error trying to parse relative URL.");if(p.scheme)return f.alwaysNormalize?(p.path=l.normalizePath(p.path),l.buildURLFromParts(p)):d;var v=l.parseURL(c);if(!v)throw new Error("Error trying to parse base URL.");if(!v.netLoc&&v.path&&v.path[0]!=="/"){var g=s.exec(v.path);v.netLoc=g[1],v.path=g[2]}v.netLoc&&!v.path&&(v.path="/");var S={scheme:v.scheme,netLoc:p.netLoc,path:null,params:p.params,query:p.query,fragment:p.fragment};if(!p.netLoc&&(S.netLoc=v.netLoc,p.path[0]!=="/"))if(!p.path)S.path=v.path,p.params||(S.params=v.params,p.query||(S.query=v.query));else{var x=v.path,b=x.substring(0,x.lastIndexOf("/")+1)+p.path;S.path=l.normalizePath(b)}return S.path===null&&(S.path=f.alwaysNormalize?l.normalizePath(p.path):p.path),l.buildURLFromParts(S)},parseURL:function(c){var d=r.exec(c);return d?{scheme:d[1]||"",netLoc:d[2]||"",path:d[3]||"",params:d[4]||"",query:d[5]||"",fragment:d[6]||""}:null},normalizePath:function(c){for(c=c.split("").reverse().join("").replace(i,"");c.length!==(c=c.replace(o,"")).length;);return c.split("").reverse().join("")},buildURLFromParts:function(c){return c.scheme+c.netLoc+c.path+c.params+c.query+c.fragment}};n.exports=l})()})(mh)),mh.exports}var kp=I2();class Pp{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var tt={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class Kb{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,C2(this,"stats")}setByteRange(e,t){const r=e.split("@",2);let s;r.length===1?s=t?.byteRangeEndOffset||0:s=parseInt(r[1]),this._byteRange=[s,parseInt(r[0])+s]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[tt.AUDIO]:null,[tt.VIDEO]:null,[tt.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Pp),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=kp.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[tt.AUDIO]=null,e[tt.VIDEO]=null,e[tt.AUDIOVIDEO]=null}}function Et(n){return n.sn!=="initSegment"}class ph extends Kb{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(he(e)&&he(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const r=Object.keys(t);if(r.length===1){const s=this._decryptdata=t[r[0]]||null;s&&(this._decryptdata=s.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=he(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const r=Object.keys(this.levelkeys),s=r.length;if(s>1||s===1&&(t=this.levelkeys[r[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!he(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Et(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var r;const s=t[e];s&&!((r=this._decryptdata)!=null&&r.keyId)&&(this._decryptdata=s.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,r,s,i,o=!1){const{elementaryStreams:l}=this,c=l[e];if(!c){l[e]={startPTS:t,endPTS:r,startDTS:s,endDTS:i,partial:o};return}c.startPTS=Math.min(c.startPTS,t),c.endPTS=Math.max(c.endPTS,r),c.startDTS=Math.min(c.startDTS,s),c.endDTS=Math.max(c.endDTS,i)}}class _2 extends Kb{constructor(e,t,r,s,i){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=s;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,i),i&&(this.fragOffset=i.fragOffset+i.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function zb(n,e){const t=Object.getPrototypeOf(n);if(t){const r=Object.getOwnPropertyDescriptor(t,e);return r||zb(t,e)}}function C2(n,e){const t=zb(n,e);t&&(t.enumerable=!0,Object.defineProperty(n,e,t))}const Fx=Math.pow(2,32)-1,k2=[].push,Wb={video:1,audio:2,id3:3,text:4};function It(n){return String.fromCharCode.apply(null,n)}function Yb(n,e){const t=n[e]<<8|n[e+1];return t<0?65536+t:t}function Ne(n,e){const t=qb(n,e);return t<0?4294967296+t:t}function Bx(n,e){let t=Ne(n,e);return t*=Math.pow(2,32),t+=Ne(n,e+4),t}function qb(n,e){return n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3]}function P2(n){const e=n.byteLength;for(let t=0;t<e;){const r=Ne(n,t);if(r>8&&n[t+4]===109&&n[t+5]===111&&n[t+6]===111&&n[t+7]===102)return!0;t=r>1?t+r:e}return!1}function Ue(n,e){const t=[];if(!e.length)return t;const r=n.byteLength;for(let s=0;s<r;){const i=Ne(n,s),o=It(n.subarray(s+4,s+8)),l=i>1?s+i:r;if(o===e[0])if(e.length===1)t.push(n.subarray(s+8,l));else{const c=Ue(n.subarray(s+8,l),e.slice(1));c.length&&k2.apply(t,c)}s=l}return t}function D2(n){const e=[],t=n[0];let r=8;const s=Ne(n,r);r+=4;let i=0,o=0;t===0?(i=Ne(n,r),o=Ne(n,r+4),r+=8):(i=Bx(n,r),o=Bx(n,r+8),r+=16),r+=2;let l=n.length+o;const c=Yb(n,r);r+=2;for(let d=0;d<c;d++){let f=r;const h=Ne(n,f);f+=4;const p=h&2147483647;if((h&2147483648)>>>31===1)return Ze.warn("SIDX has hierarchical references (not supported)"),null;const g=Ne(n,f);f+=4,e.push({referenceSize:p,subsegmentDuration:g,info:{duration:g/s,start:l,end:l+p-1}}),l+=p,f+=4,r=f}return{earliestPresentationTime:i,timescale:s,version:t,referencesCount:c,references:e}}function Xb(n){const e=[],t=Ue(n,["moov","trak"]);for(let s=0;s<t.length;s++){const i=t[s],o=Ue(i,["tkhd"])[0];if(o){let l=o[0];const c=Ne(o,l===0?12:20),d=Ue(i,["mdia","mdhd"])[0];if(d){l=d[0];const f=Ne(d,l===0?12:20),h=Ue(i,["mdia","hdlr"])[0];if(h){const p=It(h.subarray(8,12)),v={soun:tt.AUDIO,vide:tt.VIDEO}[p],g=Ue(i,["mdia","minf","stbl","stsd"])[0],S=N2(g);v?(e[c]={timescale:f,type:v,stsd:S},e[v]=Je({timescale:f,id:c},S)):e[c]={timescale:f,type:p,stsd:S}}}}}return Ue(n,["moov","mvex","trex"]).forEach(s=>{const i=Ne(s,4),o=e[i];o&&(o.default={duration:Ne(s,12),flags:Ne(s,20)})}),e}function N2(n){const e=n.subarray(8),t=e.subarray(86),r=It(e.subarray(4,8));let s=r,i;const o=r==="enca"||r==="encv";if(o){const d=Ue(e,[r])[0].subarray(r==="enca"?28:78);Ue(d,["sinf"]).forEach(h=>{const p=Ue(h,["schm"])[0];if(p){const v=It(p.subarray(4,8));if(v==="cbcs"||v==="cenc"){const g=Ue(h,["frma"])[0];g&&(s=It(g))}}})}const l=s;switch(s){case"avc1":case"avc2":case"avc3":case"avc4":{const c=Ue(t,["avcC"])[0];c&&c.length>3&&(s+="."+yu(c[1])+yu(c[2])+yu(c[3]),i=gu(l==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const c=Ue(e,[r])[0],d=Ue(c.subarray(28),["esds"])[0];if(d&&d.length>7){let f=4;if(d[f++]!==3)break;f=gh(d,f),f+=2;const h=d[f++];if(h&128&&(f+=2),h&64&&(f+=d[f++]),d[f++]!==4)break;f=gh(d,f);const p=d[f++];if(p===64)s+="."+yu(p);else break;if(f+=12,d[f++]!==5)break;f=gh(d,f);const v=d[f++];let g=(v&248)>>3;g===31&&(g+=1+((v&7)<<3)+((d[f]&224)>>5)),s+="."+g}break}case"hvc1":case"hev1":{const c=Ue(t,["hvcC"])[0];if(c&&c.length>12){const d=c[1],f=["","A","B","C"][d>>6],h=d&31,p=Ne(c,2),v=(d&32)>>5?"H":"L",g=c[12],S=c.subarray(6,12);s+="."+f+h,s+="."+O2(p).toString(16).toUpperCase(),s+="."+v+g;let x="";for(let b=S.length;b--;){const A=S[b];(A||x)&&(x="."+A.toString(16).toUpperCase()+x)}s+=x}i=gu(l=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{s=gu(s,t)||s;break}case"vp09":{const c=Ue(t,["vpcC"])[0];if(c&&c.length>6){const d=c[4],f=c[5],h=c[6]>>4&15;s+="."+dr(d)+"."+dr(f)+"."+dr(h)}break}case"av01":{const c=Ue(t,["av1C"])[0];if(c&&c.length>2){const d=c[1]>>>5,f=c[1]&31,h=c[2]>>>7?"H":"M",p=(c[2]&64)>>6,v=(c[2]&32)>>5,g=d===2&&p?v?12:10:p?10:8,S=(c[2]&16)>>4,x=(c[2]&8)>>3,b=(c[2]&4)>>2,A=c[2]&3;s+="."+d+"."+dr(f)+h+"."+dr(g)+"."+S+"."+x+b+A+"."+dr(1)+"."+dr(1)+"."+dr(1)+"."+0,i=gu("dav1",t)}break}}return{codec:s,encrypted:o,supplemental:i}}function gu(n,e){const t=Ue(e,["dvvC"]),r=t.length?t[0]:Ue(e,["dvcC"])[0];if(r){const s=r[2]>>1&127,i=r[2]<<5&32|r[3]>>3&31;return n+"."+dr(s)+"."+dr(i)}}function O2(n){let e=0;for(let t=0;t<32;t++)e|=(n>>t&1)<<31-t;return e>>>0}function gh(n,e){const t=e+5;for(;n[e++]&128&&e<t;);return e}function yu(n){return("0"+n.toString(16).toUpperCase()).slice(-2)}function dr(n){return(n<10?"0":"")+n}function M2(n,e){if(!n||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&Qb(n,(r,s)=>{const i=r.subarray(8,24);i.some(o=>o!==0)||(Ze.log(`[eme] Patching keyId in 'enc${s?"a":"v"}>sinf>>tenc' box: ${Ut(i)} -> ${Ut(t)}`),r.set(t,8))})}function F2(n){const e=[];return Qb(n,t=>e.push(t.subarray(8,24))),e}function Qb(n,e){Ue(n,["moov","trak"]).forEach(r=>{const s=Ue(r,["mdia","minf","stbl","stsd"])[0];if(!s)return;const i=s.subarray(8);let o=Ue(i,["enca"]);const l=o.length>0;l||(o=Ue(i,["encv"])),o.forEach(c=>{const d=l?c.subarray(28):c.subarray(78);Ue(d,["sinf"]).forEach(h=>{const p=Jb(h);p&&e(p,l)})})})}function Jb(n){const e=Ue(n,["schm"])[0];if(e){const t=It(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const r=Ue(n,["schi","tenc"])[0];if(r)return r}}}function B2(n,e,t){const r={},s=Ue(n,["moof","traf"]);for(let i=0;i<s.length;i++){const o=s[i],l=Ue(o,["tfhd"])[0],c=Ne(l,4),d=e[c];if(!d)continue;r[c]||(r[c]={start:NaN,duration:0,sampleCount:0,timescale:d.timescale,type:d.type});const f=r[c],h=Ue(o,["tfdt"])[0];if(h){const L=h[0];let I=Ne(h,4);L===1&&(I===Fx?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(I*=Fx+1,I+=Ne(h,8))),he(I)&&(!he(f.start)||I<f.start)&&(f.start=I)}const p=d.default,v=Ne(l,0)|p?.flags;let g=p?.duration||0;v&8&&(v&2?g=Ne(l,12):g=Ne(l,8));const S=Ue(o,["trun"]);let x=f.start||0,b=0,A=g;for(let L=0;L<S.length;L++){const I=S[L],k=Ne(I,4),F=f.sampleCount;f.sampleCount+=k;const C=I[3]&1,P=I[3]&4,O=I[2]&1,M=I[2]&2,H=I[2]&4,Z=I[2]&8;let se=8,U=k;for(C&&(se+=4),P&&k&&(!(I[se+1]&1)&&f.keyFrameIndex===void 0&&(f.keyFrameIndex=F),se+=4,O?(A=Ne(I,se),se+=4):A=g,M&&(se+=4),Z&&(se+=4),x+=A,b+=A,U--);U--;)O?(A=Ne(I,se),se+=4):A=g,M&&(se+=4),H&&(I[se+1]&1||f.keyFrameIndex===void 0&&(f.keyFrameIndex=f.sampleCount-(U+1),f.keyFrameStart=x),se+=4),Z&&(se+=4),x+=A,b+=A;!b&&g&&(b+=g*k)}f.duration+=b}if(!Object.keys(r).some(i=>r[i].duration)){let i=1/0,o=0;const l=Ue(n,["sidx"]);for(let c=0;c<l.length;c++){const d=D2(l[c]);if(d!=null&&d.references){i=Math.min(i,d.earliestPresentationTime/d.timescale);const f=d.references.reduce((h,p)=>h+p.info.duration||0,0);o=Math.max(o,f+d.earliestPresentationTime/d.timescale)}}o&&he(o)&&Object.keys(r).forEach(c=>{r[c].duration||(r[c].duration=o*r[c].timescale-r[c].start)})}return r}function U2(n){const e={valid:null,remainder:null},t=Ue(n,["moof"]);if(t.length<2)return e.remainder=n,e;const r=t[t.length-1];return e.valid=n.slice(0,r.byteOffset-8),e.remainder=n.slice(r.byteOffset-8),e}function Un(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function Ux(n,e){const t=[],r=e.samples,s=e.timescale,i=e.id;let o=!1;return Ue(r,["moof"]).map(c=>{const d=c.byteOffset-8;Ue(c,["traf"]).map(h=>{const p=Ue(h,["tfdt"]).map(v=>{const g=v[0];let S=Ne(v,4);return g===1&&(S*=Math.pow(2,32),S+=Ne(v,8)),S/s})[0];return p!==void 0&&(n=p),Ue(h,["tfhd"]).map(v=>{const g=Ne(v,4),S=Ne(v,0)&16777215,x=(S&1)!==0,b=(S&2)!==0,A=(S&8)!==0;let L=0;const I=(S&16)!==0;let k=0;const F=(S&32)!==0;let C=8;g===i&&(x&&(C+=8),b&&(C+=4),A&&(L=Ne(v,C),C+=4),I&&(k=Ne(v,C),C+=4),F&&(C+=4),e.type==="video"&&(o=Hc(e.codec)),Ue(h,["trun"]).map(P=>{const O=P[0],M=Ne(P,0)&16777215,H=(M&1)!==0;let Z=0;const se=(M&4)!==0,U=(M&256)!==0;let ne=0;const q=(M&512)!==0;let te=0;const G=(M&1024)!==0,Q=(M&2048)!==0;let ee=0;const D=Ne(P,4);let $=8;H&&(Z=Ne(P,$),$+=4),se&&($+=4);let ie=Z+d;for(let ue=0;ue<D;ue++){if(U?(ne=Ne(P,$),$+=4):ne=L,q?(te=Ne(P,$),$+=4):te=k,G&&($+=4),Q&&(O===0?ee=Ne(P,$):ee=qb(P,$),$+=4),e.type===tt.VIDEO){let ce=0;for(;ce<te;){const fe=Ne(r,ie);if(ie+=4,$2(o,r[ie])){const Ee=r.subarray(ie,ie+fe);Dp(Ee,o?2:1,n+ee/s,t)}ie+=fe,ce+=fe+4}}n+=ne/s}}))})})}),t}function Hc(n){if(!n)return!1;const e=n.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function $2(n,e){if(n){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Dp(n,e,t,r){const s=Zb(n);let i=0;i+=e;let o=0,l=0,c=0;for(;i<s.length;){o=0;do{if(i>=s.length)break;c=s[i++],o+=c}while(c===255);l=0;do{if(i>=s.length)break;c=s[i++],l+=c}while(c===255);const d=s.length-i;let f=i;if(l<d)i+=l;else if(l>d){Ze.error(`Malformed SEI payload. ${l} is too small, only ${d} bytes left to parse.`);break}if(o===4){if(s[f++]===181){const p=Yb(s,f);if(f+=2,p===49){const v=Ne(s,f);if(f+=4,v===1195456820){const g=s[f++];if(g===3){const S=s[f++],x=31&S,b=64&S,A=b?2+x*3:0,L=new Uint8Array(A);if(b){L[0]=S;for(let I=1;I<A;I++)L[I]=s[f++]}r.push({type:g,payloadType:o,pts:t,bytes:L})}}}}}else if(o===5&&l>16){const h=[];for(let g=0;g<16;g++){const S=s[f++].toString(16);h.push(S.length==1?"0"+S:S),(g===3||g===5||g===7||g===9)&&h.push("-")}const p=l-16,v=new Uint8Array(p);for(let g=0;g<p;g++)v[g]=s[f++];r.push({payloadType:o,pts:t,uuid:h.join(""),userData:Rn(v),userDataBytes:v})}}}function Zb(n){const e=n.byteLength,t=[];let r=1;for(;r<e-2;)n[r]===0&&n[r+1]===0&&n[r+2]===3?(t.push(r+2),r+=2):r++;if(t.length===0)return n;const s=e-t.length,i=new Uint8Array(s);let o=0;for(r=0;r<s;o++,r++)o===t[0]&&(o++,t.shift()),i[r]=n[o];return i}function j2(n){const e=n[0];let t="",r="",s=0,i=0,o=0,l=0,c=0,d=0;if(e===0){for(;It(n.subarray(d,d+1))!=="\0";)t+=It(n.subarray(d,d+1)),d+=1;for(t+=It(n.subarray(d,d+1)),d+=1;It(n.subarray(d,d+1))!=="\0";)r+=It(n.subarray(d,d+1)),d+=1;r+=It(n.subarray(d,d+1)),d+=1,s=Ne(n,12),i=Ne(n,16),l=Ne(n,20),c=Ne(n,24),d=28}else if(e===1){d+=4,s=Ne(n,d),d+=4;const h=Ne(n,d);d+=4;const p=Ne(n,d);for(d+=4,o=2**32*h+p,y2(o)||(o=Number.MAX_SAFE_INTEGER,Ze.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),l=Ne(n,d),d+=4,c=Ne(n,d),d+=4;It(n.subarray(d,d+1))!=="\0";)t+=It(n.subarray(d,d+1)),d+=1;for(t+=It(n.subarray(d,d+1)),d+=1;It(n.subarray(d,d+1))!=="\0";)r+=It(n.subarray(d,d+1)),d+=1;r+=It(n.subarray(d,d+1)),d+=1}const f=n.subarray(d,n.byteLength);return{schemeIdUri:t,value:r,timeScale:s,presentationTime:o,presentationTimeDelta:i,eventDuration:l,id:c,payload:f}}function V2(n,...e){const t=e.length;let r=8,s=t;for(;s--;)r+=e[s].byteLength;const i=new Uint8Array(r);for(i[0]=r>>24&255,i[1]=r>>16&255,i[2]=r>>8&255,i[3]=r&255,i.set(n,4),s=0,r=8;s<t;s++)i.set(e[s],r),r+=e[s].byteLength;return i}function G2(n,e,t){if(n.byteLength!==16)throw new RangeError("Invalid system id");let r,s;r=0,s=new Uint8Array;let i;r>0?(i=new Uint8Array(4),e.length>0&&new DataView(i.buffer).setUint32(0,e.length,!1)):i=new Uint8Array;const o=new Uint8Array(4);return t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),V2([112,115,115,104],new Uint8Array([r,0,0,0]),n,i,s,o,t)}function H2(n){const e=[];if(n instanceof ArrayBuffer){const t=n.byteLength;let r=0;for(;r+32<t;){const s=new DataView(n,r),i=K2(s);e.push(i),r+=i.size}}return e}function K2(n){const e=n.getUint32(0),t=n.byteOffset,r=n.byteLength;if(r<e)return{offset:t,size:r};if(n.getUint32(4)!==1886614376)return{offset:t,size:e};const i=n.getUint32(8)>>>24;if(i!==0&&i!==1)return{offset:t,size:e};const o=n.buffer,l=Ut(new Uint8Array(o,t+12,16));let c=null,d=null,f=0;if(i===0)f=28;else{const p=n.getUint32(28);if(!p||r<32+p*16)return{offset:t,size:e};c=[];for(let v=0;v<p;v++)c.push(new Uint8Array(o,t+32+v*16,16));f=32+p*16}if(!f)return{offset:t,size:e};const h=n.getUint32(f);return e-32<h?{offset:t,size:e}:(d=new Uint8Array(o,t+f+4,h),{version:i,systemId:l,kids:c,data:d,offset:t,size:e})}const ew=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Ji={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Np(n,e){const t=Ji[e];return!!t&&!!t[n.slice(0,4)]}function Ra(n,e,t=!0){return!n.split(",").some(r=>!Op(r,e,t))}function Op(n,e,t=!0){var r;const s=Ls(t);return(r=s?.isTypeSupported(Ia(n,e)))!=null?r:!1}function Ia(n,e){return`${e}/mp4;codecs=${n}`}function $x(n){if(n){const e=n.substring(0,4);return Ji.video[e]}return 2}function uc(n){const e=ew();return n.split(",").reduce((t,r)=>{const i=e&&Hc(r)?9:Ji.video[r];return i?(i*2+t)/(t?3:2):(Ji.audio[r]+t)/(t?2:1)},0)}const yh={};function z2(n,e=!0){if(yh[n])return yh[n];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[n];for(let s=0;s<t.length;s++){var r;if(Op(t[s],"audio",e))return yh[n]=t[s],t[s];if(t[s]==="mp3"&&(r=Ls(e))!=null&&r.isTypeSupported("audio/mpeg"))return""}return n}const W2=/flac|opus|mp4a\.40\.34/i;function cc(n,e=!0){return n.replace(W2,t=>z2(t.toLowerCase(),e))}function Y2(n,e){const t=[];if(n){const r=n.split(",");for(let s=0;s<r.length;s++)Np(r[s],"video")||t.push(r[s])}return e&&t.push(e),t.join(",")}function ju(n,e){if(n&&(n.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(n)!==-1)&&(jx(n,"audio")||jx(n,"video")))return n;if(e){const t=e.split(",");if(t.length>1){if(n){for(let r=t.length;r--;)if(t[r].substring(0,4)===n.substring(0,4))return t[r]}return t[0]}}return e||n}function jx(n,e){return Np(n,e)&&Op(n,e)}function q2(n){const e=n.split(",");for(let t=0;t<e.length;t++){const r=e[t].split(".");r.length>2&&r[0]==="avc1"&&(e[t]=`avc1.${parseInt(r[1]).toString(16)}${("000"+parseInt(r[2]).toString(16)).slice(-4)}`)}return e.join(",")}function X2(n){if(n.startsWith("av01.")){const e=n.split("."),t=["0","111","01","01","01","0"];for(let r=e.length;r>4&&r<10;r++)e[r]=t[r-4];return e.join(".")}return n}function Vx(n){const e=Ls(n)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function wm(n){return n.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const Q2={supported:!0,powerEfficient:!0,smooth:!0},J2={supported:!1,smooth:!1,powerEfficient:!1},tw={supported:!0,configurations:[],decodingInfoResults:[Q2]};function nw(n,e){return{supported:!1,configurations:e,decodingInfoResults:[J2],error:n}}function Z2(n,e,t,r,s,i){const o=n.videoCodec,l=n.audioCodec?n.audioGroups:null,c=i?.audioCodec,d=i?.channels,f=d?parseInt(d):c?1/0:2;let h=null;if(l!=null&&l.length)try{l.length===1&&l[0]?h=e.groups[l[0]].channels:h=l.reduce((p,v)=>{if(v){const g=e.groups[v];if(!g)throw new Error(`Audio track group ${v} not found`);Object.keys(g.channels).forEach(S=>{p[S]=(p[S]||0)+g.channels[S]})}return p},{2:0})}catch{return!0}return o!==void 0&&(o.split(",").some(p=>Hc(p))||n.width>1920&&n.height>1088||n.height>1920&&n.width>1088||n.frameRate>Math.max(r,30)||n.videoRange!=="SDR"&&n.videoRange!==t||n.bitrate>Math.max(s,8e6))||!!h&&he(f)&&Object.keys(h).some(p=>parseInt(p)>f)}function rw(n,e,t,r={}){const s=n.videoCodec;if(!s&&!n.audioCodec||!t)return Promise.resolve(tw);const i=[],o=eM(n),l=o.length,c=tM(n,e,l>0),d=c.length;for(let f=l||1*d||1;f--;){const h={type:"media-source"};if(l&&(h.video=o[f%l]),d){h.audio=c[f%d];const p=h.audio.bitrate;h.video&&p&&(h.video.bitrate-=p)}i.push(h)}if(s){const f=navigator.userAgent;if(s.split(",").some(h=>Hc(h))&&ew())return Promise.resolve(nw(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${f})`),i))}return Promise.all(i.map(f=>{const h=rM(f);return r[h]||(r[h]=t.decodingInfo(f))})).then(f=>({supported:!f.some(h=>!h.supported),configurations:i,decodingInfoResults:f})).catch(f=>({supported:!1,configurations:i,decodingInfoResults:[],error:f}))}function eM(n){var e;const t=(e=n.videoCodec)==null?void 0:e.split(","),r=sw(n),s=n.width||640,i=n.height||480,o=n.frameRate||30,l=n.videoRange.toLowerCase();return t?t.map(c=>{const d={contentType:Ia(X2(c),"video"),width:s,height:i,bitrate:r,framerate:o};return l!=="sdr"&&(d.transferFunction=l),d}):[]}function tM(n,e,t){var r;const s=(r=n.audioCodec)==null?void 0:r.split(","),i=sw(n);return s&&n.audioGroups?n.audioGroups.reduce((o,l)=>{var c;const d=l?(c=e.groups[l])==null?void 0:c.tracks:null;return d?d.reduce((f,h)=>{if(h.groupId===l){const p=parseFloat(h.channels||"");s.forEach(v=>{const g={contentType:Ia(v,"audio"),bitrate:t?nM(v,i):i};p&&(g.channels=""+p),f.push(g)})}return f},o):o},[]):[]}function nM(n,e){if(e<=1)return 1;let t=128e3;return n==="ec-3"?t=768e3:n==="ac-3"&&(t=64e4),Math.min(e/2,t)}function sw(n){return Math.ceil(Math.max(n.bitrate*.9,n.averageBitrate)/1e3)*1e3||1}function rM(n){let e="";const{audio:t,video:r}=n;if(r){const s=wm(r.contentType);e+=`${s}_r${r.height}x${r.width}f${Math.ceil(r.framerate)}${r.transferFunction||"sd"}_${Math.ceil(r.bitrate/1e5)}`}if(t){const s=wm(t.contentType);e+=`${r?"_":""}${s}_c${t.channels}`}return e}const Am=["NONE","TYPE-0","TYPE-1",null];function sM(n){return Am.indexOf(n)>-1}const dc=["SDR","PQ","HLG"];function iM(n){return!!n&&dc.indexOf(n)>-1}var Vu={No:"",Yes:"YES",v2:"v2"};function Gx(n){const{canSkipUntil:e,canSkipDateRanges:t,age:r}=n,s=r<e/2;return e&&s?t?Vu.v2:Vu.Yes:Vu.No}class Hx{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class _a{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(r=>!!r).map(r=>r.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const r=(t=e.supplemental)==null?void 0:t.videoCodec;r&&r!==e.videoCodec&&(this.codecSet+=`,${r.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Kx(this._audioGroups,e)}hasSubtitleGroup(e){return Kx(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let r=this._audioGroups;r||(r=this._audioGroups=[]),r.indexOf(t)===-1&&r.push(t)}else if(e==="text"){let r=this._subtitleGroups;r||(r=this._subtitleGroups=[]),r.indexOf(t)===-1&&r.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Kx(n,e){return!e||!n?!1:n.indexOf(e)!==-1}function oM(){if(typeof matchMedia=="function"){const n=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(n.media!==e.media)return n.matches===!0}return!1}function aM(n,e){let t=!1,r=[];if(n&&(t=n!=="SDR",r=[n]),e){r=e.allowedVideoRanges||dc.slice(0);const s=r.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:s&&oM(),t||(r=["SDR"])}return{preferHDR:t,allowedVideoRanges:r}}const lM=n=>{const e=new WeakSet;return(t,r)=>{if(n&&(r=n(t,r)),typeof r=="object"&&r!==null){if(e.has(r))return;e.add(r)}return r}},nt=(n,e)=>JSON.stringify(n,lM(e));function uM(n,e,t,r,s){const i=Object.keys(n),o=r?.channels,l=r?.audioCodec,c=s?.videoCodec,d=o&&parseInt(o)===2;let f=!1,h=!1,p=1/0,v=1/0,g=1/0,S=1/0,x=0,b=[];const{preferHDR:A,allowedVideoRanges:L}=aM(e,s);for(let P=i.length;P--;){const O=n[i[P]];f||(f=O.channels[2]>0),p=Math.min(p,O.minHeight),v=Math.min(v,O.minFramerate),g=Math.min(g,O.minBitrate),L.filter(H=>O.videoRanges[H]>0).length>0&&(h=!0)}p=he(p)?p:0,v=he(v)?v:0;const I=Math.max(1080,p),k=Math.max(30,v);g=he(g)?g:t,t=Math.max(g,t),h||(e=void 0);const F=i.length>1;return{codecSet:i.reduce((P,O)=>{const M=n[O];if(O===P)return P;if(b=h?L.filter(H=>M.videoRanges[H]>0):[],F){if(M.minBitrate>t)return lr(O,`min bitrate of ${M.minBitrate} > current estimate of ${t}`),P;if(!M.hasDefaultAudio)return lr(O,"no renditions with default or auto-select sound found"),P;if(l&&O.indexOf(l.substring(0,4))%5!==0)return lr(O,`audio codec preference "${l}" not found`),P;if(o&&!d){if(!M.channels[o])return lr(O,`no renditions with ${o} channel sound found (channels options: ${Object.keys(M.channels)})`),P}else if((!l||d)&&f&&M.channels[2]===0)return lr(O,"no renditions with stereo sound found"),P;if(M.minHeight>I)return lr(O,`min resolution of ${M.minHeight} > maximum of ${I}`),P;if(M.minFramerate>k)return lr(O,`min framerate of ${M.minFramerate} > maximum of ${k}`),P;if(!b.some(H=>M.videoRanges[H]>0))return lr(O,`no variants with VIDEO-RANGE of ${nt(b)} found`),P;if(c&&O.indexOf(c.substring(0,4))%5!==0)return lr(O,`video codec preference "${c}" not found`),P;if(M.maxScore<x)return lr(O,`max score of ${M.maxScore} < selected max of ${x}`),P}return P&&(uc(O)>=uc(P)||M.fragmentError>n[P].fragmentError)?P:(S=M.minIndex,x=M.maxScore,O)},void 0),videoRanges:b,preferHDR:A,minFramerate:v,minBitrate:g,minIndex:S}}function lr(n,e){Ze.log(`[abr] start candidates with "${n}" ignored because ${e}`)}function iw(n){return n.reduce((e,t)=>{let r=e.groups[t.groupId];r||(r=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(t);const s=t.channels||"2";return r.channels[s]=(r.channels[s]||0)+1,r.hasDefault=r.hasDefault||t.default,r.hasAutoSelect=r.hasAutoSelect||t.autoselect,r.hasDefault&&(e.hasDefaultAudio=!0),r.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function cM(n,e,t,r){return n.slice(t,r+1).reduce((s,i,o)=>{if(!i.codecSet)return s;const l=i.audioGroups;let c=s[i.codecSet];c||(s[i.codecSet]=c={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!l,fragmentError:0}),c.minBitrate=Math.min(c.minBitrate,i.bitrate);const d=Math.min(i.height,i.width);return c.minHeight=Math.min(c.minHeight,d),c.minFramerate=Math.min(c.minFramerate,i.frameRate),c.minIndex=Math.min(c.minIndex,o),c.maxScore=Math.max(c.maxScore,i.score),c.fragmentError+=i.fragmentError,c.videoRanges[i.videoRange]=(c.videoRanges[i.videoRange]||0)+1,l&&l.forEach(f=>{if(!f)return;const h=e.groups[f];h&&(c.hasDefaultAudio=c.hasDefaultAudio||e.hasDefaultAudio?h.hasDefault:h.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(h.channels).forEach(p=>{c.channels[p]=(c.channels[p]||0)+h.channels[p]}))}),s},{})}function zx(n){if(!n)return n;const{lang:e,assocLang:t,characteristics:r,channels:s,audioCodec:i}=n;return{lang:e,assocLang:t,characteristics:r,channels:s,audioCodec:i}}function mr(n,e,t){if("attrs"in n){const r=e.indexOf(n);if(r!==-1)return r}for(let r=0;r<e.length;r++){const s=e[r];if(ni(n,s,t))return r}return-1}function ni(n,e,t){const{groupId:r,name:s,lang:i,assocLang:o,default:l}=n,c=n.forced;return(r===void 0||e.groupId===r)&&(s===void 0||e.name===s)&&(i===void 0||dM(i,e.lang))&&(i===void 0||e.assocLang===o)&&(l===void 0||e.default===l)&&(c===void 0||e.forced===c)&&(!("characteristics"in n)||fM(n.characteristics||"",e.characteristics))&&(t===void 0||t(n,e))}function dM(n,e="--"){return n.length===e.length?n===e:n.startsWith(e)||e.startsWith(n)}function fM(n,e=""){const t=n.split(","),r=e.split(",");return t.length===r.length&&!t.some(s=>r.indexOf(s)===-1)}function qs(n,e){const{audioCodec:t,channels:r}=n;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(r===void 0||r===(e.channels||"2"))}function hM(n,e,t,r,s){const i=e[r],l=e.reduce((p,v,g)=>{const S=v.uri;return(p[S]||(p[S]=[])).push(g),p},{})[i.uri];l.length>1&&(r=Math.max.apply(Math,l));const c=i.videoRange,d=i.frameRate,f=i.codecSet.substring(0,4),h=Wx(e,r,p=>{if(p.videoRange!==c||p.frameRate!==d||p.codecSet.substring(0,4)!==f)return!1;const v=p.audioGroups,g=t.filter(S=>!v||v.indexOf(S.groupId)!==-1);return mr(n,g,s)>-1});return h>-1?h:Wx(e,r,p=>{const v=p.audioGroups,g=t.filter(S=>!v||v.indexOf(S.groupId)!==-1);return mr(n,g,s)>-1})}function Wx(n,e,t){for(let r=e;r>-1;r--)if(t(n[r]))return r;for(let r=e+1;r<n.length;r++)if(t(n[r]))return r;return-1}function fc(n,e){var t;return!!n&&n!==((t=e.loadLevelObj)==null?void 0:t.uri)}class mM extends $n{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var r;const{fragCurrent:s,partCurrent:i,hls:o}=this,{autoLevelEnabled:l,media:c}=o;if(!s||!c)return;const d=performance.now(),f=i?i.stats:s.stats,h=i?i.duration:s.duration,p=d-f.loading.start,v=o.minAutoLevel,g=s.level,S=this._nextAutoLevel;if(f.aborted||f.loaded&&f.loaded===f.total||g<=v){this.clearTimer(),this._nextAutoLevel=-1;return}if(!l)return;const x=S>-1&&S!==g,b=!!t||x;if(!b&&(c.paused||!c.playbackRate||!c.readyState))return;const A=o.mainForwardBufferInfo;if(!b&&A===null)return;const L=this.bwEstimator.getEstimateTTFB(),I=Math.abs(c.playbackRate);if(p<=Math.max(L,1e3*(h/(I*2))))return;const k=A?A.len/I:0,F=f.loading.first?f.loading.first-f.loading.start:-1,C=f.loaded&&F>-1,P=this.getBwEstimate(),O=o.levels,M=O[g],H=Math.max(f.loaded,Math.round(h*(s.bitrate||M.averageBitrate)/8));let Z=C?p-F:p;Z<1&&C&&(Z=Math.min(p,f.loaded*8/P));const se=C?f.loaded*1e3/Z:0,U=L/1e3,ne=se?(H-f.loaded)/se:H*8/P+U;if(ne<=k)return;const q=se?se*8:P,te=((r=t?.details||this.hls.latestLevelDetails)==null?void 0:r.live)===!0,G=this.hls.config.abrBandWidthUpFactor;let Q=Number.POSITIVE_INFINITY,ee;for(ee=g-1;ee>v;ee--){const ue=O[ee].maxBitrate,ce=!O[ee].details||te;if(Q=this.getTimeToLoadFrag(U,q,h*ue,ce),Q<Math.min(k,h+U))break}if(Q>=ne||Q>h*10)return;C?this.bwEstimator.sample(p-Math.min(L,F),f.loaded):this.bwEstimator.sampleTTFB(p);const D=O[ee].maxBitrate;this.getBwEstimate()*G>D&&this.resetEstimator(D);const $=this.findBestLevel(D,v,ee,0,k,1,1);$>-1&&(ee=$),this.warn(`Fragment ${s.sn}${i?" part "+i.index:""} of level ${g} is loading too slowly;
      Fragment duration: ${s.duration.toFixed(3)}
      Time to underbuffer: ${k.toFixed(3)} s
      Estimated load time for current fragment: ${ne.toFixed(3)} s
      Estimated load time for down switch fragment: ${Q.toFixed(3)} s
      TTFB estimate: ${F|0} ms
      Current BW estimate: ${he(P)?P|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${ee} @ ${D|0} bps`),o.nextLoadLevel=o.nextAutoLevel=ee,this.clearTimer();const ie=()=>{if(this.clearTimer(),this.fragCurrent===s&&this.hls.loadLevel===ee&&ee>0){const ue=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${ee>0?"and switching down":""}
      Fragment duration: ${s.duration.toFixed(3)} s
      Time to underbuffer: ${ue.toFixed(3)} s`),s.abortRequests(),this.fragCurrent=this.partCurrent=null,ee>v){let ce=this.findBestLevel(this.hls.levels[v].bitrate,v,ee,0,ue,1,1);ce===-1&&(ce=v),this.hls.nextLoadLevel=this.hls.nextAutoLevel=ce,this.resetEstimator(this.hls.levels[ce].bitrate)}}};x||ne>Q*2?ie():this.timer=self.setInterval(ie,Q*1e3),o.trigger(R.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,part:i,stats:f})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new x2(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.FRAG_LOADING,this.onFragLoading,this),e.on(R.FRAG_LOADED,this.onFragLoaded,this),e.on(R.FRAG_BUFFERED,this.onFragBuffered,this),e.on(R.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(R.LEVEL_LOADED,this.onLevelLoaded,this),e.on(R.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(R.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(R.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.FRAG_LOADING,this.onFragLoading,this),e.off(R.FRAG_LOADED,this.onFragLoaded,this),e.off(R.FRAG_BUFFERED,this.onFragBuffered,this),e.off(R.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(R.LEVEL_LOADED,this.onLevelLoaded,this),e.off(R.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(R.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(R.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const r=t.frag;if(!this.ignoreFragment(r)){if(!r.bitrateTest){var s;this.fragCurrent=r,this.partCurrent=(s=t.part)!=null?s:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case z.BUFFER_ADD_CODEC_ERROR:case z.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case z.FRAG_LOAD_TIMEOUT:{const r=t.frag,{fragCurrent:s,partCurrent:i}=this;if(r&&s&&r.sn===s.sn&&r.level===s.level){const o=performance.now(),l=i?i.stats:r.stats,c=o-l.loading.start,d=l.loading.first?l.loading.first-l.loading.start:-1;if(l.loaded&&d>-1){const h=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(c-Math.min(h,d),l.loaded)}else this.bwEstimator.sampleTTFB(c)}break}}}getTimeToLoadFrag(e,t,r,s){const i=e+r/t,o=s?e+this.lastLevelLoadSec:0;return i+o}onLevelLoaded(e,t){const r=this.hls.config,{loading:s}=t.stats,i=s.end-s.first;he(i)&&(this.lastLevelLoadSec=i/1e3),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:r}){const s=r?r.stats:t.stats;if(t.type===ge.MAIN&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const i=r?r.duration:t.duration,o=this.hls.levels[t.level],l=(o.loaded?o.loaded.bytes:0)+s.loaded,c=(o.loaded?o.loaded.duration:0)+i;o.loaded={bytes:l,duration:c},o.realBitrate=Math.round(8*l/c)}if(t.bitrateTest){const i={stats:s,frag:t,part:r,id:t.type};this.onFragBuffered(R.FRAG_BUFFERED,i),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:r,part:s}=t,i=s!=null&&s.stats.loaded?s.stats:r.stats;if(i.aborted||this.ignoreFragment(r))return;const o=i.parsing.end-i.loading.start-Math.min(i.loading.first-i.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,i.loaded),i.bwEstimate=this.getBwEstimate(),r.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==ge.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,r=this.getBwEstimate(),s=this.hls.config.maxStarvationDelay,i=this.findBestLevel(r,t,e,0,s,1,1);if(i>-1)return i;const o=this.hls.firstLevel,l=Math.min(Math.max(o,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${l}`),l}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,r=this.bwEstimator.canEstimate(),s=this.lastLoadedFragLevel>-1;if(e!==-1&&(!r||!s||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const i=r&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,i)&&o[e].loadError<=o[i].loadError)return e}return this._nextAutoLevel=i,this.nextAutoLevelKey=this.getAutoLevelKey(),i}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:r}=this;if(r.levels.length<=1)return r.loadLevel;const{maxAutoLevel:s,config:i,minAutoLevel:o}=r,l=t?t.duration:e?e.duration:0,c=this.getBwEstimate(),d=this.getStarvationDelay();let f=i.abrBandWidthFactor,h=i.abrBandWidthUpFactor;if(d){const x=this.findBestLevel(c,o,s,d,0,f,h);if(x>=0)return this.rebufferNotice=-1,x}let p=l?Math.min(l,i.maxStarvationDelay):i.maxStarvationDelay;if(!d){const x=this.bitrateTestDelay;x&&(p=(l?Math.min(l,i.maxLoadingDelay):i.maxLoadingDelay)-x,this.info(`bitrate test took ${Math.round(1e3*x)}ms, set first fragment max fetchDuration to ${Math.round(1e3*p)} ms`),f=h=1)}const v=this.findBestLevel(c,o,s,d,p,f,h);if(this.rebufferNotice!==v&&(this.rebufferNotice=v,this.info(`${d?"rebuffering expected":"buffer is empty"}, optimal quality level ${v}`)),v>-1)return v;const g=r.levels[o],S=r.loadLevelObj;return S&&g?.bitrate<S.bitrate?o:r.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const r=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,s=e.mainForwardBufferInfo;return(s?s.len:0)/r}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,r,s,i,o,l){var c;const d=s+i,f=this.lastLoadedFragLevel,h=f===-1?this.hls.firstLevel:f,{fragCurrent:p,partCurrent:v}=this,{levels:g,allAudioTracks:S,loadLevel:x,config:b}=this.hls;if(g.length===1)return 0;const A=g[h],L=!!((c=this.hls.latestLevelDetails)!=null&&c.live),I=x===-1||f===-1;let k,F="SDR",C=A?.frameRate||0;const{audioPreference:P,videoPreference:O}=b,M=this.audioTracksByGroup||(this.audioTracksByGroup=iw(S));let H=-1;if(I){if(this.firstSelection!==-1)return this.firstSelection;const q=this.codecTiers||(this.codecTiers=cM(g,M,t,r)),te=uM(q,F,e,P,O),{codecSet:G,videoRanges:Q,minFramerate:ee,minBitrate:D,minIndex:$,preferHDR:ie}=te;H=$,k=G,F=ie?Q[Q.length-1]:Q[0],C=ee,e=Math.max(e,D),this.log(`picked start tier ${nt(te)}`)}else k=A?.codecSet,F=A?.videoRange;const Z=v?v.duration:p?p.duration:0,se=this.bwEstimator.getEstimateTTFB()/1e3,U=[];for(let q=r;q>=t;q--){var ne;const te=g[q],G=q>h;if(!te)continue;if(b.useMediaCapabilities&&!te.supportedResult&&!te.supportedPromise){const ce=navigator.mediaCapabilities;typeof ce?.decodingInfo=="function"&&Z2(te,M,F,C,e,P)?(te.supportedPromise=rw(te,M,ce,this.supportedCache),te.supportedPromise.then(fe=>{if(!this.hls)return;te.supportedResult=fe;const Ee=this.hls.levels,ye=Ee.indexOf(te);fe.error?this.warn(`MediaCapabilities decodingInfo error: "${fe.error}" for level ${ye} ${nt(fe)}`):fe.supported?fe.decodingInfoResults.some(Le=>Le.smooth===!1||Le.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${ye} not smooth or powerEfficient: ${nt(fe)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${ye} ${nt(fe)}`),ye>-1&&Ee.length>1&&(this.log(`Removing unsupported level ${ye}`),this.hls.removeLevel(ye),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(fe=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${fe}`)})):te.supportedResult=tw}if((k&&te.codecSet!==k||F&&te.videoRange!==F||G&&C>te.frameRate||!G&&C>0&&C<te.frameRate||(ne=te.supportedResult)!=null&&(ne=ne.decodingInfoResults)!=null&&ne.some(ce=>ce.smooth===!1))&&(!I||q!==H)){U.push(q);continue}const Q=te.details,ee=(v?Q?.partTarget:Q?.averagetargetduration)||Z;let D;G?D=l*e:D=o*e;const $=Z&&s>=Z*2&&i===0?te.averageBitrate:te.maxBitrate,ie=this.getTimeToLoadFrag(se,D,$*ee,Q===void 0);if(D>=$&&(q===f||te.loadError===0&&te.fragmentError===0)&&(ie<=se||!he(ie)||L&&!this.bitrateTestDelay||ie<d)){const ce=this.forcedAutoLevel;return q!==x&&(ce===-1||ce!==x)&&(U.length&&this.trace(`Skipped level(s) ${U.join(",")} of ${r} max with CODECS and VIDEO-RANGE:"${g[U[0]].codecs}" ${g[U[0]].videoRange}; not compatible with "${k}" ${F}`),this.info(`switch candidate:${h}->${q} adjustedbw(${Math.round(D)})-bitrate=${Math.round(D-$)} ttfb:${se.toFixed(1)} avgDuration:${ee.toFixed(1)} maxFetchDuration:${d.toFixed(1)} fetchDuration:${ie.toFixed(1)} firstSelection:${I} codecSet:${te.codecSet} videoRange:${te.videoRange} hls.loadLevel:${x}`)),I&&(this.firstSelection=q),q}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:r}=this.hls;return Math.min(Math.max(e,r),t)}}const ow={search:function(n,e){let t=0,r=n.length-1,s=null,i=null;for(;t<=r;){s=(t+r)/2|0,i=n[s];const o=e(i);if(o>0)t=s+1;else if(o<0)r=s-1;else return i}return null}};function pM(n,e,t){if(e===null||!Array.isArray(n)||!n.length||!he(e))return null;const r=n[0].programDateTime;if(e<(r||0))return null;const s=n[n.length-1].endProgramDateTime;if(e>=(s||0))return null;for(let i=0;i<n.length;++i){const o=n[i];if(yM(e,t,o))return o}return null}function ii(n,e,t=0,r=0,s=.005){let i=null;if(n){i=e[1+n.sn-e[0].sn]||null;const l=n.endDTS-t;l>0&&l<15e-7&&(t+=15e-7),i&&n.level!==i.level&&i.end<=n.end&&(i=e[2+n.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(i=e[0]);if(i&&((!n||n.level===i.level)&&Yx(t,r,i)===0||gM(i,n,Math.min(s,r))))return i;const o=ow.search(e,Yx.bind(null,t,r));return o&&(o!==n||!i)?o:i}function gM(n,e,t){if(e&&e.start===0&&e.level<n.level&&(e.endPTS||0)>0){const r=e.tagList.reduce((s,i)=>(i[0]==="INF"&&(s+=parseFloat(i[1])),s),t);return n.start<=r}return!1}function Yx(n=0,e=0,t){if(t.start<=n&&t.start+t.duration>n)return 0;const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-r<=n?1:t.start-r>n&&t.start?-1:0}function yM(n,e,t){const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-r>n}function aw(n,e,t){if(n&&n.startCC<=e&&n.endCC>=e){let r=n.fragments;const{fragmentHint:s}=n;s&&(r=r.concat(s));let i;return ow.search(r,o=>o.cc<e?1:o.cc>e?-1:(i=o,o.end<=t?1:o.start>t?-1:0)),i||null}return null}function hc(n){switch(n.details){case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_TIMEOUT:case z.LEVEL_LOAD_TIMEOUT:case z.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function lw(n){return n.details.startsWith("key")}function uw(n){return lw(n)&&!!n.frag&&!n.frag.decryptdata}function qx(n,e){const t=hc(e);return n.default[`${t?"timeout":"error"}Retry`]}function Mp(n,e){const t=n.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*n.retryDelayMs,n.maxRetryDelayMs)}function Xx(n){return Je(Je({},n),{errorRetry:null,timeoutRetry:null})}function mc(n,e,t,r){if(!n)return!1;const s=r?.code,i=e<n.maxNumRetry&&(vM(s)||!!t);return n.shouldRetry?n.shouldRetry(n,e,t,r,i):i}function vM(n){return Lm(n)||!!n&&(n<400||n>499)}function Lm(n){return n===0&&navigator.onLine===!1}var Bt={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},Tn={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class xM extends $n{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(R.ERROR,this.onError,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(R.ERROR,this.onError,this),e.off(R.ERROR,this.onErrorOut,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return e?.type===ge.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,r=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||r===-1?t.loadLevel:r}variantHasKey(e,t){if(e){var r;if((r=e.details)!=null&&r.hasKey(t))return!0;const s=e.audioGroups;if(s)return this.hls.allAudioTracks.filter(o=>s.indexOf(o.groupId)>=0).some(o=>{var l;return(l=o.details)==null?void 0:l.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var r;if(t.fatal)return;const s=this.hls,i=t.context;switch(t.details){case z.FRAG_LOAD_ERROR:case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_ERROR:case z.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case z.FRAG_PARSING_ERROR:if((r=t.frag)!=null&&r.gap){t.errorAction=Hi();return}case z.FRAG_GAP:case z.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Bt.SendAlternateToPenaltyBox;return}case z.LEVEL_EMPTY_ERROR:case z.LEVEL_PARSING_ERROR:{var o;const c=t.parent===ge.MAIN?t.level:s.loadLevel;t.details===z.LEVEL_EMPTY_ERROR&&((o=t.context)!=null&&(o=o.levelDetails)!=null&&o.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,c):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,c))}return;case z.LEVEL_LOAD_ERROR:case z.LEVEL_LOAD_TIMEOUT:typeof i?.level=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.level));return;case z.AUDIO_TRACK_LOAD_ERROR:case z.AUDIO_TRACK_LOAD_TIMEOUT:case z.SUBTITLE_LOAD_ERROR:case z.SUBTITLE_TRACK_LOAD_TIMEOUT:if(i){const c=s.loadLevelObj;if(c&&(i.type===Ge.AUDIO_TRACK&&c.hasAudioGroup(i.groupId)||i.type===Ge.SUBTITLE_TRACK&&c.hasSubtitleGroup(i.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.loadLevel),t.errorAction.action=Bt.SendAlternateToPenaltyBox,t.errorAction.flags=Tn.MoveAllAlternatesMatchingHost;return}}return;case z.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:Bt.SendAlternateToPenaltyBox,flags:Tn.MoveAllAlternatesMatchingHDCP};return;case z.KEY_SYSTEM_SESSION_UPDATE_FAILED:case z.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case z.KEY_SYSTEM_NO_SESSION:t.errorAction={action:Bt.SendAlternateToPenaltyBox,flags:Tn.MoveAllAlternatesMatchingKey};return;case z.BUFFER_ADD_CODEC_ERROR:case z.REMUX_ALLOC_ERROR:case z.BUFFER_APPEND_ERROR:if(!t.errorAction){var l;t.errorAction=this.getLevelSwitchAction(t,(l=t.level)!=null?l:s.loadLevel)}return;case z.INTERNAL_EXCEPTION:case z.BUFFER_APPENDING_ERROR:case z.BUFFER_FULL_ERROR:case z.LEVEL_SWITCH_ERROR:case z.BUFFER_STALLED_ERROR:case z.BUFFER_SEEK_OVER_HOLE:case z.BUFFER_NUDGE_ON_STALL:t.errorAction=Hi();return}t.type===we.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=Hi())}getPlaylistRetryOrSwitchAction(e,t){const r=this.hls,s=qx(r.config.playlistLoadPolicy,e),i=this.playlistError++;if(mc(s,i,hc(e),e.response))return{action:Bt.RetryRequest,flags:Tn.None,retryConfig:s,retryCount:i};const l=this.getLevelSwitchAction(e,t);return s&&(l.retryConfig=s,l.retryCount=i),l}getFragRetryOrSwitchAction(e){const t=this.hls,r=this.getVariantLevelIndex(e.frag),s=t.levels[r],{fragLoadPolicy:i,keyLoadPolicy:o}=t.config,l=qx(lw(e)?o:i,e),c=t.levels.reduce((f,h)=>f+h.fragmentError,0);if(s&&(e.details!==z.FRAG_GAP&&s.fragmentError++,!uw(e)&&mc(l,c,hc(e),e.response)))return{action:Bt.RetryRequest,flags:Tn.None,retryConfig:l,retryCount:c};const d=this.getLevelSwitchAction(e,r);return l&&(d.retryConfig=l,d.retryCount=c),d}getLevelSwitchAction(e,t){const r=this.hls;t==null&&(t=r.loadLevel);const s=this.hls.levels[t];if(s){var i,o;const d=e.details;s.loadError++,d===z.BUFFER_APPEND_ERROR&&s.fragmentError++;let f=-1;const{levels:h,loadLevel:p,minAutoLevel:v,maxAutoLevel:g}=r;!r.autoLevelEnabled&&!r.config.preserveManualLevelOnError&&(r.loadLevel=-1);const S=(i=e.frag)==null?void 0:i.type,b=(S===ge.AUDIO&&d===z.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(d===z.BUFFER_ADD_CODEC_ERROR||d===z.BUFFER_APPEND_ERROR))&&h.some(({audioCodec:F})=>s.audioCodec!==F),L=e.sourceBufferName==="video"&&(d===z.BUFFER_ADD_CODEC_ERROR||d===z.BUFFER_APPEND_ERROR)&&h.some(({codecSet:F,audioCodec:C})=>s.codecSet!==F&&s.audioCodec===C),{type:I,groupId:k}=(o=e.context)!=null?o:{};for(let F=h.length;F--;){const C=(F+p)%h.length;if(C!==p&&C>=v&&C<=g&&h[C].loadError===0){var l,c;const P=h[C];if(d===z.FRAG_GAP&&S===ge.MAIN&&e.frag){const O=h[C].details;if(O){const M=ii(e.frag,O.fragments,e.frag.start);if(M!=null&&M.gap)continue}}else{if(I===Ge.AUDIO_TRACK&&P.hasAudioGroup(k)||I===Ge.SUBTITLE_TRACK&&P.hasSubtitleGroup(k))continue;if(S===ge.AUDIO&&(l=s.audioGroups)!=null&&l.some(O=>P.hasAudioGroup(O))||S===ge.SUBTITLE&&(c=s.subtitleGroups)!=null&&c.some(O=>P.hasSubtitleGroup(O))||b&&s.audioCodec===P.audioCodec||L&&s.codecSet===P.codecSet||!b&&s.codecSet!==P.codecSet)continue}f=C;break}}if(f>-1&&r.loadLevel!==f)return e.levelRetry=!0,this.playlistError=0,{action:Bt.SendAlternateToPenaltyBox,flags:Tn.None,nextAutoLevel:f}}return{action:Bt.SendAlternateToPenaltyBox,flags:Tn.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var r;switch((r=t.errorAction)==null?void 0:r.action){case Bt.DoNothing:break;case Bt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==z.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,r=e.errorAction;if(!r)return;const{flags:s}=r,i=r.nextAutoLevel;switch(s){case Tn.None:this.switchLevel(e,i);break;case Tn.MoveAllAlternatesMatchingHDCP:{const c=this.getVariantLevelIndex(e.frag),d=t.levels[c],f=d?.attrs["HDCP-LEVEL"];if(r.hdcpLevel=f,f==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(f){t.maxHdcpLevel=Am[Am.indexOf(f)-1],r.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case Tn.MoveAllAlternatesMatchingKey:{const c=e.decryptdata;if(c){const d=this.hls.levels,f=d.length;for(let p=f;p--;)if(this.variantHasKey(d[p],c)){var o,l;this.log(`Banned key found in level ${p} (${d[p].bitrate}bps) or audio group "${(o=d[p].audioGroups)==null?void 0:o.join(",")}" (${(l=e.frag)==null?void 0:l.type} fragment) ${Ut(c.keyId||[])}`),d[p].fragmentError++,d[p].loadError++,this.log(`Removing level ${p} with key error (${e.error})`),this.hls.removeLevel(p)}const h=e.frag;if(this.hls.levels.length<f)r.resolved=!0;else if(h&&h.type!==ge.MAIN){const p=h.decryptdata;p&&!c.matches(p)&&(r.resolved=!0)}}break}}r.resolved||this.switchLevel(e,i)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===z.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const r=wm(e.mimeType),s=this.hls.levels;for(let i=s.length;i--;)s[i][`${e.sourceBufferName}Codec`]===r&&(this.log(`Removing level ${i} for ${e.details} ("${r}" not supported)`),this.hls.removeLevel(i))}}}function Hi(n){const e={action:Bt.DoNothing,flags:Tn.None};return n&&(e.resolved=!0),e}var _t={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class SM{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.BUFFER_APPENDED,this.onBufferAppended,this),e.on(R.FRAG_BUFFERED,this.onFragBuffered,this),e.on(R.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.BUFFER_APPENDED,this.onBufferAppended,this),e.off(R.FRAG_BUFFERED,this.onFragBuffered,this),e.off(R.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const r=this.activePartLists[t];if(r)for(let s=r.length;s--;){const i=r[s];if(!i)break;if(i.start<=e&&e<=i.end&&i.loaded)return i}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,r){const{fragments:s}=this,i=Object.keys(s);for(let o=i.length;o--;){const l=s[i[o]];if(l?.body.type===t&&(!r||l.buffered)){const c=l.body;if(c.start<=e&&e<=c.end)return c}}return null}detectEvictedFragments(e,t,r,s,i){this.timeRanges&&(this.timeRanges[e]=t);const o=s?.fragment.sn||-1;Object.keys(this.fragments).forEach(l=>{const c=this.fragments[l];if(!c||o>=c.body.sn)return;if(!c.buffered&&(!c.loaded||i)){c.body.type===r&&this.removeFragment(c.body);return}const d=c.range[e];if(d){if(d.time.length===0){this.removeFragment(c.body);return}d.time.some(f=>{const h=!this.isTimeBuffered(f.startPTS,f.endPTS,t);return h&&this.removeFragment(c.body),h})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const r=e.frag,s=Ni(r),i=this.fragments[s];if(!i||i.buffered&&r.gap)return;const o=!r.relurl;Object.keys(t).forEach(l=>{const c=r.elementaryStreams[l];if(!c)return;const d=t[l],f=o||c.partial===!0;i.range[l]=this.getBufferedTimes(r,e.part,f,d)}),i.loaded=null,Object.keys(i.range).length?(this.bufferedEnd(i,r),vu(i)||this.removeParts(r.sn-1,r.type)):this.removeFragment(i.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const r=this.activePartLists[t];r&&(this.activePartLists[t]=Qx(r,s=>s.fragment.sn>=e))}fragBuffered(e,t){const r=Ni(e);let s=this.fragments[r];!s&&t&&(s=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,this.bufferedEnd(s,e))}getBufferedTimes(e,t,r,s){const i={time:[],partial:r},o=e.start,l=e.end,c=e.minEndPTS||l,d=e.maxStartPTS||o;for(let f=0;f<s.length;f++){const h=s.start(f)-this.bufferPadding,p=s.end(f)+this.bufferPadding;if(d>=h&&c<=p){i.time.push({startPTS:Math.max(o,s.start(f)),endPTS:Math.min(l,s.end(f))});break}else if(o<p&&l>h){const v=Math.max(o,s.start(f)),g=Math.min(l,s.end(f));g>v&&(i.partial=!0,i.time.push({startPTS:v,endPTS:g}))}else if(l<=h)break}return i}getPartialFragment(e){let t=null,r,s,i,o=0;const{bufferPadding:l,fragments:c}=this;return Object.keys(c).forEach(d=>{const f=c[d];f&&vu(f)&&(s=f.body.start-l,i=f.body.end+l,e>=s&&e<=i&&(r=Math.min(e-s,i-e),o<=r&&(t=f.body,o=r)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||vu(t))}getState(e){const t=Ni(e),r=this.fragments[t];return r?r.buffered?vu(r)?_t.PARTIAL:_t.OK:_t.APPENDING:_t.NOT_LOADED}isTimeBuffered(e,t,r){let s,i;for(let o=0;o<r.length;o++){if(s=r.start(o)-this.bufferPadding,i=r.end(o)+this.bufferPadding,e>=s&&t<=i)return!0;if(t<=s)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const r=t.frag,s=t.part?null:t,i=Ni(r);this.fragments[i]={body:r,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:r,part:s,timeRanges:i,type:o}=t;if(r.sn==="initSegment")return;const l=r.type;if(s){let d=this.activePartLists[l];d||(this.activePartLists[l]=d=[]),d.push(s)}this.timeRanges=i;const c=i[o];this.detectEvictedFragments(o,c,l,s)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Ni(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,r=Object.keys(t);if(!e)return r.length>0;for(let s=r.length;s--;){const i=t[r[s]];if(i?.body.type===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,r,s,i){s&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const l=this.fragments[o];if(!l)return;const c=l.body;c.type!==r||s&&!c.gap||c.start<t&&c.end>e&&(l.buffered||i)&&this.removeFragment(c)})}removeFragment(e){const t=Ni(e);e.clearElementaryStreamInfo();const r=this.activePartLists[e.type];if(r){const s=e.sn;this.activePartLists[e.type]=Qx(r,i=>i.fragment.sn!==s)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(r=>r.clearElementaryStreamInfo())}}function vu(n){var e,t,r;return n.buffered&&!!(n.body.gap||(e=n.range.video)!=null&&e.partial||(t=n.range.audio)!=null&&t.partial||(r=n.range.audiovideo)!=null&&r.partial)}function Ni(n){return`${n.type}_${n.level}_${n.sn}`}function Qx(n,e){return n.filter(t=>{const r=e(t);return r||t.clearElementaryStreamInfo(),r})}var Rs={cbc:0,ctr:1};class EM{constructor(e,t,r){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=r}decrypt(e,t){switch(this.aesMode){case Rs.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Rs.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function TM(n){const e=n.byteLength,t=e&&new DataView(n.buffer).getUint8(e-1);return t?n.slice(0,e-t):n}class bM{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),r=new Uint32Array(4);for(let s=0;s<4;s++)r[s]=t.getUint32(s*4);return r}initTable(){const e=this.sBox,t=this.invSBox,r=this.subMix,s=r[0],i=r[1],o=r[2],l=r[3],c=this.invSubMix,d=c[0],f=c[1],h=c[2],p=c[3],v=new Uint32Array(256);let g=0,S=0,x=0;for(x=0;x<256;x++)x<128?v[x]=x<<1:v[x]=x<<1^283;for(x=0;x<256;x++){let b=S^S<<1^S<<2^S<<3^S<<4;b=b>>>8^b&255^99,e[g]=b,t[b]=g;const A=v[g],L=v[A],I=v[L];let k=v[b]*257^b*16843008;s[g]=k<<24|k>>>8,i[g]=k<<16|k>>>16,o[g]=k<<8|k>>>24,l[g]=k,k=I*16843009^L*65537^A*257^g*16843008,d[b]=k<<24|k>>>8,f[b]=k<<16|k>>>16,h[b]=k<<8|k>>>24,p[b]=k,g?(g=A^v[v[v[I^A]]],S^=v[v[S]]):g=S=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let r=!0,s=0;for(;s<t.length&&r;)r=t[s]===this.key[s],s++;if(r)return;this.key=t;const i=this.keySize=t.length;if(i!==4&&i!==6&&i!==8)throw new Error("Invalid aes key size="+i);const o=this.ksRows=(i+6+1)*4;let l,c;const d=this.keySchedule=new Uint32Array(o),f=this.invKeySchedule=new Uint32Array(o),h=this.sBox,p=this.rcon,v=this.invSubMix,g=v[0],S=v[1],x=v[2],b=v[3];let A,L;for(l=0;l<o;l++){if(l<i){A=d[l]=t[l];continue}L=A,l%i===0?(L=L<<8|L>>>24,L=h[L>>>24]<<24|h[L>>>16&255]<<16|h[L>>>8&255]<<8|h[L&255],L^=p[l/i|0]<<24):i>6&&l%i===4&&(L=h[L>>>24]<<24|h[L>>>16&255]<<16|h[L>>>8&255]<<8|h[L&255]),d[l]=A=(d[l-i]^L)>>>0}for(c=0;c<o;c++)l=o-c,c&3?L=d[l]:L=d[l-4],c<4||l<=4?f[c]=L:f[c]=g[h[L>>>24]]^S[h[L>>>16&255]]^x[h[L>>>8&255]]^b[h[L&255]],f[c]=f[c]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,r){const s=this.keySize+6,i=this.invKeySchedule,o=this.invSBox,l=this.invSubMix,c=l[0],d=l[1],f=l[2],h=l[3],p=this.uint8ArrayToUint32Array_(r);let v=p[0],g=p[1],S=p[2],x=p[3];const b=new Int32Array(e),A=new Int32Array(b.length);let L,I,k,F,C,P,O,M,H,Z,se,U,ne,q;const te=this.networkToHostOrderSwap;for(;t<b.length;){for(H=te(b[t]),Z=te(b[t+1]),se=te(b[t+2]),U=te(b[t+3]),C=H^i[0],P=U^i[1],O=se^i[2],M=Z^i[3],ne=4,q=1;q<s;q++)L=c[C>>>24]^d[P>>16&255]^f[O>>8&255]^h[M&255]^i[ne],I=c[P>>>24]^d[O>>16&255]^f[M>>8&255]^h[C&255]^i[ne+1],k=c[O>>>24]^d[M>>16&255]^f[C>>8&255]^h[P&255]^i[ne+2],F=c[M>>>24]^d[C>>16&255]^f[P>>8&255]^h[O&255]^i[ne+3],C=L,P=I,O=k,M=F,ne=ne+4;L=o[C>>>24]<<24^o[P>>16&255]<<16^o[O>>8&255]<<8^o[M&255]^i[ne],I=o[P>>>24]<<24^o[O>>16&255]<<16^o[M>>8&255]<<8^o[C&255]^i[ne+1],k=o[O>>>24]<<24^o[M>>16&255]<<16^o[C>>8&255]<<8^o[P&255]^i[ne+2],F=o[M>>>24]<<24^o[C>>16&255]<<16^o[P>>8&255]<<8^o[O&255]^i[ne+3],A[t]=te(L^v),A[t+1]=te(F^g),A[t+2]=te(k^S),A[t+3]=te(I^x),v=H,g=Z,S=se,x=U,t=t+4}return A.buffer}}class wM{constructor(e,t,r){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=r}expandKey(){const e=AM(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function AM(n){switch(n){case Rs.cbc:return"AES-CBC";case Rs.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${n}`)}}const LM=16;class Fp{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?TM(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,r,s){return this.useSoftware?new Promise((i,o)=>{const l=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(l,t,r,s);const c=this.flush();c?i(c.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r,s)}softwareDecrypt(e,t,r,s){const{currentIV:i,currentResult:o,remainderData:l}=this;if(s!==Rs.cbc||t.byteLength!==16)return Ze.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),l&&(e=Un(l,e),this.remainderData=null);const c=this.getValidChunk(e);if(!c.length)return null;i&&(r=i);let d=this.softwareDecrypter;d||(d=this.softwareDecrypter=new bM),d.expandKey(t);const f=o;return this.currentResult=d.decrypt(c.buffer,0,r),this.currentIV=c.slice(-16).buffer,f||null}webCryptoDecrypt(e,t,r,s){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,r,s));this.key=t,this.fastAesKey=new wM(this.subtle,t,s)}return this.fastAesKey.expandKey().then(i=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new EM(this.subtle,new Uint8Array(r),s).decrypt(e.buffer,i)):Promise.reject(new Error("web crypto not initialized"))).catch(i=>(Ze.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${i.name}: ${i.message}`),this.onWebCryptoError(e,t,r,s)))}onWebCryptoError(e,t,r,s){const i=this.enableSoftwareAES;if(i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r,s);const o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(i?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const r=e.length-e.length%LM;return r!==e.length&&(t=e.slice(0,r),this.remainderData=e.slice(r)),t}logOnce(e){this.logEnabled&&(Ze.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Jx=Math.pow(2,17);class RM{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const r=e.url;if(!r)return Promise.reject(new Or({type:we.NETWORK_ERROR,details:z.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${r?"part list":"url"}`),networkDetails:null}));this.abort();const s=this.config,i=s.fLoader,o=s.loader;return new Promise((l,c)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(g=>g[0]==="GAP")){c(eS(e));return}else e.gap=!1;const d=this.loader=i?new i(s):new o(s),f=Zx(e);e.loader=d;const h=Xx(s.fragLoadPolicy.default),p={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:Jx};e.stats=d.stats;const v={onSuccess:(g,S,x,b)=>{this.resetLoader(e,d);let A=g.data;x.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(A.slice(0,16)),A=A.slice(16)),l({frag:e,part:null,payload:A,networkDetails:b})},onError:(g,S,x,b)=>{this.resetLoader(e,d),c(new Or({type:we.NETWORK_ERROR,details:z.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Je({url:r,data:void 0},g),error:new Error(`HTTP Error ${g.code} ${g.text}`),networkDetails:x,stats:b}))},onAbort:(g,S,x)=>{this.resetLoader(e,d),c(new Or({type:we.NETWORK_ERROR,details:z.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:x,stats:g}))},onTimeout:(g,S,x)=>{this.resetLoader(e,d),c(new Or({type:we.NETWORK_ERROR,details:z.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${p.timeout}ms`),networkDetails:x,stats:g}))}};t&&(v.onProgress=(g,S,x,b)=>t({frag:e,part:null,payload:x,networkDetails:b})),d.load(f,p,v)})}loadPart(e,t,r){this.abort();const s=this.config,i=s.fLoader,o=s.loader;return new Promise((l,c)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){c(eS(e,t));return}const d=this.loader=i?new i(s):new o(s),f=Zx(e,t);e.loader=d;const h=Xx(s.fragLoadPolicy.default),p={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Jx};t.stats=d.stats,d.load(f,p,{onSuccess:(v,g,S,x)=>{this.resetLoader(e,d),this.updateStatsFromPart(e,t);const b={frag:e,part:t,payload:v.data,networkDetails:x};r(b),l(b)},onError:(v,g,S,x)=>{this.resetLoader(e,d),c(new Or({type:we.NETWORK_ERROR,details:z.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Je({url:f.url,data:void 0},v),error:new Error(`HTTP Error ${v.code} ${v.text}`),networkDetails:S,stats:x}))},onAbort:(v,g,S)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,d),c(new Or({type:we.NETWORK_ERROR,details:z.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:S,stats:v}))},onTimeout:(v,g,S)=>{this.resetLoader(e,d),c(new Or({type:we.NETWORK_ERROR,details:z.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${p.timeout}ms`),networkDetails:S,stats:v}))}})})}updateStatsFromPart(e,t){const r=e.stats,s=t.stats,i=s.total;if(r.loaded+=s.loaded,i){const c=Math.round(e.duration/t.duration),d=Math.min(Math.round(r.loaded/i),c),h=(c-d)*Math.round(r.loaded/d);r.total=r.loaded+h}else r.total=Math.max(r.loaded,r.total);const o=r.loading,l=s.loading;o.start?o.first+=l.first-l.start:(o.start=l.start,o.first=l.first),o.end=l.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Zx(n,e=null){const t=e||n,r={frag:n,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},s=t.byteRangeStartOffset,i=t.byteRangeEndOffset;if(he(s)&&he(i)){var o;let l=s,c=i;if(n.sn==="initSegment"&&IM((o=n.decryptdata)==null?void 0:o.method)){const d=i-s;d%16&&(c=i+(16-d%16)),s!==0&&(r.resetIV=!0,l=s-16)}r.rangeStart=l,r.rangeEnd=c}return r}function eS(n,e){const t=new Error(`GAP ${n.gap?"tag":"attribute"} found`),r={type:we.MEDIA_ERROR,details:z.FRAG_GAP,fatal:!1,frag:n,error:t,networkDetails:null};return e&&(r.part=e),(e||n).stats.aborted=!0,new Or(r)}function IM(n){return n==="AES-128"||n==="AES-256"}class Or extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class cw extends $n{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Bp{constructor(e,t,r,s=0,i=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=xu(),this.buffering={audio:xu(),video:xu(),audiovideo:xu()},this.level=e,this.sn=t,this.id=r,this.size=s,this.part=i,this.partial=o}}function xu(){return{start:0,executeStart:0,executeEnd:0,end:0}}const tS={length:0,start:()=>0,end:()=>0};class Oe{static isBuffered(e,t){if(e){const r=Oe.getBuffered(e);for(let s=r.length;s--;)if(t>=r.start(s)&&t<=r.end(s))return!0}return!1}static bufferedRanges(e){if(e){const t=Oe.getBuffered(e);return Oe.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});return t}static bufferInfo(e,t,r){if(e){const s=Oe.bufferedRanges(e);if(s.length)return Oe.bufferedInfo(s,t,r)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,r){t=Math.max(0,t),e.length>1&&e.sort((f,h)=>f.start-h.start||h.end-f.end);let s=-1,i=[];if(r)for(let f=0;f<e.length;f++){t>=e[f].start&&t<=e[f].end&&(s=f);const h=i.length;if(h){const p=i[h-1].end;e[f].start-p<r?e[f].end>p&&(i[h-1].end=e[f].end):i.push(e[f])}else i.push(e[f])}else i=e;let o=0,l,c=t,d=t;for(let f=0;f<i.length;f++){const h=i[f].start,p=i[f].end;if(s===-1&&t>=h&&t<=p&&(s=f),t+r>=h&&t<p)c=h,d=p,o=d-t;else if(t+r<h){l=h;break}}return{len:o,start:c||0,end:d||0,nextStart:l,buffered:e,bufferedIndex:s}}static getBuffered(e){try{return e.buffered||tS}catch(t){return Ze.log("failed to get media.buffered",t),tS}}}const dw=/\{\$([a-zA-Z0-9-_]+)\}/g;function nS(n){return dw.test(n)}function Rm(n,e){if(n.variableList!==null||n.hasVariableRefs){const t=n.variableList;return e.replace(dw,r=>{const s=r.substring(2,r.length-1),i=t?.[s];return i===void 0?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),r):i})}return e}function rS(n,e,t){let r=n.variableList;r||(n.variableList=r={});let s,i;if("QUERYPARAM"in e){s=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(o.has(s))i=o.get(s);else throw new Error(`"${s}" does not match any query parameter in URI: "${t}"`)}catch(o){n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else s=e.NAME,i=e.VALUE;s in r?n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):r[s]=i||""}function _M(n,e,t){const r=e.IMPORT;if(t&&r in t){let s=n.variableList;s||(n.variableList=s={}),s[r]=t[r]}else n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}const CM=/^(\d+)x(\d+)$/,sS=/(.+?)=(".*?"|.*?)(?:,|$)/g;class dt{constructor(e,t){typeof e=="string"&&(e=dt.parseAttrList(e,t)),et(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const r=new Uint8Array(t.length/2);for(let s=0;s<t.length/2;s++)r[s]=parseInt(t.slice(s*2,s*2+2),16);return r}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const r=this[e];return r?parseFloat(r):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const r=this[e];return(r?r.split(/[ ,]+/):[]).reduce((s,i)=>(s[i.toLowerCase()]=!0,s),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=CM.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let r;const s={};for(sS.lastIndex=0;(r=sS.exec(e))!==null;){const o=r[1].trim();let l=r[2];const c=l.indexOf('"')===0&&l.lastIndexOf('"')===l.length-1;let d=!1;if(c)l=l.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":d=!0}if(t&&(c||d))l=Rm(t,l);else if(!d&&!c)switch(o){case"CLOSED-CAPTIONS":if(l==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Ze.warn(`${e}: attribute ${o} is missing quotes`)}s[o]=l}return s}}const kM="com.apple.hls.interstitial";function PM(n){return n!=="ID"&&n!=="CLASS"&&n!=="CUE"&&n!=="START-DATE"&&n!=="DURATION"&&n!=="END-DATE"&&n!=="END-ON-NEXT"}function DM(n){return n==="SCTE35-OUT"||n==="SCTE35-IN"||n==="SCTE35-CMD"}class fw{constructor(e,t,r=0){var s;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=t?.tagAnchor||null,this.tagOrder=(s=t?.tagOrder)!=null?s:r,t){const i=t.attr;for(const o in i)if(Object.prototype.hasOwnProperty.call(e,o)&&e[o]!==i[o]){Ze.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=o;break}e=et(new dt({}),i,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const i=t?.endDate||new Date(this.attr["END-DATE"]);he(i.getTime())&&(this._endDate=i)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Ze.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(he(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===kM}get isValid(){return!!this.id&&!this._badValueForSameId&&he(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const NM=10;class OM{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&r>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let r=t.decryptdata;return r||(t.setKeyFormat(e.keyFormat),r=t.decryptdata),!!r&&e.matches(r)})}get hasProgramDateTime(){return this.fragments.length?he(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||NM}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let r=e.length;r--;)if(e[r].index>t)return e[r].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function pc(n,e){return n.length===e.length?!n.some((t,r)=>t!==e[r]):!1}function iS(n,e){return!n&&!e?!0:!n||!e?!1:pc(n,e)}function Ki(n){return n==="AES-128"||n==="AES-256"||n==="AES-256-CTR"}function Up(n){switch(n){case"AES-128":case"AES-256":return Rs.cbc;case"AES-256-CTR":return Rs.ctr;default:throw new Error(`invalid full segment method ${n}`)}}function $p(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0))}function Im(n){return Uint8Array.from(unescape(encodeURIComponent(n)),e=>e.charCodeAt(0))}function MM(n){const e=Im(n).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function hw(n){const e=function(r,s,i){const o=r[s];r[s]=r[i],r[i]=o};e(n,0,3),e(n,1,2),e(n,4,5),e(n,6,7)}function mw(n){const e=n.split(":");let t=null;if(e[0]==="data"&&e.length===2){const r=e[1].split(";"),s=r[r.length-1].split(",");if(s.length===2){const i=s[0]==="base64",o=s[1];i?(r.splice(-1,1),t=$p(o)):t=MM(o)}}return t}const gc=typeof self<"u"?self:void 0;var ft={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},$t={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function Gu(n){switch(n){case $t.FAIRPLAY:return ft.FAIRPLAY;case $t.PLAYREADY:return ft.PLAYREADY;case $t.WIDEVINE:return ft.WIDEVINE;case $t.CLEARKEY:return ft.CLEARKEY}}function vh(n){switch(n){case ft.FAIRPLAY:return $t.FAIRPLAY;case ft.PLAYREADY:return $t.PLAYREADY;case ft.WIDEVINE:return $t.WIDEVINE;case ft.CLEARKEY:return $t.CLEARKEY}}function ia(n){const{drmSystems:e,widevineLicenseUrl:t}=n,r=e?[ft.FAIRPLAY,ft.WIDEVINE,ft.PLAYREADY,ft.CLEARKEY].filter(s=>!!e[s]):[];return!r[ft.WIDEVINE]&&t&&r.push(ft.WIDEVINE),r}const pw=(function(n){return gc!=null&&(n=gc.navigator)!=null&&n.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function FM(n,e,t,r){let s;switch(n){case ft.FAIRPLAY:s=["cenc","sinf"];break;case ft.WIDEVINE:case ft.PLAYREADY:s=["cenc"];break;case ft.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${n}`)}return BM(s,e,t,r)}function BM(n,e,t,r){return[{initDataTypes:n,persistentState:r.persistentState||"optional",distinctiveIdentifier:r.distinctiveIdentifier||"optional",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:e.map(i=>({contentType:`audio/mp4; codecs=${i}`,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null})),videoCapabilities:t.map(i=>({contentType:`video/mp4; codecs=${i}`,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}))}]}function UM(n){var e;return!!n&&(n.sessionType==="persistent-license"||!!((e=n.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function gw(n){const e=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),r=t.substring(t.indexOf("<"),t.length),o=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("KID")[0];if(o){const l=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(l){const c=$p(l).subarray(0,16);return hw(c),c}}return null}let Oi={};class Ts{static clearKeyUriToKeyIdMap(){Oi={}}static setKeyIdForUri(e,t){Oi[e]=t}static addKeyIdForUri(e){const t=Object.keys(Oi).length%Number.MAX_SAFE_INTEGER,r=new Uint8Array(16);return new DataView(r.buffer,12,4).setUint32(0,t),Oi[e]=r,r}constructor(e,t,r,s=[1],i=null,o){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=s,this.iv=i,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!Ki(e),o!=null&&o.startsWith("0x")&&(this.keyId=new Uint8Array(Hb(o)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&pc(e.keyFormatVersions,this.keyFormatVersions)&&iS(e.iv,this.iv)&&iS(e.keyId,this.keyId)}isSupported(){if(this.method){if(Ki(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case $t.FAIRPLAY:case $t.WIDEVINE:case $t.PLAYREADY:case $t.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(Ki(this.method)){let i=this.iv;return i||(typeof e!="number"&&(Ze.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),i=jM(e)),new Ts(this.method,this.uri,"identity",this.keyFormatVersions,i)}if(this.keyId){const i=Oi[this.uri];if(i&&!pc(this.keyId,i)&&Ts.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const r=mw(this.uri);if(r)switch(this.keyFormat){case $t.WIDEVINE:if(this.pssh=r,!this.keyId){const i=H2(r.buffer);if(i.length){var s;const o=i[0];this.keyId=(s=o.kids)!=null&&s.length?o.kids[0]:null}}this.keyId||(this.keyId=oS(t));break;case $t.PLAYREADY:{const i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=G2(i,null,r),this.keyId=gw(r);break}default:{let i=r.subarray(0,16);if(i.length!==16){const o=new Uint8Array(16);o.set(i,16-i.length),i=o}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i;i=$M(t),i||(i=oS(t),i||(i=Oi[this.uri])),i&&(this.keyId=i,Ts.setKeyIdForUri(this.uri,i))}return this}}function $M(n){const e=n?.[$t.WIDEVINE];return e?e.keyId:null}function oS(n){const e=n?.[$t.PLAYREADY];if(e){const t=mw(e.uri);if(t)return gw(t)}return null}function jM(n){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=n>>8*(15-t)&255;return e}const aS=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,lS=/#EXT-X-MEDIA:(.*)/g,VM=/^#EXT(?:INF|-X-TARGETDURATION):/m,xh=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),GM=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class pr{static findGroup(e,t){for(let r=0;r<e.length;r++){const s=e[r];if(s.id===t)return s}}static resolve(e,t){return kp.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return VM.test(e)}static parseMasterPlaylist(e,t){const r=nS(e),s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:r},i=[];if(aS.lastIndex=0,!e.startsWith("#EXTM3U"))return s.playlistParsingError=new Error("no EXTM3U delimiter"),s;let o;for(;(o=aS.exec(e))!=null;)if(o[1]){var l;const d=new dt(o[1],s),f=Rm(s,o[2]),h={attrs:d,bitrate:d.decimalInteger("BANDWIDTH")||d.decimalInteger("AVERAGE-BANDWIDTH"),name:d.NAME,url:pr.resolve(f,t)},p=d.decimalResolution("RESOLUTION");p&&(h.width=p.width,h.height=p.height),dS(d.CODECS,h);const v=d["SUPPLEMENTAL-CODECS"];v&&(h.supplemental={},dS(v,h.supplemental)),(l=h.unknownCodecs)!=null&&l.length||i.push(h),s.levels.push(h)}else if(o[3]){const d=o[3],f=o[4];switch(d){case"SESSION-DATA":{const h=new dt(f,s),p=h["DATA-ID"];p&&(s.sessionData===null&&(s.sessionData={}),s.sessionData[p]=h);break}case"SESSION-KEY":{const h=uS(f,t,s);h.encrypted&&h.isSupported()?(s.sessionKeys===null&&(s.sessionKeys=[]),s.sessionKeys.push(h)):Ze.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${f}"`);break}case"DEFINE":{{const h=new dt(f,s);rS(s,h,t)}break}case"CONTENT-STEERING":{const h=new dt(f,s);s.contentSteering={uri:pr.resolve(h["SERVER-URI"],t),pathwayId:h["PATHWAY-ID"]||"."};break}case"START":{s.startTimeOffset=cS(f);break}}}const c=i.length>0&&i.length<s.levels.length;return s.levels=c?i:s.levels,s.levels.length===0&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,t,r){let s;const i={},o=r.levels,l={AUDIO:o.map(d=>({id:d.attrs.AUDIO,audioCodec:d.audioCodec})),SUBTITLES:o.map(d=>({id:d.attrs.SUBTITLES,textCodec:d.textCodec})),"CLOSED-CAPTIONS":[]};let c=0;for(lS.lastIndex=0;(s=lS.exec(e))!==null;){const d=new dt(s[1],r),f=d.TYPE;if(f){const h=l[f],p=i[f]||[];i[f]=p;const v=d.LANGUAGE,g=d["ASSOC-LANGUAGE"],S=d.CHANNELS,x=d.CHARACTERISTICS,b=d["INSTREAM-ID"],A={attrs:d,bitrate:0,id:c++,groupId:d["GROUP-ID"]||"",name:d.NAME||v||"",type:f,default:d.bool("DEFAULT"),autoselect:d.bool("AUTOSELECT"),forced:d.bool("FORCED"),lang:v,url:d.URI?pr.resolve(d.URI,t):""};if(g&&(A.assocLang=g),S&&(A.channels=S),x&&(A.characteristics=x),b&&(A.instreamId=b),h!=null&&h.length){const L=pr.findGroup(h,A.groupId)||h[0];fS(A,L,"audioCodec"),fS(A,L,"textCodec")}p.push(A)}}return i}static parseLevelPlaylist(e,t,r,s,i,o){var l;const c={url:t},d=new OM(t),f=d.fragments,h=[];let p=null,v=0,g=0,S=0,x=0,b=0,A=null,L=new ph(s,c),I,k,F,C=-1,P=!1,O=null,M;if(xh.lastIndex=0,d.m3u8=e,d.hasVariableRefs=nS(e),((l=xh.exec(e))==null?void 0:l[0])!=="#EXTM3U")return d.playlistParsingError=new Error("Missing format identifier #EXTM3U"),d;for(;(I=xh.exec(e))!==null;){P&&(P=!1,L=new ph(s,c),L.playlistOffset=S,L.setStart(S),L.sn=v,L.cc=x,b&&(L.bitrate=b),L.level=r,p&&(L.initSegment=p,p.rawProgramDateTime&&(L.rawProgramDateTime=p.rawProgramDateTime,p.rawProgramDateTime=null),O&&(L.setByteRange(O),O=null)));const U=I[1];if(U){L.duration=parseFloat(U);const ne=(" "+I[2]).slice(1);L.title=ne||null,L.tagList.push(ne?["INF",U,ne]:["INF",U])}else if(I[3]){if(he(L.duration)){L.playlistOffset=S,L.setStart(S),F&&mS(L,F,d),L.sn=v,L.level=r,L.cc=x,f.push(L);const ne=(" "+I[3]).slice(1);L.relurl=Rm(d,ne),_m(L,A,h),A=L,S+=L.duration,v++,g=0,P=!0}}else{if(I=I[0].match(GM),!I){Ze.warn("No matches on slow regex match for level playlist!");continue}for(k=1;k<I.length&&I[k]===void 0;k++);const ne=(" "+I[k]).slice(1),q=(" "+I[k+1]).slice(1),te=I[k+2]?(" "+I[k+2]).slice(1):null;switch(ne){case"BYTERANGE":A?L.setByteRange(q,A):L.setByteRange(q);break;case"PROGRAM-DATE-TIME":L.rawProgramDateTime=q,L.tagList.push(["PROGRAM-DATE-TIME",q]),C===-1&&(C=f.length);break;case"PLAYLIST-TYPE":d.type&&Dr(d,ne,I),d.type=q.toUpperCase();break;case"MEDIA-SEQUENCE":d.startSN!==0?Dr(d,ne,I):f.length>0&&pS(d,ne,I),v=d.startSN=parseInt(q);break;case"SKIP":{d.skippedSegments&&Dr(d,ne,I);const G=new dt(q,d),Q=G.decimalInteger("SKIPPED-SEGMENTS");if(he(Q)){d.skippedSegments+=Q;for(let D=Q;D--;)f.push(null);v+=Q}const ee=G.enumeratedString("RECENTLY-REMOVED-DATERANGES");ee&&(d.recentlyRemovedDateranges=(d.recentlyRemovedDateranges||[]).concat(ee.split("	")));break}case"TARGETDURATION":d.targetduration!==0&&Dr(d,ne,I),d.targetduration=Math.max(parseInt(q),1);break;case"VERSION":d.version!==null&&Dr(d,ne,I),d.version=parseInt(q);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":d.live||Dr(d,ne,I),d.live=!1;break;case"#":(q||te)&&L.tagList.push(te?[q,te]:[q]);break;case"DISCONTINUITY":x++,L.tagList.push(["DIS"]);break;case"GAP":L.gap=!0,L.tagList.push([ne]);break;case"BITRATE":L.tagList.push([ne,q]),b=parseInt(q)*1e3,he(b)?L.bitrate=b:b=0;break;case"DATERANGE":{const G=new dt(q,d),Q=new fw(G,d.dateRanges[G.ID],d.dateRangeTagCount);d.dateRangeTagCount++,Q.isValid||d.skippedSegments?d.dateRanges[Q.id]=Q:Ze.warn(`Ignoring invalid DATERANGE tag: "${q}"`),L.tagList.push(["EXT-X-DATERANGE",q]);break}case"DEFINE":{{const G=new dt(q,d);"IMPORT"in G?_M(d,G,o):rS(d,G,t)}break}case"DISCONTINUITY-SEQUENCE":d.startCC!==0?Dr(d,ne,I):f.length>0&&pS(d,ne,I),d.startCC=x=parseInt(q);break;case"KEY":{const G=uS(q,t,d);if(G.isSupported()){if(G.method==="NONE"){F=void 0;break}F||(F={});const Q=F[G.keyFormat];Q!=null&&Q.matches(G)||(Q&&(F=et({},F)),F[G.keyFormat]=G)}else Ze.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${q}"`);break}case"START":d.startTimeOffset=cS(q);break;case"MAP":{const G=new dt(q,d);if(L.duration){const Q=new ph(s,c);hS(Q,G,r,F),p=Q,L.initSegment=p,p.rawProgramDateTime&&!L.rawProgramDateTime&&(L.rawProgramDateTime=p.rawProgramDateTime)}else{const Q=L.byteRangeEndOffset;if(Q){const ee=L.byteRangeStartOffset;O=`${Q-ee}@${ee}`}else O=null;hS(L,G,r,F),p=L,P=!0}p.cc=x;break}case"SERVER-CONTROL":{M&&Dr(d,ne,I),M=new dt(q),d.canBlockReload=M.bool("CAN-BLOCK-RELOAD"),d.canSkipUntil=M.optionalFloat("CAN-SKIP-UNTIL",0),d.canSkipDateRanges=d.canSkipUntil>0&&M.bool("CAN-SKIP-DATERANGES"),d.partHoldBack=M.optionalFloat("PART-HOLD-BACK",0),d.holdBack=M.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{d.partTarget&&Dr(d,ne,I);const G=new dt(q);d.partTarget=G.decimalFloatingPoint("PART-TARGET");break}case"PART":{let G=d.partList;G||(G=d.partList=[]);const Q=g>0?G[G.length-1]:void 0,ee=g++,D=new dt(q,d),$=new _2(D,L,c,ee,Q);G.push($),L.duration+=$.duration;break}case"PRELOAD-HINT":{const G=new dt(q,d);d.preloadHint=G;break}case"RENDITION-REPORT":{const G=new dt(q,d);d.renditionReports=d.renditionReports||[],d.renditionReports.push(G);break}default:Ze.warn(`line parsed but not handled: ${I}`);break}}}A&&!A.relurl?(f.pop(),S-=A.duration,d.partList&&(d.fragmentHint=A)):d.partList&&(_m(L,A,h),L.cc=x,d.fragmentHint=L,F&&mS(L,F,d)),d.targetduration||(d.playlistParsingError=new Error("Missing Target Duration"));const H=f.length,Z=f[0],se=f[H-1];if(S+=d.skippedSegments*d.targetduration,S>0&&H&&se){d.averagetargetduration=S/H;const U=se.sn;d.endSN=U!=="initSegment"?U:0,d.live||(se.endList=!0),C>0&&(KM(f,C),Z&&h.unshift(Z))}return d.fragmentHint&&(S+=d.fragmentHint.duration),d.totalduration=S,h.length&&d.dateRangeTagCount&&Z&&yw(h,d),d.endCC=x,d}}function yw(n,e){let t=n.length;if(!t)if(e.hasProgramDateTime){const l=e.fragments[e.fragments.length-1];n.push(l),t++}else return;const r=n[t-1],s=e.live?1/0:e.totalduration,i=Object.keys(e.dateRanges);for(let l=i.length;l--;){const c=e.dateRanges[i[l]],d=c.startDate.getTime();c.tagAnchor=r.ref;for(let f=t;f--;){var o;if(((o=n[f])==null?void 0:o.sn)<e.startSN)break;const h=HM(e,d,n,f,s);if(h!==-1){c.tagAnchor=e.fragments[h].ref;break}}}}function HM(n,e,t,r,s){const i=t[r];if(i){const l=i.programDateTime;if(e>=l||r===0){var o;const c=(((o=t[r+1])==null?void 0:o.start)||s)-i.start;if(e<=l+c*1e3){const d=t[r].sn-n.startSN;if(d<0)return-1;const f=n.fragments;if(f.length>t.length){const p=(t[r+1]||f[f.length-1]).sn-n.startSN;for(let v=p;v>d;v--){const g=f[v].programDateTime;if(e>=g&&e<g+f[v].duration*1e3)return v}}return d}}}return-1}function uS(n,e,t){var r,s;const i=new dt(n,t),o=(r=i.METHOD)!=null?r:"",l=i.URI,c=i.hexadecimalInteger("IV"),d=i.KEYFORMATVERSIONS,f=(s=i.KEYFORMAT)!=null?s:"identity";l&&i.IV&&!c&&Ze.error(`Invalid IV: ${i.IV}`);const h=l?pr.resolve(l,e):"",p=(d||"1").split("/").map(Number).filter(Number.isFinite);return new Ts(o,h,f,p,c,i.KEYID)}function cS(n){const t=new dt(n).decimalFloatingPoint("TIME-OFFSET");return he(t)?t:null}function dS(n,e){let t=(n||"").split(/[ ,]+/).filter(r=>r);["video","audio","text"].forEach(r=>{const s=t.filter(i=>Np(i,r));s.length&&(e[`${r}Codec`]=s.map(i=>i.split("/")[0]).join(","),t=t.filter(i=>s.indexOf(i)===-1))}),e.unknownCodecs=t}function fS(n,e,t){const r=e[t];r&&(n[t]=r)}function KM(n,e){let t=n[e];for(let r=e;r--;){const s=n[r];if(!s)return;s.programDateTime=t.programDateTime-s.duration*1e3,t=s}}function _m(n,e,t){n.rawProgramDateTime?t.push(n):e!=null&&e.programDateTime&&(n.programDateTime=e.endProgramDateTime)}function hS(n,e,t,r){n.relurl=e.URI,e.BYTERANGE&&n.setByteRange(e.BYTERANGE),n.level=t,n.sn="initSegment",r&&(n.levelkeys=r),n.initSegment=null}function mS(n,e,t){n.levelkeys=e;const{encryptedFragments:r}=t;(!r.length||r[r.length-1].levelkeys!==e)&&Object.keys(e).some(s=>e[s].isCommonEncryption)&&r.push(n)}function Dr(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function pS(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function Sh(n,e){const t=e.startPTS;if(he(t)){let r=0,s;e.sn>n.sn?(r=t-n.start,s=n):(r=n.start-t,s=e),s.duration!==r&&s.setDuration(r)}else e.sn>n.sn?n.cc===e.cc&&n.minEndPTS?e.setStart(n.start+(n.minEndPTS-n.start)):e.setStart(n.start+n.duration):e.setStart(Math.max(n.start-e.duration,0))}function vw(n,e,t,r,s,i,o){r-t<=0&&(o.warn("Fragment should have a positive duration",e),r=t+e.duration,i=s+e.duration);let c=t,d=r;const f=e.startPTS,h=e.endPTS;if(he(f)){const b=Math.abs(f-t);n&&b>n.totalduration?o.warn(`media timestamps and playlist times differ by ${b}s for level ${e.level} ${n.url}`):he(e.deltaPTS)?e.deltaPTS=Math.max(b,e.deltaPTS):e.deltaPTS=b,c=Math.max(t,f),t=Math.min(t,f),s=e.startDTS!==void 0?Math.min(s,e.startDTS):s,d=Math.min(r,h),r=Math.max(r,h),i=e.endDTS!==void 0?Math.max(i,e.endDTS):i}const p=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(r-e.start),e.startPTS=t,e.maxStartPTS=c,e.startDTS=s,e.endPTS=r,e.minEndPTS=d,e.endDTS=i;const v=e.sn;if(!n||v<n.startSN||v>n.endSN)return 0;let g;const S=v-n.startSN,x=n.fragments;for(x[S]=e,g=S;g>0;g--)Sh(x[g],x[g-1]);for(g=S;g<x.length-1;g++)Sh(x[g],x[g+1]);return n.fragmentHint&&Sh(x[x.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,p}function zM(n,e,t){if(n===e)return;let r=null;const s=n.fragments;for(let f=s.length-1;f>=0;f--){const h=s[f].initSegment;if(h){r=h;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;let i;qM(n,e,(f,h,p,v)=>{if((!e.startCC||e.skippedSegments)&&h.cc!==f.cc){const g=f.cc-h.cc;for(let S=p;S<v.length;S++)v[S].cc+=g;e.endCC=v[v.length-1].cc}he(f.startPTS)&&he(f.endPTS)&&(h.setStart(h.startPTS=f.startPTS),h.startDTS=f.startDTS,h.maxStartPTS=f.maxStartPTS,h.endPTS=f.endPTS,h.endDTS=f.endDTS,h.minEndPTS=f.minEndPTS,h.setDuration(f.endPTS-f.startPTS),h.duration&&(i=h),e.PTSKnown=e.alignedSliding=!0),f.hasStreams&&(h.elementaryStreams=f.elementaryStreams),h.loader=f.loader,f.hasStats&&(h.stats=f.stats),f.initSegment&&(h.initSegment=f.initSegment,r=f.initSegment)});const o=e.fragments,l=e.fragmentHint?o.concat(e.fragmentHint):o;if(r&&l.forEach(f=>{var h;f&&(!f.initSegment||f.initSegment.relurl===((h=r)==null?void 0:h.relurl))&&(f.initSegment=r)}),e.skippedSegments){if(e.deltaUpdateFailed=o.some(f=>!f),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let f=e.skippedSegments;f--;)o.shift();e.startSN=o[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=WM(n.dateRanges,e,t));const f=n.fragments.filter(h=>h.rawProgramDateTime);if(n.hasProgramDateTime&&!e.hasProgramDateTime)for(let h=1;h<l.length;h++)l[h].programDateTime===null&&_m(l[h],l[h-1],f);yw(f,e)}e.endCC=o[o.length-1].cc}if(!e.startCC){var c;const f=Ew(n,e.startSN-1);e.startCC=(c=f?.cc)!=null?c:o[0].cc}YM(n.partList,e.partList,(f,h)=>{h.elementaryStreams=f.elementaryStreams,h.stats=f.stats}),i?vw(e,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS,t):xw(n,e),o.length&&(e.totalduration=e.edge-o[0].start),e.driftStartTime=n.driftStartTime,e.driftStart=n.driftStart;const d=e.advancedDateTime;if(e.advanced&&d){const f=e.edge;e.driftStart||(e.driftStartTime=d,e.driftStart=f),e.driftEndTime=d,e.driftEnd=f}else e.driftEndTime=n.driftEndTime,e.driftEnd=n.driftEnd,e.advancedDateTime=n.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=n.requestScheduled)}function WM(n,e,t){const{dateRanges:r,recentlyRemovedDateranges:s}=e,i=et({},n);s&&s.forEach(c=>{delete i[c]});const l=Object.keys(i).length;return l?(Object.keys(r).forEach(c=>{const d=i[c],f=new fw(r[c].attr,d);f.isValid?(i[c]=f,d||(f.tagOrder+=l)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${nt(r[c].attr)}"`)}),i):r}function YM(n,e,t){if(n&&e){let r=0;for(let s=0,i=n.length;s<=i;s++){const o=n[s],l=e[s+r];o&&l&&o.index===l.index&&o.fragment.sn===l.fragment.sn?t(o,l):r--}}}function qM(n,e,t){const r=e.skippedSegments,s=Math.max(n.startSN,e.startSN)-e.startSN,i=(n.fragmentHint?1:0)+(r?e.endSN:Math.min(n.endSN,e.endSN))-e.startSN,o=e.startSN-n.startSN,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,c=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;for(let d=s;d<=i;d++){const f=c[o+d];let h=l[d];if(r&&!h&&f&&(h=e.fragments[d]=f),f&&h){t(f,h,d,l);const p=f.relurl,v=h.relurl;if(p&&XM(p,v)){e.playlistParsingError=gS(`media sequence mismatch ${h.sn}:`,n,e,f,h);return}else if(f.cc!==h.cc){e.playlistParsingError=gS(`discontinuity sequence mismatch (${f.cc}!=${h.cc})`,n,e,f,h);return}}}}function gS(n,e,t,r,s){return new Error(`${n} ${s.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function xw(n,e,t=!0){const r=e.startSN+e.skippedSegments-n.startSN,s=n.fragments,i=r>=0;let o=0;if(i&&r<s.length)o=s[r].start;else if(i&&e.startSN===n.endSN+1)o=n.fragmentEnd;else if(i&&t)o=n.fragmentStart+r*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)o=n.fragmentStart;else return;Cm(e,o)}function Cm(n,e){if(e){const t=n.fragments;for(let r=n.skippedSegments;r<t.length;r++)t[r].addStart(e);n.fragmentHint&&n.fragmentHint.addStart(e)}}function Sw(n,e=1/0){let t=1e3*n.targetduration;if(n.updated){const r=n.fragments;if(r.length&&t*4>e){const i=r[r.length-1].duration*1e3;i<t&&(t=i)}}else t/=2;return Math.round(t)}function Ew(n,e,t){if(!n)return null;let r=n.fragments[e-n.startSN];return r||(r=n.fragmentHint,r&&r.sn===e)?r:e<n.startSN&&t&&t.sn===e?t:null}function yS(n,e,t){return n?Tw(n.partList,e,t):null}function Tw(n,e,t){if(n)for(let r=n.length;r--;){const s=n[r];if(s.index===t&&s.fragment.sn===e)return s}return null}function bw(n){n.forEach((e,t)=>{var r;(r=e.details)==null||r.fragments.forEach(s=>{s.level=t,s.initSegment&&(s.initSegment.level=t)})})}function XM(n,e){return n!==e&&e?vS(n)!==vS(e):!1}function vS(n){return n.replace(/\?[^?]*$/,"")}function ha(n,e){for(let r=0,s=n.length;r<s;r++){var t;if(((t=n[r])==null?void 0:t.cc)===e)return n[r]}return null}function QM(n,e){return!!(n&&e.startCC<n.endCC&&e.endCC>n.startCC)}function xS(n,e){const t=n.start+e;n.startPTS=t,n.setStart(t),n.endPTS=t+n.duration}function ww(n,e){const t=e.fragments;for(let r=0,s=t.length;r<s;r++)xS(t[r],n);e.fragmentHint&&xS(e.fragmentHint,n),e.alignedSliding=!0}function JM(n,e){n&&(Aw(e,n),e.alignedSliding||yc(e,n),!e.alignedSliding&&!e.skippedSegments&&xw(n,e,!1))}function Aw(n,e){if(!QM(e,n))return;const t=Math.min(e.endCC,n.endCC),r=ha(e.fragments,t),s=ha(n.fragments,t);if(!r||!s)return;Ze.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const i=r.start-s.start;ww(i,n)}function yc(n,e){if(!n.hasProgramDateTime||!e.hasProgramDateTime)return;const t=n.fragments,r=e.fragments;if(!t.length||!r.length)return;let s,i;const o=Math.min(e.endCC,n.endCC);e.startCC<o&&n.startCC<o&&(s=ha(r,o),i=ha(t,o)),(!s||!i)&&(s=r[Math.floor(r.length/2)],i=ha(t,s.cc)||t[Math.floor(t.length/2)]);const l=s.programDateTime,c=i.programDateTime;if(!l||!c)return;const d=(c-l)/1e3-(i.start-s.start);ww(d,n)}function Zt(n,e,t){un(n,e,t),n.addEventListener(e,t)}function un(n,e,t){n.removeEventListener(e,t)}const ZM={toString:function(n){let e="";const t=n.length;for(let r=0;r<t;r++)e+=`[${n.start(r).toFixed(3)}-${n.end(r).toFixed(3)}]`;return e}},re={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class jp extends cw{constructor(e,t,r,s,i){super(s,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=re.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:o,fragCurrent:l,media:c,mediaBuffer:d,state:f}=this,h=c?c.currentTime:0,p=Oe.bufferInfo(d||c,h,o.maxBufferHole),v=!p.len;if(this.log(`Media seeking to ${he(h)?h.toFixed(3):h}, state: ${f}, ${v?"out of":"in"} buffer`),this.state===re.ENDED)this.resetLoadingState();else if(l){const g=o.maxFragLookUpTolerance,S=l.start-g,x=l.start+l.duration+g;if(v||x<p.start||S>p.end){const b=h>x;(h<S||b)&&(b&&l.loader&&(this.log(`Cancelling fragment load for seek (sn: ${l.sn})`),l.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(c){this.fragmentTracker.removeFragmentsInRange(h,1/0,this.playlistType,!0);const g=this.lastCurrentTime;if(h>g&&(this.lastCurrentTime=h),!this.loadingParts){const S=Math.max(p.end,h),x=this.shouldLoadParts(this.getLevelDetails(),S);x&&(this.log(`LL-Part loading ON after seeking to ${h.toFixed(2)} with buffer @${S.toFixed(2)}`),this.loadingParts=x)}}this.hls.hasEnoughToStart||(this.log(`Setting ${v?"startPosition":"nextLoadPosition"} to ${h} for seek without enough to start`),this.nextLoadPosition=h,v&&(this.startPosition=h)),v&&this.state===re.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=i,this.hls=e,this.fragmentLoader=new RM(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Fp(e.config)}registerListeners(){const{hls:e}=this;e.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(R.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(R.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===re.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=re.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const r=e.end||0,s=this.config.timelineOffset||0;if(r<=s)return!1;const i=e.buffered;this.config.maxBufferHole&&i&&i.length>1&&(e=Oe.bufferedInfo(i,e.start,0));const o=e.nextStart;if(o&&o>s&&o<t.edge||this.media.currentTime<e.start)return!1;const c=t.partList;if(c!=null&&c.length){const f=c[c.length-1];return Oe.isBuffered(this.media,f.start+f.duration/2)}const d=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(d)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const r=this.media=this.mediaBuffer=t.media;Zt(r,"seeking",this.onMediaSeeking),Zt(r,"ended",this.onMediaEnded);const s=this.config;this.levels&&s.autoStartLoad&&this.state===re.STOPPED&&this.startLoad(s.startPosition)}onMediaDetaching(e,t){const r=!!t.transferMedia,s=this.media;if(s!==null){if(s.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),un(s,"seeking",this.onMediaSeeking),un(s,"ended",this.onMediaEnded),this.keyLoader&&!r&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,r){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=re.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this.startFragRequested=!0,this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(e,t,r){const s=i=>{const o=i.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${i.part?" part: "+i.part.index:""} of ${this.fragInfo(o,!1,i.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(i)};this._doFragLoad(e,t,r,s).then(i=>{if(!i)return;const o=this.state,l=i.frag;if(this.fragContextChanged(l)){(o===re.FRAG_LOADING||!this.fragCurrent&&o===re.PARSING)&&(this.fragmentTracker.removeFragment(l),this.state=re.IDLE);return}"payload"in i&&(this.log(`Loaded ${l.type} sn: ${l.sn} of ${this.playlistLabel()} ${l.level}`),this.hls.trigger(R.FRAG_LOADED,i)),this._handleFragmentLoadComplete(i)}).catch(i=>{this.state===re.STOPPED||this.state===re.ERROR||(this.warn(`Frag error: ${i?.message||i}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:r}=this;if(r.getState(e)===_t.APPENDING){const i=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,i),l=Math.max(e.duration,o?o.len:this.config.maxBufferLength),c=this.backtrackFragment;((c?e.sn-c.sn:0)===1||this.reduceMaxBufferLength(l,e.duration))&&r.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===_t.PARTIAL&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return t?.live&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,r=null){if(!(e-t))return;const s={startOffset:e,endOffset:t,type:r};this.hls.trigger(R.BUFFER_FLUSHING,s)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(r=>{const s=r?.frag;if(!s||this.fragContextChanged(s)||!this.levels)throw new Error("init load aborted");return r}).then(r=>{const{hls:s}=this,{frag:i,payload:o}=r,l=i.decryptdata;if(o&&o.byteLength>0&&l!=null&&l.key&&l.iv&&Ki(l.method)){const c=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),l.key.buffer,l.iv.buffer,Up(l.method)).catch(d=>{throw s.trigger(R.ERROR,{type:we.MEDIA_ERROR,details:z.FRAG_DECRYPT_ERROR,fatal:!1,error:d,reason:d.message,frag:i}),d}).then(d=>{const f=self.performance.now();return s.trigger(R.FRAG_DECRYPTED,{frag:i,payload:d,stats:{tstart:c,tdecrypt:f}}),r.payload=d,this.completeInitSegmentLoad(r)})}return this.completeInitSegmentLoad(r)}).catch(r=>{this.state===re.STOPPED||this.state===re.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const r=e.frag.stats;this.state!==re.STOPPED&&(this.state=re.IDLE),e.frag.data=new Uint8Array(e.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var r,s;const i=e.tracks;if(i&&!t.encrypted&&((r=i.audio)!=null&&r.encrypted||(s=i.video)!=null&&s.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const o=this.media,l=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${o?"attached mediaKeys: "+o.mediaKeys:"detached"})`);return this.warn(l.message),!o||o.mediaKeys?!1:(this.hls.trigger(R.ERROR,{type:we.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_KEYS,fatal:!1,error:l,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const r=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${r?ZM.toString(Oe.getBuffered(r)):"(detached)"})`),Et(e)){var s;if(e.type!==ge.SUBTITLE){const o=e.elementaryStreams;if(!Object.keys(o).some(l=>!!o[l])){this.state=re.IDLE;return}}const i=(s=this.levels)==null?void 0:s[e.level];i!=null&&i.fragmentError&&(this.log(`Resetting level fragment error count of ${i.fragmentError} on frag buffered`),i.fragmentError=0)}this.state=re.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:r,part:s,partsLoaded:i}=e,o=!i||i.length===0||i.some(c=>!c),l=new Bp(r.level,r.sn,r.stats.chunkCount+1,0,s?s.index:-1,!o);t.flush(l)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,r=null,s){var i;this.fragCurrent=e;const o=t.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let l=null;if(e.encrypted&&!((i=e.decryptdata)!=null&&i.key)){if(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=re.KEY_LOADING,this.fragCurrent=e,l=this.keyLoader.load(e).then(p=>{if(!this.fragContextChanged(p.frag))return this.hls.trigger(R.KEY_LOADED,p),this.state===re.KEY_LOADING&&(this.state=re.IDLE),p}),this.hls.trigger(R.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(l=this.keyLoader.loadClear(e,o.encryptedFragments,this.startFragRequested),l&&this.log("[eme] blocking frag load until media-keys acquired"));const c=this.fragPrevious;if(Et(e)&&(!c||e.sn!==c.sn)){const p=this.shouldLoadParts(t.details,e.end);p!==this.loadingParts&&(this.log(`LL-Part loading ${p?"ON":"OFF"} loading sn ${c?.sn}->${e.sn}`),this.loadingParts=p)}if(r=Math.max(e.start,r||0),this.loadingParts&&Et(e)){const p=o.partList;if(p&&s){r>o.fragmentEnd&&o.fragmentHint&&(e=o.fragmentHint);const v=this.getNextPart(p,e,r);if(v>-1){const g=p[v];e=this.fragCurrent=g.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${g.index} (${v}/${p.length-1}) of ${this.fragInfo(e,!1,g)}) cc: ${e.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=g.start+g.duration,this.state=re.FRAG_LOADING;let S;return l?S=l.then(x=>!x||this.fragContextChanged(x.frag)?null:this.doFragPartsLoad(e,g,t,s)).catch(x=>this.handleFragLoadError(x)):S=this.doFragPartsLoad(e,g,t,s).catch(x=>this.handleFragLoadError(x)),this.hls.trigger(R.FRAG_LOADING,{frag:e,part:g,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):S}else if(!e.url||this.loadedEndOfParts(p,r))return Promise.resolve(null)}}if(Et(e)&&this.loadingParts){var d;this.log(`LL-Part loading OFF after next part miss @${r.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(d=o.partList)==null?void 0:d.filter(p=>p.loaded).map(p=>`[${p.start}-${p.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+o.startSN+"-"+o.endSN+"]"}, target: ${parseFloat(r.toFixed(3))}`),he(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=re.FRAG_LOADING;const f=this.config.progressive&&e.type!==ge.SUBTITLE;let h;return f&&l?h=l.then(p=>!p||this.fragContextChanged(p.frag)?null:this.fragmentLoader.load(e,s)).catch(p=>this.handleFragLoadError(p)):h=Promise.all([this.fragmentLoader.load(e,f?s:void 0),l]).then(([p])=>(!f&&s&&s(p),p)).catch(p=>this.handleFragLoadError(p)),this.hls.trigger(R.FRAG_LOADING,{frag:e,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):h}doFragPartsLoad(e,t,r,s){return new Promise((i,o)=>{var l;const c=[],d=(l=r.details)==null?void 0:l.partList,f=h=>{this.fragmentLoader.loadPart(e,h,s).then(p=>{c[h.index]=p;const v=p.part;this.hls.trigger(R.FRAG_LOADED,p);const g=yS(r.details,e.sn,h.index+1)||Tw(d,e.sn,h.index+1);if(g)f(g);else return i({frag:e,part:v,partsLoaded:c})}).catch(o)};f(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===z.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===we.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(R.ERROR,t)}else this.hls.trigger(R.ERROR,{type:we.OTHER_ERROR,details:z.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==re.PARSING){!this.fragCurrent&&this.state!==re.STOPPED&&this.state!==re.ERROR&&(this.state=re.IDLE);return}const{frag:r,part:s,level:i}=t,o=self.performance.now();r.stats.parsing.end=o,s&&(s.stats.parsing.end=o);const l=this.getLevelDetails(),d=l&&r.sn>l.endSN||this.shouldLoadParts(l,r.end);d!==this.loadingParts&&(this.log(`LL-Part loading ${d?"ON":"OFF"} after parsing segment ending @${r.end.toFixed(2)}`),this.loadingParts=d),this.updateLevelTiming(r,s,i,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var r;const i=e.partList[0];if(i.fragment.type===ge.SUBTITLE)return!1;const o=i.end+(((r=e.fragmentHint)==null?void 0:r.duration)||0);if(t>=o){var s;if((this.hls.hasEnoughToStart?((s=this.media)==null?void 0:s.currentTime)||this.lastCurrentTime:this.getLoadPosition())>i.start-i.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:r}=this,{level:s,sn:i,part:o}=e;if(!(t!=null&&t[s]))return this.warn(`Levels object was unset while buffering fragment ${i} of ${this.playlistLabel()} ${s}. The current chunk will not be buffered.`),null;const l=t[s],c=l.details,d=o>-1?yS(c,i,o):null,f=d?d.fragment:Ew(c,i,r);return f?(r&&r!==f&&(f.stats=r.stats),{frag:f,part:d,level:l}):null}bufferFragmentData(e,t,r,s,i){if(this.state!==re.PARSING)return;const{data1:o,data2:l}=e;let c=o;if(l&&(c=Un(o,l)),!c.length)return;const d=this.initPTS[t.cc],f=d?-d.baseTime/d.timescale:void 0,h={type:e.type,frag:t,part:r,chunkMeta:s,offset:f,parent:t.type,data:c};if(this.hls.trigger(R.BUFFER_APPENDING,h),e.dropped&&e.independent&&!r){if(i)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Oe.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const r=t.currentTime,s=Oe.bufferInfo(t,r,0),i=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,i*.25),l=Math.max(Math.min(e.start-o,s.end-o),r+o);e.start-l>o&&this.flushMainBuffer(l,e.start)}getFwdBufferInfo(e,t){var r;const s=this.getLoadPosition();if(!he(s))return null;const o=this.lastCurrentTime>s||(r=this.media)!=null&&r.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,s,t,o)}getFwdBufferInfoAtPos(e,t,r,s){const i=Oe.bufferInfo(e,t,s);if(i.len===0&&i.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(t,r);if(o&&(i.nextStart<=o.end||o.gap)){const l=Math.max(Math.min(i.nextStart,o.end)-t,s);return Oe.bufferInfo(e,t,l)}}return i}getMaxBufferLength(e){const{config:t}=this;let r;return e?r=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):r=t.maxBufferLength,Math.min(r,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const r=this.config,s=Math.max(Math.min(e-t,r.maxBufferLength),t),i=Math.max(e-t*3,r.maxMaxBufferLength/2,s);return i>=s?(r.maxMaxBufferLength=i,this.warn(`Reduce max buffer length to ${i}s`),!0):!1}getAppendedFrag(e,t=ge.MAIN){const r=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){const r=t.fragments,s=r.length;if(!s)return null;const{config:i}=this,o=r[0].start,l=i.lowLatencyMode&&!!t.partList;let c=null;if(t.live){const h=i.initialLiveManifestSize;if(s<h)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${h})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o){var d;l&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),c=this.getInitialLiveFragment(t);const p=this.hls.startPosition,v=this.hls.liveSyncPosition,g=c?(p!==-1&&p>=o?p:v)||c.start:e;this.log(`Setting startPosition to ${g} to match start frag at live edge. mainStart: ${p} liveSyncPosition: ${v} frag.start: ${(d=c)==null?void 0:d.start}`),this.startPosition=this.nextLoadPosition=g}}else e<=o&&(c=r[0]);if(!c){const h=this.loadingParts?t.partEnd:t.fragmentEnd;c=this.getFragmentAtPosition(e,h,t)}let f=this.filterReplacedPrimary(c,t);if(!f&&c){const h=c.sn-t.startSN;f=this.filterReplacedPrimary(r[h+1]||null,t)}return this.mapToInitFragWhenRequired(f)}isLoopLoading(e,t){const r=this.fragmentTracker.getState(e);return(r===_t.OK||r===_t.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,r,s,i){let o=null;if(e.gap&&(o=this.getNextFragment(this.nextLoadPosition,t),o&&!o.gap&&r.nextStart)){const l=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,s,0);if(l!==null&&r.len+l.len>=i){const c=o.sn;return this.loopSn!==c&&(this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${c}`),this.loopSn=c),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(SS(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(SS(this.config)&&e.type!==ge.SUBTITLE){const r=this.hls.interstitialsManager,s=r?.bufferingItem;if(s){const o=s.event;if(o){if(o.appendInPlace||Math.abs(e.start-s.start)>1||s.start===0)return null}else if(e.end<=s.start&&t?.live===!1||e.start>s.end&&s.nextEvent&&(s.nextEvent.appendInPlace||e.start-s.end>1))return null}const i=r?.playerQueue;if(i)for(let o=i.length;o--;){const l=i[o].interstitial;if(l.appendInPlace&&e.start>=l.startTime&&e.end<=l.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,r){let s=-1,i=!1,o=!0;for(let l=0,c=e.length;l<c;l++){const d=e[l];if(o=o&&!d.independent,s>-1&&r<d.start)break;const f=d.loaded;f?s=-1:(i||(d.independent||o)&&d.fragment===t)&&(d.fragment!==t&&this.warn(`Need buffer at ${r} but next unloaded part starts at ${d.start}`),s=l),i=f}return s}loadedEndOfParts(e,t){let r;for(let s=e.length;s--;){if(r=e[s],!r.loaded)return!1;if(t>r.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,r=this.fragPrevious;let s=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),s=pM(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){const i=r.sn+1;if(i>=e.startSN&&i<=e.endSN){const o=t[i-e.startSN];r.cc===o.cc&&(s=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=aw(e,r.cc,r.end),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{const i=this.hls.liveSyncPosition;i!==null&&(s=this.getFragmentAtPosition(i,this.bitrateTest?e.fragmentEnd:e.edge,e))}return s}getFragmentAtPosition(e,t,r){const{config:s}=this;let{fragPrevious:i}=this,{fragments:o,endSN:l}=r;const{fragmentHint:c}=r,{maxFragLookUpTolerance:d}=s,f=r.partList,h=!!(this.loadingParts&&f!=null&&f.length&&c);h&&!this.bitrateTest&&f[f.length-1].fragment.sn===c.sn&&(o=o.concat(c),l=c.sn);let p;if(e<t){var v;const S=e<this.lastCurrentTime||e>t-d||(v=this.media)!=null&&v.paused||!this.startFragRequested?0:d;p=ii(i,o,e,S)}else p=o[o.length-1];if(p){const g=p.sn-r.startSN,S=this.fragmentTracker.getState(p);if((S===_t.OK||S===_t.PARTIAL&&p.gap)&&(i=p),i&&p.sn===i.sn&&(!h||f[0].fragment.sn>p.sn||!r.live)&&p.level===i.level){const b=o[g+1];p.sn<l&&this.fragmentTracker.getState(b)!==_t.OK?p=b:p=null}}return p}alignPlaylists(e,t,r){const s=e.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;const i=e.fragmentStart,o=!t,l=e.alignedSliding&&he(i);if(o||!l&&!i){JM(r,e);const c=e.fragmentStart;return this.log(`Live playlist sliding: ${c.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${s}`),c}return i}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let r=this.startPosition;r<t&&(r=-1);const s=this.timelineOffset;if(r===-1){const i=this.startTimeOffset!==null,o=i?this.startTimeOffset:e.startTimeOffset;o!==null&&he(o)?(r=t+o,o<0&&(r+=e.edge),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Setting startPosition to ${r} for start time offset ${o} found in ${i?"multivariant":"media"} playlist`),this.startPosition=r):e.live?(r=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${r}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=r=0),this.lastCurrentTime=r+s}this.nextLoadPosition=r+s}getLoadPosition(){var e;const{media:t}=this;let r=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?r=t.currentTime:this.nextLoadPosition>=0&&(r=this.nextLoadPosition),r}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Et(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==re.FRAG_LOADING_WAITING_RETRY)&&(this.state=re.IDLE)}onFragmentOrKeyLoadError(e,t){var r;if(t.chunkMeta&&!t.frag){const b=this.getCurrentContext(t.chunkMeta);b&&(t.frag=b.frag)}const s=t.frag;if(!s||s.type!==e||!this.levels)return;if(this.fragContextChanged(s)){var i;this.warn(`Frag load error must match current frag to retry ${s.url} > ${(i=this.fragCurrent)==null?void 0:i.url}`);return}const o=t.details===z.FRAG_GAP;o&&this.fragmentTracker.fragBuffered(s,!0);const l=t.errorAction;if(!l){this.state=re.ERROR;return}const{action:c,flags:d,retryCount:f=0,retryConfig:h}=l,p=!!h,v=p&&c===Bt.RetryRequest,g=p&&!l.resolved&&d===Tn.MoveAllAlternatesMatchingHost,S=(r=this.hls.latestLevelDetails)==null?void 0:r.live;if(!v&&g&&Et(s)&&!s.endList&&S&&!uw(t))this.resetFragmentErrors(e),this.treatAsGap(s),l.resolved=!0;else if((v||g)&&f<h.maxNumRetry){var x;const b=Lm((x=t.response)==null?void 0:x.code),A=Mp(h,f);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+A,this.state=re.FRAG_LOADING_WAITING_RETRY,l.resolved=!0,b){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${s.sn} of ${e} ${s.level} errored with ${t.details}, retrying loading ${f+1}/${h.maxNumRetry} in ${A}ms`)}else if(h)if(this.resetFragmentErrors(e),f<h.maxNumRetry)!o&&c!==Bt.RemoveAlternatePermanently&&(l.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${f})`);return}else c===Bt.SendAlternateToPenaltyBox?this.state=re.WAITING_LEVEL:this.state=re.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,r=t===1/0;(!t||e>=t||r&&!Lm(0))&&(r&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=re.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===re.PARSING||this.state===re.PARSED){const t=e.frag,r=e.parent,s=this.getFwdBufferInfo(this.mediaBuffer,r),i=s&&s.len>.5;i&&this.reduceMaxBufferLength(s.len,t?.duration||10);const o=!i;return o&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${r} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(e){e===ge.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==re.STOPPED&&(this.state=re.IDLE)}afterBufferFlushed(e,t,r){if(!e)return;const s=Oe.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,s,r),this.state===re.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==re.STOPPED&&(this.state=re.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,r,s){const i=r.details;if(!i){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((c,d)=>{const f=e.elementaryStreams[d];if(f){const h=f.endPTS-f.startPTS;if(h<=0)return this.warn(`Could not parse fragment ${e.sn} ${d} duration reliably (${h})`),c||!1;const p=s?0:vw(i,e,f.startPTS,f.endPTS,f.startDTS,f.endDTS,this);return this.hls.trigger(R.LEVEL_PTS_UPDATED,{details:i,level:r,drift:p,type:d,frag:e,start:f.startPTS,end:f.endPTS}),!0}return c},!1)){var l;const c=((l=this.transmuxer)==null?void 0:l.error)===null;if((r.fragmentError===0||c&&(r.fragmentError<2||e.endList))&&this.treatAsGap(e,r),c){const d=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(d.message),this.hls.trigger(R.ERROR,{type:we.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!1,error:d,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=re.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(R.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===ge.MAIN?"level":"track"}fragInfo(e,t=!0,r){var s,i;return`${this.playlistLabel()} ${e.level} (${r?"part":"frag"}:[${((s=t&&!r?e.startPTS:(r||e).start)!=null?s:NaN).toFixed(3)}-${((i=t&&!r?e.endPTS:(r||e).end)!=null?i:NaN).toFixed(3)}]${r&&e.type==="main"?"INDEPENDENT="+(r.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function SS(n){return!!n.interstitialsController&&n.enableInterstitialPlayback!==!1}class Lw{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let r;if(e.length)e.length===1?r=e[0]:r=eF(e,t);else return new Uint8Array(0);return this.reset(),r}reset(){this.chunks.length=0,this.dataLength=0}}function eF(n,e){const t=new Uint8Array(e);let r=0;for(let s=0;s<n.length;s++){const i=n[s];t.set(i,r),r+=i.length}return t}var Eh={exports:{}},ES;function tF(){return ES||(ES=1,(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function s(c,d,f){this.fn=c,this.context=d,this.once=f||!1}function i(c,d,f,h,p){if(typeof f!="function")throw new TypeError("The listener must be a function");var v=new s(f,h||c,p),g=t?t+d:d;return c._events[g]?c._events[g].fn?c._events[g]=[c._events[g],v]:c._events[g].push(v):(c._events[g]=v,c._eventsCount++),c}function o(c,d){--c._eventsCount===0?c._events=new r:delete c._events[d]}function l(){this._events=new r,this._eventsCount=0}l.prototype.eventNames=function(){var d=[],f,h;if(this._eventsCount===0)return d;for(h in f=this._events)e.call(f,h)&&d.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(f)):d},l.prototype.listeners=function(d){var f=t?t+d:d,h=this._events[f];if(!h)return[];if(h.fn)return[h.fn];for(var p=0,v=h.length,g=new Array(v);p<v;p++)g[p]=h[p].fn;return g},l.prototype.listenerCount=function(d){var f=t?t+d:d,h=this._events[f];return h?h.fn?1:h.length:0},l.prototype.emit=function(d,f,h,p,v,g){var S=t?t+d:d;if(!this._events[S])return!1;var x=this._events[S],b=arguments.length,A,L;if(x.fn){switch(x.once&&this.removeListener(d,x.fn,void 0,!0),b){case 1:return x.fn.call(x.context),!0;case 2:return x.fn.call(x.context,f),!0;case 3:return x.fn.call(x.context,f,h),!0;case 4:return x.fn.call(x.context,f,h,p),!0;case 5:return x.fn.call(x.context,f,h,p,v),!0;case 6:return x.fn.call(x.context,f,h,p,v,g),!0}for(L=1,A=new Array(b-1);L<b;L++)A[L-1]=arguments[L];x.fn.apply(x.context,A)}else{var I=x.length,k;for(L=0;L<I;L++)switch(x[L].once&&this.removeListener(d,x[L].fn,void 0,!0),b){case 1:x[L].fn.call(x[L].context);break;case 2:x[L].fn.call(x[L].context,f);break;case 3:x[L].fn.call(x[L].context,f,h);break;case 4:x[L].fn.call(x[L].context,f,h,p);break;default:if(!A)for(k=1,A=new Array(b-1);k<b;k++)A[k-1]=arguments[k];x[L].fn.apply(x[L].context,A)}}return!0},l.prototype.on=function(d,f,h){return i(this,d,f,h,!1)},l.prototype.once=function(d,f,h){return i(this,d,f,h,!0)},l.prototype.removeListener=function(d,f,h,p){var v=t?t+d:d;if(!this._events[v])return this;if(!f)return o(this,v),this;var g=this._events[v];if(g.fn)g.fn===f&&(!p||g.once)&&(!h||g.context===h)&&o(this,v);else{for(var S=0,x=[],b=g.length;S<b;S++)(g[S].fn!==f||p&&!g[S].once||h&&g[S].context!==h)&&x.push(g[S]);x.length?this._events[v]=x.length===1?x[0]:x:o(this,v)}return this},l.prototype.removeAllListeners=function(d){var f;return d?(f=t?t+d:d,this._events[f]&&o(this,f)):(this._events=new r,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=t,l.EventEmitter=l,n.exports=l})(Eh)),Eh.exports}var nF=tF(),Vp=R2(nF);const Ca="1.6.15",Zi={};function rF(){return typeof __HLS_WORKER_BUNDLE__=="function"}function sF(){const n=Zi[Ca];if(n)return n.clientCount++,n;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),s={worker:new self.Worker(t),objectURL:t,clientCount:1};return Zi[Ca]=s,s}function iF(n){const e=Zi[n];if(e)return e.clientCount++,e;const t=new self.URL(n,self.location.href).href,s={worker:new self.Worker(t),scriptURL:t,clientCount:1};return Zi[n]=s,s}function oF(n){const e=Zi[n||Ca];if(e&&e.clientCount--===1){const{worker:r,objectURL:s}=e;delete Zi[n||Ca],s&&self.URL.revokeObjectURL(s),r.terminate()}}function Rw(n,e){return e+10<=n.length&&n[e]===51&&n[e+1]===68&&n[e+2]===73&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function Gp(n,e){return e+10<=n.length&&n[e]===73&&n[e+1]===68&&n[e+2]===51&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function Kc(n,e){let t=0;return t=(n[e]&127)<<21,t|=(n[e+1]&127)<<14,t|=(n[e+2]&127)<<7,t|=n[e+3]&127,t}function ka(n,e){const t=e;let r=0;for(;Gp(n,e);){r+=10;const s=Kc(n,e+6);r+=s,Rw(n,e+10)&&(r+=10),e+=r}if(r>0)return n.subarray(t,t+r)}function aF(n,e,t,r){const s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],i=e[t+2],o=i>>2&15;if(o>12){const v=new Error(`invalid ADTS sampling index:${o}`);n.emit(R.ERROR,R.ERROR,{type:we.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!0,error:v,reason:v.message});return}const l=(i>>6&3)+1,c=e[t+3]>>6&3|(i&1)<<2,d="mp4a.40."+l,f=s[o];let h=o;(l===5||l===29)&&(h-=3);const p=[l<<3|(h&14)>>1,(h&1)<<7|c<<3];return Ze.log(`manifest codec:${r}, parsed codec:${d}, channels:${c}, rate:${f} (ADTS object type:${l} sampling index:${o})`),{config:p,samplerate:f,channelCount:c,codec:d,parsedCodec:d,manifestCodec:r}}function Iw(n,e){return n[e]===255&&(n[e+1]&246)===240}function _w(n,e){return n[e+1]&1?7:9}function Hp(n,e){return(n[e+3]&3)<<11|n[e+4]<<3|(n[e+5]&224)>>>5}function lF(n,e){return e+5<n.length}function vc(n,e){return e+1<n.length&&Iw(n,e)}function uF(n,e){return lF(n,e)&&Iw(n,e)&&Hp(n,e)<=n.length-e}function cF(n,e){if(vc(n,e)){const t=_w(n,e);if(e+t>=n.length)return!1;const r=Hp(n,e);if(r<=t)return!1;const s=e+r;return s===n.length||vc(n,s)}return!1}function Cw(n,e,t,r,s){if(!n.samplerate){const i=aF(e,t,r,s);if(!i)return;et(n,i)}}function kw(n){return 1024*9e4/n}function dF(n,e){const t=_w(n,e);if(e+t<=n.length){const r=Hp(n,e)-t;if(r>0)return{headerLength:t,frameLength:r}}}function Pw(n,e,t,r,s){const i=kw(n.samplerate),o=r+s*i,l=dF(e,t);let c;if(l){const{frameLength:h,headerLength:p}=l,v=p+h,g=Math.max(0,t+v-e.length);g?(c=new Uint8Array(v-p),c.set(e.subarray(t+p,e.length),0)):c=e.subarray(t+p,t+v);const S={unit:c,pts:o};return g||n.samples.push(S),{sample:S,length:v,missing:g}}const d=e.length-t;return c=new Uint8Array(d),c.set(e.subarray(t,e.length),0),{sample:{unit:c,pts:o},length:d,missing:-1}}function fF(n,e){return Gp(n,e)&&Kc(n,e+6)+10<=n.length-e}function hF(n){return n instanceof ArrayBuffer?n:n.byteOffset==0&&n.byteLength==n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer}function Th(n,e=0,t=1/0){return mF(n,e,t,Uint8Array)}function mF(n,e,t,r){const s=pF(n);let i=1;"BYTES_PER_ELEMENT"in r&&(i=r.BYTES_PER_ELEMENT);const o=gF(n)?n.byteOffset:0,l=(o+n.byteLength)/i,c=(o+e)/i,d=Math.floor(Math.max(0,Math.min(c,l))),f=Math.floor(Math.min(d+Math.max(t,0),l));return new r(s,d,f-d)}function pF(n){return n instanceof ArrayBuffer?n:n.buffer}function gF(n){return n&&n.buffer instanceof ArrayBuffer&&n.byteLength!==void 0&&n.byteOffset!==void 0}function yF(n){const e={key:n.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(n.size<2)return;if(n.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const r=n.data.subarray(1).indexOf(0);if(r===-1)return;const s=Rn(Th(n.data,1,r)),i=n.data[2+r],o=n.data.subarray(3+r).indexOf(0);if(o===-1)return;const l=Rn(Th(n.data,3+r,o));let c;return s==="-->"?c=Rn(Th(n.data,4+r+o)):c=hF(n.data.subarray(4+r+o)),e.mimeType=s,e.pictureType=i,e.description=l,e.data=c,e}function vF(n){if(n.size<2)return;const e=Rn(n.data,!0),t=new Uint8Array(n.data.subarray(e.length+1));return{key:n.type,info:e,data:t.buffer}}function xF(n){if(n.size<2)return;if(n.type==="TXXX"){let t=1;const r=Rn(n.data.subarray(t),!0);t+=r.length+1;const s=Rn(n.data.subarray(t));return{key:n.type,info:r,data:s}}const e=Rn(n.data.subarray(1));return{key:n.type,info:"",data:e}}function SF(n){if(n.type==="WXXX"){if(n.size<2)return;let t=1;const r=Rn(n.data.subarray(t),!0);t+=r.length+1;const s=Rn(n.data.subarray(t));return{key:n.type,info:r,data:s}}const e=Rn(n.data);return{key:n.type,info:"",data:e}}function EF(n){return n.type==="PRIV"?vF(n):n.type[0]==="W"?SF(n):n.type==="APIC"?yF(n):xF(n)}function TF(n){const e=String.fromCharCode(n[0],n[1],n[2],n[3]),t=Kc(n,4),r=10;return{type:e,size:t,data:n.subarray(r,r+t)}}const Su=10,bF=10;function Dw(n){let e=0;const t=[];for(;Gp(n,e);){const r=Kc(n,e+6);n[e+5]>>6&1&&(e+=Su),e+=Su;const s=e+r;for(;e+bF<s;){const i=TF(n.subarray(e)),o=EF(i);o&&t.push(o),e+=i.size+Su}Rw(n,e)&&(e+=Su)}return t}function Nw(n){return n&&n.key==="PRIV"&&n.info==="com.apple.streaming.transportStreamTimestamp"}function wF(n){if(n.data.byteLength===8){const e=new Uint8Array(n.data),t=e[3]&1;let r=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return r/=45,t&&(r+=4772185884e-2),Math.round(r)}}function Kp(n){const e=Dw(n);for(let t=0;t<e.length;t++){const r=e[t];if(Nw(r))return wF(r)}}let wn=(function(n){return n.audioId3="org.id3",n.dateRange="com.apple.quicktime.HLS",n.emsg="https://aomedia.org/emsg/ID3",n.misbklv="urn:misb:KLV:bin:1910.1",n})({});function fr(n="",e=9e4){return{type:n,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class zp{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(e,t){this.cachedData&&(e=Un(this.cachedData,e),this.cachedData=null);let r=ka(e,0),s=r?r.length:0,i;const o=this._audioTrack,l=this._id3Track,c=r?Kp(r):void 0,d=e.length;for((this.basePTS===null||this.frameIndex===0&&he(c))&&(this.basePTS=AF(c,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),r&&r.length>0&&l.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:wn.audioId3,duration:Number.POSITIVE_INFINITY});s<d;){if(this.canParse(e,s)){const f=this.appendFrame(o,e,s);f?(this.frameIndex++,this.lastPTS=f.sample.pts,s+=f.length,i=s):s=d}else fF(e,s)?(r=ka(e,s),l.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:wn.audioId3,duration:Number.POSITIVE_INFINITY}),s+=r.length,i=s):s++;if(s===d&&i!==d){const f=e.slice(i);this.cachedData?this.cachedData=Un(this.cachedData,f):this.cachedData=f}}return{audioTrack:o,videoTrack:fr(),id3Track:l,textTrack:fr()}}demuxSampleAes(e,t,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:fr(),id3Track:this._id3Track,textTrack:fr()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const AF=(n,e,t)=>{if(he(n))return n*90;const r=t?t.baseTime*9e4/t.timescale:0;return e*9e4+r};let Eu=null;const LF=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],RF=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],IF=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],_F=[0,1,1,4];function Ow(n,e,t,r,s){if(t+24>e.length)return;const i=Mw(e,t);if(i&&t+i.frameLength<=e.length){const o=i.samplesPerFrame*9e4/i.sampleRate,l=r+s*o,c={unit:e.subarray(t,t+i.frameLength),pts:l,dts:l};return n.config=[],n.channelCount=i.channelCount,n.samplerate=i.sampleRate,n.samples.push(c),{sample:c,length:i.frameLength,missing:0}}}function Mw(n,e){const t=n[e+1]>>3&3,r=n[e+1]>>1&3,s=n[e+2]>>4&15,i=n[e+2]>>2&3;if(t!==1&&s!==0&&s!==15&&i!==3){const o=n[e+2]>>1&1,l=n[e+3]>>6,c=t===3?3-r:r===3?3:4,d=LF[c*14+s-1]*1e3,h=RF[(t===3?0:t===2?1:2)*3+i],p=l===3?1:2,v=IF[t][r],g=_F[r],S=v*8*g,x=Math.floor(v*d/h+o)*g;if(Eu===null){const L=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Eu=L?parseInt(L[1]):0}return!!Eu&&Eu<=87&&r===2&&d>=224e3&&l===0&&(n[e+3]=n[e+3]|128),{sampleRate:h,channelCount:p,frameLength:x,samplesPerFrame:S}}}function Wp(n,e){return n[e]===255&&(n[e+1]&224)===224&&(n[e+1]&6)!==0}function Fw(n,e){return e+1<n.length&&Wp(n,e)}function CF(n,e){return Wp(n,e)&&4<=n.length-e}function Bw(n,e){if(e+1<n.length&&Wp(n,e)){const r=Mw(n,e);let s=4;r!=null&&r.frameLength&&(s=r.frameLength);const i=e+s;return i===n.length||Fw(n,i)}return!1}class kF extends zp{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const r=ka(e,0);let s=r?.length||0;if(Bw(e,s))return!1;for(let i=e.length;s<i;s++)if(cF(e,s))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return uF(e,t)}appendFrame(e,t,r){Cw(e,this.observer,t,r,e.manifestCodec);const s=Pw(e,t,r,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s}}const Uw=(n,e)=>{let t=0,r=5;e+=r;const s=new Uint32Array(1),i=new Uint32Array(1),o=new Uint8Array(1);for(;r>0;){o[0]=n[e];const l=Math.min(r,8),c=8-l;i[0]=4278190080>>>24+c<<c,s[0]=(o[0]&i[0])>>c,t=t?t<<l|s[0]:s[0],e+=1,r-=l}return t};class PF extends zp{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,r){const s=$w(e,t,r,this.basePTS,this.frameIndex);if(s!==-1)return{sample:e.samples[e.samples.length-1],length:s,missing:0}}static probe(e){if(!e)return!1;const t=ka(e,0);if(!t)return!1;const r=t.length;return e[r]===11&&e[r+1]===119&&Kp(t)!==void 0&&Uw(e,r)<16}}function $w(n,e,t,r,s){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const i=e[t+4]>>6;if(i>=3)return-1;const l=[48e3,44100,32e3][i],c=e[t+4]&63,f=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][c*3+i]*2;if(t+f>e.length)return-1;const h=e[t+6]>>5;let p=0;h===2?p+=2:(h&1&&h!==1&&(p+=2),h&4&&(p+=2));const v=(e[t+6]<<8|e[t+7])>>12-p&1,S=[2,1,2,3,3,4,4,5][h]+v,x=e[t+5]>>3,b=e[t+5]&7,A=new Uint8Array([i<<6|x<<1|b>>2,(b&3)<<6|h<<3|v<<2|c>>4,c<<4&224]),L=1536/l*9e4,I=r+s*L,k=e.subarray(t,t+f);return n.config=A,n.channelCount=S,n.samplerate=l,n.samples.push({unit:k,pts:I}),f}class DF extends zp{resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=ka(e,0);let r=t?.length||0;if(t&&e[r]===11&&e[r+1]===119&&Kp(t)!==void 0&&Uw(e,r)<=16)return!1;for(let s=e.length;r<s;r++)if(Bw(e,r))return Ze.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return CF(e,t)}appendFrame(e,t,r){if(this.basePTS!==null)return Ow(e,t,r,this.basePTS,this.frameIndex)}}const NF=/\/emsg[-/]ID3/i;class OF{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,s){const i=this.videoTrack=fr("video",1),o=this.audioTrack=fr("audio",1),l=this.txtTrack=fr("text",1);if(this.id3Track=fr("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const c=Xb(e);if(c.video){const{id:d,timescale:f,codec:h,supplemental:p}=c.video;i.id=d,i.timescale=l.timescale=f,i.codec=h,i.supplemental=p}if(c.audio){const{id:d,timescale:f,codec:h}=c.audio;o.id=d,o.timescale=f,o.codec=h}l.id=Wb.text,i.sampleDuration=0,i.duration=o.duration=s}resetContiguity(){this.remainderData=null}static probe(e){return P2(e)}demux(e,t){this.timeOffset=t;let r=e;const s=this.videoTrack,i=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=Un(this.remainderData,e));const l=U2(r);this.remainderData=l.remainder,s.samples=l.valid||new Uint8Array}else s.samples=r;const o=this.extractID3Track(s,t);return i.samples=Ux(t,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const s=this.extractID3Track(t,this.timeOffset);return r.samples=Ux(e,t),{videoTrack:t,audioTrack:fr(),id3Track:s,textTrack:fr()}}extractID3Track(e,t){const r=this.id3Track;if(e.samples.length){const s=Ue(e.samples,["emsg"]);s&&s.forEach(i=>{const o=j2(i);if(NF.test(o.schemeIdUri)){const l=TS(o,t);let c=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;c<=.001&&(c=Number.POSITIVE_INFINITY);const d=o.payload;r.samples.push({data:d,len:d.byteLength,dts:l,pts:l,type:wn.emsg,duration:c})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const l=TS(o,t);r.samples.push({data:o.payload,len:o.payload.byteLength,dts:l,pts:l,type:wn.misbklv,duration:Number.POSITIVE_INFINITY})}})}return r}demuxSampleAes(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function TS(n,e){return he(n.presentationTime)?n.presentationTime/n.timeScale:e+n.presentationTimeDelta/n.timeScale}class MF{constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new Fp(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Rs.cbc)}decryptAacSample(e,t,r){const s=e[t].unit;if(s.length<=16)return;const i=s.subarray(16,s.length-s.length%16),o=i.buffer.slice(i.byteOffset,i.byteOffset+i.length);this.decryptBuffer(o).then(l=>{const c=new Uint8Array(l);s.set(c,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,r)}).catch(r)}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length){r();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,r),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,r=new Int8Array(t);let s=0;for(let i=32;i<e.length-16;i+=160,s+=16)r.set(e.subarray(i,i+16),s);return r}getAvcDecryptedUnit(e,t){const r=new Uint8Array(t);let s=0;for(let i=32;i<e.length-16;i+=160,s+=16)e.set(r.subarray(s,s+16),i);return e}decryptAvcSample(e,t,r,s,i){const o=Zb(i.data),l=this.getAvcEncryptedData(o);this.decryptBuffer(l.buffer).then(c=>{i.data=this.getAvcDecryptedUnit(o,c),this.decrypter.isSync()||this.decryptAvcSamples(e,t,r+1,s)}).catch(s)}decryptAvcSamples(e,t,r,s){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length){s();return}const i=e[t].units;for(;!(r>=i.length);r++){const o=i[r];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,t,r,s,o),!this.decrypter.isSync()))return}}}}class jw{constructor(){this.VideoSample=null}createVideoSample(e,t,r){return{key:e,frame:!1,pts:t,dts:r,units:[],length:0}}getLastNalUnit(e){var t;let r=this.VideoSample,s;if((!r||r.units.length===0)&&(r=e[e.length-1]),(t=r)!=null&&t.units){const i=r.units;s=i[i.length-1]}return s}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const r=t.samples,s=r.length;if(s){const i=r[s-1];e.pts=i.pts,e.dts=i.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,r){const s=t.byteLength;let i=e.naluState||0;const o=i,l=[];let c=0,d,f,h,p=-1,v=0;for(i===-1&&(p=0,v=this.getNALuType(t,0),i=0,c=1);c<s;){if(d=t[c++],!i){i=d?0:1;continue}if(i===1){i=d?0:2;continue}if(!d)i=3;else if(d===1){if(f=c-i-1,p>=0){const g={data:t.subarray(p,f),type:v};l.push(g)}else{const g=this.getLastNalUnit(e.samples);g&&(o&&c<=4-o&&g.state&&(g.data=g.data.subarray(0,g.data.byteLength-o)),f>0&&(g.data=Un(g.data,t.subarray(0,f)),g.state=0))}c<s?(h=this.getNALuType(t,c),p=c,v=h,i=0):i=-1}else i=0}if(p>=0&&i>=0){const g={data:t.subarray(p,s),type:v,state:i};l.push(g)}if(l.length===0){const g=this.getLastNalUnit(e.samples);g&&(g.data=Un(g.data,t))}return e.naluState=i,l}}class ma{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,r=e.byteLength-t,s=new Uint8Array(4),i=Math.min(4,t);if(i===0)throw new Error("no bytes available");s.set(e.subarray(r,r+i)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=i*8,this.bytesAvailable-=i}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const r=this.word>>>32-t;if(e>32&&Ze.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class FF extends jw{parsePES(e,t,r,s){const i=this.parseNALu(e,r.data,s);let o=this.VideoSample,l,c=!1;r.data=null,o&&i.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),i.forEach(d=>{var f,h;switch(d.type){case 1:{let S=!1;l=!0;const x=d.data;if(c&&x.length>4){const b=this.readSliceType(x);(b===2||b===4||b===7||b===9)&&(S=!0)}if(S){var p;(p=o)!=null&&p.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.frame=!0,o.key=S;break}case 5:l=!0,(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0,o.frame=!0;break;case 6:{l=!0,Dp(d.data,1,r.pts,t.samples);break}case 7:{var v,g;l=!0,c=!0;const S=d.data,x=this.readSPS(S);if(!e.sps||e.width!==x.width||e.height!==x.height||((v=e.pixelRatio)==null?void 0:v[0])!==x.pixelRatio[0]||((g=e.pixelRatio)==null?void 0:g[1])!==x.pixelRatio[1]){e.width=x.width,e.height=x.height,e.pixelRatio=x.pixelRatio,e.sps=[S];const b=S.subarray(1,4);let A="avc1.";for(let L=0;L<3;L++){let I=b[L].toString(16);I.length<2&&(I="0"+I),A+=I}e.codec=A}break}case 8:l=!0,e.pps=[d.data];break;case 9:l=!0,e.audFound=!0,(h=o)!=null&&h.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;case 12:l=!0;break;default:l=!1;break}o&&l&&o.units.push(d)}),s&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new ma(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let r=8,s=8,i;for(let o=0;o<e;o++)s!==0&&(i=t.readEG(),s=(r+i+256)%256),r=s===0?r:s}readSPS(e){const t=new ma(e);let r=0,s=0,i=0,o=0,l,c,d;const f=t.readUByte.bind(t),h=t.readBits.bind(t),p=t.readUEG.bind(t),v=t.readBoolean.bind(t),g=t.skipBits.bind(t),S=t.skipEG.bind(t),x=t.skipUEG.bind(t),b=this.skipScalingList.bind(this);f();const A=f();if(h(5),g(3),f(),x(),A===100||A===110||A===122||A===244||A===44||A===83||A===86||A===118||A===128){const P=p();if(P===3&&g(1),x(),x(),g(1),v())for(c=P!==3?8:12,d=0;d<c;d++)v()&&(d<6?b(16,t):b(64,t))}x();const L=p();if(L===0)p();else if(L===1)for(g(1),S(),S(),l=p(),d=0;d<l;d++)S();x(),g(1);const I=p(),k=p(),F=h(1);F===0&&g(1),g(1),v()&&(r=p(),s=p(),i=p(),o=p());let C=[1,1];if(v()&&v())switch(f()){case 1:C=[1,1];break;case 2:C=[12,11];break;case 3:C=[10,11];break;case 4:C=[16,11];break;case 5:C=[40,33];break;case 6:C=[24,11];break;case 7:C=[20,11];break;case 8:C=[32,11];break;case 9:C=[80,33];break;case 10:C=[18,11];break;case 11:C=[15,11];break;case 12:C=[64,33];break;case 13:C=[160,99];break;case 14:C=[4,3];break;case 15:C=[3,2];break;case 16:C=[2,1];break;case 255:{C=[f()<<8|f(),f()<<8|f()];break}}return{width:Math.ceil((I+1)*16-r*2-s*2),height:(2-F)*(k+1)*16-(F?2:4)*(i+o),pixelRatio:C}}}class BF extends jw{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,r,s){const i=this.parseNALu(e,r.data,s);let o=this.VideoSample,l,c=!1;r.data=null,o&&i.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),i.forEach(d=>{var f,h;switch(d.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),o.frame=!0,l=!0;break;case 16:case 17:case 18:case 21:if(l=!0,c){var p;(p=o)!=null&&p.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:l=!0,(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0,o.frame=!0;break;case 39:l=!0,Dp(d.data,2,r.pts,t.samples);break;case 32:l=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=et(e.params,this.readVPS(d.data)),this.initVPS=d.data),e.vps=[d.data];break;case 33:if(l=!0,c=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],d.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const v=this.readSPS(d.data);e.width=v.width,e.height=v.height,e.pixelRatio=v.pixelRatio,e.codec=v.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const g in v.params)e.params[g]=v.params[g]}this.pushParameterSet(e.sps,d.data,e.vps),o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0;break;case 34:if(l=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const v=this.readPPS(d.data);for(const g in v)e.params[g]=v[g]}this.pushParameterSet(e.pps,d.data,e.vps)}break;case 35:l=!0,e.audFound=!0,(h=o)!=null&&h.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;default:l=!1;break}o&&l&&o.units.push(d)}),s&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}pushParameterSet(e,t,r){(r&&r[0]===this.initVPS||!r&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let r=0;for(let s=0;s<e.byteLength;s++)s>=2&&e[s]===3&&e[s-1]===0&&e[s-2]===0||(t[r]=e[s],r++);return new Uint8Array(t.buffer,0,r)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new ma(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const r=t.readBits(3),s=t.readBoolean();return{numTemporalLayers:r+1,temporalIdNested:s}}readSPS(e){const t=new ma(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const r=t.readBits(3);t.readBoolean();const s=t.readBits(2),i=t.readBoolean(),o=t.readBits(5),l=t.readUByte(),c=t.readUByte(),d=t.readUByte(),f=t.readUByte(),h=t.readUByte(),p=t.readUByte(),v=t.readUByte(),g=t.readUByte(),S=t.readUByte(),x=t.readUByte(),b=t.readUByte(),A=[],L=[];for(let me=0;me<r;me++)A.push(t.readBoolean()),L.push(t.readBoolean());if(r>0)for(let me=r;me<8;me++)t.readBits(2);for(let me=0;me<r;me++)A[me]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),L[me]&&t.readUByte();t.readUEG();const I=t.readUEG();I==3&&t.skipBits(1);const k=t.readUEG(),F=t.readUEG(),C=t.readBoolean();let P=0,O=0,M=0,H=0;C&&(P+=t.readUEG(),O+=t.readUEG(),M+=t.readUEG(),H+=t.readUEG());const Z=t.readUEG(),se=t.readUEG(),U=t.readUEG(),ne=t.readBoolean();for(let me=ne?0:r;me<=r;me++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let Me=0;Me<4;Me++)for(let qe=0;qe<(Me===3?2:6);qe++)if(!t.readBoolean())t.readUEG();else{const Be=Math.min(64,1<<4+(Me<<1));Me>1&&t.readEG();for(let Xe=0;Xe<Be;Xe++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const G=t.readUEG();let Q=0;for(let me=0;me<G;me++){let Me=!1;if(me!==0&&(Me=t.readBoolean()),Me){me===G&&t.readUEG(),t.readBoolean(),t.readUEG();let qe=0;for(let je=0;je<=Q;je++){const Be=t.readBoolean();let Xe=!1;Be||(Xe=t.readBoolean()),(Be||Xe)&&qe++}Q=qe}else{const qe=t.readUEG(),je=t.readUEG();Q=qe+je;for(let Be=0;Be<qe;Be++)t.readUEG(),t.readBoolean();for(let Be=0;Be<je;Be++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const me=t.readUEG();for(let Me=0;Me<me;Me++){for(let qe=0;qe<U+4;qe++)t.readBits(1);t.readBits(1)}}let D=0,$=1,ie=1,ue=!0,ce=1,fe=0;t.readBoolean(),t.readBoolean();let Ee=!1;if(t.readBoolean()){if(t.readBoolean()){const Ct=t.readUByte(),Cn=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],mn=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Ct>0&&Ct<16?($=Cn[Ct-1],ie=mn[Ct-1]):Ct===255&&($=t.readBits(16),ie=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Ee=t.readBoolean(),Ee&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(ce=t.readBits(32),fe=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const mn=t.readBoolean(),vt=t.readBoolean();let bt=!1;(mn||vt)&&(bt=t.readBoolean(),bt&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),bt&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let pn=0;pn<=r;pn++){ue=t.readBoolean();const tr=ue||t.readBoolean();let gn=!1;tr?t.readEG():gn=t.readBoolean();const Yt=gn?1:t.readUEG()+1;if(mn)for(let qt=0;qt<Yt;qt++)t.readUEG(),t.readUEG(),bt&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(vt)for(let qt=0;qt<Yt;qt++)t.readUEG(),t.readUEG(),bt&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),D=t.readUEG())}let Le=k,ke=F;if(C){let me=1,Me=1;I===1?me=Me=2:I==2&&(me=2),Le=k-me*O-me*P,ke=F-Me*H-Me*M}const Pe=s?["A","B","C"][s]:"",Te=l<<24|c<<16|d<<8|f;let xe=0;for(let me=0;me<32;me++)xe=(xe|(Te>>me&1)<<31-me)>>>0;let Re=xe.toString(16);return o===1&&Re==="2"&&(Re="6"),{codecString:`hvc1.${Pe}${o}.${Re}.${i?"H":"L"}${b}.B0`,params:{general_tier_flag:i,general_profile_idc:o,general_profile_space:s,general_profile_compatibility_flags:[l,c,d,f],general_constraint_indicator_flags:[h,p,v,g,S,x],general_level_idc:b,bit_depth:Z+8,bit_depth_luma_minus8:Z,bit_depth_chroma_minus8:se,min_spatial_segmentation_idc:D,chroma_format_idc:I,frame_rate:{fixed:ue,fps:fe/ce}},width:Le,height:ke,pixelRatio:[$,ie]}}readPPS(e){const t=new ma(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const s=t.readBoolean(),i=t.readBoolean();let o=1;return i&&s?o=0:i?o=3:s&&(o=2),{parallelismType:o}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Nt=188;class vs{constructor(e,t,r,s){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.logger=s,this.videoParser=null}static probe(e,t){const r=vs.syncOffset(e);return r>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${r}`),r!==-1}static syncOffset(e){const t=e.length;let r=Math.min(Nt*5,t-Nt)+1,s=0;for(;s<r;){let i=!1,o=-1,l=0;for(let c=s;c<t;c+=Nt)if(e[c]===71&&(t-c===Nt||e[c+Nt]===71)){if(l++,o===-1&&(o=c,o!==0&&(r=Math.min(o+Nt*99,e.length-Nt)+1)),i||(i=km(e,c)===0),i&&l>1&&(o===0&&l>2||c+Nt>r))return o}else{if(l)return-1;break}s++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:Wb[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,r,s){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=vs.createTrack("video"),this._videoTrack.duration=s,this._audioTrack=vs.createTrack("audio",s),this._id3Track=vs.createTrack("id3"),this._txtTrack=vs.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:r}=this;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,r=!1,s=!1){r||(this.sampleAes=null);let i;const o=this._videoTrack,l=this._audioTrack,c=this._id3Track,d=this._txtTrack;let f=o.pid,h=o.pesData,p=l.pid,v=c.pid,g=l.pesData,S=c.pesData,x=null,b=this.pmtParsed,A=this._pmtId,L=e.length;if(this.remainderData&&(e=Un(this.remainderData,e),L=e.length,this.remainderData=null),L<Nt&&!s)return this.remainderData=e,{audioTrack:l,videoTrack:o,id3Track:c,textTrack:d};const I=Math.max(0,vs.syncOffset(e));L-=(L-I)%Nt,L<e.byteLength&&!s&&(this.remainderData=new Uint8Array(e.buffer,L,e.buffer.byteLength-L));let k=0;for(let C=I;C<L;C+=Nt)if(e[C]===71){const P=!!(e[C+1]&64),O=km(e,C),M=(e[C+3]&48)>>4;let H;if(M>1){if(H=C+5+e[C+4],H===C+Nt)continue}else H=C+4;switch(O){case f:P&&(h&&(i=Mi(h,this.logger))&&(this.readyVideoParser(o.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(o,d,i,!1)),h={data:[],size:0}),h&&(h.data.push(e.subarray(H,C+Nt)),h.size+=C+Nt-H);break;case p:if(P){if(g&&(i=Mi(g,this.logger)))switch(l.segmentCodec){case"aac":this.parseAACPES(l,i);break;case"mp3":this.parseMPEGPES(l,i);break;case"ac3":this.parseAC3PES(l,i);break}g={data:[],size:0}}g&&(g.data.push(e.subarray(H,C+Nt)),g.size+=C+Nt-H);break;case v:P&&(S&&(i=Mi(S,this.logger))&&this.parseID3PES(c,i),S={data:[],size:0}),S&&(S.data.push(e.subarray(H,C+Nt)),S.size+=C+Nt-H);break;case 0:P&&(H+=e[H]+1),A=this._pmtId=UF(e,H);break;case A:{P&&(H+=e[H]+1);const Z=$F(e,H,this.typeSupported,r,this.observer,this.logger);f=Z.videoPid,f>0&&(o.pid=f,o.segmentCodec=Z.segmentVideoCodec),p=Z.audioPid,p>0&&(l.pid=p,l.segmentCodec=Z.segmentAudioCodec),v=Z.id3Pid,v>0&&(c.pid=v),x!==null&&!b&&(this.logger.warn(`MPEG-TS PMT found at ${C} after unknown PID '${x}'. Backtracking to sync byte @${I} to parse all TS packets.`),x=null,C=I-188),b=this.pmtParsed=!0;break}case 17:case 8191:break;default:x=O;break}}else k++;k>0&&Pm(this.observer,new Error(`Found ${k} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=h,l.pesData=g,c.pesData=S;const F={audioTrack:l,videoTrack:o,id3Track:c,textTrack:d};return s&&this.extractRemainingSamples(F),F}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:r,id3Track:s,textTrack:i}=e,o=r.pesData,l=t.pesData,c=s.pesData;let d;if(o&&(d=Mi(o,this.logger))?(this.readyVideoParser(r.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(r,i,d,!0),r.pesData=null)):r.pesData=o,l&&(d=Mi(l,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,d);break;case"mp3":this.parseMPEGPES(t,d);break;case"ac3":this.parseAC3PES(t,d);break}t.pesData=null}else l!=null&&l.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=l;c&&(d=Mi(c,this.logger))?(this.parseID3PES(s,d),s.pesData=null):s.pesData=c}demuxSampleAes(e,t,r){const s=this.demux(e,r,!0,!this.config.progressive),i=this.sampleAes=new MF(this.observer,this.config,t);return this.decrypt(s,i)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new FF:e==="hevc"&&(this.videoParser=new BF))}decrypt(e,t){return new Promise(r=>{const{audioTrack:s,videoTrack:i}=e;s.samples&&s.segmentCodec==="aac"?t.decryptAacSamples(s.samples,0,()=>{i.samples?t.decryptAvcSamples(i.samples,0,0,()=>{r(e)}):r(e)}):i.samples&&t.decryptAvcSamples(i.samples,0,0,()=>{r(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let r=0;const s=this.aacOverFlow;let i=t.data;if(s){this.aacOverFlow=null;const h=s.missing,p=s.sample.unit.byteLength;if(h===-1)i=Un(s.sample.unit,i);else{const v=p-h;s.sample.unit.set(i.subarray(0,h),v),e.samples.push(s.sample),r=s.missing}}let o,l;for(o=r,l=i.length;o<l-1&&!vc(i,o);o++);if(o!==r){let h;const p=o<l-1;if(p?h=`AAC PES did not start with ADTS header,offset:${o}`:h="No ADTS header found in AAC PES",Pm(this.observer,new Error(h),p,this.logger),!p)return}Cw(e,this.observer,i,o,this.audioCodec);let c;if(t.pts!==void 0)c=t.pts;else if(s){const h=kw(e.samplerate);c=s.sample.pts+h}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let d=0,f;for(;o<l;)if(f=Pw(e,i,o,c,d),o+=f.length,f.missing){this.aacOverFlow=f;break}else for(d++;o<l-1&&!vc(i,o);o++);}parseMPEGPES(e,t){const r=t.data,s=r.length;let i=0,o=0;const l=t.pts;if(l===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<s;)if(Fw(r,o)){const c=Ow(e,r,o,l,i);if(c)o+=c.length,i++;else break}else o++}parseAC3PES(e,t){{const r=t.data,s=t.pts;if(s===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const i=r.length;let o=0,l=0,c;for(;l<i&&(c=$w(e,r,l,s,o++))>0;)l+=c}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const r=et({},t,{type:this._videoTrack?wn.emsg:wn.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}}function km(n,e){return((n[e+1]&31)<<8)+n[e+2]}function UF(n,e){return(n[e+10]&31)<<8|n[e+11]}function $F(n,e,t,r,s,i){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},l=(n[e+1]&15)<<8|n[e+2],c=e+3+l-4,d=(n[e+10]&15)<<8|n[e+11];for(e+=12+d;e<c;){const f=km(n,e),h=(n[e+3]&15)<<8|n[e+4];switch(n[e]){case 207:if(!r){bh("ADTS AAC",i);break}case 15:o.audioPid===-1&&(o.audioPid=f);break;case 21:o.id3Pid===-1&&(o.id3Pid=f);break;case 219:if(!r){bh("H.264",i);break}case 27:o.videoPid===-1&&(o.videoPid=f);break;case 3:case 4:!t.mpeg&&!t.mp3?i.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=f,o.segmentAudioCodec="mp3");break;case 193:if(!r){bh("AC-3",i);break}case 129:t.ac3?o.audioPid===-1&&(o.audioPid=f,o.segmentAudioCodec="ac3"):i.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&h>0){let p=e+5,v=h;for(;v>2;){switch(n[p]){case 106:t.ac3!==!0?i.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=f,o.segmentAudioCodec="ac3");break}const S=n[p+1]+2;p+=S,v-=S}}break;case 194:case 135:return Pm(s,new Error("Unsupported EC-3 in M2TS found"),void 0,i),o;case 36:o.videoPid===-1&&(o.videoPid=f,o.segmentVideoCodec="hevc",i.log("HEVC in M2TS found"));break}e+=h+5}return o}function Pm(n,e,t,r){r.warn(`parsing error: ${e.message}`),n.emit(R.ERROR,R.ERROR,{type:we.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function bh(n,e){e.log(`${n} with AES-128-CBC encryption found in unencrypted stream`)}function Mi(n,e){let t=0,r,s,i,o,l;const c=n.data;if(!n||n.size===0)return null;for(;c[0].length<19&&c.length>1;)c[0]=Un(c[0],c[1]),c.splice(1,1);if(r=c[0],(r[0]<<16)+(r[1]<<8)+r[2]===1){if(s=(r[4]<<8)+r[5],s&&s>n.size-6)return null;const f=r[7];f&192&&(o=(r[9]&14)*536870912+(r[10]&255)*4194304+(r[11]&254)*16384+(r[12]&255)*128+(r[13]&254)/2,f&64?(l=(r[14]&14)*536870912+(r[15]&255)*4194304+(r[16]&254)*16384+(r[17]&255)*128+(r[18]&254)/2,o-l>60*9e4&&(e.warn(`${Math.round((o-l)/9e4)}s delta between PTS and DTS, align them`),o=l)):l=o),i=r[8];let h=i+9;if(n.size<=h)return null;n.size-=h;const p=new Uint8Array(n.size);for(let v=0,g=c.length;v<g;v++){r=c[v];let S=r.byteLength;if(h)if(h>S){h-=S;continue}else r=r.subarray(h),S-=h,h=0;p.set(r,t),t+=S}return s&&(s-=i+3),{data:p,pts:o,dts:l,len:s}}return null}class jF{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const hs=Math.pow(2,32)-1;class K{static init(){K.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in K.types)K.types.hasOwnProperty(e)&&(K.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);K.HDLR_TYPES={video:t,audio:r};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);K.STTS=K.STSC=K.STCO=i,K.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),K.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),K.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),K.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),l=new Uint8Array([97,118,99,49]),c=new Uint8Array([0,0,0,1]);K.FTYP=K.box(K.types.ftyp,o,c,o,l),K.DINF=K.box(K.types.dinf,K.box(K.types.dref,s))}static box(e,...t){let r=8,s=t.length;const i=s;for(;s--;)r+=t[s].byteLength;const o=new Uint8Array(r);for(o[0]=r>>24&255,o[1]=r>>16&255,o[2]=r>>8&255,o[3]=r&255,o.set(e,4),s=0,r=8;s<i;s++)o.set(t[s],r),r+=t[s].byteLength;return o}static hdlr(e){return K.box(K.types.hdlr,K.HDLR_TYPES[e])}static mdat(e){return K.box(K.types.mdat,e)}static mdhd(e,t){t*=e;const r=Math.floor(t/(hs+1)),s=Math.floor(t%(hs+1));return K.box(K.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,s>>24,s>>16&255,s>>8&255,s&255,85,196,0,0]))}static mdia(e){return K.box(K.types.mdia,K.mdhd(e.timescale||0,e.duration||0),K.hdlr(e.type),K.minf(e))}static mfhd(e){return K.box(K.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?K.box(K.types.minf,K.box(K.types.smhd,K.SMHD),K.DINF,K.stbl(e)):K.box(K.types.minf,K.box(K.types.vmhd,K.VMHD),K.DINF,K.stbl(e))}static moof(e,t,r){return K.box(K.types.moof,K.mfhd(e),K.traf(r,t))}static moov(e){let t=e.length;const r=[];for(;t--;)r[t]=K.trak(e[t]);return K.box.apply(null,[K.types.moov,K.mvhd(e[0].timescale||0,e[0].duration||0)].concat(r).concat(K.mvex(e)))}static mvex(e){let t=e.length;const r=[];for(;t--;)r[t]=K.trex(e[t]);return K.box.apply(null,[K.types.mvex,...r])}static mvhd(e,t){t*=e;const r=Math.floor(t/(hs+1)),s=Math.floor(t%(hs+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,s>>24,s>>16&255,s>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return K.box(K.types.mvhd,i)}static sdtp(e){const t=e.samples||[],r=new Uint8Array(4+t.length);let s,i;for(s=0;s<t.length;s++)i=t[s].flags,r[s+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return K.box(K.types.sdtp,r)}static stbl(e){return K.box(K.types.stbl,K.stsd(e),K.box(K.types.stts,K.STTS),K.box(K.types.stsc,K.STSC),K.box(K.types.stsz,K.STSZ),K.box(K.types.stco,K.STCO))}static avc1(e){let t=[],r=[],s,i,o;for(s=0;s<e.sps.length;s++)i=e.sps[s],o=i.byteLength,t.push(o>>>8&255),t.push(o&255),t=t.concat(Array.prototype.slice.call(i));for(s=0;s<e.pps.length;s++)i=e.pps[s],o=i.byteLength,r.push(o>>>8&255),r.push(o&255),r=r.concat(Array.prototype.slice.call(i));const l=K.box(K.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(r))),c=e.width,d=e.height,f=e.pixelRatio[0],h=e.pixelRatio[1];return K.box(K.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,c&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l,K.box(K.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),K.box(K.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,h>>24,h>>16&255,h>>8&255,h&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return K.box(K.types.mp4a,K.audioStsd(e),K.box(K.types.esds,K.esds(e)))}static mp3(e){return K.box(K.types[".mp3"],K.audioStsd(e))}static ac3(e){return K.box(K.types["ac-3"],K.audioStsd(e),K.box(K.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return K.box(K.types.stsd,K.STSD,K.mp4a(e));if(t==="ac3"&&e.config)return K.box(K.types.stsd,K.STSD,K.ac3(e));if(t==="mp3"&&e.codec==="mp3")return K.box(K.types.stsd,K.STSD,K.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return K.box(K.types.stsd,K.STSD,K.avc1(e));if(t==="hevc"&&e.vps)return K.box(K.types.stsd,K.STSD,K.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,r=(e.duration||0)*(e.timescale||0),s=e.width||0,i=e.height||0,o=Math.floor(r/(hs+1)),l=Math.floor(r%(hs+1));return K.box(K.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,l>>24,l>>16&255,l>>8&255,l&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,s&255,0,0,i>>8&255,i&255,0,0]))}static traf(e,t){const r=K.sdtp(e),s=e.id,i=Math.floor(t/(hs+1)),o=Math.floor(t%(hs+1));return K.box(K.types.traf,K.box(K.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255])),K.box(K.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,o>>24,o>>16&255,o>>8&255,o&255])),K.trun(e,r.length+16+20+8+16+8+8),r)}static trak(e){return e.duration=e.duration||4294967295,K.box(K.types.trak,K.tkhd(e),K.mdia(e))}static trex(e){const t=e.id;return K.box(K.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const r=e.samples||[],s=r.length,i=12+16*s,o=new Uint8Array(i);let l,c,d,f,h,p;for(t+=8+i,o.set([e.type==="video"?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),l=0;l<s;l++)c=r[l],d=c.duration,f=c.size,h=c.flags,p=c.cts,o.set([d>>>24&255,d>>>16&255,d>>>8&255,d&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,h.degradPrio&61440,h.degradPrio&15,p>>>24&255,p>>>16&255,p>>>8&255,p&255],12+16*l);return K.box(K.types.trun,o)}static initSegment(e){K.types||K.init();const t=K.moov(e);return Un(K.FTYP,t)}static hvc1(e){const t=e.params,r=[e.vps,e.sps,e.pps],s=4,i=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),s-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),r.length]);let o=i.length;for(let g=0;g<r.length;g+=1){o+=3;for(let S=0;S<r[g].length;S+=1)o+=2+r[g][S].length}const l=new Uint8Array(o);l.set(i,0),o=i.length;const c=r.length-1;for(let g=0;g<r.length;g+=1){l.set(new Uint8Array([32+g|(g===c?128:0),0,r[g].length]),o),o+=3;for(let S=0;S<r[g].length;S+=1)l.set(new Uint8Array([r[g][S].length>>8,r[g][S].length&255]),o),o+=2,l.set(r[g][S],o),o+=r[g][S].length}const d=K.box(K.types.hvcC,l),f=e.width,h=e.height,p=e.pixelRatio[0],v=e.pixelRatio[1];return K.box(K.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>8&255,f&255,h>>8&255,h&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d,K.box(K.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),K.box(K.types.pasp,new Uint8Array([p>>24,p>>16&255,p>>8&255,p&255,v>>24,v>>16&255,v>>8&255,v&255])))}}K.types=void 0;K.HDLR_TYPES=void 0;K.STTS=void 0;K.STSC=void 0;K.STCO=void 0;K.STSZ=void 0;K.VMHD=void 0;K.SMHD=void 0;K.STSD=void 0;K.FTYP=void 0;K.DINF=void 0;const Vw=9e4;function Yp(n,e,t=1,r=!1){const s=n*e*t;return r?Math.round(s):s}function VF(n,e,t=1,r=!1){return Yp(n,e,1/t,r)}function na(n,e=!1){return Yp(n,1e3,1/Vw,e)}function GF(n,e=1){return Yp(n,Vw,1/e)}function bS(n){const{baseTime:e,timescale:t,trackId:r}=n;return`${e/t} (${e}/${t}) trackId: ${r}`}const HF=10*1e3,KF=1024,zF=1152,WF=1536;let Fi=null,wh=null;function wS(n,e,t,r){return{duration:e,size:t,cts:r,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:n?2:1,isNonSync:n?0:1}}}class Hu extends $n{constructor(e,t,r,s){if(super("mp4-remuxer",s),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,Fi===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Fi=o?parseInt(o[1]):0}if(wh===null){const i=navigator.userAgent.match(/Safari\/(\d+)/i);wh=i?parseInt(i[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&bS(t)} > ${e&&bS(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const r=e[0].pts,s=e.reduce((i,o)=>{let l=o.pts,c=l-i;return c<-4294967296&&(t=!0,l=bn(l,r),c=l-i),c>0?i:l},r);return t&&this.debug("PTS rollover detected"),s}remux(e,t,r,s,i,o,l,c){let d,f,h,p,v,g,S=i,x=i;const b=e.pid>-1,A=t.pid>-1,L=t.samples.length,I=e.samples.length>0,k=l&&L>0||L>1;if((!b||I)&&(!A||k)||this.ISGenerated||l){if(this.ISGenerated){var C,P,O,M;const U=this.videoTrackConfig;(U&&(t.width!==U.width||t.height!==U.height||((C=t.pixelRatio)==null?void 0:C[0])!==((P=U.pixelRatio)==null?void 0:P[0])||((O=t.pixelRatio)==null?void 0:O[1])!==((M=U.pixelRatio)==null?void 0:M[1]))||!U&&k||this.nextAudioTs===null&&I)&&this.resetInitSegment()}this.ISGenerated||(h=this.generateIS(e,t,i,o));const H=this.isVideoContiguous;let Z=-1,se;if(k&&(Z=YF(t.samples),!H&&this.config.forceKeyFrameOnDiscontinuity))if(g=!0,Z>0){this.warn(`Dropped ${Z} out of ${L} video samples due to a missing keyframe`);const U=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(Z),t.dropped+=Z,x+=(t.samples[0].pts-U)/t.inputTimeScale,se=x}else Z===-1&&(this.warn(`No keyframe found out of ${L} video samples`),g=!1);if(this.ISGenerated){if(I&&k){const U=this.getVideoStartPts(t.samples),q=(bn(e.samples[0].pts,U)-U)/t.inputTimeScale;S+=Math.max(0,q),x+=Math.max(0,-q)}if(I){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),h=this.generateIS(e,t,i,o)),f=this.remuxAudio(e,S,this.isAudioContiguous,o,A||k||c===ge.AUDIO?x:void 0),k){const U=f?f.endPTS-f.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),h=this.generateIS(e,t,i,o)),d=this.remuxVideo(t,x,H,U)}}else k&&(d=this.remuxVideo(t,x,H,0));d&&(d.firstKeyFrame=Z,d.independent=Z!==-1,d.firstKeyFramePTS=se)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(v=Gw(r,i,this._initPTS,this._initDTS)),s.samples.length&&(p=Hw(s,i,this._initPTS))),{audio:f,video:d,initSegment:h,independent:g,text:p,id3:v}}computeInitPts(e,t,r,s){const i=Math.round(r*t);let o=bn(e,i);if(o<i+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(i-o)/t} ${s}`);o<i+t;)o+=8589934592;return o-i}generateIS(e,t,r,s){const i=e.samples,o=t.samples,l=this.typeSupported,c={},d=this._initPTS;let f=!d||s,h="audio/mp4",p,v,g,S=-1;if(f&&(p=v=1/0),e.config&&i.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":l.mpeg?(h="audio/mpeg",e.codec=""):l.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}c.audio={id:"audio",container:h,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&l.mpeg?new Uint8Array(0):K.initSegment([e]),metadata:{channelCount:e.channelCount}},f&&(S=e.id,g=e.inputTimeScale,!d||g!==d.timescale?p=v=this.computeInitPts(i[0].pts,g,r,"audio"):f=!1)}if(t.sps&&t.pps&&o.length){if(t.timescale=t.inputTimeScale,c.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:K.initSegment([t]),metadata:{width:t.width,height:t.height}},f)if(S=t.id,g=t.inputTimeScale,!d||g!==d.timescale){const x=this.getVideoStartPts(o),b=bn(o[0].dts,x),A=this.computeInitPts(b,g,r,"video"),L=this.computeInitPts(x,g,r,"video");v=Math.min(v,A),p=Math.min(p,L)}else f=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(c).length)return this.ISGenerated=!0,f?(d&&this.warn(`Timestamps at playlist time: ${s?"":"~"}${r} ${p/g} != initPTS: ${d.baseTime/d.timescale} (${d.baseTime}/${d.timescale}) trackId: ${d.trackId}`),this.log(`Found initPTS at playlist time: ${r} offset: ${p/g} (${p}/${g}) trackId: ${S}`),this._initPTS={baseTime:p,timescale:g,trackId:S},this._initDTS={baseTime:v,timescale:g,trackId:S}):p=g=void 0,{tracks:c,initPTS:p,timescale:g,trackId:S}}remuxVideo(e,t,r,s){const i=e.inputTimeScale,o=e.samples,l=[],c=o.length,d=this._initPTS,f=d.baseTime*i/d.timescale;let h=this.nextVideoTs,p=8,v=this.videoSampleDuration,g,S,x=Number.POSITIVE_INFINITY,b=Number.NEGATIVE_INFINITY,A=!1;if(!r||h===null){const D=f+t*i,$=o[0].pts-bn(o[0].dts,o[0].pts);Fi&&h!==null&&Math.abs(D-$-(h+f))<15e3?r=!0:h=D-$-f}const L=h+f;for(let D=0;D<c;D++){const $=o[D];$.pts=bn($.pts,L),$.dts=bn($.dts,L),$.dts<o[D>0?D-1:D].dts&&(A=!0)}A&&o.sort(function(D,$){const ie=D.dts-$.dts,ue=D.pts-$.pts;return ie||ue}),g=o[0].dts,S=o[o.length-1].dts;const I=S-g,k=I?Math.round(I/(c-1)):v||e.inputTimeScale/30;if(r){const D=g-L,$=D>k,ie=D<-1;if(($||ie)&&($?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${na(D,!0)} ms (${D}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${na(-D,!0)} ms (${D}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!ie||L>=o[0].pts||Fi)){g=L;const ue=o[0].pts-D;if($)o[0].dts=g,o[0].pts=ue;else{let ce=!0;for(let fe=0;fe<o.length&&!(o[fe].dts>ue&&ce);fe++){const Ee=o[fe].pts;if(o[fe].dts-=D,o[fe].pts-=D,fe<o.length-1){const ye=o[fe+1].pts,Le=o[fe].pts,ke=ye<=Le,Pe=ye<=Ee;ce=ke==Pe}}}this.log(`Video: Initial PTS/DTS adjusted: ${na(ue,!0)}/${na(g,!0)}, delta: ${na(D,!0)} ms`)}}g=Math.max(0,g);let F=0,C=0,P=g;for(let D=0;D<c;D++){const $=o[D],ie=$.units,ue=ie.length;let ce=0;for(let fe=0;fe<ue;fe++)ce+=ie[fe].data.length;C+=ce,F+=ue,$.length=ce,$.dts<P?($.dts=P,P+=k/4|0||1):P=$.dts,x=Math.min($.pts,x),b=Math.max($.pts,b)}S=o[c-1].dts;const O=C+4*F+8;let M;try{M=new Uint8Array(O)}catch(D){this.observer.emit(R.ERROR,R.ERROR,{type:we.MUX_ERROR,details:z.REMUX_ALLOC_ERROR,fatal:!1,error:D,bytes:O,reason:`fail allocating video mdat ${O}`});return}const H=new DataView(M.buffer);H.setUint32(0,O),M.set(K.types.mdat,4);let Z=!1,se=Number.POSITIVE_INFINITY,U=Number.POSITIVE_INFINITY,ne=Number.NEGATIVE_INFINITY,q=Number.NEGATIVE_INFINITY;for(let D=0;D<c;D++){const $=o[D],ie=$.units;let ue=0;for(let Ee=0,ye=ie.length;Ee<ye;Ee++){const Le=ie[Ee],ke=Le.data,Pe=Le.data.byteLength;H.setUint32(p,Pe),p+=4,M.set(ke,p),p+=Pe,ue+=4+Pe}let ce;if(D<c-1)v=o[D+1].dts-$.dts,ce=o[D+1].pts-$.pts;else{const Ee=this.config,ye=D>0?$.dts-o[D-1].dts:k;if(ce=D>0?$.pts-o[D-1].pts:k,Ee.stretchShortVideoTrack&&this.nextAudioTs!==null){const Le=Math.floor(Ee.maxBufferHole*i),ke=(s?x+s*i:this.nextAudioTs+f)-$.pts;ke>Le?(v=ke-ye,v<0?v=ye:Z=!0,this.log(`It is approximately ${ke/90} ms to the next segment; using duration ${v/90} ms for the last video frame.`)):v=ye}else v=ye}const fe=Math.round($.pts-$.dts);se=Math.min(se,v),ne=Math.max(ne,v),U=Math.min(U,ce),q=Math.max(q,ce),l.push(wS($.key,v,ue,fe))}if(l.length){if(Fi){if(Fi<70){const D=l[0].flags;D.dependsOn=2,D.isNonSync=0}}else if(wh&&q-U<ne-se&&k/ne<.025&&l[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let D=g;for(let $=0,ie=l.length;$<ie;$++){const ue=D+l[$].duration,ce=D+l[$].cts;if($<ie-1){const fe=ue+l[$+1].cts;l[$].duration=fe-ce}else l[$].duration=$?l[$-1].duration:k;l[$].cts=0,D=ue}}}v=Z||!v?k:v;const te=S+v;this.nextVideoTs=h=te-f,this.videoSampleDuration=v,this.isVideoContiguous=!0;const ee={data1:K.moof(e.sequenceNumber++,g,et(e,{samples:l})),data2:M,startPTS:(x-f)/i,endPTS:(b+v-f)/i,startDTS:(g-f)/i,endDTS:h/i,type:"video",hasAudio:!1,hasVideo:!0,nb:l.length,dropped:e.dropped};return e.samples=[],e.dropped=0,ee}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return zF;case"ac3":return WF;default:return KF}}remuxAudio(e,t,r,s,i){const o=e.inputTimeScale,l=e.samplerate?e.samplerate:o,c=o/l,d=this.getSamplesPerFrame(e),f=d*c,h=this._initPTS,p=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,v=[],g=i!==void 0;let S=e.samples,x=p?0:8,b=this.nextAudioTs||-1;const A=h.baseTime*o/h.timescale,L=A+t*o;if(this.isAudioContiguous=r=r||S.length&&b>0&&(s&&Math.abs(L-(b+A))<9e3||Math.abs(bn(S[0].pts,L)-(b+A))<20*f),S.forEach(function(q){q.pts=bn(q.pts,L)}),!r||b<0){const q=S.length;if(S=S.filter(te=>te.pts>=0),q!==S.length&&this.warn(`Removed ${S.length-q} of ${q} samples (initPTS ${A} / ${o})`),!S.length)return;i===0?b=0:s&&!g?b=Math.max(0,L-A):b=S[0].pts-A}if(e.segmentCodec==="aac"){const q=this.config.maxAudioFramesDrift;for(let te=0,G=b+A;te<S.length;te++){const Q=S[te],ee=Q.pts,D=ee-G,$=Math.abs(1e3*D/o);if(D<=-q*f&&g)te===0&&(this.warn(`Audio frame @ ${(ee/o).toFixed(3)}s overlaps marker by ${Math.round(1e3*D/o)} ms.`),this.nextAudioTs=b=ee-A,G=ee);else if(D>=q*f&&$<HF&&g){let ie=Math.round(D/f);for(G=ee-ie*f;G<0&&ie&&f;)ie--,G+=f;te===0&&(this.nextAudioTs=b=G-A),this.warn(`Injecting ${ie} audio frames @ ${((G-A)/o).toFixed(3)}s due to ${Math.round(1e3*D/o)} ms gap.`);for(let ue=0;ue<ie;ue++){let ce=jF.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);ce||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),ce=Q.unit.subarray()),S.splice(te,0,{unit:ce,pts:G}),G+=f,te++}}Q.pts=G,G+=f}}let I=null,k=null,F,C=0,P=S.length;for(;P--;)C+=S[P].unit.byteLength;for(let q=0,te=S.length;q<te;q++){const G=S[q],Q=G.unit;let ee=G.pts;if(k!==null){const $=v[q-1];$.duration=Math.round((ee-k)/c)}else if(r&&e.segmentCodec==="aac"&&(ee=b+A),I=ee,C>0){C+=x;try{F=new Uint8Array(C)}catch($){this.observer.emit(R.ERROR,R.ERROR,{type:we.MUX_ERROR,details:z.REMUX_ALLOC_ERROR,fatal:!1,error:$,bytes:C,reason:`fail allocating audio mdat ${C}`});return}p||(new DataView(F.buffer).setUint32(0,C),F.set(K.types.mdat,4))}else return;F.set(Q,x);const D=Q.byteLength;x+=D,v.push(wS(!0,d,D,0)),k=ee}const O=v.length;if(!O)return;const M=v[v.length-1];b=k-A,this.nextAudioTs=b+c*M.duration;const H=p?new Uint8Array(0):K.moof(e.sequenceNumber++,I/c,et({},e,{samples:v}));e.samples=[];const Z=(I-A)/o,se=this.nextAudioTs/o,ne={data1:H,data2:F,startPTS:Z,endPTS:se,startDTS:Z,endDTS:se,type:"audio",hasAudio:!0,hasVideo:!1,nb:O};return this.isAudioContiguous=!0,ne}}function bn(n,e){let t;if(e===null)return n;for(e<n?t=-8589934592:t=8589934592;Math.abs(n-e)>4294967296;)n+=t;return n}function YF(n){for(let e=0;e<n.length;e++)if(n[e].key)return e;return-1}function Gw(n,e,t,r){const s=n.samples.length;if(!s)return;const i=n.inputTimeScale;for(let l=0;l<s;l++){const c=n.samples[l];c.pts=bn(c.pts-t.baseTime*i/t.timescale,e*i)/i,c.dts=bn(c.dts-r.baseTime*i/r.timescale,e*i)/i}const o=n.samples;return n.samples=[],{samples:o}}function Hw(n,e,t){const r=n.samples.length;if(!r)return;const s=n.inputTimeScale;for(let o=0;o<r;o++){const l=n.samples[o];l.pts=bn(l.pts-t.baseTime*s/t.timescale,e*s)/s}n.samples.sort((o,l)=>o.pts-l.pts);const i=n.samples;return n.samples=[],{samples:i}}class qF extends $n{constructor(e,t,r,s){super("passthrough-remuxer",s),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,r,s){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(e,s),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:r,videoCodec:s}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:i,video:o}=this.initData=Xb(e);if(t)M2(e,t);else{const c=i||o;c!=null&&c.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${c.codec}")!`)}i&&(r=AS(i,tt.AUDIO,this)),o&&(s=AS(o,tt.VIDEO,this));const l={};i&&o?l.audiovideo={container:"video/mp4",codec:r+","+s,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:i?l.audio={container:"audio/mp4",codec:r,encrypted:i.encrypted,initSegment:e,id:"audio"}:o?l.video={container:"video/mp4",codec:s,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=l}remux(e,t,r,s,i,o){var l,c;let{initPTS:d,lastEndTime:f}=this;const h={audio:void 0,video:void 0,text:s,id3:r,initSegment:void 0};he(f)||(f=this.lastEndTime=i||0);const p=t.samples;if(!p.length)return h;const v={initPTS:void 0,timescale:void 0,trackId:void 0};let g=this.initData;if((l=g)!=null&&l.length||(this.generateInitSegment(p),g=this.initData),!((c=g)!=null&&c.length))return this.warn("Failed to generate initSegment."),h;this.emitInitSegment&&(v.tracks=this.initTracks,this.emitInitSegment=!1);const S=B2(p,g,this),x=g.audio?S[g.audio.id]:null,b=g.video?S[g.video.id]:null,A=Tu(b,1/0),L=Tu(x,1/0),I=Tu(b,0,!0),k=Tu(x,0,!0);let F=i,C=0;const P=x&&(!b||!d&&L<A||d&&d.trackId===g.audio.id),O=P?x:b;if(O){const G=O.timescale,Q=O.start-i*G,ee=P?g.audio.id:g.video.id;F=O.start/G,C=P?k-L:I-A,(o||!d)&&(XF(d,F,i,C)||G!==d.timescale)&&(d&&this.warn(`Timestamps at playlist time: ${o?"":"~"}${i} ${Q/G} != initPTS: ${d.baseTime/d.timescale} (${d.baseTime}/${d.timescale}) trackId: ${d.trackId}`),this.log(`Found initPTS at playlist time: ${i} offset: ${F-i} (${Q}/${G}) trackId: ${ee}`),d=null,v.initPTS=Q,v.timescale=G,v.trackId=ee)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${i}`);d?(v.initPTS=d.baseTime,v.timescale=d.timescale,v.trackId=d.trackId):((!v.timescale||v.trackId===void 0||v.initPTS===void 0)&&(this.warn("Could not set initPTS"),v.initPTS=F,v.timescale=1,v.trackId=-1),this.initPTS=d={baseTime:v.initPTS,timescale:v.timescale,trackId:v.trackId});const M=F-d.baseTime/d.timescale,H=M+C;C>0?this.lastEndTime=H:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const Z=!!g.audio,se=!!g.video;let U="";Z&&(U+="audio"),se&&(U+="video");const ne=(g.audio?g.audio.encrypted:!1)||(g.video?g.video.encrypted:!1),q={data1:p,startPTS:M,startDTS:M,endPTS:H,endDTS:H,type:U,hasAudio:Z,hasVideo:se,nb:1,dropped:0,encrypted:ne};h.audio=Z&&!se?q:void 0,h.video=se?q:void 0;const te=b?.sampleCount;if(te){const G=b.keyFrameIndex,Q=G!==-1;q.nb=te,q.dropped=G===0||this.isVideoContiguous?0:Q?G:te,q.independent=Q,q.firstKeyFrame=G,Q&&b.keyFrameStart&&(q.firstKeyFramePTS=(b.keyFrameStart-d.baseTime)/d.timescale),this.isVideoContiguous||(h.independent=Q),this.isVideoContiguous||(this.isVideoContiguous=Q),q.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${G}/${te} dropped: ${q.dropped} start: ${q.firstKeyFramePTS||"NA"}`)}return h.initSegment=v,h.id3=Gw(r,i,d,d),s.samples.length&&(h.text=Hw(s,i,d)),h}}function Tu(n,e,t=!1){return n?.start!==void 0?(n.start+(t?n.duration:0))/n.timescale:e}function XF(n,e,t,r){if(n===null)return!0;const s=Math.max(r,1),i=e-n.baseTime/n.timescale;return Math.abs(i-t)>s}function AS(n,e,t){const r=n.codec;return r&&r.length>4?r:e===tt.AUDIO?r==="ec-3"||r==="ac-3"||r==="alac"?r:r==="fLaC"||r==="Opus"?cc(r,!1):(t.warn(`Unhandled audio codec "${r}" in mp4 MAP`),r||"mp4a"):(t.warn(`Unhandled video codec "${r}" in mp4 MAP`),r||"avc1")}let Mr;try{Mr=self.performance.now.bind(self.performance)}catch{Mr=Date.now}const Ku=[{demux:OF,remux:qF},{demux:vs,remux:Hu},{demux:kF,remux:Hu},{demux:DF,remux:Hu}];Ku.splice(2,0,{demux:PF,remux:Hu});class LS{constructor(e,t,r,s,i,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.id=i,this.logger=o}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,r,s){const i=r.transmuxing;i.executeStart=Mr();let o=new Uint8Array(e);const{currentTransmuxState:l,transmuxConfig:c}=this;s&&(this.currentTransmuxState=s);const{contiguous:d,discontinuity:f,trackSwitch:h,accurateTimeOffset:p,timeOffset:v,initSegmentChange:g}=s||l,{audioCodec:S,videoCodec:x,defaultInitPts:b,duration:A,initSegmentData:L}=c,I=QF(o,t);if(I&&Ki(I.method)){const P=this.getDecrypter(),O=Up(I.method);if(P.isSync()){let M=P.softwareDecrypt(o,I.key.buffer,I.iv.buffer,O);if(r.part>-1){const Z=P.flush();M=Z&&Z.buffer}if(!M)return i.executeEnd=Mr(),Ah(r);o=new Uint8Array(M)}else return this.asyncResult=!0,this.decryptionPromise=P.webCryptoDecrypt(o,I.key.buffer,I.iv.buffer,O).then(M=>{const H=this.push(M,null,r);return this.decryptionPromise=null,H}),this.decryptionPromise}const k=this.needsProbing(f,h);if(k){const P=this.configureTransmuxer(o);if(P)return this.logger.warn(`[transmuxer] ${P.message}`),this.observer.emit(R.ERROR,R.ERROR,{type:we.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!1,error:P,reason:P.message}),i.executeEnd=Mr(),Ah(r)}(f||h||g||k)&&this.resetInitSegment(L,S,x,A,t),(f||g||k)&&this.resetInitialTimestamp(b),d||this.resetContiguity();const F=this.transmux(o,I,v,p,r);this.asyncResult=Pa(F);const C=this.currentTransmuxState;return C.contiguous=!0,C.discontinuity=!1,C.trackSwitch=!1,i.executeEnd=Mr(),F}flush(e){const t=e.transmuxing;t.executeStart=Mr();const{decrypter:r,currentTransmuxState:s,decryptionPromise:i}=this;if(i)return this.asyncResult=!0,i.then(()=>this.flush(e));const o=[],{timeOffset:l}=s;if(r){const h=r.flush();h&&o.push(this.push(h.buffer,null,e))}const{demuxer:c,remuxer:d}=this;if(!c||!d){t.executeEnd=Mr();const h=[Ah(e)];return this.asyncResult?Promise.resolve(h):h}const f=c.flush(l);return Pa(f)?(this.asyncResult=!0,f.then(h=>(this.flushRemux(o,h,e),o))):(this.flushRemux(o,f,e),this.asyncResult?Promise.resolve(o):o)}flushRemux(e,t,r){const{audioTrack:s,videoTrack:i,id3Track:o,textTrack:l}=t,{accurateTimeOffset:c,timeOffset:d}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${r.sn}${r.part>-1?" part: "+r.part:""} of ${this.id===ge.MAIN?"level":"track"} ${r.level}`);const f=this.remuxer.remux(s,i,o,l,d,c,!0,this.id);e.push({remuxResult:f,chunkMeta:r}),r.transmuxing.executeEnd=Mr()}resetInitialTimestamp(e){const{demuxer:t,remuxer:r}=this;!t||!r||(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,s,i){const{demuxer:o,remuxer:l}=this;!o||!l||(o.resetInitSegment(e,t,r,s),l.resetInitSegment(e,t,r,i))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,s,i){let o;return t&&t.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,t,r,s,i):o=this.transmuxUnencrypted(e,r,s,i),o}transmuxUnencrypted(e,t,r,s){const{audioTrack:i,videoTrack:o,id3Track:l,textTrack:c}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(i,o,l,c,t,r,!1,this.id),chunkMeta:s}}transmuxSampleAes(e,t,r,s,i){return this.demuxer.demuxSampleAes(e,t,r).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,r,s,!1,this.id),chunkMeta:i}))}configureTransmuxer(e){const{config:t,observer:r,typeSupported:s}=this;let i;for(let h=0,p=Ku.length;h<p;h++){var o;if((o=Ku[h].demux)!=null&&o.probe(e,this.logger)){i=Ku[h];break}}if(!i)return new Error("Failed to find demuxer by probing fragment data");const l=this.demuxer,c=this.remuxer,d=i.remux,f=i.demux;(!c||!(c instanceof d))&&(this.remuxer=new d(r,t,s,this.logger)),(!l||!(l instanceof f))&&(this.demuxer=new f(r,t,s,this.logger),this.probe=f.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Fp(this.config)),e}}function QF(n,e){let t=null;return n.byteLength>0&&e?.key!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Ah=n=>({remuxResult:{},chunkMeta:n});function Pa(n){return"then"in n&&n.then instanceof Function}class JF{constructor(e,t,r,s,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=s,this.defaultInitPts=i||null}}class ZF{constructor(e,t,r,s,i,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=s,this.timeOffset=i,this.initSegmentChange=o}}let RS=0;class Kw{constructor(e,t,r,s){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=RS++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=c=>{const d=c.data,f=this.hls;if(!(!f||!(d!=null&&d.event)||d.instanceNo!==this.instanceNo))switch(d.event){case"init":{var h;const p=(h=this.workerContext)==null?void 0:h.objectURL;p&&self.URL.revokeObjectURL(p);break}case"transmuxComplete":{this.handleTransmuxComplete(d.data);break}case"flush":{this.onFlush(d.data);break}case"workerLog":{f.logger[d.data.logType]&&f.logger[d.data.logType](d.data.message);break}default:{d.data=d.data||{},d.data.frag=this.frag,d.data.part=this.part,d.data.id=this.id,f.trigger(d.event,d.data);break}}},this.onWorkerError=c=>{if(!this.hls)return;const d=new Error(`${c.message}  (${c.filename}:${c.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(R.ERROR,{type:we.OTHER_ERROR,details:z.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:d})};const i=e.config;this.hls=e,this.id=t,this.useWorker=!!i.enableWorker,this.onTransmuxComplete=r,this.onFlush=s;const o=(c,d)=>{d=d||{},d.frag=this.frag||void 0,c===R.ERROR&&(d=d,d.parent=this.id,d.part=this.part,this.error=d.error),this.hls.trigger(c,d)};this.observer=new Vp,this.observer.on(R.FRAG_DECRYPTED,o),this.observer.on(R.ERROR,o);const l=Vx(i.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const c=this.hls.logger;if(i.workerPath||rF()){try{i.workerPath?(c.log(`loading Web Worker ${i.workerPath} for "${t}"`),this.workerContext=iF(i.workerPath)):(c.log(`injecting Web Worker for "${t}"`),this.workerContext=sF());const{worker:f}=this.workerContext;f.addEventListener("message",this.onWorkerMessage),f.addEventListener("error",this.onWorkerError),f.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:l,id:t,config:nt(i)})}catch(f){c.warn(`Error setting up "${t}" Web Worker, fallback to inline`,f),this.terminateWorker(),this.error=null,this.transmuxer=new LS(this.observer,l,i,"",t,e.logger)}return}}this.transmuxer=new LS(this.observer,l,i,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=RS++;const t=this.hls.config,r=Vx(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:r,id:this.id,config:nt(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),oF(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,r,s,i,o,l,c,d,f){var h,p;d.transmuxing.start=self.performance.now();const{instanceNo:v,transmuxer:g}=this,S=o?o.start:i.start,x=i.decryptdata,b=this.frag,A=!(b&&i.cc===b.cc),L=!(b&&d.level===b.level),I=b?d.sn-b.sn:-1,k=this.part?d.part-this.part.index:-1,F=I===0&&d.id>1&&d.id===b?.stats.chunkCount,C=!L&&(I===1||I===0&&(k===1||F&&k<=0)),P=self.performance.now();(L||I||i.stats.parsing.start===0)&&(i.stats.parsing.start=P),o&&(k||!C)&&(o.stats.parsing.start=P);const O=!(b&&((h=i.initSegment)==null?void 0:h.url)===((p=b.initSegment)==null?void 0:p.url)),M=new ZF(A,C,c,L,S,O);if(!C||A||O){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${i.type} sn: ${d.sn}${d.part>-1?" part: "+d.part:""} ${this.id===ge.MAIN?"level":"track"}: ${d.level} id: ${d.id}
        discontinuity: ${A}
        trackSwitch: ${L}
        contiguous: ${C}
        accurateTimeOffset: ${c}
        timeOffset: ${S}
        initSegmentChange: ${O}`);const H=new JF(r,s,t,l,f);this.configureTransmuxer(H)}if(this.frag=i,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:v,cmd:"demux",data:e,decryptdata:x,chunkMeta:d,state:M},e instanceof ArrayBuffer?[e]:[]);else if(g){const H=g.push(e,x,d,M);Pa(H)?H.then(Z=>{this.handleTransmuxComplete(Z)}).catch(Z=>{this.transmuxerError(Z,d,"transmuxer-interface push error")}):this.handleTransmuxComplete(H)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:r}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(r){const s=r.flush(e);Pa(s)?s.then(i=>{this.handleFlushResult(i,e)}).catch(i=>{this.transmuxerError(i,e,"transmuxer-interface flush error")}):this.handleFlushResult(s,e)}}transmuxerError(e,t,r){this.hls&&(this.error=e,this.hls.trigger(R.ERROR,{type:we.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach(r=>{this.handleTransmuxComplete(r)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:r}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):r&&r.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const IS=100;class eB extends jp{constructor(e,t,r){super(e,t,r,"audio-stream-controller",ge.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(R.LEVEL_LOADED,this.onLevelLoaded,this),e.on(R.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(R.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(R.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(R.BUFFER_RESET,this.onBufferReset,this),e.on(R.BUFFER_CREATED,this.onBufferCreated,this),e.on(R.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(R.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(R.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(R.FRAG_LOADING,this.onFragLoading,this),e.on(R.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(R.LEVEL_LOADED,this.onLevelLoaded,this),e.off(R.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(R.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(R.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(R.BUFFER_RESET,this.onBufferReset,this),e.off(R.BUFFER_CREATED,this.onBufferCreated,this),e.off(R.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(R.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(R.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(R.FRAG_LOADING,this.onFragLoading,this),e.off(R.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:r,initPTS:s,timescale:i,trackId:o}){if(r===ge.MAIN){const l=t.cc,c=this.fragCurrent;if(this.initPTS[l]={baseTime:s,timescale:i,trackId:o},this.log(`InitPTS for cc: ${l} found from main: ${s/i} (${s}/${i}) trackId: ${o}`),this.mainAnchor=t,this.state===re.WAITING_INIT_PTS){const d=this.waitingData;(!d&&!this.loadingParts||d&&d.frag.cc!==l)&&this.syncWithAnchor(t,d?.frag)}else!this.hls.hasEnoughToStart&&c&&c.cc!==l?(c.abortRequests(),this.syncWithAnchor(t,c)):this.state===re.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var r;const s=((r=this.mainFragLoading)==null?void 0:r.frag)||null;if(t&&s?.cc===t.cc)return;const i=(s||e).cc,o=this.getLevelDetails(),l=this.getLoadPosition(),c=aw(o,i,l);c&&(this.log(`Syncing with main frag at ${c.start} cc ${c.cc}`),this.startFragRequested=!1,this.nextLoadPosition=c.start,this.resetLoadingState(),this.state===re.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=re.STOPPED;return}const r=this.lastCurrentTime;this.stopLoad(),this.setInterval(IS),r>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r,this.state=re.IDLE):this.state=re.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case re.IDLE:this.doTickIdle();break;case re.WAITING_TRACK:{const{levels:e,trackId:t}=this,r=e?.[t],s=r?.details;if(s&&!this.waitForLive(r)){if(this.waitForCdnTuneIn(s))break;this.state=re.WAITING_INIT_PTS}break}case re.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case re.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:r,cache:s,complete:i}=e,o=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=re.FRAG_LOADING;const l=s.flush().buffer,c={frag:t,part:r,payload:l,networkDetails:null};this._handleFragmentLoadProgress(c),i&&super._handleFragmentLoadComplete(c)}else o&&o.cc!==e.frag.cc&&this.syncWithAnchor(o,e.frag)}else this.state=re.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:r,media:s,trackId:i}=this,o=t.config;if(!this.buffering||!s&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(r!=null&&r[i]))return;const l=r[i],c=l.details;if(!c||this.waitForLive(l)||this.waitForCdnTuneIn(c)){this.state=re.WAITING_TRACK,this.startFragRequested=!1;return}const d=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&d&&(this.bufferFlushed=!1,this.afterBufferFlushed(d,tt.AUDIO,ge.AUDIO));const f=this.getFwdBufferInfo(d,ge.AUDIO);if(f===null)return;if(!this.switchingTrack&&this._streamEnded(f,c)){t.trigger(R.BUFFER_EOS,{type:"audio"}),this.state=re.ENDED;return}const h=f.len,p=t.maxBufferLength,v=c.fragments,g=v[0].start,S=this.getLoadPosition(),x=this.flushing?S:f.end;if(this.switchingTrack&&s){const L=S;c.PTSKnown&&L<g&&(f.end>g||f.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),s.currentTime=g+.05)}if(h>=p&&!this.switchingTrack&&x<v[v.length-1].start)return;let b=this.getNextFragment(x,c);if(b&&this.isLoopLoading(b,x)&&(b=this.getNextFragmentLoopLoading(b,c,f,ge.MAIN,p)),!b){this.bufferFlushed=!0;return}let A=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&A&&Et(b)&&!b.endList&&(!c.live||!this.loadingParts&&x<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(A)===_t.OK&&(this.mainFragLoading=A=null),A&&Et(A))){if(b.start>A.end){const I=this.fragmentTracker.getFragAtPos(x,ge.MAIN);I&&I.end>A.end&&(A=I,this.mainFragLoading={frag:I,targetBufferTime:null})}if(b.start>A.end)return}this.loadFragment(b,l,x)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(r=>new _a(r))}onAudioTrackSwitching(e,t){const r=!!t.url;this.trackId=t.id;const{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),r?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==re.STOPPED&&(this.setInterval(IS),this.state=re.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const r=this.cachedTrackLoadedData;r&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(R.AUDIO_TRACK_LOADED,r))}onAudioTrackLoaded(e,t){var r;const{levels:s}=this,{details:i,id:o,groupId:l,track:c}=t;if(!s){this.warn(`Audio tracks reset while loading track ${o} "${c.name}" of "${l}"`);return}const d=this.mainDetails;if(!d||i.endCC>d.endCC||d.expired){this.cachedTrackLoadedData=t,this.state!==re.STOPPED&&(this.state=re.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${c.name}" of "${l}" loaded [${i.startSN},${i.endSN}]${i.lastPartSn?`[part-${i.lastPartSn}-${i.lastPartIndex}]`:""},duration:${i.totalduration}`);const f=s[o];let h=0;if(i.live||(r=f.details)!=null&&r.live){if(this.checkLiveUpdate(i),i.deltaUpdateFailed)return;if(f.details){var p;h=this.alignPlaylists(i,f.details,(p=this.levelLastLoaded)==null?void 0:p.details)}i.alignedSliding||(Aw(i,d),i.alignedSliding||yc(i,d),h=i.fragmentStart)}f.details=i,this.levelLastLoaded=f,this.startFragRequested||this.setStartPosition(d,h),this.hls.trigger(R.AUDIO_TRACK_UPDATED,{details:i,id:o,groupId:t.groupId}),this.state===re.WAITING_TRACK&&!this.waitForCdnTuneIn(i)&&(this.state=re.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:s,payload:i}=e,{config:o,trackId:l,levels:c}=this;if(!c){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const d=c[l];if(!d){this.warn("Audio track is undefined on fragment load progress");return}const f=d.details;if(!f){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(r.start);return}const h=o.defaultAudioCodec||d.audioCodec||"mp4a.40.2";let p=this.transmuxer;p||(p=this.transmuxer=new Kw(this.hls,ge.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const v=this.initPTS[r.cc],g=(t=r.initSegment)==null?void 0:t.data;if(v!==void 0){const x=s?s.index:-1,b=x!==-1,A=new Bp(r.level,r.sn,r.stats.chunkCount,i.byteLength,x,b);p.push(i,g,h,"",r,s,f.totalduration,!1,A,v)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${f.startSN} ,${f.endSN}],track ${l}`);const{cache:S}=this.waitingData=this.waitingData||{frag:r,part:s,cache:new Lw,complete:!1};S.push(new Uint8Array(i)),this.state!==re.STOPPED&&(this.state=re.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===ge.MAIN&&Et(t.frag)&&(this.mainFragLoading=t,this.state===re.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:r,part:s}=t;if(r.type!==ge.AUDIO){!this.audioOnly&&r.type===ge.MAIN&&!r.elementaryStreams.video&&!r.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${s?" p: "+s.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Et(r)){this.fragPrevious=r;const i=this.switchingTrack;i&&(this.bufferedTrack=i,this.switchingTrack=null,this.hls.trigger(R.AUDIO_TRACK_SWITCHED,Je({},i)))}this.fragBufferedComplete(r,s),this.media&&this.tick()}onError(e,t){var r;if(t.fatal){this.state=re.ERROR;return}switch(t.details){case z.FRAG_GAP:case z.FRAG_PARSING_ERROR:case z.FRAG_DECRYPT_ERROR:case z.FRAG_LOAD_ERROR:case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_ERROR:case z.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ge.AUDIO,t);break;case z.AUDIO_TRACK_LOAD_ERROR:case z.AUDIO_TRACK_LOAD_TIMEOUT:case z.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===re.WAITING_TRACK&&((r=t.context)==null?void 0:r.type)===Ge.AUDIO_TRACK&&(this.state=re.IDLE);break;case z.BUFFER_ADD_CODEC_ERROR:case z.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case z.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case z.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==tt.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==tt.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===re.ENDED&&(this.state=re.IDLE);const r=this.mediaBuffer||this.media;r&&(this.afterBufferFlushed(r,t,ge.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const r="audio",{hls:s}=this,{remuxResult:i,chunkMeta:o}=e,l=this.getCurrentContext(o);if(!l){this.resetWhenMissingContext(o);return}const{frag:c,part:d,level:f}=l,{details:h}=f,{audio:p,text:v,id3:g,initSegment:S}=i;if(this.fragContextChanged(c)||!h){this.fragmentTracker.removeFragment(c);return}if(this.state=re.PARSING,this.switchingTrack&&p&&this.completeAudioSwitch(this.switchingTrack),S!=null&&S.tracks){const x=c.initSegment||c;if(this.unhandledEncryptionError(S,c))return;this._bufferInitSegment(f,S.tracks,x,o),s.trigger(R.FRAG_PARSING_INIT_SEGMENT,{frag:x,id:r,tracks:S.tracks})}if(p){const{startPTS:x,endPTS:b,startDTS:A,endDTS:L}=p;d&&(d.elementaryStreams[tt.AUDIO]={startPTS:x,endPTS:b,startDTS:A,endDTS:L}),c.setElementaryStreamInfo(tt.AUDIO,x,b,A,L),this.bufferFragmentData(p,c,d,o)}if(g!=null&&(t=g.samples)!=null&&t.length){const x=et({id:r,frag:c,details:h},g);s.trigger(R.FRAG_PARSING_METADATA,x)}if(v){const x=et({id:r,frag:c,details:h},v);s.trigger(R.FRAG_PARSING_USERDATA,x)}}_bufferInitSegment(e,t,r,s){if(this.state!==re.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const i=t.audio;i.id=ge.AUDIO;const o=e.audioCodec;this.log(`Init audio buffer, container:${i.container}, codecs[level/parsed]=[${o}/${i.codec}]`),o&&o.split(",").length===1&&(i.levelCodec=o),this.hls.trigger(R.BUFFER_CODECS,t);const l=i.initSegment;if(l!=null&&l.byteLength){const c={type:"audio",frag:r,part:null,chunkMeta:s,parent:r.type,data:l};this.hls.trigger(R.BUFFER_APPENDING,c)}this.tickImmediate()}loadFragment(e,t,r){const s=this.fragmentTracker.getState(e);if(this.switchingTrack||s===_t.NOT_LOADED||s===_t.PARTIAL){var i;if(!Et(e))this._loadInitSegment(e,t);else if((i=t.details)!=null&&i.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=re.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragmentStart!==t.details.fragmentStart&&yc(t.details,o)}else super.loadFragment(e,t,r)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:r,assocLang:s,characteristics:i,audioCodec:o,channels:l}=this.bufferedTrack;ni({name:t,lang:r,assocLang:s,characteristics:i,audioCodec:o,channels:l},e,qs)||(fc(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(R.AUDIO_TRACK_SWITCHED,Je({},e))}}class qp extends $n{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,r){const s=t?.renditionReports;if(s){let i=-1;for(let o=0;o<s.length;o++){const l=s[o];let c;try{c=new self.URL(l.URI,t.url).href}catch(d){this.warn(`Could not construct new URL for Rendition Report: ${d}`),c=l.URI||""}if(c===e){i=o;break}else c===e.substring(0,c.length)&&(i=o)}if(i!==-1){const o=s[i],l=parseInt(o["LAST-MSN"])||t.lastPartSn;let c=parseInt(o["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const f=Math.min(t.age-t.partTarget,t.targetduration);c>=0&&f>t.partTarget&&(c+=1)}const d=r&&Gx(r);return new Hx(l,c>=0?c:void 0,d)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(r){this.warn(`Could not construct new URL with HLS Delivery Directives: ${r}`)}return e}playlistLoaded(e,t,r){const{details:s,stats:i}=t,o=self.performance.now(),l=i.loading.first?Math.max(0,o-i.loading.first):0;s.advancedDateTime=Date.now()-l;const c=this.hls.config.timelineOffset;if(c!==s.appliedTimelineOffset){const f=Math.max(c||0,0);s.appliedTimelineOffset=f,s.fragments.forEach(h=>{h.setStart(h.playlistOffset+f)})}if(s.live||r!=null&&r.live){const f="levelInfo"in t?t.levelInfo:t.track;if(s.reloaded(r),r&&s.fragments.length>0){zM(r,s,this);const A=s.playlistParsingError;if(A){this.warn(A);const L=this.hls;if(!L.config.ignorePlaylistParsingErrors){var d;const{networkDetails:I}=t;L.trigger(R.ERROR,{type:we.NETWORK_ERROR,details:z.LEVEL_PARSING_ERROR,fatal:!1,url:s.url,error:A,reason:A.message,level:t.level||void 0,parent:(d=s.fragments[0])==null?void 0:d.type,networkDetails:I,stats:i});return}s.playlistParsingError=null}}s.requestScheduled===-1&&(s.requestScheduled=i.loading.start);const h=this.hls.mainForwardBufferInfo,p=h?h.end-h.len:0,v=(s.edge-p)*1e3,g=Sw(s,v);if(s.requestScheduled+g<o?s.requestScheduled=o:s.requestScheduled+=g,this.log(`live playlist ${e} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:s.updated?"UPDATED":"MISSED"}`),!this.canLoad||!s.live)return;let S,x,b;if(s.canBlockReload&&s.endSN&&s.advanced){const A=this.hls.config.lowLatencyMode,L=s.lastPartSn,I=s.endSN,k=s.lastPartIndex,F=k!==-1,C=L===I;F?C?(x=I+1,b=A?0:k):(x=L,b=A?k+1:s.maxPartIndex):x=I+1;const P=s.age,O=P+s.ageHeader;let M=Math.min(O-s.partTarget,s.targetduration*1.5);if(M>0){if(O>s.targetduration*3)this.log(`Playlist last advanced ${P.toFixed(2)}s ago. Omitting segment and part directives.`),x=void 0,b=void 0;else if(r!=null&&r.tuneInGoal&&O-s.partTarget>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${M} with playlist age: ${s.age}`),M=0;else{const H=Math.floor(M/s.targetduration);if(x+=H,b!==void 0){const Z=Math.round(M%s.targetduration/s.partTarget);b+=Z}this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${P.toFixed(2)}s goal: ${M} skip sn ${H} to part ${b}`)}s.tuneInGoal=M}if(S=this.getDeliveryDirectives(s,t.deliveryDirectives,x,b),A||!C){s.requestScheduled=o,this.loadingPlaylist(f,S);return}}else(s.canBlockReload||s.canSkipUntil)&&(S=this.getDeliveryDirectives(s,t.deliveryDirectives,x,b));S&&x!==void 0&&s.canBlockReload&&(s.requestScheduled=i.loading.first+Math.max(g-l*2,g/2)),this.scheduleLoading(f,S,s)}else this.clearTimer()}scheduleLoading(e,t,r){const s=r||e.details;if(!s){this.loadingPlaylist(e,t);return}const i=self.performance.now(),o=s.requestScheduled;if(i>=o){this.loadingPlaylist(e,t);return}const l=o-i;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(l)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),l)}getDeliveryDirectives(e,t,r,s){let i=Gx(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,s=t.part,i=Vu.No),new Hx(r,s,i)}checkRetry(e){const t=e.details,r=hc(e),s=e.errorAction,{action:i,retryCount:o=0,retryConfig:l}=s||{},c=!!s&&!!l&&(i===Bt.RetryRequest||!s.resolved&&i===Bt.SendAlternateToPenaltyBox);if(c){var d;if(o>=l.maxNumRetry)return!1;if(r&&(d=e.context)!=null&&d.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${l.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const f=Mp(l,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),f),this.warn(`Retrying playlist loading ${o+1}/${l.maxNumRetry} after "${t}" in ${f}ms`)}e.levelRetry=!0,s.resolved=!0}return c}}function zw(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!Da(n[t].attrs,e[t].attrs))return!1;return!0}function Da(n,e,t){const r=n["STABLE-RENDITION-ID"];return r&&!t?r===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(s=>n[s]!==e[s])}function Dm(n,e){return e.label.toLowerCase()===n.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(n.lang||"").toLowerCase())}class tB extends qp{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.MANIFEST_PARSED,this.onManifestParsed,this),e.on(R.LEVEL_LOADING,this.onLevelLoading,this),e.on(R.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(R.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(R.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.MANIFEST_PARSED,this.onManifestParsed,this),e.off(R.LEVEL_LOADING,this.onLevelLoading,this),e.off(R.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(R.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(R.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:r,groupId:s,details:i}=t,o=this.tracksInGroup[r];if(!o||o.groupId!==s){this.warn(`Audio track with id:${r} and group:${s} not found in active group ${o?.groupId}`);return}const l=o.details;o.details=t.details,this.log(`Audio track ${r} "${o.name}" lang:${o.lang} group:${s} loaded [${i.startSN}-${i.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,l)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.audioGroups||null,s=this.groupIds;let i=this.currentTrack;if(!r||s?.length!==r?.length||r!=null&&r.some(l=>s?.indexOf(l)===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const l=this.tracks.filter(p=>!r||r.indexOf(p.groupId)!==-1);if(l.length)this.selectDefaultTrack&&!l.some(p=>p.default)&&(this.selectDefaultTrack=!1),l.forEach((p,v)=>{p.id=v});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=l;const c=this.hls.config.audioPreference;if(!i&&c){const p=mr(c,l,qs);if(p>-1)i=l[p];else{const v=mr(c,this.tracks);i=this.tracks[v]}}let d=this.findTrackId(i);d===-1&&i&&(d=this.findTrackId(null));const f={audioTracks:l};this.log(`Updating audio tracks, ${l.length} track(s) found in group(s): ${r?.join(",")}`),this.hls.trigger(R.AUDIO_TRACKS_UPDATED,f);const h=this.trackId;if(d!==-1&&h===-1)this.setAudioTrack(d);else if(l.length&&h===-1){var o;const p=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${l.length}`);this.warn(p.message),this.hls.trigger(R.ERROR,{type:we.MEDIA_ERROR,details:z.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:p})}}}onError(e,t){t.fatal||!t.context||t.context.type===Ge.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const r=this.allAudioTracks;if(this.selectDefaultTrack=!1,r.length){const s=this.currentTrack;if(s&&ni(e,s,qs))return s;const i=mr(e,this.tracksInGroup,qs);if(i>-1){const o=this.tracksInGroup[i];return this.setAudioTrack(i),o}else if(s){let o=t.loadLevel;o===-1&&(o=t.firstAutoLevel);const l=hM(e,t.levels,r,o,qs);if(l===-1)return null;t.nextLoadLevel=l}if(e.channels||e.audioCodec){const o=mr(e,r);if(o>-1)return r[o]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,s=t[e],i=s.details&&!s.details.live;if(e===this.trackId&&s===r&&i||(this.log(`Switching to audio-track ${e} "${s.name}" lang:${s.lang} group:${s.groupId} channels:${s.channels}`),this.trackId=e,this.currentTrack=s,this.hls.trigger(R.AUDIO_TRACK_SWITCHING,Je({},s)),i))return;const o=this.switchParams(s.url,r?.details,s.details);this.loadPlaylist(o)}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const s=t[r];if(!(this.selectDefaultTrack&&!s.default)&&(!e||ni(e,s,qs)))return r}if(e){const{name:r,lang:s,assocLang:i,characteristics:o,audioCodec:l,channels:c}=e;for(let d=0;d<t.length;d++){const f=t[d];if(ni({name:r,lang:s,assocLang:i,characteristics:o,audioCodec:l,channels:c},f,qs))return d}for(let d=0;d<t.length;d++){const f=t[d];if(Da(e.attrs,f.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return d}for(let d=0;d<t.length;d++){const f=t[d];if(Da(e.attrs,f.attrs,["LANGUAGE"]))return d}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&fc(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,s=e.groupId,i=this.getUrlWithDirectives(e.url,t),o=e.details,l=o?.age;this.log(`Loading audio-track ${r} "${e.name}" lang:${e.lang} group:${s}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${l&&o.live?" age "+l.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(R.AUDIO_TRACK_LOADING,{url:i,id:r,groupId:s,deliveryDirectives:t||null,track:e})}}class nB{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,r){if(this.queues===null||this.tracks===null)return;const s=this.queues[t];s.push(e),s.length===1&&!r&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const r={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(r,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const r={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(r)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const r=(t=e[0])==null?void 0:t.label;(r==="async-blocker"||r==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const s=t[0];try{s.execute()}catch(i){var r;if(s.onError(i),this.queues===null||this.tracks===null)return;const o=(r=this.tracks[e])==null?void 0:r.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,r;return(t=this.queues)!=null&&t[e]||(r=this.tracks)!=null&&r[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const r=(t=this.tracks)==null?void 0:t[e],s=r?.buffer;return s?`SourceBuffer${s.updating?" updating":""}${r.ended?" ended":""}${r.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(r=>r.label).join(", "))||""}}const _S=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Ww="HlsJsTrackRemovedError";class rB extends Error{constructor(e){super(e),this.name=Ww}}class sB extends $n{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=r=>{var s;this.hls&&((s=this.mediaSource)==null?void 0:s.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=r=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=r=>{const{media:s,mediaSource:i}=this;r&&this.log("Media source opened"),!(!s||!i)&&(i.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(R.MEDIA_ATTACHED,{media:s,mediaSource:i}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:r,_objectUrl:s}=this;r!==s&&this.error(`Media element src was set while attaching MediaSource (${s} > ${r})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=L2(Ls(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.MANIFEST_PARSED,this.onManifestParsed,this),e.on(R.BUFFER_RESET,this.onBufferReset,this),e.on(R.BUFFER_APPENDING,this.onBufferAppending,this),e.on(R.BUFFER_CODECS,this.onBufferCodecs,this),e.on(R.BUFFER_EOS,this.onBufferEos,this),e.on(R.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(R.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(R.FRAG_PARSED,this.onFragParsed,this),e.on(R.FRAG_CHANGED,this.onFragChanged,this),e.on(R.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.MANIFEST_PARSED,this.onManifestParsed,this),e.off(R.BUFFER_RESET,this.onBufferReset,this),e.off(R.BUFFER_APPENDING,this.onBufferAppending,this),e.off(R.BUFFER_CODECS,this.onBufferCodecs,this),e.off(R.BUFFER_EOS,this.onBufferEos,this),e.off(R.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(R.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(R.FRAG_PARSED,this.onFragParsed,this),e.off(R.FRAG_CHANGED,this.onFragChanged,this),e.off(R.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const r={};if(this.operationQueue){const i=this.isUpdating();i||this.operationQueue.removeBlockers();const o=this.isQueued();(i||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${i?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const s=this.transferData;return!this.sourceBufferCount&&s&&s.mediaSource===t?et(r,s.tracks):this.sourceBuffers.forEach(i=>{const[o]=i;o&&(r[o]=et({},this.tracks[o]),this.removeBuffer(o)),i[0]=i[1]=null}),{media:e,mediaSource:t,tracks:r}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var r;let s=2;(t.audio&&!t.video||!t.altAudio)&&(s=1),this.bufferCodecEventsTotal=s,this.log(`${s} bufferCodec event(s) expected.`),(r=this.transferData)!=null&&r.mediaSource&&this.sourceBufferCount&&s&&this.bufferCreated()}onMediaAttaching(e,t){const r=this.media=t.media;this.transferData=this.overrides=void 0;const s=Ls(this.appendSource);if(s){const i=!!t.mediaSource;(i||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const o=this.mediaSource=t.mediaSource||new s;if(this.assignMediaSource(o),i)this._objectUrl=r.src,this.attachTransferred();else{const l=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{r.removeAttribute("src");const c=self.ManagedMediaSource;r.disableRemotePlayback=r.disableRemotePlayback||c&&o instanceof c,CS(r),iB(r,l),r.load()}catch{r.src=l}else r.src=l}r.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,r;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(r=e.constructor)==null?void 0:r.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const r=this.tracks,s=t.tracks,i=s?Object.keys(s):null,o=i?i.length:0,l=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(s&&i&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${nt(r,(c,d)=>c==="initSegment"?void 0:d)};
transfer tracks: ${nt(s,(c,d)=>c==="initSegment"?void 0:d)}}`),!Gb(s,r)){t.mediaSource=null,t.tracks=void 0;const c=e.currentTime,d=this.details,f=Math.max(c,d?.fragments[0].start||0);if(f-c>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${c} -> ${f}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(s)}"->"${Object.keys(r)}") start time: ${f} currentTime: ${c}`),this.onMediaDetaching(R.MEDIA_DETACHING,{}),this.onMediaAttaching(R.MEDIA_ATTACHING,t),e.currentTime=f;return}this.transferData=void 0,i.forEach(c=>{const d=c,f=s[d];if(f){const h=f.buffer;if(h){const p=this.fragmentTracker,v=f.id;if(p.hasFragments(v)||p.hasParts(v)){const x=Oe.getBuffered(h);p.detectEvictedFragments(d,x,v,null,!0)}const g=Lh(d),S=[d,h];this.sourceBuffers[g]=S,h.updating&&this.operationQueue&&this.operationQueue.prependBlocker(d),this.trackSourceBuffer(d,f)}}}),l(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),l()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const r=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:s,mediaSource:i,_objectUrl:o}=this;if(i){if(this.log(`media source ${r?"transferring":"detaching"}`),r)this.sourceBuffers.forEach(([l])=>{l&&this.removeBuffer(l)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const l=i.readyState==="open";try{const c=i.sourceBuffers;for(let d=c.length;d--;)l&&c[d].abort(),i.removeSourceBuffer(c[d]);l&&i.endOfStream()}catch(c){this.warn(`onMediaDetaching: ${c.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(i.removeEventListener("startstreaming",this._onStartStreaming),i.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}s&&(s.removeEventListener("emptied",this._onMediaEmptied),r||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(s.removeAttribute("src"),this.appendSource&&CS(s),s.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(R.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const r=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),r)try{var s;(s=this.mediaSource)!=null&&s.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(r)}catch(i){this.warn(`onBufferReset ${e}`,i)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Lh(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new nB(this.tracks)}onBufferCodecs(e,t){var r;const s=this.tracks,i=Object.keys(t);this.log(`BUFFER_CODECS: "${i}" (current SB count ${this.sourceBufferCount})`);const o="audiovideo"in t&&(s.audio||s.video)||s.audiovideo&&("audio"in t||"video"in t),l=!o&&this.sourceBufferCount&&this.media&&i.some(c=>!s[c]);if(o||l){this.warn(`Unsupported transition between "${Object.keys(s)}" and "${i}" SourceBuffers`);return}i.forEach(c=>{var d,f;const h=t[c],{id:p,codec:v,levelCodec:g,container:S,metadata:x,supplemental:b}=h;let A=s[c];const L=(d=this.transferData)==null||(d=d.tracks)==null?void 0:d[c],I=L!=null&&L.buffer?L:A,k=I?.pendingCodec||I?.codec,F=I?.levelCodec;A||(A=s[c]={buffer:void 0,listeners:[],codec:v,supplemental:b,container:S,levelCodec:g,metadata:x,id:p});const C=ju(k,F),P=C?.replace(_S,"$1");let O=ju(v,g);const M=(f=O)==null?void 0:f.replace(_S,"$1");O&&C&&P!==M&&(c.slice(0,5)==="audio"&&(O=cc(O,this.appendSource)),this.log(`switching codec ${k} to ${O}`),O!==(A.pendingCodec||A.codec)&&(A.pendingCodec=O),A.container=S,this.appendChangeType(c,S,O))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((r=t.audio)==null?void 0:r.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const r=this.tracks[t];return e[t]={id:r.id,container:r.container,codec:r.codec,levelCodec:r.levelCodec},e},{})}appendChangeType(e,t,r){const s=`${t};codecs=${r}`,i={label:`change-type=${s}`,execute:()=>{const o=this.tracks[e];if(o){const l=o.buffer;l!=null&&l.changeType&&(this.log(`changing ${e} sourceBuffer type to ${s}`),l.changeType(s),o.codec=r,o.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${e} SourceBuffer type`,o)}};this.append(i,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const r=e.start,s=r+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(r,ge.MAIN))==null?void 0:t.gap)===!0)return;const o={label:"block-audio",execute:()=>{var l;const c=this.tracks.video;(this.lastVideoAppendEnd>s||c!=null&&c.buffer&&Oe.isBuffered(c.buffer,s)||((l=this.fragmentTracker.getAppendedFrag(s,ge.MAIN))==null?void 0:l.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:l=>{this.warn("Error executing block-audio operation",l)}};this.blockedAudioAppend={op:o,frag:e},this.append(o,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:r}=this,{data:s,type:i,parent:o,frag:l,part:c,chunkMeta:d,offset:f}=t,h=d.buffering[i],{sn:p,cc:v}=l,g=self.performance.now();h.start=g;const S=l.stats.buffering,x=c?c.stats.buffering:null;S.start===0&&(S.start=g),x&&x.start===0&&(x.start=g);const b=r.audio;let A=!1;i==="audio"&&b?.container==="audio/mpeg"&&(A=!this.lastMpegAudioChunk||d.id===1||this.lastMpegAudioChunk.sn!==d.sn,this.lastMpegAudioChunk=d);const L=r.video,I=L?.buffer;if(I&&p!=="initSegment"){const C=c||l,P=this.blockedAudioAppend;if(i==="audio"&&o!=="main"&&!this.blockedAudioAppend&&!(L.ending||L.ended)){const M=C.start+C.duration*.05,H=I.buffered,Z=this.currentOp("video");!H.length&&!Z?this.blockAudio(C):!Z&&!Oe.isBuffered(I,M)&&this.lastVideoAppendEnd<M&&this.blockAudio(C)}else if(i==="video"){const O=C.end;if(P){const M=P.frag.start;(O>M||O<this.lastVideoAppendEnd||Oe.isBuffered(I,M))&&this.unblockAudio()}this.lastVideoAppendEnd=O}}const k=(c||l).start,F={label:`append-${i}`,execute:()=>{var C;h.executeStart=self.performance.now();const P=(C=this.tracks[i])==null?void 0:C.buffer;P&&(A?this.updateTimestampOffset(P,k,.1,i,p,v):f!==void 0&&he(f)&&this.updateTimestampOffset(P,f,1e-6,i,p,v)),this.appendExecutor(s,i)},onStart:()=>{},onComplete:()=>{const C=self.performance.now();h.executeEnd=h.end=C,S.first===0&&(S.first=C),x&&x.first===0&&(x.first=C);const P={};this.sourceBuffers.forEach(([O,M])=>{O&&(P[O]=Oe.getBuffered(M))}),this.appendErrors[i]=0,i==="audio"||i==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(R.BUFFER_APPENDED,{type:i,frag:l,part:c,chunkMeta:d,parent:l.type,timeRanges:P})},onError:C=>{var P;const O={type:we.MEDIA_ERROR,parent:l.type,details:z.BUFFER_APPEND_ERROR,sourceBufferName:i,frag:l,part:c,chunkMeta:d,error:C,err:C,fatal:!1},M=(P=this.media)==null?void 0:P.error;if(C.code===DOMException.QUOTA_EXCEEDED_ERR||C.name=="QuotaExceededError"||"quota"in C)O.details=z.BUFFER_FULL_ERROR;else if(C.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!M)O.errorAction=Hi(!0);else if(C.name===Ww&&this.sourceBufferCount===0)O.errorAction=Hi(!0);else{const H=++this.appendErrors[i];this.warn(`Failed ${H}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${i}" sourceBuffer (${M||"no media error"})`),(H>=this.hls.config.appendErrorMaxRetry||M)&&(O.fatal=!0)}this.hls.trigger(R.ERROR,O)}};this.log(`queuing "${i}" append sn: ${p}${c?" p: "+c.index:""} of ${l.type===ge.MAIN?"level":"track"} ${l.level} cc: ${v}`),this.append(F,i,this.isPending(this.tracks[i]))}getFlushOp(e,t,r){return this.log(`queuing "${e}" remove ${t}-${r}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,r)},onStart:()=>{},onComplete:()=>{this.hls.trigger(R.BUFFER_FLUSHED,{type:e})},onError:s=>{this.warn(`Failed to remove ${t}-${r} from "${e}" SourceBuffer`,s)}}}onBufferFlushing(e,t){const{type:r,startOffset:s,endOffset:i}=t;r?this.append(this.getFlushOp(r,s,i),r):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,s,i),o)})}onFragParsed(e,t){const{frag:r,part:s}=t,i=[],o=s?s.elementaryStreams:r.elementaryStreams;o[tt.AUDIOVIDEO]?i.push("audiovideo"):(o[tt.AUDIO]&&i.push("audio"),o[tt.VIDEO]&&i.push("video"));const l=()=>{const c=self.performance.now();r.stats.buffering.end=c,s&&(s.stats.buffering.end=c);const d=s?s.stats:r.stats;this.hls.trigger(R.FRAG_BUFFERED,{frag:r,part:s,stats:d,id:r.type})};i.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers(l,i).catch(c=>{this.warn(`Fragment buffered callback ${c}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var r;this.sourceBuffers.forEach(([o])=>{if(o){const l=this.tracks[o];(!t.type||t.type===o)&&(l.ending=!0,l.ended||(l.ended=!0,this.log(`${o} buffer reached EOS`)))}});const s=((r=this.overrides)==null?void 0:r.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var l;return o&&!((l=this.tracks[o])!=null&&l.ended)})?s?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(R.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(R.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===z.BUFFER_APPEND_ERROR&&t.frag){var r;const s=(r=t.errorAction)==null?void 0:r.nextAutoLevel;he(s)&&s!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:r}=this;if(!r||t===null||!this.sourceBufferCount)return;const s=e.config,i=r.currentTime,o=t.levelTargetDuration,l=t.live&&s.liveBackBufferLength!==null?s.liveBackBufferLength:s.backBufferLength;if(he(l)&&l>=0){const d=Math.max(l,o),f=Math.floor(i/o)*o-d;this.flushBackBuffer(i,o,f)}const c=s.frontBufferFlushThreshold;if(he(c)&&c>0){const d=Math.max(s.maxBufferLength,c),f=Math.max(d,o),h=Math.floor(i/o)*o+f;this.flushFrontBuffer(i,o,h)}}flushBackBuffer(e,t,r){this.sourceBuffers.forEach(([s,i])=>{if(i){const l=Oe.getBuffered(i);if(l.length>0&&r>l.start(0)){var o;this.hls.trigger(R.BACK_BUFFER_REACHED,{bufferEnd:r});const c=this.tracks[s];if((o=this.details)!=null&&o.live)this.hls.trigger(R.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r});else if(c!=null&&c.ended){this.log(`Cannot flush ${s} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(R.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:s})}}})}flushFrontBuffer(e,t,r){this.sourceBuffers.forEach(([s,i])=>{if(i){const o=Oe.getBuffered(i),l=o.length;if(l<2)return;const c=o.start(l-1),d=o.end(l-1);if(r>c||e>=c&&e<=d)return;this.hls.trigger(R.BUFFER_FLUSHING,{startOffset:c,endOffset:1/0,type:s})}})}getDurationAndRange(){var e;const{details:t,mediaSource:r}=this;if(!t||!this.media||r?.readyState!=="open")return null;const s=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&r.setLiveSeekableRange){const d=Math.max(0,t.fragmentStart),f=Math.max(d,s);return{duration:1/0,start:d,end:f}}return{duration:1/0}}const i=(e=this.overrides)==null?void 0:e.duration;if(i)return he(i)?{duration:i}:null;const o=this.media.duration,l=he(r.duration)?r.duration:0;return s>l&&s>o||!he(o)?{duration:s}:null}updateMediaSource({duration:e,start:t,end:r}){const s=this.mediaSource;!this.media||!s||s.readyState!=="open"||(s.duration!==e&&(he(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),s.duration=e),t!==void 0&&r!==void 0&&(this.log(`MediaSource duration is set to ${s.duration}. Setting seekable range to ${t}-${r}.`),s.setLiveSeekableRange(t,r)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:r}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${nt(r)}`),this.tracksReady){var s;const i=(s=this.transferData)==null?void 0:s.tracks;i&&Object.keys(i).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,r])=>{if(t){const s=this.tracks[t];e[t]={buffer:r,container:s.container,codec:s.codec,supplemental:s.supplemental,levelCodec:s.levelCodec,id:s.id,metadata:s.metadata}}}),this.hls.trigger(R.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(R.ERROR,{type:we.MEDIA_ERROR,details:z.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:r}=this;if(!r)throw new Error("createSourceBuffers called when mediaSource was null");for(const i in e){const o=i,l=e[o];if(this.isPending(l)){const c=this.getTrackCodec(l,o),d=`${l.container};codecs=${c}`;l.codec=c,this.log(`creating sourceBuffer(${d})${this.currentOp(o)?" Queued":""} ${nt(l)}`);try{const f=r.addSourceBuffer(d),h=Lh(o),p=[o,f];t[h]=p,l.buffer=f}catch(f){var s;this.error(`error while trying to add sourceBuffer: ${f.message}`),this.shiftAndExecuteNext(o),(s=this.operationQueue)==null||s.removeBlockers(),delete this.tracks[o],this.hls.trigger(R.ERROR,{type:we.MEDIA_ERROR,details:z.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:f,sourceBufferName:o,mimeType:d,parent:l.id});return}this.trackSourceBuffer(o,l)}}this.bufferCreated()}getTrackCodec(e,t){const r=e.supplemental;let s=e.codec;r&&(t==="video"||t==="audiovideo")&&Ra(r,"video")&&(s=Y2(s,r));const i=ju(s,e.levelCodec);return i?t.slice(0,5)==="audio"?cc(i,this.appendSource):i:""}trackSourceBuffer(e,t){const r=t.buffer;if(!r)return;const s=this.getTrackCodec(t,e);this.tracks[e]={buffer:r,codec:s,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(i,o)=>{const l=o.removedRanges;l!=null&&l.length&&this.hls.trigger(R.BUFFER_FLUSHED,{type:i})})}get mediaSrc(){var e,t;const r=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return r?.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const r=this.currentOp(e);r&&(r.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var r;const s=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(r=this.mediaSource)==null?void 0:r.readyState}`);this.error(`${s}`,t),this.hls.trigger(R.ERROR,{type:we.MEDIA_ERROR,details:z.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:s,fatal:!1});const i=this.currentOp(e);i&&i.onError(s)}updateTimestampOffset(e,t,r,s,i,o){const l=t-e.timestampOffset;Math.abs(l)>=r&&(this.log(`Updating ${s} SourceBuffer timestampOffset to ${t} (sn: ${i} cc: ${o})`),e.timestampOffset=t)}removeExecutor(e,t,r){const{media:s,mediaSource:i}=this,o=this.tracks[e],l=o?.buffer;if(!s||!i||!l){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const c=he(s.duration)?s.duration:1/0,d=he(i.duration)?i.duration:1/0,f=Math.max(0,t),h=Math.min(r,c,d);h>f&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${f},${h}] from the ${e} SourceBuffer`),l.remove(f,h)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const r=this.tracks[t],s=r?.buffer;if(!s)throw new rB(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);r.ending=!1,r.ended=!1,s.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:r}=this,s=t.map(o=>this.appendBlocker(o));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(s).then(o=>{r===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var r;const s=(r=this.tracks[t])==null?void 0:r.buffer;!s||s.updating||this.shiftAndExecuteNext(t)})}append(e,t,r){this.operationQueue&&this.operationQueue.append(e,t,r)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,r){const s=this.tracks[e];if(!s)return;const i=s.buffer;if(!i)return;const o=r.bind(this,e);s.listeners.push({event:t,listener:o}),i.addEventListener(t,o)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const r=t.buffer;r&&(t.listeners.forEach(s=>{r.removeEventListener(s.event,s.listener)}),t.listeners.length=0)}}function CS(n){const e=n.querySelectorAll("source");[].slice.call(e).forEach(t=>{n.removeChild(t)})}function iB(n,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,n.appendChild(t)}function Lh(n){return n==="audio"?1:0}class Xp{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(R.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(R.MANIFEST_PARSED,this.onManifestParsed,this),e.on(R.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(R.BUFFER_CODECS,this.onBufferCodecs,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(R.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(R.MANIFEST_PARSED,this.onManifestParsed,this),e.off(R.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(R.BUFFER_CODECS,this.onBufferCodecs,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&he(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,r=this.getMaxLevel(e.length-1);r!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${r}: ${e[r].height}p@${e[r].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=r,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const r=t.filter((s,i)=>this.isLevelAllowed(s)&&i<=e);return this.clientRect=null,Xp.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,!t.width&&!t.height&&(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(r=>e.bitrate===r.bitrate&&e.width===r.width&&e.height===r.height)}static getMaxLevelByMediaSize(e,t,r){if(!(e!=null&&e.length))return-1;const s=(l,c)=>c?l.width!==c.width||l.height!==c.height:!0;let i=e.length-1;const o=Math.max(t,r);for(let l=0;l<e.length;l+=1){const c=e[l];if((c.width>=o||c.height>=o)&&s(c,e[l+1])){i=l;break}}return i}}const oB={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},an=oB,aB={HLS:"h"},lB=aB;class vr{constructor(e,t){Array.isArray(e)&&(e=e.map(r=>r instanceof vr?r:new vr(r))),this.value=e,this.params=t}}const uB="Dict";function cB(n){return Array.isArray(n)?JSON.stringify(n):n instanceof Map?"Map{}":n instanceof Set?"Set{}":typeof n=="object"?JSON.stringify(n):String(n)}function dB(n,e,t,r){return new Error(`failed to ${n} "${cB(e)}" as ${t}`,{cause:r})}function xr(n,e,t){return dB("serialize",n,e,t)}class Yw{constructor(e){this.description=e}}const kS="Bare Item",fB="Boolean";function hB(n){if(typeof n!="boolean")throw xr(n,fB);return n?"?1":"?0"}function mB(n){return btoa(String.fromCharCode(...n))}const pB="Byte Sequence";function gB(n){if(ArrayBuffer.isView(n)===!1)throw xr(n,pB);return`:${mB(n)}:`}const yB="Integer";function vB(n){return n<-999999999999999||999999999999999<n}function qw(n){if(vB(n))throw xr(n,yB);return n.toString()}function xB(n){return`@${qw(n.getTime()/1e3)}`}function Xw(n,e){if(n<0)return-Xw(-n,e);const t=Math.pow(10,e);if(Math.abs(n*t%1-.5)<Number.EPSILON){const s=Math.floor(n*t);return(s%2===0?s:s+1)/t}else return Math.round(n*t)/t}const SB="Decimal";function EB(n){const e=Xw(n,3);if(Math.floor(Math.abs(e)).toString().length>12)throw xr(n,SB);const t=e.toString();return t.includes(".")?t:`${t}.0`}const TB="String",bB=/[\x00-\x1f\x7f]+/;function wB(n){if(bB.test(n))throw xr(n,TB);return`"${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function AB(n){return n.description||n.toString().slice(7,-1)}const LB="Token";function PS(n){const e=AB(n);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw xr(e,LB);return e}function Nm(n){switch(typeof n){case"number":if(!he(n))throw xr(n,kS);return Number.isInteger(n)?qw(n):EB(n);case"string":return wB(n);case"symbol":return PS(n);case"boolean":return hB(n);case"object":if(n instanceof Date)return xB(n);if(n instanceof Uint8Array)return gB(n);if(n instanceof Yw)return PS(n);default:throw xr(n,kS)}}const RB="Key";function Om(n){if(/^[a-z*][a-z0-9\-_.*]*$/.test(n)===!1)throw xr(n,RB);return n}function Qp(n){return n==null?"":Object.entries(n).map(([e,t])=>t===!0?`;${Om(e)}`:`;${Om(e)}=${Nm(t)}`).join("")}function Qw(n){return n instanceof vr?`${Nm(n.value)}${Qp(n.params)}`:Nm(n)}function IB(n){return`(${n.value.map(Qw).join(" ")})${Qp(n.params)}`}function _B(n,e={whitespace:!0}){if(typeof n!="object"||n==null)throw xr(n,uB);const t=n instanceof Map?n.entries():Object.entries(n),r=e?.whitespace?" ":"";return Array.from(t).map(([s,i])=>{i instanceof vr||(i=new vr(i));let o=Om(s);return i.value===!0?o+=Qp(i.params):(o+="=",Array.isArray(i.value)?o+=IB(i):o+=Qw(i)),o}).join(`,${r}`)}function Jw(n,e){return _B(n,e)}const ur="CMCD-Object",yt="CMCD-Request",Hs="CMCD-Session",ms="CMCD-Status",CB={br:ur,ab:ur,d:ur,ot:ur,tb:ur,tpb:ur,lb:ur,tab:ur,lab:ur,url:ur,pb:yt,bl:yt,tbl:yt,dl:yt,ltc:yt,mtp:yt,nor:yt,nrr:yt,rc:yt,sn:yt,sta:yt,su:yt,ttfb:yt,ttfbb:yt,ttlb:yt,cmsdd:yt,cmsds:yt,smrt:yt,df:yt,cs:yt,ts:yt,cid:Hs,pr:Hs,sf:Hs,sid:Hs,st:Hs,v:Hs,msd:Hs,bs:ms,bsd:ms,cdn:ms,rtp:ms,bg:ms,pt:ms,ec:ms,e:ms},kB={REQUEST:yt};function PB(n){return Object.keys(n).reduce((e,t)=>{var r;return(r=n[t])===null||r===void 0||r.forEach(s=>e[s]=t),e},{})}function DB(n,e){const t={};if(!n)return t;const r=Object.keys(n),s=e?PB(e):{};return r.reduce((i,o)=>{var l;const c=CB[o]||s[o]||kB.REQUEST,d=(l=i[c])!==null&&l!==void 0?l:i[c]={};return d[o]=n[o],i},t)}function NB(n){return["ot","sf","st","e","sta"].includes(n)}function OB(n){return typeof n=="number"?he(n):n!=null&&n!==""&&n!==!1}const Zw="event";function MB(n,e){const t=new URL(n),r=new URL(e);if(t.origin!==r.origin)return n;const s=t.pathname.split("/").slice(1),i=r.pathname.split("/").slice(1,-1);for(;s[0]===i[0];)s.shift(),i.shift();for(;i.length;)i.shift(),s.unshift("..");return s.join("/")+t.search+t.hash}const zu=n=>Math.round(n),Mm=(n,e)=>Array.isArray(n)?n.map(t=>Mm(t,e)):n instanceof vr&&typeof n.value=="string"?new vr(Mm(n.value,e),n.params):(e.baseUrl&&(n=MB(n,e.baseUrl)),e.version===1?encodeURIComponent(n):n),bu=n=>zu(n/100)*100,FB=(n,e)=>{let t=n;return e.version>=2&&(n instanceof vr&&typeof n.value=="string"?t=new vr([n]):typeof n=="string"&&(t=[n])),Mm(t,e)},BB={br:zu,d:zu,bl:bu,dl:bu,mtp:bu,nor:FB,rtp:bu,tb:zu},e1="request",t1="response",Jp=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],UB=["e"],$B=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function zc(n){return $B.test(n)}function jB(n){return Jp.includes(n)||UB.includes(n)||zc(n)}const n1=["d","dl","nor","ot","rtp","su"];function VB(n){return Jp.includes(n)||n1.includes(n)||zc(n)}const GB=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function HB(n){return Jp.includes(n)||n1.includes(n)||GB.includes(n)||zc(n)}const KB=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function zB(n){return KB.includes(n)||zc(n)}const WB={[t1]:HB,[Zw]:jB,[e1]:VB};function r1(n,e={}){const t={};if(n==null||typeof n!="object")return t;const r=e.version||n.v||1,s=e.reportingMode||e1,i=r===1?zB:WB[s];let o=Object.keys(n).filter(i);const l=e.filter;typeof l=="function"&&(o=o.filter(l));const c=s===t1||s===Zw;c&&!o.includes("ts")&&o.push("ts"),r>1&&!o.includes("v")&&o.push("v");const d=et({},BB,e.formatters),f={version:r,reportingMode:s,baseUrl:e.baseUrl};return o.sort().forEach(h=>{let p=n[h];const v=d[h];if(typeof v=="function"&&(p=v(p,f)),h==="v"){if(r===1)return;p=r}h=="pr"&&p===1||(c&&h==="ts"&&!he(p)&&(p=Date.now()),OB(p)&&(NB(h)&&typeof p=="string"&&(p=new Yw(p)),t[h]=p))}),t}function YB(n,e={}){const t={};if(!n)return t;const r=r1(n,e),s=DB(r,e?.customHeaderMap);return Object.entries(s).reduce((i,[o,l])=>{const c=Jw(l,{whitespace:!1});return c&&(i[o]=c),i},t)}function qB(n,e,t){return et(n,YB(e,t))}const XB="CMCD";function QB(n,e={}){return n?Jw(r1(n,e),{whitespace:!1}):""}function JB(n,e={}){if(!n)return"";const t=QB(n,e);return encodeURIComponent(t)}function ZB(n,e={}){if(!n)return"";const t=JB(n,e);return`${XB}=${t}`}const DS=/CMCD=[^&#]+/;function eU(n,e,t){const r=ZB(e,t);if(!r)return n;if(DS.test(n))return n.replace(DS,r);const s=n.includes("?")?"&":"?";return`${n}${s}${r}`}class tU{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=s=>{try{this.apply(s,{ot:an.MANIFEST,su:!this.initialized})}catch(i){this.hls.logger.warn("Could not generate manifest CMCD data.",i)}},this.applyFragmentData=s=>{try{const{frag:i,part:o}=s,l=this.hls.levels[i.level],c=this.getObjectType(i),d={d:(o||i).duration*1e3,ot:c};(c===an.VIDEO||c===an.AUDIO||c==an.MUXED)&&(d.br=l.bitrate/1e3,d.tb=this.getTopBandwidth(c)/1e3,d.bl=this.getBufferLength(c));const f=o?this.getNextPart(o):this.getNextFrag(i);f!=null&&f.url&&f.url!==i.url&&(d.nor=f.url),this.apply(s,d)}catch(i){this.hls.logger.warn("Could not generate segment CMCD data.",i)}},this.hls=e;const t=this.config=e.config,{cmcd:r}=t;r!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||e.sessionId,this.cid=r.contentId,this.useHeaders=r.useHeaders===!0,this.includeKeys=r.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.MEDIA_DETACHED,this.onMediaDetached,this),e.on(R.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.MEDIA_DETACHED,this.onMediaDetached,this),e.off(R.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r,s;this.audioBuffer=(r=t.tracks.audio)==null?void 0:r.buffer,this.videoBuffer=(s=t.tracks.video)==null?void 0:s.buffer}createData(){var e;return{v:1,sf:lB.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){et(t,this.createData());const r=t.ot===an.INIT||t.ot===an.VIDEO||t.ot===an.MUXED;this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:s}=this;s&&(t=Object.keys(t).reduce((o,l)=>(s.includes(l)&&(o[l]=t[l]),o),{}));const i={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),qB(e.headers,t,i)):e.url=eU(e.url,t,i)}getNextFrag(e){var t;const r=(t=this.hls.levels[e.level])==null?void 0:t.details;if(r){const s=e.sn-r.startSN;return r.fragments[s+1]}}getNextPart(e){var t;const{index:r,fragment:s}=e,i=(t=this.hls.levels[s.level])==null||(t=t.details)==null?void 0:t.partList;if(i){const{sn:o}=s;for(let l=i.length-1;l>=0;l--){const c=i[l];if(c.index===r&&c.fragment.sn===o)return i[l+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return an.TIMED_TEXT;if(e.sn==="initSegment")return an.INIT;if(t==="audio")return an.AUDIO;if(t==="main")return this.hls.audioTracks.length?an.VIDEO:an.MUXED}getTopBandwidth(e){let t=0,r;const s=this.hls;if(e===an.AUDIO)r=s.audioTracks;else{const i=s.maxAutoLevel,o=i>-1?i+1:s.levels.length;r=s.levels.slice(0,o)}return r.forEach(i=>{i.bitrate>t&&(t=i.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,r=e===an.AUDIO?this.audioBuffer:this.videoBuffer;return!r||!t?NaN:Oe.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new r(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,o,l){t(i),this.loader.load(i,o,l)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,r=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new r(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,o,l){t(i),this.loader.load(i,o,l)}}}}const nU=3e5;class rU extends $n{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(R.MANIFEST_PARSED,this.onManifestParsed,this),e.on(R.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(R.MANIFEST_PARSED,this.onManifestParsed,this),e.off(R.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(r=>r!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:r}=t;r!==null&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:r}=t;if(r?.action===Bt.SendAlternateToPenaltyBox&&r.flags===Tn.MoveAllAlternatesMatchingHost){const s=this.levels;let i=this._pathwayPriority,o=this.pathwayId;if(t.context){const{groupId:l,pathwayId:c,type:d}=t.context;l&&s?o=this.getPathwayForGroupId(l,d,o):c&&(o=c)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!i&&s&&(i=this.pathways()),i&&i.length>1&&(this.updatePathwayPriority(i),r.resolved=this.pathwayId!==o),t.details===z.BUFFER_APPEND_ERROR&&!t.fatal?r.resolved=!0:r.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${o} levels: ${s&&s.length} priorities: ${nt(i)} penalized: ${nt(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const r=this.penalizedPathways,s=performance.now();Object.keys(r).forEach(i=>{s-r[i]>nU&&delete r[i]});for(let i=0;i<e.length;i++){const o=e[i];if(o in r)continue;if(o===this.pathwayId)return;const l=this.hls.nextLoadLevel,c=this.hls.levels[l];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,bw(t),this.hls.trigger(R.LEVELS_UPDATED,{levels:t});const d=this.hls.levels[l];c&&d&&this.levels&&(d.attrs["STABLE-VARIANT-ID"]!==c.attrs["STABLE-VARIANT-ID"]&&d.bitrate!==c.bitrate&&this.log(`Unstable Pathways change from bitrate ${c.bitrate} to ${d.bitrate}`),this.hls.nextLoadLevel=l);break}}}getPathwayForGroupId(e,t,r){const s=this.getLevelsForPathway(r).concat(this.levels||[]);for(let i=0;i<s.length;i++)if(t===Ge.AUDIO_TRACK&&s[i].hasAudioGroup(e)||t===Ge.SUBTITLE_TRACK&&s[i].hasSubtitleGroup(e))return s[i].pathwayId;return r}clonePathways(e){const t=this.levels;if(!t)return;const r={},s={};e.forEach(i=>{const{ID:o,"BASE-ID":l,"URI-REPLACEMENT":c}=i;if(t.some(f=>f.pathwayId===o))return;const d=this.getLevelsForPathway(l).map(f=>{const h=new dt(f.attrs);h["PATHWAY-ID"]=o;const p=h.AUDIO&&`${h.AUDIO}_clone_${o}`,v=h.SUBTITLES&&`${h.SUBTITLES}_clone_${o}`;p&&(r[h.AUDIO]=p,h.AUDIO=p),v&&(s[h.SUBTITLES]=v,h.SUBTITLES=v);const g=s1(f.uri,h["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",c),S=new _a({attrs:h,audioCodec:f.audioCodec,bitrate:f.bitrate,height:f.height,name:f.name,url:g,videoCodec:f.videoCodec,width:f.width});if(f.audioGroups)for(let x=1;x<f.audioGroups.length;x++)S.addGroupId("audio",`${f.audioGroups[x]}_clone_${o}`);if(f.subtitleGroups)for(let x=1;x<f.subtitleGroups.length;x++)S.addGroupId("text",`${f.subtitleGroups[x]}_clone_${o}`);return S});t.push(...d),NS(this.audioTracks,r,c,o),NS(this.subtitleTracks,s,c,o)})}loadSteeringManifest(e){const t=this.hls.config,r=t.loader;this.loader&&this.loader.destroy(),this.loader=new r(t);let s;try{s=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(s.protocol!=="data:"){const f=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+f)}const i={responseType:"json",url:s.href},o=t.steeringManifestLoadPolicy.default,l=o.errorRetry||o.timeoutRetry||{},c={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:l.maxNumRetry||0,retryDelay:l.retryDelayMs||0,maxRetryDelay:l.maxRetryDelayMs||0},d={onSuccess:(f,h,p,v)=>{this.log(`Loaded steering manifest: "${s}"`);const g=f.data;if(g?.VERSION!==1){this.log(`Steering VERSION ${g.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=g.TTL;const{"RELOAD-URI":S,"PATHWAY-CLONES":x,"PATHWAY-PRIORITY":b}=g;if(S)try{this.uri=new self.URL(S,s).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${S}`);return}this.scheduleRefresh(this.uri||p.url),x&&this.clonePathways(x);const A={steeringManifest:g,url:s.toString()};this.hls.trigger(R.STEERING_MANIFEST_LOADED,A),b&&this.updatePathwayPriority(b)},onError:(f,h,p,v)=>{if(this.log(`Error loading steering manifest: ${f.code} ${f.text} (${h.url})`),this.stopLoad(),f.code===410){this.enabled=!1,this.log(`Steering manifest ${h.url} no longer available`);return}let g=this.timeToLoad*1e3;if(f.code===429){const S=this.loader;if(typeof S?.getResponseHeader=="function"){const x=S.getResponseHeader("Retry-After");x&&(g=parseFloat(x)*1e3)}this.log(`Steering manifest ${h.url} rate limited`);return}this.scheduleRefresh(this.uri||h.url,g)},onTimeout:(f,h,p)=>{this.log(`Timeout loading steering manifest (${h.url})`),this.scheduleRefresh(this.uri||h.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(i,c,d)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var r;const s=(r=this.hls)==null?void 0:r.media;if(s&&!s.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function NS(n,e,t,r){n&&Object.keys(e).forEach(s=>{const i=n.filter(o=>o.groupId===s).map(o=>{const l=et({},o);return l.details=void 0,l.attrs=new dt(l.attrs),l.url=l.attrs.URI=s1(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),l.groupId=l.attrs["GROUP-ID"]=e[s],l.attrs["PATHWAY-ID"]=r,l});n.push(...i)})}function s1(n,e,t,r){const{HOST:s,PARAMS:i,[t]:o}=r;let l;e&&(l=o?.[e],l&&(n=l));const c=new self.URL(n);return s&&!l&&(c.host=s),i&&Object.keys(i).sort().forEach(d=>{d&&c.searchParams.set(d,i[d])}),c.href}class zi extends $n{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=zi.CDMCleanupPromise?[zi.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:r,initData:s}=t,i=`"${t.type}" event: init data type: "${r}"`;if(this.debug(i),s!==null){if(!this.keyFormatPromise){let o=Object.keys(this.keySystemAccessPromises);o.length||(o=ia(this.config));const l=o.map(vh).filter(c=>!!c);this.keyFormatPromise=this.getKeyFormatPromise(l)}this.keyFormatPromise.then(o=>{const l=Gu(o);if(r!=="sinf"||l!==ft.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${r}" for selected key-system ${l}`);return}let c;try{const v=It(new Uint8Array(s)),g=$p(JSON.parse(v).sinf),S=Jb(g);if(!S)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");c=new Uint8Array(S.subarray(8,24))}catch(v){this.warn(`${i} Failed to parse sinf: ${v}`);return}const d=Ut(c),{keyIdToKeySessionPromise:f,mediaKeySessions:h}=this;let p=f[d];for(let v=0;v<h.length;v++){const g=h[v],S=g.decryptdata;if(!S.keyId)continue;const x=Ut(S.keyId);if(pc(c,S.keyId)||S.uri.replace(/-/g,"").indexOf(d)!==-1){if(p=f[x],!p)continue;if(S.pssh)break;delete f[x],S.pssh=new Uint8Array(s),S.keyId=c,p=f[d]=p.then(()=>this.generateRequestWithPreferredKeySession(g,r,s,"encrypted-event-key-match")),p.catch(b=>this.handleError(b));break}}p||this.handleError(new Error(`Key ID ${d} not encountered in playlist. Key-system sessions ${h.length}.`))}).catch(o=>this.handleError(o))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(R.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(R.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(R.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(R.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(R.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(R.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(R.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(R.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:r}=this.config,s=t?.[e];if(s)return s.licenseUrl;if(e===ft.WIDEVINE&&r)return r}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,r=t?.[e];if(r)return r.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,r=(o,l,c)=>!!o&&c.indexOf(o)===l,s=t.map(o=>o.audioCodec).filter(r),i=t.map(o=>o.videoCodec).filter(r);return s.length+i.length===0&&i.push("avc1.42e01e"),new Promise((o,l)=>{const c=d=>{const f=d.shift();this.getMediaKeysPromise(f,s,i).then(h=>o({keySystem:f,mediaKeys:h})).catch(h=>{d.length?c(d):h instanceof En?l(h):l(new En({type:we.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_ACCESS,error:h,fatal:!0},h.message))})};c(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:r}=this.config;if(typeof r!="function"){let s=`Configured requestMediaKeySystemAccess is not a function ${r}`;return pw===null&&self.location.protocol==="http:"&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return r(e,t)}getMediaKeysPromise(e,t,r){var s;const i=FM(e,t,r,this.config.drmSystemOptions||{});let o=this.keySystemAccessPromises[e],l=(s=o)==null?void 0:s.keySystemAccess;if(!l){this.log(`Requesting encrypted media "${e}" key-system access with config: ${nt(i)}`),l=this.requestMediaKeySystemAccess(e,i);const c=o=this.keySystemAccessPromises[e]={keySystemAccess:l};return l.catch(d=>{this.log(`Failed to obtain access to key-system "${e}": ${d}`)}),l.then(d=>{this.log(`Access for key-system "${d.keySystem}" obtained`);const f=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const h=c.mediaKeys=d.createMediaKeys().then(p=>(this.log(`Media-keys created for "${e}"`),c.hasMediaKeys=!0,f.then(v=>v?this.setMediaKeysServerCertificate(p,e,v):p)));return h.catch(p=>{this.error(`Failed to create media-keys for "${e}"}: ${p}`)}),h})}return l.then(()=>o.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:r}){this.log(`Creating key-system session "${t}" keyId: ${Ut(e.keyId||[])} keyUri: ${e.uri}`);const s=r.createSession(),i={decryptdata:e,keySystem:t,mediaKeys:r,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(i),i}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const r=this.createMediaKeySessionContext(e),s=wu(t),i="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(r,i,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const r=e.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyId ${Ut(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),r.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>vh(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:r})=>this.attemptSetMediaKeys(t,r))}selectKeySystem(e){return new Promise((t,r)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:s})=>{const i=vh(s);i?t(i):r(new Error(`Unable to find format for key-system "${s}"`))}).catch(r)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=ia(this.config),r=e.map(Gu).filter(s=>!!s&&t.indexOf(s)!==-1);return this.selectKeySystem(r)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let r=0;r<t.length;r++){const s=sU(e,t[r]);if(s)return s}}loadKey(e){const t=e.keyInfo.decryptdata,r=wu(t),s=this.bannedKeyIds[r];if(s||this.getKeyStatus(t)==="internal-error"){const l=OS(s||"internal-error",t);return this.handleError(l,e.frag),Promise.reject(l)}const i=`(keyId: ${r} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);const o=this.keyIdToKeySessionPromise[r];if(!o){const l=this.getKeySystemForKeyPromise(t).then(({keySystem:c,mediaKeys:d})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(c,d).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:c,mediaKeys:d,decryptdata:t}))))).then(c=>{const d="cenc",f=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(c,d,f,"playlist-key")});return l.catch(c=>this.handleError(c,e.frag)),this.keyIdToKeySessionPromise[r]=l,l}return o.catch(l=>{if(l instanceof En){const c=Je({},l.data);this.getKeyStatus(t)==="internal-error"&&(c.decryptdata=t);const d=new En(c,l.message);this.handleError(d,e.frag)}}),o}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof En){t&&(e.data.frag=t);const r=e.data.decryptdata;this.error(`${e.message}${r?` (${Ut(r.keyId||[])})`:""}`),this.hls.trigger(R.ERROR,e.data)}else this.error(e.message),this.hls.trigger(R.ERROR,{type:we.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=wu(e),r=this.keyIdToKeySessionPromise[t];if(!r){const s=Gu(e.keyFormat),i=s?[s]:ia(this.config);return this.attemptKeySystemAccess(i)}return r}getKeySystemSelectionPromise(e){if(e.length||(e=ia(this.config)),e.length===0)throw new En({type:we.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${nt({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const r=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const s=Promise.all(r).then(()=>this.media?this.media.setMediaKeys(t):new Promise((i,o)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return o(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(i).catch(o)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${e}"`),r.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(i=>r.indexOf(i)===-1)})}generateRequestWithPreferredKeySession(e,t,r,s){var i;const o=(i=this.config.drmSystems)==null||(i=i[e.keySystem])==null?void 0:i.generateRequest;if(o)try{const g=o.call(this.hls,t,r,e);if(!g)throw new Error("Invalid response from configured generateRequest filter");t=g.initDataType,r=g.initData?g.initData:null,e.decryptdata.pssh=r?new Uint8Array(r):null}catch(g){if(this.warn(g.message),this.hls&&this.hls.config.debug)throw g}if(r===null)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(e);const l=wu(e.decryptdata),c=e.decryptdata.uri;this.log(`Generating key-session request for "${s}" keyId: ${l} URI: ${c} (init data type: ${t} length: ${r.byteLength})`);const d=new Vp,f=e._onmessage=g=>{const S=e.mediaKeysSession;if(!S){d.emit("error",new Error("invalid state"));return}const{messageType:x,message:b}=g;this.log(`"${x}" message event for session "${S.sessionId}" message size: ${b.byteLength}`),x==="license-request"||x==="license-renewal"?this.renewLicense(e,b).catch(A=>{d.eventNames().length?d.emit("error",A):this.handleError(A)}):x==="license-release"?e.keySystem===ft.FAIRPLAY&&this.updateKeySession(e,Im("acknowledged")).then(()=>this.removeSession(e)).catch(A=>this.handleError(A)):this.warn(`unhandled media key message type "${x}"`)},h=(g,S)=>{S.keyStatus=g;let x;g.startsWith("usable")?d.emit("resolved"):g==="internal-error"||g==="output-restricted"||g==="output-downscaled"?x=OS(g,S.decryptdata):g==="expired"?x=new Error(`key expired (keyId: ${l})`):g==="released"?x=new Error("key released"):g==="status-pending"||this.warn(`unhandled key status change "${g}" (keyId: ${l})`),x&&(d.eventNames().length?d.emit("error",x):this.handleError(x))},p=e._onkeystatuseschange=g=>{if(!e.mediaKeysSession){d.emit("error",new Error("invalid state"));return}const x=this.getKeyStatuses(e);if(!Object.keys(x).some(I=>x[I]!=="status-pending"))return;if(x[l]==="expired"){this.log(`Expired key ${nt(x)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let A=x[l];if(A)h(A,e);else{var L;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(L=e.keyStatusTimeouts)[l]||(L[l]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const k=this.getKeyStatus(e.decryptdata);if(k&&k!=="status-pending")return this.log(`No status for keyId ${l} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${k} from other session.`),h(k,e);this.log(`key status for ${l} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),A="internal-error",h(A,e)},1e3)),this.log(`No status for keyId ${l} (${nt(x)}).`)}};Zt(e.mediaKeysSession,"message",f),Zt(e.mediaKeysSession,"keystatuseschange",p);const v=new Promise((g,S)=>{d.on("error",S),d.on("resolved",g)});return e.mediaKeysSession.generateRequest(t,r).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${l} URI: ${c}`)}).catch(g=>{throw new En({type:we.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_SESSION,error:g,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${g}`)}).then(()=>v).catch(g=>(d.removeAllListeners(),this.removeSession(e).then(()=>{throw g}))).then(()=>(d.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((r,s)=>{if(typeof s=="string"&&typeof r=="object"){const l=s;s=r,r=l}const i="buffer"in s?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s);if(e.keySystem===ft.PLAYREADY&&i.length===16){const l=Ut(i);t[l]=r,hw(i)}const o=Ut(i);r==="internal-error"&&(this.bannedKeyIds[o]=r),this.log(`key status change "${r}" for keyStatuses keyId: ${o} key-session "${e.mediaKeysSession.sessionId}"`),t[o]=r}),t}fetchServerCertificate(e){const t=this.config,r=t.loader,s=new r(t),i=this.getServerCertificateUrl(e);return i?(this.log(`Fetching server certificate for "${e}"`),new Promise((o,l)=>{const c={responseType:"arraybuffer",url:i},d=t.certLoadPolicy.default,f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:(p,v,g,S)=>{o(p.data)},onError:(p,v,g,S)=>{l(new En({type:we.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:Je({url:c.url,data:void 0},p)},`"${e}" certificate request failed (${i}). Status: ${p.code} (${p.text})`))},onTimeout:(p,v,g)=>{l(new En({type:we.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:{url:c.url,data:void 0}},`"${e}" certificate request timed out (${i})`))},onAbort:(p,v,g)=>{l(new Error("aborted"))}};s.load(c,f,h)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,r){return new Promise((s,i)=>{e.setServerCertificate(r).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${r.byteLength}) on "${t}"`),s(e)}).catch(o=>{i(new En({type:we.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(r=>this.updateKeySession(e,new Uint8Array(r)).catch(s=>{throw new En({type:we.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:s,fatal:!1},s.message)}))}unpackPlayReadyKeyMessage(e,t){const r=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!r.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const s=new DOMParser().parseFromString(r,"application/xml"),i=s.querySelectorAll("HttpHeader");if(i.length>0){let f;for(let h=0,p=i.length;h<p;h++){var o,l;f=i[h];const v=(o=f.querySelector("name"))==null?void 0:o.textContent,g=(l=f.querySelector("value"))==null?void 0:l.textContent;v&&g&&e.setRequestHeader(v,g)}}const c=s.querySelector("Challenge"),d=c?.textContent;if(!d)throw new Error("Cannot find <Challenge> in key message");return Im(atob(d))}setupLicenseXHR(e,t,r,s){const i=this.config.licenseXhrSetup;return i?Promise.resolve().then(()=>{if(!r.decryptdata)throw new Error("Key removed");return i.call(this.hls,e,t,r,s)}).catch(o=>{if(!r.decryptdata)throw o;return e.open("POST",t,!0),i.call(this.hls,e,t,r,s)}).then(o=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:o||s})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:s}))}requestLicense(e,t){const r=this.config.keyLoadPolicy.default;return new Promise((s,i)=>{const o=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${o}`);const l=new XMLHttpRequest;l.responseType="arraybuffer",l.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return i(new Error("invalid state"));if(l.readyState===4)if(l.status===200){this._requestLicenseFailureCount=0;let c=l.response;this.log(`License received ${c instanceof ArrayBuffer?c.byteLength:c}`);const d=this.config.licenseResponseCallback;if(d)try{c=d.call(this.hls,l,o,e)}catch(f){this.error(f)}s(c)}else{const c=r.errorRetry,d=c?c.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>d||l.status>=400&&l.status<500)i(new En({type:we.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:l,response:{url:o,data:void 0,code:l.status,text:l.statusText}},`License Request XHR failed (${o}). Status: ${l.status} (${l.statusText})`));else{const f=d-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${f} attempts left`),this.requestLicense(e,t).then(s,i)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=l,this.setupLicenseXHR(l,o,e,t).then(({xhr:c,licenseChallenge:d})=>{e.keySystem==ft.PLAYREADY&&(d=this.unpackPlayReadyKeyMessage(c,d)),c.send(d)}).catch(i)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const r=t.media;this.media=r,Zt(r,"encrypted",this.onMediaEncrypted),Zt(r,"waitingforkey",this.onWaitingForKey);const s=this.mediaResolved;s?s():this.mediaKeys=r.mediaKeys}onMediaDetached(){const e=this.media;e&&(un(e,"encrypted",this.onMediaEncrypted),un(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const r=this.media,s=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Ts.clearKeyUriToKeyIdMap();const i=s.length;zi.CDMCleanupPromise=Promise.all(s.map(o=>this.removeSession(o)).concat((r==null||(e=r.setMediaKeys(null))==null?void 0:e.catch(o=>{this.log(`Could not clear media keys: ${o}`),this.hls&&this.hls.trigger(R.ERROR,{type:we.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${o}`)})}))||Promise.resolve())).catch(o=>{this.log(`Could not close sessions and clear media keys: ${o}`),this.hls&&this.hls.trigger(R.ERROR,{type:we.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${o}`)})}).then(()=>{i&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const r=t.reduce((s,i)=>(s.indexOf(i.keyFormat)===-1&&s.push(i.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${r.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(r)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:r,decryptdata:s}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${Ut(s?.keyId||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);i>-1&&this.mediaKeySessions.splice(i,1);const{keyStatusTimeouts:o}=e;o&&Object.keys(o).forEach(d=>self.clearTimeout(o[d]));const{drmSystemOptions:l}=this.config;return(UM(l)?new Promise((d,f)=>{self.setTimeout(()=>f(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(d).catch(f)}):Promise.resolve()).catch(d=>{this.log(`Could not remove session: ${d}`),this.hls&&this.hls.trigger(R.ERROR,{type:we.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${d}`)})}).then(()=>t.close()).catch(d=>{this.log(`Could not close session: ${d}`),this.hls&&this.hls.trigger(R.ERROR,{type:we.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${d}`)})})}return Promise.resolve()}}zi.CDMCleanupPromise=void 0;function wu(n){if(!n)throw new Error("Could not read keyId of undefined decryptdata");if(n.keyId===null)throw new Error("keyId is null");return Ut(n.keyId)}function sU(n,e){if(n.keyId&&e.mediaKeysSession.keyStatuses.has(n.keyId))return e.mediaKeysSession.keyStatuses.get(n.keyId);if(n.matches(e.decryptdata))return e.keyStatus}class En extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function OS(n,e){const t=n==="output-restricted",r=t?z.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:z.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new En({type:we.KEY_SYSTEM_ERROR,details:r,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${n}"`)}class iU{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(R.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(R.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(R.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(R.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const r=this.hls.config;if(r.capLevelOnFPSDrop){const s=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=s,s&&typeof s.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,r){const s=performance.now();if(t){if(this.lastTime){const i=s-this.lastTime,o=r-this.lastDroppedFrames,l=t-this.lastDecodedFrames,c=1e3*o/i,d=this.hls;if(d.trigger(R.FPS_DROP,{currentDropped:o,currentDecoded:l,totalDroppedFrames:r}),c>0&&o>d.config.fpsDroppedMonitoringThreshold*l){let f=d.currentLevel;d.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+f),f>0&&(d.autoLevelCapping===-1||d.autoLevelCapping>=f)&&(f=f-1,d.trigger(R.FPS_DROP_LEVEL_CAPPING,{level:f,droppedLevel:d.currentLevel}),d.autoLevelCapping=f,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function i1(n,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=n,e.dispatchEvent(t)}function o1(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(e.id))try{if(n.addCue(e),!n.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(r){Ze.debug(`[texttrack-utils]: ${r}`);try{const s=new self.TextTrackCue(e.startTime,e.endTime,e.text);s.id=e.id,n.addCue(s)}catch(s){Ze.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${s}`)}}t==="disabled"&&(n.mode=t)}function Gi(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues)for(let r=n.cues.length;r--;)e&&n.cues[r].removeEventListener("enter",e),n.removeCue(n.cues[r]);t==="disabled"&&(n.mode=t)}function Fm(n,e,t,r){const s=n.mode;if(s==="disabled"&&(n.mode="hidden"),n.cues&&n.cues.length>0){const i=aU(n.cues,e,t);for(let o=0;o<i.length;o++)(!r||r(i[o]))&&n.removeCue(i[o])}s==="disabled"&&(n.mode=s)}function oU(n,e){if(e<=n[0].startTime)return 0;const t=n.length-1;if(e>n[t].endTime)return-1;let r=0,s=t,i;for(;r<=s;)if(i=Math.floor((s+r)/2),e<n[i].startTime)s=i-1;else if(e>n[i].startTime&&r<t)r=i+1;else return i;return n[r].startTime-e<e-n[s].startTime?r:s}function aU(n,e,t){const r=[],s=oU(n,e);if(s>-1)for(let i=s,o=n.length;i<o;i++){const l=n[i];if(l.startTime>=e&&l.endTime<=t)r.push(l);else if(l.startTime>t)return r}return r}function Wu(n){const e=[];for(let t=0;t<n.length;t++){const r=n[t];(r.kind==="subtitles"||r.kind==="captions")&&r.label&&e.push(n[t])}return e}class lU extends qp{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const r=Wu(this.media.textTracks);for(let i=0;i<r.length;i++)if(r[i].mode==="hidden")t=r[i];else if(r[i].mode==="showing"){t=r[i];break}const s=this.findTrackForTextTrack(t);this.subtitleTrack!==s&&this.setSubtitleTrack(s)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.MANIFEST_PARSED,this.onManifestParsed,this),e.on(R.LEVEL_LOADING,this.onLevelLoading,this),e.on(R.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(R.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(R.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.MANIFEST_PARSED,this.onManifestParsed,this),e.off(R.LEVEL_LOADING,this.onLevelLoading,this),e.off(R.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(R.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(R.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const r=this.media;if(!r)return;const s=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||r.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,s)return;Wu(r.textTracks).forEach(o=>{Gi(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:r,groupId:s,details:i}=t,o=this.tracksInGroup[r];if(!o||o.groupId!==s){this.warn(`Subtitle track with id:${r} and group:${s} not found in active group ${o?.groupId}`);return}const l=o.details;o.details=t.details,this.log(`Subtitle track ${r} "${o.name}" lang:${o.lang} group:${s} loaded [${i.startSN}-${i.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,l)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.subtitleGroups||null,s=this.groupIds;let i=this.currentTrack;if(!r||s?.length!==r?.length||r!=null&&r.some(o=>s?.indexOf(o)===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(f=>!r||r.indexOf(f.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(f=>f.default)&&(this.selectDefaultTrack=!1),o.forEach((f,h)=>{f.id=h});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const l=this.hls.config.subtitlePreference;if(!i&&l){this.selectDefaultTrack=!1;const f=mr(l,o);if(f>-1)i=o[f];else{const h=mr(l,this.tracks);i=this.tracks[h]}}let c=this.findTrackId(i);c===-1&&i&&(c=this.findTrackId(null));const d={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${r?.join(",")}" group-id`),this.hls.trigger(R.SUBTITLE_TRACKS_UPDATED,d),c!==-1&&this.trackId===-1&&this.setSubtitleTrack(c)}}findTrackId(e){const t=this.tracksInGroup,r=this.selectDefaultTrack;for(let s=0;s<t.length;s++){const i=t[s];if(!(r&&!i.default||!r&&!e)&&(!e||ni(i,e)))return s}if(e){for(let s=0;s<t.length;s++){const i=t[s];if(Da(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<t.length;s++){const i=t[s];if(Da(e.attrs,i.attrs,["LANGUAGE"]))return s}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const s=t[r];if(Dm(s,e))return r}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===Ge.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const r=this.currentTrack;if(r&&ni(e,r))return r;const s=mr(e,this.tracksInGroup);if(s>-1){const i=this.tracksInGroup[s];return this.setSubtitleTrack(s),i}else{if(r)return null;{const i=mr(e,t);if(i>-1)return t[i]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,s=e.groupId,i=this.getUrlWithDirectives(e.url,t),o=e.details,l=o?.age;this.log(`Loading subtitle ${r} "${e.name}" lang:${e.lang} group:${s}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${l&&o.live?" age "+l.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(R.SUBTITLE_TRACK_LOADING,{url:i,id:r,groupId:s,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Wu(e.textTracks),r=this.currentTrack;let s;if(r&&(s=t.filter(i=>Dm(r,i))[0],s||this.warn(`Unable to find subtitle TextTrack with name "${r.name}" and language "${r.lang}"`)),[].slice.call(t).forEach(i=>{i.mode!=="disabled"&&i!==s&&(i.mode="disabled")}),s){const i=this.subtitleDisplay?"showing":"hidden";s.mode!==i&&(s.mode=i)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!he(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,s=t[e]||null;if(this.trackId=e,this.currentTrack=s,this.toggleTrackModes(),!s){this.hls.trigger(R.SUBTITLE_TRACK_SWITCH,{id:e});return}const i=!!s.details&&!s.details.live;if(e===this.trackId&&s===r&&i)return;this.log(`Switching to subtitle-track ${e}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:""));const{id:o,groupId:l="",name:c,type:d,url:f}=s;this.hls.trigger(R.SUBTITLE_TRACK_SWITCH,{id:o,groupId:l,name:c,type:d,url:f});const h=this.switchParams(s.url,r?.details,s.details);this.loadPlaylist(h)}}function uU(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const i=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(s=="x"?i:i&3|8).toString(16)})}}}function pa(n){let e=5381,t=n.length;for(;t;)e=e*33^n.charCodeAt(--t);return(e>>>0).toString()}const Wi=.025;let xc=(function(n){return n[n.Point=0]="Point",n[n.Range=1]="Range",n})({});function cU(n,e,t){return`${n.identifier}-${t+1}-${pa(e)}`}class dU{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const r=this.playoutLimit;return e<=0||isNaN(r)?!1:r===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>r}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Rh(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,r=Rh(t,e);return t-r<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=he(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Rh(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Wi))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?xc.Range:xc.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return fU(this)}}function Rh(n,e){return n-e.start<e.duration/2&&!(Math.abs(n-(e.start+e.duration))<Wi)?e.start:e.start+e.duration}function a1(n,e,t){const r=new self.URL(n,t);return r.protocol!=="data:"&&r.searchParams.set("_HLS_primary_id",e),r}function Ih(n,e){for(;(t=n.assetList[++e])!=null&&t.error;)var t;return e}function fU(n){return`["${n.identifier}" ${n.cue.pre?"<pre>":n.cue.post?"<post>":""}${n.timelineStart.toFixed(2)}-${n.resumeTime.toFixed(2)}]`}function Bi(n){const e=n.timelineStart,t=n.duration||0;return`["${n.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class hU{constructor(e,t,r,s){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(R.PLAYOUT_LIMIT_REACHED,{})};const i=this.hls=new e(t);this.interstitial=r,this.assetItem=s;const o=()=>{this.hasDetails=!0};i.once(R.LEVEL_LOADED,o),i.once(R.AUDIO_TRACK_LOADED,o),i.once(R.SUBTITLE_TRACK_LOADED,o),i.on(R.MEDIA_ATTACHING,(l,{media:c})=>{this.removeMediaListeners(),this.mediaAttached=c,this.interstitial.playoutLimit&&(c.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&i.on(R.BUFFER_APPENDED,()=>{const f=this.bufferedEnd;this.reachedPlayout(f)&&(this._bufferedEosTime=f,i.trigger(R.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=a1(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const r=Math.min(this._bufferedEosTime||1/0,this.duration),s=this.timelineOffset,i=Oe.bufferInfo(e,s,0);return this.getAssetTime(i.end)>=r-.02}reachedPlayout(e){const r=this.interstitial.playoutLimit;return this.startOffset+e>=r}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Oe.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const r=t-this.startOffset;if(r>0&&r<e)return r}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const r=e-t;if(Math.abs(r)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,r=this.duration;return Math.min(Math.max(0,e-t),r)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=r=>delete r.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,r){var s;(s=this.hls)==null||s.on(e,t)}once(e,t,r){var s;(s=this.hls)==null||s.once(e,t)}off(e,t,r){var s;(s=this.hls)==null||s.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${Bi(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const MS=.033;class mU extends $n{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((r,s)=>e<=s.startOffset&&t>s.startOffset?(delete s.error,r+1):r,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let r=-1;e.nextEvent?r=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(r=this.findEventIndex(e.previousEvent.identifier)+1);const s=this.items;if(s)for(s[r]||(t===void 0&&(t=e.start),r=this.findItemIndexAtTime(t));r>=0&&(i=s[r])!=null&&i.event;){var i;r--}return r}findItemIndexAtTime(e,t){const r=this.items;if(r)for(let s=0;s<r.length;s++){let i=r[s];if(t&&t!=="primary"&&(i=i[t]),e===i.start||e>i.start&&e<i.end)return s}return-1}findJumpRestrictedIndex(e,t){const r=this.items;if(r)for(let s=e;s<=t&&r[s];s++){const i=r[s].event;if(i!=null&&i.restrictions.jump&&!i.appendInPlace)return s}return-1}findEventIndex(e){const t=this.items;if(t)for(let s=t.length;s--;){var r;if(((r=t[s].event)==null?void 0:r.identifier)===e)return s}return-1}findAssetIndex(e,t){const r=e.assetList,s=r.length;if(s>1)for(let i=0;i<s;i++){const o=r[i];if(!o.error){const l=o.timelineStart;if(t===l||t>l&&(t<l+(o.duration||0)||i===s-1))return i}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const r=t.assetList,s=r[r.length-1];if(s)return s.identifier}return null}parseInterstitialDateRanges(e,t){const r=e.main.details,{dateRanges:s}=r,i=this.events,o=this.parseDateRanges(s,{url:r.url},t),l=Object.keys(s),c=i?i.filter(d=>!l.includes(d.identifier)):[];o.length&&o.sort((d,f)=>{const h=d.cue.pre,p=d.cue.post,v=f.cue.pre,g=f.cue.post;if(h&&!v)return-1;if(v&&!h||p&&!g)return 1;if(g&&!p)return-1;if(!h&&!v&&!p&&!g){const S=d.startTime,x=f.startTime;if(S!==x)return S-x}return d.dateRange.tagOrder-f.dateRange.tagOrder}),this.events=o,c.forEach(d=>{this.removeEvent(d)}),this.updateSchedule(e,c)}updateSchedule(e,t=[],r=!1){const s=this.events||[];if(s.length||t.length||this.length<2){const i=this.items,o=this.parseSchedule(s,e);(r||t.length||i?.length!==o.length||o.some((c,d)=>Math.abs(c.playout.start-i[d].playout.start)>.005||Math.abs(c.playout.end-i[d].playout.end)>.005))&&(this.items=o,this.onScheduleUpdate(t,i))}}parseDateRanges(e,t,r){const s=[],i=Object.keys(e);for(let o=0;o<i.length;o++){const l=i[o],c=e[l];if(c.isInterstitial){let d=this.eventMap[l];d?d.setDateRange(c):(d=new dU(c,t),this.eventMap[l]=d,r===!1&&(d.appendInPlace=r)),s.push(d)}}return s}parseSchedule(e,t){const r=[],s=t.main.details,i=s.live?1/0:s.edge;let o=0;if(e=e.filter(c=>!c.error&&!(c.cue.once&&c.hasPlayed)),e.length){this.resolveOffsets(e,t);let c=0,d=0;if(e.forEach((f,h)=>{const p=f.cue.pre,v=f.cue.post,g=e[h-1]||null,S=f.appendInPlace,x=v?i:f.startOffset,b=f.duration,A=f.timelineOccupancy===xc.Range?b:0,L=f.resumptionOffset,I=g?.startTime===x,k=x+f.cumulativeDuration;let F=S?k+b:x+L;if(p||!v&&x<=0){const P=d;d+=A,f.timelineStart=k;const O=o;o+=b,r.push({event:f,start:k,end:F,playout:{start:O,end:o},integrated:{start:P,end:d}})}else if(x<=i){if(!I){const M=x-c;if(M>MS){const H=c,Z=d;d+=M;const se=o;o+=M;const U={previousEvent:e[h-1]||null,nextEvent:f,start:H,end:H+M,playout:{start:se,end:o},integrated:{start:Z,end:d}};r.push(U)}else M>0&&g&&(g.cumulativeDuration+=M,r[r.length-1].end=x)}v&&(F=k),f.timelineStart=k;const P=d;d+=A;const O=o;o+=b,r.push({event:f,start:k,end:F,playout:{start:O,end:o},integrated:{start:P,end:d}})}else return;const C=f.resumeTime;v||C>i?c=i:c=C}),c<i){var l;const f=c,h=d,p=i-c;d+=p;const v=o;o+=p,r.push({previousEvent:((l=r[r.length-1])==null?void 0:l.event)||null,nextEvent:null,start:c,end:f+p,playout:{start:v,end:o},integrated:{start:h,end:d}})}this.setDurations(i,o,d)}else r.push({previousEvent:null,nextEvent:null,start:0,end:i,playout:{start:0,end:i},integrated:{start:0,end:i}}),this.setDurations(i,i,i);return r}setDurations(e,t,r){this.durations={primary:e,playout:t,integrated:r}}resolveOffsets(e,t){const r=t.main.details,s=r.live?1/0:r.edge;let i=0,o=-1;e.forEach((l,c)=>{const d=l.cue.pre,f=l.cue.post,h=d?0:f?s:l.startTime;this.updateAssetDurations(l),o===h?l.cumulativeDuration=i:(i=0,o=h),!f&&l.snapOptions.in&&(l.resumeAnchor=ii(null,r.fragments,l.startOffset+l.resumptionOffset,0,0)||void 0),l.appendInPlace&&!l.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(l,t)||(l.appendInPlace=!1)),!l.appendInPlace&&c+1<e.length&&e[c+1].startTime-e[c].resumeTime<MS&&(e[c+1].appendInPlace=!1,e[c+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${l}`));const v=he(l.resumeOffset)?l.resumeOffset:l.duration;i+=v})}primaryCanResumeInPlaceAt(e,t){const r=e.resumeTime,s=e.startTime+e.resumptionOffset;return Math.abs(r-s)>Wi?(this.log(`"${e.identifier}" resumption ${r} not aligned with estimated timeline end ${s}`),!1):!Object.keys(t).some(o=>{const l=t[o].details,c=l.edge;if(r>=c)return this.log(`"${e.identifier}" resumption ${r} past ${o} playlist end ${c}`),!1;const d=ii(null,l.fragments,r);if(!d)return this.log(`"${e.identifier}" resumption ${r} does not align with any fragments in ${o} playlist (${l.fragStart}-${l.fragmentEnd})`),!0;const f=o==="audio"?.175:0;return Math.abs(d.start-r)<Wi+f||Math.abs(d.end-r)<Wi+f?!1:(this.log(`"${e.identifier}" resumption ${r} not aligned with ${o} fragment bounds (${d.start}-${d.end} sn: ${d.sn} cc: ${d.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let r=0,s=!1,i=!1;for(let o=0;o<e.assetList.length;o++){const l=e.assetList[o],c=t+r;l.startOffset=r,l.timelineStart=c,s||(s=l.duration===null),i||(i=!!l.error);const d=l.error?0:l.duration||0;r+=d}s&&!i?e.duration=Math.max(r,e.duration):e.duration=r}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Yn(n){return`[${n.event?'"'+n.event.identifier+'"':"primary"}: ${n.start.toFixed(2)}-${n.end.toFixed(2)}]`}class pU{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const r=e.assetListUrl;let s;try{s=a1(r,this.hls.sessionId,e.baseUrl)}catch(p){const v=this.assignAssetListError(e,z.ASSET_LIST_LOAD_ERROR,p,r);this.hls.trigger(R.ERROR,v);return}t&&s.protocol!=="data:"&&s.searchParams.set("_HLS_start_offset",""+t);const i=this.hls.config,o=i.loader,l=new o(i),c={responseType:"json",url:s.href},d=i.interstitialAssetListLoadPolicy.default,f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:(p,v,g,S)=>{const x=p.data,b=x?.ASSETS;if(!Array.isArray(b)){const A=this.assignAssetListError(e,z.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),g.url,v,S);this.hls.trigger(R.ERROR,A);return}e.assetListResponse=x,this.hls.trigger(R.ASSET_LIST_LOADED,{event:e,assetListResponse:x,networkDetails:S})},onError:(p,v,g,S)=>{const x=this.assignAssetListError(e,z.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${p.code} ${p.text} (${v.url})`),v.url,S,g);this.hls.trigger(R.ERROR,x)},onTimeout:(p,v,g)=>{const S=this.assignAssetListError(e,z.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${v.url})`),v.url,p,g);this.hls.trigger(R.ERROR,S)}};return l.load(c,f,h),this.hls.trigger(R.ASSET_LIST_LOADING,{event:e}),l}assignAssetListError(e,t,r,s,i,o){return e.error=r,{type:we.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:s,error:r,networkDetails:o,stats:i}}}function FS(n){var e;n==null||(e=n.play())==null||e.catch(()=>{})}function Au(n,e){return`[${n}] Advancing timeline position to ${e}`}class gU extends $n{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled||!this.schedule)return;const s=r-this.timelinePos;if(Math.abs(s)<1/7056e5)return;const o=s<=-.01;this.timelinePos=r,this.bufferedPos=r;const l=this.playingItem;if(!l){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(r,r-s)&&this.updateSchedule(!0),this.checkBuffer(),o&&r<l.start||r>=l.end){var c;const v=this.findItemIndex(l);let g=this.schedule.findItemIndexAtTime(r);if(g===-1&&(g=v+(o?-1:1),this.log(`seeked ${o?"back ":""}to position not covered by schedule ${r} (resolving from ${v} to ${g})`)),!this.isInterstitial(l)&&(c=this.media)!=null&&c.paused&&(this.shouldPlay=!1),!o&&g>v){const S=this.schedule.findJumpRestrictedIndex(v+1,g);if(S>v){this.setSchedulePosition(S);return}}this.setSchedulePosition(g);return}const d=this.playingAsset;if(!d){if(this.playingLastItem&&this.isInterstitial(l)){const v=l.event.assetList[0];v&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(r,v))}return}const f=d.timelineStart,h=d.duration||0;if(o&&r<f||r>=f+h){var p;(p=l.event)!=null&&p.appendInPlace&&(this.clearAssetPlayers(l.event,l),this.flushFrontBuffer(r)),this.setScheduleToAssetAtTime(r,d)}},this.onTimeupdate=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled)return;if(r>this.timelinePos)this.timelinePos=r,r>this.bufferedPos&&this.checkBuffer();else return;const s=this.playingItem;if(!s||this.playingLastItem)return;if(r>=s.end){this.timelinePos=s.end;const l=this.findItemIndex(s);this.setSchedulePosition(l+1)}const i=this.playingAsset;if(!i)return;const o=i.timelineStart+(i.duration||0);r>=o&&this.setScheduleToAssetAtTime(r,i)},this.onScheduleUpdate=(r,s)=>{const i=this.schedule;if(!i)return;const o=this.playingItem,l=i.events||[],c=i.items||[],d=i.durations,f=r.map(S=>S.identifier),h=!!(l.length||f.length);(h||s)&&this.log(`INTERSTITIALS_UPDATED (${l.length}): ${l}
Schedule: ${c.map(S=>Yn(S))} pos: ${this.timelinePos}`),f.length&&this.log(`Removed events ${f}`);let p=null,v=null;o&&(p=this.updateItem(o,this.timelinePos),this.itemsMatch(o,p)?this.playingItem=p:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const g=this.bufferingItem;if(g&&(v=this.updateItem(g,this.bufferedPos),this.itemsMatch(g,v)?this.bufferingItem=v:g.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(g.event,null))),r.forEach(S=>{S.assetList.forEach(x=>{this.clearAssetPlayer(x.identifier,null)})}),this.playerQueue.forEach(S=>{if(S.interstitial.appendInPlace){const x=S.assetItem.timelineStart,b=S.timelineOffset-x;if(b)try{S.timelineOffset=x}catch(A){Math.abs(b)>Wi&&this.warn(`${A} ("${S.assetId}" ${S.timelineOffset}->${x})`)}}}),h||s){if(this.hls.trigger(R.INTERSTITIALS_UPDATED,{events:l.slice(0),schedule:c.slice(0),durations:d,removedIds:f}),this.isInterstitial(o)&&f.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}o&&this.trimInPlace(p,o),g&&v!==p&&this.trimInPlace(v,g),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new pU(e),this.schedule=new mU(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(R.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(R.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(R.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(R.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(R.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(R.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(R.BUFFER_APPENDED,this.onBufferAppended,this),e.on(R.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(R.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(R.MEDIA_ENDED,this.onMediaEnded,this),e.on(R.ERROR,this.onError,this),e.on(R.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(R.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(R.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(R.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(R.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(R.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(R.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(R.BUFFER_CODECS,this.onBufferCodecs,this),e.off(R.BUFFER_APPENDED,this.onBufferAppended,this),e.off(R.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(R.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(R.MEDIA_ENDED,this.onMediaEnded,this),e.off(R.ERROR,this.onError,this),e.off(R.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){un(e,"play",this.onPlay),un(e,"pause",this.onPause),un(e,"seeking",this.onSeeking),un(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const r=this.media=t.media;Zt(r,"seeking",this.onSeeking),Zt(r,"timeupdate",this.onTimeupdate),Zt(r,"play",this.onPlay),Zt(r,"pause",this.onPause)}onMediaAttached(e,t){const r=this.effectivePlayingItem,s=this.detachedData;if(this.detachedData=null,r===null)this.checkStart();else if(!s){this.clearScheduleState();const i=this.findItemIndex(r);this.setSchedulePosition(i)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const r=!!t.transferMedia,s=this.media;if(this.media=null,!r&&(s&&this.removeMediaListeners(s),this.detachedData)){const i=this.getBufferingPlayer();i&&(this.log(`Removing schedule state for detachedData and ${i}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,i.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,r=h=>h&&e.getAssetPlayer(h.identifier),s=(h,p,v,g,S)=>{if(h){let x=h[p].start;const b=h.event;if(b){if(p==="playout"||b.timelineOccupancy!==xc.Point){const A=r(v);A?.interstitial===b&&(x+=A.assetItem.startOffset+A[S])}}else{const A=g==="bufferedPos"?o():e[g];x+=A-h.start}return x}return 0},i=(h,p)=>{var v;if(h!==0&&p!=="primary"&&(v=e.schedule)!=null&&v.length){var g;const S=e.schedule.findItemIndexAtTime(h),x=(g=e.schedule.items)==null?void 0:g[S];if(x){const b=x[p].start-x.start;return h+b}}return h},o=()=>{const h=e.bufferedPos;return h===Number.MAX_VALUE?l("primary"):Math.max(h,0)},l=h=>{var p,v;return(p=e.primaryDetails)!=null&&p.live?e.primaryDetails.edge:((v=e.schedule)==null?void 0:v.durations[h])||0},c=(h,p)=>{var v,g;const S=e.effectivePlayingItem;if(S!=null&&(v=S.event)!=null&&v.restrictions.skip||!e.schedule)return;e.log(`seek to ${h} "${p}"`);const x=e.effectivePlayingItem,b=e.schedule.findItemIndexAtTime(h,p),A=(g=e.schedule.items)==null?void 0:g[b],L=e.getBufferingPlayer(),I=L?.interstitial,k=I?.appendInPlace,F=x&&e.itemsMatch(x,A);if(x&&(k||F)){const C=r(e.playingAsset),P=C?.media||e.primaryMedia;if(P){const O=p==="primary"?P.currentTime:s(x,p,e.playingAsset,"timelinePos","currentTime"),M=h-O,H=(k?O:P.currentTime)+M;if(H>=0&&(!C||k||H<=C.duration)){P.currentTime=H;return}}}if(A){let C=h;if(p!=="primary"){const O=A[p].start,M=h-O;C=A.start+M}const P=!e.isInterstitial(A);if((!e.isInterstitial(x)||x.event.appendInPlace)&&(P||A.event.appendInPlace)){const O=e.media||(k?L?.media:null);O&&(O.currentTime=C)}else if(x){const O=e.findItemIndex(x);if(b>O){const H=e.schedule.findJumpRestrictedIndex(O+1,b);if(H>O){e.setSchedulePosition(H);return}}let M=0;if(P)e.timelinePos=C,e.checkBuffer();else{const H=A.event.assetList,Z=h-(A[p]||A).start;for(let se=H.length;se--;){const U=H[se];if(U.duration&&Z>=U.startOffset&&Z<U.startOffset+U.duration){M=se;break}}}e.setSchedulePosition(b,M)}}},d=()=>{const h=e.effectivePlayingItem;if(e.isInterstitial(h))return h;const p=t();return e.isInterstitial(p)?p:null},f={get bufferedEnd(){const h=t(),p=e.bufferingItem;if(p&&p===h){var v;return s(p,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-p.playout.start||((v=e.bufferingAsset)==null?void 0:v.startOffset)||0}return 0},get currentTime(){const h=d(),p=e.effectivePlayingItem;return p&&p===h?s(p,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-p.playout.start:0},set currentTime(h){const p=d(),v=e.effectivePlayingItem;v&&v===p&&c(h+v.playout.start,"playout")},get duration(){const h=d();return h?h.playout.end-h.playout.start:0},get assetPlayers(){var h;const p=(h=d())==null?void 0:h.event.assetList;return p?p.map(v=>e.getAssetPlayer(v.identifier)):[]},get playingIndex(){var h;const p=(h=d())==null?void 0:h.event;return p&&e.effectivePlayingAsset?p.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return d()}};return this.manager={get events(){var h;return((h=e.schedule)==null||(h=h.events)==null?void 0:h.slice(0))||[]},get schedule(){var h;return((h=e.schedule)==null||(h=h.items)==null?void 0:h.slice(0))||[]},get interstitialPlayer(){return d()?f:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const h=t();return e.findItemIndex(h)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const h=e.effectivePlayingItem;return e.findItemIndex(h)},primary:{get bufferedEnd(){return o()},get currentTime(){const h=e.timelinePos;return h>0?h:0},set currentTime(h){c(h,"primary")},get duration(){return l("primary")},get seekableStart(){var h;return((h=e.primaryDetails)==null?void 0:h.fragmentStart)||0}},integrated:{get bufferedEnd(){return s(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return s(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(h){c(h,"integrated")},get duration(){return l("integrated")},get seekableStart(){var h;return i(((h=e.primaryDetails)==null?void 0:h.fragmentStart)||0,"integrated")}},skip:()=>{const h=e.effectivePlayingItem,p=h?.event;if(p&&!p.restrictions.skip){const v=e.findItemIndex(h);if(p.appendInPlace){const g=h.playout.start+h.event.duration;c(g+.001,"playout")}else e.advanceAfterAssetEnded(p,v,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,r=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!r?!1:this.findItemIndex(t)===r.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const r=this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&!r.event.appendInPlace)return;let s=this.media;!s&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(s=this.primaryMedia);const i=(t=s)==null?void 0:t.currentTime;if(!(i===void 0||!he(i)))return i}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const r=this.getAssetPlayer(e);r&&this.transferMediaFromPlayer(r,t)}transferMediaFromPlayer(e,t){const r=e.interstitial.appendInPlace,s=e.media;if(r&&s===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&s){this.detachedData={media:s};return}const i=e.transferMedia();this.log(`transfer MediaSource from ${e} ${nt(i)}`),this.detachedData=i}else t&&s&&(this.shouldPlay||(this.shouldPlay=!s.paused))}transferMediaTo(e,t){var r,s;if(e.media===t)return;let i=null;const o=this.hls,l=e!==o,c=l&&e.interstitial.appendInPlace,d=(r=this.detachedData)==null?void 0:r.mediaSource;let f;if(o.media)c&&(i=o.transferMedia(),this.detachedData=i),f="Primary";else if(d){const g=this.getBufferingPlayer();g?(i=g.transferMedia(),f=`${g}`):f="detached MediaSource"}else f="detached media";if(!i){if(d)i=this.detachedData,this.log(`using detachedData: MediaSource ${nt(i)}`);else if(!this.detachedData||o.media===t){const g=this.playerQueue;g.length>1&&g.forEach(S=>{if(l&&S.interstitial.appendInPlace!==c){const x=S.interstitial;this.clearInterstitial(S.interstitial,null),x.appendInPlace=!1,x.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${x}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const h=i&&"mediaSource"in i&&((s=i.mediaSource)==null?void 0:s.readyState)!=="closed",p=h&&i?i:t;this.log(`${h?"transfering MediaSource":"attaching media"} to ${l?e:"Primary"} from ${f} (media.currentTime: ${t.currentTime})`);const v=this.schedule;if(p===i&&v){const g=l&&e.assetId===v.assetIdAtEnd;p.overrides={duration:v.duration,endOfStream:!l||g,cueRemoval:!l}}e.attachMedia(p)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e?.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const r=this.timelinePos,s=this.effectivePlayingItem;if(r===-1){const i=this.hls.startPosition;if(this.log(Au("checkStart",i)),this.timelinePos=i,t.length&&t[0].cue.pre){const o=e.findEventIndex(t[0].identifier);this.setSchedulePosition(o)}else if(i>=0||!this.primaryLive){const o=this.timelinePos=i>0?i:0,l=e.findItemIndexAtTime(o);this.setSchedulePosition(l)}}else if(s&&!this.playingItem){const i=e.findItemIndex(s);this.setSchedulePosition(i)}}advanceAssetBuffering(e,t){const r=e.event,s=r.findAssetIndex(t),i=Ih(r,s);if(!r.isAssetPastPlayoutLimit(i))this.bufferedToEvent(e,i);else if(this.schedule){var o;const l=(o=this.schedule.items)==null?void 0:o[this.findItemIndex(e)+1];l&&this.bufferedToItem(l)}}advanceAfterAssetEnded(e,t,r){const s=Ih(e,r);if(e.isAssetPastPlayoutLimit(s)){if(this.schedule){const i=this.schedule.items;if(i){const o=t+1,l=i.length;if(o>=l){this.setSchedulePosition(-1);return}const c=e.resumeTime;this.timelinePos<c&&(this.log(Au("advanceAfterAssetEnded",c)),this.timelinePos=c,e.appendInPlace&&this.advanceInPlace(c),this.checkBuffer(this.bufferedPos<c)),this.setSchedulePosition(o)}}}else{if(e.appendInPlace){const i=e.assetList[s];i&&this.advanceInPlace(i.timelineStart)}this.setSchedulePosition(t,s)}}setScheduleToAssetAtTime(e,t){const r=this.schedule;if(!r)return;const s=t.parentIdentifier,i=r.getEvent(s);if(i){const o=r.findEventIndex(s),l=r.findAssetIndex(i,e);this.advanceAfterAssetEnded(i,o,l-1)}}setSchedulePosition(e,t){var r;const s=(r=this.schedule)==null?void 0:r.items;if(!s||this.playbackDisabled)return;const i=e>=0?s[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${i&&Yn(i)}) pos: ${this.timelinePos}`);const o=this.waitingItem||this.playingItem,l=this.playingLastItem;if(this.isInterstitial(o)){const f=o.event,h=this.playingAsset,p=h?.identifier,v=p?this.getAssetPlayer(p):null;if(v&&p&&(!this.eventItemsMatch(o,i)||t!==void 0&&p!==f.assetList[t].identifier)){var c;const g=f.findAssetIndex(h);if(this.log(`INTERSTITIAL_ASSET_ENDED ${g+1}/${f.assetList.length} ${Bi(h)}`),this.endedAsset=h,this.playingAsset=null,this.hls.trigger(R.INTERSTITIAL_ASSET_ENDED,{asset:h,assetListIndex:g,event:f,schedule:s.slice(0),scheduleIndex:e,player:v}),o!==this.playingItem){this.itemsMatch(o,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(f,this.findItemIndex(this.playingItem),g);return}this.retreiveMediaSource(p,i),v.media&&!((c=this.detachedData)!=null&&c.mediaSource)&&v.detachMedia()}if(!this.eventItemsMatch(o,i)&&(this.endedItem=o,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${f} ${Yn(o)}`),f.hasPlayed=!0,this.hls.trigger(R.INTERSTITIAL_ENDED,{event:f,schedule:s.slice(0),scheduleIndex:e}),f.cue.once)){var d;this.updateSchedule();const g=(d=this.schedule)==null?void 0:d.items;if(i&&g){const S=this.findItemIndex(i);this.advanceSchedule(S,g,t,o,l)}return}}this.advanceSchedule(e,s,t,o,l)}advanceSchedule(e,t,r,s,i){const o=this.schedule;if(!o)return;const l=t[e]||null,c=this.primaryMedia,d=this.playerQueue;if(d.length&&d.forEach(f=>{const h=f.interstitial,p=o.findEventIndex(h.identifier);(p<e||p>e+1)&&this.clearInterstitial(h,l)}),this.isInterstitial(l)){this.timelinePos=Math.min(Math.max(this.timelinePos,l.start),l.end);const f=l.event;if(r===void 0){r=o.findAssetIndex(f,this.timelinePos);const g=Ih(f,r-1);if(f.isAssetPastPlayoutLimit(g)||f.appendInPlace&&this.timelinePos===l.end){this.advanceAfterAssetEnded(f,e,r);return}r=g}const h=this.waitingItem;this.assetsBuffered(l,c)||this.setBufferingItem(l);let p=this.preloadAssets(f,r);if(this.eventItemsMatch(l,h||s)||(this.waitingItem=l,this.log(`INTERSTITIAL_STARTED ${Yn(l)} ${f.appendInPlace?"append in place":""}`),this.hls.trigger(R.INTERSTITIAL_STARTED,{event:f,schedule:t.slice(0),scheduleIndex:e})),!f.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${f}`);return}if(f.assetListLoader&&(f.assetListLoader.destroy(),f.assetListLoader=void 0),!c){this.log(`Waiting for attachMedia to start Interstitial ${f}`);return}this.waitingItem=this.endedItem=null,this.playingItem=l;const v=f.assetList[r];if(!v){this.advanceAfterAssetEnded(f,e,r||0);return}if(p||(p=this.getAssetPlayer(v.identifier)),p===null||p.destroyed){const g=f.assetList.length;this.warn(`asset ${r+1}/${g} player destroyed ${f}`),p=this.createAssetPlayer(f,v,r),p.loadSource()}if(!this.eventItemsMatch(l,this.bufferingItem)&&f.appendInPlace&&this.isAssetBuffered(v))return;this.startAssetPlayer(p,r,t,e,c),this.shouldPlay&&FS(p.media)}else l?(this.resumePrimary(l,e,s),this.shouldPlay&&FS(this.hls.media)):i&&this.isInterstitial(s)&&(this.endedItem=null,this.playingItem=s,s.event.appendInPlace||this.attachPrimary(o.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,r){var s,i;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Yn(e)}`),!((s=this.detachedData)!=null&&s.mediaSource)){let l=this.timelinePos;(l<e.start||l>=e.end)&&(l=this.getPrimaryResumption(e,t),this.log(Au("resumePrimary",l)),this.timelinePos=l),this.attachPrimary(l,e)}if(!r)return;const o=(i=this.schedule)==null?void 0:i.items;o&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${Yn(e)}`),this.hls.trigger(R.INTERSTITIALS_PRIMARY_RESUMED,{schedule:o.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const r=e.start;if(this.primaryLive){const s=this.primaryDetails;if(t===0)return this.hls.startPosition;if(s&&(r<s.fragmentStart||r>s.edge))return this.hls.liveSyncPosition||-1}return r}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:Oe.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,r){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const s=this.primaryMedia;if(!s)return;const i=this.hls;i.media?this.checkBuffer():(this.transferMediaTo(i,s),r&&this.startLoadingPrimaryAt(e,r)),r||(this.log(Au("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,r))}startLoadingPrimaryAt(e,t){var r;const s=this.hls;!s.loadingEnabled||!s.media||Math.abs((((r=s.mainForwardBufferInfo)==null?void 0:r.start)||s.media.currentTime)-e)>.5?s.startLoad(e,t):s.bufferingEnabled||s.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(R.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(R.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const r=this.hls.levels[t.level];if(!r.details)return;const s=Je(Je({},this.mediaSelection||this.altSelection),{},{main:r});this.mediaSelection=s,this.schedule.parseInterstitialDateRanges(s,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const r=this.hls.audioTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=Je(Je({},this.altSelection),{},{audio:r});return}const i=Je(Je({},s),{},{audio:r});this.mediaSelection=i}onSubtitleTrackUpdated(e,t){const r=this.hls.subtitleTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=Je(Je({},this.altSelection),{},{subtitles:r});return}const i=Je(Je({},s),{},{subtitles:r});this.mediaSelection=i}onAudioTrackSwitching(e,t){const r=zx(t);this.playerQueue.forEach(({hls:s})=>s&&(s.setAudioOption(t)||s.setAudioOption(r)))}onSubtitleTrackSwitch(e,t){const r=zx(t);this.playerQueue.forEach(({hls:s})=>s&&(s.setSubtitleOption(t)||t.id!==-1&&s.setSubtitleOption(r)))}onBufferCodecs(e,t){const r=t.tracks;r&&(this.requiredTracks=r)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const r=this.playingItem;if(r&&!this.itemsMatch(r,this.bufferingItem)&&!this.isInterstitial(r)){const s=this.timelinePos;this.bufferedPos=s,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let s=0;s<t.length;s++){const i=t[s];if(i.cue.post){var r;const o=this.schedule.findEventIndex(i.identifier),l=(r=this.schedule.items)==null?void 0:r[o];this.isInterstitial(l)&&this.eventItemsMatch(l,this.bufferingItem)&&this.bufferedToItem(l,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const r=this.findItemIndex(t);this.setSchedulePosition(r+1)}else this.shouldPlay=!1}updateItem(e,t){var r;const s=(r=this.schedule)==null?void 0:r.items;if(e&&s){const i=this.findItemIndex(e,t);return s[i]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((i,o)=>{e.event.isAssetPastPlayoutLimit(o)&&this.clearAssetPlayer(i.identifier,null)});const r=e.end+.25,s=Oe.bufferInfo(this.primaryMedia,r,0);(s.end>r||(s.nextStart||0)>r)&&(this.log(`trim buffered interstitial ${Yn(e)} (was ${Yn(t)})`),this.attachPrimary(r,null,!0),this.flushFrontBuffer(r))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var r;return!!t&&(e===t||e.event.identifier===((r=t.event)==null?void 0:r.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const r=this.mediaSelection;r&&((t=this.schedule)==null||t.updateSchedule(r,[],e))}checkBuffer(e){var t;const r=(t=this.schedule)==null?void 0:t.items;if(!r)return;const s=Oe.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=s.len<1),this.updateBufferedPos(s.end,r,e)}updateBufferedPos(e,t,r){const s=this.schedule,i=this.bufferingItem;if(this.bufferedPos>e||!s)return;if(t.length===1&&this.itemsMatch(t[0],i)){this.bufferedPos=e;return}const o=this.playingItem,l=this.findItemIndex(o);let c=s.findItemIndexAtTime(e);if(this.bufferedPos<e){var d;const f=this.findItemIndex(i),h=Math.min(f+1,t.length-1),p=t[h];if((c===-1&&i&&e>=i.end||(d=p.event)!=null&&d.appendInPlace&&e+.01>=p.start)&&(c=h),this.isInterstitial(i)){const v=i.event;if(h-l>1&&v.appendInPlace===!1||v.assetList.length===0&&v.assetListLoader)return}if(this.bufferedPos=e,c>f&&c>l)this.bufferedToItem(p);else{const v=this.primaryDetails;this.primaryLive&&v&&e>v.edge-v.targetduration&&p.start<v.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(p)&&this.preloadAssets(p.event,0)}}else r&&o&&!this.itemsMatch(o,i)&&(c===l?this.bufferedToItem(o):c===l+1&&this.bufferedToItem(t[c]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(s=>{const i=this.getAssetPlayer(s.identifier);return!(i!=null&&i.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,r=this.schedule;if(!this.itemsMatch(e,t)&&r){const{items:s,events:i}=r;if(!s||!i)return t;const o=this.isInterstitial(e),l=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const c=l?l.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${Yn(e)}`+(t?` (${c.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(o){const d=r.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((f,h)=>{const p=this.getAssetPlayer(f.identifier);p&&(h===d&&p.loadSource(),p.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(d=>d.pauseBuffering());this.hls.trigger(R.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:i.slice(0),schedule:s.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const r=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(r!==null){this.bufferingAsset=null;const s=this.detachedData;s?s.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),r=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(r)}bufferedToEvent(e,t){const r=e.event,s=r.assetList.length===0&&!r.assetListLoader,i=r.cue.once;if(s||!i){const o=this.preloadAssets(r,t);if(o!=null&&o.interstitial.appendInPlace){const l=this.primaryMedia;l&&this.bufferAssetPlayer(o,l)}}}preloadAssets(e,t){const r=e.assetUrl,s=e.assetList.length,i=s===0&&!e.assetListLoader,o=e.cue.once;if(i){const c=e.timelineStart;if(e.appendInPlace){var l;const p=this.playingItem;!this.isInterstitial(p)&&(p==null||(l=p.nextEvent)==null?void 0:l.identifier)===e.identifier&&this.flushFrontBuffer(c+.25)}let d,f=0;if(!this.playingItem&&this.primaryLive&&(f=this.hls.startPosition,f===-1&&(f=this.hls.liveSyncPosition||0)),f&&!(e.cue.pre||e.cue.post)){const p=f-c;p>0&&(d=Math.round(p*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${r?1:s} ${e}${d?` live-start: ${f} start-offset: ${d}`:""}`),r)return this.createAsset(e,0,0,c,e.duration,r);const h=this.assetListLoader.loadAssetList(e,d);h&&(e.assetListLoader=h)}else if(!o&&s){for(let d=t;d<s;d++){const f=e.assetList[d],h=this.getAssetPlayerQueueIndex(f.identifier);(h===-1||this.playerQueue[h].destroyed)&&!f.error&&this.createAssetPlayer(e,f,d)}const c=e.assetList[t];if(c){const d=this.getAssetPlayer(c.identifier);return d&&d.loadSource(),d}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(s=>{this.hls.trigger(R.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:s})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let r=0;r<t.length;r++)if(e===t[r].assetId)return r;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let r=0;r<e.length;r++)if(e[r].media===t)return e[r]}return null}createAsset(e,t,r,s,i,o){const l={parentIdentifier:e.identifier,identifier:cU(e,o,t),duration:i,startOffset:r,timelineStart:s,uri:o};return this.createAssetPlayer(e,l,t)}createAssetPlayer(e,t,r){const s=this.hls,i=s.userConfig;let o=i.videoPreference;const l=s.loadLevelObj||s.levels[s.currentLevel];(o||l)&&(o=et({},o),l.videoCodec&&(o.videoCodec=l.videoCodec),l.videoRange&&(o.allowedVideoRanges=[l.videoRange]));const c=s.audioTracks[s.audioTrack],d=s.subtitleTracks[s.subtitleTrack];let f=0;if(this.primaryLive||e.appendInPlace){const I=this.timelinePos-t.timelineStart;if(I>1){const k=t.duration;k&&I<k&&(f=I)}}const h=t.identifier,p=Je(Je({},i),{},{maxMaxBufferLength:Math.min(180,s.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:s.sessionId,assetPlayerId:h,abrEwmaDefaultEstimate:s.bandwidthEstimate,interstitialsController:void 0,startPosition:f,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:c||i.audioPreference,subtitlePreference:d||i.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(p.timelineOffset=t.timelineStart));const v=p.cmcd;v!=null&&v.sessionId&&v.contentId&&(p.cmcd=et({},v,{contentId:pa(t.uri)})),this.getAssetPlayer(h)&&this.warn(`Duplicate date range identifier ${e} and asset ${h}`);const g=new hU(this.HlsPlayerClass,p,e,t);this.playerQueue.push(g),e.assetList[r]=t;let S=!0;const x=I=>{if(I.live){var k;const P=new Error(`Interstitials MUST be VOD assets ${e}`),O={fatal:!0,type:we.OTHER_ERROR,details:z.INTERSTITIAL_ASSET_ITEM_ERROR,error:P},M=((k=this.schedule)==null?void 0:k.findEventIndex(e.identifier))||-1;this.handleAssetItemError(O,e,M,r,P.message);return}const F=I.edge-I.fragmentStart,C=t.duration;(S||C===null||F>C)&&(S=!1,this.log(`Interstitial asset "${h}" duration change ${C} > ${F}`),t.duration=F,this.updateSchedule())};g.on(R.LEVEL_UPDATED,(I,{details:k})=>x(k)),g.on(R.LEVEL_PTS_UPDATED,(I,{details:k})=>x(k)),g.on(R.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const b=(I,k)=>{const F=this.getAssetPlayer(h);if(F&&k.tracks){F.off(R.BUFFER_CODECS,b),F.tracks=k.tracks;const C=this.primaryMedia;this.bufferingAsset===F.assetItem&&C&&!F.media&&this.bufferAssetPlayer(F,C)}};g.on(R.BUFFER_CODECS,b);const A=()=>{var I;const k=this.getAssetPlayer(h);if(this.log(`buffered to end of asset ${k}`),!k||!this.schedule)return;const F=this.schedule.findEventIndex(e.identifier),C=(I=this.schedule.items)==null?void 0:I[F];this.isInterstitial(C)&&this.advanceAssetBuffering(C,t)};g.on(R.BUFFERED_TO_END,A);const L=I=>()=>{if(!this.getAssetPlayer(h)||!this.schedule)return;this.shouldPlay=!0;const F=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,F,I)};return g.once(R.MEDIA_ENDED,L(r)),g.once(R.PLAYOUT_LIMIT_REACHED,L(1/0)),g.on(R.ERROR,(I,k)=>{if(!this.schedule)return;const F=this.getAssetPlayer(h);if(k.details===z.BUFFER_STALLED_ERROR){if(F!=null&&F.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(k,e,this.schedule.findEventIndex(e.identifier),r,`Asset player error ${k.error} ${e}`)}),g.on(R.DESTROYING,()=>{if(!this.getAssetPlayer(h)||!this.schedule)return;const k=new Error(`Asset player destroyed unexpectedly ${h}`),F={fatal:!0,type:we.OTHER_ERROR,details:z.INTERSTITIAL_ASSET_ITEM_ERROR,error:k};this.handleAssetItemError(F,e,this.schedule.findEventIndex(e.identifier),r,k.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${Bi(t)}`),this.hls.trigger(R.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:r,event:e,player:g}),g}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(r=>{this.clearAssetPlayer(r.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const r=this.playerQueue[t];this.transferMediaFromPlayer(r,null),r.resetDetails()}}clearAssetPlayer(e,t){const r=this.getAssetPlayerQueueIndex(e);if(r!==-1){const s=this.playerQueue[r];this.log(`clear ${s} toSegment: ${t&&Yn(t)}`),this.transferMediaFromPlayer(s,t),this.playerQueue.splice(r,1),s.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,r,s,i){const{interstitial:o,assetItem:l,assetId:c}=e,d=o.assetList.length,f=this.playingAsset;this.endedAsset=null,this.playingAsset=l,(!f||f.identifier!==c)&&(f&&(this.clearAssetPlayer(f.identifier,r[s]),delete f.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${d} ${Bi(l)}`),this.hls.trigger(R.INTERSTITIAL_ASSET_STARTED,{asset:l,assetListIndex:t,event:o,schedule:r.slice(0),scheduleIndex:s,player:e})),this.bufferAssetPlayer(e,i)}bufferAssetPlayer(e,t){var r,s;if(!this.schedule)return;const{interstitial:i,assetItem:o}=e,l=this.schedule.findEventIndex(i.identifier),c=(r=this.schedule.items)==null?void 0:r[l];if(!c)return;e.loadSource(),this.setBufferingItem(c),this.bufferingAsset=o;const d=this.getBufferingPlayer();if(d===e)return;const f=i.appendInPlace;if(f&&d?.interstitial.appendInPlace===!1)return;const h=d?.tracks||((s=this.detachedData)==null?void 0:s.tracks)||this.requiredTracks;if(f&&o!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(h&&!Gb(h,e.tracks)){const p=new Error(`Asset ${Bi(o)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(h)}')`),v={fatal:!0,type:we.OTHER_ERROR,details:z.INTERSTITIAL_ASSET_ITEM_ERROR,error:p},g=i.findAssetIndex(o);this.handleAssetItemError(v,i,l,g,p.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,r=this.primaryMedia;if(!t||!r)return;const s=r.currentTime,i=t.findAssetIndex(e,s),o=e.assetList[i];if(o){const l=this.getAssetPlayer(o.identifier);if(l){const c=l.currentTime||s-o.timelineStart,d=l.duration-c;if(this.warn(`Stalled at ${c} of ${c+d} in ${l} ${e} (media.currentTime: ${s})`),c&&(d/r.playbackRate<.5||l.bufferedInPlaceToEnd(r))&&l.hls){const f=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,f,i)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,r,s,i){if(e.details===z.BUFFER_STALLED_ERROR)return;const o=t.assetList[s]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${o&&Bi(o)} ${e.error}`),!this.schedule)return;const l=o?.identifier||"",c=this.getAssetPlayerQueueIndex(l),d=this.playerQueue[c]||null,f=this.schedule.items,h=et({},e,{fatal:!1,errorAction:Hi(!0),asset:o,assetListIndex:s,event:t,schedule:f,scheduleIndex:r,player:d});if(this.hls.trigger(R.INTERSTITIAL_ASSET_ERROR,h),!e.fatal)return;const p=this.playingAsset,v=this.bufferingAsset,g=new Error(i);if(o&&(this.clearAssetPlayer(l,null),o.error=g),!t.assetList.some(S=>!S.error))t.error=g;else for(let S=s;S<t.assetList.length;S++)this.resetAssetPlayer(t.assetList[S].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):p&&p.identifier===l?this.advanceAfterAssetEnded(t,r,s):v&&v.identifier===l&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,v)}primaryFallback(e){const t=e.timelineStart,r=this.effectivePlayingItem;let s=this.timelinePos;if(r){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${s} playing: ${Yn(r)} error: ${e.error}`),s===-1&&(s=this.hls.startPosition);const o=this.updateItem(r,s);this.itemsMatch(r,o)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(s===-1){this.checkStart();return}if(!this.schedule)return;const i=this.schedule.findItemIndexAtTime(s);this.setSchedulePosition(i)}onAssetListLoaded(e,t){var r,s;const i=t.event,o=i.identifier,l=t.assetListResponse.ASSETS;if(!((r=this.schedule)!=null&&r.hasEvent(o)))return;const c=i.timelineStart,d=i.duration;let f=0;l.forEach((S,x)=>{const b=parseFloat(S.DURATION);this.createAsset(i,x,f,c+f,b,S.URI),f+=b}),i.duration=f,this.log(`Loaded asset-list with duration: ${f} (was: ${d}) ${i}`);const h=this.waitingItem,p=h?.event.identifier===o;this.updateSchedule();const v=(s=this.bufferingItem)==null?void 0:s.event;if(p){var g;const S=this.schedule.findEventIndex(o),x=(g=this.schedule.items)==null?void 0:g[S];if(x){if(!this.playingItem&&this.timelinePos>x.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==S){i.error=new Error(`Interstitial ${l.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${i}`),this.log(i.error.message),this.updateSchedule(!0),this.primaryFallback(i);return}this.setBufferingItem(x)}this.setSchedulePosition(S)}else if(v?.identifier===o){const S=i.assetList[0];if(S){const x=this.getAssetPlayer(S.identifier);if(v.appendInPlace){const b=this.primaryMedia;x&&b&&this.bufferAssetPlayer(x,b)}else x&&x.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case z.ASSET_LIST_PARSING_ERROR:case z.ASSET_LIST_LOAD_ERROR:case z.ASSET_LIST_LOAD_TIMEOUT:{const r=t.interstitial;r&&(this.updateSchedule(!0),this.primaryFallback(r));break}case z.BUFFER_STALLED_ERROR:{const r=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&r.event.appendInPlace){this.handleInPlaceStall(r.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const BS=500;class yU extends jp{constructor(e,t,r){super(e,t,r,"subtitle-stream-controller",ge.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(R.LEVEL_LOADED,this.onLevelLoaded,this),e.on(R.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(R.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(R.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(R.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(R.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(R.LEVEL_LOADED,this.onLevelLoaded,this),e.off(R.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(R.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(R.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(R.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(R.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=re.IDLE,this.setInterval(BS),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:r,success:s}=t;if(this.fragContextChanged(r)||(Et(r)&&(this.fragPrevious=r),this.state=re.IDLE),!s)return;const i=this.tracksBuffered[this.currentTrackId];if(!i)return;let o;const l=r.start;for(let d=0;d<i.length;d++)if(l>=i[d].start&&l<=i[d].end){o=i[d];break}const c=r.start+r.duration;o?o.end=c:(o={start:l,end:c},i.push(o)),this.fragmentTracker.fragBuffered(r),this.fragBufferedComplete(r,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:r,endOffset:s}=t;if(r===0&&s!==Number.POSITIVE_INFINITY){const i=s-1;if(i<=0)return;t.endOffsetSubtitles=Math.max(0,i),this.tracksBuffered.forEach(o=>{for(let l=0;l<o.length;){if(o[l].end<=i){o.shift();continue}else if(o[l].start<i)o[l].start=i;else break;l++}}),this.fragmentTracker.removeFragmentsInRange(r,i,ge.SUBTITLE)}}onError(e,t){const r=t.frag;r?.type===ge.SUBTITLE&&(t.details===z.FRAG_GAP&&this.fragmentTracker.fragBuffered(r,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==re.STOPPED&&(this.state=re.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&zw(this.levels,t)){this.levels=t.map(r=>new _a(r));return}this.tracksBuffered=[],this.levels=t.map(r=>{const s=new _a(r);return this.tracksBuffered[s.id]=[],s}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,ge.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var r;if(this.currentTrackId=t.id,!((r=this.levels)!=null&&r.length)||this.currentTrackId===-1){this.clearInterval();return}const s=this.levels[this.currentTrackId];s!=null&&s.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,s&&this.state!==re.STOPPED&&this.setInterval(BS)}onSubtitleTrackLoaded(e,t){var r;const{currentTrackId:s,levels:i}=this,{details:o,id:l}=t;if(!i){this.warn(`Subtitle tracks were reset while loading level ${l}`);return}const c=i[l];if(l>=i.length||!c)return;this.log(`Subtitle track ${l} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let d=0;if(o.live||(r=c.details)!=null&&r.live){if(o.deltaUpdateFailed)return;const h=this.mainDetails;if(!h){this.startFragRequested=!1;return}const p=h.fragments[0];if(!c.details)o.hasProgramDateTime&&h.hasProgramDateTime?(yc(o,h),d=o.fragmentStart):p&&(d=p.start,Cm(o,d));else{var f;d=this.alignPlaylists(o,c.details,(f=this.levelLastLoaded)==null?void 0:f.details),d===0&&p&&(d=p.start,Cm(o,d))}h&&!this.startFragRequested&&this.setStartPosition(h,d)}c.details=o,this.levelLastLoaded=c,l===s&&(this.hls.trigger(R.SUBTITLE_TRACK_UPDATED,{details:o,id:l,groupId:t.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===re.IDLE&&(ii(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),c.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:r}=e,s=t.decryptdata,i=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&s!=null&&s.key&&s.iv&&Ki(s.method)){const o=performance.now();this.decrypter.decrypt(new Uint8Array(r),s.key.buffer,s.iv.buffer,Up(s.method)).catch(l=>{throw i.trigger(R.ERROR,{type:we.MEDIA_ERROR,details:z.FRAG_DECRYPT_ERROR,fatal:!1,error:l,reason:l.message,frag:t}),l}).then(l=>{const c=performance.now();i.trigger(R.FRAG_DECRYPTED,{frag:t,payload:l,stats:{tstart:o,tdecrypt:c}})}).catch(l=>{this.warn(`${l.name}: ${l.message}`),this.state=re.IDLE})}}doTick(){if(!this.media){this.state=re.IDLE;return}if(this.state===re.IDLE){const{currentTrackId:e,levels:t}=this,r=t?.[e];if(!r||!t.length||!r.details||this.waitForLive(r))return;const{config:s}=this,i=this.getLoadPosition(),o=Oe.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],i,s.maxBufferHole),{end:l,len:c}=o,d=r.details,f=this.hls.maxBufferLength+d.levelTargetDuration;if(c>f)return;const h=d.fragments,p=h.length,v=d.edge;let g=null;const S=this.fragPrevious;if(l<v){const A=s.maxFragLookUpTolerance,L=l>v-A?0:A;g=ii(S,h,Math.max(h[0].start,l),L),!g&&S&&S.start<h[0].start&&(g=h[0])}else g=h[p-1];if(g=this.filterReplacedPrimary(g,r.details),!g)return;const x=g.sn-d.startSN,b=h[x-1];if(b&&b.cc===g.cc&&this.fragmentTracker.getState(b)===_t.NOT_LOADED&&(g=b),this.fragmentTracker.getState(g)===_t.NOT_LOADED){const A=this.mapToInitFragWhenRequired(g);A&&this.loadFragment(A,r,l)}}}loadFragment(e,t,r){Et(e)?super.loadFragment(e,t,r):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new vU(this.tracksBuffered[this.currentTrackId]||[])}}class vU{constructor(e){this.buffered=void 0;const t=(r,s,i)=>{if(s=s>>>0,s>i-1)throw new DOMException(`Failed to execute '${r}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${i})`);return e[s][r]};this.buffered={get length(){return e.length},end(r){return t("end",r,e.length)},start(r){return t("start",r,e.length)}}}}const xU={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},l1=n=>String.fromCharCode(xU[n]||n),Xn=15,Nr=100,SU={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},EU={17:2,18:4,21:6,22:8,23:10,19:13,20:15},TU={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},bU={25:2,26:4,29:6,30:8,31:10,27:13,28:15},wU=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class AU{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const r=typeof t=="function"?t():t;Ze.log(`${this.time} [${e}] ${r}`)}}}const Ks=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].toString(16));return t};class u1{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let r=0;r<t.length;r++){const s=t[r];e.hasOwnProperty(s)&&(this[s]=e[s])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class LU{constructor(){this.uchar=" ",this.penState=new u1}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class RU{constructor(e){this.chars=[],this.pos=0,this.currPenState=new u1,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Nr;t++)this.chars.push(new LU);this.logger=e}equals(e){for(let t=0;t<Nr;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Nr;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Nr;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Nr&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Nr)}moveCursor(e){const t=this.pos+e;if(e>1)for(let r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=l1(e);if(this.pos>=Nr){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Nr;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let r=0;r<Nr;r++){const s=this.chars[r].uchar;s!==" "&&(t=!1),e.push(s)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class _h{constructor(e){this.rows=[],this.currRow=Xn-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Xn;t++)this.rows.push(new RU(e));this.logger=e}reset(){for(let e=0;e<Xn;e++)this.rows[e].clear();this.currRow=Xn-1}equals(e){let t=!0;for(let r=0;r<Xn;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}copy(e){for(let t=0;t<Xn;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Xn;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+nt(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let l=0;l<Xn;l++)this.rows[l].clear();const i=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const l=o.rows[i].cueStartTime,c=this.logger.time;if(l!==null&&c!==null&&l<c)for(let d=0;d<this.nrRollUpRows;d++)this.rows[t-this.nrRollUpRows+d+1].copy(o.rows[i+d])}}this.currRow=t;const r=this.rows[this.currRow];if(e.indent!==null){const i=e.indent,o=Math.max(i-1,0);r.setCursor(e.indent),e.color=r.chars[o].penState.foreground}const s={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(s)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+nt(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let r="",s=-1;for(let i=0;i<Xn;i++){const o=this.rows[i].getTextString();o&&(s=i+1,e?t.push("Row "+s+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e?r="["+t.join(" | ")+"]":r=t.join(`
`)),r}getTextAndFormat(){return this.rows}}class US{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new _h(r),this.nonDisplayedMemory=new _h(r),this.lastOutputScreen=new _h(r),this.currRollUpRow=this.displayedMemory.rows[Xn-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Xn-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const r=Math.floor(e/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=s[r]}this.logger.log(2,"MIDROW: "+nt(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class $S{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=_U(),this.logger=void 0;const s=this.logger=new AU;this.channels=[null,new US(e,t,s),new US(e+1,r,s)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let r=0;r<t.length;r+=2){const s=t[r]&127,i=t[r+1]&127;let o=!1,l=null;if(s===0&&i===0)continue;this.logger.log(3,()=>"["+Ks([t[r],t[r+1]])+"] -> ("+Ks([s,i])+")");const c=this.cmdHistory;if(s>=16&&s<=31){if(IU(s,i,c)){Lu(null,null,c),this.logger.log(3,()=>"Repeated command ("+Ks([s,i])+") is dropped");continue}Lu(s,i,this.cmdHistory),o=this.parseCmd(s,i),o||(o=this.parseMidrow(s,i)),o||(o=this.parsePAC(s,i)),o||(o=this.parseBackgroundAttributes(s,i))}else Lu(null,null,c);if(!o&&(l=this.parseChars(s,i),l)){const f=this.currentChannel;f&&f>0?this.channels[f].insertChars(l):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!l&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Ks([s,i])+" orig: "+Ks([t[r],t[r+1]]))}}parseCmd(e,t){const r=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=33&&t<=35;if(!(r||s))return!1;const i=e===20||e===21||e===23?1:2,o=this.channels[i];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),this.currentChannel=i,!0}parseMidrow(e,t){let r=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?r=1:r=2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const s=this.channels[r];return s?(s.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Ks([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let r;const s=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,i=(e===16||e===24)&&t>=64&&t<=95;if(!(s||i))return!1;const o=e<=23?1:2;t>=64&&t<=95?r=o===1?SU[e]:TU[e]:r=o===1?EU[e]:bU[e];const l=this.channels[o];return l?(l.setPAC(this.interpretPAC(r,t)),this.currentChannel=o,!0):!1}interpretPAC(e,t){let r;const s={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?r=t-96:r=t-64,s.underline=(r&1)===1,r<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(s.italics=!0,s.color="white"):s.indent=Math.floor((r-16)/2)*4,s}parseChars(e,t){let r,s=null,i=null;if(e>=25?(r=2,i=e-8):(r=1,i=e),i>=17&&i<=19){let o;i===17?o=t+80:i===18?o=t+112:o=t+144,this.logger.log(2,()=>"Special char '"+l1(o)+"' in channel "+r),s=[o]}else e>=32&&e<=127&&(s=t===0?[e]:[e,t]);return s&&this.logger.log(3,()=>"Char codes =  "+Ks(s).join(",")),s}parseBackgroundAttributes(e,t){const r=(e===16||e===24)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=45&&t<=47;if(!(r||s))return!1;let i;const o={};e===16||e===24?(i=Math.floor((t-32)/2),o.background=wU[i],t%2===1&&(o.background=o.background+"_semi")):t===45?o.background="transparent":(o.foreground="black",t===47&&(o.underline=!0));const l=e<=23?1:2;return this.channels[l].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Lu(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const r=this.channels[t];r&&r.cueSplitAtTime(e)}}}function Lu(n,e,t){t.a=n,t.b=e}function IU(n,e,t){return t.a===n&&t.b===e}function _U(){return{a:null,b:null}}var Zp=(function(){if(gc!=null&&gc.VTTCue)return self.VTTCue;const n=["","lr","rl"],e=["start","middle","end","left","right"];function t(l,c){if(typeof c!="string"||!Array.isArray(l))return!1;const d=c.toLowerCase();return~l.indexOf(d)?d:!1}function r(l){return t(n,l)}function s(l){return t(e,l)}function i(l,...c){let d=1;for(;d<arguments.length;d++){const f=arguments[d];for(const h in f)l[h]=f[h]}return l}function o(l,c,d){const f=this,h={enumerable:!0};f.hasBeenReset=!1;let p="",v=!1,g=l,S=c,x=d,b=null,A="",L=!0,I="auto",k="start",F=50,C="middle",P=50,O="middle";Object.defineProperty(f,"id",i({},h,{get:function(){return p},set:function(M){p=""+M}})),Object.defineProperty(f,"pauseOnExit",i({},h,{get:function(){return v},set:function(M){v=!!M}})),Object.defineProperty(f,"startTime",i({},h,{get:function(){return g},set:function(M){if(typeof M!="number")throw new TypeError("Start time must be set to a number.");g=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"endTime",i({},h,{get:function(){return S},set:function(M){if(typeof M!="number")throw new TypeError("End time must be set to a number.");S=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"text",i({},h,{get:function(){return x},set:function(M){x=""+M,this.hasBeenReset=!0}})),Object.defineProperty(f,"region",i({},h,{get:function(){return b},set:function(M){b=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"vertical",i({},h,{get:function(){return A},set:function(M){const H=r(M);if(H===!1)throw new SyntaxError("An invalid or illegal string was specified.");A=H,this.hasBeenReset=!0}})),Object.defineProperty(f,"snapToLines",i({},h,{get:function(){return L},set:function(M){L=!!M,this.hasBeenReset=!0}})),Object.defineProperty(f,"line",i({},h,{get:function(){return I},set:function(M){if(typeof M!="number"&&M!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");I=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"lineAlign",i({},h,{get:function(){return k},set:function(M){const H=s(M);if(!H)throw new SyntaxError("An invalid or illegal string was specified.");k=H,this.hasBeenReset=!0}})),Object.defineProperty(f,"position",i({},h,{get:function(){return F},set:function(M){if(M<0||M>100)throw new Error("Position must be between 0 and 100.");F=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"positionAlign",i({},h,{get:function(){return C},set:function(M){const H=s(M);if(!H)throw new SyntaxError("An invalid or illegal string was specified.");C=H,this.hasBeenReset=!0}})),Object.defineProperty(f,"size",i({},h,{get:function(){return P},set:function(M){if(M<0||M>100)throw new Error("Size must be between 0 and 100.");P=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"align",i({},h,{get:function(){return O},set:function(M){const H=s(M);if(!H)throw new SyntaxError("An invalid or illegal string was specified.");O=H,this.hasBeenReset=!0}})),f.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o})();class CU{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function c1(n){function e(r,s,i,o){return(r|0)*3600+(s|0)*60+(i|0)+parseFloat(o||0)}const t=n.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class kU{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let s=0;s<r.length;++s)if(t===r[s]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}function d1(n,e,t,r){const s=r?n.split(r):[n];for(const i in s){if(typeof s[i]!="string")continue;const o=s[i].split(t);if(o.length!==2)continue;const l=o[0],c=o[1];e(l,c)}}const Bm=new Zp(0,0,""),Ru=Bm.align==="middle"?"middle":"center";function PU(n,e,t){const r=n;function s(){const l=c1(n);if(l===null)throw new Error("Malformed timestamp: "+r);return n=n.replace(/^[^\sa-zA-Z-]+/,""),l}function i(l,c){const d=new kU;d1(l,function(p,v){let g;switch(p){case"region":for(let S=t.length-1;S>=0;S--)if(t[S].id===v){d.set(p,t[S].region);break}break;case"vertical":d.alt(p,v,["rl","lr"]);break;case"line":g=v.split(","),d.integer(p,g[0]),d.percent(p,g[0])&&d.set("snapToLines",!1),d.alt(p,g[0],["auto"]),g.length===2&&d.alt("lineAlign",g[1],["start",Ru,"end"]);break;case"position":g=v.split(","),d.percent(p,g[0]),g.length===2&&d.alt("positionAlign",g[1],["start",Ru,"end","line-left","line-right","auto"]);break;case"size":d.percent(p,v);break;case"align":d.alt(p,v,["start",Ru,"end","left","right"]);break}},/:/,/\s/),c.region=d.get("region",null),c.vertical=d.get("vertical","");let f=d.get("line","auto");f==="auto"&&Bm.line===-1&&(f=-1),c.line=f,c.lineAlign=d.get("lineAlign","start"),c.snapToLines=d.get("snapToLines",!0),c.size=d.get("size",100),c.align=d.get("align",Ru);let h=d.get("position","auto");h==="auto"&&Bm.position===50&&(h=c.align==="start"||c.align==="left"?0:c.align==="end"||c.align==="right"?100:50),c.position=h}function o(){n=n.replace(/^\s+/,"")}if(o(),e.startTime=s(),o(),n.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+r);n=n.slice(3),o(),e.endTime=s(),o(),i(n,e)}function f1(n){return n.replace(/<br(?: \/)?>/gi,`
`)}class DU{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new CU,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function r(){let i=t.buffer,o=0;for(i=f1(i);o<i.length&&i[o]!=="\r"&&i[o]!==`
`;)++o;const l=i.slice(0,o);return i[o]==="\r"&&++o,i[o]===`
`&&++o,t.buffer=i.slice(o),l}function s(i){d1(i,function(o,l){},/:/)}try{let i="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;i=r();const l=i.match(/^()?WEBVTT([ \t].*)?$/);if(!(l!=null&&l[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:i=r(),t.state){case"HEADER":/:/.test(i)?s(i):i||(t.state="ID");continue;case"NOTE":i||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){t.state="NOTE";break}if(!i)continue;if(t.cue=new Zp(0,0,""),t.state="CUE",i.indexOf("-->")===-1){t.cue.id=i;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{PU(i,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const l=i.indexOf("-->")!==-1;if(!i||l&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=i}continue;case"BADCUE":i||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const NU=/\r\n|\n\r|\n|\r/g,Ch=function(e,t,r=0){return e.slice(r,r+t.length)===t},OU=function(e){let t=parseInt(e.slice(-3));const r=parseInt(e.slice(-6,-4)),s=parseInt(e.slice(-9,-7)),i=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!he(t)||!he(r)||!he(s)||!he(i))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*r,t+=60*1e3*s,t+=3600*1e3*i,t};function eg(n,e,t){return pa(n.toString())+pa(e.toString())+pa(t)}const MU=function(e,t,r){let s=e[t],i=e[s.prevCC];if(!i||!i.new&&s.new){e.ccOffset=e.presentationOffset=s.start,s.new=!1;return}for(;(o=i)!=null&&o.new;){var o;e.ccOffset+=s.start-i.start,s.new=!1,s=i,i=e[s.prevCC]}e.presentationOffset=r};function FU(n,e,t,r,s,i,o){const l=new DU,c=Rn(new Uint8Array(n)).trim().replace(NU,`
`).split(`
`),d=[],f=e?GF(e.baseTime,e.timescale):0;let h="00:00.000",p=0,v=0,g,S=!0;l.oncue=function(x){const b=t[r];let A=t.ccOffset;const L=(p-f)/9e4;if(b!=null&&b.new&&(v!==void 0?A=t.ccOffset=b.start:MU(t,r,L)),L){if(!e){g=new Error("Missing initPTS for VTT MPEGTS");return}A=L-t.presentationOffset}const I=x.endTime-x.startTime,k=bn((x.startTime+A-v)*9e4,s*9e4)/9e4;x.startTime=Math.max(k,0),x.endTime=Math.max(k+I,0);const F=x.text.trim();x.text=decodeURIComponent(encodeURIComponent(F)),x.id||(x.id=eg(x.startTime,x.endTime,F)),x.endTime>0&&d.push(x)},l.onparsingerror=function(x){g=x},l.onflush=function(){if(g){o(g);return}i(d)},c.forEach(x=>{if(S)if(Ch(x,"X-TIMESTAMP-MAP=")){S=!1,x.slice(16).split(",").forEach(b=>{Ch(b,"LOCAL:")?h=b.slice(6):Ch(b,"MPEGTS:")&&(p=parseInt(b.slice(7)))});try{v=OU(h)/1e3}catch(b){g=b}return}else x===""&&(S=!1);l.parse(x+`
`)}),l.flush()}const kh="stpp.ttml.im1t",h1=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,m1=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,BU={left:"start",center:"center",right:"end",start:"start",end:"end"};function jS(n,e,t,r){const s=Ue(new Uint8Array(n),["mdat"]);if(s.length===0){r(new Error("Could not parse IMSC1 mdat"));return}const i=s.map(l=>Rn(l)),o=VF(e.baseTime,1,e.timescale);try{i.forEach(l=>t(UU(l,o)))}catch(l){r(l)}}function UU(n,e){const s=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");const i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(i).reduce((h,p)=>(h[p]=s.getAttribute(`ttp:${p}`)||i[p],h),{}),l=s.getAttribute("xml:space")!=="preserve",c=VS(Ph(s,"styling","style")),d=VS(Ph(s,"layout","region")),f=Ph(s,"body","[begin]");return[].map.call(f,h=>{const p=p1(h,l);if(!p||!h.hasAttribute("begin"))return null;const v=Nh(h.getAttribute("begin"),o),g=Nh(h.getAttribute("dur"),o);let S=Nh(h.getAttribute("end"),o);if(v===null)throw GS(h);if(S===null){if(g===null)throw GS(h);S=v+g}const x=new Zp(v-e,S-e,p);x.id=eg(x.startTime,x.endTime,x.text);const b=d[h.getAttribute("region")],A=c[h.getAttribute("style")],L=$U(b,A,c),{textAlign:I}=L;if(I){const k=BU[I];k&&(x.lineAlign=k),x.align=I}return et(x,L),x}).filter(h=>h!==null)}function Ph(n,e,t){const r=n.getElementsByTagName(e)[0];return r?[].slice.call(r.querySelectorAll(t)):[]}function VS(n){return n.reduce((e,t)=>{const r=t.getAttribute("xml:id");return r&&(e[r]=t),e},{})}function p1(n,e){return[].slice.call(n.childNodes).reduce((t,r,s)=>{var i;return r.nodeName==="br"&&s?t+`
`:(i=r.childNodes)!=null&&i.length?p1(r,e):e?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent},"")}function $U(n,e,t){const r="http://www.w3.org/ns/ttml#styling";let s=null;const i=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=n!=null&&n.hasAttribute("style")?n.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(s=t[o]),i.reduce((l,c)=>{const d=Dh(e,r,c)||Dh(n,r,c)||Dh(s,r,c);return d&&(l[c]=d),l},{})}function Dh(n,e,t){return n&&n.hasAttributeNS(e,t)?n.getAttributeNS(e,t):null}function GS(n){return new Error(`Could not parse ttml timestamp ${n}`)}function Nh(n,e){if(!n)return null;let t=c1(n);return t===null&&(h1.test(n)?t=jU(n,e):m1.test(n)&&(t=VU(n,e))),t}function jU(n,e){const t=h1.exec(n),r=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+r/e.frameRate}function VU(n,e){const t=m1.exec(n),r=Number(t[1]);switch(t[2]){case"h":return r*3600;case"m":return r*60;case"ms":return r*1e3;case"f":return r/e.frameRate;case"t":return r/e.tickRate}return r}class Iu{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class GU{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=KS(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(R.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(R.FRAG_LOADING,this.onFragLoading,this),e.on(R.FRAG_LOADED,this.onFragLoaded,this),e.on(R.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(R.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(R.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(R.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(R.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(R.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(R.FRAG_LOADING,this.onFragLoading,this),e.off(R.FRAG_LOADED,this.onFragLoaded,this),e.off(R.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(R.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(R.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(R.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(R.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Iu(this,"textTrack1"),t=new Iu(this,"textTrack2"),r=new Iu(this,"textTrack3"),s=new Iu(this,"textTrack4");this.cea608Parser1=new $S(1,e,t),this.cea608Parser2=new $S(3,r,s)}addCues(e,t,r,s,i){let o=!1;for(let l=i.length;l--;){const c=i[l],d=HU(c[0],c[1],t,r);if(d>=0&&(c[0]=Math.min(c[0],t),c[1]=Math.max(c[1],r),o=!0,d/(r-t)>.5))return}if(o||i.push([t,r]),this.config.renderTextTracksNatively){const l=this.captionsTracks[e];this.Cues.newCue(l,t,r,s)}else{const l=this.Cues.newCue(null,t,r,s);this.hls.trigger(R.CUES_PARSED,{type:"captions",cues:l,track:e})}}onInitPtsFound(e,{frag:t,id:r,initPTS:s,timescale:i,trackId:o}){const{unparsedVttFrags:l}=this;r===ge.MAIN&&(this.initPTS[t.cc]={baseTime:s,timescale:i,trackId:o}),l.length&&(this.unparsedVttFrags=[],l.forEach(c=>{this.initPTS[c.frag.cc]?this.onFragLoaded(R.FRAG_LOADED,c):this.hls.trigger(R.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:c.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:r}=this;if(r)for(let s=0;s<r.textTracks.length;s++){const i=r.textTracks[s];if(HS(i,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return i}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:r,media:s}=this,{label:i,languageCode:o}=t[e],l=this.getExistingTrack(i,o);if(l)r[e]=l,Gi(r[e]),i1(r[e],s);else{const c=this.createTextTrack("captions",i,o);c&&(c[e]=!0,r[e]=c)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const r=t.label,s={_id:e,label:r,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(R.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(e,t,r){const s=this.media;if(s)return s.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const r=!!t.transferMedia;if(this.media=null,r)return;const{captionsTracks:s}=this;Object.keys(s).forEach(i=>{Gi(s[i]),delete s[i]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=KS(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let r=0;r<t.length;r++)Gi(t[r])}onSubtitleTracksUpdated(e,t){const r=t.subtitleTracks||[],s=r.some(i=>i.textCodec===kh);if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(zw(this.tracks,r)){this.tracks=r;return}if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){const o=this.media,l=o?Wu(o.textTracks):null;if(this.tracks.forEach((c,d)=>{let f;if(l){let h=null;for(let p=0;p<l.length;p++)if(l[p]&&HS(l[p],c)){h=l[p],l[p]=null;break}h&&(f=h)}if(f)Gi(f);else{const h=g1(c);f=this.createTextTrack(h,c.name,c.lang),f&&(f.mode="disabled")}f&&this.textTracks.push(f)}),l!=null&&l.length){const c=l.filter(d=>d!==null).map(d=>d.label);c.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${c.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(l=>({label:l.name,kind:l.type.toLowerCase(),default:l.default,subtitleTrack:l}));this.hls.trigger(R.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(r=>{const s=/(?:CC|SERVICE)([1-4])/.exec(r.instreamId);if(!s)return;const i=`textTrack${s[1]}`,o=this.captionsProperties[i];o&&(o.label=r.name,r.lang&&(o.languageCode=r.lang),o.media=r)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t?.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===ge.MAIN){var r,s;const{cea608Parser1:i,cea608Parser2:o,lastSn:l}=this,{cc:c,sn:d}=t.frag,f=(r=(s=t.part)==null?void 0:s.index)!=null?r:-1;i&&o&&(d!==l+1||d===l&&f!==this.lastPartIndex+1||c!==this.lastCc)&&(i.reset(),o.reset()),this.lastCc=c,this.lastSn=d,this.lastPartIndex=f}}onFragLoaded(e,t){const{frag:r,payload:s}=t;if(r.type===ge.SUBTITLE)if(s.byteLength){const i=r.decryptdata,o="stats"in t;if(i==null||!i.encrypted||o){const l=this.tracks[r.level],c=this.vttCCs;c[r.cc]||(c[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),l&&l.textCodec===kh?this._parseIMSC1(r,s):this._parseVTTs(t)}}else this.hls.trigger(R.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const r=this.hls;jS(t,this.initPTS[e.cc],s=>{this._appendCues(s,e.level),r.trigger(R.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},s=>{r.logger.log(`Failed to parse IMSC1: ${s}`),r.trigger(R.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})}_parseVTTs(e){var t;const{frag:r,payload:s}=e,{initPTS:i,unparsedVttFrags:o}=this,l=i.length-1;if(!i[r.cc]&&l===-1){o.push(e);return}const c=this.hls,d=(t=r.initSegment)!=null&&t.data?Un(r.initSegment.data,new Uint8Array(s)).buffer:s;FU(d,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,f=>{this._appendCues(f,r.level),c.trigger(R.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},f=>{const h=f.message==="Missing initPTS for VTT MPEGTS";h?o.push(e):this._fallbackToIMSC1(r,s),c.logger.log(`Failed to parse VTT cue: ${f}`),!(h&&l>r.cc)&&c.trigger(R.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:f})})}_fallbackToIMSC1(e,t){const r=this.tracks[e.level];r.textCodec||jS(t,this.initPTS[e.cc],()=>{r.textCodec=kh,this._parseIMSC1(e,t)},()=>{r.textCodec="wvtt"})}_appendCues(e,t){const r=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[t];if(!s||s.mode==="disabled")return;e.forEach(i=>o1(s,i))}else{const s=this.tracks[t];if(!s)return;const i=s.default?"default":"subtitles"+t;r.trigger(R.CUES_PARSED,{type:"subtitles",cues:e,track:i})}}onFragDecrypted(e,t){const{frag:r}=t;r.type===ge.SUBTITLE&&this.onFragLoaded(R.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:r,samples:s}=t;if(!(r.type===ge.MAIN&&this.closedCaptionsForLevel(r)==="NONE"))for(let i=0;i<s.length;i++){const o=s[i].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();const l=this.extractCea608Data(o);this.cea608Parser1.addData(s[i].pts,l[0]),this.cea608Parser2.addData(s[i].pts,l[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:r,endOffsetSubtitles:s,type:i}){const{media:o}=this;if(!(!o||o.currentTime<r)){if(!i||i==="video"){const{captionsTracks:l}=this;Object.keys(l).forEach(c=>Fm(l[c],t,r))}if(this.config.renderTextTracksNatively&&t===0&&s!==void 0){const{textTracks:l}=this;Object.keys(l).forEach(c=>Fm(l[c],t,s))}}}extractCea608Data(e){const t=[[],[]],r=e[0]&31;let s=2;for(let i=0;i<r;i++){const o=e[s++],l=127&e[s++],c=127&e[s++];if(l===0&&c===0)continue;if((4&o)!==0){const f=3&o;(f===0||f===1)&&(t[f].push(l),t[f].push(c))}}return t}}function g1(n){return n.characteristics&&/transcribes-spoken-dialog/gi.test(n.characteristics)&&/describes-music-and-sound/gi.test(n.characteristics)?"captions":"subtitles"}function HS(n,e){return!!n&&n.kind===g1(e)&&Dm(e,n)}function HU(n,e,t,r){return Math.min(e,r)-Math.max(n,t)}function KS(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const KU=/\s/,zU={newCue(n,e,t,r){const s=[];let i,o,l,c,d;const f=self.VTTCue||self.TextTrackCue;for(let p=0;p<r.rows.length;p++)if(i=r.rows[p],l=!0,c=0,d="",!i.isEmpty()){var h;for(let S=0;S<i.chars.length;S++)KU.test(i.chars[S].uchar)&&l?c++:(d+=i.chars[S].uchar,l=!1);i.cueStartTime=e,e===t&&(t+=1e-4),c>=16?c--:c++;const v=f1(d.trim()),g=eg(e,t,v);n!=null&&(h=n.cues)!=null&&h.getCueById(g)||(o=new f(e,t,v),o.id=g,o.line=p+1,o.align="left",o.position=10+Math.min(80,Math.floor(c*8/32)*10),s.push(o))}return n&&s.length&&(s.sort((p,v)=>p.line==="auto"||v.line==="auto"?0:p.line>8&&v.line>8?v.line-p.line:p.line-v.line),s.forEach(p=>o1(n,p))),s}};function WU(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const YU=/(\d+)-(\d+)\/(\d+)/;class zS{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||JU,this.controller=new self.AbortController,this.stats=new Pp}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,r){const s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();const i=qU(e,this.controller.signal),o=e.responseType==="arraybuffer",l=o?"byteLength":"length",{maxTimeToFirstByteMs:c,maxLoadTimeMs:d}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,i),self.clearTimeout(this.requestTimeout),t.timeout=c&&he(c)?c:d,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},t.timeout),(Pa(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(h=>{var p;this.response=this.loader=h;const v=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=d,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},d-(v-s.loading.start)),!h.ok){const{status:S,statusText:x}=h;throw new ZU(x||"fetch, bad network response",S,h)}s.loading.first=v,s.total=QU(h.headers)||s.total;const g=(p=this.callbacks)==null?void 0:p.onProgress;return g&&he(t.highWaterMark)?this.loadProgressively(h,s,e,t.highWaterMark,g):o?h.arrayBuffer():e.responseType==="json"?h.json():h.text()}).then(h=>{var p,v;const g=this.response;if(!g)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);const S=h[l];S&&(s.loaded=s.total=S);const x={url:g.url,data:h,code:g.status},b=(p=this.callbacks)==null?void 0:p.onProgress;b&&!he(t.highWaterMark)&&b(s,e,h,g),(v=this.callbacks)==null||v.onSuccess(x,s,e,g)}).catch(h=>{var p;if(self.clearTimeout(this.requestTimeout),s.aborted)return;const v=h&&h.code||0,g=h?h.message:null;(p=this.callbacks)==null||p.onError({code:v,text:g},e,h?h.details:null,s)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,r,s=0,i){const o=new Lw,l=e.body.getReader(),c=()=>l.read().then(d=>{if(d.done)return o.dataLength&&i(t,r,o.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const f=d.value,h=f.length;return t.loaded+=h,h<s||o.dataLength?(o.push(f),o.dataLength>=s&&i(t,r,o.flush().buffer,e)):i(t,r,f.buffer,e),c()}).catch(()=>Promise.reject());return c()}}function qU(n,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(et({},n.headers))};return n.rangeEnd&&t.headers.set("Range","bytes="+n.rangeStart+"-"+String(n.rangeEnd-1)),t}function XU(n){const e=YU.exec(n);if(e)return parseInt(e[2])-parseInt(e[1])+1}function QU(n){const e=n.get("Content-Range");if(e){const r=XU(e);if(he(r))return r}const t=n.get("Content-Length");if(t)return parseInt(t)}function JU(n,e){return new self.Request(n.url,e)}class ZU extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}}const e$=/^age:\s*[\d.]+\s*$/im;class y1{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Pp,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const r=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;const i=this.xhrSetup;i?Promise.resolve().then(()=>{if(!(this.loader!==r||this.stats.aborted))return i(r,t.url)}).catch(o=>{if(!(this.loader!==r||this.stats.aborted))return r.open("GET",t.url,!0),i(r,t.url)}).then(()=>{this.loader!==r||this.stats.aborted||this.openAndSendXhr(r,t,e)}).catch(o=>{var l;(l=this.callbacks)==null||l.onError({code:r.status,text:o.message},t,r,s)}):this.openAndSendXhr(r,t,e)}openAndSendXhr(e,t,r){e.readyState||e.open("GET",t.url,!0);const s=t.headers,{maxTimeToFirstByteMs:i,maxLoadTimeMs:o}=r.loadPolicy;if(s)for(const l in s)e.setRequestHeader(l,s[l]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=i&&he(i)?i:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:r}=this;if(!e||!t)return;const s=t.readyState,i=this.config;if(!r.aborted&&s>=2&&(r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),i.timeout!==i.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),i.timeout=i.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),s===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const d=t.status,f=t.responseType==="text"?t.responseText:null;if(d>=200&&d<300){const g=f??t.response;if(g!=null){var o,l;r.loading.end=Math.max(self.performance.now(),r.loading.first);const S=t.responseType==="arraybuffer"?g.byteLength:g.length;r.loaded=r.total=S,r.bwEstimate=r.total*8e3/(r.loading.end-r.loading.first);const x=(o=this.callbacks)==null?void 0:o.onProgress;x&&x(r,e,g,t);const b={url:t.responseURL,data:g,code:d};(l=this.callbacks)==null||l.onSuccess(b,r,e,t);return}}const h=i.loadPolicy.errorRetry,p=r.retry,v={url:e.url,data:void 0,code:d};if(mc(h,p,!1,v))this.retry(h);else{var c;Ze.error(`${d} while loading ${e.url}`),(c=this.callbacks)==null||c.onError({code:d,text:t.statusText},e,t,r)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(mc(e,t,!0))this.retry(e);else{var r;Ze.warn(`timeout while loading ${(r=this.context)==null?void 0:r.url}`);const s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:r}=this;this.retryDelay=Mp(e,r.retry),r.retry++,Ze.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t?.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&e$.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const t$={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},n$=Je(Je({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:y1,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:mM,bufferController:sB,capLevelController:Xp,errorController:xM,fpsController:iU,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:pw,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:t$},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},r$()),{},{subtitleStreamController:yU,subtitleTrackController:lU,timelineController:GU,audioStreamController:eB,audioTrackController:tB,emeController:zi,cmcdController:tU,contentSteeringController:rU,interstitialsController:gU});function r$(){return{cueHandler:zU,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function s$(n,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const r=Um(n),s=["manifest","level","frag"],i=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return s.forEach(o=>{const l=`${o==="level"?"playlist":o}LoadPolicy`,c=e[l]===void 0,d=[];i.forEach(f=>{const h=`${o}Loading${f}`,p=e[h];if(p!==void 0&&c){d.push(h);const v=r[l].default;switch(e[l]={default:v},f){case"TimeOut":v.maxLoadTimeMs=p,v.maxTimeToFirstByteMs=p;break;case"MaxRetry":v.errorRetry.maxNumRetry=p,v.timeoutRetry.maxNumRetry=p;break;case"RetryDelay":v.errorRetry.retryDelayMs=p,v.timeoutRetry.retryDelayMs=p;break;case"MaxRetryTimeout":v.errorRetry.maxRetryDelayMs=p,v.timeoutRetry.maxRetryDelayMs=p;break}}}),d.length&&t.warn(`hls.js config: "${d.join('", "')}" setting(s) are deprecated, use "${l}": ${nt(e[l])}`)}),Je(Je({},r),e)}function Um(n){return n&&typeof n=="object"?Array.isArray(n)?n.map(Um):Object.keys(n).reduce((e,t)=>(e[t]=Um(n[t]),e),{}):n}function i$(n,e){const t=n.loader;t!==zS&&t!==y1?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1):WU()&&(n.loader=zS,n.progressive=!0,n.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const Yu=2,o$=.1,a$=.05,l$=100;class u$ extends cw{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var r;(r=this.media)!=null&&r.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var r;this.ended=((r=this.media)==null?void 0:r.currentTime)||1,this.hls.trigger(R.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(l$),this.mediaSource=t.mediaSource;const r=this.media=t.media;Zt(r,"playing",this.onMediaPlaying),Zt(r,"waiting",this.onMediaWaiting),Zt(r,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:r}=this;r&&(un(r,"playing",this.onMediaPlaying),un(r,"waiting",this.onMediaWaiting),un(r,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var r,s;const i=(r=this.hls)==null?void 0:r.config;if(!i)return;const o=this.media;if(!o)return;const{seeking:l}=o,c=this.seeking&&!l,d=!this.seeking&&l,f=o.paused&&!l||o.ended||o.playbackRate===0;if(this.seeking=l,e!==t){t&&(this.ended=0),this.moved=!0,l||(this.nudgeRetry=0,i.nudgeOnVideoHole&&!f&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(d||c){c&&this.stallResolved(e);return}if(f){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&o.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(R.MEDIA_ENDED,{stalled:!1}));return}if(!Oe.getBuffered(o).length){this.nudgeRetry=0;return}const h=Oe.bufferInfo(o,e,0),p=h.nextStart||0,v=this.fragmentTracker;if(l&&v&&this.hls){const F=WS(this.hls.inFlightFragments,e),C=h.len>Yu,P=!p||F||p-e>Yu&&!v.getPartialFragment(e);if(C||P)return;this.moved=!1}const g=(s=this.hls)==null?void 0:s.latestLevelDetails;if(!this.moved&&this.stalled!==null&&v){if(!(h.len>0)&&!p)return;const C=Math.max(p,h.start||0)-e,O=!!(g!=null&&g.live)?g.targetduration*2:Yu,M=_u(e,v);if(C>0&&(C<=O||M)){o.paused||this._trySkipBufferHole(M);return}}const S=i.detectStallWithCurrentTimeMs,x=self.performance.now(),b=this.waiting;let A=this.stalled;if(A===null)if(b>0&&x-b<S)A=this.stalled=b;else{this.stalled=x;return}const L=x-A;if(!l&&(L>=S||b)&&this.hls){var I;if(((I=this.mediaSource)==null?void 0:I.readyState)==="ended"&&!(g!=null&&g.live)&&Math.abs(e-(g?.edge||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(R.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(h),!this.media||!this.hls)return}const k=Oe.bufferInfo(o,e,i.maxBufferHole);this._tryFixBufferStall(k,L,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const r=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(r)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(R.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var r;const s=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(r=this.buffered.audio)!=null&&r.length&&s&&s.length>1&&e>s.end(0)){const i=Oe.bufferedInfo(Oe.timeRangesToArray(this.buffered.audio),e,0);if(i.len>1&&t>=i.start){const o=Oe.timeRangesToArray(s),l=Oe.bufferedInfo(o,t,0).bufferedIndex;if(l>-1&&l<o.length-1){const c=Oe.bufferedInfo(o,e,0).bufferedIndex,d=o[l].end,f=o[l+1].start;if((c===-1||c>l)&&f-d<1&&e-d<2){const h=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${d} -> ${f} buffered index: ${c}`);this.warn(h.message),this.media.currentTime+=1e-6;let p=_u(e,this.fragmentTracker);p&&"fragment"in p?p=p.fragment:p||(p=void 0);const v=Oe.bufferInfo(this.media,e,0);this.hls.trigger(R.ERROR,{type:we.MEDIA_ERROR,details:z.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:h,reason:h.message,frag:p,buffer:v.len,bufferInfo:v})}}}}}_tryFixBufferStall(e,t,r){var s,i;const{fragmentTracker:o,media:l}=this,c=(s=this.hls)==null?void 0:s.config;if(!l||!o||!c)return;const d=(i=this.hls)==null?void 0:i.latestLevelDetails,f=_u(r,o);if((f||d!=null&&d.live&&r<d.fragmentStart)&&(this._trySkipBufferHole(f)||!this.media))return;const h=e.buffered,p=this.adjacentTraversal(e,r);(h&&h.length>1&&e.len>c.maxBufferHole||e.nextStart&&(e.nextStart-r<c.maxBufferHole||p))&&(t>c.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const r=this.fragmentTracker,s=e.nextStart;if(r&&s){const i=r.getFragAtPos(t,ge.MAIN),o=r.getFragAtPos(s,ge.MAIN);if(i&&o)return o.sn-i.sn<2}return!1}_reportStall(e){const{hls:t,media:r,stallReported:s,stalled:i}=this;if(!s&&i!==null&&r&&t){this.stallReported=!0;const o=new Error(`Playback stalling at @${r.currentTime} due to low buffer (${nt(e)})`);this.warn(o.message),t.trigger(R.ERROR,{type:we.MEDIA_ERROR,details:z.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:e.len,bufferInfo:e,stalled:{start:i}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:r,media:s}=this,i=(t=this.hls)==null?void 0:t.config;if(!s||!r||!i)return 0;const o=s.currentTime,l=Oe.bufferInfo(s,o,0),c=o<l.start?l.start:l.nextStart;if(c&&this.hls){const f=l.len<=i.maxBufferHole,h=l.len>0&&l.len<1&&s.readyState<3,p=c-o;if(p>0&&(f||h)){if(p>i.maxBufferHole){let g=!1;if(o===0){const S=r.getAppendedFrag(0,ge.MAIN);S&&c<S.end&&(g=!0)}if(!g&&e){var d;if(!((d=this.hls.loadLevelObj)!=null&&d.details)||WS(this.hls.inFlightFragments,c))return 0;let x=!1,b=e.end;for(;b<c;){const A=_u(b,r);if(A)b+=A.duration;else{x=!0;break}}if(x)return 0}}const v=Math.max(c+a$,o+o$);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${v}`),this.moved=!0,s.currentTime=v,!(e!=null&&e.gap)){const g=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${v}`),S={type:we.MEDIA_ERROR,details:z.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:g,reason:g.message,buffer:l.len,bufferInfo:l};e&&("fragment"in e?S.part=e:S.frag=e),this.hls.trigger(R.ERROR,S)}return v}}return 0}_tryNudgeBuffer(e){const{hls:t,media:r,nudgeRetry:s}=this,i=t?.config;if(!r||!i)return 0;const o=r.currentTime;if(this.nudgeRetry++,s<i.nudgeMaxRetry){const l=o+(s+1)*i.nudgeOffset,c=new Error(`Nudging 'currentTime' from ${o} to ${l}`);this.warn(c.message),r.currentTime=l,t.trigger(R.ERROR,{type:we.MEDIA_ERROR,details:z.BUFFER_NUDGE_ON_STALL,error:c,fatal:!1,buffer:e.len,bufferInfo:e})}else{const l=new Error(`Playhead still not moving while enough data buffered @${o} after ${i.nudgeMaxRetry} nudges`);this.error(l.message),t.trigger(R.ERROR,{type:we.MEDIA_ERROR,details:z.BUFFER_STALLED_ERROR,error:l,fatal:!0,buffer:e.len,bufferInfo:e})}}}function WS(n,e){const t=YS(n.main);if(t&&t.start<=e)return t;const r=YS(n.audio);return r&&r.start<=e?r:null}function YS(n){if(!n)return null;switch(n.state){case re.IDLE:case re.STOPPED:case re.ENDED:case re.ERROR:return null}return n.frag}function _u(n,e){return e.getAppendedFrag(n,ge.MAIN)||e.getPartialFragment(n)}const c$=.25;function $m(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Oh(n,e,t,r,s){let i=new n(e,t,"");try{i.value=r,s&&(i.type=s)}catch{i=new n(e,t,nt(s?Je({type:s},r):r))}return i}const Cu=(()=>{const n=$m();try{n&&new n(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class d${constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(R.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(R.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(R.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(R.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(R.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(R.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(R.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var r;this.media=t.media,((r=t.overrides)==null?void 0:r.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Gi(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const r=e[t];if(r.kind==="metadata"&&r.label==="id3")return i1(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:r,enableID3MetadataCues:s}=this.hls.config;if(!r&&!s)return;const{samples:i}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=$m();if(o)for(let l=0;l<i.length;l++){const c=i[l].type;if(c===wn.emsg&&!r||!s)continue;const d=Dw(i[l].data),f=i[l].pts;let h=f+i[l].duration;h>Cu&&(h=Cu),h-f<=0&&(h=f+c$);for(let v=0;v<d.length;v++){const g=d[v];if(!Nw(g)){this.updateId3CueEnds(f,c);const S=Oh(o,f,h,g,c);S&&this.id3Track.addCue(S)}}}}updateId3CueEnds(e,t){var r;const s=(r=this.id3Track)==null?void 0:r.cues;if(s)for(let i=s.length;i--;){const o=s[i];o.type===t&&o.startTime<e&&o.endTime===Cu&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:r,type:s}){const{id3Track:i,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:l,enableID3MetadataCues:c}}=o;if(i&&(l||c)){let d;s==="audio"?d=f=>f.type===wn.audioId3&&c:s==="video"?d=f=>f.type===wn.emsg&&l:d=f=>f.type===wn.audioId3&&c||f.type===wn.emsg&&l,Fm(i,t,r,d)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:r,timelineOffset:s,enableDateRangeMetadataCues:i,interstitialsController:o}=this.hls.config;if(!i)return;const l=$m();if(r&&s&&!o){const{fragmentStart:S,fragmentEnd:x}=e;let b=this.assetCue;b?(b.startTime=S,b.endTime=x):l&&(b=this.assetCue=Oh(l,S,x,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),b&&(b.id=r,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(b),b.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:c}=this,{dateRanges:d}=e,f=Object.keys(d);let h=this.dateRangeCuesAppended;if(c&&t){var p;if((p=c.cues)!=null&&p.length){const S=Object.keys(h).filter(x=>!f.includes(x));for(let x=S.length;x--;){var v;const b=S[x],A=(v=h[b])==null?void 0:v.cues;delete h[b],A&&Object.keys(A).forEach(L=>{const I=A[L];if(I){I.removeEventListener("enter",this.onEventCueEnter);try{c.removeCue(I)}catch{}}})}}else h=this.dateRangeCuesAppended={}}const g=e.fragments[e.fragments.length-1];if(!(f.length===0||!he(g?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let S=0;S<f.length;S++){const x=f[S],b=d[x],A=b.startTime,L=h[x],I=L?.cues||{};let k=L?.durationKnown||!1,F=Cu;const{duration:C,endDate:P}=b;if(P&&C!==null)F=A+C,k=!0;else if(b.endOnNext&&!k){const M=f.reduce((H,Z)=>{if(Z!==b.id){const se=d[Z];if(se.class===b.class&&se.startDate>b.startDate&&(!H||b.startDate<H.startDate))return se}return H},null);M&&(F=M.startTime,k=!0)}const O=Object.keys(b.attr);for(let M=0;M<O.length;M++){const H=O[M];if(!PM(H))continue;const Z=I[H];if(Z)k&&!(L!=null&&L.durationKnown)?Z.endTime=F:Math.abs(Z.startTime-A)>.01&&(Z.startTime=A,Z.endTime=F);else if(l){let se=b.attr[H];DM(H)&&(se=Hb(se));const ne=Oh(l,A,F,{key:H,data:se},wn.dateRange);ne&&(ne.id=x,this.id3Track.addCue(ne),I[H]=ne,o&&(H==="X-ASSET-LIST"||H==="X-ASSET-URL")&&ne.addEventListener("enter",this.onEventCueEnter))}}h[x]={cues:I,dateRange:b,durationKnown:k}}}}}class f${constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,r=this.levelDetails;if(!t||!r)return;this.currentTime=t.currentTime;const s=this.computeLatency();if(s===null)return;this._latency=s;const{lowLatencyMode:i,maxLiveSyncPlaybackRate:o}=this.config;if(!i||o===1||!r.live)return;const l=this.targetLatency;if(l===null)return;const c=s-l,d=Math.min(this.maxLatency,l+r.targetduration);if(c<d&&c>.05&&this.forwardBufferLength>1){const h=Math.min(2,Math.max(1,o)),p=Math.round(2/(1+Math.exp(-.75*c-this.edgeStalled))*20)/20,v=Math.min(h,Math.max(1,p));this.changeMediaPlaybackRate(t,v)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:r,targetduration:s}=e,{liveSyncDuration:i,liveSyncDurationCount:o,lowLatencyMode:l}=this.config,c=this.hls.userConfig;let d=l&&r||t;(this._targetLatencyUpdated||c.liveSyncDuration||c.liveSyncDurationCount||d===0)&&(d=i!==void 0?i:o*s);const f=s;return d+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,f)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const r=this.levelDetails;if(r===null)return null;const s=r.edge,i=e-t-this.edgeStalled,o=s-r.totalduration,l=s-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(o,i),l)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(R.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(R.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var r;t.details===z.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(r=this.levelDetails)!=null&&r.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var r,s;e.playbackRate!==t&&((r=this.hls)==null||r.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(s=this.targetLatency)==null?void 0:s.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class h$ extends qp{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(R.LEVEL_LOADED,this.onLevelLoaded,this),e.on(R.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(R.FRAG_BUFFERED,this.onFragBuffered,this),e.on(R.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(R.LEVEL_LOADED,this.onLevelLoaded,this),e.off(R.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(R.FRAG_BUFFERED,this.onFragBuffered,this),e.off(R.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const r=this.hls.config.preferManagedMediaSource,s=[],i={},o={};let l=!1,c=!1,d=!1;t.levels.forEach(f=>{const h=f.attrs;let{audioCodec:p,videoCodec:v}=f;p&&(f.audioCodec=p=cc(p,r)||void 0),v&&(v=f.videoCodec=q2(v));const{width:g,height:S,unknownCodecs:x}=f,b=x?.length||0;if(l||(l=!!(g&&S)),c||(c=!!v),d||(d=!!p),b||p&&!this.isAudioSupported(p)||v&&!this.isVideoSupported(v)){this.log(`Some or all CODECS not supported "${h.CODECS}"`);return}const{CODECS:A,"FRAME-RATE":L,"HDCP-LEVEL":I,"PATHWAY-ID":k,RESOLUTION:F,"VIDEO-RANGE":C}=h,O=`${`${k||"."}-`}${f.bitrate}-${F}-${L}-${A}-${C}-${I}`;if(i[O])if(i[O].uri!==f.url&&!f.attrs["PATHWAY-ID"]){const M=o[O]+=1;f.attrs["PATHWAY-ID"]=new Array(M+1).join(".");const H=this.createLevel(f);i[O]=H,s.push(H)}else i[O].addGroupId("audio",h.AUDIO),i[O].addGroupId("text",h.SUBTITLES);else{const M=this.createLevel(f);i[O]=M,o[O]=1,s.push(M)}}),this.filterAndSortMediaOptions(s,t,l,c,d)}createLevel(e){const t=new _a(e),r=e.supplemental;if(r!=null&&r.videoCodec&&!this.isVideoSupported(r.videoCodec)){const s=new Error(`SUPPLEMENTAL-CODECS not supported "${r.videoCodec}"`);this.log(s.message),t.supportedResult=nw(s,[])}return t}isAudioSupported(e){return Ra(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Ra(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,r,s,i){var o;let l=[],c=[],d=e;const f=((o=t.stats)==null?void 0:o.parsing)||{};if((r||s)&&i&&(d=d.filter(({videoCodec:A,videoRange:L,width:I,height:k})=>(!!A||!!(I&&k))&&iM(L))),d.length===0){Promise.resolve().then(()=>{if(this.hls){let A="no level with compatible codecs found in manifest",L=A;t.levels.length&&(L=`one or more CODECS in variant not supported: ${nt(t.levels.map(k=>k.attrs.CODECS).filter((k,F,C)=>C.indexOf(k)===F))}`,this.warn(L),A+=` (${L})`);const I=new Error(A);this.hls.trigger(R.ERROR,{type:we.MEDIA_ERROR,details:z.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:I,reason:L})}}),f.end=performance.now();return}t.audioTracks&&(l=t.audioTracks.filter(A=>!A.audioCodec||this.isAudioSupported(A.audioCodec)),qS(l)),t.subtitles&&(c=t.subtitles,qS(c));const h=d.slice(0);d.sort((A,L)=>{if(A.attrs["HDCP-LEVEL"]!==L.attrs["HDCP-LEVEL"])return(A.attrs["HDCP-LEVEL"]||"")>(L.attrs["HDCP-LEVEL"]||"")?1:-1;if(r&&A.height!==L.height)return A.height-L.height;if(A.frameRate!==L.frameRate)return A.frameRate-L.frameRate;if(A.videoRange!==L.videoRange)return dc.indexOf(A.videoRange)-dc.indexOf(L.videoRange);if(A.videoCodec!==L.videoCodec){const I=$x(A.videoCodec),k=$x(L.videoCodec);if(I!==k)return k-I}if(A.uri===L.uri&&A.codecSet!==L.codecSet){const I=uc(A.codecSet),k=uc(L.codecSet);if(I!==k)return k-I}return A.averageBitrate!==L.averageBitrate?A.averageBitrate-L.averageBitrate:0});let p=h[0];if(this.steering&&(d=this.steering.filterParsedLevels(d),d.length!==h.length)){for(let A=0;A<h.length;A++)if(h[A].pathwayId===d[0].pathwayId){p=h[A];break}}this._levels=d;for(let A=0;A<d.length;A++)if(d[A]===p){var v;this._firstLevel=A;const L=p.bitrate,I=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${d.length} level(s) found, first bitrate: ${L}`),((v=this.hls.userConfig)==null?void 0:v.abrEwmaDefaultEstimate)===void 0){const k=Math.min(L,this.hls.config.abrEwmaDefaultEstimateMax);k>I&&I===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=k)}break}const g=i&&!s,S=this.hls.config,x=!!(S.audioStreamController&&S.audioTrackController),b={levels:d,audioTracks:l,subtitleTracks:c,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:i,video:s,altAudio:x&&!g&&l.some(A=>!!A.url)};f.end=performance.now(),this.hls.trigger(R.MANIFEST_PARSED,b)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const f=new Error("invalid level idx"),h=e<0;if(this.hls.trigger(R.ERROR,{type:we.OTHER_ERROR,details:z.LEVEL_SWITCH_ERROR,level:e,fatal:h,error:f,reason:f.message}),h)return;e=Math.min(e,t.length-1)}const r=this.currentLevelIndex,s=this.currentLevel,i=s?s.attrs["PATHWAY-ID"]:void 0,o=t[e],l=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,r===e&&s&&i===l)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${l?" with Pathway "+l:""} from level ${r}${i?" with Pathway "+i:""}`);const c={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(R.LEVEL_SWITCHING,c);const d=o.details;if(!d||d.live){const f=this.switchParams(o.uri,s?.details,d);this.loadPlaylist(f)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),r=e.filter(s=>t.indexOf(s)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=r}}onError(e,t){t.fatal||!t.context||t.context.type===Ge.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===ge.MAIN){const r=t.elementaryStreams;if(!Object.keys(r).some(i=>!!r[i]))return;const s=this._levels[t.level];s!=null&&s.loadError&&(this.log(`Resetting level error count of ${s.loadError} on frag buffered`),s.loadError=0)}}onLevelLoaded(e,t){var r;const{level:s,details:i}=t,o=t.levelInfo;if(!o){var l;this.warn(`Invalid level index ${s}`),(l=t.deliveryDirectives)!=null&&l.skip&&(i.deltaUpdateFailed=!0);return}if(o===this.currentLevel||t.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let c=o.details;c===t.details&&c.advanced&&(c=void 0),this.playlistLoaded(s,t,c)}else(r=t.deliveryDirectives)!=null&&r.skip&&(i.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=this.getUrlWithDirectives(e.uri,t),s=this.currentLevelIndex,i=e.attrs["PATHWAY-ID"],o=e.details,l=o?.age;this.log(`Loading level index ${s}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${i?" Pathway "+i:""}${l&&o.live?" age "+l.toFixed(1)+(o.type&&" "+o.type||""):""} ${r}`),this.hls.trigger(R.LEVEL_LOADING,{url:r,level:s,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const r=this._levels.filter((i,o)=>o!==e?!0:(this.steering&&this.steering.removeLevel(i),i===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,i.details&&i.details.fragments.forEach(l=>l.level=-1)),!1));bw(r),this._levels=r,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const s=r.length-1;this._firstLevel=Math.min(this._firstLevel,s),this._startLevel&&(this._startLevel=Math.min(this._startLevel,s)),this.hls.trigger(R.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:r}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(R.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:r}))}}function qS(n){const e={};n.forEach(t=>{const r=t.groupId||"";t.id=e[r]=e[r]||0,e[r]++})}function v1(){return self.SourceBuffer||self.WebKitSourceBuffer}function x1(){if(!Ls())return!1;const e=v1();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function m$(){if(!x1())return!1;const n=Ls();return typeof n?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>n.isTypeSupported(Ia(e,"video")))||["mp4a.40.2","fLaC"].some(e=>n.isTypeSupported(Ia(e,"audio"))))}function p$(){var n;const e=v1();return typeof(e==null||(n=e.prototype)==null?void 0:n.changeType)=="function"}const g$=100;class y$ extends jp{constructor(e,t,r){super(e,t,r,"stream-controller",ge.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const s=this.media,i=s?s.currentTime:null;if(i===null||!he(i)||(this.log(`Media seeked to ${i.toFixed(3)}`),!this.getBufferedFrag(i)))return;const o=this.getFwdBufferInfoAtPos(s,i,ge.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${i} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(R.MANIFEST_PARSED,this.onManifestParsed,this),e.on(R.LEVEL_LOADING,this.onLevelLoading,this),e.on(R.LEVEL_LOADED,this.onLevelLoaded,this),e.on(R.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(R.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(R.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(R.BUFFER_CREATED,this.onBufferCreated,this),e.on(R.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(R.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(R.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(R.MANIFEST_PARSED,this.onManifestParsed,this),e.off(R.LEVEL_LOADED,this.onLevelLoaded,this),e.off(R.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(R.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(R.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(R.BUFFER_CREATED,this.onBufferCreated,this),e.off(R.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(R.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(R.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:r,hls:s}=this;if(this.stopLoad(),this.setInterval(g$),this.level=-1,!this.startFragRequested){let i=s.startLevel;i===-1&&(s.config.testBandwidth&&this.levels.length>1?(i=0,this.bitrateTest=!0):i=s.firstAutoLevel),s.nextLoadLevel=i,this.level=s.loadLevel,this._hasEnoughToStart=!!t}r>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r),this.state=re.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=re.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case re.WAITING_LEVEL:{const{levels:e,level:t}=this,r=e?.[t],s=r?.details;if(s&&(!s.live||this.levelLastLoaded===r&&!this.waitForLive(r))){if(this.waitForCdnTuneIn(s))break;this.state=re.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=re.IDLE;break}break}case re.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===re.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:r,media:s}=this;if(t===null||!s&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const i=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(r!=null&&r[i]))return;const o=r[i],l=this.getMainFwdBufferInfo();if(l===null)return;const c=this.getLevelDetails();if(c&&this._streamEnded(l,c)){const S={};this.altAudio===2&&(S.type="video"),this.hls.trigger(R.BUFFER_EOS,S),this.state=re.ENDED;return}if(!this.buffering)return;e.loadLevel!==i&&e.manualLevel===-1&&this.log(`Adapting to level ${i} from level ${this.level}`),this.level=e.nextLoadLevel=i;const d=o.details;if(!d||this.state===re.WAITING_LEVEL||this.waitForLive(o)){this.level=i,this.state=re.WAITING_LEVEL,this.startFragRequested=!1;return}const f=l.len,h=this.getMaxBufferLength(o.maxBitrate);if(f>=h)return;this.backtrackFragment&&this.backtrackFragment.start>l.end&&(this.backtrackFragment=null);const p=this.backtrackFragment?this.backtrackFragment.start:l.end;let v=this.getNextFragment(p,d);if(this.couldBacktrack&&!this.fragPrevious&&v&&Et(v)&&this.fragmentTracker.getState(v)!==_t.OK){var g;const x=((g=this.backtrackFragment)!=null?g:v).sn-d.startSN,b=d.fragments[x-1];b&&v.cc===b.cc&&(v=b,this.fragmentTracker.removeFragment(b))}else this.backtrackFragment&&l.len&&(this.backtrackFragment=null);if(v&&this.isLoopLoading(v,p)){if(!v.gap){const x=this.audioOnly&&!this.altAudio?tt.AUDIO:tt.VIDEO,b=(x===tt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;b&&this.afterBufferFlushed(b,x,ge.MAIN)}v=this.getNextFragmentLoopLoading(v,d,l,ge.MAIN,h)}v&&(v.initSegment&&!v.initSegment.data&&!this.bitrateTest&&(v=v.initSegment),this.loadFragment(v,o,p))}loadFragment(e,t,r){const s=this.fragmentTracker.getState(e);s===_t.NOT_LOADED||s===_t.PARTIAL?Et(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,r):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,ge.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let r;const s=this.getAppendedFrag(t.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);const i=this.getLevelDetails();if(i!=null&&i.live){const l=this.getMainFwdBufferInfo();if(!l||l.len<i.targetduration*2)return}if(!t.paused&&e){const l=this.hls.nextLoadLevel,c=e[l],d=this.fragLastKbps;d&&this.fragCurrent?r=this.fragCurrent.duration*c.maxBitrate/(1e3*d)+1:r=0}else r=0;const o=this.getBufferedFrag(t.currentTime+r);if(o){const l=this.followingBufferedFrag(o);if(l){this.abortCurrentFrag();const c=l.maxStartPTS?l.maxStartPTS:l.start,d=l.duration,f=Math.max(o.end,c+Math.min(Math.max(d-this.config.maxFragLookUpTolerance,d*(this.couldBacktrack?.5:.125)),d*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(f,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case re.KEY_LOADING:case re.FRAG_LOADING:case re.FRAG_LOADING_WAITING_RETRY:case re.PARSING:case re.PARSED:this.state=re.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const r=t.media;Zt(r,"playing",this.onMediaPlaying),Zt(r,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:r}=this;r&&(un(r,"playing",this.onMediaPlaying),un(r,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(R.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let r=!1,s=!1;for(let i=0;i<t.levels.length;i++){const o=t.levels[i].audioCodec;o&&(r=r||o.indexOf("mp4a.40.2")!==-1,s=s||o.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=r&&s&&!p$(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:r}=this;if(!r||this.state!==re.IDLE)return;const s=t.levelInfo;(!s.details||s.details.live&&(this.levelLastLoaded!==s||s.details.expired)||this.waitForCdnTuneIn(s.details))&&(this.state=re.WAITING_LEVEL)}onLevelLoaded(e,t){var r;const{levels:s,startFragRequested:i}=this,o=t.level,l=t.details,c=l.totalduration;if(!s){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${l.startSN},${l.endSN}]${l.lastPartSn?`[part-${l.lastPartSn}-${l.lastPartIndex}]`:""}, cc [${l.startCC}, ${l.endCC}] duration:${c}`);const d=t.levelInfo,f=this.fragCurrent;f&&(this.state===re.FRAG_LOADING||this.state===re.FRAG_LOADING_WAITING_RETRY)&&f.level!==t.level&&f.loader&&this.abortCurrentFrag();let h=0;if(l.live||(r=d.details)!=null&&r.live){var p;if(this.checkLiveUpdate(l),l.deltaUpdateFailed)return;h=this.alignPlaylists(l,d.details,(p=this.levelLastLoaded)==null?void 0:p.details)}if(d.details=l,this.levelLastLoaded=d,i||this.setStartPosition(l,h),this.hls.trigger(R.LEVEL_UPDATED,{details:l,level:o}),this.state===re.WAITING_LEVEL){if(this.waitForCdnTuneIn(l))return;this.state=re.IDLE}i&&l.live&&this.synchronizeToLiveEdge(l),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:r}=this;if(!r)return;const s=this.hls.liveSyncPosition,i=this.getLoadPosition(),o=e.fragmentStart,l=e.edge,c=i>=o-t.maxFragLookUpTolerance&&i<=l;if(s!==null&&r.duration>s&&(i<s||!c)){const f=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!c&&r.readyState<4||i<l-f)&&(this._hasEnoughToStart||(this.nextLoadPosition=s),r.readyState))if(this.warn(`Playback: ${i.toFixed(3)} is located too far from the end of live sliding playlist: ${l}, reset currentTime to : ${s.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var d;const h=Oe.bufferInfo(r,s,0);if(!((d=h.buffered)!=null&&d.length)){r.currentTime=s;return}if(h.start<=i){r.currentTime=s;return}const{nextStart:v}=Oe.bufferedInfo(h.buffered,i,0);v&&(r.currentTime=v)}else r.currentTime=s}}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:s,payload:i}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const l=o[r.level];if(!l){this.warn(`Level ${r.level} not found on progress`);return}const c=l.details;if(!c){this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),this.fragmentTracker.removeFragment(r);return}const d=l.videoCodec,f=c.PTSKnown||!c.live,h=(t=r.initSegment)==null?void 0:t.data,p=this._getAudioCodec(l),v=this.transmuxer=this.transmuxer||new Kw(this.hls,ge.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),g=s?s.index:-1,S=g!==-1,x=new Bp(r.level,r.sn,r.stats.chunkCount,i.byteLength,g,S),b=this.initPTS[r.cc];v.push(i,h,p,d,r,s,c.totalduration,f,x,b)}onAudioTrackSwitching(e,t){const r=this.hls,s=this.altAudio!==0;if(fc(t.url,r))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(s){this.altAudio=0,this.fragmentTracker.removeAllFragments(),r.once(R.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(R.AUDIO_TRACK_SWITCHED,t)}),r.trigger(R.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}r.trigger(R.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const r=fc(t.url,this.hls);if(r){const s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=r?2:0,this.tick()}onBufferCreated(e,t){const r=t.tracks;let s,i,o=!1;for(const l in r){const c=r[l];if(c.id==="main"){if(i=l,s=c,l==="video"){const d=r[l];d&&(this.videoBuffer=d.buffer)}}else o=!0}o&&s?(this.log(`Alternate track found, use ${i}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:r,part:s}=t,i=r.type===ge.MAIN;if(i){if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${s?" p: "+s.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),this.state===re.PARSED&&(this.state=re.IDLE);return}const l=s?s.stats:r.stats;this.fragLastKbps=Math.round(8*l.total/(l.buffering.end-l.loading.first)),Et(r)&&(this.fragPrevious=r),this.fragBufferedComplete(r,s)}const o=this.media;o&&(!this._hasEnoughToStart&&Oe.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),i&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var r;if(t.fatal){this.state=re.ERROR;return}switch(t.details){case z.FRAG_GAP:case z.FRAG_PARSING_ERROR:case z.FRAG_DECRYPT_ERROR:case z.FRAG_LOAD_ERROR:case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_ERROR:case z.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ge.MAIN,t);break;case z.LEVEL_LOAD_ERROR:case z.LEVEL_LOAD_TIMEOUT:case z.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===re.WAITING_LEVEL&&((r=t.context)==null?void 0:r.type)===Ge.LEVEL&&(this.state=re.IDLE);break;case z.BUFFER_ADD_CODEC_ERROR:case z.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case z.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case z.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=re.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==tt.AUDIO||!this.altAudio){const r=(t===tt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;r&&(this.afterBufferFlushed(r,t,ge.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let r=this.startPosition;if(r>=0&&t<r){if(e.seeking){this.log(`could not seek to ${r}, already seeking at ${t}`);return}const s=this.timelineOffset;s&&r&&(r+=s);const i=this.getLevelDetails(),o=Oe.getBuffered(e),l=o.length?o.start(0):0,c=l-r,d=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||c>0&&(c<d||this.loadingParts&&c<2*(i?.partTarget||0)))&&(this.log(`adjusting start position by ${c} to match buffer start`),r+=c,this.startPosition=r),t<r&&(this.log(`seek to target start position ${r} from current time ${t} buffer start ${l}`),e.currentTime=r)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(r=>{const{hls:s}=this,i=r?.frag;if(!i||this.fragContextChanged(i))return;t.fragmentError=0,this.state=re.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=i.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),s.trigger(R.FRAG_LOADED,r),i.bitrateTest=!1}).catch(r=>{this.state===re.STOPPED||this.state===re.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:r}=this,{remuxResult:s,chunkMeta:i}=e,o=this.getCurrentContext(i);if(!o){this.resetWhenMissingContext(i);return}const{frag:l,part:c,level:d}=o,{video:f,text:h,id3:p,initSegment:v}=s,{details:g}=d,S=this.altAudio?void 0:s.audio;if(this.fragContextChanged(l)){this.fragmentTracker.removeFragment(l);return}if(this.state=re.PARSING,v){const x=v.tracks;if(x){const I=l.initSegment||l;if(this.unhandledEncryptionError(v,l))return;this._bufferInitSegment(d,x,I,i),r.trigger(R.FRAG_PARSING_INIT_SEGMENT,{frag:I,id:t,tracks:x})}const b=v.initPTS,A=v.timescale,L=this.initPTS[l.cc];if(he(b)&&(!L||L.baseTime!==b||L.timescale!==A)){const I=v.trackId;this.initPTS[l.cc]={baseTime:b,timescale:A,trackId:I},r.trigger(R.INIT_PTS_FOUND,{frag:l,id:t,initPTS:b,timescale:A,trackId:I})}}if(f&&g){S&&f.type==="audiovideo"&&this.logMuxedErr(l);const x=g.fragments[l.sn-1-g.startSN],b=l.sn===g.startSN,A=!x||l.cc>x.cc;if(s.independent!==!1){const{startPTS:L,endPTS:I,startDTS:k,endDTS:F}=f;if(c)c.elementaryStreams[f.type]={startPTS:L,endPTS:I,startDTS:k,endDTS:F};else if(f.firstKeyFrame&&f.independent&&i.id===1&&!A&&(this.couldBacktrack=!0),f.dropped&&f.independent){const C=this.getMainFwdBufferInfo(),P=(C?C.end:this.getLoadPosition())+this.config.maxBufferHole,O=f.firstKeyFramePTS?f.firstKeyFramePTS:L;if(!b&&P<O-this.config.maxBufferHole&&!A){this.backtrack(l);return}else A&&(l.gap=!0);l.setElementaryStreamInfo(f.type,l.start,I,l.start,F,!0)}else b&&L-(g.appliedTimelineOffset||0)>Yu&&(l.gap=!0);l.setElementaryStreamInfo(f.type,L,I,k,F),this.backtrackFragment&&(this.backtrackFragment=l),this.bufferFragmentData(f,l,c,i,b||A)}else if(b||A)l.gap=!0;else{this.backtrack(l);return}}if(S){const{startPTS:x,endPTS:b,startDTS:A,endDTS:L}=S;c&&(c.elementaryStreams[tt.AUDIO]={startPTS:x,endPTS:b,startDTS:A,endDTS:L}),l.setElementaryStreamInfo(tt.AUDIO,x,b,A,L),this.bufferFragmentData(S,l,c,i)}if(g&&p!=null&&p.samples.length){const x={id:t,frag:l,details:g,samples:p.samples};r.trigger(R.FRAG_PARSING_METADATA,x)}if(g&&h){const x={id:t,frag:l,details:g,samples:h.samples};r.trigger(R.FRAG_PARSING_USERDATA,x)}}logMuxedErr(e){this.warn(`${Et(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,r,s){if(this.state!==re.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(r));const{audio:i,video:o,audiovideo:l}=t;if(i){const d=e.audioCodec;let f=ju(i.codec,d);f==="mp4a"&&(f="mp4a.40.5");const h=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){f&&(f.indexOf("mp4a.40.5")!==-1?f="mp4a.40.2":f="mp4a.40.5");const p=i.metadata;p&&"channelCount"in p&&(p.channelCount||1)!==1&&h.indexOf("firefox")===-1&&(f="mp4a.40.5")}f&&f.indexOf("mp4a.40.5")!==-1&&h.indexOf("android")!==-1&&i.container!=="audio/mpeg"&&(f="mp4a.40.2",this.log(`Android: force audio codec to ${f}`)),d&&d!==f&&this.log(`Swapping manifest audio codec "${d}" for "${f}"`),i.levelCodec=f,i.id=ge.MAIN,this.log(`Init audio buffer, container:${i.container}, codecs[selected/level/parsed]=[${f||""}/${d||""}/${i.codec}]`),delete t.audiovideo}if(o){o.levelCodec=e.videoCodec,o.id=ge.MAIN;const d=o.codec;if(d?.length===4)switch(d){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${d}]${o.codec!==d?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete t.audiovideo}l&&(this.log(`Init audiovideo buffer, container:${l.container}, codecs[level/parsed]=[${e.codecs}/${l.codec}]`),delete t.video,delete t.audio);const c=Object.keys(t);if(c.length){if(this.hls.trigger(R.BUFFER_CODECS,t),!this.hls)return;c.forEach(d=>{const h=t[d].initSegment;h!=null&&h.byteLength&&this.hls.trigger(R.BUFFER_APPENDING,{type:d,data:h,frag:r,part:null,chunkMeta:s,parent:r.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,ge.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,r=e?.[t];return r?this.getMaxBufferLength(r.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=re.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const r=e.currentTime;if(Oe.isBuffered(e,r)?t=this.getAppendedFrag(r):Oe.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;const s=this.fragPlaying,i=t.level;(!s||t.sn!==s.sn||s.level!==i)&&(this.fragPlaying=t,this.hls.trigger(R.FRAG_CHANGED,{frag:t}),(!s||s.level!==i)&&this.hls.trigger(R.LEVEL_SWITCHED,{level:i}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return he(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(he(t)){const r=this.getLevelDetails(),s=this.currentFrag||(r?ii(null,r.fragments,t):null);if(s){const i=s.programDateTime;if(i!==null){const o=i+(t-s.start)*1e3;return new Date(o)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class v$ extends $n{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const r in this.keyIdToKeyInfo){const s=this.keyIdToKeyInfo[r].loader;if(s){var t;if(e&&e!==((t=s.context)==null?void 0:t.frag.type))return;s.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=z.KEY_LOAD_ERROR,r,s,i){return new Or({type:we.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:i,error:r,networkDetails:s})}loadClear(e,t,r){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let s=0,i=t.length;s<i;s++){const o=t[s];if(e.cc<=o.cc&&(!Et(e)||!Et(o)||e.sn<o.sn)||!r&&s==i-1)return this.emeController.selectKeySystemFormat(o).then(l=>{if(!this.emeController)return;o.setKeyFormat(l);const c=Gu(l);if(c)return this.emeController.getKeySystemAccess([c])})}if(this.config.requireKeySystemAccessOnStart){const s=ia(this.config);if(s.length)return this.emeController.getKeySystemAccess(s)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var r,s;t&&e.setKeyFormat(t);const i=e.decryptdata;if(!i){const d=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,z.KEY_LOAD_ERROR,d))}const o=i.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,z.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));const l=Mh(i);let c=this.keyIdToKeyInfo[l];if((r=c)!=null&&r.decryptdata.key)return i.key=c.decryptdata.key,Promise.resolve({frag:e,keyInfo:c});if(this.emeController&&(s=c)!=null&&s.keyLoadPromise)switch(this.emeController.getKeyStatus(c.decryptdata)){case"usable":case"usable-in-future":return c.keyLoadPromise.then(f=>{const{keyInfo:h}=f;return i.key=h.decryptdata.key,{frag:e,keyInfo:h}})}switch(this.log(`${this.keyIdToKeyInfo[l]?"Rel":"L"}oading${i.keyId?" keyId: "+Ut(i.keyId):""} URI: ${i.uri} from ${e.type} ${e.level}`),c=this.keyIdToKeyInfo[l]={decryptdata:i,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},i.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return i.keyFormat==="identity"?this.loadKeyHTTP(c,e):this.loadKeyEME(c,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(c,e);default:return Promise.reject(this.createKeyLoadError(e,z.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${i.method}"`)))}}loadKeyEME(e,t){const r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var s;if(!e.decryptdata.keyId&&(s=t.initSegment)!=null&&s.data){const o=F2(t.initSegment.data);if(o.length){let l=o[0];l.some(c=>c!==0)?(this.log(`Using keyId found in init segment ${Ut(l)}`),Ts.setKeyIdForUri(e.decryptdata.uri,l)):(l=Ts.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${Ut(l)}`)),e.decryptdata.keyId=l}}if(!e.decryptdata.keyId&&!Et(t))return Promise.resolve(r);const i=this.emeController.loadKey(r);return(e.keyLoadPromise=i.then(o=>(e.mediaKeySessionContext=o,r))).catch(o=>{throw e.keyLoadPromise=null,"data"in o&&(o.data.frag=t),o})}return Promise.resolve(r)}loadKeyHTTP(e,t){const r=this.config,s=r.loader,i=new s(r);return t.keyLoader=e.loader=i,e.keyLoadPromise=new Promise((o,l)=>{const c={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},d=r.keyLoadPolicy.default,f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:(p,v,g,S)=>{const{frag:x,keyInfo:b}=g,A=Mh(b.decryptdata);if(!x.decryptdata||b!==this.keyIdToKeyInfo[A])return l(this.createKeyLoadError(x,z.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),S));b.decryptdata.key=x.decryptdata.key=new Uint8Array(p.data),x.keyLoader=null,b.loader=null,o({frag:x,keyInfo:b})},onError:(p,v,g,S)=>{this.resetLoader(v),l(this.createKeyLoadError(t,z.KEY_LOAD_ERROR,new Error(`HTTP Error ${p.code} loading key ${p.text}`),g,Je({url:c.url,data:void 0},p)))},onTimeout:(p,v,g)=>{this.resetLoader(v),l(this.createKeyLoadError(t,z.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),g))},onAbort:(p,v,g)=>{this.resetLoader(v),l(this.createKeyLoadError(t,z.INTERNAL_ABORTED,new Error("key loading aborted"),g))}};i.load(c,f,h)})}resetLoader(e){const{frag:t,keyInfo:r,url:s}=e,i=r.loader;t.keyLoader===i&&(t.keyLoader=null,r.loader=null);const o=Mh(r.decryptdata)||s;delete this.keyIdToKeyInfo[o],i&&i.destroy()}}function Mh(n){if(n.keyFormat!==$t.FAIRPLAY){const e=n.keyId;if(e)return Ut(e)}return n.uri}function XS(n){const{type:e}=n;switch(e){case Ge.AUDIO_TRACK:return ge.AUDIO;case Ge.SUBTITLE_TRACK:return ge.SUBTITLE;default:return ge.MAIN}}function Fh(n,e){let t=n.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class x${constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.LEVEL_LOADING,this.onLevelLoading,this),e.on(R.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(R.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(R.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.LEVEL_LOADING,this.onLevelLoading,this),e.off(R.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(R.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(R.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,r=t.pLoader,s=t.loader,i=r||s,o=new i(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:r}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Ge.MANIFEST,url:r,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:r,level:s,pathwayId:i,url:o,deliveryDirectives:l,levelInfo:c}=t;this.load({id:r,level:s,pathwayId:i,responseType:"text",type:Ge.LEVEL,url:o,deliveryDirectives:l,levelOrTrack:c})}onAudioTrackLoading(e,t){const{id:r,groupId:s,url:i,deliveryDirectives:o,track:l}=t;this.load({id:r,groupId:s,level:null,responseType:"text",type:Ge.AUDIO_TRACK,url:i,deliveryDirectives:o,levelOrTrack:l})}onSubtitleTrackLoading(e,t){const{id:r,groupId:s,url:i,deliveryDirectives:o,track:l}=t;this.load({id:r,groupId:s,level:null,responseType:"text",type:Ge.SUBTITLE_TRACK,url:i,deliveryDirectives:o,levelOrTrack:l})}onLevelsUpdated(e,t){const r=this.loaders[Ge.LEVEL];if(r){const s=r.context;s&&!t.levels.some(i=>i===s.levelOrTrack)&&(r.abort(),delete this.loaders[Ge.LEVEL])}}load(e){var t;const r=this.hls.config;let s=this.getInternalLoader(e);if(s){const d=this.hls.logger,f=s.context;if(f&&f.levelOrTrack===e.levelOrTrack&&(f.url===e.url||f.deliveryDirectives&&!e.deliveryDirectives)){f.url===e.url?d.log(`[playlist-loader]: ignore ${e.url} ongoing request`):d.log(`[playlist-loader]: ignore ${e.url} in favor of ${f.url}`);return}d.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),s.abort()}let i;if(e.type===Ge.MANIFEST?i=r.manifestLoadPolicy.default:i=et({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),he((t=e.deliveryDirectives)==null?void 0:t.part)){let d;if(e.type===Ge.LEVEL&&e.level!==null?d=this.hls.levels[e.level].details:e.type===Ge.AUDIO_TRACK&&e.id!==null?d=this.hls.audioTracks[e.id].details:e.type===Ge.SUBTITLE_TRACK&&e.id!==null&&(d=this.hls.subtitleTracks[e.id].details),d){const f=d.partTarget,h=d.targetduration;if(f&&h){const p=Math.max(f*3,h*.8)*1e3;i=et({},i,{maxTimeToFirstByteMs:Math.min(p,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(p,i.maxTimeToFirstByteMs)})}}}const o=i.errorRetry||i.timeoutRetry||{},l={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},c={onSuccess:(d,f,h,p)=>{const v=this.getInternalLoader(h);this.resetInternalLoader(h.type);const g=d.data;f.parsing.start=performance.now(),pr.isMediaPlaylist(g)||h.type!==Ge.MANIFEST?this.handleTrackOrLevelPlaylist(d,f,h,p||null,v):this.handleMasterPlaylist(d,f,h,p)},onError:(d,f,h,p)=>{this.handleNetworkError(f,h,!1,d,p)},onTimeout:(d,f,h)=>{this.handleNetworkError(f,h,!0,void 0,d)}};s.load(e,l,c)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:r}=this.hls;(e||r)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,r,s){const i=this.hls,o=e.data,l=Fh(e,r),c=pr.parseMasterPlaylist(o,l);if(c.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,r,c.playlistParsingError,s,t);return}const{contentSteering:d,levels:f,sessionData:h,sessionKeys:p,startTimeOffset:v,variableList:g}=c;this.variableList=g,f.forEach(A=>{const{unknownCodecs:L}=A;if(L){const{preferManagedMediaSource:I}=this.hls.config;let{audioCodec:k,videoCodec:F}=A;for(let C=L.length;C--;){const P=L[C];Ra(P,"audio",I)?(A.audioCodec=k=k?`${k},${P}`:P,Ji.audio[k.substring(0,4)]=2,L.splice(C,1)):Ra(P,"video",I)&&(A.videoCodec=F=F?`${F},${P}`:P,Ji.video[F.substring(0,4)]=2,L.splice(C,1))}}});const{AUDIO:S=[],SUBTITLES:x,"CLOSED-CAPTIONS":b}=pr.parseMasterPlaylistMedia(o,l,c);S.length&&!S.some(L=>!L.url)&&f[0].audioCodec&&!f[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),S.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new dt({}),bitrate:0,url:""})),i.trigger(R.MANIFEST_LOADED,{levels:f,audioTracks:S,subtitles:x,captions:b,contentSteering:d,url:l,stats:t,networkDetails:s,sessionData:h,sessionKeys:p,startTimeOffset:v,variableList:g})}handleTrackOrLevelPlaylist(e,t,r,s,i){const o=this.hls,{id:l,level:c,type:d}=r,f=Fh(e,r),h=he(c)?c:he(l)?l:0,p=XS(r),v=pr.parseLevelPlaylist(e.data,f,h,p,0,this.variableList);if(d===Ge.MANIFEST){const g={attrs:new dt({}),bitrate:0,details:v,name:"",url:f};v.requestScheduled=t.loading.start+Sw(v,0),o.trigger(R.MANIFEST_LOADED,{levels:[g],audioTracks:[],url:f,stats:t,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=v,this.handlePlaylistLoaded(v,e,t,r,s,i)}handleManifestParsingError(e,t,r,s,i){this.hls.trigger(R.ERROR,{type:we.NETWORK_ERROR,details:z.MANIFEST_PARSING_ERROR,fatal:t.type===Ge.MANIFEST,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:s,stats:i})}handleNetworkError(e,t,r=!1,s,i){let o=`A network ${r?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${e.type}`;e.type===Ge.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===Ge.AUDIO_TRACK||e.type===Ge.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const l=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let c=z.UNKNOWN,d=!1;const f=this.getInternalLoader(e);switch(e.type){case Ge.MANIFEST:c=r?z.MANIFEST_LOAD_TIMEOUT:z.MANIFEST_LOAD_ERROR,d=!0;break;case Ge.LEVEL:c=r?z.LEVEL_LOAD_TIMEOUT:z.LEVEL_LOAD_ERROR,d=!1;break;case Ge.AUDIO_TRACK:c=r?z.AUDIO_TRACK_LOAD_TIMEOUT:z.AUDIO_TRACK_LOAD_ERROR,d=!1;break;case Ge.SUBTITLE_TRACK:c=r?z.SUBTITLE_TRACK_LOAD_TIMEOUT:z.SUBTITLE_LOAD_ERROR,d=!1;break}f&&this.resetInternalLoader(e.type);const h={type:we.NETWORK_ERROR,details:c,fatal:d,url:e.url,loader:f,context:e,error:l,networkDetails:t,stats:i};if(s){const p=t?.url||e.url;h.response=Je({url:p,data:void 0},s)}this.hls.trigger(R.ERROR,h)}handlePlaylistLoaded(e,t,r,s,i,o){const l=this.hls,{type:c,level:d,levelOrTrack:f,id:h,groupId:p,deliveryDirectives:v}=s,g=Fh(t,s),S=XS(s);let x=typeof s.level=="number"&&S===ge.MAIN?d:void 0;const b=e.playlistParsingError;if(b){if(this.hls.logger.warn(`${b} ${e.url}`),!l.config.ignorePlaylistParsingErrors){l.trigger(R.ERROR,{type:we.NETWORK_ERROR,details:z.LEVEL_PARSING_ERROR,fatal:!1,url:g,error:b,reason:b.message,response:t,context:s,level:x,parent:S,networkDetails:i,stats:r});return}e.playlistParsingError=null}if(!e.fragments.length){const A=e.playlistParsingError=new Error("No Segments found in Playlist");l.trigger(R.ERROR,{type:we.NETWORK_ERROR,details:z.LEVEL_EMPTY_ERROR,fatal:!1,url:g,error:A,reason:A.message,response:t,context:s,level:x,parent:S,networkDetails:i,stats:r});return}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),c){case Ge.MANIFEST:case Ge.LEVEL:if(x){if(!f)x=0;else if(f!==l.levels[x]){const A=l.levels.indexOf(f);A>-1&&(x=A)}}l.trigger(R.LEVEL_LOADED,{details:e,levelInfo:f||l.levels[0],level:x||0,id:h||0,stats:r,networkDetails:i,deliveryDirectives:v,withoutMultiVariant:c===Ge.MANIFEST});break;case Ge.AUDIO_TRACK:l.trigger(R.AUDIO_TRACK_LOADED,{details:e,track:f,id:h||0,groupId:p||"",stats:r,networkDetails:i,deliveryDirectives:v});break;case Ge.SUBTITLE_TRACK:l.trigger(R.SUBTITLE_TRACK_LOADED,{details:e,track:f,id:h||0,groupId:p||"",stats:r,networkDetails:i,deliveryDirectives:v});break}}}class An{static get version(){return Ca}static isMSESupported(){return x1()}static isSupported(){return m$()}static getMediaSource(){return Ls()}static get Events(){return R}static get MetadataSchema(){return wn}static get ErrorTypes(){return we}static get ErrorDetails(){return z}static get DefaultConfig(){return An.defaultConfig?An.defaultConfig:n$}static set DefaultConfig(e){An.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Vp,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=A2(e.debug||!1,"Hls instance",e.assetPlayerId),r=this.config=s$(An.DefaultConfig,e,t);this.userConfig=e,r.progressive&&i$(r,t);const{abrController:s,bufferController:i,capLevelController:o,errorController:l,fpsController:c}=r,d=new l(this),f=this.abrController=new s(this),h=new SM(this),p=r.interstitialsController,v=p?this.interstitialsController=new p(this,An):null,g=this.bufferController=new i(this,h),S=this.capLevelController=new o(this),x=new c(this),b=new x$(this),A=r.contentSteeringController,L=A?new A(this):null,I=this.levelController=new h$(this,L),k=new d$(this),F=new v$(this.config,this.logger),C=this.streamController=new y$(this,h,F),P=this.gapController=new u$(this,h);S.setStreamController(C),x.setStreamController(C);const O=[b,I,C];v&&O.splice(1,0,v),L&&O.splice(1,0,L),this.networkControllers=O;const M=[f,g,P,S,x,k,h];this.audioTrackController=this.createController(r.audioTrackController,O);const H=r.audioStreamController;H&&O.push(this.audioStreamController=new H(this,h,F)),this.subtitleTrackController=this.createController(r.subtitleTrackController,O);const Z=r.subtitleStreamController;Z&&O.push(this.subtititleStreamController=new Z(this,h,F)),this.createController(r.timelineController,M),F.emeController=this.emeController=this.createController(r.emeController,M),this.cmcdController=this.createController(r.cmcdController,M),this.latencyController=this.createController(f$,M),this.coreComponents=M,O.push(d);const se=d.onErrorOut;typeof se=="function"&&this.on(R.ERROR,se,d),this.on(R.MANIFEST_LOADED,b.onManifestLoaded,b)}createController(e,t){if(e){const r=new e(this);return t&&t.push(r),r}return null}on(e,t,r=this){this._emitter.on(e,t,r)}once(e,t,r=this){this._emitter.once(e,t,r)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,r=this,s){this._emitter.off(e,t,r,s)}listeners(e){return this._emitter.listeners(e)}emit(e,t,r){return this._emitter.emit(e,t,r)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(r){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+r.message+'". Here is a stacktrace:',r),!this.triggeringException){this.triggeringException=!0;const s=e===R.ERROR;this.trigger(R.ERROR,{type:we.OTHER_ERROR,details:z.INTERNAL_EXCEPTION,fatal:s,event:e,error:r}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(R.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const i=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(R.ERROR,{type:we.OTHER_ERROR,details:z.ATTACH_MEDIA_ERROR,fatal:!0,error:i});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,r=t?e.media:e,s=t?e:{media:r};this._media=r,this.trigger(R.MEDIA_ATTACHING,s)}detachMedia(){this.logger.log("detachMedia"),this.trigger(R.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(R.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,r=this._url,s=this._url=kp.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${s}`),t&&r&&(r!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(R.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let r=0;r<this.networkControllers.length&&(this.networkControllers[r].startLoad(e,t),!(!this.started||!this.networkControllers));r++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[ge.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[ge.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[ge.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e?.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=uU()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){sM(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const r=e.length;for(let s=0;s<r;s++)if(e[s].maxBitrate>=t)return s;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:r}=this;let s;if(t===-1&&e!=null&&e.length?s=e.length-1:s=t,r)for(let i=s;i--;){const o=e[i].attrs["HDCP-LEVEL"];if(o&&o<=r)return i}return s}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const r=iw(t);return rw(e,r,navigator.mediaCapabilities)}}An.defaultConfig=void 0;const S$=()=>{const[n,e]=N.useState(null),t=N.useRef(null),r=N.useRef(null),s=[{id:"tsports",name:"T Sports",logo:"https://upload.wikimedia.org/wikipedia/en/thumb/d/d7/T_Sports_logo.svg/1200px-T_Sports_logo.svg.png",streamUrl:"http://192.168.91.8/streams/118/index.m3u8",country:" Bangladesh",category:"Sports"}];N.useEffect(()=>{if(!n||!t.current)return;const l=t.current;if(r.current&&r.current.destroy(),An.isSupported()){const c=new An({enableWorker:!0,lowLatencyMode:!0,backBufferLength:90});r.current=c,c.loadSource(n.streamUrl),c.attachMedia(l),c.on(An.Events.MANIFEST_PARSED,()=>{l.play().catch(d=>console.log("Autoplay prevented:",d))}),c.on(An.Events.ERROR,(d,f)=>{if(console.error("HLS Error:",f),f.fatal)switch(f.type){case An.ErrorTypes.NETWORK_ERROR:console.log("Network error, trying to recover..."),c.startLoad();break;case An.ErrorTypes.MEDIA_ERROR:console.log("Media error, trying to recover..."),c.recoverMediaError();break;default:console.log("Fatal error, cannot recover"),c.destroy();break}})}else l.canPlayType("application/vnd.apple.mpegurl")&&(l.src=n.streamUrl,l.addEventListener("loadedmetadata",()=>{l.play().catch(c=>console.log("Autoplay prevented:",c))}));return()=>{r.current&&r.current.destroy()}},[n]);const i=l=>{e(l)},o=()=>{t.current&&t.current.requestFullscreen&&t.current.requestFullscreen()};return E.jsx("div",{className:"min-h-screen bg-black pt-20 pb-16",children:E.jsxs("div",{className:"max-w-7xl mx-auto mobile-padding sm:px-6",children:[E.jsxs("div",{className:"mb-6 sm:mb-8",children:[E.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[E.jsx(im,{className:"text-red-600 w-6 h-6 sm:w-8 sm:h-8"}),E.jsx("h1",{className:"text-3xl sm:text-4xl md:text-5xl font-bold text-white",children:"Live TV"}),E.jsxs("div",{className:"flex items-center gap-2 px-2 sm:px-3 py-1 bg-red-600/20 border border-red-600 rounded-full",children:[E.jsxs("span",{className:"relative flex h-2 w-2",children:[E.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-500 opacity-75"}),E.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-red-600"})]}),E.jsx("span",{className:"text-red-500 text-xs font-bold uppercase",children:"Live"})]})]}),E.jsx("p",{className:"text-gray-400 text-sm sm:text-lg",children:"Watch live TV channels streaming now"})]}),n?E.jsx("div",{className:"mb-8",children:E.jsxs("div",{className:"relative bg-black rounded-lg overflow-hidden border-2 border-red-600/50 shadow-2xl shadow-red-600/20",children:[E.jsx("div",{className:"relative aspect-video bg-black",children:E.jsx("video",{ref:t,className:"w-full h-full",controls:!0,playsInline:!0,autoPlay:!0,muted:!1})}),E.jsx("div",{className:"bg-neutral-900/95 backdrop-blur-sm p-4 border-t border-neutral-800",children:E.jsxs("div",{className:"flex items-center justify-between",children:[E.jsxs("div",{className:"flex items-center gap-4",children:[E.jsx("img",{src:n.logo,alt:n.name,className:"w-12 h-12 object-contain bg-white rounded-lg p-1"}),E.jsxs("div",{children:[E.jsx("h3",{className:"text-white font-bold text-lg",children:n.name}),E.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[E.jsx("span",{children:n.country}),E.jsx("span",{children:""}),E.jsx("span",{className:"text-red-500",children:n.category}),E.jsx("span",{children:""}),E.jsxs("div",{className:"flex items-center gap-1",children:[E.jsxs("span",{className:"relative flex h-2 w-2",children:[E.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-500 opacity-75"}),E.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-red-600"})]}),E.jsx("span",{className:"text-red-500 font-semibold",children:"LIVE"})]})]})]})]}),E.jsx("div",{className:"flex items-center gap-2",children:E.jsx("button",{onClick:o,className:"p-2 bg-neutral-800 hover:bg-neutral-700 rounded-lg transition-colors touch-target",children:E.jsx(WP,{className:"w-5 h-5 text-white"})})})]})})]})}):null,E.jsxs("div",{children:[E.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Available Channels"}),E.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:s.map(l=>E.jsxs("button",{onClick:()=>i(l),className:`group relative bg-neutral-900 rounded-lg overflow-hidden border-2 transition-all hover:scale-105 hover:shadow-2xl ${n?.id===l.id?"border-red-600 shadow-xl shadow-red-600/20":"border-neutral-800 hover:border-red-600/50"}`,children:[E.jsx("div",{className:"aspect-square p-4 flex items-center justify-center bg-white",children:E.jsx("img",{src:l.logo,alt:l.name,className:"w-full h-full object-contain"})}),E.jsxs("div",{className:"p-3 bg-neutral-900",children:[E.jsx("h3",{className:"text-white font-semibold text-sm mb-1 truncate",children:l.name}),E.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-400",children:[E.jsxs("span",{className:"relative flex h-1.5 w-1.5",children:[E.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-500 opacity-75"}),E.jsx("span",{className:"relative inline-flex rounded-full h-1.5 w-1.5 bg-red-600"})]}),E.jsx("span",{className:"text-red-500 font-semibold",children:"LIVE"})]}),E.jsx("p",{className:"text-xs text-gray-500 mt-1",children:l.category})]}),n?.id===l.id&&E.jsx("div",{className:"absolute top-2 right-2",children:E.jsx("div",{className:"p-1.5 bg-red-600 rounded-full",children:E.jsx(zr,{className:"w-3 h-3 text-white"})})})]},l.id))})]}),!n&&E.jsx("div",{className:"mt-12 text-center",children:E.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-neutral-900 border border-neutral-800 rounded-full",children:[E.jsx(im,{className:"text-red-600"}),E.jsx("span",{className:"text-gray-400 text-sm",children:"Select a channel to start watching"})]})})]})})},QS="http://127.0.0.1:8000/api",E$=300*1e3;class T${axiosInstance;refreshPromise=null;constructor(){this.axiosInstance=Ye.create({baseURL:QS,timeout:1e4,headers:{"Content-Type":"application/json",Accept:"application/json"},withCredentials:!1}),this.setupInterceptors()}setupInterceptors(){this.axiosInstance.interceptors.request.use(async e=>{const t=await this.getValidAccessToken();return t&&e.headers&&(e.headers.Authorization=`Bearer ${t}`),["post","put","patch","delete"].includes(e.method?.toLowerCase()||"")&&(e.headers["X-Requested-With"]="XMLHttpRequest"),e.headers["X-Request-Time"]=Date.now().toString(),e},e=>Promise.reject(this.handleError(e))),this.axiosInstance.interceptors.response.use(e=>e,async e=>{const t=e.config;if(e.response?.status===401&&!t._retry){t._retry=!0;try{const r=await this.refreshAccessToken();if(r&&t.headers)return t.headers.Authorization=`Bearer ${r}`,this.axiosInstance.request(t)}catch(r){return this.handleAuthFailure(),Promise.reject(this.handleError(r))}}return Promise.reject(this.handleError(e))})}async getValidAccessToken(){const e=this.getStoredAccessToken();if(!e)return null;if(this.isTokenExpiring(e))try{return await this.refreshAccessToken()}catch(t){return console.error("Token refresh failed:",t),null}return e}getStoredAccessToken(){try{const e=localStorage.getItem("sanviplex_auth");return e&&JSON.parse(e).access||null}catch(e){return console.error("Error reading access token:",e),this.clearStoredTokens(),null}}getStoredRefreshToken(){try{const e=localStorage.getItem("sanviplex_auth");return e&&JSON.parse(e).refresh||null}catch(e){return console.error("Error reading refresh token:",e),this.clearStoredTokens(),null}}isTokenExpiring(e){try{const r=JSON.parse(atob(e.split(".")[1])).exp*1e3,s=Date.now();return r-s<E$}catch(t){return console.error("Error parsing token:",t),!0}}async refreshAccessToken(){if(this.refreshPromise)return this.refreshPromise;this.refreshPromise=this.performTokenRefresh();try{return await this.refreshPromise}finally{this.refreshPromise=null}}async performTokenRefresh(){const e=this.getStoredRefreshToken();if(!e)throw new Error("No refresh token available");try{const t=await Ye.post(`${QS}/token/refresh/`,{refresh:e},{headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},timeout:1e4}),{access:r}=t.data;return this.updateStoredAccessToken(r),r}catch{throw this.handleAuthFailure(),new Error("Token refresh failed")}}updateStoredAccessToken(e){try{const t=localStorage.getItem("sanviplex_auth");if(t){const r=JSON.parse(t);r.access=e,localStorage.setItem("sanviplex_auth",JSON.stringify(r))}}catch(t){console.error("Error updating access token:",t)}}handleAuthFailure(){this.clearStoredTokens(),window.location.pathname.includes("/login")||(window.location.href="/login?expired=true")}clearStoredTokens(){localStorage.removeItem("sanviplex_auth"),localStorage.removeItem("sanviplex_user")}handleError(e){if(Ye.isAxiosError(e)){if(e.response){const t=e.response.data;if(t&&typeof t=="object"){if(t.detail)return{message:t.detail};const r=Object.entries(t).filter(([s,i])=>Array.isArray(i)&&i.length>0).map(([s,i])=>({field:s,message:i[0]}));if(r.length>0)return r[0]}return{message:`Server error: ${e.response.status}`,code:e.response.status.toString()}}else if(e.request)return{message:"Network error. Please check your connection."}}return{message:e.message||"An unexpected error occurred"}}storeTokens(e){try{localStorage.setItem("sanviplex_auth",JSON.stringify(e))}catch(t){console.error("Error storing tokens:",t)}}clearTokens(){this.clearStoredTokens()}isAuthenticated(){const e=this.getStoredAccessToken();return!!e&&!this.isTokenExpiring(e)}async signup(e){console.log(" Signing up user:",e.email,"API URL:",this.axiosInstance.defaults.baseURL);try{const t=await this.axiosInstance.post("/signup/",e);return console.log(" Signup Response:",t.data),t.data}catch(t){throw console.error(" Signup Error:",t),t}}async login(e,t){console.log(" Logging in user:",e);try{const r=await this.axiosInstance.post("/login/",{email:e,password:t});return console.log(" Login Response:",r.data),r.data}catch(r){throw console.error(" Login Error:",r),r}}async sendOTP(e){console.log(" Sending OTP to:",e,"API URL:",this.axiosInstance.defaults.baseURL);try{const t=await this.axiosInstance.post("/send-otp/",{email:e});return console.log(" OTP Response:",t.data),t.data}catch(t){throw console.error(" OTP Error:",t),t}}async verifyOTP(e,t){return(await this.axiosInstance.post("/verify-otp/",{email:e,otp:t})).data}async updateUserProfile(e){return(await this.axiosInstance.put("/auth/profile/",e)).data.user}async get(e,t){return(await this.axiosInstance.get(e,t)).data}async post(e,t,r){return(await this.axiosInstance.post(e,t,r)).data}async put(e,t,r){return(await this.axiosInstance.put(e,t,r)).data}async delete(e,t){return(await this.axiosInstance.delete(e,t)).data}}const cr=new T$,ga=n=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n),b$=n=>{const e=[];return n.length<8&&e.push("Password must be at least 8 characters long"),/(?=.*[a-z])/.test(n)||e.push("Password must contain at least one lowercase letter"),/(?=.*[A-Z])/.test(n)||e.push("Password must contain at least one uppercase letter"),/(?=.*\d)/.test(n)||e.push("Password must contain at least one number"),{isValid:e.length===0,errors:e}},S1=N.createContext(void 0),E1=()=>{const n=N.useContext(S1);if(n===void 0)throw new Error("useAuth must be used within an AuthProvider");return n},w$=({children:n})=>{const[e,t]=N.useState({user:null,isLoading:!0,isAuthenticated:!1,error:null});N.useEffect(()=>{(async()=>{try{const S=localStorage.getItem("sanviplex_user");if(S&&cr.isAuthenticated()){const x=JSON.parse(S);t({user:x,isLoading:!1,isAuthenticated:!0,error:null})}else cr.clearTokens(),localStorage.removeItem("sanviplex_user"),t(x=>({...x,isLoading:!1}))}catch(S){console.error("Auth initialization error:",S),cr.clearTokens(),localStorage.removeItem("sanviplex_user"),t({user:null,isLoading:!1,isAuthenticated:!1,error:"Session expired. Please sign in again."})}})()},[]);const r=g=>{t(S=>({...S,isLoading:g}))},s=g=>{t(S=>({...S,error:g}))},i=g=>{t(S=>({...S,user:g,isAuthenticated:!!g,error:null}))},v={...e,login:async(g,S)=>{r(!0),s(null);try{if(!ga(g))throw new Error("Invalid email format");const x=await cr.login(g,S);if("requires_verification"in x&&x.requires_verification)throw new Error("Please verify your email before logging in. Check your inbox for the verification link.");const b=x;cr.storeTokens({access:b.access,refresh:b.refresh});const A={...b.user,full_name:`${b.user.first_name} ${b.user.last_name}`.trim(),preferences:{language:"en",theme:"dark",notifications:!0,autoplay:!0}};localStorage.setItem("sanviplex_user",JSON.stringify(A)),i(A)}catch(x){const b=x.message||"Login failed";throw s(b),new Error(b)}finally{r(!1)}},signup:async g=>{r(!0),s(null);try{if(!ga(g.email))throw new Error("Invalid email format");return await cr.signup({email:g.email,first_name:g.firstName,last_name:g.lastName,password:g.password,confirm_password:g.password})}catch(S){const x=S.message||"Signup failed";throw s(x),new Error(x)}finally{r(!1)}},sendOTP:async g=>{r(!0),s(null);try{if(!ga(g))throw new Error("Invalid email format");return await cr.sendOTP(g)}catch(S){const x=S.message||"Failed to send OTP";throw s(x),new Error(x)}finally{r(!1)}},verifyOTP:async(g,S)=>{r(!0),s(null);try{const x=await cr.verifyOTP(g,S);cr.storeTokens({access:x.access,refresh:x.refresh});const b={...x.user,full_name:`${x.user.first_name} ${x.user.last_name}`.trim(),preferences:{language:"en",theme:"dark",notifications:!0,autoplay:!0}};localStorage.setItem("sanviplex_user",JSON.stringify(b)),i(b)}catch(x){const b=x.message||"OTP verification failed";throw s(b),new Error(b)}finally{r(!1)}},logout:async()=>{r(!0);try{cr.clearTokens(),localStorage.removeItem("sanviplex_user"),i(null)}catch(g){console.error("Logout error:",g)}finally{r(!1)}},updateProfile:async g=>{if(!e.user)throw new Error("No user logged in");r(!0),s(null);try{const S={...e.user,...g};localStorage.setItem("sanviplex_user",JSON.stringify(S)),i(S)}catch(S){const x=S.message||"Failed to update profile";throw s(x),new Error(x)}finally{r(!1)}},clearError:()=>{s(null)}};return E.jsx(S1.Provider,{value:v,children:n})},A$=()=>{const n=hn(),{login:e,isLoading:t,error:r}=E1(),[s,i]=N.useState({email:"",password:"",rememberMe:!1}),[o,l]=N.useState(!1),[c,d]=N.useState({}),f=(v,g)=>{i(S=>({...S,[v]:g})),c[v]&&d(S=>({...S,[v]:""}))},h=()=>{const v={};return s.email?ga(s.email)||(v.email="Please enter a valid email address"):v.email="Email is required",s.password||(v.password="Password is required"),d(v),Object.keys(v).length===0},p=async v=>{if(v.preventDefault(),!!h())try{await e(s.email,s.password),n("/")}catch(g){console.error("Login error:",g),d({general:g.message||"Login failed. Please try again."})}};return E.jsxs("div",{className:"min-h-screen bg-black text-white relative flex items-center justify-center overflow-hidden",children:[E.jsxs("div",{className:"fixed inset-0 pointer-events-none z-0",children:[E.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-red-950/20 via-black to-black"}),[...Array(50)].map((v,g)=>E.jsx("div",{className:"absolute w-0.5 h-0.5 bg-red-500/30 rounded-full animate-pulse",style:{left:Math.random()*100+"%",top:Math.random()*100+"%",animationDelay:Math.random()*5+"s",animationDuration:3+Math.random()*4+"s"}},g)),[...Array(8)].map((v,g)=>E.jsx("div",{className:"absolute border border-red-500/20 rounded-2xl animate-pulse",style:{width:20+Math.random()*80+"px",height:20+Math.random()*80+"px",left:Math.random()*100+"%",top:Math.random()*100+"%",animationDelay:Math.random()*3+"s",animationDuration:4+Math.random()*6+"s",transform:`rotate(${Math.random()*360}deg)`}},`shape-${g}`))]}),E.jsxs(Zs,{to:"/",className:"absolute top-8 left-8 z-50 flex items-center space-x-2 px-6 py-3 rounded-2xl bg-white/10 backdrop-blur-xl border border-white/20 text-white/80 hover:text-white hover:bg-white/15 transition-all duration-300 group",children:[E.jsx(sc,{className:"rotate-180 group-hover:-translate-x-1 transition-transform duration-300",size:18}),E.jsx("span",{className:"font-medium",children:"Back to Sanviplex"})]}),E.jsx("div",{className:"relative z-10 w-full max-w-md mx-auto px-6",children:E.jsxs("div",{className:"bg-black/80 backdrop-blur-3xl border border-white/10 rounded-3xl p-8 shadow-2xl shadow-black/60 relative overflow-hidden",children:[E.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/5 via-transparent to-red-500/5 pointer-events-none"}),E.jsxs("div",{className:"relative z-10 text-center mb-8",children:[E.jsx("div",{className:"flex items-center justify-center mb-6",children:E.jsx("img",{src:"/src/utils/logo.png",alt:"Sanviplex",className:"h-16 w-auto filter drop-shadow-2xl"})}),E.jsx("h1",{className:"text-3xl font-black bg-gradient-to-r from-white via-red-100 to-red-200 bg-clip-text text-transparent mb-2",children:"Welcome Back"}),E.jsx("p",{className:"text-white/60 text-sm",children:"Sign in to continue your streaming journey"})]}),E.jsx("div",{className:"text-center mb-6",children:E.jsx("p",{className:"text-white/80 text-sm",children:"Enter your email and password to sign in"})}),(c.general||r)&&E.jsx("div",{className:"relative z-10 mb-6 p-4 bg-red-500/20 border border-red-500/40 rounded-2xl",children:E.jsxs("div",{className:"flex items-center space-x-2",children:[E.jsx(ln,{className:"text-red-400",size:16}),E.jsx("span",{className:"text-red-200 text-sm",children:c.general||r})]})}),E.jsxs("form",{onSubmit:p,className:"relative z-10 space-y-6",children:[E.jsxs("div",{children:[E.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Email Address"}),E.jsxs("div",{className:"relative",children:[E.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:E.jsx(JT,{className:"text-white/40",size:18})}),E.jsx("input",{type:"email",value:s.email,onChange:v=>f("email",v.target.value),placeholder:"Enter your email address",className:`w-full pl-12 pr-4 py-4 bg-white/5 border rounded-2xl text-white placeholder-white/40 focus:outline-none transition-all duration-300 ${c.email?"border-red-500/60 focus:border-red-500 focus:bg-red-500/10":"border-white/20 focus:border-red-500/60 focus:bg-white/10"}`})]}),c.email&&E.jsxs("p",{className:"mt-2 text-red-400 text-xs flex items-center space-x-1",children:[E.jsx(ln,{size:12}),E.jsx("span",{children:c.email})]})]}),E.jsxs("div",{children:[E.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Password"}),E.jsxs("div",{className:"relative",children:[E.jsx("input",{type:o?"text":"password",value:s.password,onChange:v=>f("password",v.target.value),placeholder:"Enter your password",className:`w-full pl-4 pr-12 py-4 bg-white/5 border rounded-2xl text-white placeholder-white/40 focus:outline-none transition-all duration-300 ${c.password?"border-red-500/60 focus:border-red-500 focus:bg-red-500/10":"border-white/20 focus:border-red-500/60 focus:bg-white/10"}`}),E.jsx("button",{type:"button",onClick:()=>l(!o),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-white/40 hover:text-white/60 transition-colors duration-200",children:o?E.jsx(rm,{size:18}):E.jsx(sm,{size:18})})]}),c.password&&E.jsxs("p",{className:"mt-2 text-red-400 text-xs flex items-center space-x-1",children:[E.jsx(ln,{size:12}),E.jsx("span",{children:c.password})]})]}),E.jsx("div",{className:"flex items-center",children:E.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer group",children:[E.jsxs("div",{className:"relative",children:[E.jsx("input",{type:"checkbox",checked:s.rememberMe,onChange:v=>f("rememberMe",v.target.checked),className:"sr-only"}),E.jsx("div",{className:`w-5 h-5 rounded border-2 transition-all duration-200 ${s.rememberMe?"bg-red-500 border-red-500":"border-white/30 group-hover:border-white/50"}`,children:s.rememberMe&&E.jsx(nm,{className:"text-white",size:12})})]}),E.jsx("span",{className:"text-white/70 text-sm group-hover:text-white/90 transition-colors duration-200",children:"Remember this device"})]})}),E.jsx("button",{type:"submit",disabled:t,className:"w-full py-4 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold rounded-2xl transition-all duration-300 transform hover:scale-[1.02] hover:shadow-2xl hover:shadow-red-500/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center space-x-2",children:t?E.jsxs(E.Fragment,{children:[E.jsx("div",{className:"w-5 h-5 border-2 border-white/20 border-t-white rounded-full animate-spin"}),E.jsx("span",{children:"Signing In..."})]}):E.jsxs(E.Fragment,{children:[E.jsx("span",{children:"Sign In"}),E.jsx(sc,{className:"group-hover:translate-x-1 transition-transform duration-300",size:18})]})})]}),E.jsxs("p",{className:"relative z-10 text-center mt-8 text-white/60",children:["Don't have an account?"," ",E.jsx(Zs,{to:"/signup",className:"text-red-400 hover:text-red-300 font-medium transition-colors duration-200",children:"Create one now"})]})]})}),E.jsx("div",{className:"fixed bottom-10 left-10 w-20 h-20 border border-red-500/20 rounded-full animate-pulse"}),E.jsx("div",{className:"fixed top-1/4 right-20 w-16 h-16 border border-red-500/30 rounded-2xl animate-pulse",style:{animationDelay:"1s"}}),E.jsx("div",{className:"fixed bottom-1/4 right-10 w-12 h-12 bg-red-500/10 rounded-full animate-pulse",style:{animationDelay:"2s"}})]})},L$=()=>{const n=hn(),{signup:e,sendOTP:t,verifyOTP:r,isLoading:s,error:i}=E1(),[o,l]=N.useState("form"),[c,d]=N.useState({firstName:"",lastName:"",email:"",password:"",confirmPassword:"",agreeToTerms:!1,subscribeNewsletter:!1}),[f,h]=N.useState(!1),[p,v]=N.useState(!1),[g,S]=N.useState(""),[x,b]=N.useState({}),A=(C,P)=>{d(O=>({...O,[C]:P})),x[C]&&b(O=>({...O,[C]:""}))},L=()=>{const C={};if(c.firstName.trim()||(C.firstName="First name is required"),c.lastName.trim()||(C.lastName="Last name is required"),c.email?ga(c.email)||(C.email="Please enter a valid email address"):C.email="Email is required",!c.password)C.password="Password is required";else{const P=b$(c.password);P.isValid||(C.password=P.errors[0])}return c.confirmPassword?c.password!==c.confirmPassword&&(C.confirmPassword="Passwords do not match"):C.confirmPassword="Please confirm your password",c.agreeToTerms||(C.agreeToTerms="You must agree to the terms and conditions"),b(C),Object.keys(C).length===0},I=async C=>{if(C.preventDefault(),!!L())try{const P=await e({firstName:c.firstName,lastName:c.lastName,email:c.email,password:c.password});console.log("Registration successful:",P.message),l("otp"),b({})}catch(P){console.error("Registration error:",P),b({general:P.message||"Registration failed. Please try again."})}},k=async()=>{if(!g||g.length!==6){b({otp:"Please enter a valid 6-digit OTP"});return}try{await r(c.email,g),n("/")}catch(C){console.error("OTP verification error:",C),b({otp:C.message||"OTP verification failed. Please try again."})}},F=async()=>{try{await t(c.email),b({})}catch(C){b({otp:C.message||"Failed to resend OTP. Please try again."})}};return o==="otp"?E.jsxs("div",{className:"min-h-screen bg-black text-white relative flex items-center justify-center overflow-hidden",children:[E.jsx("div",{className:"fixed inset-0 pointer-events-none z-0",children:E.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-red-950/20 via-black to-black"})}),E.jsx("div",{className:"relative z-10 w-full max-w-md mx-auto px-6",children:E.jsxs("div",{className:"bg-black/80 backdrop-blur-3xl border border-white/10 rounded-3xl p-8 shadow-2xl",children:[E.jsxs("div",{className:"text-center mb-8",children:[E.jsx("h1",{className:"text-3xl font-black bg-gradient-to-r from-white via-red-100 to-red-200 bg-clip-text text-transparent mb-2",children:"Verify Your Email"}),E.jsxs("p",{className:"text-white/60 text-sm",children:["We've sent a 6-digit code to ",c.email]})]}),x.otp&&E.jsx("div",{className:"mb-6 p-4 bg-red-500/20 border border-red-500/40 rounded-2xl",children:E.jsxs("div",{className:"flex items-center space-x-2",children:[E.jsx(ln,{className:"text-red-400",size:16}),E.jsx("span",{className:"text-red-200 text-sm",children:x.otp})]})}),E.jsxs("div",{className:"space-y-6",children:[E.jsxs("div",{children:[E.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Verification Code"}),E.jsx("input",{type:"text",value:g,onChange:C=>S(C.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"Enter 6-digit code",className:"w-full px-4 py-4 bg-white/5 border border-white/20 rounded-2xl text-white placeholder-white/40 focus:outline-none focus:border-red-500/60 focus:bg-white/10 transition-all duration-300 text-center text-2xl tracking-widest",maxLength:6})]}),E.jsx("button",{onClick:k,disabled:s||g.length!==6,className:"w-full py-4 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold rounded-2xl transition-all duration-300 transform hover:scale-[1.02] hover:shadow-2xl hover:shadow-red-500/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center space-x-2",children:s?E.jsxs(E.Fragment,{children:[E.jsx("div",{className:"w-5 h-5 border-2 border-white/20 border-t-white rounded-full animate-spin"}),E.jsx("span",{children:"Verifying..."})]}):E.jsxs(E.Fragment,{children:[E.jsx("span",{children:"Verify & Complete Signup"}),E.jsx(sc,{size:18})]})}),E.jsxs("div",{className:"text-center space-y-4",children:[E.jsx("button",{onClick:F,disabled:s,className:"text-red-400 hover:text-red-300 text-sm transition-colors duration-200 disabled:opacity-50",children:"Resend Code"}),E.jsx("button",{onClick:()=>l("form"),className:"block w-full text-white/60 hover:text-white/80 text-sm transition-colors duration-200",children:" Back to Signup"})]})]})]})})]}):E.jsxs("div",{className:"min-h-screen relative overflow-hidden bg-black",children:[E.jsxs("div",{className:"absolute inset-0",children:[E.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-red-900/20 via-black to-red-800/10"}),E.jsx("div",{className:"absolute top-20 left-10 w-72 h-72 bg-red-600/10 rounded-full blur-3xl animate-pulse"}),E.jsx("div",{className:"absolute bottom-20 right-10 w-96 h-96 bg-red-500/5 rounded-full blur-3xl animate-pulse delay-1000"}),E.jsx("div",{className:"absolute top-1/2 left-1/4 w-64 h-64 bg-red-400/5 rounded-full blur-3xl animate-pulse delay-500"}),E.jsx("div",{className:"absolute inset-0 opacity-5",style:{backgroundImage:`
              linear-gradient(rgba(255, 0, 0, 0.1) 1px, transparent 1px),
              linear-gradient(90deg, rgba(255, 0, 0, 0.1) 1px, transparent 1px)
            `,backgroundSize:"50px 50px"}})]}),E.jsx("div",{className:"relative z-10 flex items-center justify-center min-h-screen p-4",children:E.jsx("div",{className:"w-full max-w-md",children:E.jsxs("div",{className:"bg-black/40 backdrop-blur-2xl border border-white/10 rounded-3xl shadow-2xl shadow-red-500/10 p-8",children:[E.jsxs("div",{className:"text-center mb-8",children:[E.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-red-500/20 rounded-full mb-4",children:E.jsx(nb,{className:"text-red-400",size:24})}),E.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Create Account"}),E.jsx("p",{className:"text-gray-400 text-sm",children:"Join Sanviplex for unlimited streaming"})]}),(x.general||i)&&E.jsx("div",{className:"relative z-10 mb-6 p-4 bg-red-500/20 border border-red-500/40 rounded-2xl",children:E.jsxs("div",{className:"flex items-center space-x-2",children:[E.jsx(ln,{className:"text-red-400",size:16}),E.jsx("span",{className:"text-red-200 text-sm",children:x.general||i})]})}),E.jsxs("form",{onSubmit:I,className:"space-y-6",children:[E.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[E.jsxs("div",{children:[E.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"First Name"}),E.jsx("input",{type:"text",value:c.firstName,onChange:C=>A("firstName",C.target.value),placeholder:"John",className:`w-full px-4 py-4 bg-white/5 border rounded-2xl text-white placeholder-white/40 focus:outline-none transition-all duration-300 ${x.firstName?"border-red-500/60 focus:border-red-500 focus:bg-red-500/10":"border-white/20 focus:border-red-500/60 focus:bg-white/10"}`}),x.firstName&&E.jsxs("p",{className:"mt-2 text-red-400 text-xs flex items-center space-x-1",children:[E.jsx(ln,{size:12}),E.jsx("span",{children:x.firstName})]})]}),E.jsxs("div",{children:[E.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Last Name"}),E.jsx("input",{type:"text",value:c.lastName,onChange:C=>A("lastName",C.target.value),placeholder:"Doe",className:`w-full px-4 py-4 bg-white/5 border rounded-2xl text-white placeholder-white/40 focus:outline-none transition-all duration-300 ${x.lastName?"border-red-500/60 focus:border-red-500 focus:bg-red-500/10":"border-white/20 focus:border-red-500/60 focus:bg-white/10"}`}),x.lastName&&E.jsxs("p",{className:"mt-2 text-red-400 text-xs flex items-center space-x-1",children:[E.jsx(ln,{size:12}),E.jsx("span",{children:x.lastName})]})]})]}),E.jsxs("div",{children:[E.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Email Address"}),E.jsxs("div",{className:"relative",children:[E.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:E.jsx(JT,{className:"text-white/40",size:18})}),E.jsx("input",{type:"email",value:c.email,onChange:C=>A("email",C.target.value),placeholder:"Enter your email address",className:`w-full pl-12 pr-4 py-4 bg-white/5 border rounded-2xl text-white placeholder-white/40 focus:outline-none transition-all duration-300 ${x.email?"border-red-500/60 focus:border-red-500 focus:bg-red-500/10":"border-white/20 focus:border-red-500/60 focus:bg-white/10"}`})]}),x.email&&E.jsxs("p",{className:"mt-2 text-red-400 text-xs flex items-center space-x-1",children:[E.jsx(ln,{size:12}),E.jsx("span",{children:x.email})]})]}),E.jsxs("div",{children:[E.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Password"}),E.jsxs("div",{className:"relative",children:[E.jsx("input",{type:f?"text":"password",value:c.password,onChange:C=>A("password",C.target.value),placeholder:"Create a strong password",className:`w-full pl-4 pr-12 py-4 bg-white/5 border rounded-2xl text-white placeholder-white/40 focus:outline-none transition-all duration-300 ${x.password?"border-red-500/60 focus:border-red-500 focus:bg-red-500/10":"border-white/20 focus:border-red-500/60 focus:bg-white/10"}`}),E.jsx("button",{type:"button",onClick:()=>h(!f),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-white/40 hover:text-white/60 transition-colors duration-200",children:f?E.jsx(rm,{size:18}):E.jsx(sm,{size:18})})]}),x.password&&E.jsxs("p",{className:"mt-2 text-red-400 text-xs flex items-center space-x-1",children:[E.jsx(ln,{size:12}),E.jsx("span",{children:x.password})]})]}),E.jsxs("div",{children:[E.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Confirm Password"}),E.jsxs("div",{className:"relative",children:[E.jsx("input",{type:p?"text":"password",value:c.confirmPassword,onChange:C=>A("confirmPassword",C.target.value),placeholder:"Confirm your password",className:`w-full pl-4 pr-12 py-4 bg-white/5 border rounded-2xl text-white placeholder-white/40 focus:outline-none transition-all duration-300 ${x.confirmPassword?"border-red-500/60 focus:border-red-500 focus:bg-red-500/10":"border-white/20 focus:border-red-500/60 focus:bg-white/10"}`}),E.jsx("button",{type:"button",onClick:()=>v(!p),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-white/40 hover:text-white/60 transition-colors duration-200",children:p?E.jsx(rm,{size:18}):E.jsx(sm,{size:18})})]}),x.confirmPassword&&E.jsxs("p",{className:"mt-2 text-red-400 text-xs flex items-center space-x-1",children:[E.jsx(ln,{size:12}),E.jsx("span",{children:x.confirmPassword})]})]}),E.jsxs("div",{className:"space-y-4",children:[E.jsxs("label",{className:"flex items-start space-x-3 cursor-pointer group",children:[E.jsxs("div",{className:"relative mt-1",children:[E.jsx("input",{type:"checkbox",checked:c.agreeToTerms,onChange:C=>A("agreeToTerms",C.target.checked),className:"sr-only"}),E.jsx("div",{className:`w-5 h-5 rounded border-2 transition-all duration-200 ${c.agreeToTerms?"bg-red-500 border-red-500":"border-white/30 group-hover:border-white/50"}`,children:c.agreeToTerms&&E.jsx(nm,{className:"text-white",size:12})})]}),E.jsxs("span",{className:"text-white/70 text-sm group-hover:text-white/90 transition-colors duration-200",children:["I agree to the"," ",E.jsx(Zs,{to:"/terms",className:"text-red-400 hover:text-red-300 underline",children:"Terms of Service"})," ","and"," ",E.jsx(Zs,{to:"/privacy",className:"text-red-400 hover:text-red-300 underline",children:"Privacy Policy"})]})]}),x.agreeToTerms&&E.jsxs("p",{className:"text-red-400 text-xs flex items-center space-x-1",children:[E.jsx(ln,{size:12}),E.jsx("span",{children:x.agreeToTerms})]}),E.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer group",children:[E.jsxs("div",{className:"relative",children:[E.jsx("input",{type:"checkbox",checked:c.subscribeNewsletter,onChange:C=>A("subscribeNewsletter",C.target.checked),className:"sr-only"}),E.jsx("div",{className:`w-5 h-5 rounded border-2 transition-all duration-200 ${c.subscribeNewsletter?"bg-red-500 border-red-500":"border-white/30 group-hover:border-white/50"}`,children:c.subscribeNewsletter&&E.jsx(nm,{className:"text-white",size:12})})]}),E.jsx("span",{className:"text-white/70 text-sm group-hover:text-white/90 transition-colors duration-200",children:"Subscribe to our newsletter for updates"})]})]}),E.jsx("button",{type:"submit",disabled:s,className:"w-full py-4 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold rounded-2xl transition-all duration-300 transform hover:scale-[1.02] hover:shadow-2xl hover:shadow-red-500/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center space-x-2",children:s?E.jsxs(E.Fragment,{children:[E.jsx("div",{className:"w-5 h-5 border-2 border-white/20 border-t-white rounded-full animate-spin"}),E.jsx("span",{children:"Creating Account..."})]}):E.jsxs(E.Fragment,{children:[E.jsx("span",{children:"Create Account"}),E.jsx(sc,{className:"group-hover:translate-x-1 transition-transform duration-300",size:18})]})})]}),E.jsx("div",{className:"text-center mt-8",children:E.jsxs("p",{className:"text-white/60 text-sm",children:["Already have an account?"," ",E.jsx(Zs,{to:"/login",className:"text-red-400 hover:text-red-300 font-medium transition-colors duration-200",children:"Sign In"})]})})]})})})]})};class R$ extends N.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("ErrorBoundary caught an error:",e,t)}render(){return this.state.hasError?E.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center",children:E.jsxs("div",{className:"text-center",children:[E.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Something went wrong"}),E.jsx("p",{className:"text-gray-300 mb-6",children:this.state.error?.message}),E.jsx("button",{onClick:()=>this.setState({hasError:!1}),className:"px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Try Again"})]})}):this.props.children}}function I$(){return E.jsx(w$,{children:E.jsx(R$,{children:E.jsx(dI,{children:E.jsx("div",{className:"min-h-screen bg-black overflow-x-hidden antialiased",children:E.jsxs(Jy,{children:[E.jsx(qn,{path:"/login",element:E.jsx(A$,{})}),E.jsx(qn,{path:"/signup",element:E.jsx(L$,{})}),E.jsx(qn,{path:"/*",element:E.jsxs("div",{className:"flex flex-col min-h-screen",children:[E.jsx(MN,{}),E.jsx("main",{className:"flex-1 pb-safe",children:E.jsxs(Jy,{children:[E.jsx(qn,{path:"/",element:E.jsx(o2,{})}),E.jsx(qn,{path:"/movies",element:E.jsx(d2,{})}),E.jsx(qn,{path:"/series",element:E.jsx(p2,{})}),E.jsx(qn,{path:"/new-popular",element:E.jsx(g2,{})}),E.jsx(qn,{path:"/live-tv",element:E.jsx(S$,{})}),E.jsx(qn,{path:"/movie/:id",element:E.jsx(Dx,{})}),E.jsx(qn,{path:"/tv/:id",element:E.jsx(Dx,{})})]})})]})})]})})})})})}function Ft(n){return`Minified Redux error #${n}; visit https://redux.js.org/Errors?code=${n} for the full message or use the non-minified dev environment for full errors. `}var _$=typeof Symbol=="function"&&Symbol.observable||"@@observable",JS=_$,Bh=()=>Math.random().toString(36).substring(7).split("").join("."),C$={INIT:`@@redux/INIT${Bh()}`,REPLACE:`@@redux/REPLACE${Bh()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${Bh()}`},Sc=C$;function tg(n){if(typeof n!="object"||n===null)return!1;let e=n;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(n)===e||Object.getPrototypeOf(n)===null}function T1(n,e,t){if(typeof n!="function")throw new Error(Ft(2));if(typeof e=="function"&&typeof t=="function"||typeof t=="function"&&typeof arguments[3]=="function")throw new Error(Ft(0));if(typeof e=="function"&&typeof t>"u"&&(t=e,e=void 0),typeof t<"u"){if(typeof t!="function")throw new Error(Ft(1));return t(T1)(n,e)}let r=n,s=e,i=new Map,o=i,l=0,c=!1;function d(){o===i&&(o=new Map,i.forEach((x,b)=>{o.set(b,x)}))}function f(){if(c)throw new Error(Ft(3));return s}function h(x){if(typeof x!="function")throw new Error(Ft(4));if(c)throw new Error(Ft(5));let b=!0;d();const A=l++;return o.set(A,x),function(){if(b){if(c)throw new Error(Ft(6));b=!1,d(),o.delete(A),i=null}}}function p(x){if(!tg(x))throw new Error(Ft(7));if(typeof x.type>"u")throw new Error(Ft(8));if(typeof x.type!="string")throw new Error(Ft(17));if(c)throw new Error(Ft(9));try{c=!0,s=r(s,x)}finally{c=!1}return(i=o).forEach(A=>{A()}),x}function v(x){if(typeof x!="function")throw new Error(Ft(10));r=x,p({type:Sc.REPLACE})}function g(){const x=h;return{subscribe(b){if(typeof b!="object"||b===null)throw new Error(Ft(11));function A(){const I=b;I.next&&I.next(f())}return A(),{unsubscribe:x(A)}},[JS](){return this}}}return p({type:Sc.INIT}),{dispatch:p,subscribe:h,getState:f,replaceReducer:v,[JS]:g}}function k$(n){Object.keys(n).forEach(e=>{const t=n[e];if(typeof t(void 0,{type:Sc.INIT})>"u")throw new Error(Ft(12));if(typeof t(void 0,{type:Sc.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(Ft(13))})}function P$(n){const e=Object.keys(n),t={};for(let i=0;i<e.length;i++){const o=e[i];typeof n[o]=="function"&&(t[o]=n[o])}const r=Object.keys(t);let s;try{k$(t)}catch(i){s=i}return function(o={},l){if(s)throw s;let c=!1;const d={};for(let f=0;f<r.length;f++){const h=r[f],p=t[h],v=o[h],g=p(v,l);if(typeof g>"u")throw l&&l.type,new Error(Ft(14));d[h]=g,c=c||g!==v}return c=c||r.length!==Object.keys(o).length,c?d:o}}function Ec(...n){return n.length===0?e=>e:n.length===1?n[0]:n.reduce((e,t)=>(...r)=>e(t(...r)))}function D$(...n){return e=>(t,r)=>{const s=e(t,r);let i=()=>{throw new Error(Ft(15))};const o={getState:s.getState,dispatch:(c,...d)=>i(c,...d)},l=n.map(c=>c(o));return i=Ec(...l)(s.dispatch),{...s,dispatch:i}}}function N$(n){return tg(n)&&"type"in n&&typeof n.type=="string"}var b1=Symbol.for("immer-nothing"),ZS=Symbol.for("immer-draftable"),_n=Symbol.for("immer-state");function Qn(n,...e){throw new Error(`[Immer] minified error nr: ${n}. Full error at: https://bit.ly/3cXEKWf`)}var eo=Object.getPrototypeOf;function oi(n){return!!n&&!!n[_n]}function Wr(n){return n?w1(n)||Array.isArray(n)||!!n[ZS]||!!n.constructor?.[ZS]||Xa(n)||Yc(n):!1}var O$=Object.prototype.constructor.toString();function w1(n){if(!n||typeof n!="object")return!1;const e=eo(n);if(e===null)return!0;const t=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return t===Object?!0:typeof t=="function"&&Function.toString.call(t)===O$}function Tc(n,e){Wc(n)===0?Reflect.ownKeys(n).forEach(t=>{e(t,n[t],n)}):n.forEach((t,r)=>e(r,t,n))}function Wc(n){const e=n[_n];return e?e.type_:Array.isArray(n)?1:Xa(n)?2:Yc(n)?3:0}function jm(n,e){return Wc(n)===2?n.has(e):Object.prototype.hasOwnProperty.call(n,e)}function A1(n,e,t){const r=Wc(n);r===2?n.set(e,t):r===3?n.add(t):n[e]=t}function M$(n,e){return n===e?n!==0||1/n===1/e:n!==n&&e!==e}function Xa(n){return n instanceof Map}function Yc(n){return n instanceof Set}function Xs(n){return n.copy_||n.base_}function Vm(n,e){if(Xa(n))return new Map(n);if(Yc(n))return new Set(n);if(Array.isArray(n))return Array.prototype.slice.call(n);const t=w1(n);if(e===!0||e==="class_only"&&!t){const r=Object.getOwnPropertyDescriptors(n);delete r[_n];let s=Reflect.ownKeys(r);for(let i=0;i<s.length;i++){const o=s[i],l=r[o];l.writable===!1&&(l.writable=!0,l.configurable=!0),(l.get||l.set)&&(r[o]={configurable:!0,writable:!0,enumerable:l.enumerable,value:n[o]})}return Object.create(eo(n),r)}else{const r=eo(n);if(r!==null&&t)return{...n};const s=Object.create(r);return Object.assign(s,n)}}function ng(n,e=!1){return qc(n)||oi(n)||!Wr(n)||(Wc(n)>1&&Object.defineProperties(n,{set:{value:ku},add:{value:ku},clear:{value:ku},delete:{value:ku}}),Object.freeze(n),e&&Object.values(n).forEach(t=>ng(t,!0))),n}function ku(){Qn(2)}function qc(n){return Object.isFrozen(n)}var F$={};function ai(n){const e=F$[n];return e||Qn(0,n),e}var Na;function L1(){return Na}function B$(n,e){return{drafts_:[],parent_:n,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function eE(n,e){e&&(ai("Patches"),n.patches_=[],n.inversePatches_=[],n.patchListener_=e)}function Gm(n){Hm(n),n.drafts_.forEach(U$),n.drafts_=null}function Hm(n){n===Na&&(Na=n.parent_)}function tE(n){return Na=B$(Na,n)}function U$(n){const e=n[_n];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function nE(n,e){e.unfinalizedDrafts_=e.drafts_.length;const t=e.drafts_[0];return n!==void 0&&n!==t?(t[_n].modified_&&(Gm(e),Qn(4)),Wr(n)&&(n=bc(e,n),e.parent_||wc(e,n)),e.patches_&&ai("Patches").generateReplacementPatches_(t[_n].base_,n,e.patches_,e.inversePatches_)):n=bc(e,t,[]),Gm(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),n!==b1?n:void 0}function bc(n,e,t){if(qc(e))return e;const r=e[_n];if(!r)return Tc(e,(s,i)=>rE(n,r,e,s,i,t)),e;if(r.scope_!==n)return e;if(!r.modified_)return wc(n,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;const s=r.copy_;let i=s,o=!1;r.type_===3&&(i=new Set(s),s.clear(),o=!0),Tc(i,(l,c)=>rE(n,r,s,l,c,t,o)),wc(n,s,!1),t&&n.patches_&&ai("Patches").generatePatches_(r,t,n.patches_,n.inversePatches_)}return r.copy_}function rE(n,e,t,r,s,i,o){if(oi(s)){const l=i&&e&&e.type_!==3&&!jm(e.assigned_,r)?i.concat(r):void 0,c=bc(n,s,l);if(A1(t,r,c),oi(c))n.canAutoFreeze_=!1;else return}else o&&t.add(s);if(Wr(s)&&!qc(s)){if(!n.immer_.autoFreeze_&&n.unfinalizedDrafts_<1)return;bc(n,s),(!e||!e.scope_.parent_)&&typeof r!="symbol"&&(Xa(t)?t.has(r):Object.prototype.propertyIsEnumerable.call(t,r))&&wc(n,s)}}function wc(n,e,t=!1){!n.parent_&&n.immer_.autoFreeze_&&n.canAutoFreeze_&&ng(e,t)}function $$(n,e){const t=Array.isArray(n),r={type_:t?1:0,scope_:e?e.scope_:L1(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:n,draft_:null,copy_:null,revoke_:null,isManual_:!1};let s=r,i=rg;t&&(s=[r],i=Oa);const{revoke:o,proxy:l}=Proxy.revocable(s,i);return r.draft_=l,r.revoke_=o,l}var rg={get(n,e){if(e===_n)return n;const t=Xs(n);if(!jm(t,e))return j$(n,t,e);const r=t[e];return n.finalized_||!Wr(r)?r:r===Uh(n.base_,e)?($h(n),n.copy_[e]=zm(r,n)):r},has(n,e){return e in Xs(n)},ownKeys(n){return Reflect.ownKeys(Xs(n))},set(n,e,t){const r=R1(Xs(n),e);if(r?.set)return r.set.call(n.draft_,t),!0;if(!n.modified_){const s=Uh(Xs(n),e),i=s?.[_n];if(i&&i.base_===t)return n.copy_[e]=t,n.assigned_[e]=!1,!0;if(M$(t,s)&&(t!==void 0||jm(n.base_,e)))return!0;$h(n),Km(n)}return n.copy_[e]===t&&(t!==void 0||e in n.copy_)||Number.isNaN(t)&&Number.isNaN(n.copy_[e])||(n.copy_[e]=t,n.assigned_[e]=!0),!0},deleteProperty(n,e){return Uh(n.base_,e)!==void 0||e in n.base_?(n.assigned_[e]=!1,$h(n),Km(n)):delete n.assigned_[e],n.copy_&&delete n.copy_[e],!0},getOwnPropertyDescriptor(n,e){const t=Xs(n),r=Reflect.getOwnPropertyDescriptor(t,e);return r&&{writable:!0,configurable:n.type_!==1||e!=="length",enumerable:r.enumerable,value:t[e]}},defineProperty(){Qn(11)},getPrototypeOf(n){return eo(n.base_)},setPrototypeOf(){Qn(12)}},Oa={};Tc(rg,(n,e)=>{Oa[n]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}});Oa.deleteProperty=function(n,e){return Oa.set.call(this,n,e,void 0)};Oa.set=function(n,e,t){return rg.set.call(this,n[0],e,t,n[0])};function Uh(n,e){const t=n[_n];return(t?Xs(t):n)[e]}function j$(n,e,t){const r=R1(e,t);return r?"value"in r?r.value:r.get?.call(n.draft_):void 0}function R1(n,e){if(!(e in n))return;let t=eo(n);for(;t;){const r=Object.getOwnPropertyDescriptor(t,e);if(r)return r;t=eo(t)}}function Km(n){n.modified_||(n.modified_=!0,n.parent_&&Km(n.parent_))}function $h(n){n.copy_||(n.copy_=Vm(n.base_,n.scope_.immer_.useStrictShallowCopy_))}var V$=class{constructor(n){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,r)=>{if(typeof e=="function"&&typeof t!="function"){const i=t;t=e;const o=this;return function(c=i,...d){return o.produce(c,f=>t.call(this,f,...d))}}typeof t!="function"&&Qn(6),r!==void 0&&typeof r!="function"&&Qn(7);let s;if(Wr(e)){const i=tE(this),o=zm(e,void 0);let l=!0;try{s=t(o),l=!1}finally{l?Gm(i):Hm(i)}return eE(i,r),nE(s,i)}else if(!e||typeof e!="object"){if(s=t(e),s===void 0&&(s=e),s===b1&&(s=void 0),this.autoFreeze_&&ng(s,!0),r){const i=[],o=[];ai("Patches").generateReplacementPatches_(e,s,i,o),r(i,o)}return s}else Qn(1,e)},this.produceWithPatches=(e,t)=>{if(typeof e=="function")return(o,...l)=>this.produceWithPatches(o,c=>e(c,...l));let r,s;return[this.produce(e,t,(o,l)=>{r=o,s=l}),r,s]},typeof n?.autoFreeze=="boolean"&&this.setAutoFreeze(n.autoFreeze),typeof n?.useStrictShallowCopy=="boolean"&&this.setUseStrictShallowCopy(n.useStrictShallowCopy)}createDraft(n){Wr(n)||Qn(8),oi(n)&&(n=G$(n));const e=tE(this),t=zm(n,void 0);return t[_n].isManual_=!0,Hm(e),t}finishDraft(n,e){const t=n&&n[_n];(!t||!t.isManual_)&&Qn(9);const{scope_:r}=t;return eE(r,e),nE(void 0,r)}setAutoFreeze(n){this.autoFreeze_=n}setUseStrictShallowCopy(n){this.useStrictShallowCopy_=n}applyPatches(n,e){let t;for(t=e.length-1;t>=0;t--){const s=e[t];if(s.path.length===0&&s.op==="replace"){n=s.value;break}}t>-1&&(e=e.slice(t+1));const r=ai("Patches").applyPatches_;return oi(n)?r(n,e):this.produce(n,s=>r(s,e))}};function zm(n,e){const t=Xa(n)?ai("MapSet").proxyMap_(n,e):Yc(n)?ai("MapSet").proxySet_(n,e):$$(n,e);return(e?e.scope_:L1()).drafts_.push(t),t}function G$(n){return oi(n)||Qn(10,n),I1(n)}function I1(n){if(!Wr(n)||qc(n))return n;const e=n[_n];let t;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,t=Vm(n,e.scope_.immer_.useStrictShallowCopy_)}else t=Vm(n,!0);return Tc(t,(r,s)=>{A1(t,r,I1(s))}),e&&(e.finalized_=!1),t}var H$=new V$,_1=H$.produce;function C1(n){return({dispatch:t,getState:r})=>s=>i=>typeof i=="function"?i(t,r,n):s(i)}var K$=C1(),z$=C1,W$=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?Ec:Ec.apply(null,arguments)};function sE(n,e){function t(...r){if(e){let s=e(...r);if(!s)throw new Error(Gr(0));return{type:n,payload:s.payload,..."meta"in s&&{meta:s.meta},..."error"in s&&{error:s.error}}}return{type:n,payload:r[0]}}return t.toString=()=>`${n}`,t.type=n,t.match=r=>N$(r)&&r.type===n,t}var k1=class oa extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,oa.prototype)}static get[Symbol.species](){return oa}concat(...e){return super.concat.apply(this,e)}prepend(...e){return e.length===1&&Array.isArray(e[0])?new oa(...e[0].concat(this)):new oa(...e.concat(this))}};function iE(n){return Wr(n)?_1(n,()=>{}):n}function Pu(n,e,t){return n.has(e)?n.get(e):n.set(e,t(e)).get(e)}function Y$(n){return typeof n=="boolean"}var q$=()=>function(e){const{thunk:t=!0,immutableCheck:r=!0,serializableCheck:s=!0,actionCreatorCheck:i=!0}=e??{};let o=new k1;return t&&(Y$(t)?o.push(K$):o.push(z$(t.extraArgument))),o},X$="RTK_autoBatch",oE=n=>e=>{setTimeout(e,n)},Q$=(n={type:"raf"})=>e=>(...t)=>{const r=e(...t);let s=!0,i=!1,o=!1;const l=new Set,c=n.type==="tick"?queueMicrotask:n.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:oE(10):n.type==="callback"?n.queueNotification:oE(n.timeout),d=()=>{o=!1,i&&(i=!1,l.forEach(f=>f()))};return Object.assign({},r,{subscribe(f){const h=()=>s&&f(),p=r.subscribe(h);return l.add(f),()=>{p(),l.delete(f)}},dispatch(f){try{return s=!f?.meta?.[X$],i=!s,i&&(o||(o=!0,c(d))),r.dispatch(f)}finally{s=!0}}})},J$=n=>function(t){const{autoBatch:r=!0}=t??{};let s=new k1(n);return r&&s.push(Q$(typeof r=="object"?r:void 0)),s};function Z$(n){const e=q$(),{reducer:t=void 0,middleware:r,devTools:s=!0,preloadedState:i=void 0,enhancers:o=void 0}=n||{};let l;if(typeof t=="function")l=t;else if(tg(t))l=P$(t);else throw new Error(Gr(1));let c;typeof r=="function"?c=r(e):c=e();let d=Ec;s&&(d=W$({trace:!1,...typeof s=="object"&&s}));const f=D$(...c),h=J$(f);let p=typeof o=="function"?o(h):h();const v=d(...p);return T1(l,i,v)}function P1(n){const e={},t=[];let r;const s={addCase(i,o){const l=typeof i=="string"?i:i.type;if(!l)throw new Error(Gr(28));if(l in e)throw new Error(Gr(29));return e[l]=o,s},addAsyncThunk(i,o){return o.pending&&(e[i.pending.type]=o.pending),o.rejected&&(e[i.rejected.type]=o.rejected),o.fulfilled&&(e[i.fulfilled.type]=o.fulfilled),o.settled&&t.push({matcher:i.settled,reducer:o.settled}),s},addMatcher(i,o){return t.push({matcher:i,reducer:o}),s},addDefaultCase(i){return r=i,s}};return n(s),[e,t,r]}function ej(n){return typeof n=="function"}function tj(n,e){let[t,r,s]=P1(e),i;if(ej(n))i=()=>iE(n());else{const l=iE(n);i=()=>l}function o(l=i(),c){let d=[t[c.type],...r.filter(({matcher:f})=>f(c)).map(({reducer:f})=>f)];return d.filter(f=>!!f).length===0&&(d=[s]),d.reduce((f,h)=>{if(h)if(oi(f)){const v=h(f,c);return v===void 0?f:v}else{if(Wr(f))return _1(f,p=>h(p,c));{const p=h(f,c);if(p===void 0){if(f===null)return f;throw Error("A case reducer on a non-draftable value must not return undefined")}return p}}return f},l)}return o.getInitialState=i,o}var nj=Symbol.for("rtk-slice-createasyncthunk");function rj(n,e){return`${n}/${e}`}function sj({creators:n}={}){const e=n?.asyncThunk?.[nj];return function(r){const{name:s,reducerPath:i=s}=r;if(!s)throw new Error(Gr(11));const o=(typeof r.reducers=="function"?r.reducers(aj()):r.reducers)||{},l=Object.keys(o),c={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},d={addCase(L,I){const k=typeof L=="string"?L:L.type;if(!k)throw new Error(Gr(12));if(k in c.sliceCaseReducersByType)throw new Error(Gr(13));return c.sliceCaseReducersByType[k]=I,d},addMatcher(L,I){return c.sliceMatchers.push({matcher:L,reducer:I}),d},exposeAction(L,I){return c.actionCreators[L]=I,d},exposeCaseReducer(L,I){return c.sliceCaseReducersByName[L]=I,d}};l.forEach(L=>{const I=o[L],k={reducerName:L,type:rj(s,L),createNotation:typeof r.reducers=="function"};uj(I)?dj(k,I,d,e):lj(k,I,d)});function f(){const[L={},I=[],k=void 0]=typeof r.extraReducers=="function"?P1(r.extraReducers):[r.extraReducers],F={...L,...c.sliceCaseReducersByType};return tj(r.initialState,C=>{for(let P in F)C.addCase(P,F[P]);for(let P of c.sliceMatchers)C.addMatcher(P.matcher,P.reducer);for(let P of I)C.addMatcher(P.matcher,P.reducer);k&&C.addDefaultCase(k)})}const h=L=>L,p=new Map,v=new WeakMap;let g;function S(L,I){return g||(g=f()),g(L,I)}function x(){return g||(g=f()),g.getInitialState()}function b(L,I=!1){function k(C){let P=C[L];return typeof P>"u"&&I&&(P=Pu(v,k,x)),P}function F(C=h){const P=Pu(p,I,()=>new WeakMap);return Pu(P,C,()=>{const O={};for(const[M,H]of Object.entries(r.selectors??{}))O[M]=ij(H,C,()=>Pu(v,C,x),I);return O})}return{reducerPath:L,getSelectors:F,get selectors(){return F(k)},selectSlice:k}}const A={name:s,reducer:S,actions:c.actionCreators,caseReducers:c.sliceCaseReducersByName,getInitialState:x,...b(i),injectInto(L,{reducerPath:I,...k}={}){const F=I??i;return L.inject({reducerPath:F,reducer:S},k),{...A,...b(F,!0)}}};return A}}function ij(n,e,t,r){function s(i,...o){let l=e(i);return typeof l>"u"&&r&&(l=t()),n(l,...o)}return s.unwrapped=n,s}var oj=sj();function aj(){function n(e,t){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...t}}return n.withTypes=()=>n,{reducer(e){return Object.assign({[e.name](...t){return e(...t)}}[e.name],{_reducerDefinitionType:"reducer"})},preparedReducer(e,t){return{_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:t}},asyncThunk:n}}function lj({type:n,reducerName:e,createNotation:t},r,s){let i,o;if("reducer"in r){if(t&&!cj(r))throw new Error(Gr(17));i=r.reducer,o=r.prepare}else i=r;s.addCase(n,i).exposeCaseReducer(e,i).exposeAction(e,o?sE(n,o):sE(n))}function uj(n){return n._reducerDefinitionType==="asyncThunk"}function cj(n){return n._reducerDefinitionType==="reducerWithPrepare"}function dj({type:n,reducerName:e},t,r,s){if(!s)throw new Error(Gr(18));const{payloadCreator:i,fulfilled:o,pending:l,rejected:c,settled:d,options:f}=t,h=s(n,i,f);r.exposeAction(e,h),o&&r.addCase(h.fulfilled,o),l&&r.addCase(h.pending,l),c&&r.addCase(h.rejected,c),d&&r.addMatcher(h.settled,d),r.exposeCaseReducer(e,{fulfilled:o||Du,pending:l||Du,rejected:c||Du,settled:d||Du})}function Du(){}function Gr(n){return`Minified Redux Toolkit error #${n}; visit https://redux-toolkit.js.org/Errors?code=${n} for the full message or use the non-minified dev environment for full errors. `}const fj={isScrolled:!1,isSearchActive:!1,searchQuery:"",isSearching:!1,isProfileOpen:!1,isNotificationOpen:!1,isMoviesMenuOpen:!1,isQuickActionsOpen:!1,searchHistory:[]},D1=oj({name:"ui",initialState:fj,reducers:{setScrolled(n,e){n.isScrolled=e.payload},setSearchActive(n,e){n.isSearchActive=e.payload},toggleSearch(n){n.isSearchActive=!n.isSearchActive},setSearchQuery(n,e){n.searchQuery=e.payload},setSearching(n,e){n.isSearching=e.payload},toggleProfile(n){n.isProfileOpen=!n.isProfileOpen},toggleNotification(n){n.isNotificationOpen=!n.isNotificationOpen},toggleMoviesMenu(n){n.isMoviesMenuOpen=!n.isMoviesMenuOpen},setMoviesMenu(n,e){n.isMoviesMenuOpen=e.payload},toggleQuickActions(n){n.isQuickActionsOpen=!n.isQuickActionsOpen},setQuickActions(n,e){n.isQuickActionsOpen=e.payload},addSearchHistory(n,e){const t=e.payload.trim();if(!t)return;const r=n.searchHistory.findIndex(s=>s.toLowerCase()===t.toLowerCase());r!==-1&&n.searchHistory.splice(r,1),n.searchHistory.unshift(t),n.searchHistory.length>6&&(n.searchHistory=n.searchHistory.slice(0,6))},removeSearchHistoryItem(n,e){n.searchHistory=n.searchHistory.filter(t=>t.toLowerCase()!==e.payload.trim().toLowerCase())},clearSearchHistory(n){n.searchHistory=[]},closeAllOverlays(n){n.isSearchActive=!1,n.isProfileOpen=!1,n.isNotificationOpen=!1,n.isMoviesMenuOpen=!1,n.isQuickActionsOpen=!1}}}),{setScrolled:Mj,setSearchActive:Fj,toggleSearch:Bj,setSearchQuery:Uj,setSearching:$j,toggleProfile:jj,toggleNotification:Vj,toggleMoviesMenu:Gj,setMoviesMenu:Hj,toggleQuickActions:Kj,setQuickActions:zj,addSearchHistory:Wj,removeSearchHistoryItem:Yj,clearSearchHistory:qj,closeAllOverlays:Xj}=D1.actions,hj=D1.reducer,mj=Z$({reducer:{ui:hj}});OL.createRoot(document.getElementById("root")).render(E.jsx(Ln.StrictMode,{children:E.jsx(JL,{store:mj,children:E.jsx(I$,{})})}));
