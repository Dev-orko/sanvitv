<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Player Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 10px;
            cursor: pointer;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 500;
        }
        button:hover {
            background: #0056b3;
        }
        .player-container {
            width: 100%;
            height: 70vh;
            background: #000;
            border-radius: 8px;
            overflow: hidden;
            margin: 20px 0;
            position: relative;
            border: 2px solid #333;
        }
        iframe, video {
            width: 100%;
            height: 100%;
            border: none;
        }
        .status {
            background: #333;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
        }
        .logs {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 6px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
            line-height: 1.4;
        }
        .movie-info {
            background: #333;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .quality-badge {
            display: inline-block;
            background: #007bff;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: rgba(0,0,0,0.8);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé¨ Simple Movie Player Test</h1>
        
        <div class="controls">
            <button onclick="testMovie('Fight Club')">Fight Club</button>
            <button onclick="testMovie('Avatar')">Avatar</button>
            <button onclick="testMovie('The Dark Knight')">The Dark Knight</button>
            <button onclick="testMovie('Inception')">Inception</button>
            <button onclick="testMovie('Interstellar')">Interstellar</button>
            <button onclick="closePlayer()">Close Player</button>
        </div>

        <div class="status" id="status">
            <strong>Status:</strong> Ready to test movies
        </div>

        <div class="player-container" id="playerContainer" style="display:none;">
            <button class="close-btn" onclick="closePlayer()">√ó</button>
            <div id="playerContent"></div>
        </div>

        <div id="movieInfo" style="display:none;"></div>

        <div class="logs" id="logs">
            <strong>üìã Logs:</strong><br>
            Ready to test movies from Fmovies API...
        </div>
    </div>

    <script>
        let currentMovies = [];
        let currentMovieIndex = 0;

        function log(message) {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            logs.innerHTML += `<br>[${timestamp}] ${message}`;
            logs.scrollTop = logs.scrollHeight;
            console.log(message);
        }

        function updateStatus(message) {
            document.getElementById('status').innerHTML = `<strong>Status:</strong> ${message}`;
        }

        async function testMovie(movieTitle) {
            log(`üé¨ Testing: ${movieTitle}`);
            updateStatus(`Searching for ${movieTitle}...`);
            
            try {
                // Get movies from API
                const movies = await searchMovies(movieTitle);
                
                if (movies.length === 0) {
                    log('‚ùå No movies found');
                    updateStatus('No movies found');
                    return;
                }

                currentMovies = movies;
                currentMovieIndex = 0;
                
                log(`‚úÖ Found ${movies.length} movies`);
                displayMovieInfo();
                playMovie(0);

            } catch (error) {
                log(`‚ùå Error: ${error.message}`);
                updateStatus(`Error: ${error.message}`);
            }
        }

        async function searchMovies(movieTitle) {
            const url = `http://127.0.0.1:5000/media/searchByName?name=${encodeURIComponent(movieTitle)}`;
            log(`üì° API: ${url}`);

            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`API Error: ${response.status}`);
            }

            const data = await response.json();
            log(`üì¶ API Response: ${JSON.stringify(data, null, 2)}`);

            // Filter for movies only
            const movies = (Array.isArray(data) ? data : [data]).filter(item => 
                item && item.type === 'Movie'
            );

            log(`üé≠ Movies found: ${movies.length}`);
            return movies;
        }

        function displayMovieInfo() {
            const movie = currentMovies[currentMovieIndex];
            const movieInfo = document.getElementById('movieInfo');
            
            movieInfo.innerHTML = `
                <div class="movie-info">
                    <h3>${movie.title} <span class="quality-badge">${movie.quality}</span></h3>
                    <p><strong>Release:</strong> ${movie.release_date}</p>
                    <p><strong>Type:</strong> ${movie.type}</p>
                    <p><strong>URL:</strong> <a href="${movie.link}" target="_blank" style="color: #007bff;">${movie.link}</a></p>
                    ${currentMovies.length > 1 ? `
                        <div style="margin-top: 10px;">
                            <button onclick="playMovie(${currentMovieIndex - 1})" ${currentMovieIndex === 0 ? 'disabled' : ''}>‚Üê Previous</button>
                            <span style="margin: 0 15px;">Movie ${currentMovieIndex + 1} of ${currentMovies.length}</span>
                            <button onclick="playMovie(${currentMovieIndex + 1})" ${currentMovieIndex === currentMovies.length - 1 ? 'disabled' : ''}>Next ‚Üí</button>
                        </div>
                    ` : ''}
                </div>
            `;
            
            movieInfo.style.display = 'block';
        }

        function playMovie(index) {
            if (index < 0 || index >= currentMovies.length) return;
            
            currentMovieIndex = index;
            const movie = currentMovies[index];
            
            log(`üé• Playing: ${movie.title} (${movie.quality})`);
            updateStatus(`Playing ${movie.title}`);
            
            displayMovieInfo();
            
            // Show player
            const playerContainer = document.getElementById('playerContainer');
            const playerContent = document.getElementById('playerContent');
            
            playerContainer.style.display = 'block';
            
            // Create iframe for the movie page
            playerContent.innerHTML = `
                <iframe 
                    src="${movie.link}" 
                    allowfullscreen
                    allow="autoplay; fullscreen; encrypted-media; picture-in-picture"
                    style="width: 100%; height: 100%; border: none;"
                    onload="log('‚úÖ Movie page loaded in iframe')"
                    onerror="log('‚ùå Failed to load movie page')"
                ></iframe>
            `;
            
            log(`üì∫ Embedded movie page: ${movie.link}`);
        }

        function closePlayer() {
            document.getElementById('playerContainer').style.display = 'none';
            document.getElementById('movieInfo').style.display = 'none';
            updateStatus('Player closed');
            log('üîí Player closed');
        }

        // Auto-test with Fight Club on page load
        window.onload = () => {
            log('üöÄ Page loaded, ready to test movies');
        };
    </script>
</body>
</html>